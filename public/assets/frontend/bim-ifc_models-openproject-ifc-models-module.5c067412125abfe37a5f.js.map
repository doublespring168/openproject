{"version":3,"sources":["./src/app/modules/bim/ifc_models/pages/viewer/bim-view.service.ts","./src/app/modules/bim/ifc_models/toolbar/view-toggle/bim-view-toggle-dropdown.directive.ts","./src/app/modules/bim/ifc_models/toolbar/view-toggle/bim-view-toggle-button.component.ts","./src/app/modules/bim/ifc_models/pages/viewer/ifc-models-data.service.ts","./src/app/modules/bim/ifc_models/toolbar/manage-ifc-models-button/bim-manage-ifc-models-button.component.ts","./src/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.html","./src/app/modules/bim/ifc_models/pages/viewer/ifc-viewer-page.component.ts","./src/app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.component.html","./src/app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.component.ts","./src/app/modules/bim/ifc_models/empty/empty-component.ts","./src/app/modules/bim/ifc_models/ifc-base-view/event-handler/bcf-double-click-handler.ts","./src/app/modules/bim/ifc_models/ifc-base-view/event-handler/bcf-click-handler.ts","./src/app/modules/bim/ifc_models/ifc-base-view/event-handler/bcf-card-view-handler-registry.ts","./src/app/modules/work_packages/routing/wp-list-view/wp-list-view.component.html","./src/app/modules/bim/ifc_models/bcf/list-container/bcf-list-container.component.ts","./src/app/modules/bim/ifc_models/openproject-ifc-models.routes.ts","./src/app/modules/bim/ifc_models/openproject-ifc-models.module.ts"],"names":["bimListViewIdentifier","bimViewerViewIdentifier","bimSplitViewIdentifier","I18n","transitions","state","_state","text","list","this","t","viewer","split","icon","detectView","transitionFn","onSuccess","transition","values$","unsubscribe","view$","pipe","takeUntil","getValueOr","includes","putValue","currentViewerState","elementRef","opContextMenu","bimView","wpFiltersService","super","evt","buildItems","show","items","contextMenuId","current","data","viewRoute","map","key","hidden","linkText","onClick","visible","toggleVisibility","go","BimViewToggleButtonComponent","IfcModelsDataService","paths","currentProjectService","gon","gonIFC","models","projects","shown_models","shownModels","length","find","item","default","indexOf","id","ifcModelsPath","identifier","permission","permissions","get","BimManageIfcModelsButtonComponent","ifcData","manage","manageAllowed","allowed","manageIFCPath","injector","title","delete","edit","areYouSure","newRoute$","BehaviorSubject","newRoute","toolbarButtonComponents","component","inputs","stateName$","containerClasses","ngOnInit","observeUntil","subscribe","view","filterAllowed","transitionUnsubscribeFn","next","query","updateTitle","isSingleModel","selectedTitle","name","titleEditingEnabled","changeChangesFromTitle","updateTitleName","IFCViewerComponent","ifcViewer","canManage","empty_warning","use_this_link_to_manage","keyboard_input_disabled","keyboardEnabled","modelCount","element","jQuery","nativeElement","newViewer","canvasElement","explorerElement","toolbarElement","navCubeCanvasElement","busyModelBackdropElement","destroy","setKeyboardEnabled","target","outerContainer","contains","event","enableKeyBoard","modelCanvas","focus","stopImmediatePropagation","EmptyComponent","wpId","workPackageId","setSelection","wp","states","workPackages","value","viewerVisible","bcfViewpoints","showViewpoint","eventHandlers","c","wpTableConfiguration","dragAndDropEnabled","wpDisplayRepresentation","setDisplayRepresentation","showListView","noResults","ifcModelsService","provide","useValue","useClass","IFC_ROUTES","parent","url","abstract","redirectTo","params","query_props","type","dynamic","viewpoint","baseRoute","partition","reloadOnSearch","views","bodyClasses","undefined","OpenprojectIFCModelsModule","forChild"],"mappings":"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","file":"bim-ifc_models-openproject-ifc-models-module.5c067412125abfe37a5f.js","sourcesContent":["// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, OnDestroy} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {Observable} from \"rxjs\";\nimport {StateService, TransitionService} from \"@uirouter/core\";\nimport {input} from \"reactivestates\";\nimport {takeUntil} from \"rxjs/operators\";\n\n\nexport const bimListViewIdentifier = 'list';\nexport const bimViewerViewIdentifier = 'viewer';\nexport const bimSplitViewIdentifier = 'split';\n\nexport type BimViewState = 'list'|'viewer'|'split';\n\n@Injectable()\nexport class BimViewService implements OnDestroy {\n  private _state = input<BimViewState>();\n\n  public text:any = {\n    list: this.I18n.t('js.views.card'),\n    viewer: this.I18n.t('js.ifc_models.views.viewer'),\n    split: this.I18n.t('js.ifc_models.views.split')\n  };\n\n  public icon:any = {\n    list: 'icon-view-card',\n    viewer: 'icon-view-model',\n    split: 'icon-view-split2'\n  };\n\n  private transitionFn:Function;\n\n  constructor(readonly I18n:I18nService,\n              readonly transitions:TransitionService,\n              readonly state:StateService) {\n\n    this.detectView();\n\n    this.transitionFn = this.transitions.onSuccess({}, (transition) => {\n      this.detectView();\n    });\n  }\n\n  get view$():Observable<BimViewState> {\n    return this._state.values$();\n  }\n\n  public observeUntil(unsubscribe:Observable<any>) {\n    return this.view$.pipe(takeUntil(unsubscribe));\n  }\n\n  get current():BimViewState {\n    return this._state.getValueOr(bimSplitViewIdentifier);\n  }\n\n  public currentViewerState():BimViewState {\n    if (this.state.includes('bim.partitioned.list')) {\n      return bimListViewIdentifier;\n    } else if (this.state.includes('bim.**.model')) {\n      return bimViewerViewIdentifier;\n    } else {\n      return bimSplitViewIdentifier;\n    }\n  }\n\n  private detectView() {\n    this._state.putValue(this.currentViewerState());\n  }\n\n  ngOnDestroy() {\n    this.transitionFn();\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {Directive, ElementRef} from \"@angular/core\";\nimport {OpContextMenuTrigger} from \"core-components/op-context-menu/handlers/op-context-menu-trigger.directive\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {StateService} from \"@uirouter/core\";\n\nimport {WorkPackageFiltersService} from \"core-components/filters/wp-filters/wp-filters.service\";\nimport {\n  bimListViewIdentifier, bimSplitViewIdentifier,\n  bimViewerViewIdentifier,\n  BimViewService\n} from \"core-app/modules/bim/ifc_models/pages/viewer/bim-view.service\";\n\n@Directive({\n  selector: '[bimViewDropdown]'\n})\nexport class BimViewToggleDropdownDirective extends OpContextMenuTrigger {\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly bimView:BimViewService,\n              readonly I18n:I18nService,\n              readonly state:StateService,\n              readonly wpFiltersService:WorkPackageFiltersService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.buildItems();\n    this.opContextMenu.show(this, evt);\n  }\n\n  public get locals() {\n    return {\n      items: this.items,\n      contextMenuId: 'bim-view-context-menu'\n    };\n  }\n\n  private buildItems() {\n    const current = this.bimView.current;\n    const viewRoute = this.state.current.data.viewRoute;\n\n    this.items = [bimViewerViewIdentifier, bimListViewIdentifier, bimSplitViewIdentifier]\n      .map(key => {\n        return {\n          hidden: key === current,\n          linkText: this.bimView.text[key],\n          icon: this.bimView.icon[key],\n          onClick: () => {\n            // Close filter section\n            if (this.wpFiltersService.visible) {\n              this.wpFiltersService.toggleVisibility();\n            }\n\n            switch (key) {\n              case bimListViewIdentifier:\n                this.state.go('bim.partitioned.list');\n                break;\n              case bimViewerViewIdentifier:\n                this.state.go('bim.partitioned.model');\n                break;\n              case bimSplitViewIdentifier:\n                this.state.go('bim.partitioned.split');\n                break;\n            }\n\n            return true;\n          }\n        };\n      });\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {BimViewService} from \"core-app/modules/bim/ifc_models/pages/viewer/bim-view.service\";\n\n\n@Component({\n  template: `\n    <ng-container *ngIf=\"(view$ | async) as current\">\n      <button class=\"button\"\n              id=\"bim-view-toggle-button\"\n              bimViewDropdown>\n        <op-icon icon-classes=\"button--icon {{bimView.icon[current]}}\"></op-icon>\n        <span class=\"button--text\"\n              aria-hidden=\"true\"\n              [textContent]=\"bimView.text[current]\">\n        </span>\n        <op-icon icon-classes=\"button--icon icon-small icon-pulldown\"></op-icon>\n      </button>\n    </ng-container>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'bim-view-toggle-button'\n})\nexport class BimViewToggleButtonComponent {\n\n  view$ = this.bimView.view$;\n\n  constructor(readonly I18n:I18nService,\n              readonly bimView:BimViewService) {\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\n\nexport interface IFCPermissionMap {\n  manage_ifc_models:boolean;\n  manage_bcf:boolean;\n}\n\nexport interface IFCGonDefinition {\n  models:IfcModelDefinition[];\n  shown_models:number[];\n  projects:IfcProjectDefinition[];\n  xkt_attachment_ids:{ [id:number]:number };\n  metadata_attachment_ids:{ [id:number]:number };\n  permissions:IFCPermissionMap;\n}\n\nexport interface IfcProjectDefinition {\n  name:string;\n  id:number;\n}\n\nexport interface IfcModelDefinition {\n  name:string;\n  id:number;\n  default:boolean;\n  saoEnabled:boolean;\n}\n\n@Injectable()\nexport class IfcModelsDataService {\n\n  constructor(readonly paths:PathHelperService,\n              readonly currentProjectService:CurrentProjectService,\n              readonly gon:GonService) {\n  }\n\n  public get models():IfcModelDefinition[] {\n    return this.gonIFC.models;\n  }\n\n  public get projects():IfcProjectDefinition[] {\n    return this.gonIFC.projects;\n  }\n\n  public get shownModels():number[] {\n    return this.gonIFC.shown_models;\n  }\n\n  public isSingleModel() {\n    return this.shownModels.length === 1;\n  }\n\n  public isDefaults():boolean {\n    return !this\n      .models\n      .find(item => item.default && this.shownModels.indexOf(item.id) === -1);\n  }\n\n  public get manageIFCPath() {\n    return this.paths.ifcModelsPath(this.currentProjectService.identifier!);\n  }\n\n  public allowed(permission:keyof IFCPermissionMap):boolean {\n    return !!this.gonIFC.permissions[permission];\n  }\n\n  private get gonIFC():IFCGonDefinition {\n    return (this.gon.get('ifc_models') as IFCGonDefinition);\n  }\n}","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {IfcModelsDataService} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-models-data.service\";\n\n\n@Component({\n  template: `\n    <a *ngIf=\"manageAllowed\"\n       class=\"button\"\n       [href]=\"manageIFCPath\">\n      <op-icon icon-classes=\"button--icon icon-settings2\"></op-icon>\n      <span class=\"button--text\"\n            [textContent]=\"text.manage\"\n            aria-hidden=\"true\"></span>\n    </a>\n\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'bim-view-toggle-button'\n})\nexport class BimManageIfcModelsButtonComponent {\n\n  text = {\n    manage: this.I18n.t('js.ifc_models.models.manage'),\n  };\n\n  manageAllowed = this.ifcData.allowed('manage_ifc_models');\n  manageIFCPath = this.ifcData.manageIFCPath;\n\n  constructor(readonly I18n:I18nService,\n              readonly ifcData:IfcModelsDataService) {\n  }\n}\n","<div class=\"work-packages-partitioned-query-space--container\"\n      [ngClass]=\"currentPartition\">\n  <div class=\"toolbar-container -editable\">\n    <div class=\"toolbar\">\n      <back-button *ngIf=\"backButtonCallback\"\n                   linkClass=\"back-button\"\n                   [customBackMethod]=\"backButtonCallback\">\n      </back-button>\n\n      <editable-toolbar-title [title]=\"selectedTitle\"\n                              [inFlight]=\"toolbarDisabled\"\n                              [showSaveCondition]=\"showToolbarSaveButton\"\n                              (onSave)=\"changeChangesFromTitle($event)\"\n                              (onEmptySubmit)=\"updateTitleName('')\"\n                              [editable]=\"titleEditingEnabled\">\n      </editable-toolbar-title>\n\n      <ul class=\"toolbar-items hide-when-print\"\n          *ngIf=\"showToolbar\">\n\n        <ng-container *ngFor=\"let definition of toolbarButtonComponents\">\n          <li class=\"toolbar-item\"\n              *ngIf=\"!definition.show || definition.show()\"\n              [ngClass]=\"definition.containerClasses\">\n            <ndc-dynamic [ndcDynamicComponent]=\"definition.component\"\n                         [ndcDynamicInputs]=\"definition.inputs\"\n                         [ndcDynamicInjector]=\"injector\"\n                         [ndcDynamicOutputs]=\"definition.outputs\">\n            </ndc-dynamic>\n          </li>\n        </ng-container>\n      </ul>\n    </div>\n  </div>\n\n  <div class=\"work-packages-partitioned-query-space--filter-area\">\n    <ndc-dynamic [ndcDynamicComponent]=\"filterContainerDefinition.component\"\n                 [ndcDynamicInputs]=\"filterContainerDefinition.inputs\"\n                 [ndcDynamicOutputs]=\"filterContainerDefinition.outputs\"\n                 [ndcDynamicInjector]=\"injector\">\n    </ndc-dynamic>\n  </div>\n\n  <div class=\"work-packages-partitioned-page--content-container\">\n    <!-- Left content view -->\n    <div class=\"work-packages-partitioned-page--content-left loading-indicator--location\"\n         data-indicator-name=\"table\"\n         ui-view=\"content-left\">\n    </div>\n\n    <!-- Right content view -->\n    <div class=\"work-packages-partitioned-page--content-right\"\n         ui-view=\"content-right\"></div>\n  </div>\n</div>\n","import {ChangeDetectionStrategy, Component, Injector} from \"@angular/core\";\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\nimport {\n  PartitionedQuerySpacePageComponent,\n  ToolbarButtonComponentDefinition\n} from \"core-app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component\";\nimport {WorkPackageFilterButtonComponent} from \"core-components/wp-buttons/wp-filter-button/wp-filter-button.component\";\nimport {ZenModeButtonComponent} from \"core-components/wp-buttons/zen-mode-toggle-button/zen-mode-toggle-button.component\";\nimport {\n  bimListViewIdentifier,\n  bimViewerViewIdentifier,\n  BimViewService\n} from \"core-app/modules/bim/ifc_models/pages/viewer/bim-view.service\";\nimport {BimViewToggleButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/view-toggle/bim-view-toggle-button.component\";\nimport {IfcModelsDataService} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-models-data.service\";\nimport {QueryParamListenerService} from \"core-components/wp-query/query-param-listener.service\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {BimManageIfcModelsButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/manage-ifc-models-button/bim-manage-ifc-models-button.component\";\nimport {WorkPackageCreateButtonComponent} from \"core-components/wp-buttons/wp-create-button/wp-create-button.component\";\nimport {StateService, TransitionService} from \"@uirouter/core\";\nimport {BehaviorSubject} from \"rxjs\";\nimport {BcfImportButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/import-export-bcf/bcf-import-button.component\";\nimport {BcfExportButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/import-export-bcf/bcf-export-button.component\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  templateUrl: '/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.html',\n  styleUrls: [\n    '/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.sass'\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    QueryParamListenerService,\n  ]\n})\nexport class IFCViewerPageComponent extends PartitionedQuerySpacePageComponent {\n\n  text = {\n    title: this.I18n.t('js.ifc_models.models.default'),\n    delete: this.I18n.t('js.button_delete'),\n    edit: this.I18n.t('js.button_edit'),\n    areYouSure: this.I18n.t('js.text_are_you_sure')\n  };\n\n  newRoute$ = new BehaviorSubject<string>(this.state.current.data.newRoute);\n  transitionUnsubscribeFn:Function;\n\n  toolbarButtonComponents:ToolbarButtonComponentDefinition[] = [\n    {\n      component: WorkPackageCreateButtonComponent,\n      inputs: {\n        stateName$: this.newRoute$,\n        allowed: ['work_packages.createWorkPackage', 'work_package.copy']\n      }\n    },\n    {\n      component: BcfImportButtonComponent,\n      show: () => this.ifcData.allowed('manage_bcf'),\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: BcfExportButtonComponent,\n      show: () => this.ifcData.allowed('manage_bcf'),\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: WorkPackageFilterButtonComponent,\n      show: () => this.bimView.currentViewerState() !== bimViewerViewIdentifier\n    },\n    {\n      component: BimViewToggleButtonComponent,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: ZenModeButtonComponent,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: BimManageIfcModelsButtonComponent,\n      show: () => this.ifcData.allowed('manage_ifc_models')\n    }\n  ];\n\n  constructor(readonly ifcData:IfcModelsDataService,\n              readonly state:StateService,\n              readonly bimView:BimViewService,\n              readonly transition:TransitionService,\n              readonly gon:GonService,\n              readonly injector:Injector) {\n    super(injector);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this\n      .bimView\n      .observeUntil(componentDestroyed(this))\n      .subscribe((view) => {\n        this.filterAllowed = view !== bimViewerViewIdentifier;\n      });\n\n    // Keep the new route up to date depending on where we move to\n    this.transitionUnsubscribeFn = this.transition.onSuccess({}, () => {\n      this.newRoute$.next(this.state.current.data.newRoute);\n    });\n  }\n\n  /**\n   * We disable using the query title for now,\n   * but this might be useful later.\n   *\n   * To re-enable query titles, remove this function.\n   *\n   * @param query\n   */\n  updateTitle(query?:QueryResource) {\n    if (this.bimView.current === bimListViewIdentifier) {\n      super.updateTitle(query);\n    } else if (this.ifcData.isSingleModel()) {\n      this.selectedTitle = this.ifcData.models[0].name;\n    } else {\n      this.selectedTitle = this.I18n.t('js.ifc_models.models.default');\n    }\n\n    // For now, disable any editing\n    this.titleEditingEnabled = false;\n  }\n}\n","<div #outerContainer\n     class=\"ifc-model-viewer\">\n\n  <div *ngIf=\"modelCount === 0\" class=\"notification-box -info\">\n    <div class=\"notification-box--content\">\n      <p>\n        {{ text.empty_warning }}\n        <br/>\n        <a *ngIf=\"canManage\"\n           [href]=\"ifcData.manageIFCPath\"\n           target=\"_blank\"\n           [textContent]=\"text.use_this_link_to_manage\">\n        </a>\n      </p>\n    </div>\n  </div>\n\n  <div class=\"ifc-model-viewer--container xeokit-busy-modal-backdrop\">\n    <div *ngIf=\"modelCount && !keyboardEnabled\"\n         class=\"ifc-model-viewer--focus-warning\">\n      <a class=\"ifc-model-viewer--keyboard-disabled-icon icon-no-color icon-input-disabled\"\n         (mousedown)=\"enableFromIcon($event)\"\n         [attr.title]=\"text.keyboard_input_disabled\">\n      </a>\n    </div>\n\n    <div class=\"ifc-model-viewer--toolbar-container\"></div>\n    <canvas #modelCanvas\n            class=\"ifc-model-viewer--model-canvas\"\n            tabindex=\"0\">\n    </canvas>\n  </div>\n\n  <canvas class=\"ifc-model-viewer--nav-cube-canvas\"></canvas>\n</div>","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {IFCViewerService} from \"core-app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.service\";\nimport {IfcModelsDataService} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-models-data.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  selector: 'ifc-viewer',\n  templateUrl: './ifc-viewer.component.html',\n  styleUrls: ['./ifc-viewer.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class IFCViewerComponent implements OnInit, OnDestroy {\n  private viewerUI:any;\n  modelCount:number;\n  canManage = this.ifcData.allowed('manage_ifc_models');\n\n  text = {\n    empty_warning: this.I18n.t('js.ifc_models.empty_warning'),\n    use_this_link_to_manage: this.I18n.t('js.ifc_models.use_this_link_to_manage'),\n    keyboard_input_disabled: this.I18n.t('js.ifc_models.keyboard_input_disabled')\n  };\n\n  keyboardEnabled = false;\n\n  @ViewChild('outerContainer') outerContainer:ElementRef;\n  @ViewChild('modelCanvas') modelCanvas:ElementRef;\n\n  constructor(private I18n:I18nService,\n              private elementRef:ElementRef,\n              public ifcData:IfcModelsDataService,\n              private ifcViewer:IFCViewerService) {\n  }\n\n  ngOnInit():void {\n    this.modelCount = this.ifcData.models.length;\n\n    if (this.modelCount === 0) {\n      return;\n    }\n\n    const element = jQuery(this.elementRef.nativeElement as HTMLElement);\n\n    this.ifcViewer.newViewer(\n      {\n        canvasElement: element.find(\".ifc-model-viewer--model-canvas\")[0], // WebGL canvas\n        explorerElement: jQuery(\".ifc-model-viewer--tree-panel\")[0], // Left panel\n        toolbarElement: element.find(\".ifc-model-viewer--toolbar-container\")[0], // Toolbar\n        navCubeCanvasElement: element.find(\".ifc-model-viewer--nav-cube-canvas\")[0],\n        busyModelBackdropElement: element.find(\".xeokit-busy-modal-backdrop\")[0]\n      },\n      this.ifcData.projects\n    );\n  }\n\n  ngOnDestroy():void {\n    this.ifcViewer.destroy();\n  }\n\n  @HostListener('mousedown')\n  enableKeyBoard() {\n    if (this.modelCount) {\n      this.keyboardEnabled = true;\n      this.ifcViewer.setKeyboardEnabled(true);\n    }\n  }\n\n  @HostListener('window:mousedown', ['$event.target'])\n  disableKeyboard(target:Element) {\n    if (this.modelCount && !this.outerContainer.nativeElement!.contains(target)) {\n      this.keyboardEnabled = false;\n      this.ifcViewer.setKeyboardEnabled(false);\n    }\n  }\n\n  enableFromIcon(event:MouseEvent) {\n    this.enableKeyBoard();\n\n    // Focus on the canvas\n    this.modelCanvas.nativeElement.focus();\n\n    // Ensure we don't bubble this event to the window:mousedown handler\n    // as the target will already be removed from the DOM by angular\n    event.stopImmediatePropagation();\n    return false;\n  }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  template: '<div></div>'\n})\nexport class EmptyComponent {\n}\n","import {StateService} from \"@uirouter/core\";\nimport {CardDblClickHandler} from \"core-components/wp-card-view/event-handler/double-click-handler\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {bimListViewIdentifier, BimViewService} from \"core-app/modules/bim/ifc_models/pages/viewer/bim-view.service\";\n\nexport class BcfDoubleClickHandler extends CardDblClickHandler {\n  @InjectField() state:StateService;\n  @InjectField() bimView:BimViewService;\n\n  protected handleWorkPackage(wpId:string) {\n    if (this.bimView.current === bimListViewIdentifier) {\n      this.state.go('work-packages.show', { workPackageId: wpId });\n    } else {\n      this.state.go('.details', { workPackageId: wpId });\n    }\n  }\n}\n","import {CardClickHandler} from \"core-components/wp-card-view/event-handler/click-handler\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {States} from \"core-components/states.service\";\nimport {IFCViewerService} from \"core-app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.service\";\nimport {BcfApiService} from \"core-app/modules/bim/bcf/api/bcf-api.service\";\nimport {BcfViewpointPaths} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.paths\";\n\nexport class BcfClickHandler extends CardClickHandler {\n  @InjectField() viewer:IFCViewerService;\n  @InjectField() states:States;\n  @InjectField() bcfApi:BcfApiService;\n\n  protected handleWorkPackage(wpId:string, element:JQuery<HTMLElement>, evt:JQuery.TriggeredEvent) {\n    this.setSelection(wpId, element, evt);\n    const wp = this.states.workPackages.get(wpId).value!;\n\n    // Open the viewpoint if any\n    if (this.viewer.viewerVisible() && wp.bcfViewpoints) {\n      this.viewer.showViewpoint(wp, 0);\n    }\n  }\n}","import {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {\n  CardEventHandler,\n  CardViewHandlerRegistry\n} from \"core-components/wp-card-view/event-handler/card-view-handler-registry\";\nimport {BcfDoubleClickHandler} from \"core-app/modules/bim/ifc_models/ifc-base-view/event-handler/bcf-double-click-handler\";\nimport {BcfClickHandler} from \"core-app/modules/bim/ifc_models/ifc-base-view/event-handler/bcf-click-handler\";\nimport {CardRightClickHandler} from \"core-components/wp-card-view/event-handler/right-click-handler\";\n\n\nexport class BcfCardViewHandlerRegistry extends CardViewHandlerRegistry {\n\n  protected eventHandlers:((c:WorkPackageCardViewComponent) => CardEventHandler)[] = [\n    // Clicking on the card (not within a cell)\n    c => new BcfClickHandler(this.injector, c),\n    // Double clicking on the card\n    c => new BcfDoubleClickHandler(this.injector, c),\n    // Right clicking on cards\n    t => new CardRightClickHandler(this.injector, t),\n  ];\n}\n\n","<div class=\"result-overlay\"\n     *ngIf=\"(showResultOverlay$ | async) && showListView\"></div>\n\n<!-- TABLE + TIMELINE horizontal split -->\n<wp-table *ngIf=\"tableInformationLoaded && showListView\"\n          [projectIdentifier]=\"CurrentProject.identifier\"\n          [configuration]=\"wpTableConfiguration\"\n          class=\"work-packages-split-view--tabletimeline-content\"></wp-table>\n\n<!-- GRID representation of the WP -->\n<div *ngIf=\"!showListView\"\n     class=\"work-packages--card-view-container\"\n     [ngClass]=\"{ '-with-resizer': showResizerInCardView() }\" >\n  <wp-grid [configuration]=\"wpTableConfiguration\"\n           [showResizer]=\"showResizerInCardView()\"\n           resizerClass=\"work-packages-partitioned-page--content-right\"\n           resizerStorageKey=\"openProject-splitViewFlexBasis\">\n  </wp-grid>\n</div>\n\n<!-- Footer -->\n<div class=\"work-packages-split-view--tabletimeline-footer hide-when-print\"\n     *ngIf=\"tableInformationLoaded\">\n  <wp-table-pagination></wp-table-pagination>\n</div>\n","import {ChangeDetectionStrategy, Component, OnInit} from \"@angular/core\";\nimport {WorkPackageViewHandlerToken} from \"core-app/modules/work_packages/routing/wp-view-base/event-handling/event-handler-registry\";\nimport {BcfCardViewHandlerRegistry} from \"core-app/modules/bim/ifc_models/ifc-base-view/event-handler/bcf-card-view-handler-registry\";\nimport {WorkPackageListViewComponent} from \"core-app/modules/work_packages/routing/wp-list-view/wp-list-view.component\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {CausedUpdatesService} from \"core-app/modules/boards/board/caused-updates/caused-updates.service\";\nimport {bimSplitViewIdentifier, BimViewService} from \"core-app/modules/bim/ifc_models/pages/viewer/bim-view.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {wpDisplayCardRepresentation} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {IfcModelsDataService} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-models-data.service\";\n\n@Component({\n  templateUrl: '/app/modules/work_packages/routing/wp-list-view/wp-list-view.component.html',\n  styleUrls: ['/app/modules/work_packages/routing/wp-list-view/wp-list-view.component.sass'],\n  providers: [\n    { provide: WorkPackageViewHandlerToken, useValue: BcfCardViewHandlerRegistry },\n    { provide: HalResourceNotificationService, useClass: WorkPackageNotificationService },\n    DragAndDropService,\n    CausedUpdatesService\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class BcfListContainerComponent extends WorkPackageListViewComponent implements OnInit {\n  @InjectField() bimView:BimViewService;\n  @InjectField() ifcModelsService:IfcModelsDataService;\n\n  public wpTableConfiguration = {\n    dragAndDropEnabled: false\n  };\n\n  protected updateViewRepresentation(query:QueryResource) {\n    this.wpDisplayRepresentation.setDisplayRepresentation(wpDisplayCardRepresentation);\n    this.showListView = false;\n  }\n\n  protected showResizerInCardView():boolean {\n    if (this.noResults && this.ifcModelsService.models.length === 0) {\n      return false;\n    } else {\n      return this.bimView.currentViewerState() === bimSplitViewIdentifier;\n    }\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2018 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\nimport {Ng2StateDeclaration} from '@uirouter/angular';\nimport {IFCViewerPageComponent} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-viewer-page.component\";\nimport {IFCViewerComponent} from \"core-app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.component\";\nimport {WorkPackagesBaseComponent} from \"core-app/modules/work_packages/routing/wp-base/wp--base.component\";\nimport {EmptyComponent} from \"core-app/modules/bim/ifc_models/empty/empty-component\";\nimport {makeSplitViewRoutes} from \"core-app/modules/work_packages/routing/split-view-routes.template\";\nimport {BcfListContainerComponent} from \"core-app/modules/bim/ifc_models/bcf/list-container/bcf-list-container.component\";\nimport {WorkPackageSplitViewComponent} from \"core-app/modules/work_packages/routing/wp-split-view/wp-split-view.component\";\n\n\nexport const IFC_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'bim',\n    parent: 'root',\n    url: '/bcf?query_props&models&viewpoint',\n    abstract: true,\n    component: WorkPackagesBaseComponent,\n    redirectTo: 'bim.partitioned.split',\n    params: {\n      // Use custom encoder/decoder that ensures validity of URL string\n      query_props: { type: 'opQueryString', dynamic: true },\n      models: { type: 'opQueryString', dynamic: true },\n      viewpoint: { type: 'int', dynamic: true }\n    }\n  },\n  {\n    name: 'bim.partitioned',\n    url: '',\n    component: IFCViewerPageComponent,\n    redirectTo: 'bim.partitioned.split',\n  },\n  {\n    name: 'bim.partitioned.list',\n    url: '/list',\n    data: {\n      baseRoute: 'bim.partitioned.list',\n      newRoute: 'bim.partitioned.list.new',\n      partition: '-left-only'\n    },\n    reloadOnSearch: false,\n    views: {\n      'content-left': { component: BcfListContainerComponent }\n    }\n  },\n  {\n    name: 'bim.partitioned.split',\n    url: '/split',\n    data: {\n      partition: '-split',\n      baseRoute: 'bim.partitioned.split',\n      newRoute: 'bim.partitioned.split.new',\n      bodyClasses: 'router--work-packages-partitioned-split-view'\n    },\n    reloadOnSearch: false,\n    views: {\n      'content-left': { component: IFCViewerComponent },\n      'content-right': { component: BcfListContainerComponent }\n    }\n  },\n  {\n    name: 'bim.partitioned.model',\n    url: '/model',\n    data: {\n      partition: '-left-only',\n      newRoute: 'bim.partitioned.model.new',\n    },\n    reloadOnSearch: false,\n    views: {\n      // Retarget and by that override the grandparent views\n      // https://ui-router.github.io/guide/views#relative-parent-state{\n      'content-right': { component: EmptyComponent },\n      'content-left': { component: IFCViewerComponent }\n    }\n  },\n  // BCF single view for list\n  ...makeSplitViewRoutes(\n    'bim.partitioned.list',\n    undefined,\n    WorkPackageSplitViewComponent\n  ),\n  // BCF single view for split\n  ...makeSplitViewRoutes(\n    'bim.partitioned.split',\n    undefined,\n    WorkPackageSplitViewComponent\n  ),\n  // BCF single view for model-only\n  ...makeSplitViewRoutes(\n    'bim.partitioned.model',\n    undefined,\n    WorkPackageSplitViewComponent\n  ),\n];\n\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2018 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\nimport {NgModule} from \"@angular/core\";\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\nimport {UIRouterModule} from '@uirouter/angular';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {IFCViewerComponent} from './ifc-viewer/ifc-viewer.component';\nimport {IFC_ROUTES} from \"core-app/modules/bim/ifc_models/openproject-ifc-models.routes\";\nimport {IFCViewerPageComponent} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-viewer-page.component\";\nimport {EmptyComponent} from \"core-app/modules/bim/ifc_models/empty/empty-component\";\nimport {BimViewToggleButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/view-toggle/bim-view-toggle-button.component\";\nimport {BimViewToggleDropdownDirective} from \"core-app/modules/bim/ifc_models/toolbar/view-toggle/bim-view-toggle-dropdown.directive\";\nimport {BimManageIfcModelsButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/manage-ifc-models-button/bim-manage-ifc-models-button.component\";\nimport {IFCViewerService} from \"core-app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.service\";\nimport {OpenprojectFieldsModule} from \"core-app/modules/fields/openproject-fields.module\";\nimport {BCFNewSplitComponent} from \"core-app/modules/bim/ifc_models/bcf/new-split/bcf-new-split.component\";\nimport {BcfListContainerComponent} from \"core-app/modules/bim/ifc_models/bcf/list-container/bcf-list-container.component\";\nimport {OpenprojectHalModule} from \"core-app/modules/hal/openproject-hal.module\";\nimport {BimViewService} from \"core-app/modules/bim/ifc_models/pages/viewer/bim-view.service\";\nimport {IfcModelsDataService} from \"core-app/modules/bim/ifc_models/pages/viewer/ifc-models-data.service\";\nimport {OpenprojectBcfModule} from \"core-app/modules/bim/bcf/openproject-bcf.module\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    OpenprojectFieldsModule,\n    OpenprojectHalModule,\n    OpenprojectBcfModule,\n    OpenprojectWorkPackagesModule,\n    UIRouterModule.forChild({\n      states: IFC_ROUTES\n    })\n  ],\n  providers: [\n    IFCViewerService,\n    BimViewService,\n    IfcModelsDataService\n  ],\n  declarations: [\n    // Pages\n    IFCViewerPageComponent,\n\n    // Regions of pages\n    EmptyComponent,\n    BcfListContainerComponent,\n\n    // Toolbar\n    BimManageIfcModelsButtonComponent,\n    BimViewToggleButtonComponent,\n    BimViewToggleDropdownDirective,\n\n    BCFNewSplitComponent,\n    IFCViewerComponent\n  ]\n})\nexport class OpenprojectIFCModelsModule {\n}\n\n"],"sourceRoot":"webpack:///"}