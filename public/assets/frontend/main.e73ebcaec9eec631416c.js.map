{"version":3,"sources":["./src/app/modules/common/notifications/notifications-container.component.ts","./src/app/components/op-context-menu/handlers/wp-view-dropdown-menu.directive.ts","./src/app/components/wp-edit/work-package-changeset.ts","./src/app/components/wp-list/wp-states-initialization.service.ts","./src/app/components/user/user-link/user-link.component.ts","./src/app/components/wp-edit/wp-edit-field/wp-replacement-label.component.ts","./src/app/components/wp-edit/wp-edit-field/wp-replacement-label.html","./src/app/modules/hal/resources/attachment-collection-resource.ts","./src/app/modules/hal/services/hal-events.service.ts","./src/app/modules/a11y/accessible-by-keyboard.component.ts","./src/app/components/wp-table/table-actions/table-action.ts","./src/app/modules/work_packages/routing/split-view-routes.template.ts","./src/app/modules/bim/bcf/helper/bcf-path-helper.service.ts","./src/app/components/wp-fast-table/builders/relations/relation-row-builder.ts","./src/app/components/wp-fast-table/builders/relations/relations-render-pass.ts","./src/app/components/wp-fast-table/builders/timeline/timeline-render-pass.ts","./src/app/components/wp-fast-table/builders/highlighting/row-highlight-render-pass.ts","./src/app/components/wp-fast-table/builders/drag-and-drop/drag-drop-handle-builder.ts","./src/app/components/wp-fast-table/builders/drag-and-drop/drag-drop-handle-render-pass.ts","./src/app/components/wp-fast-table/builders/primary-render-pass.ts","./src/app/components/wp-fast-table/builders/relation-cell-builder.ts","./src/app/components/wp-activity/activity-link.component.ts","./src/app/modules/hal/dm-services/query-dm.service.ts","./src/app/components/op-context-menu/op-context-menu.types.ts","./src/app/components/wp-table/external-configuration/restricted-wp-table-configuration.service.ts","./src/app/modules/common/link-handling/link-handling.ts","./src/app/modules/a11y/double-click-or-tap.directive.ts","./src/app/modules/hal/dm-services/relations-dm.service.ts","./src/app/components/wp-query/query-filters.service.ts","./src/app/components/op-context-menu/handlers/wp-create-settings-menu.directive.ts","./src/app/modules/work_packages/routing/split-view-routes.helper.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service.ts","./src/app/components/wp-buttons/wp-create-button/wp-create-button.component.ts","./src/app/components/wp-buttons/wp-create-button/wp-create-button.html","./src/app/components/work-packages/work-package-comment/work-package-comment-field-handler.ts","./src/app/modules/common/edit-actions-bar/wp-edit-actions-bar.component.ts","./src/app/modules/common/edit-actions-bar/wp-edit-actions-bar.html","./src/app/modules/common/authoring/authoring.component.ts","./src/app/modules/common/authoring/authoring.html","./src/app/components/work-packages/wp-breadcrumb/wp-breadcrumb.component.ts","./src/app/components/work-packages/wp-breadcrumb/wp-breadcrumb.html","./src/app/modules/attachments/attachments-upload/attachments-upload.component.ts","./src/app/modules/attachments/attachments-upload/attachments-upload.html","./src/app/modules/fields/edit/field-controls/edit-field-controls.component.ts","./src/app/modules/fields/edit/field-controls/edit-field-controls.component.html","./src/app/modules/bim/bcf/api/bcf-path-resources.ts","./src/app/modules/bim/bcf/api/bcf-api-request.service.ts","./src/app/modules/bim/bcf/api/projects/bcf-project.resource.ts","./src/app/modules/bim/bcf/api/topics/bcf-topic.resource.ts","./src/app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.paths.ts","./src/app/modules/bim/bcf/api/viewpoints/bcf-viewpoint-collection.paths.ts","./src/app/modules/bim/bcf/api/topics/bcf-topic.paths.ts","./src/app/modules/bim/bcf/api/topics/bcf-viewpoint-collection.paths.ts","./src/app/modules/bim/bcf/api/extensions/bcf-extension.resource.ts","./src/app/modules/bim/bcf/api/extensions/bcf-extension.paths.ts","./src/app/modules/bim/bcf/api/projects/bcf-project.paths.ts","./src/app/modules/bim/bcf/api/bcf-api.service.ts","./src/app/components/user/user-avatar/user-avatar-renderer.service.ts","./src/app/components/angular/tracking-functions.ts","./src/app/components/wp-single-view-tabs/activity-panel/activity-on-overview.component.ts","./src/app/components/wp-single-view-tabs/activity-panel/activity-on-overview.html","./src/app/components/wp-copy/wp-copy-split-view.component.ts","./src/app/components/wp-new/wp-new-split-view.html","./src/app/components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.directive.ts","./src/app/components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.template.html","./src/app/components/wp-table/timeline/wp-timeline.ts","./src/app/components/op-context-menu/op-context-menu.service.ts","./src/app/components/wp-new/wp-create.service.ts","./src/app/components/wp-fast-table/builders/modes/rows-builder.ts","./src/app/modules/fields/display/display-field.module.ts","./src/app/components/wp-single-view-tabs/activity-panel/activity-base.controller.ts","./src/app/components/wp-fast-table/helpers/wp-table-row-helpers.ts","./src/app/modules/fields/edit/editing-portal/edit-form-portal.injector.ts","./src/app/components/filters/abstract-filter-date-time-value/abstract-filter-date-time-value.controller.ts","./src/app/components/wp-fast-table/builders/modes/hierarchy/hierarchy-render-pass.ts","./src/app/components/wp-fast-table/builders/modes/hierarchy/hierarchy-rows-builder.ts","./src/app/components/wp-fast-table/builders/modes/plain/plain-rows-builder.ts","./src/app/components/wp-edit-form/table-edit-form.ts","./src/app/components/wp-fast-table/wp-table-editing.ts","./src/app/components/wp-fast-table/wp-fast-table.ts","./src/app/modules/hal/dm-services/work-package-dm.service.ts","./src/app/components/modals/modal-wrapper/dynamic-content.modal.ts","./src/app/components/modals/modal-wrapper/dynamic-content.modal.html","./src/app/modules/common/ckeditor/ckeditor-setup.service.ts","./src/app/modules/fields/edit/edit-field.service.ts","./src/app/components/wp-query-select/wp-query-select-dropdown.component.ts","./src/app/components/wp-query-select/wp-query-select.template.html","./src/app/components/wp-table/wp-table-scroll-sync.ts","./src/app/modules/attachments/attachment-list/attachment-list-item.html","./src/app/modules/attachments/attachment-list/attachment-list-item.component.ts","./src/app/modules/attachments/attachment-list/attachment-list.html","./src/app/modules/attachments/attachment-list/attachment-list.component.ts","./src/app/modules/fields/display/field-types/highlightable-display-field.module.ts","./src/app/components/wp-relations/wp-relations-create/wp-relations-create.component.ts","./src/app/components/wp-relations/wp-relations-create/wp-relation-create.template.html","./src/app/components/filters/filter-date-time-value/filter-date-time-value.component.ts","./src/app/components/filters/filter-date-time-value/filter-date-time-value.component.html","./src/app/components/wp-card-view/event-handler/click-handler.ts","./src/app/components/wp-fast-table/builders/table-action-renderer.ts","./src/app/components/wp-fast-table/builders/rows/single-row-builder.ts","./src/app/components/wp-inline-create/inline-create-row-builder.ts","./src/app/components/wp-inline-create/wp-inline-create.component.html","./src/app/components/wp-inline-create/wp-inline-create.component.ts","./src/app/modules/hal/dm-services/payload-dm.service.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service.ts","./src/app/components/filters/query-filters/query-filters.component.ts","./src/app/components/filters/query-filters/query-filters.component.html","./src/app/modules/fields/edit/edit-form/edit-form.component.ts","./src/app/components/filters/filter-date-value/filter-date-value.component.ts","./src/app/components/filters/filter-date-value/filter-date-value.component.html","./src/app/components/wp-table/embedded/wp-embedded-base.component.ts","./src/app/components/wp-table/embedded/wp-embedded-table.html","./src/app/components/wp-table/embedded/wp-embedded-table.component.ts","./src/app/modules/fields/edit/editing-portal/edit-form-portal.component.ts","./src/app/modules/fields/edit/editing-portal/edit-form-portal.component.html","./src/app/modules/common/focus/focus-helper.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy-indentation.service.ts","./src/app/components/work-packages/wp-watcher-button/wp-watcher-button.component.ts","./src/app/components/work-packages/wp-watcher-button/wp-watcher-button.html","./src/app/helpers/selection-helpers.ts","./src/app/modules/fields/edit/field/editable-attribute-field.component.ts","./src/app/modules/fields/edit/field/editable-attribute-field.component.html","./src/app/components/wp-card-view/services/wp-card-drag-and-drop.service.ts","./src/app/helpers/dom/set-window-cursor.helper.ts","./src/app/modules/hal/resources/schema-resource.ts","./src/app/modules/hal/resources/type-resource.ts","./src/app/modules/hal/resources/schema-dependency-resource.ts","./src/app/modules/hal/resources/wp-collection-resource.ts","./src/app/modules/hal/resources/form-resource.ts","./src/app/modules/hal/resources/query-filter-instance-schema-resource.ts","./src/app/modules/hal/resources/root-resource.ts","./src/app/modules/hal/resources/query-operator-resource.ts","./src/app/modules/hal/resources/help-text-resource.ts","./src/app/modules/hal/resources/wiki-page-resource.ts","./src/app/modules/hal/resources/meeting-content-resource.ts","./src/app/modules/hal/resources/post-resource.ts","./src/app/modules/hal/resources/status-resource.ts","./src/app/modules/hal/resources/news-resource.ts","./src/app/modules/hal/resources/membership-resource.ts","./src/app/modules/hal/resources/role-resource.ts","./src/app/modules/hal/resources/project-resource.ts","./src/app/modules/hal/resources/group-resource.ts","./src/app/modules/hal/services/hal-resource.config.ts","./src/app/modules/hal/dm-services/type-dm.service.ts","./src/app/modules/hal/services/hal-aware-error-handler.ts","./src/app/modules/hal/openproject-hal.module.ts","./src/app/components/op-context-menu/handlers/op-types-context-menu.directive.ts","./src/app/components/modals/confirm-dialog/confirm-dialog.modal.ts","./src/app/components/modals/confirm-dialog/confirm-dialog.modal.html","./src/app/modules/a11y/openproject-a11y.module.ts","./src/app/modules/common/no-results/no-results.component.html","./src/app/modules/common/no-results/no-results.component.ts","./src/app/components/wp-fast-table/builders/modes/grouped/group-header-builder.ts","./src/app/components/wp-fast-table/builders/modes/grouped/grouped-render-pass.ts","./src/app/components/wp-fast-table/builders/modes/grouped/grouped-rows-builder.ts","./src/app/modules/fields/field.service.ts","./src/app/modules/common/config/configuration.service.ts","./src/app/components/op-context-menu/op-context-menu-handler.ts","./src/app/modules/common/drag-and-drop/drag-and-drop.helpers.ts","./src/app/modules/hal/dm-services/root-dm.service.ts","./src/app/components/wp-fast-table/handlers/cell/edit-cell-handler.ts","./src/app/components/wp-fast-table/handlers/cell/relations-cell-handler.ts","./src/app/components/op-context-menu/wp-context-menu/wp-table-context-menu.directive.ts","./src/app/components/wp-fast-table/handlers/context-menu/context-menu-handler.ts","./src/app/components/wp-fast-table/handlers/context-menu/context-menu-click-handler.ts","./src/app/components/wp-fast-table/handlers/context-menu/context-menu-keyboard-handler.ts","./src/app/components/wp-fast-table/handlers/context-menu/context-menu-rightclick-handler.ts","./src/app/components/wp-fast-table/handlers/row/click-handler.ts","./src/app/components/wp-fast-table/handlers/row/double-click-handler.ts","./src/app/components/wp-fast-table/handlers/row/group-row-handler.ts","./src/app/components/wp-fast-table/handlers/row/hierarchy-click-handler.ts","./src/app/components/wp-fast-table/handlers/row/wp-state-links-handler.ts","./src/app/components/wp-fast-table/handlers/state/columns-transformer.ts","./src/app/components/wp-fast-table/handlers/state/hierarchy-transformer.ts","./src/app/components/wp-fast-table/handlers/state/relations-transformer.ts","./src/app/components/wp-fast-table/handlers/state/rows-transformer.ts","./src/app/components/wp-fast-table/handlers/state/selection-transformer.ts","./src/app/components/wp-fast-table/handlers/state/timeline-transformer.ts","./src/app/components/wp-fast-table/handlers/state/highlighting-transformer.ts","./src/app/components/wp-fast-table/handlers/state/drag-and-drop-transformer.ts","./src/app/components/wp-fast-table/handlers/table-handler-registry.ts","./src/app/components/wp-table/wp-table-hover-sync.ts","./src/app/components/wp-table/wp-table.directive.html","./src/app/components/wp-table/wp-table.directive.ts","./src/app/components/wp-fast-table/builders/timeline/timeline-row-builder.ts","./src/app/components/work-packages/work-package-comment/wp-comment-field.component.ts","./src/app/components/work-packages/wp-relations-count/wp-watchers-count.component.ts","./src/app/components/work-packages/wp-relations-count/wp-relations-count.html","./src/app/modules/fields/edit/edit-form/edit-form-routing.service.ts","./src/app/modules/hal/resources/query-filter-instance-resource.ts","./src/app/modules/boards/board/board-actions/board-actions-registry.service.ts","./src/app/components/work-packages/work-package.service.ts","./src/app/helpers/angular/until-destroyed.mixin.ts","./src/app/components/wp-table/configuration-modal/wp-table-configuration-relation-selector.ts","./src/app/components/wp-table/configuration-modal/wp-table-configuration-relation-selector.html","./src/app/components/op-context-menu/icon-triggered-context-menu/icon-triggered-context-menu.component.ts","./src/app/components/op-context-menu/icon-triggered-context-menu/icon-triggered-context-menu.component.html","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service.ts","./src/environments/environment.ts","./src/app/modules/hal/resources/query-resource.ts","./src/app/components/wp-relations/wp-relations-group/wp-relations-group.component.ts","./src/app/components/wp-relations/wp-relations-group/wp-relations-group.template.html","./src/app/components/wp-buttons/wp-details-view-button/wp-details-view-button.component.ts","./src/app/components/wp-buttons/wp-button.template.html","./src/app/modules/hal/hal-link/hal-link.ts","./src/app/modules/boards/board/board.ts","./src/app/modules/common/focus/contain-helpers.ts","./src/app/components/wp-fast-table/helpers/wp-table-hierarchy-helpers.ts","./src/app/components/wp-table/external-configuration/external-relation-query-configuration.service.ts","./src/app/modules/common/editable-toolbar-title/editable-toolbar-title.html","./src/app/modules/common/editable-toolbar-title/editable-toolbar-title.component.ts","./src/app/components/wp-table/embedded/wp-embedded-table-entry.component.ts","./src/app/modules/common/help-texts/attribute-help-text.component.ts","./src/app/modules/common/help-texts/attribute-help-text.component.html","./src/app/modules/boards/board/board-dm.service.ts","./src/app/modules/grids/widgets/widget-changeset.ts","./src/app/modules/grids/widgets/abstract-widget.component.ts","./src/app/modules/hal/dm-services/news-dm.service.ts","./src/app/modules/common/gon/gon.service.ts","./src/app/modules/common/back-routing/back-button.component.ts","./src/app/modules/hal/dm-services/status-dm.service.ts","./src/app/components/wp-list/wp-list.service.ts","./src/app/components/filters/filter-dates-value/filter-dates-value.component.ts","./src/app/components/filters/filter-dates-value/filter-dates-value.component.html","./src/app/modules/work_packages/routing/wp-view-base/work-packages-view.base.ts","./src/app/components/modals/confirm-dialog/confirm-dialog.service.ts","./src/app/globals/dynamic-bootstrapper.ts","./src/app/components/wp-query/query-param-listener.service.ts","./src/app/modules/work_packages/query-space/isolated-query-space.ts","./src/app/modules/common/keyCodes.enum.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service.ts","./src/app/components/work-packages/wp-breadcrumb/wp-breadcrumb-parent.component.ts","./src/app/components/work-packages/wp-breadcrumb/wp-breadcrumb-parent.html","./src/app/components/wp-buttons/wp-settings-button/wp-settings-button.component.ts","./src/app/components/wp-buttons/wp-settings-button/wp-settings-button.component.html","./src/app/components/modals/export-modal/wp-table-export.modal.ts","./src/app/components/modals/export-modal/wp-table-export.modal.html","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service.ts","./src/app/components/wp-inline-create/wp-inline-create.service.ts","./src/app/components/op-context-menu/handlers/op-settings-dropdown-menu.directive.ts","./src/app/components/wp-fast-table/builders/internal-sort-columns.ts","./src/app/init-vendors.ts","./src/app/modules/common/ckeditor/ckeditor-preview.service.ts","./src/app/modules/projects/openproject-projects.module.ts","./src/app/modules/common/set-click-position/set-click-position.ts","./src/app/modules/fields/changeset/changeset.ts","./src/app/modules/fields/changeset/resource-changeset.ts","./src/app/modules/hal/dm-services/query-order-dm.service.ts","./src/app/components/wp-table/configuration-modal/tab-portal-outlet.ts","./src/app/modules/work_packages/query-space/wp-isolated-query-space.directive.ts","./src/app/modules/hal/http/openproject-header-interceptor.ts","./src/app/modules/common/highlight-col/highlight-col.directive.ts","./src/app/modules/common/autocomplete/user-autocompleter.component.ts","./src/app/modules/common/autocomplete/user-autocompleter.component.html","./src/app/components/op-modals/op-modal.service.ts","./src/app/modules/fields/edit/field-handler/hal-resource-edit-field-handler.ts","./src/app/modules/fields/edit/editing-portal/editing-portal-service.ts","./src/app/components/wp-table/external-configuration/external-relation-query-configuration.component.ts","./src/app/components/wp-table/external-configuration/external-query-configuration.template.html","./src/app/modules/fields/display/display-field.service.ts","./src/app/modules/common/path-helper/apiv3/path-resources.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service.ts","./src/app/modules/common/path-helper/apiv3/work_packages/apiv3-work-package-paths.ts","./src/app/modules/common/path-helper/apiv3/work_packages/apiv3-work-packages-paths.ts","./src/app/modules/common/path-helper/apiv3/users/apiv3-user-paths.ts","./src/app/modules/common/path-helper/apiv3/users/apiv3-users-paths.ts","./src/app/modules/common/path-helper/apiv3/queries/apiv3-query-paths.ts","./src/app/modules/common/path-helper/apiv3/queries/apiv3-queries-paths.ts","./src/app/modules/common/path-helper/apiv3/types/apiv3-types-paths.ts","./src/app/modules/common/path-helper/apiv3/versions/apiv3-version-paths.ts","./src/app/modules/common/path-helper/apiv3/projects/apiv3-project-paths.ts","./src/app/modules/common/path-helper/apiv3/projects/apiv3-projects-paths.ts","./src/app/modules/common/path-helper/apiv3/grids/apiv3-grid-paths.ts","./src/app/modules/common/path-helper/apiv3/grids/apiv3-grids-paths.ts","./src/app/modules/common/path-helper/apiv3/news/apiv3-news-paths.ts","./src/app/modules/common/path-helper/apiv3/news/apiv3-newses-paths.ts","./src/app/modules/common/path-helper/apiv3/time-entries/apiv3-time-entry-paths.ts","./src/app/modules/common/path-helper/apiv3/time-entries/apiv3-time-entries-paths.ts","./src/app/modules/common/path-helper/apiv3/memberships/apiv3-memberships-paths.ts","./src/app/modules/common/path-helper/apiv3/groups/apiv3-groups-path.ts","./src/app/modules/common/path-helper/apiv3/apiv3-paths.ts","./src/app/modules/common/path-helper/path-helper.service.ts","./src/app/components/main-menu/main-menu-navigation.service.ts","./src/app/modules/common/browser/device.service.ts","./src/app/components/wp-buttons/wp-status-button/wp-status-button.component.ts","./src/app/components/wp-buttons/wp-status-button/wp-status-button.html","./src/app/modules/common/model-auth/model-auth.service.ts","./src/app/components/wp-fast-table/builders/modes/plain/plain-render-pass.ts","./src/app/modules/hal/resources/mixins/attachable-mixin.ts","./src/app/modules/fields/field.base.ts","./src/app/components/wp-relations/wp-relations-create/wp-relations-autocomplete/wp-relations-autocomplete.component.ts","./src/app/components/wp-relations/wp-relations-create/wp-relations-autocomplete/wp-relations-autocomplete.html","./src/app/modules/hal/resources/hal-resource.ts","./src/app/modules/common/icon/op-icon.ts","./src/app/components/projects/project-cache.service.ts","./src/app/modules/hal/resources/relation-resource.ts","./src/app/modules/fields/display/field-types/multiple-lines-string-objects-display-field.module.ts","./src/app/modules/fields/display/field-types/progress-text-display-field.module.ts","./src/app/modules/fields/display/field-types/multiple-lines-user-display-field.module.ts","./src/app/modules/fields/display/field-types/combined-date-display.field.ts","./src/app/components/wp-edit-form/display-field-renderer.ts","./src/app/components/filters/query-filter/query-filter.component.ts","./src/app/components/filters/query-filter/query-filter.component.html","./src/app/modules/hal/services/url-params-encoder.ts","./src/app/modules/hal/resources/version-resource.ts","./src/app/components/wp-copy/wp-copy.controller.ts","./src/app/modules/fields/display/field-types/progress-display-field.module.ts","./src/app/components/wp-single-view-tabs/activity-panel/activity-tab.component.ts","./src/app/components/wp-single-view-tabs/activity-panel/activity-tab.html","./src/app/modules/hal/dm-services/query-form-dm.service.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-additional-elements.service.ts","./src/app/modules/common/drag-and-drop/dom-autoscroll.service.ts","./src/app/components/filters/filter-toggled-multiselect-value/filter-toggled-multiselect-value.component.ts","./src/app/components/filters/filter-toggled-multiselect-value/filter-toggled-multiselect-value.component.html","./src/app/components/work-packages/work-package-authorization.service.ts","./src/app/components/op-context-menu/wp-context-menu/wp-single-context-menu.ts","./src/app/modules/common/op-date-picker/datepicker.ts","./src/app/modules/hal/resources/grid-widget-resource.ts","./src/app/modules/hal/services/hal-resource-notification.service.ts","./src/app/modules/hal/dm-services/membership-dm.service.ts","./src/app/components/op-context-menu/handlers/op-context-menu-trigger.directive.ts","./src/app/modules/hal/helpers/lazy-accessor.ts","./src/app/modules/hal/helpers/hal-resource-builder.ts","./src/app/components/wp-single-view-tabs/keep-tab/keep-tab.service.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service.ts","./src/app/modules/common/colors/colors.service.ts","./src/app/modules/work_packages/routing/wp-split-view/wp-split-view.component.ts","./src/app/modules/work_packages/routing/wp-split-view/wp-split-view.html","./src/app/components/filters/quick-filter-by-text-input/quick-filter-by-text-input.component.ts","./src/app/components/filters/quick-filter-by-text-input/quick-filter-by-text-input.html","./src/app/modules/fields/display/field-types/resources-display-field.module.ts","./src/app/components/wp-table/context-menu-helper/wp-context-menu-helper.service.ts","./src/app/components/wp-query/query-column.ts","./src/app/modules/common/date/op-date-time.component.ts","./src/app/globals/constants.const.ts","./src/app/helpers/random-string.ts","./src/app/components/wp-fast-table/builders/highlighting/highlighting.functions.ts","./src/app/modules/common/autofocus/autofocus.directive.ts","./src/app/modules/hal/resources/custom-action-resource.ts","./src/app/components/api/api-v3/api-v3-filter-builder.ts","./src/app/components/wp-relations/embedded/wp-relation-query.base.ts","./node_modules/moment/locale sync ^\\.\\/.*$","./src/app/components/wp-activity/comment-service.ts","./src/app/components/work-packages/wp-relations-count/wp-relations-count.component.ts","./src/app/components/wp-card-view/wp-single-card/wp-single-card.component.ts","./src/app/components/wp-card-view/wp-single-card/wp-single-card.component.html","./src/app/components/wp-card-view/event-handler/double-click-handler.ts","./src/app/modules/fields/edit/services/hal-resource-editing.service.ts","./src/app/globals/tree-menu.ts","./src/app/components/filters/filter-date-times-value/filter-date-times-value.component.ts","./src/app/components/filters/filter-date-times-value/filter-date-times-value.component.html","./src/app/components/op-modals/op-modal.component.ts","./src/app/components/main-menu/main-menu-toggle.service.ts","./src/app/components/wp-fast-table/builders/modes/grouped/grouped-rows-helpers.ts","./src/app/components/filters/filter-boolean-value/filter-boolean-value.component.ts","./src/app/components/filters/filter-boolean-value/filter-boolean-value.component.html","./node_modules/codemirror/mode lazy ^\\.\\/.*\\/.*\\.js$ namespace object","./src/app/components/op-context-menu/wp-context-menu/wp-static-context-menu-actions.ts","./src/app/modules/hal/dm-services/user-dm.service.ts","./src/app/components/modals/editor/macro-wiki-include-page-modal/wiki-include-page-macro.modal.html","./src/app/components/modals/editor/macro-wiki-include-page-modal/wiki-include-page-macro.modal.ts","./src/app/components/modals/editor/macro-code-block-modal/code-block-macro.modal.html","./src/app/components/modals/editor/macro-code-block-modal/code-block-macro.modal.ts","./src/app/components/modals/editor/macro-child-pages-modal/child-pages-macro.modal.html","./src/app/components/modals/editor/macro-child-pages-modal/child-pages-macro.modal.ts","./src/app/components/modals/editor/editor-macros.service.ts","./src/app/components/wp-activity/activity-entry.component.ts","./src/app/components/wp-activity/activity-entry.component.html","./src/app/components/modals/editor/macro-wp-button-modal/wp-button-macro.modal.ts","./src/app/components/modals/editor/macro-wp-button-modal/wp-button-macro.modal.html","./src/app/components/table-pagination/pagination-instance.ts","./src/app/components/wp-table/wp-table-configuration.ts","./src/app/components/states/state-cache.service.ts","./src/app/components/modals/wp-destroy-modal/wp-destroy.modal.ts","./src/app/components/modals/wp-destroy-modal/wp-destroy.modal.html","./src/app/modules/hal/dm-services/help-text-dm.service.ts","./src/app/components/wp-table/configuration-modal/tabs/display-settings-tab.component.ts","./src/app/components/wp-table/configuration-modal/tabs/display-settings-tab.component.html","./src/app/modules/common/drag-and-drop/reorder-delta-builder.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service.ts","./src/app/modules/fields/edit/edit-field.component.ts","./src/app/components/wp-single-view-tabs/watchers-tab/wp-watchers.service.ts","./src/app/modules/fields/edit/field-types/formattable-edit-field.component.ts","./src/app/components/modals/save-modal/save-query.modal.ts","./src/app/components/modals/save-modal/save-query.modal.html","./src/app/modules/hal/dm-services/version-dm.service.ts","./src/app/components/wp-copy/wp-copy-full-view.component.ts","./src/app/components/wp-new/wp-new-full-view.html","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service.ts","./src/app/components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service.ts","./src/app/components/wp-form-group/wp-attribute-group.template.html","./src/app/components/wp-form-group/wp-attribute-group.component.ts","./src/app/components/wp-table/timeline/cells/wp-timeline-cell-mouse-handler.ts","./src/app/components/wp-table/timeline/cells/wp-timeline-cell.ts","./src/app/components/wp-table/timeline/cells/timeline-cell-renderer.ts","./src/app/components/wp-table/timeline/cells/timeline-milestone-cell-renderer.ts","./src/app/components/wp-table/timeline/cells/wp-timeline-cells-renderer.ts","./src/app/components/wp-table/timeline/container/wp-timeline-container.directive.ts","./src/app/components/wp-table/timeline/container/wp-timeline-container.html","./src/app/components/op-context-menu/handlers/op-columns-context-menu.directive.ts","./src/app/components/wp-table/timeline/header/wp-timeline-header.directive.ts","./src/app/components/wp-table/timeline/header/wp-timeline-header.html","./src/app/components/wp-table/timeline/global-elements/timeline-relation-element.ts","./src/app/components/wp-table/timeline/global-elements/wp-timeline-relations.directive.ts","./src/app/components/wp-table/timeline/global-elements/wp-timeline.today-line.ts","./src/app/components/wp-table/timeline/global-elements/timeline-static-element.ts","./src/app/components/wp-table/timeline/global-elements/wp-timeline-static-elements.directive.ts","./src/app/components/wp-table/timeline/grid/wp-timeline-grid.directive.ts","./src/app/components/wp-single-view-tabs/watchers-tab/wp-watcher-entry.component.ts","./src/app/components/wp-single-view-tabs/watchers-tab/wp-watcher-entry.html","./src/app/components/wp-table/wp-table-sums-row/wp-table-sums-row.directive.ts","./src/app/components/wp-relations/embedded/wp-relation-query.html","./src/app/components/wp-relations/embedded/relations/wp-relation-query.component.ts","./src/app/components/wp-table/config-menu/config-menu.component.ts","./src/app/components/wp-table/config-menu/config-menu.template.html","./src/app/components/time-entries/time-entry-changeset.ts","./src/app/modules/work_packages/openproject-work-packages.module.ts","./src/app/components/wp-list/wp-list-checksum.service.ts","./src/app/modules/work_packages/routing/wp-view-base/event-handling/event-handler-registry.ts","./src/app/components/wp-card-view/services/wp-card-view.service.ts","./src/app/components/wp-card-view/event-handler/card-view-handler-registry.ts","./src/app/components/wp-table/external-configuration/external-query-configuration.component.ts","./src/app/modules/boards/board/board-cache.service.ts","./src/app/components/wp-activity/user/user-activity.component.html","./src/app/components/wp-activity/user/user-activity.component.ts","./src/app/components/wp-table/sort-header/sort-header.directive.ts","./src/app/components/wp-table/sort-header/sort-header.directive.html","./src/app/modules/boards/board/board.service.ts","./src/app/components/work-packages/wp-type-status/wp-type-status.component.ts","./src/app/components/work-packages/wp-type-status/wp-type-status.html","./src/app/modules/hal/resources/error-resource.ts","./src/app/modules/hal/dm-services/configuration-dm.service.ts","./src/app/components/wp-buttons/wp-view-toggle-button/work-package-view-toggle-button.component.ts","./src/app/modules/editor/openproject-editor.module.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service.ts","./src/app/modules/common/loading-indicator/loading-indicator.service.ts","./src/app/components/angular/debounced-event-emitter.ts","./src/app/modules/common/help-texts/attribute-help-text.modal.ts","./src/app/modules/common/help-texts/help-text.modal.html","./src/app/components/wp-table/configuration-modal/tabs/sort-by-tab.component.ts","./src/app/components/wp-table/configuration-modal/tabs/sort-by-tab.component.html","./src/app/components/wp-relations/embedded/relations/wp-relation-inline-create.service.ts","./src/app/modules/work_packages/routing/wp-edit-form/wp-edit-form-routing.service.ts","./src/app/modules/work_packages/routing/wp-base/wp--base.component.ts","./src/app/components/wp-fast-table/handlers/click-or-enter-handler.ts","./src/app/modules/hal/dm-services/project-dm.service.ts","./src/app/components/work-packages/wp-subject/wp-subject.component.ts","./src/app/components/work-packages/wp-subject/wp-subject.html","./src/app/components/wp-new/wp-new-split-view.component.ts","./src/app/modules/work_packages/query-space/isolated-graph-query-space.ts","./src/app/modules/work_packages/query-space/wp-isolated-graph-query-space.directive.ts","./src/app/modules/time_entries/form/form.component.ts","./src/app/modules/time_entries/form/form.component.html","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-table-pagination.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service.ts","./src/app/components/api/op-file-upload/op-file-upload.service.ts","./src/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.html","./src/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.ts","./src/app/components/filters/filter-integer-value/filter-integer-value.component.ts","./src/app/components/filters/filter-integer-value/filter-integer-value.component.html","./src/app/components/work-packages/wp-single-view/wp-single-view.component.ts","./src/app/components/work-packages/wp-single-view/wp-single-view.html","./src/app/modules/fields/display/field-types/date-display-field.module.ts","./src/app/init-globals.ts","./src/app/modules/common/browser/browser-detector.service.ts","./src/app/components/wp-table/configuration-modal/tabs/filters-tab.component.ts","./src/app/components/wp-table/configuration-modal/tabs/filters-tab.component.html","./src/app/modules/common/notifications/notification.component.ts","./src/app/modules/common/notifications/notification.component.html","./src/vendor/i18n.js-exposed","./src/app/components/wp-fast-table/builders/ui-state-link-builder.ts","./src/app/modules/hal/dm-services/abstract-dm.service.ts","./src/$_lazy_route_resource lazy namespace object","./src/app/modules/common/notifications/notifications.service.ts","./src/app/modules/hal/resources/query-filter-resource.ts","./src/app/components/schemas/schema-cache.service.ts","./src/app/components/html/op-title.service.ts","./src/app/modules/fields/edit/edit-form/edit-form.ts","./src/vendor/i18n.js","./src/app/components/wp-grid/wp-grid.component.ts","./src/app/components/filters/filter-container/filter-container.directive.ts","./src/app/components/filters/filter-container/filter-container.directive.html","./src/app/modules/common/op-date-picker/op-date-picker.component.ts","./src/app/modules/common/op-date-picker/op-date-picker.component.html","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service.ts","./src/app/components/resizer/wp-resizer.component.ts","./src/app/components/wp-relations/embedded/children/wp-children-inline-create.service.ts","./src/app/components/wp-edit-form/work-package-filter-values.ts","./src/app/modules/common/enterprise/banners.service.ts","./src/app/modules/work_packages/routing/wp-list-view/wp-list-view.component.ts","./src/app/modules/work_packages/routing/wp-list-view/wp-list-view.component.html","./src/app/ckeditor/ckeditor-augmented-textarea.component.ts","./src/app/ckeditor/ckeditor-augmented-textarea.html","./src/app/modules/plugins/hook-service.ts","./src/app/modules/common/autocomplete/wp-autocompleter.component.ts","./src/app/modules/common/autocomplete/create-autocompleter.component.html","./src/app/components/wp-single-view-tabs/overview-tab/overview-tab.component.ts","./src/app/components/wp-single-view-tabs/overview-tab/overview-tab.html","./src/app/components/wp-single-view-tabs/wp-linked-resource-cache.service.ts","./src/app/components/wp-table/configuration-modal/tabs/timelines-tab.component.ts","./src/app/components/wp-table/configuration-modal/tabs/timelines-tab.component.html","./src/app/components/wp-table/external-configuration/external-query-configuration.constants.ts","./src/app/components/wp-card-view/wp-card-view.component.html","./src/app/components/wp-card-view/wp-card-view.component.ts","./src/app/modules/hal/resources/collection-resource.ts","./src/app/modules/work_packages/routing/wp-view-page/wp-view-page.component.ts","./src/app/components/wp-relations/embedded/inline/add-existing/wp-relation-inline-add-existing.component.ts","./src/app/components/wp-relations/embedded/inline/add-existing/wp-relation-inline-add-existing.component.html","./src/app/modules/hal/services/hal-resource-sorting.service.ts","./src/app/components/states.service.ts","./src/app/modules/hal/resources/work-package-resource.ts","./src/app/modules/common/autocomplete/te-work-package-autocompleter.component.ts","./src/app/modules/common/autocomplete/te-work-package-autocompleter.component.html","./src/app/helpers/rxjs/debounced-input-switchmap.ts","./src/app/modules/hal/dm-services/time-entry-dm.service.ts","./src/app/modules/attachments/attachments.component.ts","./src/app/modules/attachments/attachments.html","./src/app/modules/common/draggable-autocomplete/draggable-autocomplete.component.ts","./src/app/modules/common/draggable-autocomplete/draggable-autocomplete.component.html","./src/app/modules/bim/ifc_models/xeokit/xeokit-server.js","./src/app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.service.ts","./src/app/components/datetime/timezone.service.ts","./src/app/components/modals/share-modal/query-sharing-form.component.ts","./src/app/components/modals/share-modal/query-sharing-form.html","./src/app/modules/common/ckeditor/op-ckeditor.component.ts","./src/app/modules/common/ckeditor/op-ckeditor.html","./src/app/components/wp-query-select/wp-static-queries.service.ts","./src/app/modules/hal/services/hal-resource.service.ts","./src/app/components/wp-custom-actions/wp-custom-actions/wp-custom-action.component.ts","./src/app/components/wp-custom-actions/wp-custom-actions/wp-custom-action.component.html","./src/app/components/wp-new/wp-new-full-view.component.ts","./src/app/modules/fields/edit/editing-portal/edit-field-handler.ts","./src/app/modules/a11y/accessible-click.directive.ts","./src/app/components/table-pagination/pagination-service.ts","./src/app/components/filters/wp-filters/wp-filters.service.ts","./src/app/components/wp-list/wp-list-invalid-query.service.ts","./src/app/components/wp-custom-actions/wp-custom-actions.component.ts","./src/app/components/wp-custom-actions/wp-custom-actions.component.html","./src/app/helpers/op-icon-builder.ts","./src/app/components/op-context-menu/op-context-menu.component.ts","./src/app/components/op-context-menu/op-context-menu.html","./src/app/modules/bim/bcf/bcf-viewer-bridge/viewer-bridge.service.ts","./src/app/components/wp-table/table-pagination/wp-table-pagination.component.ts","./src/app/components/table-pagination/table-pagination.component.html","./src/app/modules/common/notifications/upload-progress.component.ts","./src/app/components/wp-relations/wp-relations.component.ts","./src/app/components/wp-relations/wp-relations.template.html","./src/app/components/wp-details/wp-details-toolbar.component.ts","./src/app/components/wp-details/wp-details-toolbar.html","./src/app/components/wp-single-view-tabs/activity-panel/activity-entry-info.ts","./src/app/components/wp-single-view-tabs/activity-panel/wp-activity.service.ts","./src/app/components/table-pagination/table-pagination.component.ts","./src/app/modules/bim/bcf/helper/viewpoints.service.ts","./src/app/modules/common/autocomplete/version-autocompleter.component.ts","./src/app/modules/hal/dm-services/grid-dm.service.ts","./src/app/components/wp-fast-table/builders/modes/grouped/grouped-classes.constants.ts","./src/app/components/user/user-cache.service.ts","./src/app/modules/common/help-texts/attribute-help-text.service.ts","./src/app/components/wp-table/external-configuration/external-query-configuration.service.ts","./src/app/components/wp-activity/revision/revision-activity.component.ts","./src/app/components/wp-activity/revision/revision-activity.component.html","./src/app/modules/fields/edit/field-types/text-edit-field.component.ts","./src/app/modules/fields/edit/field-types/text-edit-field.component.html","./src/app/modules/fields/edit/field-types/integer-edit-field.component.ts","./src/app/modules/fields/edit/field-types/duration-edit-field.component.ts","./src/app/modules/fields/edit/field-types/select-autocompleter-register.service.ts","./src/app/modules/fields/edit/field-types/select-edit-field.component.ts","./src/app/modules/fields/edit/field-types/select-edit-field.component.html","./src/app/modules/fields/edit/field-types/multi-select-edit-field.component.html","./src/app/modules/fields/edit/field-types/multi-select-edit-field.component.ts","./src/app/modules/fields/edit/field-types/float-edit-field.component.ts","./src/app/modules/fields/edit/field-types/boolean-edit-field.component.ts","./src/app/modules/fields/edit/field-types/work-package-edit-field.component.ts","./src/app/modules/fields/edit/field-types/work-package-edit-field.component.html","./src/app/modules/fields/edit/field-types/date-edit-field.component.ts","./src/app/modules/fields/helpers/project-status-helper.ts","./src/app/modules/fields/edit/field-types/project-status-edit-field.component.html","./src/app/modules/fields/edit/field-types/project-status-edit-field.component.ts","./src/app/modules/fields/edit/field-types/plain-formattable-edit-field.component.ts","./src/app/modules/fields/edit/field-types/te-work-package-edit-field.component.ts","./src/app/modules/fields/edit/field-types/combined-date-edit-field.component.ts","./src/app/modules/fields/display/field-types/text-display-field.module.ts","./src/app/modules/fields/display/field-types/float-display-field.module.ts","./src/app/modules/fields/display/field-types/integer-display-field.module.ts","./src/app/modules/fields/display/field-types/resource-display-field.module.ts","./src/app/modules/fields/display/field-types/formattable-display-field.module.ts","./common/expression.service.ts","./src/app/modules/fields/display/field-types/duration-display-field.module.ts","./src/app/modules/fields/display/field-types/datetime-display-field.module.ts","./src/app/modules/fields/display/field-types/boolean-display-field.module.ts","./src/app/modules/fields/display/field-types/work-package-display-field.module.ts","./src/app/modules/fields/display/field-types/wp-spent-time-display-field.module.ts","./src/app/modules/fields/display/field-types/id-display-field.module.ts","./src/app/modules/fields/display/field-types/highlighted-resource-display-field.module.ts","./src/app/modules/fields/display/field-types/type-display-field.module.ts","./src/app/modules/fields/display/field-types/user-display-field.module.ts","./src/app/modules/fields/display/field-types/multiple-user-display-field.module.ts","./src/app/modules/fields/display/field-types/wp-id-display-field.module.ts","./src/app/modules/fields/display/field-types/project-status-display-field.module.ts","./src/app/modules/fields/display/field-types/plain-formattable-display-field.module.ts","./src/app/modules/fields/display/field-types/linked-work-package-display-field.module.ts","./src/app/modules/fields/openproject-fields.module.ts","./src/app/modules/fields/edit/edit-field.initializer.ts","./src/app/modules/fields/display/display-field.initializer.ts","./src/app/modules/common/focus/focus.directive.ts","./src/app/components/wp-table/table-actions/actions/details-table-action.ts","./src/app/components/wp-table/table-actions/actions/context-menu-table-action.ts","./src/app/components/wp-table/table-actions/table-actions.service.ts","./src/app/modules/router/first-route-service.ts","./src/app/components/wp-buttons/wp-filter-button/wp-filter-button.component.ts","./src/app/components/wp-buttons/wp-filter-button/wp-filter-button.html","./src/app/components/wp-query/url-params-helper.ts","./src/app/modules/common/back-routing/back-routing.service.ts","./src/app/components/wp-table/drag-and-drop/actions/table-drag-action.service.ts","./src/app/components/wp-table/drag-and-drop/actions/hierarchy-drag-action.service.ts","./src/app/components/wp-table/drag-and-drop/actions/group-by-drag-action.service.ts","./src/app/components/wp-table/drag-and-drop/actions/table-drag-actions-registry.service.ts","./src/app/components/wp-fast-table/builders/cell-builder.ts","./src/app/components/filters/filter-string-value/filter-string-value.component.ts","./src/app/components/filters/filter-string-value/filter-string-value.component.html","./src/app/helpers/debug_output.ts","./src/app/modules/work_packages/notifications/work-package-notification.service.ts","./src/app/modules/hal/resources/query-sort-by-resource.ts","./src/app/components/wp-single-view-tabs/relations-tab/relations-tab.component.ts","./src/app/components/wp-single-view-tabs/relations-tab/relations-tab.html","./src/app/components/op-context-menu/wp-context-menu/wp-view-context-menu.directive.ts","./src/app/components/wp-buttons/zen-mode-toggle-button/zen-mode-toggle-button.component.ts","./src/app/modules/hal/resources/time-entry-resource.ts","./src/app/helpers/angular/inject-field.decorator.ts","./src/app/components/wp-table/configuration-modal/tabs/columns-tab.component.ts","./src/app/components/wp-table/configuration-modal/tabs/columns-tab.component.html","./src/app/modules/work_packages/routing/wp-full-view/wp-full-view.component.ts","./src/app/modules/work_packages/routing/wp-full-view/wp-full-view.html","./src/app/modules/work_packages/routing/wp-view-base/work-package-single-view.base.ts","./src/app/components/wp-relations/wp-relation-row/wp-relation-row.component.ts","./src/app/components/wp-relations/wp-relation-row/wp-relation-row.template.html","./src/app/modules/boards/board/board-list/board-lists.service.ts","./src/app/components/wp-table/embedded/embedded-tables-macro.component.ts","./src/app/components/projects/current-project.service.ts","./src/app/components/wp-table/table-actions/actions/unlink-table-action.ts","./src/app/components/wp-table/configuration-modal/wp-table-configuration.modal.ts","./src/app/components/wp-table/configuration-modal/wp-table-configuration.modal.html","./src/app/components/wp-relations/embedded/children/wp-children-query.component.ts","./src/app/components/op-context-menu/handlers/wp-status-dropdown-menu.directive.ts","./src/app/modules/common/autocomplete/create-autocompleter.component.ts","./src/app/globals/augmenting/modal-wrapper.augment.service.ts","./src/app/components/wp-table/configuration-modal/wp-table-configuration.service.ts","./src/app/modules/common/focus/focus-within.directive.ts","./src/app/modules/common/drag-and-drop/drag-and-drop.service.ts","./src/app/components/modals/share-modal/query-sharing.modal.ts","./src/app/components/modals/share-modal/query-sharing.modal.html","./src/app/modules/common/openproject-common.module.ts","./src/app/components/user/user-avatar/user-avatar.component.ts","./src/app/components/wp-relations/wp-relations.service.ts","./src/app/components/work-packages/work-package-cache.service.ts","./src/app/modules/hal/resources/grid-resource.ts","./src/app/components/wp-buttons/wp-timeline-toggle-button/wp-timeline-toggle-button.component.ts","./src/app/components/wp-buttons/wp-timeline-toggle-button/wp-timeline-toggle-button.html","./src/app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component.ts","./src/app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component.html","./src/app/modules/common/resizer/resizer.component.ts","./src/app/modules/common/resizer/resizer.component.html","./src/app/components/user/current-user.service.ts","./src/app/globals/global-listeners/request-for-confirmation.ts","./src/app/globals/global-listeners.ts","./src/app/globals/global-listeners/augmented-date-picker.ts","./src/app/globals/global-listeners/link-hijacking.ts","./src/app/globals/global-listeners/refresh-on-form-changes.ts","./src/app/globals/global-listeners/top-menu-scroll.ts","./src/app/components/work-packages/work-package-comment/work-package-comment.component.html","./src/app/components/work-packages/work-package-comment/work-package-comment.component.ts","./src/app/globals/openproject.ts","./src/app/modules/bim/bcf/fields/display/bcf-thumbnail-field.module.ts","./src/app/modules/bim/bcf/helper/bcf-detector.service.ts","./src/app/modules/bim/bcf/bcf-viewer-bridge/revit-bridge.service.ts","./src/app/modules/bim/bcf/api/bcf-authorization.service.ts","./src/app/modules/bim/bcf/bcf-wp-attribute-group/bcf-wp-attribute-group.component.html","./src/app/modules/bim/bcf/bcf-wp-attribute-group/bcf-wp-attribute-group.component.ts","./src/app/modules/bim/bcf/bcf-wp-attribute-group/bcf-new-wp-attribute-group.component.ts","./src/app/modules/bim/bcf/openproject-bcf.module.ts","./src/app/misc/datepicker-defaults.js","./src/app/components/wp-custom-actions/date-action/custom-date-action-admin.component.ts","./src/app/components/wp-custom-actions/date-action/custom-date-action-admin.html","./src/app/modules/common/i18n/i18n.service.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-table-hierarchies.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service.ts","./src/app/modules/boards/board/caused-updates/caused-updates.service.ts","./src/app/components/enterprise-banner/enterprise-banner.component.ts","./src/app/components/wp-buttons/wp-buttons.module.ts","./src/app/modules/time_entries/shared/modal/base.modal.html","./src/app/modules/time_entries/create/create.modal.ts","./src/app/modules/time_entries/create/create.service.ts","./src/app/modules/attachments/openproject-attachments.module.ts","./src/app/components/wp-fast-table/builders/modes/hierarchy/single-hierarchy-row-builder.ts","./src/app/modules/bim/ifc_models/toolbar/import-export-bcf/bcf-import-button.component.ts","./src/app/modules/time_entries/shared/modal/base.modal.ts","./src/app/modules/hal/resources/user-resource.ts","./src/app/modules/boards/boards-sidebar/boards-menu.component.ts","./src/app/modules/boards/boards-sidebar/boards-menu.component.html","./src/app/components/wp-card-view/event-handler/right-click-handler.ts","./src/app/components/datepicker/datepicker.helper.ts","./src/app/components/datepicker/datepicker.modal.html","./src/app/components/datepicker/datepicker.modal.ts","./src/app/components/wp-table/configuration-modal/tabs/highlighting-tab.component.ts","./src/app/components/wp-table/configuration-modal/tabs/highlighting-tab.component.html","./src/app/components/wp-single-view-tabs/watchers-tab/watchers-tab.component.ts","./src/app/components/wp-single-view-tabs/watchers-tab/watchers-tab.html","./src/app/components/wp-new/wp-create.component.ts","./src/app/modules/bim/ifc_models/toolbar/import-export-bcf/bcf-export-button.component.ts","./src/app/components/modals/request-for-confirmation/password-confirmation.modal.ts","./src/app/components/modals/request-for-confirmation/password-confirmation.modal.html","./src/app/modules/common/html-sanitize/html-sanitize.service.ts","./src/app/modules/plugins/plugin-context.ts","./src/app/modules/plugins/openproject-plugins.module.ts","./src/app/helpers/images/resizer.ts","./src/app/modules/plugins/linked/openproject-avatars/avatar-upload-form/avatar-upload-form.html","./src/app/modules/plugins/linked/openproject-avatars/avatar-upload-form/avatar-upload-form.component.ts","./src/app/modules/plugins/linked/openproject-avatars/main.ts","./src/app/modules/plugins/linked/openproject-costs/wp-display/costs-by-type-display-field.module.ts","./src/app/modules/plugins/linked/openproject-costs/wp-display/currency-display-field.module.ts","./src/app/modules/plugins/linked/openproject-costs/hal/resources/budget-resource.ts","./src/app/modules/plugins/linked/openproject-costs/augment/cost-subform.augment.service.ts","./src/app/modules/plugins/linked/openproject-costs/augment/planned-costs-form.ts","./src/app/modules/plugins/linked/openproject-costs/augment/cost-budget-subform.augment.service.ts","./src/app/modules/plugins/linked/openproject-costs/main.ts","./src/app/modules/plugins/linked/openproject-documents/hal/resources/document-resource.ts","./src/app/modules/plugins/linked/openproject-documents/main.ts","./src/app/modules/plugins/linked-plugins.module.ts","./src/app/modules/grids/areas/grid-area.ts","./src/app/modules/grids/areas/grid-widget-area.ts","./src/app/modules/grids/areas/grid-gap.ts","./src/app/modules/grids/grid/area.service.ts","./src/app/modules/grids/widgets/header/header.component.ts","./src/app/modules/grids/widgets/header/header.component.html","./src/app/modules/grids/grid/remove-widget.service.ts","./src/app/modules/grids/widgets/menu/widget-abstract-menu.component.ts","./src/app/modules/grids/widgets/menu/widget-menu.component.html","./src/app/modules/grids/widgets/menu/widget-menu.component.ts","./src/app/modules/calendar/wp-calendar/wp-calendar.template.html","./src/app/modules/calendar/wp-calendar/wp-calendar.component.ts","./src/app/modules/grids/widgets/wp-calendar/wp-calendar.component.ts","./src/app/modules/grids/widgets/wp-calendar/wp-calendar.component.html","./src/app/modules/grids/widgets/time-entries/current-user/time-entries-current-user-configuration.modal.html","./src/app/modules/grids/widgets/time-entries/current-user/time-entries-current-user-configuration.modal.ts","./src/app/modules/grids/widgets/time-entries/current-user/time-entries-current-user-menu.component.ts","./src/app/components/time-entries/time-entry-cache.service.ts","./src/app/modules/time_entries/edit/edit.modal.ts","./src/app/modules/time_entries/edit/edit.service.ts","./src/app/modules/calendar/te-calendar/te-calendar.template.html","./src/app/modules/calendar/te-calendar/te-calendar.component.ts","./src/app/modules/grids/widgets/time-entries/current-user/time-entries-current-user.component.ts","./src/app/modules/grids/widgets/time-entries/current-user/time-entries-current-user.component.html","./src/app/modules/grids/widgets/widgets.service.ts","./src/app/modules/calendar/wp-calendar-entry/wp-calendar-entry.component.ts","./src/app/modules/calendar/wp-calendar-entry/wp-calendar-entry.component.html","./src/app/modules/time_entries/openproject-time-entries.module.ts","./src/app/modules/calendar/openproject-calendar.module.ts","./src/app/modules/grids/widgets/documents/documents.component.html","./src/app/modules/grids/widgets/documents/documents.component.ts","./src/app/modules/grids/widgets/news/news.component.html","./src/app/modules/grids/widgets/news/news.component.ts","./src/app/modules/grids/grid/initialization.service.ts","./src/app/modules/work-package-graphs/configuration-modal/tabs/settings-tab.component.ts","./src/app/modules/work-package-graphs/configuration-modal/tabs/settings-tab.component.html","./src/app/modules/work-package-graphs/configuration-modal/tabs/filters-tab.component.ts","./src/app/modules/work-package-graphs/configuration-modal/tabs/filters-tab.component.html","./src/app/modules/work-package-graphs/configuration/wp-graph-configuration.ts","./src/app/modules/work-package-graphs/configuration/wp-graph-configuration.service.ts","./src/app/modules/work-package-graphs/configuration-modal/wp-graph-configuration.modal.ts","./src/app/modules/grids/widgets/menu/wp-set-menu.component.ts","./src/app/modules/grids/widgets/wp-graph/wp-graph-menu.component.ts","./src/app/modules/work-package-graphs/embedded/wp-embedded-graph.html","./src/app/modules/work-package-graphs/embedded/wp-embedded-graph.component.ts","./src/app/modules/grids/widgets/wp-graph/wp-graph.component.ts","./src/app/modules/grids/widgets/wp-graph/wp-graph.component.html","./src/app/modules/grids/widgets/wp-table/wp-table-menu.component.ts","./src/app/modules/grids/widgets/wp-table/wp-table.component.html","./src/app/modules/grids/widgets/wp-table/wp-table.component.ts","./src/app/modules/grids/widgets/wp-table/wp-table-qs.component.ts","./src/app/modules/grids/widgets/wp-table/wp-table-qs.component.html","./src/app/modules/work-package-graphs/configuration-modal/tabs/abstract-query-spaced-tab.component.ts","./src/app/modules/work-package-graphs/configuration-modal/tabs/filters-tab-inner.component.html","./src/app/modules/work-package-graphs/configuration-modal/tabs/filters-tab-inner.component.ts","./src/app/modules/work-package-graphs/configuration-modal/tabs/settings-tab-inner.component.html","./src/app/modules/work-package-graphs/configuration-modal/tabs/settings-tab-inner.component.ts","./src/app/modules/work-package-graphs/overview/wp-overview-graph.template.html","./src/app/modules/work-package-graphs/overview/wp-overview-graph.component.ts","./src/app/modules/work-package-graphs/openproject-work-package-graphs.module.ts","./src/app/modules/grids/widgets/project-description/project-description.component.html","./src/app/modules/grids/widgets/project-description/project-description.component.ts","./src/app/modules/grids/widgets/wp-overview/wp-overview.component.ts","./src/app/modules/grids/widgets/wp-overview/wp-overview.component.html","./src/app/modules/grids/widgets/custom-text/custom-text-changeset.ts","./src/app/modules/grids/widgets/custom-text/custom-text-edit-field.service.ts","./src/app/modules/grids/widgets/custom-text/custom-text.component.html","./src/app/modules/grids/widgets/custom-text/custom-text.component.ts","./src/app/modules/grids/widgets/project-details/project-details.component.html","./src/app/modules/grids/widgets/project-details/project-details.component.ts","./src/app/modules/grids/widgets/time-entries/list/time-entries-list.component.ts","./src/app/modules/grids/widgets/time-entries/list/time-entries-list.component.html","./src/app/modules/grids/widgets/time-entries/project/time-entries-project.component.ts","./src/app/modules/grids/widgets/subprojects/subprojects.component.html","./src/app/modules/grids/widgets/subprojects/subprojects.component.ts","./src/app/modules/grids/widgets/members/members.component.html","./src/app/modules/grids/widgets/members/members.component.ts","./src/app/modules/grids/widgets/project-status/project-status.component.html","./src/app/modules/grids/widgets/project-status/project-status.component.ts","./src/app/modules/grids/openproject-grids.module.ts","./src/app/modules/router/base/application-base.component.ts","./src/app/modules/router/openproject.routes.ts","./src/app/modules/router/openproject-router.module.ts","./src/app/modules/work_packages/routing/work-packages-routes.ts","./src/app/modules/work_packages/openproject-work-package-routes.module.ts","./src/app/modules/global_search/services/global-search.service.ts","./src/app/modules/global_search/openproject-global-search.module.ts","./src/app/modules/admin/types/type-banner.service.ts","./src/app/modules/admin/types/type-form-configuration.html","./src/app/modules/admin/types/type-form-configuration.component.ts","./src/app/modules/admin/types/group-edit-in-place.html","./src/app/modules/admin/types/group-edit-in-place.component.ts","./src/app/modules/admin/types/attribute-group.component.html","./src/app/modules/admin/types/attribute-group.component.ts","./src/app/modules/admin/types/query-group.component.ts","./src/app/modules/admin/types/query-group.component.html","./src/app/modules/admin/openproject-admin.module.ts","./src/app/modules/grids/widgets/add/add.modal.html","./src/app/modules/grids/widgets/add/add.modal.ts","./src/app/modules/grids/grid/move.service.ts","./src/app/modules/grids/grid/drag-and-drop.service.ts","./src/app/modules/grids/grid/resize.service.ts","./src/app/modules/grids/grid/add-widget.service.ts","./src/app/modules/grids/grid/page/grid-page.component.ts","./src/app/modules/grids/grid/grid.component.html","./src/app/modules/grids/grid/grid.component.ts","./src/app/modules/grids/grid/page/grid-page.component.html","./src/app/modules/dashboards/dashboard/dashboard.component.ts","./src/app/modules/dashboards/openproject-dashboards.module.ts","./src/app/components/modals/preview-modal/wp-preview-modal/wp-preview.modal.html","./src/app/components/modals/preview-modal/wp-preview-modal/wp-preview.modal.ts","./src/app/globals/global-listeners/preview-trigger.service.ts","./src/app/modules/overview/overview.component.ts","./src/app/modules/overview/openproject-overview.module.ts","./src/app/modules/my-page/my-page.component.ts","./src/app/modules/my-page/openproject-my-page.module.ts","./src/app/modules/a11y/keyboard-shortcut-service.ts","./src/app/modules/common/colors/colors-autocompleter.component.ts","./src/app/modules/global_search/global-search-work-packages.component.ts","./src/app/components/homescreen/blocks/new-features.component.ts","./src/app/modules/bim/bcf/bcf-constants.const.ts","./src/app/modules/global_search/global-search-work-packages-entry.component.ts","./src/app/modules/common/persistent-toggle/persistent-toggle.component.ts","./src/app/modules/common/hide-section/hide-section.service.ts","./src/app/modules/common/hide-section/hide-section-link/hide-section-link.component.ts","./src/app/modules/common/hide-section/hide-section-link/hide-section-link.component.html","./src/app/modules/common/hide-section/show-section-dropdown.component.ts","./src/app/modules/common/hide-section/add-section-dropdown/add-section-dropdown.component.html","./src/app/modules/common/hide-section/add-section-dropdown/add-section-dropdown.component.ts","./src/app/modules/common/autocomplete/autocomplete-select-decoration.component.ts","./src/app/modules/common/tabs/content-tabs/content-tabs.component.ts","./src/app/modules/common/copy-to-clipboard/copy-to-clipboard.directive.ts","./src/app/components/modals/confirm-form-submit/confirm-form-submit.directive.ts","./src/app/components/resizer/main-menu-resizer.component.ts","./src/app/modules/global_search/input/global-search-input.component.html","./src/app/modules/global_search/input/global-search-input.component.ts","./src/app/modules/common/collapsible-section/collapsible-section.component.ts","./src/app/modules/common/collapsible-section/collapsible-section.html","./src/app/components/enterprise-banner/enterprise-banner-bootstrap.component.ts","./src/app/modules/common/autocomplete/lazyloaded/lazyloaded-autocompleter.ts","./src/app/components/projects/project-menu-autocomplete/project-menu-autocomplete.component.ts","./src/app/components/projects/project-menu-autocomplete/project-menu-autocomplete.template.html","./src/app/modules/common/remote-field-updater/remote-field-updater.component.ts","./src/app/modules/global_search/title/global-search-title.component.ts","./src/app/modules/global_search/title/global-search-title.component.html","./src/app/modules/global_search/tabs/global-search-tabs.component.ts","./src/app/components/main-menu/main-menu-toggle.component.ts","./src/app/modules/members/members-autocompleter.component.ts","./src/app/components/enterprise/enterprise-trial.service.ts","./src/app/helpers/i18n/localized-link.ts","./src/app/components/enterprise/enterprise-modal/enterprise-trial-form/ee-trial-form.component.html","./src/app/components/enterprise/enterprise-modal/enterprise-trial-form/ee-trial-form.component.ts","./src/app/components/enterprise/enterprise-active-trial/ee-active-trial.base.ts","./src/app/components/enterprise/enterprise-active-trial/ee-active-trial.component.html","./src/app/components/enterprise/enterprise-active-trial/ee-active-trial.component.ts","./src/app/components/enterprise/enterprise-trial-waiting/ee-trial-waiting.component.html","./src/app/components/enterprise/enterprise-trial-waiting/ee-trial-waiting.component.ts","./src/app/components/enterprise/enterprise-modal/enterprise-trial.modal.html","./src/app/components/enterprise/enterprise-modal/enterprise-trial.modal.ts","./src/app/components/enterprise/enterprise-base.component.html","./src/app/components/enterprise/enterprise-base.component.ts","./src/app/components/enterprise/enterprise-active-trial/ee-active-saved-trial.component.ts","./src/app/modules/time_entries/edit/trigger-actions-entry.component.ts","./src/app/global-dynamic-components.const.ts","./src/app/modules/members/members.module.ts","./src/app/components/enterprise/openproject-enterprise.module.ts","./src/app/angular4-modules.ts","./src/main.ts","./src/app/sentry/sentry-reporter.ts","./src/app/modules/work_packages/routing/wp-view-base/view-services/wp-view-base.service.ts"],"names":["notificationsContainerSelector","NotificationsContainerComponent","notificationsService","cdRef","super","stack","this","current","values$","pipe","untilDestroyed","subscribe","detectChanges","WorkPackageViewDropdownMenuDirective","elementRef","opContextMenu","I18n","wpDisplayRepresentationService","wpTableTimeline","evt","buildItems","show","items","contextMenuId","push","linkText","t","icon","onClick","setDisplayRepresentation","isVisible","toggle","WorkPackageChangeset","key","val","setValue","updateForm","payload","description","applyChanges","pristineResource","isNew","setNewDefaultFor","WorkPackageStatesInitializationService","states","querySpace","wpTableColumns","wpTableGroupBy","wpTableSortBy","wpTableFilters","wpTableSum","wpTableHierarchies","wpTableHighlighting","wpTableRelationColumns","wpTablePagination","wpTableOrder","wpTableAdditionalElements","wpCacheService","wpListChecksumService","authorisationService","wpDisplayRepresentation","query","results","clearStates","putValue","initializeFromQuery","updateQuerySpace","updateChecksum","form","schema","_","each","filtersSchemas","elements","schemas","get","$href","initializeFilters","queryForm","queries","columns","allowedValues","sortBy","groupBy","displayRepresentation","additionalRequiredWorkPackages","clear","tableRendered","href","initModelAuth","$links","forEach","wp","updateWorkPackage","groups","initialize","initialized","updateIfDifferent","value","applyToQuery","reason","UserLinkComponent","user","showUserPath","name","WorkPackageReplacementLabelComponent","wpeditForm","$element","jQuery","nativeElement","target","closest","length","field","fields","fieldName","handleUserActivate","activate","AttachmentCollectionResource","source","$initialize","HalEventsService","_events","events$","asObservable","resourceType","debounceTimeInMs","event","resourceReference","id","_type","next","AccessibleByKeyboardComponent","execute","isDisabled","emit","handleClick","contextMenuTdClassName","contextMenuSpanClassName","contextMenuLinkClassName","contextColumnIcon","OpTableAction","injector","workPackage","makeSplitViewRoutes","baseRoute","menuItemClass","showComponent","newComponent","url","redirectTo","reloadOnSearch","data","bodyClasses","menuItem","partition","newRoute","views","component","parent","allowMovingInEditMode","BcfPathHelperService","pathHelper","projectIdentifier","projectPath","filters","viewpoint","relationGroupClass","workPackageId","workPackageTable","column","emptyRelationCell","buildCell","from","relation","type","denormalized","to","workPackages","targetId","row","createEmptyRelationRow","tr","buildEmptyRow","identifier","relationClassIdentifier","document","createElement","dataset","classList","add","jRow","columnId","typeLabel","reverseRelationType","relationLabel","textContent","createTextNode","find","empty","append","cell","table","tablePass","relationRowBuilder","isApplicable","clone","renderedOrder","position","fromId","state","wpRelations","hasValue","size","relationsToExtendFor","relationRow","buildEmptyRelationRow","additionalClasses","appendRelationLabel","spliceRow","classIdentifier","concat","belongsTo","renderType","hidden","relationType","renderedRow","oldRow","newRow","refreshRow","hasRelationColumns","timelineBody","createDocumentFragment","timelineBuilder","wpId","secondary","build","appendChild","highlightAttribute","mode","window","getComputedStyle","body","property","tableBody","children","backgroundClass","isInline","dragActionRegistry","actionService","td","canPickup","span","dragDropHandleBuilder","configuration","dragAndDropEnabled","withLoadedPositions","then","positions","handle","element","replaceChild","firstElementChild","rowBuilder","prepare","doRender","postRender","highlighting","render","relations","dragDropHandle","timeline","replacement","refreshRelationRow","replaceWith","map","selector","renderedInfo","last","after","index","splice","renderPlaceholderRow","placeholderRow","classIdentifer","relationCellTdClassName","relationCellIndicatorClassName","RelationCellbuilder","expanded","getExpandFor","relationState","relationsForColumn","indicator","renderIndicator","badge","renderBadge","setAttribute","ActivityLinkComponent","activityHtmlId","activityNo","activityLabel","QueryDmService","halResourceService","http","UrlParamsHelper","QueryFilters","PayloadDm","queryData","queryId","path","api","v3","toString","withOptionalProject","default","stream","toPromise","undefined","pagination","buildV3GetQueryFromQueryResource","ids","timestamp","operator","values","filter","n","updatedAt","work_packages","JSON","stringify","extractPayload","patch","post","delete","starred","unstar","star","listParams","list","mapSchemasIntoFilters","extract","OpContextMenuLocalsToken","RestrictedWpTableConfigurationService","locals","disabledTabs","_tabs","el","disableBecause","LinkHandling","isClickedWithModifier","modifier","ctrlKey","shiftKey","metaKey","middleButton","button","DoubleClickOrTapDirective","stopEventPropagation","eventHandler","tapCount","eventStopReturnCode","preventDefault","stopPropagation","RelationsDmService","collection","workPackageIds","validIds","test","Promise","resolve","toPath","toJson","QueryFiltersService","available","$embedded","allowedFilterValue","getFilterSchema","WorkPackageCreateSettingsMenuDirective","halEditing","changeFor","getForm","loadedForm","positionArgs","assign","my","at","configureFormLink","configureForm","queryCustomFields","customFields","splitViewRoute","WorkPackageViewHighlightingService","Banners","eeShowBanners","selectedAttributes","attr","lastUpdatedState","getValueOr","filteredValue","update","highlight","highlightingMode","highlightedAttributes","isEqual","isEmpty","conditional","WorkPackageCreateButtonComponent","$state","currentProject","transition","text","createWithDropdown","createButton","explanation","observeUntil","allowed","allowedWhen","combined","module","permission","split","can","updateDisabledState","transitionUnregisterFn","onSuccess","bind","ngOnDestroy","disabled","includes","WorkPackageCommentFieldHandler","handler","active","inEditMode","inFlight","onDestroy","change","withText","raw","writable","required","hasDefault","commentValue","deactivate","reset","focus","complete","trigger","querySelector","onlyCancel","WorkPackageEditActionsBarComponent","editForm","onSave","onCancel","_saving","save","cancel","saving","submit","catch","AuthoringComponent","PathHelper","timezoneService","createdOnTime","parseDatetime","createdOn","timeago","fromNow","time","format","userLink","userPath","author","idFromLink","projectActivityPath","project","WorkPackageBreadcrumbComponent","hierarchy","inputActive","ancestors","hierarchyCount","AttachmentsUploadComponent","ConfigurationService","draggingOver","uploadLabel","dropFiles","dropFilesHint","foldersWarning","maxFileSize","maximumAttachmentFileSize","filePicker","click","dataTransfer","dropEffect","dfFiles","files","i","uploadFiles","containsFiles","Array","types","contains","indexOf","countBefore","filterFolders","resource","uploadAttachments","addNotice","file","console","warn","EditFieldControlsComponent","basePath","segment","resourceClass","params","headers","config","encoder","fromObject","withCredentials","responseType","_request","method","request","response","deserialize","catchError","error","throwError","parse","BcfProjectResource","BcfTopicAuthorizationMap","String","BcfTopicResource","preserveNull","deserializer","moment","serializer","toISOString","bcfTopicService","Error","comments","viewpoints","BcfExtensionResource","bcfExtensionService","bcfProjectService","topics","extensions","bcfApiVersion","appBasePath","bcfApiBase","projects","startsWith","parts","replace","pathOrId","UserAvatarRendererService","colors","container","users","renderName","multiLine","avatar","sep","classes","userInitials","getInitials","colorCode","toHsl","fallback","className","style","background","image","Image","src","title","alt","onload","characters","lastSpace","lastIndexOf","toUpperCase","join","AngularTrackingHelpers","compareByAttribute","attribute","a","b","compareByHref","halHref","_index","item","compareByName","trackByName","trackByHref","trackByProperty","prop","trackByHrefAndProperty","propertyName","trackByTrackingIdentifier","compareByHrefOrString","NewestActivityOnOverviewComponent","latestActivityInfo","ngOnInit","activities","updateActivities","latestActivities","visible","reverse","unfilteredActivities","slice","info","startIndex","WorkPackageCopySplitViewComponent","WorkPackageRelationsHierarchyComponent","wpRelationsHierarchyService","showEditForm","parentHeadline","childrenHeadline","workPackagePath","canModifyHierarchy","changeParent","canAddRelation","addRelation","childrenQueryProps","showHierarchies","loadWorkPackage","toLoad","parentId","require","requireAll","timelineElementCssClass","timelineBackgroundElementClass","timelineGridElementCssClass","timelineMarkerSelectionStartClass","timelineHeaderCSSClass","timelineHeaderSelector","TimelineViewParametersSettings","zoomLevel","zoomLevelOrder","getPixelPerDayForZoomLevel","requiredPixelMarginLeft","TimelineViewParameters","now","hour","minute","seconds","dateDisplayStart","dateDisplayEnd","settings","activeSelectionMode","selectionModeStart","maxSteps","pixelPerDay","diff","Math","ceil","calculatePositionValueForDayCountingPx","viewParams","days","calculatePositionValueForDayCount","getTimeSlicesForHeader","vp","unit","startView","endView","inViewport","rest","startOf","end","endOf","isBefore","sliceStart","sliceEnd","viewport","visibleViewportAtCalculationTime","isSameOrAfter","isSameOrBefore","firstRest","lastRest","pop","inViewportAndBoundaries","e","isNil","calculateDaySpan","visibleWorkPackages","loadedWorkPackages","viewParameters","earliest","latest","start","startDate","date","due","dueDate","isAfter","OPContextMenuService","componentFactoryResolver","FocusHelper","appRef","$transitions","isOpening","hostElement","portalHostElement","bodyPortalHost","onStart","close","on","which","ESCAPE","that","getElementById","addEventListener","menu","portal","injectorFor","attach","display","setTimeout","reposition","onOpen","activeMenu","detach","onClose","css","injectorTokens","WeakMap","service","set","WorkPackageCreateService","hooks","workPackageDmService","halEvents","newWorkPackageCreatedSubject","comittedChanges","commit","wasNew","newWorkPackageCreated","changes$","changeset","getEmptyForm","fromCreateForm","typedCreateForm","createHalResourceOfType","$plain","initializeNewResource","edit","call","copyFrom","$source","emptyCreateForm","stopEditing","changePromise","continueExistingEdit","createNewWithDefaults","updateValue","clearSome","changeType","projectedResource","hasChanges","typeEmpty","typeMatches","createNewTypedWorkPackage","createNewWorkPackage","except","applyDefaults","applyDefaultsFromFilters","RowsBuilder","cssClassCustomOption","DisplayField","context","activeChange","texts","placeholder","constructor","isFormattable","valueString","displayText","options","emptyDiv","ActivityPanelBaseController","$transition","wpActivity","visibleActivities","onlyComments","commentsOnly","showAll","isReversed","togglerText","observe","getVisibleActivities","showToggler","shouldShowToggler","count_all","count_with_comments","getActivitiesWithComments","activity","rowId","relationRowClass","locateTableRow","locateTableRowByIdentifier","locatePredecessorBySelector","previous","previousElementSibling","matches","scrollTableRowIntoView","scrollParent","containerTop","scrollTop","containerBottom","height","elemTop","offsetTop","elemBottom","createLocalInjector","fieldHandler","AbstractDateTimeValueController","remove","isValidISODateTime","isValidISODate","d","parseISODatetime","formattedISODateTime","formattedISODate","lowerBoundary","upperBoundary","hours","minutes","rendered","additionalParents","deferred","parentsWithVisibleChildren","hierarchies","originalRowIndex","object","ancestor","originalRows","deferInsertion","buildWithHierarchy","buildEmpty","markRendered","renderAllDeferredChildren","ancestorChain","inTable","newElements","child","uniqBy","insertUnderParent","getOrBuildRow","ancestorGroups","ancestorRow","buildAncestorRow","insertAtExistingHierarchy","previousAncestor","isAncestor","buildRenderInfo","hierarchyRoot","hierarchyGroup","ancestorClasses","ancestorRowData","_table","isEnabled","builder","cellBuilder","resourceSubscription","requireAndStream","unsubscribe","rowContainer","first","errors","waitForContainer","findCell","addClass","width","parseInt","editingPortalService","create","findContainer","refresh","removeClass","focusElement","addColumn","tableAndTimelineContainer","reject","interval","setInterval","clearInterval","forms","destroy","typedState","existing","scrollContainer","tbody","timelineController","builders","lastRenderPass","editing","findIndex","renderedRows","rows","buildIndex","redrawTableAndTimeline","renderPass","performRenderPass","requestAnimationFrame","innerHTML","result","pass","insert","buildRows","WorkPackageDmService","force","getAllPaginated","workPackagesFormPath","typeId","_links","DynamicContentModal","closeOnOutsideClick","modalClassName","modalBody","closeMe","off","CKEditorSetupService","wrapper","initialData","editor","OPConstrainedEditor","OPClassicEditor","toolbarWrapper","contentWrapper","contentLanguage","rtl","createCustomized","openProject","createConfig","language","content","ui","view","toolbar","setData","cb","getData","trim","macros","helpURL","textFormattingHelp","pluginContext","OpenProject","EditFieldService","wpQuerySelectSelector","WorkPackageQuerySelectDropdownComponent","ref","QueryDm","CurrentProject","loadingIndicator","wpStaticQueries","mainMenuService","toggleService","loading","noResults","search","label","scope_default","scope_starred","scope_global","scope_private","no_results","hiddenCategories","reportsBodySelector","queryResultsContainer","_queryResultsContainerElement","getAttribute","onActivate","initializeAutocomplete","addClickHandler","unregisterTransitionListener","searchInput","_wpQueryMenuSearchInput","buttonArrowLeft","setupAutoCompletion","updateMenuOnChanges","loadQueries","combinedQueries","query_props","all","sortQueries","categorized","public","private","auto_id","category","flatten","sortByLabel","sort","toLowerCase","localeCompare","loadingPromise","listNonHidden","querycomplete","transformQueries","thisCategory","expandCollapseCategory","promise","input","defineJQueryQueryComplete","delay","select","ul","selected","autocompleteUi","is","_event","sourceEvent","originalEvent","appendTo","autoFocus","minLength","thisComponent","widget","autocomplete","_create","_super","_search","_renderItem","link","buildQueryItemUrl","li","setInitialHighlighting","_renderMenu","currentCategory","option","labelFunction","_renderItemData","scrollIntoView","behavior","block","currentLi","getQueryParams","currentId","query_id","currentProps","onWorkPackagesPage","onWorkPackagesReportPage","hasClass","currentIdSelected","matchesStaticQueryProps","allOpen","onSummary","changes","not","toggleClass","go","reload","closeWhenOnMobile","static_link","highlightBySelector","ENTER","clickedWithModifier","isStatic","stopImmediatePropagation","location","loadQuery","highlightSelected","clickedCategory","selectorTimelineSide","getPlattformAgnosticScrollAmount","originalValue","delta","syncWheelEvent","jev","elementTable","elementTimeline","scrollTarget","ev","deltaX","deltaY","x","y","getXandYScrollDeltas","scrollLeft","createScrollSync","elTable","elTimeline","timelineVisible","syncedLeft","syncedRight","halNotification","destroyImmediately","removeAttachment","dragHint","destroyConfirmation","removeFile","arg","downloadPath","previewElement","draggableHTML","outerHTML","setDragImage","isImage","fileName","attachmentDownloadPath","attachment","ext","imageFileExtensions","customName","$event","confirm","setDragData","attachments","deletedAttachments","updateAttachments","setupResourceUpdateListener","setupAttachmentDeletionCallback","forResource","newResource","$formElement","newAttachments","attachmentsBackend","destroyRemovedAttachments","attachmentsUpdatable","updateElements","HighlightableDisplayField","colorize","shouldHighlight","viewHighlighting","shouldHighlightInline","WorkPackageRelationsCreateComponent","notificationService","showRelationsCreateForm","selectedRelationType","DEFAULT","relationTypes","LOCALIZED_RELATION_TYPES","abort","addNewRelation","selectedWpId","createCommonRelation","addCommonRelation","eventType","relatedWorkPackage","showSave","toggleRelationsCreateForm","err","handleRawError","FilterDateTimeValueComponent","shouldFocus","filterChanged","isoDateParser","CardClickHandler","card","handleWorkPackage","setSelection","openFullViewOnMobile","deviceService","isMobile","wpCardView","findRenderedCard","wpTableSelection","setMultiSelectionFrom","renderedCards","toggleRow","wpTableFocus","updateFocus","tableActionsService","tableRowClassName","commonRowClassName","relationCellBuilder","contextLinkBuilder","augmentedColumns","buildAugmentedColumns","getColumns","unshift","actionsColumnEnabled","columnMenuEnabled","createEmptyRow","colSpan","cells","newCells","oldTd","isColumnBeingEdited","prepend","activeFields","changedAttributes","oldCell","isSelected","cancelButton","buildCancelButton","wpCreate","wpInlineCreate","canAdd","canReference","buttonTexts","hasReferenceClass","registerCreationCallback","refreshOnColumnChanges","registerCancelHandler","resetRow","updates$","isActive","onNewWorkPackage","currentWorkPackage","__initialized_at","isEmbedded","newInlineWorkPackageCreated","cancelCreation","removeWorkPackageRow","showRow","addWorkPackageRow","referenceComponentClass","referenceClass","createOrContinueWorkPackage","editingSubscription","changesetUpdates$","overriddenSchema","insertRow","workPackageEditForm","renderInlineCreateRow","activateMissingFields","hideRow","rowElement","startEditing","buildNew","columnCount","PayloadDmService","nonLinkProperties","hasOwnProperty","isArray","currentSchema","WorkPackageViewSortByService","pristineState","comparer","wasManuallySorted","isManuallySorted","isManualSortingMode","candidate","criteria","findAvailableDirection","direction","newValue","manualSortObject","persisted","availableState","endsWith","filtersChanged","QueryFiltersComponent","wpFiltersService","bannerService","showCloseFilter","remainingFilters","focusElementIndex","open_filter","label_filter_add","close_filter","upsale_for_more","upsale_link","close_form","selected_filter_list","button_delete","please_select","filter_by_text","updateRemainingFilters","filterToBeAdded","newFilter","instantiate","currentFilterLength","updateFilterFocus","ngSelectComponent","clearItem","toggleVisibility","removedFilter","f","hasSearch","hasAvailableFilter","isFilterAvailable","remainingVisibleFilters","activeFilterCount","filterIndex","currentFilterAt","availableFilters","some","dropdownPanel","_updatePosition","EditFormComponent","editFormRouting","initializeEditMode","skippedFields","onSavedEmitter","registeredFields","confirmText","requiresConfirmation","warnOnLeavingUnsaved","unregisterListener","onBefore","blockedTransition","editMode","waitForField","ctrl","setActive","editContainer","savedResource","isInitial","closeEditFields","hasActiveFields","keys","skipField","activateOnForm","changed","FilterDateValueComponent","isValid","parseDate","parser","uniqueEmbeddedTableName","Date","initialLoadingIndicator","renderTable","showTablePagination","providedConfiguration","queryProps","projectContext","wpStatesInitialization","urlParamsHelper","tableVisible","firstPage","paginationObject","offset","loadResults","loadingIndicatorService","tableActions","externalHeight","onError","onQueryLoaded","loadedQuery","ngAfterViewInit","setActions","page","perPage","distinctUntilChanged","withLatestFrom","initializeStates","onUpdated","valuesPromise","opModalService","onDataUpdated","withFilters","loadForm","take","total","count","setLoaded","compactTableStyle","formPromise","QueryFormDm","load","updateStatesFromForm","pageSize","queryProjectScope","message","EditFormPortalComponent","editField","onEditFieldReady","editFieldHandler","schemaInput","changeInput","componentClass","getSpecificClassFor","fieldInjector","FocusHelperService","minimumOffsetForNewSwitchInMs","lastFocusSwitch","lastPriority","allowFocusSwitch","priority","checkTimeout","throttleAndCheckIfAllowedFocusChangeBasedOnTimeout","focusser","focusable","FOCUSABLE_SELECTORS","getFocusableElement","$focusable","checkIfAllowedFocusChange","WorkPackageViewHierarchyIdentationService","wpViewHierarchies","wpRelationHierarchy","isList","applicable","renderedWorkPackageIds","ancestorIds","ancestorCount","lastAncestor","canIndent","predecessorId","newParentId","predecessor","difference","canOutdent","WorkPackageWatcherButtonComponent","wpWatchersService","showText","setWatchStatus","isWatched","toggleLink","nextStateLink","$link","linkName","buttonTitle","buttonText","buttonClass","buttonId","watchIconClass","SelectionHelpers","hasSelectionWithin","selection","getSelection","hasSelection","isWithin","anchorNode","NotificationsService","displayFieldOptions","isDropTarget","editFieldContainerClass","destroyed","componentDestroyed","fieldRenderer","register","temporaryEditResource","isEditable","displayPlaceholder","displayContainer","fieldSchema","isAttributeEditable","noWarnings","positionOffset","getPosition","$onUserActivate","startDragOverActivation","activateIfEditable","WorkPackageCardDragAndDropService","reorderService","dragService","componentRef","cardView","dragContainer","scrollContainers","moves","canDragOutOf","accepts","dragInto","onMoved","toIndex","newOrder","move","currentOrder","updateOrder","onRemoved","onAdded","addWorkPackageToQuery","parentElement","removeChild","_workPackages","activeInlineCreateWp","existingNewWp","o","uniq","workPackageAddedHandler","removeCard","DomHelpers","setBodyCursor","cursor","setProperty","dependencies","validationErrors","halInitializer","errorIdentifier","isValidationError","_dependencies","dependency","self","definesAllowedValues","staticSchema","dependentSchema","forValue","resultingSchema","merge","idPart","decodeURIComponent","WikiPageResource","MeetingContentResource","PostResource","statuses","schemaCacheService","without","$linkableKeys","halResourceDefaultConfig","WorkPackage","cls","attrTypes","status","Activity","Relation","Schema","Type","Status","SchemaDependency","User","Group","Collection","WorkPackageCollection","AttachmentCollection","Query","Form","FormPayload","QueryFilterInstance","QueryFilterInstanceSchema","QueryFilter","Root","QueryOperator","HelpText","CustomAction","WikiPage","MeetingContent","Post","Project","Role","Grid","GridWidget","TimeEntry","Membership","News","Version","TypeDmService","typeUrl","root","internal_error","errorMessages","ErrorReporter","captureException","captureMessage","handleError","OpenprojectHalModule","provide","useClass","multi","useFactory","registerResource","deps","OpTypesContextMenuDirective","browserDetector","stateName","ariaLabel","class","inlineClass","ConfirmDialogModal","confirmed","button_continue","button_cancel","close_popup","dangerHighlighting","defaultTo","passedData","closeOnEscape","closeByEscape","closeByDocument","showClose","defaults","confirmAndClose","OpenprojectAccessibilityModule","NoResultsComponent","setHostClass","groupClassNameFor","group","collapse","expand","colspan","togglerIconClass","collapsed","escape","headerBuilder","currentGroup","nextGroup","matchingGroup","groupClass","buildGroupRow","appendNonWorkPackageRow","buildSingleRow","matchesMultiValue","valueLink","l","joinedOrderedHrefs","objects","isEqualWith","appendRow","collapsedGroups","getGroupData","groupIndex","parentNode","affected","AbstractFieldService","attributeType","fieldType","defaultFieldType","getClassFor","fieldClass","attributes","addFieldType","configurationDm","loadConfiguration","userPreference","timezone","systemPreference","startOfWeekPresent","locale","firstDayOfWeek","pref","OpContextMenuHandler","afterFocusOn","openerEvent","of","collision","DragAndDropHelpers","reinsert","sibling","insertBefore","RootDmService","setExpandFor","additionalPositionArgs","action","startAddRelationPredecessor","startAddRelationFollower","wpViewIndentation","indent","outdent","triggerContextMenuAction","rowSelector","openContextMenu","contextMenuEnabled","keyCode","F10","altKey","SELECTOR","findRenderedRow","groupIdentifier","parents","collapsedState","t0","performance","refreshExpansionState","t1","blur","keepTab","takeUntil","stopAllSubscriptions","redrawTable","lastValue","renderHierarchyState","classNames","match","isCollapsed","orderedWorkPackages","initialSetup","observeChange","changedId","refreshRows","ifShouldFocus","live$","renderSelectionState","registerSelectAllListener","registerDeselectAllListener","renderVisibility","inlineCreateService","updateRenderedOrder","rowIndex","findRowIndex","handleDrop","onNewOrder","switchToManualSorting","wpListService","sourceIndex","onCloned","original","subjectWithId","maxWidth","onShadowInserted","isEdge","changeShadowElement","order","mappedOrder","currentRenderedOrder","renderedWorkPackages","getElementsByClassName","eventHandlers","stateTransformers","viewRef","attachTo","WpTableHoverSync","tableAndTimeline","lastHoveredElement","eventListener","handleHover","passive","removeEventListener","removeAllHoverClasses","parentTableRow","locateHoveredTableRow","parentTimelineRow","locateHoveredTimelineRow","removeOldAndAddNewHoverClass","hovered","extractWorkPackageId","tableRow","timelineRow","zone","limitedResults","configurationObject","tableSummary","tableSummaryHints","combineLatest","timelines","numTableColumns","scrollSyncUpdate","manualSortEnabled","wpTableHoverSync","controller","getTableAndTimelineElement","tableElement","$tableSide","$timelineSide","timelineCellClassName","TimelineRowBuilder","rowClasses","WorkPackageCommentFieldComponent","isBusy","rawValue","WorkPackageWatchersCountComponent","watchers","EditFormRoutingService","QueryFilterInstanceResource","memoizedCurrentSchemas","$copy","isValueRequired","operatorSymbol","availableOperators","BoardActionsRegistryService","mapping","localizedName","WorkPackageService","successful_delete","defaultHandling","workPackagesBulkDeletePath","addSuccess","urlParams","buildQueryString","UntilDestroyedMixin","WpTableConfigurationRelationSelectorComponent","relationFilterIds","availableRelationFilters","selectedRelationFilter","filter_work_packages_by_relation_type","precedes","follows","relates","duplicates","duplicated","blocks","blocked","requires","partof","onReady","relationFiltersOf","setSelectedRelationFilter","currentRelationFilters","onRelationFilterSelected","removeRelationFiltersFromCurrentState","addFilterToCurrentState","filtersToRemove","getOperatorForId","f1","f2","IconTriggeredContextMenuComponent","menuItems","additional","WorkPackageViewGroupByService","cur","environment","production","QueryResource","WorkPackageRelationsGroupComponent","onToggleGroupBy","groupByType","groupByRelation","groupByWorkPackageType","toggleElement","WorkPackageDetailsViewButtonComponent","transitions","accessKey","activeState","listState","iconClass","activateLabel","deactivateLabel","transitionListener","openListView","openDetailsView","extend","focusedWorkPackage","currentDetailsState","performAction","HalLink","requestMethod","templated","templateValues","regexp","RegExp","$callable","linkFunc","$fetch","Board","grid","updateImmediately","isAction","isFree","isNewWidget","widgets","createdAt","startColumn","actionAttribute","ContainHelpers","insideOrSelf","within","whenOutside","callback","activeElement","collapsedGroupClass","ancestorId","hierarchyGroupClass","hierarchyRootClass","ancestorClassIdentifier","ExternalRelationQueryConfigurationService","triggerEditingEvent","selectableTitleIdentifier","EditableToolbarTitleComponent","editable","showSaveCondition","initialFocus","smallHeader","onEmptySubmit","click_to_edit","press_enter_to_save","query_has_changed_click_to_save","input_title","input_placeholder","search_query_title","confirm_edit_cancel","duplicate_query_title","inputField","selectedTitle","inputTitle","currentValue","firstChange","selectInputOnInitalFocus","toggleToolbarButtonVisibility","resetInputField","onEmptyError","emitSave","focusInputOnError","WorkPackageEmbeddedTableEntryComponent","getInputsFromData","attributeHelpTextSelector","AttributeHelpTextComponent","helpTextDm","attributeHelpTexts","exists","open_dialog","helpTextId","attributeScope","additionalLabel","helpText","BoardDmService","GridDm","boardPath","one","board","fetchSchema","projectBoardsPath","createGrid","createForm","createHalResource","i18n","resourceChanged","editableName","widgetIdentifier","defaultValue","setChangesetOptions","Object","NewsDmService","news","GonService","gon","BackButtonComponent","backRoutingService","goBack","customBackMethod","linkClass","StatusDmService","WorkPackagesListService","wpListInvalidQueryService","queryRequests","queryLoading","q","ensurePerPageKnown","streamQueryRequest","queryParams","conditionallyLoadForm","decodedProps","getCurrentQueryProps","buildV3GetQueryFromJsonParams","handleQueryLoadingError","fromQueryParams","encodeQueryJsonParams","additionalParams","getPaginationInfo","currentQuery","loadResultsList","reloadQuery","loadDefaultQuery","addError","toggleStarred","currentForm","loadWithParams","findDefault","restoreQuery","isPerPageKnown","FilterDatesValueComponent","spacer","WorkPackagesViewBase","queryLoaded","setupQueryObservers","setupRefreshObserver","setupQueryLoadedListener","isQueryOutdated","setupChangeObserver","queryState","hasChanged","newQuery","triggerUpdate","aggregated$","events","filterRefreshEvents","Set","has","ConfirmDialogService","closingEvent","modal","DynamicBootstrapper","defs","optionalBoostrapComponents","doc","definitions","performBootstrap","embeddable","embedded","querySelectorAll","bootstrap","QueryParamListenerService","observe$","listenForQueryParamsChanged","queryChangeListener","newChecksum","newId","custom","notify","executeIfOutdated","IsolatedQuerySpace","timelineRendered","$","keyCodes","WorkPackageViewSumService","sums","updatesState","WorkPackageBreadcrumbParentComponent","wpRelationsHierarchy","onSwitch","isSaving","edit_parent","set_or_remove_parent","remove_parent","set_parent","newParent","WorkPackageSettingsButtonComponent","WpTableExportModal","httpClient","notifications","closePopup","exportPreparing","isLoading","downloadSwitched","exportOptions","buildExportOptions","safeUnsubscribe","representations","addColumnsToHref","performRequest","download","linkHeaderUrl","pollUntilDownload","subscription","getter","columnIds","removeSearch","addSearch","downloadHref","downloadLink","WorkPackageViewFiltersService","incomplete","loadCurrentFiltersSchemas","rawFilters","newFilters","filterOrId","availableSchemas","getFilter","mapper","every","isCompletelyDefined","cloneFilters","invisibleFilters","currentFilterResources","newState","isComplete","differenceBy","$load","WorkPackageViewRelationColumnsService","eachCallback","findById","relationColumnType","typeHref","RELATION_TO_TYPE","RELATION_OF_TYPE","nextState","WorkPackageInlineCreateService","referenceTarget","reference","newInlineWorkPackageReferenced","canCreateWorkPackages","OpSettingsMenuDirective","focusAfterClose","queryUpdate","formUpdate","allowAction","modelName","initialTab","cannot","allowQueryAction","create_new","allowFormAction","allowWorkPackageAction","divider","internalSortColumn","internalContextMenuColumn","CKEditorPreviewService","preview","refs","getEmbeddable","entry","matchedElements","resolveComponentFactory","attachView","hostView","changeDetectorRef","detachView","OpenprojectProjectsModule","ClickPositionMapper","setPosition","setSelectionRange","originalEvt","caretRangeFromPoint","clientX","clientY","startOffset","rangeParent","range","createRange","setStart","rangeOffset","Changeset","k","pristineValue","getItem","form$","cache","updatePristineResource","buildPayloadFromChanges","_pristineResource","Proxy","proxyGet","getSchemaName","isPristine","hasActivePromiseRequest","setNewDefaults","putFromPromiseIfPristine","getValue","lockVersion","plainPayload","getLinkedValue","cloneDeep","minimalPayload","isArrayType","links","valueExists","QueryOrderDmService","orderPath","wpIds","TabPortalOutlet","availableTabs","outletElement","activeTabs","currentTab","tab","instance","activateInstance","_getComponentRootNode","tabName","setAttachedHost","dispose","createComponent","rootNodes","WorkPackageIsolatedQuerySpaceDirective","useExisting","OpenProjectHeaderInterceptor","req","csrf_token","newHeaders","clonedRequest","HighlightColDirective","thead","siblings","currentTarget","highlightColBootstrap","usersAutocompleterSelector","UserAutocompleterComponent","userTracker","onChange","clearAfterSelection","allowEmpty","multiple","initialSelection","requests","searchTerm","getAvailableUsers","inputFilters","updateInputField","getElementsByName","setInitialSelection","filterInput","lastRequestedValue","input$","u","searchFilters","res","isNaN","onFocus","onModelChange","OpModalLocalsToken","OpModalService","opening","closeOnEscapeFunction","activeModal","withErrors","Subject","setErrors","setClickOffset","tagName","subject","handleUserSubmit","newErrors","isErrorenous","onSubmit","handleUserCancel","messages","previewPath","outlet","createDomOutlet","localInjector","attachComponentPortal","ExternalRelationQueryConfigurationComponent","useValue","DisplayFieldService","apply","SimpleResourceCollection","SimpleResource","toParams","WorkPackageViewColumnsService","isCurrentlyEqualTo","c","toApply","oldColumns","newColumns","relationColumns","isLast","mapped","setColumns","compact","fromIndex","moveColumn","newColumn","PROPERTY","revisions","available_watchers","available_projects","userId","me","availableProjects","projectId","available_assignees","versions","gridId","newsId","timeEntryId","apiV3Base","priorities","time_entries","memberships","help_texts","grids","base","term","idOnly","attachmentIdentifier","slug","staticBase","forumIdentifier","projectForumPath","messageIdentifier","projectsPath","projectWorkPackagesPath","usersPath","workPackagesPath","MainMenuNavigationService","navigationEvents$","names","toggler","targetLi","log","mainItems","wrap","elementId","wrapperElement","wrapMainItem","recreateToggler","activeRoot","navigateUp","unbind","wrapInner","_i","contents","parentURL","header","upLink","parentLink","before","DeviceService","mobileWidthTreshold","innerWidth","WorkPackageStatusButtonComponent","workPackageReadOnly","workPackageStatusBlocked","isReadonly","AuthorisationService","modelLinks","doModify","PlainRenderPass","Attachable","Base","addAttachment","pull","$isHal","max","updateState","uploads","finished","performUpload","notification","addAttachmentUpload","r","ErrorEvent","opFileUpload","uploadAndMapResponse","Field","WorkPackageRelationsAutocomplete","inputPlaceholder","additionalFilters","hiddenOverflowContainer","onSelected","onEmptySelected","searchInput$","appendToContainer","results$","queryString","autocompleteWorkPackages","ensureLoaded","availableRelationCandidates","filterCandidatesFor","onWorkPackageSelected","HalResource","$loaded","$halType","other","_name","_fieldName","$loadResource","$self","properties","OpIcon","iconTitle","ProjectCacheService","projectDmService","RelationResource","includeParentChild","includeParentchild","RELATION_TYPES","reverseType","renderEmpty","renderValues","div","percentLabel","avatarRenderer","renderMultiple","startDateElement","createDateDisplayField","dueDateElement","separator","dateElement","dateDisplayField","formattedDate","editableClassName","readOnlyClassName","displayClassName","fieldCache","renderFieldValue","setSpanAttributes","schemaName","getField","getText","getAriaLabel","getFieldForCurrentContext","isCustomMultiLinesField","isUserMultiLinesField","displayFieldService","getDefaultPlaceholder","titleContent","labelContent","getLabelContent","displayName","QueryFilterComponent","deactivateFilter","showValuesInput","onFilterUpdated","removeThisFilter","URLParamsEncoder","encodeURIComponent","VersionResource","WorkPackageCopyController","copying","copiedWorkPackageId","stateParams","copiedFromWorkPackageId","createCopyFrom","titleService","setFirstPart","sourceChangeset","copyWorkPackage","copyChangeset","ProgressDisplayField","roundedProgress","round","Number","WorkPackageActivityTabComponent","QueryFormDmService","optionalId","WorkPackageViewAdditionalElementsService","requireInvolvedRelations","requireHierarchyElements","loadAdditional","getInvolvedWorkPackages","DomAutoscrollService","down","scrollWhenOutside","maxSpeed","margin","autoScroll","point","pointCB","init","onMove","onUp","setScroll","cleanAnimation","cancelAnimationFrame","animationFrame","windowAnimationFrame","scrolling","targetObject","underPoint","inside","dispatched","getElementsUnderPoint","getTarget","outerScrollContainer","scrollTick","scrollAutomatically","scrollx","scrolly","rect","left","right","top","bottom","scrollY","scrollX","amount","scrollTo","pageXOffset","pageYOffset","FilterToggledMultiselectValueComponent","RootDm","halSorting","_availableOptions","fetchAllowedValues","ngSelectInstance","castArray","_isEmpty","loadAllowedValues","availableOptions","loadingPromises","isUserResource","resources","addMeValue","currentUser","setValues","repositionDropdown","WorkPackageAuthorization","workPackageDetailsCopyPath","workPackageCopyPath","copyLink","allActions","allowedActions","validActions","isPermitted","linkForAction","HookService","opContextMenuService","authorization","permittedActions","getPermittedActions","timeEntryCreateService","actions","permittedActionsWithLinks","getPermittedPluginActions","indexBy","DatePicker","datepickerElemIdentifier","datepickerTarget","configurationService","datepickerFormat","datepickerCont","startOfWeek","mergedOptions","weekNumbers","dateFormat","defaultDate","weekdays","shorthand","longhand","months","weekAbbreviation","datePickerInstances","datepickerInstance","hide","isOpen","open","hideDuringScroll","dates","setDate","reshowTimeout","scroll","clearTimeout","visibleAndActive","elementFromPoint","GridWidgetResource","endRow","startRow","endColumn","HalResourceNotificationService","isCreate","handleErrorResponse","errorBody","retrieveError","showGeneralError","createHalResourceOfClass","errorResource","showError","showApiErrorMessages","showCustomError","attributeName","details","i18nString","lookup","MembershipDmService","listRequest","availableProjectsUrl","OpContextMenuTrigger","Mousetrap","OpenprojectHalModuleHelpers","lazy","obj","setter","isObject","done","configurable","enumerable","defineProperty","ObservableArray","cloneHalResourceCollection","v","initializeHalProperties","halResource","asHalResource","loaded","_embedded","setupProperty","instanceName","sourceName","sourceObj","propName","setSource","$embeddableKeys","createLinkedResource","setEmbeddedAsProperties","KeepTabService","updateTabs","isCurrentState","currentShowTab","currentDetailsTab","lastActiveTab","currentShowState","updateTab","WorkPackageViewTimelineService","appliedZoomLevel$","defaultState","timelineZoomLevel","labels","timelineLabels","visibilityChanged","zoomLevelChanged","labelsChanged","currentState","setVisible","defaultLabels","modify","positionAsString","level","applyZoomLevel","applied","appliedZoomLevel","setZoomLevel","idx","farRight","ColorsService","valueHash","opacity","hash","charCodeAt","WorkPackageSplitViewComponent","firstRoute","backRouting","observeWorkPackage","isFirstRoute","isSameID","workPackageI","setRowState","whenChanged","goToBaseState","initializeTexts","closeDetailsView","goTofullScreen","WorkPackageFilterByTextInputComponent","searchTermChanged","pristine$","currentSearchFilter","upstreamTerm","timestampOfLastValue","isValueOlderThan","findOperator","ResourcesDisplayField","cf","abridged","optionDiv","valueAbridged","valueForDisplay","WorkPackageContextMenuHelperService","wpViewRepresentation","wpViewTimeline","wpViewIndent","BULK_ACTIONS","permittedActionConstants","allowSplitScreenActions","singularPermittedActions","getAllowedActions","getAllowedParentActions","getAllowedRelationActions","allowedAction","bulkPermittedActions","permittedAction","getBulkActionLink","workPackageIdParams","serializedIdParams","linkAndQueryString","shift","addChild","getPermittedActionLinks","getIntersectOfPermittedActions","queryColumnTypes","isRelationColumn","OpDateTimeComponent","formattedDatetimeComponents","dateTimeValue","enterpriseEditionUrl","enterpriseDemoUrl","randomString","pattern","random","_element","charAt","floor","Highlighting","colorClass","highlightColorTextInline","overdueDate","isBright","styles","variable","getPropertyValue","AutofocusDirective","focusHelper","condition","CustomActionResource","ApiV3FilterBuilder","filterMap","only","toAdd","pickBy","toFilterObject","mergeParams","transformedFilters","serializeFilter","URLSearchParams","transformedFilter","typeName","operatorAndValues","serializeFilterValue","filterValue","buildApiV3Filter","WorkPackageRelationQueryBase","queryUrlParamsHelper","embeddedTable","isInitialized","filtersLength","projectValuesCount","loadedFiltersLength","valid_subset","webpackContext","webpackContextResolve","__webpack_require__","code","exports","CommentService","workPackageNotificationService","quoteEvents","comment","addComment","errorAndReject","WorkPackageRelationsCountComponent","relationCount","childrenCount","WorkPackageSingleCardComponent","showInfoButton","showStatusButton","showRemoveButton","draggable","orientation","shrinkOnMobile","onRemove","uiStateLinkClass","detailsView","cardHighlighting","attributeHighlighting","bcfSnapshotPath","bcfViewpoints","CardDblClickHandler","ChangesetStates","changesets","initializeMembers","ResourceChangesetCommit","saved","changeMap","HalResourceEditingService","hook","stateGroup","buildRequestPayload","retainFrom","onSaved","multiState","newChangeset","hrefs","tree","selectedPage","FilterDateTimesValueComponent","begin","OpModalComponent","openingEvent","modalElement","MainMenuToggleService","elementMinWidth","defaultWidth","localStorageKey","localStorageStateKey","global","htmlNode","getElementsByTagName","mainMenu","hideElements","titleData","titleData$","changeData","changeData$","elementWidth","guardedLocalStorage","menuCollapsed","closeMenu","setWidth","saveWidth","offsetWidth","showNavigation","savedWidth","widthToSave","maxMenuWidth","snapBack","setToggleTitle","toggleClassHidden","changeEvent","Event","toggleTitle","groupByProperty","groupName","groupedRowClassName","FilterBooleanValueComponent","true","false","webpackAsyncContext","PERMITTED_CONTEXT_MENU_ACTIONS","UserDmService","hint","button_save","selectedPageInput","applyAndClose","_language","debouncedLanguageLoader","debounce","loadLanguageAsMode","language_hint","languageClass","codeMirrorInstance","lang","imported","CodeMirror","fromTextArea","codeMirrorPane","lineNumbers","smartIndent","autofocus","updateCodeMirrorMode","newLanguage","setOption","updateLanguage","includeParent","include_parent","selectedIncludeParent","updateIncludeParent","pageValue","ActivityEntryComponent","activityType","WpButtonMacroModal","none","selected_type","button_style","button_style_hint","selectedType","buttonStyle","availableTypes","typeSelect","PaginationInstance","limit","min","WorkPackageTableConfiguration","providedConfig","inlineCreateEnabled","hierarchyToggleEnabled","isCardView","filtersExpanded","showFilterButton","filterButtonText","StateCacheService","holdValuesForSeconds","cacheDurationInMs","stale","clearAndPutFromPromise","idsToRequest","loadAll","WpDestroyModal","busy","childrenDeletionConfirmed","label_visibility_settings","warning","label_confirm_children_deletion","workPackageLabel","singleWorkPackage","singleWorkPackageChildren","childCount","hasChildren","childUnits","deletesChildren","mustConfirmChildren","blockedDueToUnconfirmedChildren","performBulkDelete","confirmDeletion","HelpTextDmService","WpTableConfigurationDisplaySettingsTab","wpTableSums","displayMode","availableGroups","displaySums","choose_mode","label_group_by","display_sums","display_sums_hint","display_mode","grouped","hierarchy_hint","setEnabled","updateGroup","isAscendingOrder","buildInsertPosition","rebuildPositions","minMaxPositions","redistribute","abs","positionSwap","insertAsFirst","predecessorPosition","buildUpPredecessorPosition","reorderedInsert","successorPosition","positionFor","distance","myPosition","neighbor","neighborPosition","DEFAULT_ORDER","livePosition","firstPosition","lastPosition","itemsToDistribute","space","any","queryOrderDm","causedUpdates","assignPosition","buildDelta","upstreamOrder","pos","OpEditingPortalSchemaToken","OpEditingPortalHandlerToken","OpEditingPortalChangesetToken","editModeClassName","EditFieldComponent","markForCheck","parseValue","WorkPackageWatchersService","$update","FormattableEditFieldComponent","initializationError","isPreview","previewHtml","editorType","getEditorTypeFor","registerOnSubmit","getCurrentValue","attachmentLabel","getTransformedContent","previewContext","SaveQueryModal","queryName","isStarred","isPublic","save_as","label_name","queryNameField","savedQuery","saveQueryAs","VersionDmService","WorkPackageCopyFullViewComponent","successState","wpDisplayListRepresentation","wpDisplayCardRepresentation","WorkPackageViewDisplayRepresentationService","representation","WorkPackageRelationsHierarchyService","childWpId","wpToBecomeChild","args","parent_id","childWorkPackage","parentWorkPackage","WorkPackageFormAttributeGroupComponent","elem","descriptor","registerWorkPackageMouseHandler","getRenderInfo","workPackageTimeline","bar","renderer","renderInfo","dateStates","placeholderForEmptyCell","mouseDownStartDay","jBody","getCursorOffsetInDaysFromLeft","leftOffset","getAbsoluteLeftCoordinates","cursorOffsetLeftInPx","createMouseMoveFn","offsetDayCurrent","offsetX","dayUnderCursor","onDaysMoved","assignDateValues","applyDateValues","keyPressFn","handleMouseMoveOnEmptyCell","isLeaf","canMoveDates","displayPlaceholderUnderCursor","onmouseleave","onmousedown","pointerEvents","offsetDayStart","dateForCreate","mouseDownType","onMouseDown","onmousemove","widthInDays","moved","onmouseup","cancelled","disableViewParamsCalculation","noop","resetCursor","onMouseDownEnd","refreshView","stopAndRefresh","queryDm","loadIdsUpdatedSince","workPackageCollection","updateWorkPackageList","saveWorkPackage","workPackageMouseDownFn","WorkPackageCellLabels","center","leftHover","rightHover","renderers","latestRenderInfo","wpElement","cellRenderer","getMarginLeftOfLeftSide","getMarginLeftOfRightSide","getPaddingLeftForIncomingRelationLines","getPaddingRightForOutgoingRelationLines","isMilestone","cellElement","html","cellContainer","elementShape","createAndAddLabels","milestone","generic","lazyInit","dateDisplaysOnMouseMove","valueOf","zIndex","applyTypeColor","assignDate","updateLabels","initialStartDate","initialDueDate","projection","forceCursor","visibility","backgroundImage","offsetStart","duration","minWidth","checkForActiveSelectionMode","checkForSpecialDisplaySituations","labelCenter","labelLeft","containerRight","labelRight","labelFarRight","labelHoverLeft","labelHoverRight","bg","selectionMode","isParentWithVisibleChildren","borderStyle","borderWidth","borderBottom","activeDragNDrop","labelConfiguration","getNormalizedLabels","renderLabel","renderHoverLabels","inHierarchyMode","diamond","initialDate","marginLeft","ri","wpTimeline","cellRenderers","getCellsFor","synchronizeCells","refreshSingleCell","renderInfoFor","currentlyActive","workPackageIdOrder","wpTableDirective","_viewParameters","cellsRenderer","selectionParams","refreshRequest","outerContainer","registerTimeline","orderedRows","timelineState","isAutoZoom","applyAutoZoomLevel","calculateViewParams","refreshAllCells","currentWidth","scrollWidth","activateSelectionMode","getParentScrollContainer","nonVisibleDaysLeft","viewPortRight","daysUntilViewPortEnds","resetSelectionMode","currentParams","newParams","subtract","dayCountForMarginLeft","visibleDays","isSame","getFirstDayInViewport","getLastDayInViewport","daysSpan","timelineWidthInPx","confirmDialog","confirmDelete","showAnchorRight","isSortable","setAsSingleSortCriteria","addSortCriteria","isGroupable","isCurrentlyGroupedBy","setBy","isFirst","focusColumn","removeColumn","wpTimelineService","workPackageTimelineTableController","onRefreshRequested","innerHeader","renderLabels","activeZoomLevel","renderLabelsDays","renderLabelsWeeks","renderLabelsMonths","renderLabelsQuarters","renderLabelsYears","renderTimeSlices","quarter_number","marginTop","cellCallback","addLabelCell","workPackagePrefix","TimelineRelationElement","belongsToId","newSegment","yPosition","color","workPackagesWithRelations","setupRelationSubscription","wps","relationsForWorkPackage","renderWorkPackagesRelations","workPackageWithRelation","removeRelationElementsForWorkPackage","renderElement","removeAllVisibleElements","renderElements","wpIdsWithRelations","involved","startCells","workPackageCells","endCells","startCell","idxFrom","workPackageIndex","endCell","idxTo","renderRelation","rowFrom","rowTo","canConnectRelations","startX","targetX","directionY","directionX","paddingRight","startLineWith","lastX","finishElement","offsetToday","dayProgress","checkForWeekendHighlight","day","gridContainer","paddingTop","WorkPackageWatcherEntryComponent","panelCtrl","deleting","watcher","removeWatcher","sum","sumsSchema","renderContent","totalSums","appendFirstLabel","factoryFor","relatedTo","refreshTable","getRelationTypeFromQuery","buildQueryProps","toId","configureTable","openTableConfigurationModal","bootstrapAttributeGroups","bootstrapAttributeGroupsCalled","hookService","WorkPackagesListChecksumService","newQueryChecksum","getNewChecksum","routePromise","isUninitialized","isIdDifferent","maintainUrlQueryState","isChecksumDifferent","isOutdated","checksum","visibleChecksum","otherId","otherChecksum","hasCurrentQueryID","hasCurrentChecksum","idChanged","checksumChanged","visibleChecksumChanged","pick","WorkPackageViewHandlerToken","WorkPackageViewHandlerRegistry","factory","eventScope","EVENT","handleEvent","WorkPackageCardViewService","CardViewHandlerRegistry","ExternalQueryConfigurationComponent","openConfigurationModal","BoardCacheService","boardDm","_state","UserActivityComponent","sanitization","wpLinkedActivities","commentService","userCacheService","userCanEdit","userCanQuote","focused","label_created_on","label_updated_on","quote_comment","edit_comment","updateCommentText","isComment","isBcfComment","detail","userName","userAvatar","focussing","rawComment","updateComment","quotedText","newActivity","finally","quoted","line","focusEditIcon","postedComment","bypassSecurityTrustHtml","SortHeaderDirective","toggleHierarchy","openMenu","sortColumn","onReadyWithAvailable","latestSortElement","headerColumn","currentSortDirection","setActiveColumnClass","sortable","directionClass","getDirectionClass","isHierarchyColumn","columnType","columnName","hierarchyIcon","isHierarchyDisabled","setHierarchyIcon","toggleState","disable","BoardService","boardCache","boardActions","boardsList","currentBoard$","unnamed_board","action_board","unnamed_list","loadAllPromise","allInScope","boards","buildOrderAndUpdate","reorderWidgets","sortWidgets","boardName","addFreeQuery","addActionQueries","WorkPackageTypeStatusComponent","v3ErrorIdentifierMultipleErrors","ErrorResource","isMultiErrorMessage","extractMultiError","perAttribute","ConfigurationDmService","$configuration","WorkPackageViewToggleButton","detectView","OpenprojectEditorModule","WorkPackageViewFocusService","focusAfterRender","setFocusAfterRender","withLoadingIndicator","delayStopTime","source$","delayedStop","stop","withDelayedLoadingIndicator","LoadingIndicator","indicatorTemplate","stopper","LoadingIndicatorService","getIndicatorAt","DebouncedEventEmitter","takeUntil$","emitter","debouncer","generatorOrNext","AttributeHelpTextModal","editText","SortModalObject","WpTableConfigurationSortByTab","sort_criteria_1","sort_criteria_2","sort_criteria_3","sorting_mode","automatic","manually","availableDirections","availableColumns","allColumns","sortationObjects","emptyColumn","sortingMode","sortElements","manualSortColumn","getMatchingSort","getManualSortingOption","updateSortingMode","updateUsedColumns","fillUpSortElements","usedColumns","WpRelationInlineCreateService","removeRelation","toState","fromState","fromParams","WorkPackagesBaseComponent","onClickOrEnter","ClickOrEnterHandler","processEvent","ProjectDmService","WorkPackageSubjectComponent","uiRouterGlobals","uniqueElementIdentifier","WorkPackageNewSplitViewComponent","chartType","WpIsolatedGraphQuerySpaceProviders","TimeEntryFormComponent","showWorkPackageField","modifiedEntry","spentOn","wpRequired","workPackageSelected","setCustomFields","entries","keySchema","signalModifiedEntry","paginationService","getCachedPerPage","updateFromObject","OpenProjectFileUploadService","upload","uploadUrl","staticDownloadLocation","uploadSingle","whenFinished","formData","FormData","metadata","reportProgress","promises","observable","Response","PartitionedQuerySpacePageComponent","showToolbar","toolbarButtonComponents","filterAllowed","currentPartition","filterContainerDefinition","showToolbarSaveButton","setPartition","removeTransitionSubscription","isFirstLoad","setupInformationLoadedListener","queryParamListener","unRegisterTitleListener","updateTitle","onQueryUpdated","removeQueryChangeListener","updateTitleName","toolbarDisabled","getStaticName","titleEditingEnabled","shouldUpdateHtmlTitle","visibly","loadFirstPage","reloadCurrentResultsList","additionalLoadingTime","loadCurrentQueryFromParams","changeChangesFromTitle","FilterIntegerValueComponent","WorkPackageSingleViewComponent","showProject","groupedFields","resourceContextChange","switchTo","infoRow","createdBy","lastUpdatedOn","firstTimeFocused","contextFrom","projectWorkPackagePath","apiv3Path","inProjectContext","getFields","attributeGroups","_attributeGroups","rebuildGroupedFields","members","queryInNew","projectname","groupId","getAttributesGroupId","isolated","fieldNames","descriptors","getDateField","displayField","spanAll","schemaHref","projectHref","baseSchema","overflowingIdentifier","DateDisplayField","showSchedulingMode","schedulingIcon","scheduleManually","canOverdue","daysFromToday","BrowserDetector","documentElement","hasBodyClass","WpTableConfigurationFiltersTab","columnsLabel","selectedColumns","multiSelectLabel","upsaleRelationColumns","upsaleRelationColumnsLink","replaceIfComplete","NotificationComponent","uploadCount","checkedClassName","UiStateLinkBuilder","AbstractDmService","listUrl","oneUrl","listParamsString","filterParam","queryPropsString","webpackEmptyAsyncContext","timeoutAfter","nextValue","autoHidePopups","createNotification","createAttachmentUploadNotification","QueryFilterResource","SchemaCacheService","forceUpdate","OpTitleService","getTitle","titleParts","setTitle","activeFieldContainerClassName","activeFieldClassName","EditForm","errorsPerAttribute","loadFieldSchema","renderField","showEditingBlockedError","requireVisible","activateWhenNeeded","openFields","handleSubmissionErrors","resetChange","handleErroneousAttributes","erroneousAttributes","getInvolvedAttributes","getMessagesPerAttribute","setErrorsForFields","erroneousFields","focusOnFirstError","loadFormAndCheck","activateField","prototype","padding","number","substr","isFunction","func","isSet","isString","isBoolean","decimalAdjust","exp","NaN","lazyEvaluate","scope","dest","DATE","day_names","abbr_day_names","month_names","abbr_month_names","meridian","NUMBER_FORMAT","precision","delimiter","strip_insignificant_zeros","CURRENCY_FORMAT","sign_first","PERCENTAGE_FORMAT","SIZE_UNITS","DEFAULT_OPTIONS","defaultLocale","defaultSeparator","fallbacks","translations","missingBehaviour","missingTranslationPrefix","initializeOptions","locales","localeParts","firstFallback","secondFallback","nullableFallbackLocale","pluralization","currentLocale","scopes","fullScope","getFullScope","pluralizationLookupWithoutFallback","pluralizerKey","pluralizerKeys","pluralizer","pluralizationLookup","am","pm","prepareOptions","arguments","createTranslationOptions","translationOptions","translate","translation","optionsWithoutDefault","translationOption","interpolate","pluralize","missingTranslation","regex","nullPlaceholder","missingPlaceholder","s","p1","p2","toNumber","formattedNumber","negative","toFixed","buffer","sign","toCurrency","localize","toPercentage","localizedValue","toTime","convertedDate","fraction","UTC","setTime","$1","$2","$3","$6","$4","$5","strftime","meridianOptions","getTime","weekDay","getDay","getDate","year","getFullYear","month","getMonth","getHours","hour12","secs","getSeconds","mins","getMinutes","getTimezoneOffset","absOffsetHours","absOffsetMinutes","timezoneoffset","dateString","toHumanSize","iterations","obj1","obj2","p","WorkPackagesGridComponent","wpTableHighlight","wpList","showResizer","resizerClass","resizerStorageKey","gridOrientation","WorkPackageFilterContainerComponent","visible$","OpDatePickerComponent","initializeDatepicker","datePickerInstance","inputIsValidDate","relatedTarget","calendarContainer","inputElement","dateInput","initialValue","allowInput","selectedDates","dateStr","onKeyDown","parseISODate","toDate","openOnClick","onInputChange","WorkPackageViewSelectionService","selectedWorkPackageIds","activeRowIndex","_emptyState","wpState","getSelectedWorkPackageIds","selectionCount","renderedElements","selectAll","WpResizerDirective","resizeStyle","moving","resizingElement","elementClass","localStorageValue","parseLocalStorageValue","toggleFullscreenColumns","resizer","applyColumnLayout","actualElementWidth","resizeEvent","dispatchEvent","manageErrorClass","deltas","relative","newWidth","toggleColumns","checkWidth","fullScreenLeftView","shouldBePresent","resizeEnd","resizeStart","resizeMove","WpChildrenInlineCreateService","addExistingChildWp","canAddChild","WorkPackageFilterValues","excluded","filterAlreadyApplied","setValueFor","findSpecialValue","isLoggedIn","fromSelfLink","BannersService","_banners","bannersVisible","bannersNotVisible","callMaybe","WorkPackageListViewComponent","wpViewFilters","showListView","tableInformationLoaded","showResultOverlay$","incomplete$","wpTableConfiguration","updateViewRepresentation","valueFromQuery","ckeditorAugmentedTextareaSelector","CkeditorAugmentedTextareaComponent","Notifications","isEditing","textareaSelector","formElement","wrappedTextArea","removeAttr","initialContent","$attachmentsElement","pageWasEdited","setupAttachmentAddedCallback","setupAttachmentRemovalSignal","ckEditorInstance","getRawData","addUploadedAttachmentsToForm","setLabel","model","removedUrls","downloadLocation","fire","textareaId","substring","ckContent","maxValue","toArray","addedAttachments","setup","markEdited","WorkPackageAutocompleterComponent","changeModel","opened","closed","keyPressed","WorkPackageOverviewTabComponent","WorkPackageLinkedResourceCache","cacheDurationInSeconds","isCached","WpTableConfigurationTimelinesTab","availableZoomLevels","display_timelines","display_timelines_hint","zoom","weeks","quarters","years","auto","availableLabels","allPropertyColumns","availableAttributes","OpQueryConfigurationLocalsToken","OpQueryConfigurationTriggerEvent","WorkPackageCardViewComponent","wpViewOrder","cardDragDrop","cardsRemovable","showEmptyResultsBox","isResultEmpty","addNewCard","inReference","referenceOutputs","setReferenceMode","onReferenced","updateRenderedCardsValues","registerDragAndDrop","registry","onCardSaved","CollectionResource","WorkPackageViewPageComponent","inputs","stateName$","containerClasses","button_settings","WpRelationInlineAddExistingComponent","queryFilters","buildQueryFilters","newRelationId","addExisting","buildV3GetFilterIdFromFilter","buildV3GetFilters","HalResourceSortingService","halType","sortingProperty","States","posts","timeEntries","QueryAvailableDataStates","GlobalStateChanges","camelCase","WorkPackageBaseResource","truncateSubject","truncate","otherWorkPackage","resourceNames","linked","touch","createWorkPackage","hasOverriddenSchema","WorkPackageResource","TimeEntryWorkPackageAutocompleterComponent","modeSwitch","errorNotificationHandler","DebouncedRequestSwitchmap","requestHandler","errorHandler","debounceMs","loading$","lastResult","output$","until","TimeEntryDmService","payloadDm","attachmentsSelector","AttachmentsComponent","allowUploading","DraggableAutocompleteComponent","dragula","_selected","updateAvailableOptions","columnsGroup","createGroup","drag","drop","autoscroll","drake","dragging","clearModel","cfg","_dataDir","dataDir","_error","ifc_models","projectData","models","viewerContent","modelsLoaded","shown_models","viewerConfigs","saoEnabled","_projectId","modelId","attachmentId","metadata_attachment_ids","utils","loadJSON","attachmentUrl","xkt_attachment_ids","loadArraybuffer","XeokitViewerModule","server","viewerUI","BIMViewer","alert","objectName","objectType","objectId","loadProject","viewer","_viewer","setKeyboardEnabled","saveBCFViewpoint","spacesVisible","bitmaps","routeWithViewer","viewpointsService","getViewPoint$","loadBCFViewpoint","bimDetailsPath","TimezoneService","setupLocale","datetime","isTimezoneSet","local","tz","getTimeFormat","utc","getDateFormat","today","datetimeString","durationString","asHours","toHours","dateTime","dateFormatPresent","timeFormatPresent","timeFormat","QuerySharingForm","showInMenu","visibleForOthers","showInMenuText","visibleForOthersText","isSave","updatePublic","updateStarred","OpCkeditorComponent","ckEditorSetup","ckEditorType","onInitialized","onContentChange","onInitializationFailed","allowManualMode","manualMode","errorTitle","debouncedEmitter","leading","_content","notificationOnError","newVal","initializeEditor","editorPromise","opCkeditorReplacementContainer","enableManualMode","disableManualMode","WorkPackageStaticQueriesService","CurrentUserService","assignee","created_at","updated_at","gantt","latest_activity","created_by_me","assigned_to_me","recently_created","all_open","summary","pp","pa","matched","HalResourceService","httpError","expected","retrieved","allResults","toEprops","getEmptyResource","getResourceClassOfType","fromType","toType","getResourceClassOfAttribute","defaultClass","typeConfig","deflated","eprops","btoa","WpCustomActionComponent","wpSchemaCacheService","savedWp","fetchAction","WorkPackageNewFullViewComponent","EditFieldHandler","_onSubmitHandlers","AccessibleClickDirective","SPACE","DEFAULT_PAGINATION_OPTIONS","PaginationService","loadPaginationOptions","initialPageOptions","localStoragePerPage","initialLength","paginationOptions","perPageOptions","maxVisiblePageOptions","optionsTruncationSize","WorkPackageFiltersService","WorkPackagesListInvalidQueryService","queryFormDm","buildQueryResource","restoreFilters","restoreColumns","restoreSortBy","restoreGroupBy","restoreOtherProperties","querySchema","filterInstanceSchema","recreatedFilter","stubQuery","sortBys","WpCustomActionsComponent","customActions","opIconElement","OPContextMenuComponent","ViewerBridgeService","WorkPackageTablePaginationComponent","wpPagination","showPerPage","showPageSelections","infoText","paginationInfoText","setPerPage","pageNumber","UploadProgressComponent","completed","Sent","UploadProgress","updateProgress","WorkPackageRelationsComponent","relationGroups","relationGroupKeys","relationsPresent","relations_header","currentRelations","loadedRelations","observablesToGetZipped","buildRelationGroups","normalizedType","relatedBy","stateValues","relatedWpIds","relatedWpId","getRelatedWorkPackageId","getRelatedWorkPackages","relatedWorkPackages","WorkPackageSplitViewToolbarComponent","button_more","ActivityEntryInfo","forceReverse","orderedIndex","activityDate","version","dateOfPrevious","commentsSortedInDescendingOrder","aggregated","sortedActivityList","sorted","TablePaginationComponent","hideForSinglePageResults","updateResults","label_previous","label_next","per_page","no_other_page","currentRange","pageNumbers","postPageNumbers","prePageNumbers","totalEntries","updateCurrentRangeLabel","updatePageNumbers","showPage","onUpdatedPage","totalItems","lowerBound","getLowerPageBound","upperBound","getUpperPageBound","maxVisible","getMaxVisiblePageOptions","truncSize","getOptionsTruncationSize","currentPage","startingDiff","truncatePageNums","perform","disectFrom","disectLength","truncateFrom","truncationSize","truncatedNums","ViewpointsService","viewpointHref","bcfApi","getViewPointResource","wpCache","wpProjectId","topicUUID$","setBcfTopic$","viewpoint$","viewerBridge","getViewpoint$","topicUUID","topicHref","bcfTopic","createBcfTopic$","wpPayload","convertBCF","guid","VersionAutocompleterComponent","versionDm","openDirectly","onCreate","canCreateNewActionElements","createAllowed","createNewVersion","canCreateVersionInProject","createVersion","getVersionPayload","closeSelect","definingProject","GridDmService","rowGroupClassName","collapsedRowClass","UserCacheService","userDmService","AttributeHelpTextsService","helpTexts","ExternalQueryConfigurationService","originator","_portalHostElement","_bodyPortalHost","externalQueryConfigurationComponent","hasAttached","RevisionActivityComponent","loadAuthor","revision","revisionPath","showRevision","formattedRevision","formattedIdentifier","revision_identifier","revisionLink","committed_revision_link","formattedDatetime","authorName","userActive","showUser","userLabel","floatValue","parseFloat","parsedValue","SelectAutocompleterRegisterService","_fields","assignment","valuesLoaded","newElement","onKeydown","handleUserKeydown","onAfterViewInit","_autocompleterComponent","requiredPlaceholder","valuesLoadingPromise","initialValueLoading","loadValues","selectAutocompleterRegister","getAutocompleterOfAttribute","overflowingSelector","valueOptions","availableValues","sortValues","addEmptyOption","mapAllowedValue","loadValuesFromBackend","tap","cacheKey","cacheValue","fetchAllowedValueQuery","allowedValuesFilter","addValue","selectedOption","emptyOption","getEmptyOption","isRequired","currentValueInvalid","requestFocus","nullOption","openAutocompleteSelectField","findValueOption","_selectedOption","adjustPosition","valueOption","sortValuesByName","nameA","nameB","buildSelectedOption","checkCurrentValueValidity","filterParams","prefix","suffix","onValueSelected","projectStatusCodeCssClass","ensureDefaultCode","projectStatusI18n","_availableStatusCodes","currentStatusCode","availableStatuses","recentWorkPackageIds","timeEntryDm","timeEntry","sortValuesByRecentIds","showDatePickerModal","toLocaleString","useGrouping","maximumFractionDigits","bootstrapOptionalEmbeddable","unescape","UNESCAPED_EXPRESSION","ESCAPED_EXPRESSION","derivedText","formattedDuration","derivedPropertyName","derivedValue","actual","renderActual","derived","renderDerived","derivedValueString","actualPresent","valueEmpty","derivedEmpty","translatedValue","linkTitle","logTime","wpID","projectCacheService","URI","projectTimeEntriesPath","work_package_id","appendTimelogLink","timelogElement","showTimelogWidget","addHighlight","hlClass","renderAbridgedValues","dots","uiStateBuilder","linkToShow","innerText","OpenprojectFieldsModule","editFieldService","selectAutocompleterRegisterService","addSpecificFieldType","FocusDirective","uiStatebuilder","detailsLink","linkToDetails","contextMenu","built","buildElement","FirstRouteService","WorkPackageFilterButtonComponent","setupObserver","currentlyVisibleFilters","UrlParamsHelperService","paramsData","encodeColumns","encodeSums","encodeTimelineVisible","encodeHighlightingMode","encodeHighlightedAttributes","hi","g","encodeSortBy","encodeFilters","dr","hl","hla","queryFilterValueToParam","tv","tll","tzl","updateJson","getPerPage","showSums","urlFilter","vs","filterData","contextual","buildV3GetColumnsFromQueryResource","buildV3GetFiltersAsJson","buildV3GetSortByFromQuery","idFromHref","replacements","buildV3GetOperatorIdFromFilter","buildV3GetValuesFromFilter","filterHash","sortByIds","BackRoutingService","preferListOverSplit","backRoute","isDetailsState","paramsFromCopy","route","_backRoute","TableDragActionService","shadowElement","backToDefault","determineParent","relationHierarchyService","isFlatList","relationRoot","findRelationRowRoot","previousWpId","isHiearchyRoot","loadParentOfWP","inGroup","isRoot","groupedAttribute","groupedValue","getValueForGroup","groupHeader","applies","tdClassName","editCellContainer","CellBuilder","displayElement","FilterStringValueComponent","enter_text","whenDebugging","debugLog","timeOutput","msg","WorkPackageNotificationService","addWorkPackageFullscreenLink","QUERY_SORT_BY_ASC","QUERY_SORT_BY_DESC","WorkPackageRelationsTabComponent","WorkPackageViewContextMenu","selectedWorkPackages","getSelectedWorkPackages","WorkPackageContextMenuHelper","deleteSelectedWorkPackages","editSelectedWorkPackages","copySelectedWorkPackages","addNewChildWp","logTimeForSelectedWorkPackage","screenfull","zenModeComponentSelector","ZenModeButtonComponent","enabled","onchange","isFullscreen","deactivateZenMode","inZenMode","exit","activateZenMode","TimeEntryResource","InjectField","token","Reflect","getMetadata","_val","WpTableConfigurationColumnsTab","availableColumnsOptions","column2Like","availableColumnsMap","keyBy","selectedColumnMap","columnsHelp","upsaleCheckOutLink","setColumnsById","updateSelected","WorkPackagesFullViewComponent","full_view","setWorkPackageScopeProperties","displayWatchButton","WorkPackageSingleViewBase","tabs","subjectWithType","showStaticPagePath","updateFocusAnchorLabel","tabLabel","focusAnchorLabel","WorkPackageRelationRowComponent","showRelationInfo","userInputs","newRelationText","showDescriptionEditForm","showRelationTypesForm","fieldController","removeButton","description_label","toggleDescription","updateRelation","availableRelationTypes","textarea","relationDescriptionTextarea","textlen","cancelDescriptionEdit","savedRelation","updateRelationType","BoardListsService","filterJson","buildQueryRequest","freeBoardQueryFilter","addQuery","manualSort","wpEmbeddedTableMacroSelector","EmbeddedTablesMacroComponent","CurrentProjectService","detect","getCurrent","projectName","OpUnlinkTableAction","WpTableConfigurationModalPrependToken","WpTableConfigurationModalComponent","prependModalComponent","applyButton","wpTableConfigurationService","tabPortalHost","tabContentOutlet","activeComponents","saveChanges","WorkPackageChildrenQueryComponent","addExistingChildEnabled","WorkPackageStatusDropdownDirective","postIcon","postIconTitle","updateStatus","CreateAutocompleterComponent","finishedLoading","hideSelected","add_new_action","_openDirectly","openSelect","ModalWrapperAugmentService","wrapElement","activationLink","activationSelector","iframeUrl","appendIframe","subdom","iframe","WpTableConfigurationService","FocusWithinDirective","focusedObservable","DragAndDropService","escapeListener","containers","member","setupAutoscroll","initializeDrake","setOuterScrollContainer","getMember","invalid","copy","revertOnSpill","removeOnSpill","mirrorContainer","ignoreInputTextSelection","QuerySharingModal","saveQuery","OpenprojectCommonModule","routerState","addContext","setUser","email","mail","setTag","setExtra","bootstrapModule","withComponents","userAvatarSelector","UserAvatarComponent","RelationStateGroup","WorkPackageRelationsService","relationsDm","relationStates","updateRelationsStateTo","loadInvolved","accumulateRelationsFromInvolved","removeFromStates","insertIntoStates","relationsToInsert","relevant","isInvolved","getWorkPackageId","WorkPackageCacheService","immediate","skipOnIdentical","loadWorkPackagesCollectionsFor","pagedResults","loadWorkPackageById","GridBaseResource","widgetResource","GridResource","WorkPackageTimelineButtonComponent","minZoomLevel","maxZoomLevel","isMaxLevel","isMinLevel","zoomIn","zoomOut","zoomAuto","updateZoomWithDelta","toggleTimeline","enableAutozoom","ScrollableTabsComponent","currentTabId","hideLeftButton","hideRightButton","pane","scrollPane","determineScrollButtonVisibility","scrollIntoVisibleArea","clientWidth","tabId","tabRightBorderAt","outerWidth","onScroll","scrollRight","ResizerComponent","resizing","customHandler","cursorClass","buttons","oldX","pageX","touches","oldY","startY","pageY","newX","newY","setResizeCursor","bindEventListener","setAutoCursor","mouseMoveHandler","onMouseMove","mouseUpHandler","onMouseUp","origin","absolute","userMeta","registerRequestForConfirmation","getPluginContext","services","passwordConfirmationModal","modals","passwordConfirmation","password_confirmation","registerListener","augmentedDatePicker","linkElement","hashPos","performAnchorHijacking","pageIsSubmitted","marginBottom","returnValue","inputId","serialize","refreshOnFormChanges","prevScrollPos","currentScrollPos","scrollHeaderOnMobile","WorkPackageCommentComponent","editTitle","cancelTitle","fieldLabel","canAddComment","showAbove","quote","commentContainer","scrollToBottom","wpDetails","createComment","scrollableContainer","scrollHeight","edition","localStorage","setItem","bcfPathHelper","snapshotPath","BcfDetectorService","revitMessageReceivedSource","_trackingIdNumber","_ready$","revitMessageReceived$","RevitBridge","hookUpRevitListener","trackingId","newTrackingId","sendMessageToRevit","messageType","viewpointJson","messagePayload","snapshot","snapshot_type","snapshot_data","viewerVisible","jsonPayload","sendMessageToOpenProject","messageString","mapTo","authorizationMap","extension","authorized$","bcfAuthorization","bcf","add_viewpoint","show_viewpoint","delete_viewpoint","text_are_you_sure","notice_successful_create","notice_successful_delete","galleryOptions","thumbnailsColumns","thumbnailsAutoHide","thumbnailSize","imageAnimation","previewAnimation","previewCloseOnEsc","previewKeyboardNavigation","imageSize","imageArrowsAutoHide","thumbnailsMargin","thumbnailMargin","previewDownload","previewCloseOnClick","arrowPrevIcon","arrowNextIcon","closeIcon","downloadIcon","thumbnailActions","breakpoint","imagePercent","thumbnailsPercent","galleryImages","viewAllowed","observeChanges","refreshViewpoints","isAllowedTo","loadViewpointFromRoute","snapshotURL","setViewpointsOnGallery","showViewpoint","deleteViewPoint$","gallery","saveViewpoint$","showIndex","selectViewpointInGallery","titleText","deleteViewpoint","setThumbnailProperties","small","medium","big","viewpointCount","dynamicThumbnailHeight","galleryViewpoints","observeCreation","switchMap","observables","viewPointItem","forkJoin","newViewpoint","bootstrapCalled","isBimEdition","navigator","userAgent","regions","datepicker","regional","firstDay","setDefaults","gotoToday","_gotoToday","inst","_getInst","_formatDate","_hideDatepicker","showWeek","changeMonth","changeYear","yearRange","showButtonPanel","calculateWeek","dayOfWeek","iso8601Week","_originalGotoToday","_selectDate","_inlineDatepicker2","_inlineDatepicker","beforeShow","_get","_checkOffsetOriginal","_checkOffset","isFixed","_offset","alterOffset","inp","customDateActionAdminSelector","CustomDateActionAdminComponent","valueVisible","onKey","currentKey","currentFieldValue","operators","fieldValue","selectedOperator","visibleValue","toggleValueVisibility","updateDbValue","I18nService","_i18n","translateId","parameters","WorkPackageViewHierarchies","setState","initialState","CausedUpdatesService","EnterpriseBannerComponent","leftMargin","enterpriseFeature","opReferrer","AbstractWorkPackageButtonComponent","labelKey","textKey","activationPrefix","deactivationPrefix","createdEntry","setModifiedEntry","createNewTimeEntry","OpenprojectAttachmentsModule","indicatorCollapsedClass","additionalHierarchyRowClassName","SingleHierarchyRowBuilder","leaf","appendHierarchyIndicator","hierarchyLevel","hierarchyElement","buildHierarchyIndicator","hierarchyIndicator","indicatorWidth","indentation","BcfImportButtonComponent","import","projectImportIssuePath","TimeEntryBaseModal","areYouSure","workPackageCacheService","UserResource","active_user_statuses","boardsMenuSelector","BoardsMenuComponent","boardService","trackById","currentProjectIdentifier","boards$","observeAll","focusBackArrow","loadAllBoards","selectedBoardId","CardRightClickHandler","DatepickerHelper","currentlyActivatedDateField","datePicker","setDatepickerRestrictions","isStateOfCurrentActivatedField","selectedElements","selectRangeFromUntil","datepickerShowsDate","datepickerIsInDateRange","currentMonth","currentYear","nextUntil","datepickerHelper","manualScheduling","endDate","singleDate","htmlId","isWritable","setCurrentActivatedField","setRangeClasses","onDataChange","mappedDate","validDate","setDatesToDatepicker","inline","onDatePickerChange","onMonthChange","onYearChange","setDates","toggleCurrentActivatedField","output","changeSchedulingMode","WpTableConfigurationHighlightingTab","entireRowMode","lastEntireRowAttribute","availableInlineHighlightedAttributes","availableRowHighlightedAttributes","highlighting_mode","inline_all_attributes","entire_row_by","upsaleAttributeHighlighting","availableHighlightedAttributes","setSelectedValues","updateMode","currentValues","updateHighlightingAttributes","WorkPackageWatchersTabComponent","allowedToView","allowedToAdd","allowedToRemove","watching","loadingError","loadCurrentWatchers","availableWatchersPath","addWatcher","$prepare","user_id","WorkPackageCreateComponent","wpViewFocus","cancelState","closeEditFormWhenNewWorkPackageSaved","showForm","createdWorkPackage","newWorkPackage","loginPath","back_url","BcfExportButtonComponent","export","exportLink","projectExportIssuesPath","showDelayedExport","field_description","confirm_button","password","passwordValuePresent","passwordConfirmationField","sanitizer","string","sanitize","HTML","_knownHookNames","externalQueryConfiguration","externalRelationQueryConfiguration","htmlSanitizeService","ckEditorPreview","pathHelperService","dynamicContent","run","ImageHelpers","resizeImage","maxSize","canvas","ctx","getContext","drawImage","dataUrl","toDataURL","dataURItoBlob","dataURI","bytes","atob","mime","ia","Uint8Array","Blob","resizeFile","reader","FileReader","readerEvent","readAsDataURL","fileInvalid","label_choose_avatar","upload_instructions","error_too_large","wrong_file_format","button_update","uploading","_evt","avatarFilePicker","dataURL","blob","avatarFile","avatarPreviewUrl","progress","onFilePickerChanged","uploadAvatar","loadIfNecessary","showCosts","renderCostAsLink","renderCostAsText","costObjectId","spentUnits","costType","addSeparator","BudgetResource","CostSubformAugmentService","templateEl","template","PlannedCostsFormAugment","objId","objName","makeEditable","edit_and_focus","currency","getCurrency","insertAfter","CostBudgetSubformAugmentService","row_identifier","buildRefreshRequest","HTMLInputElement","element_id","fixed_date","extendFieldType","workPackageSingleContextMenu","workPackageTableContextMenu","listen","initializeCostsPlugin","DocumentResource","LinkedPluginsModule","GridArea","storedGuid","newGuid","s4","otherArea","rowOverlaps","columnOverlaps","sink","isRow","gridDm","numColumns","numRows","mousedOverArea","$mousedOverArea","BehaviorSubject","helpMode","rowCount","buildAreas","area","unusedRows","widgetAreas","removeRow","unusedColumns","gridAreas","buildGridAreas","gridGaps","buildGridGaps","gridAreaIds","buildGridAreaIds","buildGridWidgetAreas","persist","writeAreaChangesToWidgets","saveGrid","payloadWidget","w","widgetResources","isSingleCell","scrollIntoViewIfNeeded","updatedGrid","assignAreasWidget","newGrid","takenIds","newWidget","buildGridAreasRow","buildGridGapRow","writeAreaChangeToWidget","excludeRow","movedWidgets","rowWidgets","moveSubsequentRowWidgets","excludeColumn","columnWidgets","moveSubsequentColumnWidgets","ignoredArea","gridResource","isGap","removedWidget","cleanupUnusedAreas","rebuildAndPersist","subsequentWidget","layout","onRenamed","renamed","GridRemoveWidgetService","removeWidget","menuItemList","removeItem","static","calendarPlugins","alreadyLoaded","setupWorkPackagesListener","initializeCalendar","ucCalendar","getApi","addTooltip","toWPFullView","fetchInfo","successCallback","failureCallback","updateTimeframe","calendarEvents","calendarEventsFunction","setCalendarHeight","setCalendarHeader","filtersEmpty","defaultQueryProps","datesIntervalFilter","tooltip","tooltipContentString","extendedProps","track","removeTooltip","history","pushState","inherit","calendarHeight","heightElement","topOfCalendar","topOfHeightElement","calendarElement","calendarHeader","calendarDate","calendarUnit","lower","changeView","setCalendarsDate","refetchEvents","warnOnTooManyResults","mapToCalendarEvents","eventDate","exclusiveEnd","allDay","tooManyResultsText","MAX_DISPLAYED","props","sanitizedValue","toStringMethod","renameWidget","displayedDays","firstDayOffset","momentFirstDayOffset","localeData","onConfigured","configureItem","destroyedEntry","timeEntryEdit","timeEntryCreate","timeEntryCache","minHour","maxHour","labelIntervalHours","scaleRatio","calendarSlotLabelFormat","calendarSlotLabelInterval","calendarContentHeight","calendarAllDaySlot","calendarDisplayEventTime","calendarSlotEventOverlap","calendarEditable","calendarMinTime","calendarMaxTime","calendarEventOverlap","stillEvent","memoizedCreateAllowed","hiddenDays","setHiddenDays","alterEventEntry","beforeEventRemove","dispatchEventClick","moveEvent","fetchTimeEntries","buildEntries","memoizedTimeEntries","dmFilters","createTimeEntry","setRatio","buildTimeEntryEntries","buildAuxEntries","dateSums","calculateDateSums","maxHours","oldRatio","smallerSuitableRatio","hoursDistribution","entryName","calendarEntries","m","sumEntry","addEntry","startEditable","backgroundColor","borderColor","rendering","formatNumber","editEvent","addEvent","modificationAction","updateEventSet","revert","foundIndex","appendAddIcon","appendSum","prependDuration","appendFadeout","addIcon","fadeout","hslaStart","toHsla","hslaEnd","workPackageName","divisor","cdr","reduce","updateConfiguration","updateEntries","GridWidgetsService","Hook","registeredWidgets","registration","OpenprojectTimeEntriesModule","CALENDAR_ROUTES","OpenprojectCalendarModule","forChild","domSanitizer","entriesLoaded","documentsUrl","orders","project_id","newsDm","addedBy","newsAuthorName","age","newsCreated","authorLink","newsAuthorPath","newsDmParams","setupNews","newsPath","GridInitializationService","myPageForm","WpGraphConfigurationSettingsTab","tabInner","WpGraphConfigurationFiltersTab","WpGraphConfiguration","chartOptions","is_public","_forms","persistChanges","reloadQueries","createInitial","queryCreationParams","queryPromises","queryParam","formFor","_configuration","_formsPromise","loadForms","queryTabs","formPromises","graphConfiguration","configurationComponent","WorkPackageEmbeddedGraphComponent","chartHeight","chartLabels","chartData","datasets","setChartOptions","updateChartData","uniqLabels","array","labelCountMaps","countMap","setHeight","responsive","maintainAspectRatio","legend","plugins","datalabels","align","chartTypeDefaults","scales","setChartAxesValues","inputChartOptions","changeableValuesAxis","stacked","ticks","constantValuesAxis","yAxes","xAxes","initializeConfiguration","loadQueriesInitially","persistAndReload","repaint","ensureQueryAndLoad","updateGraph","query$","skip","ensureFormAndSaveQuery","initializationProps","onResourceChanged","QuerySpacedTabComponent","wpGraphConfiguration","initializeQuerySpace","group_by","chart_type","currentChartType","initializeAvailableGroups","initializeAvailableChartType","availableChartTypes","graphConfigurationService","displayModeSingle","availableGroupBy","additionalFilter","setQueryProps","graphParams","sortedDatasets","propsBoth","propsOpen","propsClosed","sortingArray","baseProps","subprojectId","displaySingle","embeddedGraphSingle","embeddedGraphMulti","projectCache","project$","inEdit","newEditResource","valueChanged$","rawText","textValue","canAddAttachments","setupVariables","newText","currentRawText","clickedElementIsLinkWithinDisplayContainer","textEmpty","initial","memorizeRawText","reinitialize","memorizeCustomText","customText","htmlText","projectDm","loadAndRender","loadProjectSchema","loadedEntry","timeEntryEditService","changedEntry","oldEntryIndex","newEntries","anEntry","sumsByDateSpent","sortedEntries","currentDate","projectDmParams","membershipDm","viewAll","entriesByRoles","membersAddable","listMembersParams","partitionEntriesByRole","sortUsersByName","totalMembers","listAvailableProjects","listAvailableProjectsParams","projectMembershipsPath","principal","membership","roles","role","OpenprojectGridsModule","defaultColumns","assignedFilters","assignedProps","accountableFilters","accountableProps","createdFilters","createdProps","watchedFilters","watchedProps","registerWidgets","ApplicationBaseComponent","OPENPROJECT_ROUTES","abstract","squash","flash_message","dynamic","loadChildren","OpenprojectBoardsModule","OpenprojectIFCModelsModule","bodyClass","cssClass","updateMenuItem","menuItemTitle","stateService","wpBase","onEnter","onExit","router","start_onboarding_tour","paramsCopy","sync","profiler","MiniProfiler","pageTransition","pathname","setIfFirst","initializeUiRouterListeners","forRoot","useHash","uiRouter","urlService","strictMode","encode","decode","equals","WORK_PACKAGES_ROUTES","OpenprojectWorkPackageRoutesModule","currentProjectService","_searchTerm","searchTerm$","_currentTab","currentTab$","_projectScope","projectScope$","tabs$","_resultsHidden","resultsHidden$","loadGonData","available_search_types","search_term","current_tab","project_scope","global_search","searchPath","projectScope","searchQueryParams","OpenprojectGlobalSearchModule","Gon","externalRelationQuery","drag_to_activate","label_group","new_group","label_inactive","custom_field","add_group","add_table","inactives","no_filter_query","noFilterQuery","submitted","updateHiddenFields","dropModel","activeGroups","inactiveAttributes","groupsDrake","attributeDrake","updateInactives","newGroup","editQuery","resetToDefault","addGroupAndOpenQuery","onValueChange","editedName","showEEOnlyHint","leaveEditingMode","deleteGroup","removeAttribute","rename","edit_query","OpenprojectAdminModule","widgetsService","upsale_text","eligibleWidgets","chosenWidget","schemaWidgetIdentifiers","registered","GridMoveService","movedArea","ignoreArea","movedAreas","remainingAreas","moveOneDown","anchorAreas","movableAreas","moveSpecification","firstAreaToMove","toMoveArea","anchorArea","areaHeight","overlappingArea","movableArea","overlaps","referenceArea","setupMousedOverAreaSubscription","mousedOverAreaObserver","throttleTime","currentlyDragging","placeholderArea","updateArea","scrollPlaceholderIntoView","resetAreas","draggedArea","moveAreasOnDragging","dropArea","widgetArea","copyPositionButRestrict","isDragged","draggedHeight","offsetHeight","copyDimensionsTo","unchangedSize","GridResizeService","resizedArea","resizeTargets","sameRow","higherRow","fixedArea","targetIds","areaId","currentlyResizing","isResized","isAllowed","resize","inHelpMode","addLine","newArea","setMaxWidth","addRow","isColumn","existingArea","startColumnOverlaps","GridPageComponent","gridInitialization","addWidget","areas","i18nNamespace","html_title","gridScopePath","setHtmlTitle","GRID_PROVIDERS","uiWidgets","GRID_AREA_HEIGHT","GRID_GAP_DIMENSION","reg","saveWidgetChangeset","gridStyle","itemStyle","bypassSecurityTrustStyle","projectDashboardsPath","DASHBOARDS_ROUTES","OpenprojectDashboardsModule","rules","when","created_by","workPackageLink","previewModal","isMouseOverPreview","horizontalHover","verticalHover","OVERVIEW_ROUTES","OpenprojectOverviewModule","myPagePath","MY_PAGE_ROUTES","OpenprojectMyPageModule","accessKeys","quickSearch","projectSearch","help","moreMenu","KeyboardShortcutService","shortcuts","showHelpModal","globalAction","projectScoped","focusPrevItem","focusNextItem","keyName","clickLink","createEvent","MouseEvent","bubbles","cancelable","fireEvent","keyboardShortcutsHelpPath","domLists","focusElements","firstLink","findListInPage","focusItemOffset","highlightTextInline","setColorOptions","updateInput","selectedColorId","selectedColor","highlightingClass","globalSearchService","wpFilters","resultsHidden","tableConfiguration","debounceTime","newSearchTerm","newProjectScope","newFeatures","descriptionNewFeatures","learnAbout","i18nBase","isStandardEdition","translated","bypassSecurityTrustResourceUrl","i18nPrefix","list_styling_class","bcf_api_link","GlobalSearchWorkPackagesEntryComponent","PersistentToggleComponent","isHidden","$targetNotification","getTargetNotification","isNowHidden","slideUp","slideDown","displayed","sections","removeHiddenOnSubmit","section","HideSectionLinkComponent","hideSectionService","sectionName","hideSection","ShowSectionDropdownComponent","HideSectionService","optValue","hideSecWithName","prev","trackByKey","selectable","AutocompleteSelectDecorationComponent","multiselect","labelForId","syncInputFieldName","inputName","updateSelection","removeCurrentSyncedFields","createSyncedField","gonTabs","CopyToClipboardDirective","clickTarget","clipboardTarget","supported","queryCommandSupported","execCommand","addNotification","ConfirmFormSubmitController","$form","openConfirmationDialog","PathHelperService","markable","setMarkedOption","all_projects","current_project","current_project_and_all_descendants","search_dots","close_search","toggleTopMenuClass","unregister","btn","toggleMobileSearch","submitNonEmptySearch","wpPath","openCloseMenu","searchedTerm","selectedItem","followSelectedItem","searchInScope","currentScope","statusId","followItem","hashFreeQuery","queryWithoutHash","fetchSearchResults","searchResultsToOptions","wpBySubjectOrId","searchItems","searchOptions","detailedSearchOptions","suggestion","itemsList","markItem","selectedItems","forcePageLoad","isAfterSearch","replaceState","submitSearch","serviceScope","unregisterGlobalListener","onFocusOut","onEnterBeforeResultsLoaded","clearSearch","CollapsibleSectionComponent","sectionTitle","nextElementSibling","sectionBody","EnterpriseBannerBootstrapComponent","textMessage","linkMessage","referrer","LazyLoadedAutocompleter","_renderLazyMenu","pageElements","maxItemsPerPage","shownHeight","_pages","_repositionMenu","_resizeMenu","renderItem","mark","pages","_renderMenuPage","outerHeight","isScrollbarBottom","widgetName","literalMatches","literalSearch","fuseInstance","str","setupParams","shouldSort","tokenize","threshold","maxPatternLength","minMatchCharLength","autocompleteValues","fuzzyResults","fuzzySearch","augmentedResultSet","onItemSelected","onNoResultsFound","dropdownMenu","projectMenuAutocomplete","loadProjects","addInputHandlers","scrollCurrentProjectIntoView","projectLink","currentMenuItem","projectLevelListPath","augmentWithParents","currentLevel","matchedParents","keydown","touchMoved","currentProjectHeight","scrollValue","htmlMode","keyCodesArray","TAB","SHIFT","updater","remoteFieldKey","project_and_subprojects","search_for","in","projectText","searchTitle","currentProjectName","currentTabSub","tabsSub","clickTab","initializeMenu","userData$","modalOpen","emailInvalid","invalid_email","taken_email","taken_domain","baseUrlAugur","augur_url","tokenVersion","token_version","ee_trial_key","setMailSubmittedStatus","enterpriseTrial","trialLink","saveTrialKey","retryConfirmation","addWarning","token_retrieved","saveToken","resendLink","resend","resendlink","trialKey","trial_key","enterprise_token","encoded_token","retries","getToken","emailTaken","domainTaken","I18nHelpers","localizeLink","en","formBuilder","currentUserService","eeTrialService","userData","trialForm","company","first_name","last_name","domain","host","general_consent","newsletter_consent","link_terms","de","link_privacy","label_test_ee","label_company","label_first_name","label_last_name","label_email","label_domain","privacy_policy","receive_newsletter","terms_of_service","controls","checkMailField","label_expires_at","label_maximum_users","label_starts_at","label_subscriber","subscriber","userForm","formatUserData","eeTrialKey","getUserDataFromAugur","created","confirmation_info","resend_success","resend_warning","session_timeout","status_confirmed","status_label","status_waiting","savedDateStr","button_submit","heading_confirmation","heading_next_steps","heading_test_ee","quick_overview","trustedEEVideoURL","trustedURL","formComponent","valid","addControl","sendForm","setStartTrialStatus","mailSubmitted","trialStarted","button_trial","button_book","link_quote","become_hero","you_contribute","email_not_received","enterprise_edition","confidence","try_another_email","userCount","startsAt","expiresAt","TriggerActionsEntryComponent","loadEntry","timeEntryDmService","editTimeEntry","deleteTimeEntry","globalDynamicComponents","OpenprojectMembersModule","OpenprojectEnterpriseModule","bootstrapOptionalDocument","_injector","ExternalQueryConfiguration","ExternalRelationQueryConfiguration","ModalWrapper","PreviewTrigger","mainMenuNavigationService","keyboardShortcuts","setupListener","contextCallbacks","messageStack","sentryConfigured","sentryElement","Sentry","dsn","debug","ignoreErrors","beforeSend","filterEvent","sentryLoaded","client","configureScope","setupContext","severity","handleOfflineMessage","withScope","fromString","callbacks","hostname","meta","enableReactiveStatesLogging","disableReactiveStatesLogging","platformRef","WorkPackageViewBaseService","combinedRaw","pristine","WorkPackageQueryStateService"],"mappings":"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B,cAGhB,KAAA+1D,iBAAmB,IAAI,IAEvB,KAAA7R,qBAAoD,YAAOnpD,KAAKiF,cAAeg2D,GAAKA,EAAE96D,KACpF,YAAI23B,GAAQA,EAAKhkB,OAAOhJ,KAASA,EAAIZ,kBAGvC,KAAAmsC,uBAAyC,YAAOr2C,KAAKmpD,qBAAsB8R,GAAKA,EAAE96D,KAChF,YAAI23B,GAAQA,EAAKjnB,IAAI/F,GAAOA,EAAIZ,cAAegJ,eAIjD,KAAA4zC,qBAAuB,IAAI,IAG3B,KAAA/hD,+BAAiC,cAGjC,KAAAW,YAAc,e,sCA7CHq1D,I,yBAAAA,EAAkB,QAAlBA,EAAkB,a,kCCX/B,IAAYG,EAAZ,2CAAYA,GACV,6BACA,iBACA,sBACA,sBACA,oBACA,kBACA,sBACA,8BACA,wBACA,sBACA,0BACA,8BACA,kBACA,oBACA,gCACA,4BACA,kCACA,gCACA,wBACA,wBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,8BACA,gCACA,wBACA,4BACA,4BACA,4BACA,4BACA,6BACA,6BACA,6BACA,6BACA,6BACA,6BACA,6BACA,mBACA,6BACA,2BACA,yBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,mBACA,mBACA,mBACA,6BACA,mCACA,+BACA,yBACA,uBACA,qBACA,yBACA,uCACA,qCACA,qCACA,iCACA,uCACA,qCAnGF,CAAYA,MAAQ,M,kCC4BpB,0EAMO,MAAMC,UAAkC,IAE7C,YAAmB54D,GACjBzC,MAAMyC,GAGD,eAAegB,GACpB,QAASA,EAAM63D,KAGV,WAAW73D,GAChBvD,KAAKysC,cAAc/oC,WAAWH,EAAM63D,MAG/B,WAAW73D,GAChB,OAAOA,EAAM63D,OAASp7D,KAAKw1B,UAGtB,aAAajyB,GAElB,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A3lF,KAAA,KAJA,wBAAmB,uBAQjB,kCAEA,6C,qFCXZ,IAAI2K,EAAM,CACT,eAAgB,CACf,OACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,yBAA0B,CACzB,OACA,EACA,IAED,2BAA4B,CAC3B,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,GAED,uBAAwB,CACvB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,iCAAkC,CACjC,OACA,EACA,GAED,6BAA8B,CAC7B,OACA,EACA,IAED,uBAAwB,CACvB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,GAED,qBAAsB,CACrB,OACA,EACA,IAED,WAAY,CACX,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,EACA,EACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,uBAAwB,CACvB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,EACA,EACA,IAED,uBAAwB,CACvB,OACA,EACA,IAED,aAAc,CACb,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,EACA,EACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,GAED,yCAA0C,CACzC,OACA,EACA,EACA,IAED,uBAAwB,CACvB,OACA,EACA,GAED,iBAAkB,CACjB,OACA,EACA,IAED,iCAAkC,CACjC,OACA,EACA,EACA,EACA,EACA,IAED,2BAA4B,CAC3B,OACA,EACA,EACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,GAED,qBAAsB,CACrB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,yBAA0B,CACzB,OACA,EACA,GAED,+BAAgC,CAC/B,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,yBAA0B,CACzB,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,EACA,IAED,yBAA0B,CACzB,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,aAAc,CACb,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,EACA,EACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,IAED,6BAA8B,CAC7B,OACA,EACA,IAED,yBAA0B,CACzB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,EACA,EACA,GAED,qBAAsB,CACrB,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,GAED,WAAY,CACX,OACA,EACA,IAED,WAAY,CACX,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,GAED,iBAAkB,CACjB,OACA,EACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,EACA,GAED,qBAAsB,CACrB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,EACA,EACA,EACA,IAED,2BAA4B,CAC3B,OACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,EACA,EACA,IAED,qBAAsB,CACrB,OACA,EACA,IAED,+BAAgC,CAC/B,OACA,EACA,IAED,eAAgB,CACf,OACA,EACA,IAED,iBAAkB,CACjB,OACA,EACA,GAED,qBAAsB,CACrB,OACA,EACA,GAED,mBAAoB,CACnB,OACA,EACA,KAED,eAAgB,CACf,OACA,EACA,KAED,uBAAwB,CACvB,OACA,EACA,KAED,6BAA8B,CAC7B,OACA,EACA,KAED,iBAAkB,CACjB,OACA,EACA,KAED,iBAAkB,CACjB,OACA,EACA,KAED,uBAAwB,CACvB,OACA,EACA,EACA,EACA,EACA,IAED,mBAAoB,CACnB,OACA,EACA,KAED,yBAA0B,CACzB,OACA,EACA,KAED,iBAAkB,CACjB,OACA,EACA,KAED,qBAAsB,CACrB,OACA,EACA,KAED,iBAAkB,CACjB,OACA,EACA,EACA,KAED,aAAc,CACb,OACA,EACA,KAED,yBAA0B,CACzB,OACA,EACA,KAED,yBAA0B,CACzB,OACA,EACA,KAED,uBAAwB,CACvB,OACA,EACA,KAED,iBAAkB,CACjB,OACA,EACA,KAED,eAAgB,CACf,OACA,EACA,EACA,EACA,EACA,EACA,EACA,KAED,qBAAsB,CACrB,OACA,EACA,KAED,eAAgB,CACf,OACA,EACA,KAED,qBAAsB,CACrB,OACA,EACA,KAED,mBAAoB,CACnB,OACA,EACA,KAED,yCAA0C,CACzC,OACA,EACA,EACA,KAED,iBAAkB,CACjB,OACA,EACA,GAED,eAAgB,CACf,OACA,EACA,MAGF,SAASm7E,EAAoBrnB,GAC5B,IAAI+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A,KACA,KAGA,KACA,GACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,GACA,GACA,GACA,GACA,GAEA,KACA,KAGA,KACA,IACA,KACA,IACA,KACA,KACA,GACApP,EACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACAiO,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KAIA,KACA,KAGA,KACA,KACA,MAA2B,uD,KAlF3B,GAAkC,qjBA3ElC,KACA,KACA,KAGA,KACA,KAGA,KACA,KAGA,KACA,KACA,KACA,KAGA,KACA,KAGA,IACA,IAGA,KACA,KAGA,KACA,KAEA,KAEA,IACA,GACA,IAEA,IAEA,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAEA,KACA,KAGA,KACA,GACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,GACA,GACA,GACA,GACA,GAEA,KACA,KAGA,KACA,IACA,KACA,IACA,KACA,KACA,GACAjO,EACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACAiO,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KAIA,KACA,KAGA,KACA,KACA,MAA2B,uD,KAvD3B,KAA+B,qjBAtG/B,KACA,KACA,KAGA,KACA,KAGA,KACA,KAGA,KACA,KACA,KACA,KAGA,KACA,KAGA,IACA,IAGA,KACA,KAGA,KACA,KAEA,KAEA,IACA,GACA,IAEA,IAEA,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAEA,KACA,KAGA,KACA,GACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,GACA,GACA,GACA,GACA,GAEA,KACA,KAGA,KACA,IACA,KACA,IACA,KACA,KACA,GACAjO,EACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACAiO,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KAIA,KACA,KAGA,KACA,KACA,MAA2B,uD,KAF3B,KAA4B,qjBA3J5B,KACA,KACA,KAGA,KACA,KAGA,KACA,KAGA,KACA,KACA,KACA,KAGA,KACA,KAGA,IACA,IAGA,KACA,KAGA,KACA,KAEA,KAEA,IACA,GACA,IAEA,IAEA,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAEA,KACA,KAGA,KACA,GACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,GACA,GACA,GACA,GACA,GAEA,KACA,KAGA,KACA,IACA,KACA,IACA,KACA,KACA,GACAjO,EACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACAiO,GAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KAIA,KACA,KAGA,KACA,KACA,MAA2B,wD,kCChW/B,0EAMO,MAAMqB,EACX,YAAsBjzF,EACAuG,GADA,KAAAvG,kBACA,KAAAuG,SAOf,kBAAkB1V,EACAiQ,GAEvB,IAAIoyF,EAAmB5lG,KAAK6lG,eAAetiG,EAAOiQ,GAC9CsyF,EAAgCpvF,QAAQC,UAc5C,OAZI3W,KAAK+lG,oBAEE/lG,KAAKgmG,cAAcziG,EAAMoE,KAClCm+F,EAAe9lG,KAAKimG,sBAAsB1iG,EAAMoE,GAA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","file":"main.e73ebcaec9eec631416c.js","sourcesContent":["// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit} from '@angular/core';\nimport {INotification, NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const notificationsContainerSelector = 'notifications-container';\n\n@Component({\n  template: `\n    <div class=\"notification-box--wrapper\">\n      <div class=\"notification-box--casing\">\n        <notification [notification]=\"notification\" *ngFor=\"let notification of stack\"></notification>\n      </div>\n    </div>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: notificationsContainerSelector\n})\nexport class NotificationsContainerComponent extends UntilDestroyedMixin implements OnInit {\n\n  public stack:INotification[] = [];\n\n  constructor(readonly notificationsService:NotificationsService,\n              readonly cdRef:ChangeDetectorRef) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.notificationsService\n      .current\n      .values$('Subscribing to changes in the notification stack')\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(stack => {\n        this.stack = stack;\n        this.cdRef.detectChanges();\n      });\n  }\n}\n\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {Directive, ElementRef} from \"@angular/core\";\nimport {OpContextMenuTrigger} from \"core-components/op-context-menu/handlers/op-context-menu-trigger.directive\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {\n  WorkPackageViewDisplayRepresentationService,\n  wpDisplayCardRepresentation,\n  wpDisplayListRepresentation\n} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\n\n@Directive({\n  selector: '[wpViewDropdown]'\n})\nexport class WorkPackageViewDropdownMenuDirective extends OpContextMenuTrigger {\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly I18n:I18nService,\n              readonly wpDisplayRepresentationService:WorkPackageViewDisplayRepresentationService,\n              readonly wpTableTimeline:WorkPackageViewTimelineService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.buildItems();\n    this.opContextMenu.show(this, evt);\n  }\n\n  public get locals() {\n    return {\n      items: this.items,\n      contextMenuId: 'wp-view-context-menu'\n    };\n  }\n\n  private buildItems() {\n    this.items = [];\n    \n    if (this.wpDisplayRepresentationService.current !== wpDisplayCardRepresentation) {\n      this.items.push(\n        {\n          // Card View\n          linkText: this.I18n.t('js.views.card'),\n          icon: 'icon-view-card',\n          onClick: (evt:any) => {\n            this.wpDisplayRepresentationService.setDisplayRepresentation(wpDisplayCardRepresentation);\n            if (this.wpTableTimeline.isVisible) {\n              // Necessary for the timeline buttons to disappear\n              this.wpTableTimeline.toggle();\n            }\n            return true;\n          }\n        });\n    }\n\n    if (this.wpTableTimeline.isVisible || this.wpDisplayRepresentationService.current === wpDisplayCardRepresentation) {\n      this.items.push(\n        {\n          // List View\n          linkText: this.I18n.t('js.views.list'),\n          icon: 'icon-view-list',\n          onClick: (evt:any) => {\n            this.wpDisplayRepresentationService.setDisplayRepresentation(wpDisplayListRepresentation);\n            if (this.wpTableTimeline.isVisible) {\n              this.wpTableTimeline.toggle();\n            }\n            return true;\n          }\n        });\n    }\n\n    if (!this.wpTableTimeline.isVisible || this.wpDisplayRepresentationService.current === wpDisplayCardRepresentation) {\n      this.items.push(\n        {\n          // List View with enabled Gantt\n          linkText: this.I18n.t('js.views.timeline'),\n          icon: 'icon-view-timeline',\n          onClick: (evt: any) => {\n            if (!this.wpTableTimeline.isVisible) {\n              this.wpTableTimeline.toggle();\n            }\n            this.wpDisplayRepresentationService.setDisplayRepresentation(wpDisplayListRepresentation);\n            return true;\n          }\n        });\n    }\n  }\n}\n\n","import {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\n\nexport class WorkPackageChangeset extends ResourceChangeset<WorkPackageResource> {\n\n  public setValue(key:string, val:any) {\n    super.setValue(key, val);\n\n    if (key === 'project' || key === 'type') {\n      this.updateForm();\n    }\n  }\n\n  protected applyChanges(payload:any):any {\n    // Explicitly delete the description if it was not set by the user.\n    // if it was set by the user, #applyChanges will set it again.\n    // Otherwise, the backend will set it for us.\n    delete payload.description;\n\n    return super.applyChanges(payload);\n  }\n\n  protected setNewDefaultFor(key:string, val:unknown) {\n    // Special handling for taking over the description\n    // to the pristine resource\n    if (key === 'description' && this.pristineResource.isNew) {\n      this.pristineResource.description = val;\n      return;\n    }\n\n    super.setNewDefaultFor(key, val);\n  }\n\n\n}\n","import {States} from '../states.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {WorkPackageCacheService} from '../work-packages/work-package-cache.service';\nimport {WorkPackagesListChecksumService} from './wp-list-checksum.service';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {QuerySchemaResource} from 'core-app/modules/hal/resources/query-schema-resource';\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {take} from \"rxjs/operators\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {WorkPackageViewDisplayRepresentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {WorkPackageViewSumService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {WorkPackageViewAdditionalElementsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-additional-elements.service\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageViewPaginationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\n\n@Injectable()\nexport class WorkPackageStatesInitializationService {\n  constructor(protected states:States,\n              protected querySpace:IsolatedQuerySpace,\n              protected wpTableColumns:WorkPackageViewColumnsService,\n              protected wpTableGroupBy:WorkPackageViewGroupByService,\n              protected wpTableSortBy:WorkPackageViewSortByService,\n              protected wpTableFilters:WorkPackageViewFiltersService,\n              protected wpTableSum:WorkPackageViewSumService,\n              protected wpTableTimeline:WorkPackageViewTimelineService,\n              protected wpTableHierarchies:WorkPackageViewHierarchiesService,\n              protected wpTableHighlighting:WorkPackageViewHighlightingService,\n              protected wpTableRelationColumns:WorkPackageViewRelationColumnsService,\n              protected wpTablePagination:WorkPackageViewPaginationService,\n              protected wpTableOrder:WorkPackageViewOrderService,\n              protected wpTableAdditionalElements:WorkPackageViewAdditionalElementsService,\n              protected wpCacheService:WorkPackageCacheService,\n              protected wpListChecksumService:WorkPackagesListChecksumService,\n              protected authorisationService:AuthorisationService,\n              protected wpDisplayRepresentation:WorkPackageViewDisplayRepresentationService) {\n  }\n\n  /**\n   * Initialize the query and table states from the given query and results.\n   * They may or may not come from the same query source.\n   *\n   * @param query\n   * @param results\n   */\n  public initialize(query:QueryResource, results:WorkPackageCollectionResource) {\n    this.clearStates();\n\n    // Update the (global) wp query states\n    this.querySpace.query.putValue(query);\n    this.initializeFromQuery(query, results);\n\n    // Update the (local) table states\n    this.updateQuerySpace(query, results);\n\n    // Ensure checksum for state is correct\n    this.updateChecksum(query, results);\n  }\n\n  /**\n   * Insert new information from the query from to the states.\n   *\n   * @param query\n   * @param form\n   */\n  public updateStatesFromForm(query:QueryResource, form:QueryFormResource) {\n    let schema:QuerySchemaResource = form.schema as any;\n\n    _.each(schema.filtersSchemas.elements, (schema) => {\n      this.states.schemas.get(schema.$href as string).putValue(schema as any);\n    });\n\n    this.wpTableFilters.initializeFilters(query, schema);\n    this.querySpace.queryForm.putValue(form);\n\n    this.states.queries.columns.putValue(schema.columns.allowedValues);\n    this.states.queries.sortBy.putValue(schema.sortBy.allowedValues);\n    this.states.queries.groupBy.putValue(schema.groupBy.allowedValues);\n    this.states.queries.displayRepresentation.putValue(schema.displayRepresentation.allowedValues);\n  }\n\n  public updateQuerySpace(query:QueryResource, results:WorkPackageCollectionResource) {\n    // Clear table required data states\n    this.querySpace.additionalRequiredWorkPackages.clear('Clearing additional WPs before updating rows');\n    this.querySpace.tableRendered.clear('Clearing rendered data before upgrading query space');\n\n    if (results.schemas) {\n      _.each(results.schemas.elements, (schema:SchemaResource) => {\n        this.states.schemas.get(schema.href as string).putValue(schema);\n      });\n    }\n\n    this.querySpace.query.putValue(query);\n\n    this.authorisationService.initModelAuth('work_packages', results.$links);\n\n    results.elements.forEach(wp => this.wpCacheService.updateWorkPackage(wp, true));\n\n    this.querySpace.results.putValue(results);\n\n    this.querySpace.groups.putValue(results.groups);\n\n    this.wpTablePagination.initialize(query, results);\n\n    this.wpTableRelationColumns.initialize(query, results);\n\n    this.wpTableAdditionalElements.initialize(results.elements);\n\n    this.wpTableOrder.initialize(query, results);\n\n    this.wpDisplayRepresentation.initialize(query, results);\n\n    this.querySpace.additionalRequiredWorkPackages\n      .values$()\n      .pipe(take(1))\n      .subscribe(() => this.querySpace.initialized.putValue(null));\n  }\n\n  public updateChecksum(query:QueryResource, results:WorkPackageCollectionResource) {\n    this.wpListChecksumService.updateIfDifferent(this.querySpace.query.value!, this.wpTablePagination.current);\n    this.authorisationService.initModelAuth('work_packages', results.$links);\n  }\n\n  public initializeFromQuery(query:QueryResource, results:WorkPackageCollectionResource) {\n    this.querySpace.query.putValue(query);\n\n    this.wpTableSum.initialize(query);\n    this.wpTableColumns.initialize(query, results);\n    this.wpTableSortBy.initialize(query, results);\n    this.wpTableGroupBy.initialize(query, results);\n    this.wpTableTimeline.initialize(query, results);\n    this.wpTableHierarchies.initialize(query, results);\n    this.wpTableHighlighting.initialize(query, results);\n    this.wpDisplayRepresentation.initialize(query, results);\n\n    this.authorisationService.initModelAuth('query', query.$links);\n    this.authorisationService.initModelAuth('work_packages', results.$links);\n  }\n\n  public applyToQuery(query:QueryResource) {\n    this.wpTableFilters.applyToQuery(query);\n    this.wpTableSum.applyToQuery(query);\n    this.wpTableColumns.applyToQuery(query);\n    this.wpTableSortBy.applyToQuery(query);\n    this.wpTableGroupBy.applyToQuery(query);\n    this.wpTableTimeline.applyToQuery(query);\n    this.wpTableHighlighting.applyToQuery(query);\n    this.wpTableHierarchies.applyToQuery(query);\n    this.wpTableOrder.applyToQuery(query);\n    this.wpDisplayRepresentation.applyToQuery(query);\n  }\n\n  public clearStates() {\n    const reason = 'Clearing states before re-initialization.';\n\n    // Clear immediate input states\n    this.querySpace.initialized.clear(reason);\n    this.querySpace.query.clear(reason);\n    this.querySpace.results.clear(reason);\n    this.querySpace.groups.clear(reason);\n    this.querySpace.additionalRequiredWorkPackages.clear(reason);\n\n    this.wpTableFilters.clear(reason);\n    this.wpTableColumns.clear(reason);\n    this.wpTableSortBy.clear(reason);\n    this.wpTableGroupBy.clear(reason);\n    this.wpDisplayRepresentation.clear(reason);\n    this.wpTableSum.clear(reason);\n\n    // Clear rendered state\n    this.querySpace.tableRendered.clear(reason);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectionStrategy, Component, Input} from '@angular/core';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\n\n@Component({\n  selector: 'user-link',\n  template: `\n    <a *ngIf=\"href\"\n       [attr.href]=\"href\"\n       [attr.title]=\"label\"\n       [textContent]=\"name\">\n    </a>\n    <ng-container *ngIf=\"!href\">\n      {{ name }}\n    <ng-container>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class UserLinkComponent {\n  @Input() user:UserResource;\n\n  constructor(readonly I18n:I18nService) {\n  }\n\n  public get href() {\n    return this.user && this.user.showUserPath;\n  }\n\n  public get name() {\n    return this.user && this.user.name;\n  }\n\n  public get label() {\n    return this.I18n.t('js.label_author', { user: this.name });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {Component, ElementRef, Input, OnInit} from '@angular/core';\nimport {EditFormComponent} from \"core-app/modules/fields/edit/edit-form/edit-form.component\";\n\n@Component({\n  selector: 'wp-replacement-label',\n  templateUrl: './wp-replacement-label.html'\n})\nexport class WorkPackageReplacementLabelComponent implements OnInit {\n  @Input('fieldName') public fieldName:string;\n  private $element:JQuery;\n\n  constructor(protected wpeditForm:EditFormComponent,\n              protected elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n  }\n\n  public activate(evt:JQuery.TriggeredEvent) {\n    // Skip clicks on help texts\n    const target = jQuery(evt.target);\n    if (target.closest('.help-text--entry').length) {\n      return true;\n    }\n\n    const field = this.wpeditForm.fields[this.fieldName];\n    field && field.handleUserActivate(null);\n\n    return false;\n  }\n}\n","<span\n  class=\"wp-replacement-label\"\n  (click)=\"activate($event)\"\n  tabindex=\"-1\">\n  <ng-content></ng-content>\n</span>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\n\nexport class AttachmentCollectionResource extends CollectionResource {\n  public $initialize(source:any) {\n    super.$initialize(source);\n\n    this.elements = this.elements || [];\n  }\n\n}\n\nexport interface AttachmentCollectionResource {\n  elements:HalResource[];\n}\n\n","import {Injectable} from \"@angular/core\";\nimport {Observable, Subject} from \"rxjs\";\nimport {buffer, debounceTime, filter} from \"rxjs/operators\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {ResourceChangesetCommit} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\n\nexport interface HalEvent {\n  id:string;\n  eventType:string;\n  resourceType:string;\n  commit?:ResourceChangesetCommit;\n}\n\nexport interface HalCreatedEvent extends HalEvent {\n  eventType:'created';\n}\n\nexport interface HalUpdatedEvent extends HalEvent {\n  eventType:'updated';\n}\n\nexport interface RelatedWorkPackageEvent extends HalEvent {\n  eventType:'association';\n  relatedWorkPackage:string|null;\n  relationType:string;\n}\n\nexport interface HalDeletedEvent extends HalEvent {\n  eventType:'deleted';\n}\n\nexport type HalEventTypes =\n  HalCreatedEvent|HalUpdatedEvent|RelatedWorkPackageEvent|HalDeletedEvent;\n\n@Injectable({ providedIn: 'root' })\nexport class HalEventsService {\n  private _events = new Subject<HalEvent>();\n\n  /** Entire event stream */\n  public events$ = this._events.asObservable();\n\n  /** Aggregated events */\n  public aggregated$(resourceType:string, debounceTimeInMs = 500):Observable<HalEvent[]> {\n    return this\n      .events$\n      .pipe(\n        filter((event:HalEvent) => event.resourceType === resourceType),\n        buffer(this.events$.pipe(debounceTime(debounceTimeInMs)))\n      );\n  }\n\n  public push(resourceReference:HalResource|{ id:string, _type:string }, event:Partial<HalEventTypes>) {\n    event.id = resourceReference.id!;\n    event.resourceType = resourceReference._type!;\n\n    this._events.next(event as HalEvent);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, EventEmitter, Input, Output} from '@angular/core';\n\n@Component({\n  selector: 'accessible-by-keyboard',\n  template: `\n  <a (accessibleClick)=\"handleClick($event)\"\n     role=\"link\"\n     [ngClass]=\"linkClass\"\n     [attr.disabled]=\"isDisabled || undefined\"\n     [attr.title]=\"linkTitle\"\n     [attr.aria-label]=\"linkAriaLabel\"\n     href>\n    <span [ngClass]=\"spanClass\">\n      <ng-content></ng-content>\n    </span>\n  </a>\n  `\n})\nexport class AccessibleByKeyboardComponent {\n  @Output() execute = new EventEmitter<JQuery.TriggeredEvent>();\n  @Input() isDisabled:boolean;\n  @Input() linkClass:string;\n  @Input() linkTitle:string;\n  @Input() spanClass:string;\n  @Input() linkAriaLabel:string;\n\n  public handleClick(event:JQuery.TriggeredEvent) {\n    if (!this.isDisabled) {\n      this.execute.emit(event);\n    }\n\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport type OpTableActionFactory = (i:Injector, wp:WorkPackageResource) => OpTableAction;\nexport const contextMenuTdClassName = 'wp-table--context-menu-td';\nexport const contextMenuSpanClassName = 'wp-table--context-menu-span';\nexport const contextMenuLinkClassName = 'wp-table-context-menu-link';\nexport const contextColumnIcon = 'wp-table-context-menu-icon';\n\nexport abstract class OpTableAction {\n\n  @InjectField() I18n:I18nService;\n\n  constructor(readonly injector:Injector,\n              readonly workPackage:WorkPackageResource) {\n  }\n\n  /** Identifier to uniquely identify the action */\n  public abstract readonly identifier:string;\n\n  /** The actual action factory to return the action element, if it can be rendered */\n  public abstract buildElement():HTMLElement|null;\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageOverviewTabComponent} from 'core-components/wp-single-view-tabs/overview-tab/overview-tab.component';\nimport {WorkPackageActivityTabComponent} from 'core-components/wp-single-view-tabs/activity-panel/activity-tab.component';\nimport {WorkPackageRelationsTabComponent} from 'core-components/wp-single-view-tabs/relations-tab/relations-tab.component';\nimport {WorkPackageWatchersTabComponent} from 'core-components/wp-single-view-tabs/watchers-tab/watchers-tab.component';\nimport {WorkPackageNewSplitViewComponent} from 'core-components/wp-new/wp-new-split-view.component';\nimport {Ng2StateDeclaration} from \"@uirouter/angular\";\nimport {ComponentType} from \"@angular/cdk/overlay\";\nimport {WorkPackageCopySplitViewComponent} from \"core-components/wp-copy/wp-copy-split-view.component\";\n\n/**\n * Return a set of routes for a split view mounted under the given base route,\n * which must be a grandchild of a PartitionedQuerySpacePageComponent.\n *\n * Example: base route = foo.bar\n *\n * Split view will be created at\n *\n * foo.bar.details\n * foo.bar.details.activity\n * foo.bar.details.relations\n * foo.bar.details.watchers\n *\n * NOTE: All parameters here must either be `export const` or literal strings,\n * otherwise AOT will not be able to look them up. This might result in missing routes.\n *\n * @param baseRoute The base route to mount under\n * @param showComponent The split view component to mount\n */\nexport function makeSplitViewRoutes(baseRoute:string,\n                                    menuItemClass:string|undefined,\n                                    showComponent:ComponentType<any>,\n                                    newComponent:ComponentType<any> = WorkPackageNewSplitViewComponent):Ng2StateDeclaration[] {\n  return [\n    {\n      name: baseRoute + '.details',\n      url: '/details/{workPackageId:[0-9]+}',\n      redirectTo: baseRoute + '.details.overview',\n      reloadOnSearch: false,\n      data: {\n        bodyClasses: 'router--work-packages-partitioned-split-view-details',\n        menuItem: menuItemClass,\n        // Remember the base route so we can route back to it anywhere\n        baseRoute: baseRoute,\n        partition: '-split',\n        newRoute: baseRoute + '.new',\n      },\n      views: {\n        // Retarget and by that override the grandparent views\n        // https://ui-router.github.io/guide/views#relative-parent-state\n        'content-right@^.^': { component: showComponent }\n      }\n    },\n    {\n      name: baseRoute + '.details.overview',\n      url: '/overview',\n      component: WorkPackageOverviewTabComponent,\n      data: {\n        menuItem: menuItemClass,\n        parent: baseRoute + '.details'\n      }\n    },\n    {\n      name: baseRoute + '.details.activity',\n      url: '/activity',\n      component: WorkPackageActivityTabComponent,\n      data: {\n        menuItem: menuItemClass,\n        parent: baseRoute + '.details'\n      }\n    },\n    {\n      name: baseRoute + '.details.relations',\n      url: '/relations',\n      component: WorkPackageRelationsTabComponent,\n      data: {\n        menuItem: menuItemClass,\n        parent: baseRoute + '.details'\n      }\n    },\n    {\n      name: baseRoute + '.details.watchers',\n      url: '/watchers',\n      component: WorkPackageWatchersTabComponent,\n      data: {\n        menuItem: menuItemClass,\n        parent: baseRoute + '.details'\n      }\n    },\n    // Split create route\n    {\n      name: baseRoute + '.new',\n      url: '/create_new?{type:[0-9]+}&{parent_id:[0-9]+}',\n      reloadOnSearch: false,\n      data: {\n        partition: '-split',\n        allowMovingInEditMode: true,\n        bodyClasses: 'router--work-packages-partitioned-split-view-new',\n        // Remember the base route so we can route back to it anywhere\n        baseRoute: baseRoute,\n        parent: baseRoute\n      },\n      views: {\n        // Retarget and by that override the grandparent views\n        // https://ui-router.github.io/guide/views#relative-parent-state\n        'content-right@^.^': { component: newComponent }\n      }\n    },\n    // Split copy route\n    {\n      name: baseRoute + '.copy',\n      url: '/details/{copiedFromWorkPackageId:[0-9]+}/copy',\n      views: {\n        'content-right@^.^': { component: WorkPackageCopySplitViewComponent }\n      },\n      reloadOnSearch: false,\n      data: {\n        baseRoute: baseRoute,\n        parent: baseRoute,\n        allowMovingInEditMode: true,\n        bodyClasses: 'router--work-packages-partitioned-split-view',\n        menuItem: menuItemClass,\n        partition: '-split'\n      },\n    },\n  ];\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {HalLink} from \"core-app/modules/hal/hal-link/hal-link\";\n\n@Injectable()\nexport class BcfPathHelperService {\n  constructor(readonly pathHelper:PathHelperService) {\n  }\n\n  public projectImportIssuePath(projectIdentifier:string) {\n    return this.pathHelper.projectPath(projectIdentifier) + '/issues/upload';\n  }\n\n  public projectExportIssuesPath(projectIdentifier:string, filters:string|null) {\n    if (filters) {\n      return this.pathHelper.projectPath(projectIdentifier) + '/work_packages.bcf?filters=' + filters;\n    } else {\n      return this.pathHelper.projectPath(projectIdentifier) + '/work_packages.bcf';\n    }\n  }\n\n  public snapshotPath(viewpoint:HalLink) {\n    return viewpoint.href + '/snapshot';\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {States} from '../../../states.service';\nimport {isRelationColumn, QueryColumn} from '../../../wp-query/query-column';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {tdClassName} from '../cell-builder';\nimport {commonRowClassName, SingleRowBuilder, tableRowClassName} from '../rows/single-row-builder';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {RelationColumnType} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport function relationGroupClass(workPackageId:string) {\n  return `__relations-expanded-from-${workPackageId}`;\n}\n\nexport function relationIdentifier(targetId:string, workPackageId:string) {\n  return `wp-relation-row-${workPackageId}-to-${targetId}`;\n}\n\nexport const relationCellClassName = 'wp-table--relation-cell-td';\n\nexport class RelationRowBuilder extends SingleRowBuilder {\n\n  @InjectField() public states:States;\n  @InjectField() public I18n:I18nService;\n\n  constructor(public readonly injector:Injector,\n              protected workPackageTable:WorkPackageTable) {\n\n    super(injector, workPackageTable);\n  }\n\n  /**\n   * For additional relation rows, we don't want to render an expandable relation cell,\n   * but instead we render the relation label.\n   * @param workPackage\n   * @param column\n   * @return {any}\n   */\n  public buildCell(workPackage:WorkPackageResource, column:QueryColumn):HTMLElement|null {\n\n    // handle relation types\n    if (isRelationColumn(column)) {\n      return this.emptyRelationCell(column);\n    }\n\n    return super.buildCell(workPackage, column);\n  }\n\n  /**\n   * Build the columns on the given empty row\n   */\n  public buildEmptyRelationRow(from:WorkPackageResource, relation:RelationResource, type:RelationColumnType):[HTMLElement, WorkPackageResource] {\n    const denormalized = relation.denormalized(from);\n\n    const to = this.states.workPackages.get(denormalized.targetId).value!;\n\n    // Let the primary row builder build the row\n    const row = this.createEmptyRelationRow(from, to);\n    const [tr, _] = super.buildEmptyRow(to, row);\n\n    return [tr, to];\n  }\n\n  /**\n   * Create an empty unattached row element for the given work package\n   * @param workPackage\n   * @returns {any}\n   */\n  public createEmptyRelationRow(from:WorkPackageResource, to:WorkPackageResource) {\n    const identifier = this.relationClassIdentifier(from, to);\n    let tr = document.createElement('tr');\n    tr.dataset['workPackageId'] = to.id!;\n    tr.dataset['classIdentifier'] = identifier;\n\n    tr.classList.add(\n      commonRowClassName, tableRowClassName, 'issue',\n      `wp-table--relations-aditional-row`,\n      identifier,\n      `${identifier}-table`,\n      relationGroupClass(from.id!)\n    );\n\n    return tr;\n  }\n\n  public relationClassIdentifier(from:WorkPackageResource, to:WorkPackageResource) {\n    return relationIdentifier(to.id!, from.id!);\n  }\n\n  /**\n   *\n   * @param from\n   * @param denormalized\n   * @param type\n   */\n  public appendRelationLabel(jRow:JQuery, from:WorkPackageResource, relation:RelationResource, columnId:string, type:RelationColumnType) {\n    const denormalized = relation.denormalized(from);\n    let typeLabel = '';\n\n    // Add the relation label if this is a \"Relations for <WP Type>\" column\n    if (type === 'toType') {\n      typeLabel = this.I18n.t(`js.relation_labels.${denormalized.reverseRelationType}`);\n    }\n    // Add the WP type label if this is a \"<Relation Type> Relations\" column\n    if (type === 'ofType') {\n      const wp = this.states.workPackages.get(denormalized.target.id!).value!;\n      typeLabel = wp.type.name;\n    }\n\n    const relationLabel = document.createElement('span');\n    relationLabel.classList.add('relation-row--type-label');\n    relationLabel.textContent = typeLabel;\n\n    const textNode = document.createTextNode(denormalized.target.name);\n\n    jRow.find(`.${relationCellClassName}`).empty();\n    jRow.find(`.${relationCellClassName}.${columnId}`).append(relationLabel);\n  }\n\n  protected emptyRelationCell(column:QueryColumn) {\n    const cell = document.createElement('td');\n    cell.classList.add(relationCellClassName, tdClassName, column.id);\n\n    return cell;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {PrimaryRenderPass, RowRenderInfo} from '../primary-render-pass';\nimport {relationGroupClass, RelationRowBuilder} from './relation-row-builder';\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {\n  RelationColumnType,\n  WorkPackageViewRelationColumnsService\n} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport interface RelationRenderInfo extends RowRenderInfo {\n  data:{\n    relation:RelationResource;\n    columnId:string;\n    relationType:RelationColumnType;\n  };\n}\n\nexport class RelationsRenderPass {\n  @InjectField() wpRelations:WorkPackageRelationsService;\n  @InjectField() wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() wpTableRelationColumns:WorkPackageViewRelationColumnsService;\n\n  public relationRowBuilder:RelationRowBuilder;\n\n  constructor(public readonly injector:Injector,\n              private table:WorkPackageTable,\n              private tablePass:PrimaryRenderPass) {\n\n    this.relationRowBuilder = new RelationRowBuilder(injector, table);\n  }\n\n  public render() {\n    // If no relation column active, skip this pass\n    if (!this.isApplicable) {\n      return;\n    }\n\n    // Render for each original row, clone it since we're modifying the tablepass\n    const rendered = _.clone(this.tablePass.renderedOrder);\n    rendered.forEach((row:RowRenderInfo, position:number) => {\n\n      // We only care for rows that are natural work packages\n      if (!row.workPackage) {\n        return;\n      }\n\n      // If the work package has no relations, ignore\n      const workPackage = row.workPackage;\n      const fromId = workPackage.id!;\n      const state = this.wpRelations.state(fromId);\n      if (!state.hasValue() || _.size(state.value) === 0) {\n        return;\n      }\n\n      this.wpTableRelationColumns.relationsToExtendFor(workPackage,\n        state.value,\n        (relation:RelationResource, column:QueryColumn, type:any) => {\n\n          // Build each relation row (currently sorted by order defined in API)\n          const [relationRow, target] = this.relationRowBuilder.buildEmptyRelationRow(\n            workPackage,\n            relation,\n            type\n          );\n\n          // Augment any data for the belonging work package row to it\n          relationRow.classList.add(...row.additionalClasses);\n          this.relationRowBuilder.appendRelationLabel(jQuery(relationRow),\n            workPackage,\n            relation,\n            column.id,\n            type);\n\n          // Insert next to the work package row\n          // If no relations exist until here, directly under the row\n          // otherwise as the last element of the relations\n          // Insert into table\n          this.tablePass.spliceRow(\n            relationRow,\n            `.${this.relationRowBuilder.classIdentifier(workPackage)},.${relationGroupClass(fromId)}`,\n            {\n              classIdentifier: this.relationRowBuilder.relationClassIdentifier(workPackage, target),\n              additionalClasses: row.additionalClasses.concat(['wp-table--relations-aditional-row']),\n              workPackage: target,\n              belongsTo: workPackage,\n              renderType: 'relations',\n              hidden: row.hidden,\n              data: {\n                relation: relation,\n                columnId: column.id,\n                relationType: type\n              }\n            } as RelationRenderInfo\n          );\n        });\n    });\n  }\n\n  public refreshRelationRow(renderedRow:RelationRenderInfo,\n                            workPackage:WorkPackageResource,\n                            oldRow:JQuery) {\n    const newRow = this.relationRowBuilder.refreshRow(workPackage, oldRow);\n    this.relationRowBuilder.appendRelationLabel(newRow,\n      renderedRow.belongsTo!,\n      renderedRow.data.relation,\n      renderedRow.data.columnId,\n      renderedRow.data.relationType);\n\n    return newRow;\n  }\n\n  private get isApplicable() {\n    return this.wpTableColumns.hasRelationColumns();\n  }\n}\n","import {Injector} from '@angular/core';\nimport {PrimaryRenderPass, RowRenderInfo} from '../primary-render-pass';\nimport {TimelineRowBuilder} from './timeline-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\n\nexport class TimelineRenderPass {\n\n  /** Row builders */\n  protected timelineBuilder:TimelineRowBuilder;\n\n  /** Resulting timeline body */\n  public timelineBody:DocumentFragment;\n\n  constructor(public readonly injector:Injector,\n              private table:WorkPackageTable,\n              private tablePass:PrimaryRenderPass) {\n  }\n\n  public render() {\n    // Prepare and reset the render pass\n    this.timelineBody = document.createDocumentFragment();\n    this.timelineBuilder = new TimelineRowBuilder(this.injector, this.table);\n\n    // Render into timeline fragment\n    this.tablePass.renderedOrder.forEach((row:RowRenderInfo) => {\n      const wpId = row.workPackage ? row.workPackage.id : null;\n\n      const secondary = this.timelineBuilder.build(wpId);\n      secondary.classList.add(row.classIdentifier, `${row.classIdentifier}-timeline`, ...row.additionalClasses);\n      this.timelineBody.appendChild(secondary);\n    });\n  }\n}\n","import {Injector} from '@angular/core';\nimport {PrimaryRenderPass, RowRenderInfo} from \"core-components/wp-fast-table/builders/primary-render-pass\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HighlightingRenderPass {\n\n  @InjectField() wpTableHighlighting:WorkPackageViewHighlightingService;\n  @InjectField() querySpace:IsolatedQuerySpace;\n\n  constructor(public readonly injector:Injector,\n              private table:WorkPackageTable,\n              private tablePass:PrimaryRenderPass) {\n\n  }\n\n  public render() {\n    // If highlighting is done inline in attributes, skip\n    if (!this.isApplicable) {\n      return;\n    }\n\n    const highlightAttribute = this.wpTableHighlighting.current.mode;\n\n    // Get the computed style to identify bright properties\n    const styles = window.getComputedStyle(document.body);\n\n    // Render for each original row, clone it since we're modifying the tablepass\n    this.tablePass.renderedOrder.forEach((row:RowRenderInfo, position:number) => {\n\n      // We only care for rows that are natural work packages\n      if (!row.workPackage) {\n        return;\n      }\n\n      // Get the loaded attribute of the WP\n      const property = row.workPackage[highlightAttribute] as HalResource;\n\n      // We only color rows that have an active attribute\n      if (!property) {\n        return;\n      }\n\n      const id = property.id!;\n      const element:HTMLElement = this.tablePass.tableBody.children[position] as HTMLElement;\n      element.classList.add(Highlighting.backgroundClass(highlightAttribute, id));\n    });\n  }\n\n  private get isApplicable() {\n    return !(this.wpTableHighlighting.isInline || this.wpTableHighlighting.isDisabled);\n  }\n}\n","import {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {tdClassName} from \"core-components/wp-fast-table/builders/cell-builder\";\nimport {Injector} from \"@angular/core\";\nimport {TableDragActionsRegistryService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-actions-registry.service\";\nimport {TableDragActionService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-action.service\";\nimport {internalSortColumn} from \"core-components/wp-fast-table/builders/internal-sort-columns\";\n\n/** Debug the render position */\nconst RENDER_DRAG_AND_DROP_POSITION = false;\n\nexport class DragDropHandleBuilder {\n\n  // Injections\n  private actionService:TableDragActionService;\n\n  constructor(public readonly injector:Injector) {\n    const dragActionRegistry = this.injector.get(TableDragActionsRegistryService);\n    this.actionService = dragActionRegistry.get(injector);\n  }\n\n  /**\n   * Renders an angular CDK drag component into the column\n   */\n  public build(workPackage:WorkPackageResource, position?:number):HTMLElement {\n    // Append sort handle\n    let td = document.createElement('td');\n\n    if (!this.actionService.canPickup(workPackage)) {\n      return td;\n    }\n\n    td.classList.add(tdClassName, 'wp-table--sort-td', internalSortColumn.id,  'hide-when-print');\n\n    // Wrap handle as span\n    let span = document.createElement('span');\n    span.classList.add('wp-table--drag-and-drop-handle', 'icon-drag-handle');\n    td.appendChild(span);\n\n    if (RENDER_DRAG_AND_DROP_POSITION) {\n      let text = document.createElement('span');\n      text.textContent = '' + position;\n      td.appendChild(text);\n    }\n\n    return td;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {PrimaryRenderPass, RowRenderInfo} from '../primary-render-pass';\nimport {DragDropHandleBuilder} from \"core-components/wp-fast-table/builders/drag-and-drop/drag-drop-handle-builder\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {QueryOrder} from \"core-app/modules/hal/dm-services/query-order-dm.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class DragDropHandleRenderPass {\n\n  @InjectField() public wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() public wpTableOrder:WorkPackageViewOrderService;\n\n  // Drag & Drop handle builder\n  protected dragDropHandleBuilder = new DragDropHandleBuilder(this.injector);\n\n  constructor(public readonly injector:Injector,\n              private table:WorkPackageTable,\n              private tablePass:PrimaryRenderPass) {\n  }\n\n  public render() {\n    if (!this.table.configuration.dragAndDropEnabled) {\n      return;\n    }\n\n\n    this.wpTableOrder.withLoadedPositions().then((positions:QueryOrder) => {\n      this.tablePass.renderedOrder.forEach((row:RowRenderInfo, position:number) => {\n        // We only care for rows that are natural work packages and are not relation sub-rows\n        if (!row.workPackage || row.renderType === 'relations') {\n          return;\n        }\n\n        const handle = this.dragDropHandleBuilder.build(row.workPackage!, positions[row.workPackage!.id!]);\n\n        if (handle) {\n          row.element.replaceChild(handle, row.element.firstElementChild!);\n        }\n      });\n    });\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {timeOutput} from '../../../helpers/debug_output';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {States} from '../../states.service';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageTable} from '../wp-fast-table';\nimport {RelationRenderInfo, RelationsRenderPass} from './relations/relations-render-pass';\nimport {SingleRowBuilder} from './rows/single-row-builder';\nimport {TimelineRenderPass} from './timeline/timeline-render-pass';\nimport {HighlightingRenderPass} from \"core-components/wp-fast-table/builders/highlighting/row-highlight-render-pass\";\nimport {DragDropHandleRenderPass} from \"core-components/wp-fast-table/builders/drag-and-drop/drag-drop-handle-render-pass\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport type RenderedRowType = 'primary'|'relations';\n\nexport interface RowRenderInfo {\n  // The rendered row\n  element:HTMLTableRowElement;\n  // Unique class name as an identifier to uniquely identify the row in both table and timeline\n  classIdentifier:string;\n  // Additional classes to be added by any secondary render passes\n  additionalClasses:string[];\n  // If this row is a work package, contains a reference to the rendered WP\n  workPackage:WorkPackageResource|null;\n  // If this is an additional row not present, this contains a reference to the WP\n  // it originated from\n  belongsTo?:WorkPackageResource;\n  // The type of row this was rendered from\n  renderType:RenderedRowType;\n  // Marks if the row is currently hidden to the user\n  hidden:boolean;\n  // Additional data by the render passes\n  data?:any;\n}\n\nexport abstract class PrimaryRenderPass {\n\n  @InjectField() halEditing:HalResourceEditingService;\n  @InjectField() states:States;\n  @InjectField() I18n:I18nService;\n\n  /** The rendered order of rows of work package IDs or <null>, if not a work package row */\n  public renderedOrder:RowRenderInfo[];\n\n  /** Resulting table body */\n  public tableBody:DocumentFragment;\n\n  /** Additional render pass that handles timeline rendering */\n  public timeline:TimelineRenderPass;\n\n  /** Additional render pass that handles table relation rendering */\n  public relations:RelationsRenderPass;\n\n  /** Additional render pass that handles drag'n'drop handle rendering */\n  public dragDropHandle:DragDropHandleRenderPass;\n\n  /** Additional render pass that handles highlighting of rows */\n  public highlighting:HighlightingRenderPass;\n\n  constructor(public readonly injector:Injector,\n              public workPackageTable:WorkPackageTable,\n              public rowBuilder:SingleRowBuilder) {\n  }\n\n  /**\n   * Execute the entire render pass, executing this pass and all subsequent registered passes\n   * for timeline and relations.\n   * @return {PrimaryRenderPass}\n   */\n  public render():this {\n\n    timeOutput('Primary render pass', () => {\n\n      // Prepare and reset the render pass\n      this.prepare();\n\n      // Render into the table fragment\n      this.doRender();\n\n      // Post render\n      this.postRender();\n    });\n\n    // Render subsequent passes\n    // that may modify the structure of the table\n    this.highlighting.render();\n\n    timeOutput('Relations render pass', () => {\n      this.relations.render();\n    });\n\n    timeOutput('Drag handle render pass', () => {\n      this.dragDropHandle.render();\n    });\n\n    // Synchronize the rows to timeline\n    timeOutput('Timelines render pass', () => {\n      this.timeline.render();\n    });\n\n    return this;\n  }\n\n  /**\n   * Refresh a single row using the render pass it was originally created from.\n   * @param row\n   */\n  public refresh(row:RowRenderInfo, workPackage:WorkPackageResource, body:HTMLElement) {\n    let oldRow = jQuery(body).find(`.${row.classIdentifier}`);\n    let replacement:JQuery|null = null;\n\n    switch (row.renderType) {\n      case 'primary':\n        replacement = this.rowBuilder.refreshRow(workPackage, oldRow);\n        break;\n      case 'relations':\n        replacement = this.relations.refreshRelationRow(row as RelationRenderInfo, workPackage, oldRow);\n    }\n\n    if (replacement !== null && oldRow.length) {\n      oldRow.replaceWith(replacement);\n    }\n  }\n\n  public get result():RenderedWorkPackage[] {\n    return this.renderedOrder.map((row) => {\n      return {\n        classIdentifier: row.classIdentifier,\n        workPackageId: row.workPackage ? row.workPackage.id : null,\n        hidden: row.hidden\n      };\n    });\n  }\n\n  /**\n   * Splice a row into a specific location of the current render pass through the given selector.\n   *\n   * 1. Insert into the document fragment after the last match of the selector\n   * 2. Splice into the renderedOrder array.\n   */\n  public spliceRow(row:HTMLElement, selector:string, renderedInfo:RowRenderInfo) {\n    // Insert into table using the selector\n    // If it matches multiple, select the last element\n    const target = jQuery(this.tableBody)\n      .find(selector)\n      .last();\n\n    target.after(row);\n\n    // Splice the renderedOrder at this exact location\n    const index = target.index();\n    this.renderedOrder.splice(index + 1, 0, renderedInfo);\n  }\n\n  protected prepare() {\n    this.timeline = new TimelineRenderPass(this.injector, this.workPackageTable, this);\n    this.relations = new RelationsRenderPass(this.injector, this.workPackageTable, this);\n    this.dragDropHandle = new DragDropHandleRenderPass(this.injector, this.workPackageTable, this);\n    this.highlighting = new HighlightingRenderPass(this.injector, this.workPackageTable, this);\n    this.tableBody = document.createDocumentFragment();\n    this.renderedOrder = [];\n  }\n\n  /**\n   * The actual render function of this renderer.\n   */\n  protected abstract doRender():void;\n\n  /**\n   * Post render shared among all sub passes\n   */\n  protected postRender():void {\n    if (this.renderedOrder.length === 0 && this.workPackageTable.renderPlaceholderRow) {\n      this.tableBody.appendChild(this.rowBuilder.placeholderRow);\n    }\n  }\n\n  /**\n   * Append a work package row to both containers\n   * @param workPackage The work package, if the row belongs to one\n   * @param row HTMLElement to append\n   * @param rowClasses Additional classes to apply to the timeline row for mirroring purposes\n   * @param hidden whether the row was rendered hidden\n   */\n  protected appendRow(workPackage:WorkPackageResource,\n                      row:HTMLTableRowElement,\n                      additionalClasses:string[] = [],\n                      hidden:boolean = false) {\n\n    this.tableBody.appendChild(row);\n\n    this.renderedOrder.push({\n      classIdentifier: this.rowBuilder.classIdentifier(workPackage),\n      additionalClasses: additionalClasses,\n      workPackage: workPackage,\n      renderType: 'primary',\n      element: row,\n      hidden: hidden\n    });\n  }\n\n  /**\n   * Append a non-work package row to both containers\n   * @param row HTMLElement to append\n   * @param classIdentifer a unique identifier for the two rows (one each in table/timeline).\n   * @param hidden whether the row was rendered hidden\n   */\n  protected appendNonWorkPackageRow(row:HTMLTableRowElement,\n                                    classIdentifer:string,\n                                    additionalClasses:string[] = [],\n                                    hidden:boolean = false) {\n    row.classList.add(classIdentifer);\n    this.tableBody.appendChild(row);\n\n    this.renderedOrder.push({\n      element: row,\n      classIdentifier: classIdentifer,\n      additionalClasses: additionalClasses,\n      workPackage: null,\n      renderType: 'primary',\n      hidden: hidden\n    });\n  }\n}\n","import {Injector} from '@angular/core';\nimport {States} from '../../states.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {tdClassName} from './cell-builder';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {QueryColumn} from '../../wp-query/query-column';\nimport {WorkPackageRelationsService} from '../../wp-relations/wp-relations.service';\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const relationCellTdClassName = 'wp-table--relation-cell-td';\nexport const relationCellIndicatorClassName = 'wp-table--relation-indicator';\n\nexport class RelationCellbuilder {\n\n  @InjectField() states:States;\n  @InjectField() wpRelations:WorkPackageRelationsService;\n  @InjectField() wpTableRelationColumns:WorkPackageViewRelationColumnsService;\n\n  constructor(public readonly injector:Injector) {\n  }\n\n  public build(workPackage:WorkPackageResource, column:QueryColumn) {\n    const td = document.createElement('td');\n    td.classList.add(tdClassName, relationCellTdClassName, column.id);\n    td.dataset['columnId'] = column.id;\n\n    // Get current expansion and value state\n    const expanded = this.wpTableRelationColumns.getExpandFor(workPackage.id!) === column.id;\n    const relationState = this.wpRelations.state(workPackage.id!).value;\n    const relations = this.wpTableRelationColumns.relationsForColumn(workPackage,\n      relationState,\n      column);\n\n    const indicator = this.renderIndicator();\n    const badge = this.renderBadge(relations);\n\n    if (expanded) {\n      td.classList.add('-expanded');\n    }\n\n    if (relations.length > 0) {\n      td.appendChild(badge);\n      td.appendChild(indicator);\n    }\n\n    return td;\n  }\n\n  private renderIndicator() {\n    const indicator = document.createElement('span');\n    indicator.classList.add(relationCellIndicatorClassName);\n    indicator.setAttribute('aria-hidden', 'true');\n    indicator.setAttribute('tabindex', '0');\n\n    return indicator;\n  }\n\n  private renderBadge(relations:RelationResource[]) {\n    const badge = document.createElement('span');\n    badge.classList.add('wp-table--relation-count');\n\n    badge.textContent = '' + relations.length;\n    badge.classList.add('badge', '-border-only');\n\n    return badge;\n  }\n}\n\n","import {Component, Input, OnInit} from \"@angular/core\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\n\n@Component({\n  selector: 'activity-link',\n  template: `\n    <a id =\"{{ activityHtmlId }}-link\"\n       [textContent]=\"activityLabel\"\n       uiSref=\"work-packages.show.activity\"\n       [uiParams]=\"{workPackageId: workPackage.id!, '#': activityHtmlId }\">\n    </a>\n  `\n})\nexport class ActivityLinkComponent implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public activityNo:number;\n\n  public activityHtmlId:string;\n  public activityLabel:string;\n\n  ngOnInit() {\n    this.activityHtmlId = `activity-${this.activityNo}`;\n    this.activityLabel = `#${this.activityNo}`;\n  }\n}\n\nfunction activityLink() {\n  return {\n    restrict: 'E',\n    template: `\n    `,\n    scope: {\n    },\n    link: function(scope:any) {\n      scope.workPackageId = scope.workPackage.id!;\n      scope.activityHtmlId = 'activity-' + scope.activityNo;\n    }\n  };\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {PayloadDmService} from 'core-app/modules/hal/dm-services/payload-dm.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {Injectable} from '@angular/core';\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {Observable} from \"rxjs\";\nimport {QueryFiltersService} from \"core-components/wp-query/query-filters.service\";\nimport {DmListParameter} from \"core-app/modules/hal/dm-services/dm.service.interface\";\nimport {AbstractDmService} from \"core-app/modules/hal/dm-services/abstract-dm.service\";\nimport {HttpClient} from \"@angular/common/http\";\nimport * as URI from 'urijs';\n\nexport interface PaginationObject {\n  pageSize:number;\n  offset:number;\n}\n\n@Injectable()\nexport class QueryDmService extends AbstractDmService<QueryResource> {\n  constructor(protected halResourceService:HalResourceService,\n              protected http:HttpClient,\n              protected pathHelper:PathHelperService,\n              protected UrlParamsHelper:UrlParamsHelperService,\n              protected QueryFilters:QueryFiltersService,\n              protected PayloadDm:PayloadDmService) {\n    super(halResourceService,\n      pathHelper);\n  }\n\n  /**\n   * Stream the response for the given query request\n   * @param queryData\n   * @param queryId\n   * @param projectIdentifier\n   */\n  public stream(queryData:Object, queryId?:string, projectIdentifier?:string|null):Observable<QueryResource> {\n    let path:string;\n\n    if (queryId) {\n      path = this.pathHelper.api.v3.queries.id(queryId).toString();\n    } else {\n      path = this.pathHelper.api.v3.withOptionalProject(projectIdentifier).queries.default.toString();\n    }\n\n    return this.halResourceService\n      .get<QueryResource>(path, queryData);\n  }\n\n  public find(queryData:Object, queryId?:string, projectIdentifier?:string|null):Promise<QueryResource> {\n    return this.stream(queryData, queryId, projectIdentifier).toPromise();\n  }\n\n  public findDefault(queryData:Object, projectIdentifier?:string|null):Promise<QueryResource> {\n    return this.find(queryData, undefined, projectIdentifier);\n  }\n\n  public reload(query:QueryResource, pagination:PaginationObject):Promise<QueryResource> {\n    let path = this.pathHelper.api.v3.queries.id(query.id!).toString();\n\n    return this.halResourceService\n      .get<QueryResource>(path, pagination)\n      .toPromise();\n  }\n\n  public loadResults(query:QueryResource, pagination:PaginationObject):Promise<QueryResource> {\n    if (!query.results) {\n      throw 'No results embedded when expected';\n    }\n\n    let queryData = this.UrlParamsHelper.buildV3GetQueryFromQueryResource(query, pagination);\n    let url = URI(query.href!).path();\n\n    return this.halResourceService\n      .get<QueryResource>(url, queryData)\n      .toPromise();\n  }\n\n  public loadIdsUpdatedSince(ids:any, timestamp:any):Promise<WorkPackageCollectionResource> {\n    const filters = [\n      {\n        id: {\n          operator: '=',\n          values: ids.filter((n:String|null) => n) // no null values\n        },\n      },\n      {\n        updatedAt: {\n          operator: '<>d',\n          values: [timestamp, '']\n        }\n      }\n    ];\n\n    return this.halResourceService\n      .get<WorkPackageCollectionResource>(this.pathHelper.api.v3.work_packages.toString(), { filters: JSON.stringify(filters) })\n      .toPromise();\n  }\n\n  public update(query:QueryResource, form:QueryFormResource):Observable<QueryResource> {\n    const payload = this.extractPayload(query, form);\n    return this.patch(query.id!, payload);\n  }\n\n  public patch(id:string, payload:{ [key:string]:unknown }):Observable<QueryResource> {\n    let path:string = this.pathHelper.api.v3.queries.id(id).toString();\n    return this.halResourceService\n      .patch<QueryResource>(path, payload);\n  }\n\n  public create(query:QueryResource, form:QueryFormResource):Promise<QueryResource> {\n    const payload:any = this.extractPayload(query, form);\n    let path:string = this.pathHelper.api.v3.queries.toString();\n\n    return this.halResourceService\n      .post<QueryResource>(path, payload)\n      .toPromise();\n  }\n\n  public delete(query:QueryResource) {\n    return query.delete();\n  }\n\n  public toggleStarred(query:QueryResource) {\n    if (query.starred) {\n      return query.unstar();\n    } else {\n      return query.star();\n    }\n  }\n\n  public listNonHidden(projectIdentifier:string|null|undefined):Promise<CollectionResource<QueryResource>> {\n    let listParams:DmListParameter = {\n      filters: [['hidden', '=', ['f']]]\n    };\n\n    if (projectIdentifier) {\n      // all queries with the provided projectIdentifier\n      listParams.filters!.push(['project_identifier', '=', [projectIdentifier]]);\n    } else {\n      // all queries having no project (i.e. being global)\n      listParams.filters!.push(['project', '!*', []]);\n    }\n    return this.list(listParams);\n  }\n\n  private extractPayload(query:QueryResource, form:QueryFormResource):QueryResource {\n    // Extracting requires having the filter schemas loaded as the dependencies\n    this.QueryFilters.mapSchemasIntoFilters(query, form);\n    return this.PayloadDm.extract<QueryResource>(query, form.schema);\n  }\n\n  protected listUrl():string {\n    return this.pathHelper.api.v3.queries.toString();\n  }\n\n  protected oneUrl(id:number|string):string {\n    return this.pathHelper.api.v3.queries.id(id).toString();\n  }\n}\n","import {InjectionToken} from \"@angular/core\";\n\nexport const OpContextMenuLocalsToken = new InjectionToken<any>('CONTEXT_MENU_LOCALS');\n\nexport interface OpContextMenuLocalsMap {\n  items:OpContextMenuItem[];\n  contextMenuId?:string;\n  [key:string]:any;\n};\n\nexport interface OpContextMenuItem {\n  disabled?:boolean;\n  hidden?:boolean;\n  icon?:string;\n  href?:string;\n  class?:string;\n  ariaLabel?:string;\n  linkText?:string;\n  divider?:boolean;\n  onClick?:($event:JQuery.TriggeredEvent) => boolean;\n}\n","import {Inject, Injectable} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabInterface} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {WpTableConfigurationService} from 'core-components/wp-table/configuration-modal/wp-table-configuration.service';\nimport {QueryConfigurationLocals} from 'core-components/wp-table/external-configuration/external-query-configuration.component';\nimport {OpQueryConfigurationLocalsToken} from \"core-components/wp-table/external-configuration/external-query-configuration.constants\";\n\n@Injectable()\nexport class RestrictedWpTableConfigurationService extends WpTableConfigurationService {\n\n  constructor(@Inject(OpQueryConfigurationLocalsToken) readonly locals:QueryConfigurationLocals,\n              readonly I18n:I18nService) {\n    super(I18n);\n  }\n\n  public get tabs():TabInterface[] {\n    const disabledTabs = this.locals.disabledTabs || {};\n\n    return this\n      ._tabs\n      .map(el => {\n        const reason = disabledTabs[el.name];\n        if (reason != null) {\n          el.disableBecause = reason;\n        }\n\n        return el;\n      });\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nexport namespace LinkHandling {\n\n  export function isClickedWithModifier(event:MouseEvent|JQuery.TriggeredEvent) {\n    const modifier = event.ctrlKey || event.shiftKey || event.metaKey;\n    const middleButton = event.button === 1;\n\n    return modifier || middleButton;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Directive, EventEmitter, HostListener, Input, Output} from '@angular/core';\n\n@Directive({\n  selector: '[doubleClickOrTap]',\n})\nexport class DoubleClickOrTapDirective {\n  @Input('doubleClickOrTapStopEvent') stopEventPropagation:boolean = true;\n  @Output('doubleClickOrTap') eventHandler = new EventEmitter<any>();\n\n  @HostListener('dblclick', ['$event'])\n  @HostListener('tap', ['$event'])\n  public handleClick(event:any):boolean {\n    // Pass along double clicks immediately\n    // Or when the hammer.js event tap count reaches two\n    if (event.type === 'dblclick' || event.tapCount === 2) {\n      this.eventHandler.emit(event);\n      return this.eventStopReturnCode(event);\n    }\n\n\n    return true;\n  }\n\n  /**\n   * If requested to stop event propagation, stop it\n   * and return false.\n   * Otherwise, return true.\n   *\n   * @param event Event being handled\n   */\n  private eventStopReturnCode(event:Event):boolean {\n    if (this.stopEventPropagation) {\n      event.preventDefault();\n\n      if (!!event.stopPropagation) {\n        event.stopPropagation();\n      }\n\n      return false;\n    }\n\n    return true;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {buildApiV3Filter} from 'core-app/components/api/api-v3/api-v3-filter-builder';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\n\n@Injectable()\nexport class RelationsDmService {\n\n  constructor(private halResourceService:HalResourceService,\n              private pathHelper:PathHelperService) {\n\n  }\n\n  public load(workPackageId:string):Promise<RelationResource[]> {\n    return this.halResourceService.get<CollectionResource<RelationResource>>(\n      this.pathHelper.api.v3.work_packages.id(workPackageId).relations, {})\n      .toPromise()\n      .then((collection:CollectionResource<RelationResource>) => collection.elements);\n  }\n\n  public loadInvolved(workPackageIds:string[]):Promise<RelationResource[]> {\n    let validIds = _.filter(workPackageIds, id => /\\d+/.test(id));\n\n    if (validIds.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    return this.halResourceService.get<CollectionResource<RelationResource>>(\n      this.pathHelper.api.v3.relations.toPath(),\n      {\n        filters: buildApiV3Filter('involved', '=', validIds).toJson()\n      })\n      .toPromise()\n      .then((collection:CollectionResource<RelationResource>) => collection.elements);\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {QueryFormResource} from \"core-app/modules/hal/resources/query-form-resource\";\nimport {QueryFilterInstanceSchemaResource} from \"core-app/modules/hal/resources/query-filter-instance-schema-resource\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\n\n@Injectable()\nexport class QueryFiltersService {\n\n  /**\n   * Get the matching schema of the filter resource\n   * from the schema\n   */\n  public getFilterSchema(filter:QueryFilterInstanceResource, form:QueryFormResource):QueryFilterInstanceSchemaResource|undefined {\n    const available = form.$embedded.schema.filtersSchemas.elements;\n    return _.find(available, schema => schema.allowedFilterValue.href === filter.filter.href);\n  }\n\n  /**\n   * Map all filters of the query with the appropriate schema.\n   * @param query\n   * @param form\n   */\n  public mapSchemasIntoFilters(query:QueryResource, form:QueryFormResource) {\n    query.filters.forEach(filter => {\n      filter.schema = this.getFilterSchema(filter, form)!;\n    });\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {Directive, ElementRef} from \"@angular/core\";\nimport {OpContextMenuTrigger} from \"core-components/op-context-menu/handlers/op-context-menu-trigger.directive\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {States} from \"core-components/states.service\";\nimport {FormResource} from 'core-app/modules/hal/resources/form-resource';\n\n@Directive({\n  selector: '[wpCreateSettingsMenu]'\n})\nexport class WorkPackageCreateSettingsMenuDirective extends OpContextMenuTrigger {\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly states:States,\n              readonly halEditing:HalResourceEditingService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    const wp = this.states.workPackages.get('new').value;\n\n    if (wp) {\n      const change = this.halEditing.changeFor(wp);\n      change.getForm().then(\n        (loadedForm:FormResource) => {\n          this.buildItems(loadedForm);\n          this.opContextMenu.show(this, evt);\n        }\n      );\n    }\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let additionalPositionArgs = {\n      my: 'right top',\n      at: 'right bottom'\n    };\n\n    let position = super.positionArgs(evt);\n    _.assign(position, additionalPositionArgs);\n\n    return position;\n  }\n\n  private buildItems(form:FormResource) {\n    this.items = [];\n    const configureFormLink = form.configureForm;\n    const queryCustomFields = form.customFields;\n\n    if (queryCustomFields) {\n      this.items.push({\n        href: queryCustomFields.href,\n        icon: 'icon-custom-fields',\n        linkText: queryCustomFields.name,\n        onClick: () => false\n      });\n    }\n\n    if (configureFormLink) {\n      this.items.push({\n        href: configureFormLink.href,\n        icon: 'icon-settings3',\n        linkText: configureFormLink.name,\n        onClick: () => false\n      });\n    }\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {StateService} from \"@uirouter/angular\";\n\n/**\n * Returns the path to the split view based on the current route\n *\n * @param state State service\n */\nexport function splitViewRoute(state:StateService):string {\n  const baseRoute = state.current.data.baseRoute || '';\n  return baseRoute + '.details';\n}\n","import {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {States} from 'core-components/states.service';\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {QuerySchemaResource} from \"core-app/modules/hal/resources/query-schema-resource\";\nimport {WorkPackageViewHighlight} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-highlight\";\n\n@Injectable()\nexport class WorkPackageViewHighlightingService extends WorkPackageQueryStateService<WorkPackageViewHighlight>{\n  public constructor(readonly states:States,\n                     readonly Banners:BannersService,\n                     readonly querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  initialize(query:QueryResource, results:WorkPackageCollectionResource, schema?:QuerySchemaResource) {\n    super.initialize(query, results, schema);\n  }\n\n  /**\n   * Decides whether we want to inline highlight the given field name.\n   *\n   * @param name A display field name such as 'status', 'priority'.\n   */\n  public shouldHighlightInline(name:string):boolean {\n    // 1. Are we in inline mode or unable to render?\n    if (!this.isInline || this.Banners.eeShowBanners) {\n      return false;\n    }\n\n    // 2. Is selected attributes === undefined or empty Array?\n    if (this.current.selectedAttributes === undefined || this.current.selectedAttributes === []) {\n      return true;\n    }\n\n    // 3. Is name in selected attributes ?\n    return !!_.find(this.current.selectedAttributes, (attr:HalResource) => attr.id === name);\n  }\n\n  public get current():WorkPackageViewHighlight {\n    let value = this.lastUpdatedState.getValueOr({ mode: 'inline' } as WorkPackageViewHighlight);\n    return this.filteredValue(value);\n  }\n\n  public get isInline() {\n    return this.current.mode === 'inline';\n  }\n\n  public get isDisabled() {\n    return this.current.mode === 'none';\n  }\n\n  public update(value:WorkPackageViewHighlight) {\n    super.update(this.filteredValue(value));\n  }\n\n  public valueFromQuery(query:QueryResource):WorkPackageViewHighlight {\n    const highlight = { mode: query.highlightingMode || 'inline', selectedAttributes: query.highlightedAttributes };\n    return this.filteredValue(highlight);\n  }\n\n  public hasChanged(query:QueryResource) {\n    return query.highlightingMode !== this.current.mode ||\n      !_.isEqual(query.highlightedAttributes, this.current.selectedAttributes);\n  }\n\n  public applyToQuery(query:QueryResource):boolean {\n    const current = this.current;\n    query.highlightingMode = current.mode;\n\n    query.highlightedAttributes = current.selectedAttributes;\n\n    return false;\n  }\n\n  private filteredValue(value:WorkPackageViewHighlight):WorkPackageViewHighlight {\n    if (_.isEmpty(value.selectedAttributes)) {\n      value.selectedAttributes = undefined;\n    }\n\n    this.Banners.conditional(() => {\n      value.mode = 'none';\n      value.selectedAttributes = undefined;\n    });\n\n    return value;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {StateService, TransitionService} from '@uirouter/core';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, OnDestroy, OnInit} from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {Observable} from \"rxjs\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'wp-create-button',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './wp-create-button.html'\n})\nexport class WorkPackageCreateButtonComponent extends UntilDestroyedMixin implements OnInit, OnDestroy {\n  @Input('allowed') allowedWhen:string[];\n  @Input('stateName$') stateName$:Observable<string>;\n\n  allowed:boolean;\n  disabled:boolean\n  projectIdentifier:string|null;\n  types:any;\n  transitionUnregisterFn:Function;\n\n  text = {\n    createWithDropdown: this.I18n.t('js.work_packages.create.button'),\n    createButton: this.I18n.t('js.label_work_package'),\n    explanation: this.I18n.t('js.label_create_work_package')\n  };\n\n  constructor(readonly $state:StateService,\n              readonly currentProject:CurrentProjectService,\n              readonly authorisationService:AuthorisationService,\n              readonly transition:TransitionService,\n              readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef) {\n    super();\n  }\n\n  ngOnInit() {\n    this.projectIdentifier = this.currentProject.identifier;\n\n    // Find the first permission that is allowed\n    this.authorisationService\n      .observeUntil(componentDestroyed(this))\n      .subscribe(() => {\n        this.allowed = !!this\n          .allowedWhen\n          .find(combined => {\n            let [module, permission] = combined.split('.');\n            return this.authorisationService.can(module, permission);\n          });\n\n        this.updateDisabledState();\n      });\n\n\n    this.transitionUnregisterFn = this.transition.onSuccess({}, this.updateDisabledState.bind(this));\n  }\n\n  ngOnDestroy():void {\n    super.ngOnDestroy();\n    this.transitionUnregisterFn();\n  }\n\n  private updateDisabledState() {\n    this.disabled = !this.allowed || this.$state.includes('**.new');\n    this.cdRef.detectChanges();\n  }\n}\n","<div class=\"wp-create-button\">\n  <button class=\"button -alt-highlight add-work-package\"\n          [disabled]=\"disabled\"\n          [attr.aria-label]=\"text.explanation\"\n          opTypesCreateDropdown\n          [projectIdentifier]=\"projectIdentifier\"\n          [stateName]=\"stateName$ | async\"\n          [dropdownActive]=\"allowed\">\n    <op-icon icon-classes=\"button--icon icon-add\"></op-icon>\n    <span class=\"button--text\"\n          [textContent]=\"text.createWithDropdown\"\n          aria-hidden=\"true\"></span>\n    <op-icon icon-classes=\"button--icon icon-small icon-pulldown hidden-for-mobile\"></op-icon>\n  </button>\n</div>\n","import {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {ElementRef, Injector, OnInit} from \"@angular/core\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {Subject} from \"rxjs\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\n\nexport abstract class WorkPackageCommentFieldHandler extends EditFieldHandler implements OnInit {\n  public fieldName = 'comment';\n  public handler = this;\n  public active = false;\n  public inEditMode = false;\n  public inFlight = false;\n\n  public change:WorkPackageChangeset;\n\n  // Destroy events\n  public onDestroy = new Subject<void>();\n\n  constructor(protected elementRef:ElementRef,\n              protected injector:Injector) {\n    super();\n  }\n\n  public ngOnInit() {\n    this.change = new WorkPackageChangeset(this.workPackage);\n  }\n\n  /**\n   * Handle saving the comment\n   */\n  public abstract handleUserSubmit():Promise<any>;\n\n  /**\n   * Required HTML id for the edit field\n   */\n  public abstract get htmlId():string;\n\n  public abstract get workPackage():WorkPackageResource;\n\n  public reset(withText:string = '') {\n    if (withText.length > 0) {\n      withText += '\\n';\n    }\n\n    this.change.setValue('comment' , { raw: withText });\n  }\n\n  public get schema():IFieldSchema {\n    return {\n      name: I18n.t('js.label_comment'),\n      writable: true,\n      required: false,\n      type: '_comment',\n      hasDefault: false\n    };\n  }\n\n  public get rawComment() {\n    return _.get(this.commentValue, 'raw', '');\n  }\n\n  public get commentValue() {\n    return this.change.value('comment');\n  }\n\n  public handleUserCancel() {\n    this.deactivate(true);\n  }\n\n  public activate(withText?:string) {\n    this.active = true;\n    this.reset(withText);\n  }\n\n  deactivate(focus:boolean):void {\n    this.active = false;\n    this.onDestroy.next();\n    this.onDestroy.complete();\n  }\n\n  focus():void {\n    const trigger = this.elementRef.nativeElement.querySelector('.inplace-editing--trigger-container');\n    trigger && trigger.focus();\n  }\n\n  onFocusOut():void {\n  }\n\n  handleUserKeydown(event:JQuery.TriggeredEvent, onlyCancel?:boolean):void {\n  }\n\n  isChanged():boolean {\n    return false;\n  }\n\n  stopPropagation(evt:JQuery.TriggeredEvent):boolean {\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {EditFormComponent} from \"core-app/modules/fields/edit/edit-form/edit-form.component\";\n\n@Component({\n  templateUrl: './wp-edit-actions-bar.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-edit-actions-bar',\n})\nexport class WorkPackageEditActionsBarComponent {\n  @Output('onSave') public onSave = new EventEmitter<void>();\n  @Output('onCancel') public onCancel = new EventEmitter<void>();\n  public _saving:boolean = false;\n\n  public text = {\n    save: this.I18n.t('js.button_save'),\n    cancel: this.I18n.t('js.button_cancel')\n  };\n\n  constructor(private I18n:I18nService,\n              private editForm:EditFormComponent,\n              private cdRef:ChangeDetectorRef) {\n  }\n\n  public set saving(active:boolean) {\n    this._saving = active;\n    this.cdRef.detectChanges();\n  }\n\n  public get saving() {\n    return this._saving;\n  }\n\n  public save():void {\n    if (this.saving) {\n      return;\n    }\n\n    this.saving = true;\n    this.editForm\n      .submit()\n      .then(() => {\n        this.saving = false;\n        this.onSave.emit();\n      })\n      .catch(() => {\n        this.saving = false;\n      });\n  }\n\n  public cancel():void {\n    this.editForm.cancel();\n    this.onCancel.emit();\n  }\n}\n","<div class=\"work-packages--edit-actions\">\n  <button\n      id=\"work-packages--edit-actions-save\"\n      class=\"button -highlight\"\n      accesskey=\"3\"\n      [disabled]=\"saving\"\n      (click)=\"save()\">\n    <op-icon icon-classes=\"button--icon icon-checkmark\"></op-icon>\n    <span class=\"button--text\" [textContent]=\"text.save\"></span>\n  </button>\n  <button\n      id=\"work-packages--edit-actions-cancel\"\n      class=\"button\"\n      accesskey=\"7\"\n      (click)=\"cancel()\">\n    <op-icon icon-classes=\"button--icon icon-close\"></op-icon>\n    <span class=\"button--text\" [textContent]=\"text.cancel\"></span>\n  </button>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\n\n@Component({\n  templateUrl: './authoring.html',\n  styleUrls: ['./authoring.sass'],\n  selector: 'authoring',\n})\nexport class AuthoringComponent implements OnInit {\n  // scope: { createdOn: '=', author: '=', showAuthorAsLink: '=', project: '=', activity: '=' },\n  @Input('createdOn') createdOn:string;\n  @Input('author') author:HalResource;\n  @Input('showAuthorAsLink') showAuthorAsLink:boolean;\n  @Input('project') project:any;\n  @Input('activity') activity:any;\n\n  public createdOnTime:any;\n  public timeago:any;\n  public time:any;\n  public userLink:string;\n\n  public constructor(readonly PathHelper:PathHelperService,\n                     readonly I18n:I18nService,\n                     readonly timezoneService:TimezoneService) {\n\n  }\n\n  ngOnInit() {\n    this.createdOnTime = this.timezoneService.parseDatetime(this.createdOn);\n    this.timeago = this.createdOnTime.fromNow();\n    this.time = this.createdOnTime.format('LLL');\n    this.userLink = this.PathHelper.userPath(this.author.idFromLink);\n  }\n\n  public activityFromPath(from:any) {\n    var path = this.PathHelper.projectActivityPath(this.project);\n\n    if (from) {\n      path += '?from=' + from;\n    }\n\n    return path;\n  }\n}\n","<div class=\"authoring-entry\">\n  <span *ngIf=\"showAuthorAsLink\" [textContent]=\"author.name\"></span>\n  <a *ngIf=\"!showAuthorAsLink\"\n     [attr.href]=\"userLink\"\n     [textContent]=\"author.name\"></a>\n\n  <span class=\"timestamp\" *ngIf=\"activity\">\n    <a [attr.title]=\"time\"\n       [attr.href]=\"activityFromPath(createdOnTime.format('YYYY-MM-DD'))\"\n       [textContent]=\"timeago\"></a>\n  </span>\n  <span *ngIf=\"!activity\"\n        class=\"timestamp\"\n        [textContent]=\"timeago\"\n        [attr.title]=\"time\">\n  </span>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Input} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\n\n@Component({\n  templateUrl: './wp-breadcrumb.html',\n  styleUrls: ['./wp-breadcrumb.sass'],\n  selector: 'wp-breadcrumb',\n})\nexport class WorkPackageBreadcrumbComponent {\n  @Input('workPackage') workPackage:WorkPackageResource;\n\n  public text = {\n    parent: this.I18n.t('js.relations_hierarchy.parent_headline'),\n    hierarchy: this.I18n.t('js.relations_hierarchy.hierarchy_headline'),\n  };\n\n  constructor(private I18n:I18nService) {\n  }\n\n  public inputActive:boolean = false;\n\n  public get hierarchyCount() {\n    return this.workPackage.ancestors.length;\n  }\n\n  public get hierarchyLabel() {\n    return (this.hierarchyCount === 1) ? this.text.parent : this.text.hierarchy;\n  }\n\n  public updateActiveInput(val:boolean) {\n    this.inputActive = val;\n  }\n}\n\n\n","<div class=\"wp-breadcrumb -show\"\n     *ngIf=\"workPackage\">\n  <ul class=\"breadcrumb\">\n    <ng-container *ngIf=\"!inputActive && hierarchyCount > 0\">\n      <li>\n        <span>{{ hierarchyLabel }}: </span>\n      </li>\n      <ng-container *ngFor=\"let ancestor of workPackage.ancestors; let first = first ; let last = last\">\n        <li\n            *ngIf=\"!last\"\n            class=\"wp-breadcrumb--ellipsed\"\n            [ngClass]=\"{ 'icon4 icon-small icon-arrow-right5': !first }\">\n          <a [attr.title]=\"ancestor.name\"\n             [textContent]=\"ancestor.name\"\n             uiSref=\"work-packages.show.activity\"\n             [uiParams]=\"{workPackageId: ancestor.id}\"\n             class=\"breadcrumb-project-title nocut\"></a>\n        </li>\n      </ng-container>\n    </ng-container>\n    <li\n        [ngClass]=\"{ 'active-parent-select': inputActive, 'icon4 icon-small icon-arrow-right5': !inputActive && hierarchyCount > 1 }\">\n      <wp-breadcrumb-parent (onSwitch)=\"updateActiveInput($event)\" [workPackage]=\"workPackage\"></wp-breadcrumb-parent>\n    </li>\n  </ul>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {Component, ElementRef, Input, ViewChild} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {OnInit} from '@angular/core';\nimport {UploadFile} from \"core-components/api/op-file-upload/op-file-upload.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\n\n@Component({\n  selector: 'attachments-upload',\n  templateUrl: './attachments-upload.html'\n})\nexport class AttachmentsUploadComponent implements OnInit {\n  @Input() public resource:HalResource;\n\n  @ViewChild('hiddenFileInput') public filePicker:ElementRef;\n\n  public draggingOver:boolean = false;\n  public text:any;\n  public maxFileSize:number;\n  public $element:JQuery;\n\n  constructor(readonly I18n:I18nService,\n              readonly ConfigurationService:ConfigurationService,\n              readonly notificationsService:NotificationsService,\n              protected elementRef:ElementRef,\n              protected halResourceService:HalResourceService) {\n    this.text = {\n      uploadLabel: I18n.t('js.label_add_attachments'),\n      dropFiles: I18n.t('js.label_drop_files'),\n      dropFilesHint: I18n.t('js.label_drop_files_hint'),\n      foldersWarning: I18n.t('js.label_drop_folders_hint')\n    };\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.ConfigurationService.initialized.then(() =>\n      this.maxFileSize = this.ConfigurationService.maximumAttachmentFileSize\n    );\n  }\n\n  public triggerFileInput(event:MouseEvent) {\n    this.filePicker.nativeElement.click();\n\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  }\n\n  public onDropFiles(event:DragEvent) {\n    event.dataTransfer!.dropEffect = 'copy';\n    event.preventDefault();\n    event.stopPropagation();\n\n    let dfFiles = event.dataTransfer!.files;\n    let length:number = dfFiles ? dfFiles.length : 0;\n\n    let files:UploadFile[] = [];\n    for (let i = 0; i < length; i++) {\n      files.push(dfFiles[i]);\n    }\n\n    this.uploadFiles(files);\n    this.draggingOver = false;\n  }\n\n  public onDragOver(event:DragEvent)  {\n    if (this.containsFiles(event.dataTransfer)) {\n      event.dataTransfer!.dropEffect = 'copy';\n      this.draggingOver = true;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  public onDragLeave(event:DragEvent)  {\n    this.draggingOver = false;\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  public onFilePickerChanged() {\n    const files:UploadFile[] = Array.from(this.filePicker.nativeElement.files);\n    this.uploadFiles(files);\n  }\n\n  private containsFiles(dataTransfer:any) {\n    if (dataTransfer.types.contains) {\n      return dataTransfer.types.contains('Files');\n    } else {\n      return (dataTransfer as DataTransfer).types.indexOf('Files') >= 0;\n    }\n  }\n\n  protected uploadFiles(files:UploadFile[]):void {\n    files = files || [];\n    const countBefore = files.length;\n    files = this.filterFolders(files);\n\n    if (files.length === 0) {\n\n      // If we filtered all files as directories, show a notice\n      if (countBefore > 0) {\n        this.notificationsService.addNotice(this.text.foldersWarning);\n      }\n\n      return;\n    }\n\n    this.resource.uploadAttachments(files);\n  }\n\n  /**\n   * We try to detect folders by checking for either empty types\n   * or empty file sizes.\n   * @param files\n   */\n  protected filterFolders(files:UploadFile[]) {\n    return files.filter((file) => {\n\n      // Folders never have a mime type\n      if (file.type !== '') {\n        return true;\n      }\n\n      // Files however MAY have no mime type as well\n      // so fall back to checking zero or 4096 bytes\n      if (file.size === 0 || file.size === 4096) {\n        console.warn(`Skipping file because of file size (${file.size}) %O`, file);\n        return false;\n      }\n\n      return true;\n    });\n  }\n}\n","<div\n  *ngIf=\"resource.canAddAttachments\"\n  class=\"wp-attachment-upload hide-when-print\"\n  (drop)=\"onDropFiles($event)\"\n  (dragover)=\"onDragOver($event)\"\n  (dragleave)=\"onDragLeave($event)\"\n  [attr.aria-label]=\"text.uploadLabel\">\n  <input #hiddenFileInput\n         type=\"file\"\n         id=\"attachment_files\"\n         name=\"attachment_files\"\n         (change)=\"onFilePickerChanged()\"\n         hidden\n         multiple />\n  <div class=\"work-package--attachments--drop-box\"\n       tabindex=\"0\"\n       (accessibleClick)=\"triggerFileInput($event)\"\n       [ngClass]=\"{ '-dragging': draggingOver }\">\n    <div class=\"work-package--attachments--label\">\n      <op-icon icon-classes=\"icon-attachment\"></op-icon>\n      <label for=\"attachment_files\">\n        {{ text.dropFiles }} <br>\n        {{ text.dropFilesHint }}\n      </label>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Input, Output, EventEmitter} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\n@Component({\n  selector: 'edit-field-controls',\n  templateUrl: './edit-field-controls.component.html'\n})\nexport class EditFieldControlsComponent {\n  @Input() public cancelTitle:string;\n  @Input() public saveTitle:string;\n  @Input('fieldController') public field:EditFieldComponent;\n  @Output() public onSave = new EventEmitter<void>();\n  @Output() public onCancel = new EventEmitter<void>();\n\n  public save() {\n    this.onSave.emit();\n  }\n\n  public cancel() {\n    this.onCancel.emit();\n  }\n}\n","<div class=\"inplace-edit--dashboard\">\n  <div class=\"inplace-edit--controls\" *ngIf=\"field.handler.active\">\n    <accessible-by-keyboard (execute)=\"save()\"\n                            [attr.disabled]=\"(field.required && field.isEmpty()) || undefined\"\n                            [linkTitle]=\"saveTitle\"\n                            class=\"inplace-edit--control inplace-edit--control--save\">\n      <op-icon icon-classes=\"icon-checkmark\" [icon-title]=\"saveTitle\"></op-icon>\n    </accessible-by-keyboard>\n    <accessible-by-keyboard (execute)=\"cancel()\"\n                            [linkTitle]=\"cancelTitle\"\n                            class=\"inplace-edit--control inplace-edit--control--cancel\">\n      <op-icon icon-classes=\"icon-close\" [icon-title]=\"cancelTitle\"></op-icon>\n    </accessible-by-keyboard>\n</div>\n</div>\n","import {SimpleResource, SimpleResourceCollection} from \"core-app/modules/common/path-helper/apiv3/path-resources\";\nimport {Injector} from \"@angular/core\";\nimport {Constructor} from \"@angular/cdk/table\";\n\nexport class BcfResourcePath extends SimpleResource {\n  constructor(readonly injector:Injector,\n              basePath:string,\n              id:string|number) {\n    super(basePath, id);\n  }\n}\n\nexport class BcfResourceCollectionPath<T extends BcfResourcePath> extends SimpleResourceCollection<T> {\n  constructor(readonly injector:Injector,\n              protected basePath:string,\n              segment:string,\n              protected resource?:Constructor<T>) {\n    super(basePath, segment, resource);\n  }\n\n  public id(id:string|number):T {\n    return new (this.resource || BcfResourcePath)(this.injector, this.path, id) as T;\n  }\n\n}","import {HttpClient, HttpErrorResponse, HttpParams} from \"@angular/common/http\";\nimport {Injector} from \"@angular/core\";\nimport {TypedJSON} from \"typedjson\";\nimport {Constructor} from \"@angular/cdk/table\";\nimport {Observable} from \"rxjs\";\nimport {\n  HTTPClientHeaders,\n  HTTPClientOptions,\n  HTTPClientParamMap,\n  HTTPSupportedMethods\n} from \"core-app/modules/hal/http/http.interfaces\";\nimport {URLParamsEncoder} from \"core-app/modules/hal/services/url-params-encoder\";\nimport {catchError, map} from \"rxjs/operators\";\nimport {throwError} from \"rxjs/internal/observable/throwError\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class BcfApiRequestService<T> {\n  @InjectField() http:HttpClient;\n\n  /**\n   * Create a BCF api request service.\n   * Optionally pass a resource map to map the resulting data to with TypedJson.\n   *\n   * @param injector Injector\n   * @param resourceClass Optional mapped resource class with TypedJson annotations\n   */\n  constructor(readonly injector:Injector,\n              readonly resourceClass?:Constructor<T>) {\n  }\n\n  /**\n   * Request GET from the given BCF API 2.1 resource and map it to +resourceClass+.\n   *\n   * @param path API path to request\n   * @param params Request query params\n   * @param headers optional headers map\n   */\n  get(path:string, params:HTTPClientParamMap, headers:HTTPClientHeaders = {}):Observable<T> {\n    const config:HTTPClientOptions = {\n      headers: headers,\n      params: new HttpParams({ encoder: new URLParamsEncoder(), fromObject: params }),\n      withCredentials: true,\n      responseType: 'json'\n    };\n\n    return this._request('get', path, config);\n  }\n\n  /**\n   * Request the given BCF API 2.1 resource and map it to +resourceClass+.\n   *\n   * @param method request method\n   * @param path API path to request\n   * @param data Request payload (URL params for get, JSON payload otherwise)\n   * @param data Request payload (URL params for get, JSON payload otherwise)\n   */\n  public request(method:HTTPSupportedMethods, path:string, data:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}):Observable<T> {\n\n    // HttpClient requires us to create HttpParams instead of passing data for get\n    // so forward to that method instead.\n    if (method === 'get') {\n      return this.get(path, data, headers);\n    }\n\n    const config:HTTPClientOptions = {\n      body: data || {},\n      headers: headers,\n      withCredentials: true,\n      responseType: 'json'\n    };\n\n    return this._request(method, path, config);\n  }\n\n  /**\n   * Perform the request with httpClient and deserialize the result\n   *\n   * @param method Request method\n   * @param path Request path\n   * @param config HTTP client configuration\n   *\n   * @private\n   */\n  private _request(method:HTTPSupportedMethods, path:string, config:HTTPClientOptions):Observable<T> {\n    return this\n      .http\n      .request<T>(method, path, config)\n      .pipe(\n        map((response:any) => this.deserialize(response)),\n        catchError((error:HttpErrorResponse) => {\n          console.error(`Failed to ${method} ${path}: ${error.name}`);\n          return throwError(error);\n        })\n      );\n  }\n\n  /**\n   * Deserialize the JSON data into the mapped resource class, if given.\n   * @param data JSON API response.\n   */\n  protected deserialize(data:any):T {\n    if (this.resourceClass) {\n      const serializer = new TypedJSON(this.resourceClass);\n      return serializer.parse(data)!;\n    } else {\n      return data;\n    }\n  }\n}","import {jsonMember, jsonObject} from \"typedjson\";\n\n@jsonObject\nexport class BcfProjectResource {\n\n  @jsonMember\n  project_id:number;\n\n  @jsonMember\n  name:string;\n}\n","import {jsonArrayMember, jsonMember, jsonObject} from \"typedjson\";\nimport * as moment from \"moment\";\nimport {Moment} from \"moment\";\n\n@jsonObject\nexport class BcfTopicAuthorizationMap {\n  @jsonArrayMember(String)\n  topic_actions:string[];\n\n  @jsonArrayMember(String)\n  topic_status:string[];\n}\n\n@jsonObject\nexport class BcfTopicResource {\n\n  @jsonMember\n  guid:string;\n\n  @jsonMember\n  topic_type:string;\n\n  @jsonMember\n  topic_status:string;\n\n  @jsonMember\n  priority:string;\n\n  @jsonArrayMember(String)\n  reference_links:string[];\n\n  @jsonMember\n  title:string;\n\n  @jsonMember({ preserveNull: true })\n  index:number|null;\n\n  @jsonArrayMember(String)\n  labels:string[];\n\n  @jsonMember({ deserializer: value => moment(value), serializer: (timestamp:Moment) => timestamp.toISOString() })\n  creation_date:Moment;\n\n  @jsonMember\n  creation_author:string;\n\n  @jsonMember({ deserializer: value => moment(value), serializer: (timestamp:Moment) => timestamp.toISOString() })\n  modified_date:Moment;\n\n  @jsonMember({ preserveNull: true })\n  modified_author:string|null;\n\n  @jsonMember\n  assigned_to:string;\n\n  @jsonMember({ preserveNull: true })\n  stage:string|null;\n\n  @jsonMember\n  description:string;\n\n  @jsonMember({\n    deserializer: value => moment(value),\n    serializer: (timestamp:Moment) => timestamp.format('YYYY-MM-DD')\n  })\n  due_date:Moment;\n\n  @jsonMember\n  authorization:BcfTopicAuthorizationMap;\n}\n","import {HTTPClientHeaders, HTTPClientParamMap} from \"core-app/modules/hal/http/http.interfaces\";\nimport {BcfResourcePath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfApiRequestService} from \"core-app/modules/bim/bcf/api/bcf-api-request.service\";\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\n\nexport class BcfViewpointPaths extends BcfResourcePath {\n  readonly bcfTopicService = new BcfApiRequestService<BcfViewpointInterface>(this.injector);\n\n  get(params:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}) {\n    return this.bcfTopicService.get(this.toPath(), params, headers);\n  }\n\n  delete(headers:HTTPClientHeaders = {}) {\n    return this.bcfTopicService.request('delete', this.toPath(), {}, headers);\n  }\n}","import {BcfResourceCollectionPath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfApiRequestService} from \"core-app/modules/bim/bcf/api/bcf-api-request.service\";\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\nimport {HTTPClientHeaders, HTTPClientParamMap} from \"core-app/modules/hal/http/http.interfaces\";\nimport {Observable} from \"rxjs\";\nimport {BcfViewpointPaths} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.paths\";\n\nexport class BcfViewpointCollectionPath extends BcfResourceCollectionPath<BcfViewpointPaths> {\n  readonly bcfTopicService = new BcfApiRequestService<BcfViewpointInterface>(this.injector);\n\n  get(params:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}) {\n    throw new Error(\"Not implemented\");\n  }\n\n  post(viewpoint:BcfViewpointInterface):Observable<BcfViewpointInterface> {\n    return this\n      .bcfTopicService\n      .request(\n        'post',\n        this.toPath(),\n        viewpoint\n      );\n  }\n}","import {HTTPClientHeaders, HTTPClientParamMap} from \"core-app/modules/hal/http/http.interfaces\";\nimport {BcfResourceCollectionPath, BcfResourcePath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfTopicResource} from \"core-app/modules/bim/bcf/api/topics/bcf-topic.resource\";\nimport {BcfApiRequestService} from \"core-app/modules/bim/bcf/api/bcf-api-request.service\";\nimport {BcfViewpointPaths} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.paths\";\nimport {BcfViewpointCollectionPath} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint-collection.paths\";\n\nexport class BcfTopicPaths extends BcfResourcePath {\n  readonly bcfTopicService = new BcfApiRequestService(this.injector, BcfTopicResource);\n\n  /** /comments */\n  public readonly comments = new BcfResourceCollectionPath(this.injector, this.path, 'comments');\n\n  /** /viewpoints */\n  public readonly viewpoints = new BcfViewpointCollectionPath(this.injector, this.path, 'viewpoints', BcfViewpointPaths);\n\n  get(params:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}) {\n    return this.bcfTopicService.get(this.toPath(), params, headers);\n  }\n}","import {BcfResourceCollectionPath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfApiRequestService} from \"core-app/modules/bim/bcf/api/bcf-api-request.service\";\nimport {HTTPClientHeaders, HTTPClientParamMap} from \"core-app/modules/hal/http/http.interfaces\";\nimport {Observable} from \"rxjs\";\nimport {BcfTopicPaths} from \"core-app/modules/bim/bcf/api/topics/bcf-topic.paths\";\nimport {Injector} from \"@angular/core\";\nimport {BcfTopicResource} from \"core-app/modules/bim/bcf/api/topics/bcf-topic.resource\";\n\nexport class BcfTopicCollectionPath extends BcfResourceCollectionPath<BcfTopicPaths> {\n  readonly bcfTopicService = new BcfApiRequestService<BcfTopicResource>(this.injector, BcfTopicResource);\n\n  constructor(readonly injector:Injector,\n              protected basePath:string,\n              segment:string) {\n    super(injector, basePath, segment, BcfTopicPaths);\n  }\n\n  get(params:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}) {\n    throw new Error(\"Not implemented\");\n  }\n\n  /**\n   * Create a topic from its to-be-associated work package\n   */\n  post(payload:any):Observable<BcfTopicResource> {\n    return this\n      .bcfTopicService\n      .request(\n        'post',\n        this.toPath(),\n        payload\n      );\n  }\n}","import {jsonArrayMember, jsonObject} from \"typedjson\";\n\n@jsonObject\nexport class BcfExtensionResource {\n\n  @jsonArrayMember(String)\n  topic_actions:string[];\n\n  @jsonArrayMember(String)\n  project_actions:string[];\n\n  @jsonArrayMember(String)\n  comment_actions:string[];\n}\n","import {BcfResourcePath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfApiRequestService} from \"core-app/modules/bim/bcf/api/bcf-api-request.service\";\nimport {HTTPClientHeaders, HTTPClientParamMap} from \"core-app/modules/hal/http/http.interfaces\";\nimport {BcfExtensionResource} from \"core-app/modules/bim/bcf/api/extensions/bcf-extension.resource\";\n\nexport class BcfExtensionPaths extends BcfResourcePath {\n  readonly bcfExtensionService = new BcfApiRequestService(this.injector, BcfExtensionResource);\n\n  get(params:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}) {\n    return this.bcfExtensionService.get(this.toPath(), params, headers);\n  }\n}\n","import {BcfResourcePath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfApiRequestService} from \"core-app/modules/bim/bcf/api/bcf-api-request.service\";\nimport {BcfProjectResource} from \"core-app/modules/bim/bcf/api/projects/bcf-project.resource\";\nimport {HTTPClientHeaders, HTTPClientParamMap} from \"core-app/modules/hal/http/http.interfaces\";\nimport {BcfTopicCollectionPath} from \"core-app/modules/bim/bcf/api/topics/bcf-viewpoint-collection.paths\";\nimport {BcfExtensionPaths} from \"core-app/modules/bim/bcf/api/extensions/bcf-extension.paths\";\n\nexport class BcfProjectPaths extends BcfResourcePath {\n  readonly bcfProjectService = new BcfApiRequestService(this.injector, BcfProjectResource);\n\n  /** /topics */\n  public readonly topics = new BcfTopicCollectionPath(this.injector, this.path, 'topics');\n\n  public readonly extensions = new BcfExtensionPaths(this.injector, this.path, 'extensions');\n\n  get(params:HTTPClientParamMap = {}, headers:HTTPClientHeaders = {}) {\n    return this.bcfProjectService.get(this.toPath(), params, headers);\n  }\n}","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from \"@angular/core\";\nimport {BcfResourceCollectionPath} from \"core-app/modules/bim/bcf/api/bcf-path-resources\";\nimport {BcfProjectPaths} from \"core-app/modules/bim/bcf/api/projects/bcf-project.paths\";\n\n\n@Injectable({ providedIn: 'root' })\nexport class BcfApiService {\n\n  public readonly bcfApiVersion = '2.1';\n  public readonly appBasePath = window.appBasePath || '';\n  public readonly bcfApiBase = `${this.appBasePath}/api/bcf/${this.bcfApiVersion}`;\n\n  // /api/bcf/:version/projects\n  public readonly projects = new BcfResourceCollectionPath(this.injector, this.bcfApiBase, 'projects', BcfProjectPaths);\n\n  constructor(readonly injector:Injector) {\n  }\n\n  /**\n   * Parse the given string into a BCF resource path\n   *\n   * @param href\n   */\n  parse<T>(href:string):T {\n    if (!href.startsWith(this.bcfApiBase)) {\n      throw new Error(`Cannot parse ${href} into BCF resource.`);\n    }\n\n    const parts = href\n      .replace(this.bcfApiBase + '/', '')\n      .split('/');\n\n    // Try to find a target collection or resource\n    let current:any = this;\n\n    for (let i = 0; i < parts.length; i++) {\n      let pathOrId:string = parts[i];\n      if (pathOrId in current) {\n        // Current has a member named like this URL part\n        // descend into it\n        current = current[pathOrId];\n      } else if (current instanceof BcfResourceCollectionPath) {\n        // Otherwise, assume we're looking for an ID\n        current = current.id(pathOrId);\n      } else {\n        // Otherwise, return the current\n        break;\n      }\n    }\n\n    return current === this ? undefined : current;\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {ColorsService} from \"core-app/modules/common/colors/colors.service\";\n\nexport interface UserLike {\n  name:string;\n  id:string|number|null;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class UserAvatarRendererService {\n\n  constructor(private pathHelper:PathHelperService,\n              private colors:ColorsService) {\n\n  }\n\n  renderMultiple(container:HTMLElement,\n                 users:UserLike[],\n                 renderName:boolean = true,\n                 multiLine:boolean = false) {\n\n    const span = document.createElement('span');\n\n\n    for (let i = 0; i < users.length; i++) {\n      const avatar = document.createElement('span');\n      if (multiLine) {\n        avatar.classList.add('user-avatar--multi-line');\n      }\n\n      this.render(avatar, users[i], renderName);\n\n      if (!multiLine && i < users.length - 1) {\n        const sep = document.createElement('span');\n        sep.textContent = ', ';\n        avatar.appendChild(sep);\n      }\n\n      span.appendChild(avatar);\n    }\n\n    container.appendChild(span);\n  }\n\n  render(container:HTMLElement,\n         user:UserLike,\n         renderName:boolean = true,\n         classes:string = 'avatar-medium'):void {\n    const userInitials = this.getInitials(user.name);\n    const colorCode = this.colors.toHsl(user.name);\n\n    let fallback = document.createElement('div');\n    fallback.className = classes;\n    fallback.classList.add('avatar-default');\n    fallback.textContent = userInitials;\n    fallback.style.background = colorCode;\n\n    container.appendChild(fallback);\n\n    if (renderName) {\n      const name = document.createElement('span');\n      name.textContent = user.name;\n      container.appendChild(name);\n    }\n\n    // Avoid using the image when ID is null\n    if (!user.id) {\n      return;\n    }\n\n    const image = new Image();\n    image.className = classes;\n    image.classList.add('avatar--fallback');\n    image.src = this.pathHelper.api.v3.users.id(user.id).avatar.toString();\n    image.title = user.name;\n    image.alt = user.name;\n    image.onload = function () {\n      fallback.replaceWith(image);\n      (fallback as any) = undefined;\n    };\n  }\n\n  private getInitials(name:string) {\n    let characters = [...name];\n    let lastSpace = name.lastIndexOf(' ');\n    let first = characters[0]?.toUpperCase();\n    let last = name[lastSpace + 1]?.toUpperCase();\n\n    return [first, last].join(\"\");\n  }\n}","import {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport namespace AngularTrackingHelpers {\n  export function halHref<T extends HalResource>(_index:number, item:T):string|null {\n    return item.$href;\n  }\n\n  export function compareByName<T extends HalResource>(a:T|undefined|null, b:T|undefined|null):boolean {\n    return compareByAttribute('name')(a, b);\n  }\n\n  export function compareByAttribute(attribute:string) {\n    return (a:any, b:any) => {\n      const bothNil = !a && !b;\n      return bothNil || (!!a && !!b && a[attribute] === b[attribute]);\n    };\n  }\n\n  export function trackByName(i:number, item:any) {\n    return _.get(item, 'name');\n  }\n\n  export function trackByHref(i:number, item:HalResource) {\n    return _.get(item, 'href');\n  }\n\n  export function trackByProperty(prop:string) {\n    return (i:number, item:HalResource) => _.get(item, prop);\n  }\n\n  export function trackByHrefAndProperty(propertyName:string) {\n    return (i:number, item:HalResource) => {\n      let href = _.get(item, 'href');\n      let prop = _.get(item, propertyName, 'none');\n\n      return `${href}#${propertyName}=${prop}`;\n    };\n  }\n\n  export function trackByTrackingIdentifier(i:number, item:any) {\n    return _.get(item, 'trackingIdentifier', item && item.href);\n  }\n\n  export function compareByHref<T extends HalResource>(a:T|undefined|null, b:T|undefined|null):boolean {\n    const bothNil = !a && !b;\n    return bothNil || (!!a && !!b && a.$href === b.$href);\n  }\n\n  export function compareByHrefOrString<T extends HalResource>(a:T|string|undefined|null, b:T|string|undefined|null):boolean {\n    if (a instanceof HalResource && b instanceof HalResource) {\n      return compareByHref(a as HalResource, b as HalResource);\n    }\n\n    const bothNil = !a && !b;\n    return bothNil || a === b;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {ActivityPanelBaseController} from 'core-components/wp-single-view-tabs/activity-panel/activity-base.controller';\nimport {Component, Input} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {ActivityEntryInfo} from 'core-components/wp-single-view-tabs/activity-panel/activity-entry-info';\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\n\n@Component({\n  selector: 'newest-activity-on-overview',\n  templateUrl: './activity-on-overview.html'\n})\nexport class NewestActivityOnOverviewComponent extends ActivityPanelBaseController {\n  @Input('workPackage') public workPackage:WorkPackageResource;\n\n  public latestActivityInfo:ActivityEntryInfo[] = [];\n  public trackByHref = AngularTrackingHelpers.trackByHref;\n\n  ngOnInit() {\n    this.workPackageId = this.workPackage.id!;\n    super.ngOnInit();\n  }\n\n  protected shouldShowToggler() {\n    return false;\n  }\n\n  protected updateActivities(activities:any) {\n    super.updateActivities(activities);\n    this.latestActivityInfo = this.latestActivities();\n  }\n\n  private latestActivities(visible:number = 3) {\n\n    if (this.reverse) {\n      // In reverse, we already get reversed entries from API.\n      // So simply take the first three\n      let segment = this.unfilteredActivities.slice(0, visible);\n      return segment.map((el:HalResource, i:number) => this.info(el, i));\n    } else {\n      // In ascending sort, take the last three items\n      let segment = this.unfilteredActivities.slice(-visible);\n      let startIndex = this.unfilteredActivities.length - segment.length;\n      return segment.map((el:HalResource, i:number) => this.info(el, startIndex + i));\n    }\n  }\n}\n","<work-package-comment [workPackage]=\"workPackage\">\n  <ng-template>\n    <div class='work-package-details-activities-list'>\n      <div *ngFor=\"let inf of latestActivityInfo; trackBy:trackByHref\"\n          class=\"work-package-details-activities-activity\">\n        <activity-entry [workPackage]=\"workPackage\"\n                        [activity]=\"inf.activity\"\n                        [activityNo]=\"inf.number(inf.isReversed)\"\n                        [isInitial]=\"inf.isInitial()\">\n        </activity-entry>\n      </div>\n    </div>\n  </ng-template>\n</work-package-comment>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {WorkPackageCopyController} from 'core-components/wp-copy/wp-copy.controller';\n\n@Component({\n  selector: 'wp-copy-split-view',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: '../wp-new/wp-new-split-view.html'\n})\nexport class WorkPackageCopySplitViewComponent extends WorkPackageCopyController {\n}\n\n","<div\n  class=\"work-packages--details work-packages--new\"\n  *ngIf=\"newWorkPackage\"\n>\n  <edit-form [resource]=\"newWorkPackage\"\n             [skippedFields]=\"['status', 'type']\"\n             [inEditMode]=\"true\"\n             (onSaved)=\"onSaved($event)\">\n  <div class=\"work-packages--details-content -create-mode\">\n      <div class=\"work-packages--new-details-header\">\n        <wp-type-status [workPackage]=\"newWorkPackage\"></wp-type-status>\n        <div class=\"wp--details--switch-fullscreen-wrapper\">\n          <a (click)=\"switchToFullscreen()\"\n             class=\"work-packages-show-view-button wp--details--switch-fullscreen \">\n            <span class=\"icon-context icon-to-fullscreen\"></span>\n          </a>\n        </div>\n      </div>\n      <wp-single-view [workPackage]=\"newWorkPackage\"\n                      [showProject]=\"copying\">\n      </wp-single-view>\n    </div>\n\n    <div class=\"work-packages--details-toolbar-container\">\n      <wp-edit-actions-bar\n        (onCancel)=\"cancelAndBackToList()\">\n      </wp-edit-actions-bar>\n    </div>\n\n    <div class=\"work-packages--details--resizer hidden-for-mobile hide-when-print\">\n      <wp-resizer [elementClass]=\"'work-packages-partitioned-page--content-right'\"\n                  [localStorageKey]=\"'openProject-splitViewFlexBasis'\"></wp-resizer>\n    </div>\n  </edit-form>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {WorkPackageRelationsHierarchyService} from 'core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service';\nimport {take} from 'rxjs/operators';\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'wp-relations-hierarchy',\n  templateUrl: './wp-relations-hierarchy.template.html'\n})\nexport class WorkPackageRelationsHierarchyComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public relationType:string;\n\n  public showEditForm:boolean = false;\n  public workPackagePath:string;\n  public canHaveChildren:boolean;\n  public canModifyHierarchy:boolean;\n  public canAddRelation:boolean;\n\n  public childrenQueryProps:any;\n\n  constructor(protected wpRelationsHierarchyService:WorkPackageRelationsHierarchyService,\n              protected wpCacheService:WorkPackageCacheService,\n              protected PathHelper:PathHelperService,\n              readonly I18n:I18nService) {\n    super();\n  }\n\n  public text = {\n    parentHeadline: this.I18n.t('js.relations_hierarchy.parent_headline'),\n    childrenHeadline: this.I18n.t('js.relations_hierarchy.children_headline'),\n  };\n\n  ngOnInit() {\n    this.workPackagePath = this.PathHelper.workPackagePath(this.workPackage.id!);\n    this.canModifyHierarchy = !!this.workPackage.changeParent;\n    this.canAddRelation = !!this.workPackage.addRelation;\n\n    this.childrenQueryProps = {\n      filters: JSON.stringify([{ parent: { operator: '=', values: [this.workPackage.id] } }]),\n      'columns[]': ['id', 'type', 'subject', 'status'],\n      showHierarchies: false\n    };\n\n    this.wpCacheService.loadWorkPackage(this.workPackage.id!).values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.workPackage = wp;\n\n        let toLoad:string[] = [];\n        let parentId = this.workPackage.parent?.id?.toString();\n\n        if (parentId) {\n          toLoad.push(parentId.toString());\n\n          this.wpCacheService\n            .require(parentId)\n            .then((parent:WorkPackageResource) => {\n              this.workPackage.parent = parent;\n            });\n        }\n\n        this.wpCacheService.requireAll(toLoad);\n      });\n  }\n}\n","<div class=\"wp-relations-hierarchy-section wp-relations--children\">\n  <div class=\"attributes-group--header\">\n    <div class=\"attributes-group--header-container\">\n      <h3 class=\"attributes-group--header-text\"\n          [textContent]=\"text.childrenHeadline\">\n      </h3>\n    </div>\n  </div>\n  <ng-container wp-isolated-query-space>\n    <wp-children-query\n        [workPackage]=\"workPackage\"\n        [addExistingChildEnabled]=\"true\"\n        [query]=\"childrenQueryProps\">\n    </wp-children-query>\n  </ng-container>\n</div>\n","import {TimelineZoomLevel} from 'core-app/modules/hal/resources/query-resource';\n// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport * as moment from 'moment';\nimport {InputState, MultiInputState} from 'reactivestates';\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport Moment = moment.Moment;\n\nexport const timelineElementCssClass = 'timeline-element';\nexport const timelineBackgroundElementClass = 'timeline-element--bg';\nexport const timelineGridElementCssClass = 'wp-timeline--grid-element';\nexport const timelineMarkerSelectionStartClass = 'selection-start';\nexport const timelineHeaderCSSClass = 'wp-timeline--header-element';\nexport const timelineHeaderSelector = 'wp-timeline-header';\n\n/**\n *\n */\nexport class TimelineViewParametersSettings {\n\n  zoomLevel:TimelineZoomLevel = 'days';\n\n}\n\n// Can't properly map the enum to a string aray\nexport const zoomLevelOrder:TimelineZoomLevel[] = [\n  'days', 'weeks', 'months', 'quarters', 'years'\n];\n\nexport function getPixelPerDayForZoomLevel(zoomLevel:TimelineZoomLevel) {\n  switch (zoomLevel) {\n    case 'days':\n      return 30;\n    case 'weeks':\n      return 15;\n    case 'months':\n      return 6;\n    case 'quarters':\n      return 2;\n    case 'years':\n      return 0.5;\n  }\n  throw new Error('invalid zoom level: ' + zoomLevel);\n}\n\n/**\n * Number of pixels to display before the earliest workpackage in view\n */\nexport const requiredPixelMarginLeft = 120;\n\n/**\n *\n */\nexport class TimelineViewParameters {\n\n  readonly now:Moment = moment({hour: 0, minute: 0, seconds: 0});\n\n  dateDisplayStart:Moment = moment({hour: 0, minute: 0, seconds: 0});\n\n  dateDisplayEnd:Moment = this.dateDisplayStart.clone().add(1, 'day');\n\n  settings:TimelineViewParametersSettings = new TimelineViewParametersSettings();\n\n  activeSelectionMode:null | ((wp:WorkPackageResource) => any) = null;\n\n  selectionModeStart:null | string = null;\n\n  /**\n   * The visible viewport (at the time the view parameters were calculated last!!!)\n   */\n  visibleViewportAtCalculationTime:[Moment, Moment];\n\n  get pixelPerDay():number {\n    return getPixelPerDayForZoomLevel(this.settings.zoomLevel);\n  }\n\n  get maxWidthInPx() {\n    return this.maxSteps * this.pixelPerDay;\n  }\n\n  get maxSteps():number {\n    return this.dateDisplayEnd.diff(this.dateDisplayStart, 'days');\n  }\n\n  get dayCountForMarginLeft():number {\n    return Math.ceil(requiredPixelMarginLeft / this.pixelPerDay);\n  }\n\n}\n\n/**\n *\n */\nexport interface RenderInfo {\n  viewParams:TimelineViewParameters;\n  workPackage:WorkPackageResource;\n  change:WorkPackageChangeset;\n}\n\n/**\n *\n */\nexport function calculatePositionValueForDayCountingPx(viewParams:TimelineViewParameters, days:number):number {\n  const daysInPx = days * viewParams.pixelPerDay;\n  return daysInPx;\n}\n\n/**\n *\n */\nexport function calculatePositionValueForDayCount(viewParams:TimelineViewParameters, days:number):string {\n  const value = calculatePositionValueForDayCountingPx(viewParams, days);\n  return value + 'px';\n}\n\nexport function getTimeSlicesForHeader(vp:TimelineViewParameters,\n                                       unit:moment.unitOfTime.DurationConstructor,\n                                       startView:Moment,\n                                       endView:Moment) {\n\n  const inViewport:[Moment, Moment][] = [];\n  const rest:[Moment, Moment][] = [];\n\n  const time = startView.clone().startOf(unit);\n  const end = endView.clone().endOf(unit);\n\n  while (time.isBefore(end)) {\n    const sliceStart = moment.max(time, startView).clone();\n    const sliceEnd = moment.min(time.clone().endOf(unit), endView).clone();\n    time.add(1, unit);\n\n    const viewport = vp.visibleViewportAtCalculationTime;\n    if ((sliceStart.isSameOrAfter(viewport[0]) && sliceStart.isSameOrBefore(viewport[1]))\n      || (sliceEnd.isSameOrAfter(viewport[0]) && sliceEnd.isSameOrBefore(viewport[1]))) {\n\n      inViewport.push([sliceStart, sliceEnd]);\n    } else {\n      rest.push([sliceStart, sliceEnd]);\n    }\n  }\n\n  const firstRest:[Moment, Moment] = rest.splice(0, 1)[0];\n  const lastRest:[Moment, Moment] = rest.pop()!;\n  const inViewportAndBoundaries = _.concat(\n    [firstRest].filter(e => !_.isNil(e)),\n    inViewport,\n    [lastRest].filter(e => !_.isNil(e))\n  );\n\n  return {\n    inViewportAndBoundaries,\n    rest\n  };\n\n}\n\nexport function calculateDaySpan(visibleWorkPackages:RenderedWorkPackage[],\n                                 loadedWorkPackages:MultiInputState<WorkPackageResource>,\n                                 viewParameters:TimelineViewParameters):number {\n  let earliest:Moment = moment();\n  let latest:Moment = moment();\n\n  visibleWorkPackages.forEach((renderedRow) => {\n    const wpId = renderedRow.workPackageId;\n\n    if (!wpId) {\n      return;\n    }\n    const workPackageState:InputState<WorkPackageResource> = loadedWorkPackages.get(wpId);\n    const workPackage:WorkPackageResource|undefined = workPackageState.value;\n\n    if (!workPackage) {\n      return;\n    }\n\n    const start = workPackage.startDate ? workPackage.startDate : workPackage.date;\n    if (start && moment(start).isBefore(earliest)) {\n      earliest = moment(start);\n    }\n\n    const due = workPackage.dueDate ? workPackage.dueDate : workPackage.date;\n    if (due && moment(due).isAfter(latest)) {\n      latest = moment(due);\n    }\n  });\n\n  const daysSpan = latest.diff(earliest, 'days') + 1;\n  return daysSpan;\n}\n","import {ApplicationRef, ComponentFactoryResolver, Injectable, Injector} from '@angular/core';\nimport {ComponentPortal, DomPortalOutlet, PortalInjector} from \"@angular/cdk/portal\";\nimport {TransitionService} from \"@uirouter/core\";\nimport {OpContextMenuHandler} from \"core-components/op-context-menu/op-context-menu-handler\";\nimport {OpContextMenuLocalsMap, OpContextMenuLocalsToken} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {OPContextMenuComponent} from \"core-components/op-context-menu/op-context-menu.component\";\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {FocusHelperService} from 'core-app/modules/common/focus/focus-helper';\n\n@Injectable({ providedIn: 'root' })\nexport class OPContextMenuService {\n  public active:OpContextMenuHandler|null = null;\n\n  // Hold a reference to the DOM node we're using as a host\n  private portalHostElement:HTMLElement;\n  // And a reference to the actual portal host interface on top of the element\n  private bodyPortalHost:DomPortalOutlet;\n\n  // Allow temporarily disabling the close handler\n  private isOpening = false;\n\n  constructor(private componentFactoryResolver:ComponentFactoryResolver,\n              readonly FocusHelper:FocusHelperService,\n              private appRef:ApplicationRef,\n              private $transitions:TransitionService,\n              private injector:Injector) {\n\n    const hostElement = this.portalHostElement = document.createElement('div');\n    hostElement.classList.add('op-context-menu--overlay');\n    document.body.appendChild(hostElement);\n\n    this.bodyPortalHost = new DomPortalOutlet(\n      hostElement,\n      this.componentFactoryResolver,\n      this.appRef,\n      this.injector\n    );\n\n    // Close context menus on state change\n    $transitions.onStart({}, () => this.close());\n\n    // Listen to keyups on window to close context menus\n    jQuery(window).on('keydown', (evt:JQuery.TriggeredEvent) => {\n      if (this.active && evt.which === keyCodes.ESCAPE) {\n        this.close();\n      }\n\n      return true;\n    });\n\n    // Listen to any click and close the active context menu\n    const that = this;\n    document.getElementById('wrapper')!.addEventListener('click', function(evt:Event) {\n      if (that.active &&  !that.portalHostElement.contains(evt.target as Element)) {\n        that.close();\n      }\n    },  true);\n  }\n\n  /**\n   * Open a ContextMenu reference and append it to the portal\n   * @param contextMenu A reference to a context menu handler\n   */\n  public show(menu:OpContextMenuHandler, event:JQuery.TriggeredEvent, component:any = OPContextMenuComponent) {\n    this.close();\n\n    // Create a portal for the given component class and render it\n    this.isOpening = true;\n    const portal = new ComponentPortal(component, null, this.injectorFor(menu.locals));\n    this.bodyPortalHost.attach(portal);\n    this.portalHostElement.style.display = 'block';\n    this.active = menu;\n\n    setTimeout(() => {\n      this.reposition(event);\n      // Focus on the first element\n      this.active && this.active.onOpen(this.activeMenu);\n      this.isOpening = false;\n    });\n  }\n\n  public isActive(menu:OpContextMenuHandler) {\n    return this.active && this.active === menu;\n  }\n\n  /**\n   * Closes all currently open context menus.\n   */\n  public close() {\n    if (this.isOpening) {\n      return;\n    }\n\n    // Detach any component currently in the portal\n    this.bodyPortalHost.detach();\n    this.portalHostElement.style.display = 'none';\n    this.active && this.active.onClose();\n    this.active = null;\n  }\n\n  public reposition(event:JQuery.TriggeredEvent) {\n    if (!this.active) {\n      return;\n    }\n\n    this.activeMenu\n      .position(this.active.positionArgs(event))\n      .css('visibility', 'visible');\n  }\n\n  public get activeMenu():JQuery {\n    return jQuery(this.portalHostElement).find('.dropdown');\n  }\n\n  /**\n   * Create an augmented injector that is equal to this service's injector + the additional data\n   * passed into +show+.\n   * This allows callers to pass data into the newly created context menu component.\n   *\n   * @param {OpContextMenuLocalsMap} data\n   * @returns {PortalInjector}\n   */\n  private injectorFor(data:OpContextMenuLocalsMap) {\n    const injectorTokens = new WeakMap();\n    // Pass the service because otherwise we're getting a cyclic dependency between the portal\n    // host service and the bound portal\n    data.service = this;\n\n    injectorTokens.set(OpContextMenuLocalsToken, data);\n\n    return new PortalInjector(this.injector, injectorTokens);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {WorkPackageCacheService} from '../work-packages/work-package-cache.service';\nimport {Observable, Subject} from 'rxjs';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {HookService} from 'core-app/modules/plugins/hook-service';\nimport {WorkPackageFilterValues} from \"core-components/wp-edit-form/work-package-filter-values\";\n\nimport {\n  HalResourceEditingService,\n  ResourceChangesetCommit\n} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {filter} from \"rxjs/operators\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageDmService} from \"core-app/modules/hal/dm-services/work-package-dm.service\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const newWorkPackageHref = '/api/v3/work_packages/new';\n\n@Injectable()\nexport class WorkPackageCreateService extends UntilDestroyedMixin {\n  protected form:Promise<FormResource>|undefined;\n\n  // Allow callbacks to happen on newly created work packages\n  protected newWorkPackageCreatedSubject = new Subject<WorkPackageResource>();\n\n  constructor(protected injector:Injector,\n              protected hooks:HookService,\n              protected wpCacheService:WorkPackageCacheService,\n              protected halResourceService:HalResourceService,\n              protected querySpace:IsolatedQuerySpace,\n              protected authorisationService:AuthorisationService,\n              protected halEditing:HalResourceEditingService,\n              protected workPackageDmService:WorkPackageDmService,\n              protected halEvents:HalEventsService) {\n    super();\n\n    this.halEditing\n      .comittedChanges\n      .pipe(\n        this.untilDestroyed(),\n        filter(commit => commit.resource._type === 'WorkPackage' && commit.wasNew)\n      )\n      .subscribe((commit:ResourceChangesetCommit<WorkPackageResource>) => {\n        this.newWorkPackageCreated(commit.resource);\n      });\n\n    this.halEditing\n      .changes$(newWorkPackageHref)\n      .pipe(\n        this.untilDestroyed(),\n        filter(changeset => !changeset)\n      )\n      .subscribe(() => {\n        this.reset();\n      });\n  }\n\n  protected newWorkPackageCreated(wp:WorkPackageResource) {\n    this.reset();\n    this.newWorkPackageCreatedSubject.next(wp);\n  }\n\n  public onNewWorkPackage():Observable<WorkPackageResource> {\n    return this.newWorkPackageCreatedSubject.asObservable();\n  }\n\n  public createNewWorkPackage(projectIdentifier:string|undefined|null) {\n    return this.getEmptyForm(projectIdentifier).then(form => {\n      return this.fromCreateForm(form);\n    });\n  }\n\n  public createNewTypedWorkPackage(projectIdentifier:string|undefined|null, type:number) {\n    return this.workPackageDmService.typedCreateForm(type, projectIdentifier).then(form => {\n      return this.fromCreateForm(form);\n    });\n  }\n\n  public fromCreateForm(form:FormResource):WorkPackageChangeset {\n    let wp = this.halResourceService.createHalResourceOfType<WorkPackageResource>('WorkPackage', form.payload.$plain());\n    wp.initializeNewResource(form);\n\n    const change = this.halEditing.edit<WorkPackageResource, WorkPackageChangeset>(wp, form);\n\n    // Call work package initialization hook\n    this.hooks.call('workPackageNewInitialization', change);\n\n    return change;\n  }\n\n  public copyWorkPackage(copyFrom:WorkPackageChangeset) {\n    let request = copyFrom.pristineResource.$source;\n\n    // Ideally we would make an empty request before to get the create schema (cannot use the update schema of the source changeset)\n    // to get all the writable attributes and only send those.\n    // But as this would require an additional request, we don't.\n    return this.workPackageDmService.emptyCreateForm(request).then(form => {\n      let changeset = this.fromCreateForm(form);\n\n      return changeset;\n    });\n  }\n\n  /**\n   * Create a copy resource from other and the new work package form\n   * @param form Work Package create form\n   */\n  private copyFrom(form:FormResource) {\n    //let wp = fromCreateForm(form);\n    let wp = this.halResourceService.createHalResourceOfType<WorkPackageResource>('WorkPackage', form.payload.$plain());\n\n    wp.initializeNewResource(form);\n\n    return this.halEditing.edit(wp, form);\n  }\n\n\n  public getEmptyForm(projectIdentifier:string|null|undefined):Promise<FormResource> {\n    if (!this.form) {\n      this.form = this.workPackageDmService.emptyCreateForm({}, projectIdentifier);\n    }\n\n    return this.form;\n  }\n\n  public cancelCreation() {\n    this.halEditing.stopEditing({ href: newWorkPackageHref });\n    this.reset();\n  }\n\n  public changesetUpdates$() {\n    return this\n      .halEditing\n      .state(newWorkPackageHref)\n      .values$();\n  }\n\n  public createOrContinueWorkPackage(projectIdentifier:string|null|undefined, type?:number) {\n    let changePromise = this.continueExistingEdit(type);\n\n    if (!changePromise) {\n      changePromise = this.createNewWithDefaults(projectIdentifier, type);\n    }\n\n    return changePromise.then((change:WorkPackageChangeset) => {\n      this.authorisationService.initModelAuth('work_package', change.pristineResource);\n      this.halEditing.updateValue(newWorkPackageHref, change);\n      this.wpCacheService.updateWorkPackage(change.pristineResource);\n\n      return change;\n    });\n  }\n\n  protected reset() {\n    this.wpCacheService.clearSome('new');\n    this.form = undefined;\n  }\n\n  protected continueExistingEdit(type?:number) {\n    const change = this.halEditing.state(newWorkPackageHref).value as WorkPackageChangeset;\n    if (change !== undefined) {\n      const changeType = change.projectedResource.type;\n\n      const hasChanges = !change.isEmpty();\n      const typeEmpty = !changeType && !type;\n      const typeMatches = type && changeType && changeType.idFromLink === type.toString();\n\n      if (hasChanges && (typeEmpty || typeMatches)) {\n        return Promise.resolve(change);\n      }\n    }\n\n    return null;\n  }\n\n  protected createNewWithDefaults(projectIdentifier:string|null|undefined, type?:number) {\n    let changePromise = null;\n\n    if (type) {\n      changePromise = this.createNewTypedWorkPackage(projectIdentifier, type);\n    } else {\n      changePromise = this.createNewWorkPackage(projectIdentifier);\n    }\n\n    return changePromise.then((change:WorkPackageChangeset) => {\n      if (!change) {\n        throw 'No new work package was created';\n      }\n\n      let except:string[] = [];\n\n      if (type) {\n        except = ['type'];\n      }\n\n      this.applyDefaults(change, change.projectedResource, except);\n\n      return change;\n    });\n  }\n\n  /**\n   * Apply values to the work package from the current set of filters\n   *\n   * @param changeset\n   * @param wp\n   * @param except\n   */\n  private applyDefaults(change:WorkPackageChangeset, wp:WorkPackageResource, except:string[]) {\n    // Not using WorkPackageViewFiltersService here as the embedded table does not load the form\n    // which will result in that service having empty current filters.\n    let query = this.querySpace.query.value;\n\n    if (query) {\n      const filter = new WorkPackageFilterValues(this.injector, change, query.filters, except);\n      filter.applyDefaultsFromFilters();\n    }\n  }\n}\n","import {Injector} from '@angular/core';\nimport {States} from '../../../states.service';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {PrimaryRenderPass} from '../primary-render-pass';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport abstract class RowsBuilder {\n\n  @InjectField() public states:States;\n\n  constructor(public readonly injector:Injector, public workPackageTable:WorkPackageTable) {\n  }\n\n  /**\n   * Build all rows of the table.\n   */\n  public abstract buildRows():PrimaryRenderPass;\n\n  /**\n   * Determine if this builder applies to the current view mode.\n   */\n  public isApplicable(table:WorkPackageTable) {\n    return true;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Field, IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {DisplayFieldContext} from \"core-app/modules/fields/display/display-field.service\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const cssClassCustomOption = 'custom-option';\n\nexport class DisplayField<T extends HalResource = HalResource> extends Field {\n  public static type:string;\n  public mode:string | null = null;\n  public activeChange:ResourceChangeset<T>|null = null;\n\n  @InjectField() I18n:I18nService;\n\n  constructor(public name:string, public context:DisplayFieldContext) {\n    super();\n  }\n\n  /**\n   * Apply the display field to the given resource and schema\n   * @param resource\n   * @param schema\n   */\n  public apply(resource:T, schema:IFieldSchema) {\n    this.resource = resource;\n    this.schema = schema;\n  }\n\n  public texts = {\n    empty: this.I18n.t('js.label_no_value'),\n    placeholder: this.I18n.t('js.placeholders.default')\n  };\n\n  public get isFormattable():boolean {\n    return false;\n  }\n\n  /**\n   * Return the provided local injector,\n   * which is relevant to provide the display field\n   * the current space context.\n   */\n  public get injector() {\n    return this.context.injector;\n  }\n\n  public get value() {\n    if (!this.schema) {\n      return null;\n    }\n\n    if (this.activeChange) {\n      return this.activeChange.projectedResource[this.name];\n    }\n    else {\n      return this.attribute;\n    }\n  }\n\n  protected get attribute() {\n    return this.resource[this.name];\n  }\n\n  public get type():string {\n    return (this.constructor as typeof DisplayField).type;\n  }\n\n  public get valueString():string {\n    return this.value;\n  }\n\n  public get placeholder():string {\n    return '-';\n  }\n\n  public get label() {\n    return (this.schema.name || this.name);\n  }\n\n  public get title():string|null {\n\n    // Don't return a value for long text fields,\n    // since they shouldn't / won't be truncated.\n    if (this.isFormattable) {\n      return null;\n    }\n\n    return this.valueString;\n  }\n\n  public render(element:HTMLElement, displayText:string, options:any = {}):void {\n    element.textContent = displayText;\n  }\n\n  /**\n   * Render an empty placeholder if no values are present\n   */\n  public renderEmpty(element:HTMLElement) {\n    const emptyDiv = document.createElement('div');\n    emptyDiv.setAttribute('title', this.texts.empty);\n    emptyDiv.textContent = this.texts.placeholder;\n    emptyDiv.classList.add(cssClassCustomOption, '-empty');\n\n    element.appendChild(emptyDiv);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectorRef, Directive, OnInit} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {ActivityEntryInfo} from 'core-components/wp-single-view-tabs/activity-panel/activity-entry-info';\nimport {WorkPackagesActivityService} from 'core-components/wp-single-view-tabs/activity-panel/wp-activity.service';\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Transition} from \"@uirouter/core\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Directive()\nexport class ActivityPanelBaseController extends UntilDestroyedMixin implements OnInit {\n  public workPackage:WorkPackageResource;\n  public workPackageId:string;\n\n  // All activities retrieved for the work package\n  public unfilteredActivities:HalResource[] = [];\n\n  // Visible activities\n  public visibleActivities:ActivityEntryInfo[] = [];\n\n  public reverse:boolean;\n  public showToggler:boolean;\n\n  public onlyComments:boolean = false;\n  public togglerText:string;\n  public text = {\n    commentsOnly: this.I18n.t('js.label_activity_show_only_comments'),\n    showAll: this.I18n.t('js.label_activity_show_all')\n  };\n\n  constructor(readonly wpCacheService:WorkPackageCacheService,\n              readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly $transition:Transition,\n              readonly wpActivity:WorkPackagesActivityService) {\n    super();\n\n    this.reverse = wpActivity.isReversed;\n    this.togglerText = this.text.commentsOnly;\n  }\n\n  ngOnInit() {\n    this.wpCacheService\n      .observe(this.workPackageId)\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.workPackage = wp;\n        this.wpActivity.require(this.workPackage).then((activities:any) => {\n          this.updateActivities(activities);\n          this.cdRef.detectChanges();\n        });\n      });\n  }\n\n  protected updateActivities(activities:HalResource[]) {\n    this.unfilteredActivities = activities;\n\n    const visible = this.getVisibleActivities();\n    this.visibleActivities = visible.map((el:HalResource, i:number) => this.info(el, i));\n    this.showToggler = this.shouldShowToggler();\n  }\n\n  protected shouldShowToggler() {\n    const count_all = this.unfilteredActivities.length;\n    const count_with_comments = this.getActivitiesWithComments().length;\n\n    return count_all > 1 &&\n      count_with_comments > 0 &&\n      count_with_comments < this.unfilteredActivities.length;\n  }\n\n  protected getVisibleActivities() {\n    if (!this.onlyComments) {\n      return this.unfilteredActivities;\n    } else {\n      return this.getActivitiesWithComments();\n    }\n  }\n\n  protected getActivitiesWithComments() {\n    return this.unfilteredActivities\n      .filter((activity:HalResource) => !!_.get(activity, 'comment.html'));\n  }\n\n  public toggleComments() {\n    this.onlyComments = !this.onlyComments;\n    this.updateActivities(this.unfilteredActivities);\n\n    if (this.onlyComments) {\n      this.togglerText = this.text.showAll;\n    } else {\n      this.togglerText = this.text.commentsOnly;\n    }\n  }\n\n  public info(activity:HalResource, index:number) {\n    return this.wpActivity.info(this.unfilteredActivities, activity, index);\n  }\n}\n\n","\n/**\n * Return the row html id attribute for the given work package ID.\n */\nexport function rowId(workPackageId:string):string {\n  return `wp-row-${workPackageId}-table`;\n}\n\nexport function relationRowClass():string {\n  return `wp-table--relations-aditional-row`;\n}\n\nexport function locateTableRow(workPackageId:string):JQuery {\n  return jQuery('.' + rowId(workPackageId));\n}\n\nexport function locateTableRowByIdentifier(identifier:string) {\n  return jQuery(`.${identifier}-table`);\n}\n\nexport function locatePredecessorBySelector(el:HTMLElement, selector:string):HTMLElement|null {\n  let previous = el.previousElementSibling;\n\n  while (previous) {\n    if (previous.matches(selector)) {\n      return previous as HTMLElement;\n    } else {\n      previous = previous.previousElementSibling;\n    }\n  }\n\n  return null;\n}\n\nexport function scrollTableRowIntoView(workPackageId:string):void {\n  try {\n    const element = locateTableRow(workPackageId);\n    const container = element.scrollParent()!;\n    const containerTop = container.scrollTop()!;\n    const containerBottom = containerTop + container.height()!;\n\n    const elemTop = element[0].offsetTop;\n    const elemBottom = elemTop + element.height()!;\n\n     if (elemTop < containerTop) {\n       container[0].scrollTop = elemTop;\n     } else if (elemBottom > containerBottom) {\n       container[0].scrollTop = elemBottom - container.height()!;\n     }\n  } catch (e) {\n    console.warn(\"Can't scroll row element into view: \" + e);\n  }\n}\n","import {Injector} from \"@angular/core\";\nimport {\n  OpEditingPortalChangesetToken,\n  OpEditingPortalHandlerToken,\n  OpEditingPortalSchemaToken\n} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {PortalInjector} from \"@angular/cdk/portal\";\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\n\n/**\n * Creates an injector for the edit field portal to pass data into.\n *\n * @returns {PortalInjector}\n */\nexport function createLocalInjector(injector:Injector, change:ResourceChangeset, fieldHandler:EditFieldHandler, schema:IFieldSchema):Injector {\n  const injectorTokens = new WeakMap();\n\n  injectorTokens.set(OpEditingPortalChangesetToken, change);\n  injectorTokens.set(OpEditingPortalHandlerToken, fieldHandler);\n  injectorTokens.set(OpEditingPortalSchemaToken, schema);\n\n  return new PortalInjector(injector, injectorTokens);\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Moment} from 'moment';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OnInit} from '@angular/core';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport abstract class AbstractDateTimeValueController extends UntilDestroyedMixin implements OnInit {\n  public filter:QueryFilterInstanceResource;\n\n  constructor(protected I18n:I18nService,\n              protected timezoneService:TimezoneService) {\n    super();\n  }\n\n  ngOnInit() {\n    _.remove(this.filter.values as string[], value => !this.timezoneService.isValidISODateTime(value));\n  }\n\n  public abstract get lowerBoundary():Moment|null;\n\n  public abstract get upperBoundary():Moment|null;\n\n  public isoDateParser(data:any) {\n    if (!this.timezoneService.isValidISODate(data)) {\n      return '';\n    }\n    var d = this.timezoneService.parseISODatetime(data);\n    return this.timezoneService.formattedISODateTime(d);\n  }\n\n  public isoDateFormatter(data:any) {\n    if (!this.timezoneService.isValidISODateTime(data)) {\n      return '';\n    }\n    var d = this.timezoneService.parseISODatetime(data);\n    return this.timezoneService.formattedISODate(d);\n  }\n\n  public get isTimeZoneDifferent() {\n    let value = this.lowerBoundary || this.upperBoundary;\n\n    if (!value) {\n      return false;\n    } else {\n      return value.hours() !== 0 || value.minutes() !== 0;\n    }\n  }\n\n  public get timeZoneText() {\n    if (this.lowerBoundary && this.upperBoundary) {\n      return this.I18n.t('js.filter.time_zone_converted.two_values',\n        {\n          from: this.lowerBoundary.format('YYYY-MM-DD HH:mm'),\n          to: this.upperBoundary.format('YYYY-MM-DD HH:mm')\n        });\n    } else if (this.upperBoundary) {\n      return this.I18n.t('js.filter.time_zone_converted.only_end',\n        { to: this.upperBoundary.format('YYYY-MM-DD HH:mm') });\n\n    } else if (this.lowerBoundary) {\n      return this.I18n.t('js.filter.time_zone_converted.only_start',\n        { from: this.lowerBoundary.format('YYYY-MM-DD HH:mm') });\n\n    }\n\n    return '';\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {additionalHierarchyRowClassName, SingleHierarchyRowBuilder} from './single-hierarchy-row-builder';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {PrimaryRenderPass, RowRenderInfo} from \"core-components/wp-fast-table/builders/primary-render-pass\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageTableRow} from \"core-components/wp-fast-table/wp-table.interfaces\";\nimport {\n  ancestorClassIdentifier,\n  hierarchyGroupClass\n} from \"core-components/wp-fast-table/helpers/wp-table-hierarchy-helpers\";\nimport {WorkPackageViewHierarchies} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-hierarchies\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HierarchyRenderPass extends PrimaryRenderPass {\n\n  @InjectField() querySpace:IsolatedQuerySpace;\n  @InjectField() states:States;\n  @InjectField() wpCacheService:WorkPackageCacheService;\n  @InjectField() wpTableHierarchies:WorkPackageViewHierarchiesService;\n\n  // Remember which rows were already rendered\n  private rendered:{ [workPackageId:string]:boolean } = {};\n\n  // Remember additional parents inserted that are not part of the results table\n  private additionalParents:{ [workPackageId:string]:WorkPackageResource } = {};\n\n  // Defer children to be rendered when their parent occurs later in the table\n  private deferred:{ [parentId:string]:WorkPackageResource[] } = {};\n\n  // Collapsed state\n  private hierarchies:WorkPackageViewHierarchies;\n\n  // Build a map of hierarchy elements present in the table\n  // with at least a visible child\n  public parentsWithVisibleChildren:{ [id:string]:boolean } = {};\n\n  constructor(public readonly injector:Injector,\n              public workPackageTable:WorkPackageTable,\n              public rowBuilder:SingleHierarchyRowBuilder) {\n    super(injector, workPackageTable, rowBuilder);\n  }\n\n  protected prepare() {\n    super.prepare();\n\n    this.hierarchies = this.wpTableHierarchies.current;\n\n    _.each(this.workPackageTable.originalRowIndex, (row,) => {\n      row.object.ancestors.forEach((ancestor:WorkPackageResource) => {\n        this.parentsWithVisibleChildren[ancestor.id!] = true;\n      });\n    });\n\n    this.rowBuilder.parentsWithVisibleChildren = this.parentsWithVisibleChildren;\n  }\n\n  /**\n   * Render the hierarchy table into the document fragment\n   */\n  protected doRender() {\n    this.workPackageTable.originalRows.forEach((wpId:string) => {\n      const row:WorkPackageTableRow = this.workPackageTable.originalRowIndex[wpId];\n      const workPackage:WorkPackageResource = row.object;\n\n      // If we need to defer this row, skip it for now\n      if (this.deferInsertion(workPackage)) {\n        return;\n      }\n\n      if (workPackage.ancestors.length) {\n        // If we have ancestors, render it\n        this.buildWithHierarchy(row);\n      } else {\n        // Render a work package root with no parents\n        let [tr, hidden] = this.rowBuilder.buildEmpty(workPackage);\n        row.element = tr;\n        this.tableBody.appendChild(tr);\n        this.markRendered(tr, workPackage, hidden);\n      }\n\n      // Render all potentially deferred rows\n      this.renderAllDeferredChildren(workPackage);\n    });\n  }\n\n  /**\n   * If the given work package has a visible ancestor in the table, return true\n   * and remember the work package until the ancestor is rendered.\n   * @param workPackage\n   * @returns {boolean}\n   */\n  public deferInsertion(workPackage:WorkPackageResource):boolean {\n    const ancestors = workPackage.ancestors;\n\n    // Will only defer if at least one ancestor exists\n    if (ancestors.length === 0) {\n      return false;\n    }\n\n    // Cases for wp\n    // 1. No wp.ancestors in table -> Render them immediately (defer=false)\n    // 2. Parent in table -> deffered[parent] = wp\n    // 3. Parent not in table BUT a ancestor in table\n    // -> deferred[a ancestor] = parent\n    // -> deferred[parent] = wp\n    // 4. Any ancestor already rendered -> Render normally (don't defer)\n    let ancestorChain = ancestors.concat([workPackage]);\n    for (let i = ancestorChain.length - 2; i >= 0; --i) {\n      const parent = ancestorChain[i];\n\n      const inTable = this.workPackageTable.originalRowIndex[parent.id!];\n      const alreadyRendered = this.rendered[parent.id!];\n\n      if (alreadyRendered) {\n        // parent is already rendered.\n        // Don't defer, but render all intermediate parents below it\n        return false;\n      }\n\n      if (inTable) {\n        // Get the current elements\n        let elements = this.deferred[parent.id!] || [];\n        // Append to them the child and all children below\n        let newElements:WorkPackageResource[] = ancestorChain.slice(i + 1, ancestorChain.length);\n        newElements = newElements.map(child => this.wpCacheService.state(child.id!).value!);\n        // Append all new elements\n        elements = elements.concat(newElements);\n        // Remove duplicates (Regression #29652)\n        this.deferred[parent.id!] = _.uniqBy(elements, el => el.id!);\n        return true;\n      }\n      // Otherwise, continue the chain upwards\n    }\n\n    return false;\n  }\n\n\n  /**\n   * Render any deferred children of the given work package. If recursive children were\n   * deferred, each of them will be passed through renderCallback.\n   * @param workPackage\n   */\n  private renderAllDeferredChildren(workPackage:WorkPackageResource) {\n    const wpId = workPackage.id!;\n    const deferredChildren = this.deferred[wpId] || [];\n\n    // If the work package has deferred children to render,\n    // run them through the callback\n    deferredChildren.forEach((child:WorkPackageResource) => {\n      this.insertUnderParent(this.getOrBuildRow(child), child.parent || workPackage);\n\n      // Descend into any children the child WP might have and callback\n      this.renderAllDeferredChildren(child);\n    });\n  }\n\n  private getOrBuildRow(workPackage:WorkPackageResource) {\n    let row:WorkPackageTableRow = this.workPackageTable.originalRowIndex[workPackage.id!];\n\n    if (!row) {\n      row = {object: workPackage} as WorkPackageTableRow;\n    }\n\n    return row;\n  }\n\n  private buildWithHierarchy(row:WorkPackageTableRow) {\n    // Ancestor data [root, med, thisrow]\n    const ancestors = row.object.ancestors;\n    const ancestorGroups:string[] = [];\n\n    // Iterate ancestors\n    ancestors.forEach((el:WorkPackageResource, index:number) => {\n      const ancestor = this.states.workPackages.get(el.id!).getValueOr(el);\n\n      // If we see the parent the first time,\n      // build it as an additional row and insert it into the ancestry\n      if (!this.rendered[ancestor.id!]) {\n        let [ancestorRow, hidden] = this.rowBuilder.buildAncestorRow(ancestor, ancestorGroups, index);\n        // Insert the ancestor row, either right here if it's a root node\n        // Or below the appropriate parent\n\n        if (index === 0) {\n          // Special case, first ancestor => root without parent\n          this.tableBody.appendChild(ancestorRow);\n          this.markRendered(ancestorRow, ancestor, hidden, true);\n        } else {\n          // This ancestor must be inserted in the last position of its root\n          const parent = ancestors[index - 1];\n          this.insertAtExistingHierarchy(ancestor, ancestorRow, parent, hidden, true);\n        }\n\n        // Remember we just added this extra ancestor row\n        this.additionalParents[ancestor.id!] = ancestor;\n      }\n\n      // Push the correct ancestor groups for identifiying a hierarchy group\n      ancestorGroups.push(hierarchyGroupClass(ancestor.id!));\n      ancestors.slice(0, index).forEach((previousAncestor) => {\n        ancestorGroups.push(hierarchyGroupClass(previousAncestor.id!));\n      });\n    });\n\n    // Insert this row to parent\n    const parent = _.last(ancestors);\n    this.insertUnderParent(row, parent!);\n  }\n\n  /**\n   * Insert the given node as a child of the parent\n   * @param row\n   * @param parent\n   */\n  private insertUnderParent(row:WorkPackageTableRow, parent:WorkPackageResource) {\n    const [tr, hidden] = this.rowBuilder.buildEmpty(row.object);\n    row.element = tr;\n    this.insertAtExistingHierarchy(row.object, tr, parent, hidden, false);\n  }\n\n  /**\n   * Mark the given work package as rendered\n   * @param workPackage\n   * @param hidden\n   * @param isAncestor\n   */\n  private markRendered(row:HTMLTableRowElement, workPackage:WorkPackageResource, hidden:boolean = false, isAncestor:boolean = false) {\n    this.rendered[workPackage.id!] = true;\n    this.renderedOrder.push(this.buildRenderInfo(row, workPackage, hidden, isAncestor));\n  }\n\n  /**\n   * Append a row to the given parent hierarchy group.\n   */\n  private insertAtExistingHierarchy(workPackage:WorkPackageResource,\n                                    el:HTMLTableRowElement,\n                                    parent:WorkPackageResource,\n                                    hidden:boolean,\n                                    isAncestor:boolean) {\n    // Either append to the hierarchy group root (= the parentID row itself)\n    const hierarchyRoot = `.__hierarchy-root-${parent.id}`;\n    // Or, if it has descendants, append to the LATEST of that set\n    const hierarchyGroup = `.__hierarchy-group-${parent.id}`;\n\n    // Insert into table\n    this.spliceRow(\n      el,\n      `${hierarchyRoot},${hierarchyGroup}`,\n      this.buildRenderInfo(el, workPackage, hidden, isAncestor)\n    );\n\n    this.rendered[workPackage.id!] = true;\n  }\n\n  private buildRenderInfo(row:HTMLTableRowElement, workPackage:WorkPackageResource, hidden:boolean, isAncestor:boolean):RowRenderInfo {\n    let info:RowRenderInfo = {\n      element: row,\n      classIdentifier: '',\n      additionalClasses: [],\n      workPackage: workPackage,\n      renderType: 'primary',\n      hidden: hidden\n    };\n\n    let [ancestorClasses, _] = this.rowBuilder.ancestorRowData(workPackage);\n\n    if (isAncestor) {\n      info.additionalClasses = [additionalHierarchyRowClassName].concat(ancestorClasses);\n      info.classIdentifier = ancestorClassIdentifier(workPackage.id!);\n    } else {\n      info.additionalClasses = ancestorClasses;\n      info.classIdentifier = this.rowBuilder.classIdentifier(workPackage);\n    }\n\n    return info as RowRenderInfo;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {States} from '../../../../states.service';\nimport {WorkPackageTable} from '../../../wp-fast-table';\nimport {RowsBuilder} from '../rows-builder';\nimport {HierarchyRenderPass} from './hierarchy-render-pass';\nimport {SingleHierarchyRowBuilder} from './single-hierarchy-row-builder';\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HierarchyRowsBuilder extends RowsBuilder {\n\n  // Injections\n  @InjectField() states:States;\n  @InjectField() wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() wpTableHierarchies:WorkPackageViewHierarchiesService;\n\n  // The group expansion state\n  constructor(public readonly injector:Injector, public workPackageTable:WorkPackageTable) {\n    super(injector, workPackageTable);\n  }\n\n  /**\n   * The hierarchy builder is only applicable if the hierachy mode is active\n   */\n  public isApplicable(_table:WorkPackageTable) {\n    return this.wpTableHierarchies.isEnabled;\n  }\n\n  /**\n   * Rebuild the entire grouped tbody from the given table\n   */\n  public buildRows():HierarchyRenderPass {\n    const builder = new SingleHierarchyRowBuilder(this.injector, this.workPackageTable);\n    return new HierarchyRenderPass(this.injector, this.workPackageTable, builder).render();\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageTable} from '../../../wp-fast-table';\nimport {PrimaryRenderPass} from '../../primary-render-pass';\nimport {SingleRowBuilder} from '../../rows/single-row-builder';\nimport {RowsBuilder} from '../rows-builder';\nimport {PlainRenderPass} from './plain-render-pass';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class PlainRowsBuilder extends RowsBuilder {\n\n  // Injections\n  @InjectField() public I18n:I18nService;\n\n  // The group expansion state\n  constructor(public readonly injector:Injector, workPackageTable:WorkPackageTable) {\n    super(injector, workPackageTable);\n  }\n\n  /**\n   * Rebuild the entire grouped tbody from the given table\n   */\n  public buildRows():PrimaryRenderPass {\n    const builder = new SingleRowBuilder(this.injector, this.workPackageTable);\n    return new PlainRenderPass(this.injector, this.workPackageTable, builder).render();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector} from '@angular/core';\nimport {Subscription} from 'rxjs';\nimport {States} from 'core-components/states.service';\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\n\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {FocusHelperService} from \"core-app/modules/common/focus/focus-helper\";\nimport {EditingPortalService} from \"core-app/modules/fields/edit/editing-portal/editing-portal-service\";\nimport {CellBuilder, editCellContainer, tdClassName} from \"core-components/wp-fast-table/builders/cell-builder\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {EditForm} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {editModeClassName} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const activeFieldContainerClassName = 'inline-edit--active-field';\nexport const activeFieldClassName = 'inline-edit--field';\n\nexport class TableEditForm extends EditForm<WorkPackageResource> {\n  @InjectField() public wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() public wpCacheService:WorkPackageCacheService;\n  @InjectField() public states:States;\n  @InjectField() public FocusHelper:FocusHelperService;\n  @InjectField() public editingPortalService:EditingPortalService;\n\n  // Use cell builder to reset edit fields\n  private cellBuilder = new CellBuilder(this.injector);\n\n  // Subscription\n  private resourceSubscription:Subscription = this.wpCacheService\n    .requireAndStream(this.workPackageId)\n    .subscribe((wp) => this.resource = wp);\n\n  constructor(public injector:Injector,\n              public table:WorkPackageTable,\n              public workPackageId:string,\n              public classIdentifier:string) {\n    super(injector);\n  }\n\n  destroy() {\n    this.resourceSubscription.unsubscribe();\n  }\n\n  public findContainer(fieldName:string):JQuery {\n    return this.rowContainer.find(`.${tdClassName}.${fieldName} .${editCellContainer}`).first();\n  }\n\n  public findCell(fieldName:string) {\n    return this.rowContainer.find(`.${tdClassName}.${fieldName}`).first();\n  }\n\n  public activateField(form:EditForm, schema:IFieldSchema, fieldName:string, errors:string[]):Promise<EditFieldHandler> {\n    return this.waitForContainer(fieldName)\n      .then((cell) => {\n\n        // Forcibly set the width since the edit field may otherwise\n        // be given more width. Thereby preserve a minimum width of 150.\n        // To avoid flickering content, the padding is removed, too.\n        const td = this.findCell(fieldName);\n        td.addClass(editModeClassName);\n        let width = parseInt(td.css('width'));\n        width = width > 150 ? width - 10 : 150;\n        td.css('max-width', width + 'px');\n        td.css('width', width + 'px');\n\n        return this.editingPortalService.create(\n          cell,\n          this.injector,\n          form,\n          schema,\n          fieldName,\n          errors\n        );\n      });\n  }\n\n  public reset(fieldName:string, focus?:boolean) {\n    const cell = this.findContainer(fieldName);\n    const td = this.findCell(fieldName);\n\n    if (cell.length) {\n      this.findCell(fieldName).css('width', '');\n      this.findCell(fieldName).css('max-width', '');\n      this.cellBuilder.refresh(cell[0], this.resource, fieldName);\n      td.removeClass(editModeClassName);\n\n      if (focus) {\n        this.FocusHelper.focusElement(cell);\n      }\n    }\n  }\n\n  public requireVisible(fieldName:string):Promise<any> {\n    this.wpTableColumns.addColumn(fieldName);\n    return this.waitForContainer(fieldName);\n  }\n\n  protected focusOnFirstError():void {\n    // Focus the first field that is erroneous\n    jQuery(this.table.tableAndTimelineContainer)\n      .find(`.${activeFieldContainerClassName}.-error .${activeFieldClassName}`)\n      .first()\n      .trigger('focus');\n  }\n\n  // Ensure the given field is visible.\n  // We may want to look into MutationObserver if we need this in several places.\n  private waitForContainer(fieldName:string):Promise<HTMLElement> {\n    return new Promise<HTMLElement>((resolve, reject) => {\n      const interval = setInterval(() => {\n        const container = this.findContainer(fieldName);\n\n        if (container.length > 0) {\n          clearInterval(interval);\n          resolve(container[0]);\n        }\n      }, 100);\n    });\n  }\n\n  private get rowContainer() {\n    return jQuery(this.table.tableAndTimelineContainer).find(`.${this.classIdentifier}-table`);\n  }\n\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageTable} from 'core-components/wp-fast-table/wp-fast-table';\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {EditForm} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {TableEditForm} from \"core-components/wp-edit-form/table-edit-form\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageTableEditingContext {\n\n  @InjectField() public halEditing:HalResourceEditingService;\n\n  constructor(readonly table:WorkPackageTable,\n              readonly injector:Injector) {\n  }\n\n  public forms:{ [wpId:string]:TableEditForm } = {};\n\n  public reset() {\n    _.each(this.forms, (form) => form.destroy());\n    this.forms = {};\n  }\n\n  public change(workPackage:WorkPackageResource):WorkPackageChangeset|undefined {\n    return this.halEditing.typedState<WorkPackageResource, WorkPackageChangeset>(workPackage).value;\n  }\n\n  // TODO\n  public stopEditing(workPackage:WorkPackageResource) {\n    this.halEditing.stopEditing(workPackage);\n\n    const existing = this.forms[workPackage.id!];\n    if (existing) {\n      existing.destroy();\n      delete this.forms[workPackage.id!];\n    }\n  }\n\n  public startEditing(workPackage:WorkPackageResource, classIdentifier:string):EditForm {\n    const wpId = workPackage.id!;\n    const existing = this.forms[wpId];\n    if (existing) {\n      return existing;\n    }\n\n    // Get any existing edit state for this work package\n    return this.forms[wpId] = new TableEditForm(this.injector, this.table, wpId, classIdentifier);\n  }\n}\n\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {debugLog} from '../../helpers/debug_output';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\nimport {States} from '../states.service';\nimport {WorkPackageCacheService} from '../work-packages/work-package-cache.service';\nimport {WorkPackageTimelineTableController} from '../wp-table/timeline/container/wp-timeline-container.directive';\nimport {GroupedRowsBuilder} from './builders/modes/grouped/grouped-rows-builder';\nimport {HierarchyRowsBuilder} from './builders/modes/hierarchy/hierarchy-rows-builder';\nimport {PlainRowsBuilder} from './builders/modes/plain/plain-rows-builder';\nimport {RowsBuilder} from './builders/modes/rows-builder';\nimport {PrimaryRenderPass} from './builders/primary-render-pass';\nimport {WorkPackageTableEditingContext} from './wp-table-editing';\n\nimport {WorkPackageTableRow} from './wp-table.interfaces';\nimport {WorkPackageTableConfiguration} from 'core-app/components/wp-table/wp-table-configuration';\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageTable {\n\n  @InjectField() querySpace:IsolatedQuerySpace;\n  @InjectField() wpCacheService:WorkPackageCacheService;\n  @InjectField() states:States;\n  @InjectField() I18n:I18nService;\n\n  public originalRows:string[] = [];\n  public originalRowIndex:{ [id:string]:WorkPackageTableRow } = {};\n\n  // WP rows builder\n  // Ordered by priority\n  private builders = [\n    new HierarchyRowsBuilder(this.injector, this),\n    new GroupedRowsBuilder(this.injector, this),\n    new PlainRowsBuilder(this.injector, this)\n  ];\n\n  // Last render pass used for refreshing single rows\n  public lastRenderPass:PrimaryRenderPass|null = null;\n\n  // Work package editing context handler in the table, which handles open forms\n  // and their contexts\n  public editing:WorkPackageTableEditingContext = new WorkPackageTableEditingContext(this, this.injector);\n\n  constructor(public readonly injector:Injector,\n              public tableAndTimelineContainer:HTMLElement,\n              public scrollContainer:HTMLElement,\n              public tbody:HTMLElement,\n              public timelineBody:HTMLElement,\n              public timelineController:WorkPackageTimelineTableController,\n              public configuration:WorkPackageTableConfiguration) {\n  }\n\n  public get renderedRows() {\n    return this.querySpace.tableRendered.getValueOr([]);\n  }\n\n  public findRenderedRow(classIdentifier:string):[number, RenderedWorkPackage] {\n    const index = _.findIndex(this.renderedRows, (row) => row.classIdentifier === classIdentifier);\n\n    return [index, this.renderedRows[index]];\n  }\n\n  public get rowBuilder():RowsBuilder {\n    return _.find(this.builders, (builder:RowsBuilder) => builder.isApplicable(this))!;\n  }\n\n  /**\n   * Build the row index and positions from the given set of ordered work packages.\n   * @param rows\n   */\n  private buildIndex(rows:WorkPackageResource[]) {\n    this.originalRowIndex = {};\n    this.originalRows = rows.map((wp:WorkPackageResource, i:number) => {\n      let wpId = wp.id!;\n\n      // Ensure we get the latest version\n      wp = this.wpCacheService.current(wpId, wp)!;\n\n      this.originalRowIndex[wpId] = <WorkPackageTableRow>{ object: wp, workPackageId: wpId, position: i };\n      return wpId;\n    });\n  }\n\n  /**\n   *\n   * @param rows\n   */\n  public initialSetup(rows:WorkPackageResource[]) {\n    // Build the row representation\n    this.buildIndex(rows);\n\n    // Draw work packages\n    this.redrawTableAndTimeline();\n  }\n\n  /**\n   * Removes the contents of this table's tbody and redraws\n   * all elements.\n   */\n  public redrawTableAndTimeline() {\n    const renderPass = this.performRenderPass(false);\n\n    // Insert timeline body\n    requestAnimationFrame(() => {\n      this.tbody.innerHTML = '';\n      this.timelineBody.innerHTML = '';\n      this.tbody.appendChild(renderPass.tableBody);\n      this.timelineBody.appendChild(renderPass.timeline.timelineBody);\n\n      // Mark rendering event in a timeout to let DOM process\n      setTimeout(() =>\n        this.querySpace.tableRendered.putValue(renderPass.result)\n      );\n    });\n  }\n\n  /**\n   * Redraw all elements in the table section only\n   */\n  public redrawTable() {\n    const renderPass = this.performRenderPass();\n    this.querySpace.tableRendered.putValue(renderPass.result);\n  }\n\n  /**\n   * Redraw single rows for a given work package being updated.\n   */\n  public refreshRows(workPackage:WorkPackageResource) {\n    const pass = this.lastRenderPass;\n    if (!pass) {\n      debugLog('Trying to refresh a singular row without a previous render pass.');\n      return;\n    }\n\n    _.each(pass.renderedOrder, (row) => {\n      if (row.workPackage && row.workPackage.id === workPackage.id!) {\n        debugLog(`Refreshing rendered row ${row.classIdentifier}`);\n        row.workPackage = workPackage;\n        pass.refresh(row, workPackage, this.tbody);\n      }\n    });\n  }\n\n  /**\n   * Determine whether we need an empty placeholder row.\n   * When D&D is enabled, the table requires a drag target that is non-empty,\n   * and the tbody cannot be resized appropriately.\n   */\n  public get renderPlaceholderRow() {\n    return this.configuration.dragAndDropEnabled;\n  }\n\n\n  /**\n   * Perform the render pass\n   * @param insert whether to insert the result (set to false for timeline)\n   */\n  private performRenderPass(insert:boolean = true) {\n    this.editing.reset();\n    const renderPass = this.lastRenderPass = this.rowBuilder.buildRows();\n\n    // Insert table body\n    if (insert) {\n      requestAnimationFrame(() => {\n        this.tbody.innerHTML = '';\n        this.tbody.appendChild(renderPass.tableBody);\n      });\n    }\n\n    return renderPass;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {Injectable} from \"@angular/core\";\nimport {States} from \"core-components/states.service\";\nimport {buildApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\n\n@Injectable()\nexport class WorkPackageDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService,\n              protected states:States) {\n  }\n\n  /**\n   * Loads a WorkPackage.\n   *\n   * @param id The ID of the WorkPackage.\n   * @param force Bypass any cached value?\n   * @returns {IPromise<any>|IPromise<WorkPackageResource>} A promise for the WorkPackage.\n   */\n  public loadWorkPackageById(id:string, force = false) {\n    const url = this.pathHelper.api.v3.work_packages.id(id).toString();\n\n    return this.halResourceService.get<WorkPackageResource>(url).toPromise();\n  }\n\n  /**\n   * Loads the work packages collection for the given work package IDs.\n   * Returns a WP Collection with schemas and results embedded.\n   *\n   * @param ids\n   * @return {WorkPackageCollectionResource[]}\n   */\n  public loadWorkPackagesCollectionsFor(ids:string[]):Promise<WorkPackageCollectionResource[]> {\n    return this.halResourceService.getAllPaginated(\n      this.pathHelper.api.v3.work_packages.toString(),\n      ids.length,\n      {\n        filters: buildApiV3Filter('id', '=', ids).toJson(),\n      }\n    ) as any; // WorkPackageCollectionResource does not satisfy constraint HalResource[]\n  }\n\n  /**\n   * Returns a promise to post `/api/v3/work_packages/form`.\n   *\n   * @returns An empty work package form resource.\n   */\n  public emptyCreateForm(request:any, projectIdentifier?:string|null):Promise<FormResource> {\n    return this.halResourceService\n      .post<FormResource>(this.workPackagesFormPath(projectIdentifier), request)\n      .toPromise();\n  }\n\n  /**\n   * Returns a promise to post `/api/v3/work_packages/form` where the\n   * type has already been set to the one provided.\n   *\n   * @param typeId: The id of the type to initialize the form with\n   * @param projectIdentifier: The project to which the work package is initialized\n   * @returns An empty work package form resource.\n   */\n  public typedCreateForm(typeId:number, projectIdentifier:string|undefined|null):Promise<FormResource> {\n\n    const typeUrl = this.pathHelper.api.v3.types.id(typeId).toString();\n    const request = { _links: { type: { href: typeUrl } } };\n\n    return this.halResourceService\n      .post<FormResource>(this.workPackagesFormPath(projectIdentifier), request)\n      .toPromise();\n  }\n\n  /**\n   * Create a work package from a form payload\n   *\n   * @param payload\n   * @return {Promise<WorkPackageResource>}\n   */\n  public createWorkPackage(payload:any):Promise<WorkPackageResource> {\n    return this.halResourceService\n      .post<WorkPackageResource>(this.pathHelper.api.v3.work_packages.path, payload)\n      .toPromise();\n  }\n\n  private workPackagesFormPath(projectIdentifier:string|null|undefined):string {\n    if (projectIdentifier) {\n      return this.pathHelper.api.v3.projects.id(projectIdentifier).work_packages.form.toString();\n    } else {\n      return this.pathHelper.api.v3.work_packages.form.toString();\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectorRef, Component, ElementRef, Inject, OnDestroy, OnInit} from \"@angular/core\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  templateUrl: './dynamic-content.modal.html'\n})\nexport class DynamicContentModal extends OpModalComponent implements OnInit, OnDestroy {\n  // override superclass\n  // Allowing outside clicks to close the modal leads to the user involuntarily closing\n  // the modal when removing error messages or clicking on labels e.g. in the registration modal.\n  public closeOnOutsideClick:boolean = false;\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n  }\n\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    // Append the dynamic body\n    this.$element\n      .find('.dynamic-content-modal--wrapper')\n      .addClass(this.locals.modalClassName)\n      .append(this.locals.modalBody);\n\n    // Register click listeners\n    jQuery(document.body)\n      .on('click.opdynamicmodal',\n        '.dynamic-content-modal--close-button',\n        (evt:JQuery.TriggeredEvent) => {\n        this.closeMe(evt);\n      });\n  }\n\n  ngOnDestroy() {\n    jQuery(document.body).off('click.opdynamicmodal');\n    super.ngOnDestroy();\n  }\n\n}\n","<div class=\"op-modal--portal \">\n  <div class=\"op-modal--modal-container dynamic-content-modal--wrapper loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n  </div>\n</div>\n","import {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Injectable} from \"@angular/core\";\n\nexport interface ICKEditorInstance {\n  getData(obtions:{trim:boolean}):string;\n\n  setData(content:string):void;\n\n  on(event:string, callback:Function):void;\n\n  model:any;\n  editing:any;\n  config:any;\n  ui:any;\n  element:HTMLElement;\n}\n\nexport interface ICKEditorStatic {\n  create(el:HTMLElement, config?:any):Promise<ICKEditorInstance>;\n\n  createCustomized(el:string|HTMLElement, config?:any):Promise<ICKEditorInstance>;\n}\n\nexport interface ICKEditorContext {\n  resource?:HalResource;\n  // Specific removing of plugins\n  removePlugins?:string[];\n  // Set of enabled macro plugins or false to disable all\n  macros?:'none'|'wp'|'full'|boolean|string[];\n  // Additional options like the text orientation of the editors content\n  options?:{\n    rtl?:boolean;\n  };\n  // context link to append on preview requests\n  previewContext?:string;\n}\n\ndeclare global {\n  interface Window {\n    OPConstrainedEditor:ICKEditorStatic;\n    OPClassicEditor:ICKEditorStatic;\n  }\n}\n\n@Injectable()\nexport class CKEditorSetupService {\n  constructor(private PathHelper:PathHelperService) {\n  }\n\n  /**\n   * Create a CKEditor instance of the given type on the wrapper element.\n   * Pass a ICKEditorContext object that will be used to decide active plugins.\n   *\n   *\n   * @param {\"full\" | \"constrained\"} type\n   * @param {HTMLElement} wrapper\n   * @param {ICKEditorContext} context\n   * @returns {Promise<ICKEditorInstance>}\n   */\n  public create(type:'full'|'constrained', wrapper:HTMLElement, context:ICKEditorContext, initialData:string|null = null) {\n    const editor = type === 'constrained' ? window.OPConstrainedEditor : window.OPClassicEditor;\n    wrapper.classList.add(`ckeditor-type-${type}`);\n\n    const toolbarWrapper = wrapper.querySelector('.document-editor__toolbar') as HTMLElement;\n    const contentWrapper = wrapper.querySelector('.document-editor__editable') as HTMLElement;\n\n    var contentLanguage = context.options && context.options.rtl ? 'ar' : 'en';\n\n    return editor\n      .createCustomized(contentWrapper, {\n        openProject: this.createConfig(context),\n        initialData: initialData,\n        language: {\n          content: contentLanguage\n        }\n      })\n      .then((editor) => {\n        // Add decoupled toolbar\n        toolbarWrapper.appendChild( editor.ui.view.toolbar.element );\n\n        // Allow custom events on wrapper to set/get data for debugging\n        jQuery(wrapper)\n          .on('op:ckeditor:setData', (event:any, data:string) => editor.setData(data))\n          .on('op:ckeditor:clear', (event:any) => editor.setData(' '))\n          .on('op:ckeditor:getData', (event:any, cb:any) => cb(editor.getData({ trim: false })));\n\n        return editor;\n      });\n  }\n\n  private createConfig(context:ICKEditorContext):any {\n    if (context.macros === 'none') {\n      context.macros = false;\n    } else if (context.macros === 'wp') {\n      context.macros = [\n        'OPMacroToc',\n        'OPMacroEmbeddedTable',\n        'OPMacroWpButton'\n      ];\n    } else {\n      context.macros = context.macros;\n    }\n\n    return {\n      context: context,\n      helpURL: this.PathHelper.textFormattingHelp(),\n      pluginContext: window.OpenProject.pluginContext.value\n    };\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\nimport {AbstractFieldService, IFieldType} from \"core-app/modules/fields/field.service\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\nexport interface IEditFieldType extends IFieldType<EditFieldComponent> {\n  new():EditFieldComponent;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class EditFieldService extends AbstractFieldService<EditFieldComponent, IEditFieldType> {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {States} from '../states.service';\nimport {StateService, TransitionService} from '@uirouter/core';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, OnInit, ViewChild} from \"@angular/core\";\nimport {QueryDmService} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {WorkPackageStaticQueriesService} from 'core-components/wp-query-select/wp-static-queries.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {LinkHandling} from \"core-app/modules/common/link-handling/link-handling\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {MainMenuToggleService} from \"core-components/main-menu/main-menu-toggle.service\";\nimport {MainMenuNavigationService} from \"core-components/main-menu/main-menu-navigation.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport type QueryCategory = 'starred'|'public'|'private'|'default';\n\nexport interface IAutocompleteItem {\n  // Some optional identifier\n  identifier?:string;\n  // Internal id for selecting items\n  auto_id?:number;\n  // The autocomplete item may be a static link (e.g., summary page)\n  static_link?:string;\n  // Label for the current locale\n  label:string;\n  // May be tied to a persisted query\n  query?:QueryResource;\n  // Or a loose map of query_props\n  query_props?:any;\n  // And is tied to a category\n  category?:QueryCategory;\n}\n\ninterface IQueryAutocompleteJQuery extends JQuery {\n  querycomplete(...args:any[]):void;\n}\n\nexport const wpQuerySelectSelector = 'wp-query-select';\n\n@Component({\n  selector: wpQuerySelectSelector,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './wp-query-select.template.html',\n})\nexport class WorkPackageQuerySelectDropdownComponent extends UntilDestroyedMixin implements OnInit {\n  @ViewChild('wpQueryMenuSearchInput', { static: true }) _wpQueryMenuSearchInput:ElementRef;\n  @ViewChild('queryResultsContainer', { static: true }) _queryResultsContainerElement:ElementRef;\n\n  public loading = false;\n  public noResults = false;\n\n  public text = {\n    search: this.I18n.t('js.toolbar.search_query_label'),\n    label: this.I18n.t('js.toolbar.search_query_label'),\n    scope_default: this.I18n.t('js.label_default_queries'),\n    scope_starred: this.I18n.t('js.label_starred_queries'),\n    scope_global: this.I18n.t('js.label_global_queries'),\n    scope_private: this.I18n.t('js.label_custom_queries'),\n    no_results: this.I18n.t('js.work_packages.query.text_no_results'),\n  };\n  private unregisterTransitionListener:Function;\n\n  private projectIdentifier:string|null;\n\n  private hiddenCategories:any = [];\n\n  private reportsBodySelector = '.controller-work_packages\\\\/reports';\n\n  private queryResultsContainer:JQuery;\n  private buttonArrowLeft:JQuery;\n\n  private searchInput:IQueryAutocompleteJQuery;\n\n  private initialized = false;\n\n\n  constructor(readonly ref:ChangeDetectorRef,\n              readonly element:ElementRef,\n              readonly QueryDm:QueryDmService,\n              readonly $state:StateService,\n              readonly $transitions:TransitionService,\n              readonly I18n:I18nService,\n              readonly states:States,\n              readonly CurrentProject:CurrentProjectService,\n              readonly loadingIndicator:LoadingIndicatorService,\n              readonly pathHelper:PathHelperService,\n              readonly wpStaticQueries:WorkPackageStaticQueriesService,\n              readonly mainMenuService:MainMenuNavigationService,\n              readonly toggleService:MainMenuToggleService,\n              readonly cdRef:ChangeDetectorRef) {\n    super();\n  }\n\n  public ngOnInit() {\n    this.queryResultsContainer = jQuery(this._queryResultsContainerElement.nativeElement);\n    this.projectIdentifier = this.element.nativeElement.getAttribute('data-project-identifier');\n\n    // When activating the work packages submenu,\n    // either initially or through click on the toggle, load the results\n    this.mainMenuService\n      .onActivate('work_packages', 'work_packages_query_select')\n      .subscribe(() => this.initializeAutocomplete());\n\n    // Register click handler on results\n    this.addClickHandler();\n    this.cdRef.detach();\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n    this.unregisterTransitionListener();\n  }\n\n  private initializeAutocomplete() {\n    if (this.initialized) {\n      return;\n    }\n\n    this.searchInput = jQuery(this._wpQueryMenuSearchInput.nativeElement) as any;\n    this.buttonArrowLeft = jQuery('.main-menu--arrow-left-to-project', jQuery('#main-menu-work-packages-wrapper').parent()) as any;\n    this.initialized = true;\n    this.buttonArrowLeft.focus();\n    this.setupAutoCompletion(this.searchInput);\n    this.updateMenuOnChanges();\n    this.loadQueries();\n  }\n\n  private transformQueries(collection:CollectionResource<QueryResource>) {\n    let loadedQueries:IAutocompleteItem[] = collection.elements\n      .map(query => {\n        return { label: query.name, query: query, query_props: null };\n      });\n\n    // Add to the loaded set of queries the fixed set of queries for the current project context\n    const combinedQueries = loadedQueries.concat(this.wpStaticQueries.all);\n    return this.sortQueries(combinedQueries);\n  }\n\n  // Filter the collection by categories, add the correct categories to every item of the filtered array\n  // Sort every category array alphabetically, except the default queries\n  private sortQueries(items:IAutocompleteItem[]):IAutocompleteItem[] {\n    // Concat all categories in the right order\n    let categorized:{ [category:string]:IAutocompleteItem[] } = {\n      // Starred / favored\n      starred: [],\n      // default\n      default: [],\n      // public\n      public: [],\n      // private\n      private: []\n    };\n\n    let auto_id = 0;\n    items.forEach((item):any => {\n      item.auto_id = auto_id++;\n\n      if (!item.query) {\n        item.category = 'default';\n        return categorized.default.push(item);\n      }\n\n      if (item.query.starred) {\n        item.category = 'starred';\n        return categorized.starred.push(item);\n      }\n\n      if (!item.query.starred && item.query.public) {\n        item.category = 'public';\n        return categorized.public.push(item);\n      }\n\n      if (!(item.query.starred || item.query.public)) {\n        item.category = 'private';\n        return categorized.private.push(item);\n      }\n    });\n\n    return _.flatten(\n      [categorized.starred, categorized.default, categorized.public, categorized.private]\n        .map(items => this.sortByLabel(items))\n    );\n  }\n\n  // Sort a given array of items by the value of their label attribute\n  private sortByLabel(items:IAutocompleteItem[]):IAutocompleteItem[] {\n    return items.sort((a, b) => a.label.toLowerCase().localeCompare(b.label.toLowerCase()));\n  }\n\n  private loadQueries() {\n    return this.loadingPromise = this.QueryDm\n      .listNonHidden(this.CurrentProject.identifier)\n      .then(collection => {\n\n        // Update the complete collection\n        this.searchInput.querycomplete(\"option\", { source: this.transformQueries(collection) });\n\n        // To visibly show the changes, we need to search again\n        this.searchInput.querycomplete(\"search\", this.searchInput.val());\n\n        // To search an empty string would expand all categories again every time\n        // Remember all previously hidden categories and set them again after updating the menu\n        _.each(this.hiddenCategories, category => {\n          let thisCategory:string = jQuery(category).attr(\"category\")!;\n          this.expandCollapseCategory(thisCategory);\n        });\n\n        // Update view\n        this.ref.detectChanges();\n      });\n  }\n\n  private set loadingPromise(promise:Promise<any>) {\n    this.loading = true;\n    promise\n      .then(() => {\n        this.loading = false;\n        this.cdRef.detectChanges();\n      })\n      .catch(() => {\n        this.loading = false;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  private setupAutoCompletion(input:IQueryAutocompleteJQuery) {\n    this.defineJQueryQueryComplete();\n\n    input.querycomplete({\n      delay: 100,\n      // The values are added later by the listener also covering\n      // the changes to queries (updateMenuOnChanges()).\n      source: [],\n      select: (ul:any, selected:{ item:IAutocompleteItem }) => {\n        return false; // Don't show title of selected query in the input field\n      },\n      response: (event:any, ui:any) => {\n        // Show the noResults span if we don't have any matches\n        this.noResults = (ui.content.length === 0);\n      },\n      close: (event:any, ui:any) => {\n        const autocompleteUi = this.queryResultsContainer.find('ul.ui-autocomplete');\n        if (!autocompleteUi.is(\":visible\") && !this.noResults) {\n          autocompleteUi.show();\n        }\n      },\n      focus: (_event:JQuery.TriggeredEvent, ui:{ item:IAutocompleteItem }) => {\n        let sourceEvent:any|null = _event;\n\n        while (sourceEvent && sourceEvent.originalEvent) {\n          sourceEvent = sourceEvent.originalEvent as any;\n        }\n\n        // Focus the given item, but only when we're using the keyboard.\n        // With the mouse, hover shall suffice to avoid weird focus/hover combinations\n        // e.g., https://community.openproject.com/wp/28197\n        if (sourceEvent && sourceEvent.type === 'keydown') {\n          this.queryResultsContainer\n            .find(`#wp-query-menu-item-${ui.item.auto_id} .wp-query-menu--item-link`)\n            .focus();\n        }\n\n        return false;\n      },\n      appendTo: '.wp-query-menu--results-container',\n      classes: {\n        'ui-autocomplete': 'wp-query-menu--search-ul -inplace',\n        'ui-menu-divider': 'wp-query-menu--category-icon'\n      },\n      autoFocus: false, // Don't automatically select first entry since we 'open' the autocomplete on page load\n      minLength: 0\n    });\n  }\n\n  private defineJQueryQueryComplete() {\n    let thisComponent = this;\n\n    jQuery.widget('custom.querycomplete', jQuery.ui.autocomplete, {\n      _create: function (this:any) {\n        this._super();\n        this.widget().menu('option', 'items', '.wp-query-menu--item');\n        this._search('');\n      },\n      _renderItem: function (this:{}, ul:any, item:IAutocompleteItem) {\n        const link = jQuery('<a>')\n          .addClass('wp-query-menu--item-link')\n          .attr('href', thisComponent.buildQueryItemUrl(item))\n          .text(item.label);\n\n        const li = jQuery('<li>')\n          .addClass(`ui-menu-item wp-query-menu--item`)\n          .attr('id', `wp-query-menu-item-${item.auto_id}`)\n          .attr('data-category', item.category || '')\n          .data('ui-autocomplete-item', item)  // Focus method of autocompleter needs this data for accessibility - if not set, it will throw errors\n          .append(link)\n          .appendTo(ul);\n\n        thisComponent.setInitialHighlighting(li, item);\n\n        return li;\n      },\n      _renderMenu: function (this:any, ul:any, items:IAutocompleteItem[]) {\n        let currentCategory:QueryCategory;\n\n        _.each(items, option => {\n          // Check if item has same category as previous item and if not insert a new category label in the list\n          if (option.category !== currentCategory) {\n            currentCategory = option.category!;\n            let label = thisComponent.labelFunction(currentCategory);\n\n            ul.append(`<a tabindex=\"0\" class=\"wp-query-menu--category-icon wp-query-menu--category-toggle\" data-category=\"${currentCategory}\" aria-hidden=\"true\"></a>`);\n            jQuery('<li>')\n              .addClass('ui-autocomplete--category wp-query-menu--category-toggle ellipsis')\n              .attr('title', label)\n              .attr('data-category', currentCategory)\n              .text(label)\n              .appendTo(ul);\n          }\n          this._renderItemData(ul, option);\n        });\n\n\n        // Scroll to selected element if search is empty\n        if (thisComponent.searchInput.val() === '') {\n          let selected = thisComponent.queryResultsContainer.find('.wp-query-menu--item.selected');\n          if (selected.length > 0) {\n            setTimeout(() => selected[0].scrollIntoView({ behavior: 'auto', block: 'center' }), 20);\n          }\n        }\n      }\n    });\n  }\n\n  // Set class 'selected' on initial rendering of the menu\n  // Case 1: Wp menu is opened from somewhere else in the project -> Compare query params with url params and highlight selected\n  // Case 2: Click on menu item 'Work Packages' (query 'All open' is opened on default) -> highlight 'All open'\n  private setInitialHighlighting(currentLi:JQuery, item:IAutocompleteItem) {\n    const params = this.getQueryParams(item);\n    const currentId = this.$state.params.query_id;\n    const currentProps = this.$state.params.query_props;\n    let onWorkPackagesPage:boolean = this.$state.includes('work-packages');\n    let onWorkPackagesReportPage:boolean = jQuery('body').hasClass('controller-work_packages/reports');\n\n    // When the current ID is selected\n    const currentIdSelected = params.query_id && (currentId || '').toString() === params.query_id.toString();\n\n    // Case1: Static query props\n    const matchesStaticQueryProps = !item.query && item.query_props && item.query_props === currentProps;\n\n    // Case2: We're on the All open menu item\n    const allOpen = onWorkPackagesPage && !currentId && !currentProps && item.identifier === 'all_open';\n\n    // Case3: We're on the static summary page\n    const onSummary = onWorkPackagesReportPage && item.identifier === 'summary';\n\n    if (currentIdSelected || matchesStaticQueryProps || allOpen || onSummary) {\n      currentLi.addClass('selected');\n    }\n  }\n\n  private labelFunction(category:QueryCategory):string {\n    switch (category) {\n      case 'starred':\n        return this.text.scope_starred;\n      case 'public':\n        return this.text.scope_global;\n      case 'private':\n        return this.text.scope_private;\n      case 'default':\n        return this.text.scope_default;\n      default:\n        return '';\n    }\n  }\n\n  // Listens on all changes of queries (via an observable in the service), e.g. delete, create, rename, toggle starred\n  // Update collection in autocompleter\n  // Search again for the current value in input field to update the menu without loosing the current search results\n  private updateMenuOnChanges() {\n    this.states.changes.queries\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => this.loadQueries());\n  }\n\n  private expandCollapseCategory(category:string) {\n    jQuery(`[data-category=\"${category}\"]`)\n      // Don't hide the categories themselves (Regression #28584)\n      .not('.ui-autocomplete--category')\n      .toggleClass('-hidden');\n    jQuery(`.wp-query-menu--category-icon[data-category=\"${category}\"]`).toggleClass('-collapsed');\n  }\n\n  // On click of a menu item, load requested query\n  private loadQuery(item:IAutocompleteItem) {\n    const params = this.getQueryParams(item);\n    const opts = { reload: true };\n\n    this.$state.go(\n      'work-packages.partitioned.list',\n      params,\n      opts\n    );\n\n    this.toggleService.closeWhenOnMobile();\n  }\n\n  private getQueryParams(item:IAutocompleteItem) {\n    let val:{ query_id:string|null, query_props:string|null, projects?:string, projectPath?:string } = {\n      query_id: item.query ? _.toString(item.query.id) : null,\n      query_props: item.query ? null : item.query_props,\n    };\n\n    if (this.projectIdentifier) {\n      val.projects = 'projects';\n      val.projectPath = this.projectIdentifier;\n    }\n\n    return val;\n  }\n\n  private buildQueryItemUrl(item:IAutocompleteItem):string {\n    // Static item (such as summary)\n    if (item.static_link) {\n      return item.static_link;\n    }\n\n    const params = this.getQueryParams(item);\n    return this.$state.href('work-packages.partitioned.list', params);\n  }\n\n  private highlightSelected(item:IAutocompleteItem) {\n    this.highlightBySelector(`#wp-query-menu-item-${item.auto_id}`);\n  }\n\n  private highlightBySelector(selector:string) {\n    // Remove old selection\n    this.queryResultsContainer.find(\".ui-menu-item\").removeClass('selected');\n    //Find selected element in DOM and highlight it\n    this.queryResultsContainer.find(selector).addClass('selected');\n  }\n\n  /**\n   * When clicking an item with meta keys,\n   * avoid its propagation.\n   *\n   */\n  private addClickHandler() {\n    this.queryResultsContainer\n      .on('click keydown', '.ui-menu-item a', (evt:JQuery.TriggeredEvent) => {\n        if (evt.type === 'keydown' && evt.which !== keyCodes.ENTER) {\n          return true;\n        }\n\n        // Find the item from the clicked element\n        const target = jQuery(evt.target);\n        const item:IAutocompleteItem = target\n          .closest('.wp-query-menu--item')\n          .data('ui-autocomplete-item');\n\n        // Either the link is clicked with a modifier, then always cancel any propagation\n        const clickedWithModifier = evt.type === 'click' && LinkHandling.isClickedWithModifier(evt);\n\n        // Or the item is only a static link, then cancel propagation\n        const isStatic = !!item.static_link;\n\n        if (clickedWithModifier || isStatic) {\n          evt.stopImmediatePropagation();\n\n          if (evt.type === 'keydown') {\n            window.location.href = target.attr('href')!;\n          }\n        } else {\n          // If neither clicked with modifier nor static\n          // Then prevent the default link handling and load the query\n          evt.preventDefault();\n          this.loadQuery(item);\n          this.highlightSelected(item);\n          return false;\n        }\n\n        return true;\n      })\n      .on('click keydown', '.wp-query-menu--category-toggle', (evt:JQuery.TriggeredEvent) => {\n        if (evt.type === 'keydown' && evt.which !== keyCodes.ENTER) {\n          return true;\n        }\n\n        const target = jQuery(evt.target);\n        const clickedCategory = target.data('category');\n\n        if (clickedCategory) {\n          this.expandCollapseCategory(clickedCategory);\n        }\n\n        // Remember all hidden catagories\n        this.hiddenCategories = this.queryResultsContainer.find(\".ui-autocomplete--category.hidden\");\n\n        evt.preventDefault();\n        return false;\n      });\n  }\n}\n","<div id=\"querySelectDropdown\" class=\"wp-query-menu--container\">\n  <div class=\"wp-query-menu--search-container\">\n    <div class=\"wp-query-menu--search-bar\">\n      <label for=\"query-title-filter\"\n             class=\"hidden-for-sighted\"\n             [textContent]=\"text.label\" ></label>\n      <input #wpQueryMenuSearchInput\n             type=\"text\"\n             class=\"wp-query-menu--search-input ui-autocomplete--input ellipsis\"\n             name=\"query-title-filter\"\n             id=\"query-title-filter\"\n             [attr.placeholder]=\"text.search\" />\n      <i class=\"icon-search wp-query-menu--search-icon\"></i>\n    </div>\n    <div #queryResultsContainer class=\"wp-query-menu--results-container\">\n      <p class=\"wp-query-menu--no-results-container\"\n         [hidden]=\"!noResults || loading\"\n         [textContent]=\"text.no_results\"></p>\n      <div class=\"loading-indicator -compact\" *ngIf=\"loading\">\n        <div class=\"block-1\"></div>\n        <div class=\"block-2\"></div>\n        <div class=\"block-3\"></div>\n        <div class=\"block-4\"></div>\n        <div class=\"block-5\"></div>\n      </div>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nexport const selectorTableSide = \".work-packages-tabletimeline--table-side\";\nexport const selectorTimelineSide = \".work-packages-tabletimeline--timeline-side\";\nconst jQueryScrollSyncEventNamespace = \".scroll-sync\";\nconst scrollStep = 15;\n\n\nfunction getXandYScrollDeltas(ev: WheelEvent): [number, number] {\n  let x = ev.deltaX;\n  let y = ev.deltaY;\n\n  if (ev.shiftKey) {\n    x = y;\n    y = 0;\n  }\n\n  return [x, y];\n}\n\nfunction getPlattformAgnosticScrollAmount(originalValue: number) {\n  if (originalValue === 0) {\n    return originalValue;\n  }\n\n  let delta = scrollStep;\n\n  // Browser-specific logic\n  // TODO\n\n  if (originalValue < 0) {\n    delta *= -1;\n  }\n  return delta;\n}\n\nfunction syncWheelEvent(jev: JQuery.TriggeredEvent, elementTable: JQuery, elementTimeline: JQuery) {\n  const scrollTarget = jev.target;\n  const ev: WheelEvent = jev.originalEvent as any;\n  let [deltaX, deltaY] = getXandYScrollDeltas(ev);\n\n  if (deltaY === 0) {\n    return;\n  }\n\n  deltaX = getPlattformAgnosticScrollAmount(deltaX); // apply only in target div\n  deltaY = getPlattformAgnosticScrollAmount(deltaY); // apply in both divs\n\n  window.requestAnimationFrame(function () {\n    elementTable[0].scrollTop = elementTable[0].scrollTop + deltaY;\n    elementTimeline[0].scrollTop = elementTimeline[0].scrollTop + deltaY;\n\n    scrollTarget.scrollLeft = scrollTarget.scrollLeft + deltaX;\n  });\n}\n\n/**\n * Activate or deactivate the scroll-sync between the table and timeline view.\n *\n * @param $element true if the timeline is visible, false otherwise.\n */\nexport function createScrollSync($element:JQuery) {\n\n  var elTable = jQuery($element).find(selectorTableSide);\n  var elTimeline = jQuery($element).find(selectorTimelineSide);\n\n  return (timelineVisible: boolean) => {\n\n    // state vars\n    var syncedLeft = false;\n    var syncedRight = false;\n\n    if (timelineVisible) {\n      // setup event listener for table\n      elTable.on(\"wheel\" + jQueryScrollSyncEventNamespace, (jev: JQuery.TriggeredEvent) => {\n        syncWheelEvent(jev, elTable, elTimeline);\n      });\n      elTable.on(\"scroll\" + jQueryScrollSyncEventNamespace, (ev: JQuery.TriggeredEvent) => {\n        syncedLeft = true;\n        if (!syncedRight) {\n          elTimeline[0].scrollTop = ev.target.scrollTop;\n        }\n        if (syncedLeft && syncedRight) {\n          syncedLeft = false;\n          syncedRight = false;\n        }\n      });\n\n      // setup event listener for timeline\n      elTimeline.on(\"wheel\" + jQueryScrollSyncEventNamespace, (jev: JQuery.TriggeredEvent) => {\n        syncWheelEvent(jev, elTable, elTimeline);\n      });\n      elTimeline.on(\"scroll\" + jQueryScrollSyncEventNamespace, (ev: JQuery.TriggeredEvent) => {\n        syncedRight = true;\n        if (!syncedLeft) {\n          elTable[0].scrollTop = ev.target.scrollTop;\n        }\n        if (syncedLeft && syncedRight) {\n          syncedLeft = false;\n          syncedRight = false;\n        }\n      });\n    } else {\n      elTable.off(jQueryScrollSyncEventNamespace);\n    }\n  };\n\n}\n","<li class=\"form--selected-value--container work-package--attachments--draggable-item\"\n    focus-within\n    draggable=\"true\"\n    (dragstart)=\"setDragData($event)\"\n    [title]=\"text.dragHint\"\n    focusWithinSelector=\".inplace-editing--trigger-icon\">\n  <span class=\"form--selected-value\">\n    <op-icon icon-classes=\"icon-context icon-attachment\"></op-icon>\n    <a\n        class=\"work-package--attachments--filename\"\n        target=\"_blank\"\n        rel=\"noopener\"\n        [attr.href]=\"downloadPath || '#'\">\n\n      {{ attachment.fileName || attachment.customName || attachment.name }}\n\n      <authoring class=\"work-package--attachments--info\"\n                 [createdOn]=\"attachment.createdAt\"\n                 [author]=\"attachment.author\"\n                 [showAuthorAsLink]=\"false\"></authoring>\n    </a>\n  </span>\n  <a\n      href=\"\"\n      class=\"form--selected-value--remover work-package--atachments--delete-button\"\n      *ngIf=\"!!attachment.$links.delete\"\n      (click)=\"confirmRemoveAttachment($event)\">\n    <op-icon icon-classes=\"icon-delete\"\n             [icon-title]=\"text.removeFile({fileName: attachment.fileName})\"></op-icon>\n  </a>\n\n  <input type=\"hidden\" name=\"attachments[{{index}}][id]\" value=\"{{attachment.id}}\">\n</li>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, EventEmitter, Input, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {States} from 'core-components/states.service';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\n\n@Component({\n  selector: 'attachment-list-item',\n  templateUrl: './attachment-list-item.html'\n})\nexport class AttachmentListItemComponent {\n  @Input() public resource:HalResource;\n  @Input() public attachment:any;\n  @Input() public index:any;\n  @Input() destroyImmediately:boolean = true;\n\n  @Output() public removeAttachment = new EventEmitter<void>();\n\n  static imageFileExtensions:string[] = ['jpeg', 'jpg', 'gif', 'bmp', 'png'];\n\n  public text = {\n    dragHint: this.I18n.t('js.attachments.draggable_hint'),\n    destroyConfirmation: this.I18n.t('js.text_attachment_destroy_confirmation'),\n    removeFile: (arg:any) => this.I18n.t('js.label_remove_file', arg)\n  };\n\n  constructor(protected halNotification:HalResourceNotificationService,\n              readonly I18n:I18nService,\n              readonly states:States,\n              readonly pathHelper:PathHelperService) {\n  }\n\n  /**\n   * Set the appropriate data for drag & drop of an attachment item.\n   * @param evt DragEvent\n   */\n  public setDragData(evt:DragEvent) {\n    const url = this.downloadPath;\n    const previewElement = this.draggableHTML(url);\n\n    evt.dataTransfer!.setData(\"text/plain\", url);\n    evt.dataTransfer!.setData(\"text/html\", previewElement.outerHTML);\n    evt.dataTransfer!.setData(\"text/uri-list\", url);\n    evt.dataTransfer!.setDragImage(previewElement, 0, 0);\n  }\n\n  public draggableHTML(url:string) {\n    let el:HTMLImageElement|HTMLAnchorElement;\n\n    if (this.isImage) {\n      el = document.createElement('img') as HTMLImageElement;\n      el.src = url;\n      el.textContent = this.fileName;\n    } else {\n      el = document.createElement('a') as HTMLAnchorElement;\n      el.href = url;\n      el.textContent = this.fileName;\n    }\n\n    return el;\n  }\n\n  public get downloadPath() {\n    return this.pathHelper.attachmentDownloadPath(this.attachment.id, this.fileName);\n  }\n\n  public get isImage() {\n    const ext = this.fileName.split('.').pop() || '';\n    return AttachmentListItemComponent.imageFileExtensions.indexOf(ext.toLowerCase()) > -1;\n  }\n\n  public get fileName() {\n    const a = this.attachment;\n    return a.fileName || a.customName || a.name;\n  }\n\n  public confirmRemoveAttachment($event:JQuery.TriggeredEvent) {\n    if (!window.confirm(this.text.destroyConfirmation)) {\n      $event.stopImmediatePropagation();\n      $event.preventDefault();\n      return false;\n    }\n\n    this.removeAttachment.emit();\n\n    if (this.destroyImmediately) {\n      this\n        .resource\n        .removeAttachment(this.attachment);\n    }\n\n    return false;\n  }\n}\n","<div class=\"work-package--attachments--files\" *ngIf=\"resource\">\n  <ul class=\"form--selected-value--list\"\n      *ngFor=\"let attachment of attachments; trackBy:trackByHref; let i = index;\">\n    <attachment-list-item [attachment]=\"attachment\"\n                          [resource]=\"resource\"\n                          [index]=\"i\"\n                          [destroyImmediately]=\"destroyImmediately\"\n                          (removeAttachment)=\"removeAttachment(attachment)\">\n    </attachment-list-item>\n  </ul>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectorRef, Component, ElementRef, Input, OnInit} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {filter} from \"rxjs/operators\";\nimport {States} from \"core-components/states.service\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'attachment-list',\n  templateUrl: './attachment-list.html'\n})\nexport class AttachmentListComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public resource:HalResource;\n  @Input() public destroyImmediately:boolean = true;\n\n  trackByHref = AngularTrackingHelpers.trackByHref;\n\n  attachments:HalResource[] = [];\n  deletedAttachments:HalResource[] = [];\n\n  public $element:JQuery;\n  public $formElement:JQuery;\n\n  constructor(protected elementRef:ElementRef,\n              protected states:States,\n              protected cdRef:ChangeDetectorRef,\n              protected halResourceService:HalResourceService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.updateAttachments();\n    this.setupResourceUpdateListener();\n\n    if (!this.destroyImmediately) {\n      this.setupAttachmentDeletionCallback();\n    }\n  }\n\n  public setupResourceUpdateListener() {\n    this.states.forResource(this.resource)!\n      .values$()\n      .pipe(\n        this.untilDestroyed(),\n        filter(newResource => !!newResource)\n      )\n      .subscribe((newResource:HalResource) => {\n        this.resource = newResource || this.resource;\n\n        this.updateAttachments();\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy():void {\n    super.ngOnDestroy();\n    if (!this.destroyImmediately) {\n      this.$formElement.off('submit.attachment-component');\n    }\n  }\n\n  public removeAttachment(attachment:HalResource) {\n    this.deletedAttachments.push(attachment);\n    // Keep the same object as we would otherwise loose the connection to the\n    // resource's attachments array. That way, attachments added after removing one would not be displayed.\n    // This is bad design.\n    let newAttachments = this.attachments.filter((el) => el !== attachment);\n    this.attachments.length = 0;\n    this.attachments.push(...newAttachments);\n\n    this.cdRef.detectChanges();\n  }\n\n  private get attachmentsUpdatable() {\n    return (this.resource.attachments && this.resource.attachmentsBackend);\n  }\n\n  public setupAttachmentDeletionCallback() {\n    this.$formElement = this.$element.closest('form');\n    this.$formElement.on('submit.attachment-component', () => {\n      this.destroyRemovedAttachments();\n    });\n  }\n\n  private destroyRemovedAttachments() {\n    this.deletedAttachments.forEach((attachment) => {\n      this\n        .resource\n        .removeAttachment(attachment);\n    });\n  }\n\n  private updateAttachments() {\n    if (!this.attachmentsUpdatable) {\n      this.attachments = this.resource.attachments.elements;\n      return;\n    }\n\n    this\n      .resource\n      .attachments\n      .updateElements()\n      .then(() => {\n        this.attachments = this.resource.attachments.elements;\n        this.cdRef.detectChanges();\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HighlightableDisplayField extends DisplayField {\n\n  /** Optionally test if we can inject highlighting service */\n  @InjectField(WorkPackageViewHighlightingService, null) viewHighlighting:WorkPackageViewHighlightingService;\n\n  public get shouldHighlight() {\n    if (this.context.options.colorize === false) {\n      return false;\n    }\n\n    const shouldHighlight = !!this.viewHighlighting && this.viewHighlighting.shouldHighlightInline(this.name);\n    return this.context.container !== 'table' || shouldHighlight;\n  }\n}\n","import {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {WorkPackageRelationsService} from '../wp-relations.service';\nimport {Component, Input} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  selector: 'wp-relations-create',\n  templateUrl: './wp-relation-create.template.html'\n})\nexport class WorkPackageRelationsCreateComponent {\n  @Input() readonly workPackage:WorkPackageResource;\n\n  public showRelationsCreateForm:boolean = false;\n  public selectedRelationType:string = RelationResource.DEFAULT();\n  public selectedWpId:string;\n  public relationTypes = RelationResource.LOCALIZED_RELATION_TYPES(false);\n\n  public isDisabled = false;\n\n  public text = {\n    abort: this.I18n.t('js.relation_buttons.abort'),\n    relationType: this.I18n.t('js.relation_buttons.relation_type'),\n    addNewRelation: this.I18n.t('js.relation_buttons.add_new_relation')\n  };\n\n  constructor(readonly I18n:I18nService,\n              protected wpRelations:WorkPackageRelationsService,\n              protected notificationService:WorkPackageNotificationService,\n              protected halEvents:HalEventsService,\n              protected wpCacheService:WorkPackageCacheService) {\n  }\n\n\n  public createRelation() {\n\n    if (!this.selectedRelationType || !this.selectedWpId) {\n      return;\n    }\n\n    this.isDisabled = true;\n    this.createCommonRelation()\n      .catch(() => this.isDisabled = false)\n      .then(() => this.isDisabled = false);\n  }\n\n  public onSelected(workPackage?:WorkPackageResource) {\n    if (workPackage) {\n      this.selectedWpId = workPackage.id!;\n      this.createCommonRelation();\n    }\n  }\n\n  protected createCommonRelation() {\n    return this.wpRelations.addCommonRelation(this.workPackage.id!,\n      this.selectedRelationType,\n      this.selectedWpId)\n      .then(relation => {\n        this.halEvents.push(this.workPackage, {\n          eventType: 'association',\n          relatedWorkPackage: relation.id!,\n          relationType: this.selectedRelationType\n        });\n        this.notificationService.showSave(this.workPackage);\n        this.toggleRelationsCreateForm();\n      })\n      .catch(err => {\n        this.notificationService.handleRawError(err, this.workPackage);\n        this.toggleRelationsCreateForm();\n      });\n  }\n\n  public toggleRelationsCreateForm() {\n    this.showRelationsCreateForm = !this.showRelationsCreateForm;\n    // Reset value\n    this.selectedWpId = '';\n  }\n}\n","<div class=\"wp-relations-create\">\n  <div class=\"wp-relations-create-button hide-when-print\"\n       *ngIf=\"!showRelationsCreateForm\">\n    <div class=\"grid-block\">\n      <div class=\"grid-content collapse wp-inline-create-button\">\n        <a class=\"wp-inline-create--add-link relation-create\"\n           autoFocus\n           (accessibleClick)=\"toggleRelationsCreateForm()\"\n           href\n           id=\"relation--add-relation\">\n          <op-icon icon-classes=\"icon icon-add\"></op-icon>\n          <span [textContent]=\"text.addNewRelation\"></span>\n        </a>\n      </div>\n    </div>\n  </div>\n  <div class=\"loading-indicator--location\"\n       data-indicator-name=\"relationAddDynamic\">\n    <div class=\"v-align wp-relations-create--form\"\n         *ngIf=\"showRelationsCreateForm\">\n      <div class=\"grid-content collapse medium-3\">\n        <label class=\"hidden-for-sighted\"\n               for=\"relation-type--select\"\n               [textContent]=\"text.relationType\"></label>\n        <select class=\"form--select relationTypeSelect\"\n                id=\"relation-type--select\"\n                role=\"listbox\"\n                [(ngModel)]=\"selectedRelationType\"\n                focus>\n          <option *ngFor=\"let type of relationTypes\"\n                  [textContent]=\"type.label\"\n                  [value]=\"type.name\"></option>\n        </select>\n      </div>\n      <div class=\"grid-content medium-8\">\n        <wp-relations-autocomplete\n            [workPackage]=\"workPackage\"\n            (onSelected)=\"onSelected($event)\"\n            (onCancel)=\"toggleRelationsCreateForm()\"\n            [hiddenOverflowContainer]=\"'.work-packages-tab-view--overflow'\"\n            [selectedRelationType]=\"selectedRelationType\">\n        </wp-relations-autocomplete>\n      </div>\n      <div class=\"grid-content medium-1 collapse wp-relations-controls-section relation-row\">\n        <accessible-by-keyboard\n            (execute)=\"toggleRelationsCreateForm()\"\n            linkClass=\"wp-create-relation--cancel\"\n            aria-hidden=\"false\">\n          <op-icon icon-classes=\"icon-remove -padded\" [icon-title]=\"text.abort\"></op-icon>\n        </accessible-by-keyboard>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, OnInit, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {Moment} from 'moment';\nimport {AbstractDateTimeValueController} from '../abstract-filter-date-time-value/abstract-filter-date-time-value.controller';\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'filter-date-time-value',\n  templateUrl: './filter-date-time-value.component.html'\n})\nexport class FilterDateTimeValueComponent extends AbstractDateTimeValueController implements OnInit {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new DebouncedEventEmitter<QueryFilterInstanceResource>(componentDestroyed(this));\n\n  constructor(readonly I18n:I18nService,\n              readonly timezoneService:TimezoneService) {\n    super(I18n, timezoneService);\n  }\n\n  public get value():HalResource|string {\n    return this.filter.values[0];\n  }\n\n  public get valueString() {\n    return this.filter.values[0].toString();\n  }\n\n  public set value(val) {\n    this.filter.values = [val as string];\n    this.filterChanged.emit(this.filter);\n  }\n\n  public get lowerBoundary():Moment|null {\n    if (this.value && this.timezoneService.isValidISODateTime(this.valueString)) {\n      return this.timezoneService.parseDatetime(this.valueString);\n    }\n\n    return null;\n  }\n\n  public get upperBoundary():Moment|null {\n    if (this.value && this.timezoneService.isValidISODateTime(this.valueString)) {\n      return this.timezoneService.parseDatetime(this.valueString).add(24, 'hours');\n    }\n\n    return null;\n  }\n}\n","<div class=\"inline-label\" id=\"div-values-{{filter.id}}\">\n  <op-date-picker (onChange)=\"value = isoDateParser($event)\"\n                  [initialDate]=\"isoDateFormatter(value)\"\n                  [focus]=\"shouldFocus\"\n                  required=\"true\"\n                  [id]=\"'values-' + filter.id\"\n                  [name]=\"'v[' + filter.id + ']'\"\n                  classes=\"advanced-filters--date-field\"\n                  size=\"10\">\n  </op-date-picker>\n  <span class=\"advanced-filters--tooltip-trigger -multiline\"\n        [attr.data-tooltip]=\"timeZoneText\"\n        *ngIf=\"isTimeZoneDifferent\">\n    <op-icon icon-classes=\"icon icon-warning\"></op-icon>\n  </span>\n</div>\n","import {Injector} from '@angular/core';\nimport {CardEventHandler} from \"core-components/wp-card-view/event-handler/card-view-handler-registry\";\nimport {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageViewFocusService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service\";\nimport {WorkPackageCardViewService} from \"core-components/wp-card-view/services/wp-card-view.service\";\nimport {StateService} from \"@uirouter/core\";\nimport {DeviceService} from \"core-app/modules/common/browser/device.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class CardClickHandler implements CardEventHandler {\n\n  // Injections\n  @InjectField() deviceService:DeviceService;\n  @InjectField() $state:StateService;\n  @InjectField() wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() wpTableFocus:WorkPackageViewFocusService;\n  @InjectField() wpCardView:WorkPackageCardViewService;\n\n  constructor(public readonly injector:Injector,\n              card:WorkPackageCardViewComponent) {\n  }\n\n  public get EVENT() {\n    return 'click.cardView.card';\n  }\n\n  public get SELECTOR() {\n    return `.wp-card`;\n  }\n\n  public eventScope(card:WorkPackageCardViewComponent) {\n    return jQuery(card.container.nativeElement);\n  }\n\n  public handleEvent(card:WorkPackageCardViewComponent, evt:JQuery.TriggeredEvent) {\n    let target = jQuery(evt.target);\n\n    // Ignore links\n    if (target.is('a') || target.parent().is('a')) {\n      return true;\n    }\n\n    // Locate the card from event\n    let element = target.closest('wp-single-card');\n    let wpId = element.data('workPackageId');\n\n    if (!wpId) {\n      return true;\n    }\n\n    this.handleWorkPackage(wpId, element, evt);\n\n    return false;\n  }\n\n\n  protected handleWorkPackage(wpId:any, element:JQuery, evt:JQuery.TriggeredEvent) {\n    this.setSelection(wpId, element, evt);\n\n    // open work package on mobile after first click\n    this.openFullViewOnMobile(wpId);\n  }\n\n  protected openFullViewOnMobile(wpId:string) {\n    if (this.deviceService.isMobile) {\n      this.$state.go(\n        'work-packages.show',\n        {workPackageId: wpId}\n      );\n    }\n  }\n\n  protected setSelection(wpId:string, element:JQuery, evt:JQuery.TriggeredEvent) {\n    let classIdentifier = element.data('classIdentifier');\n    let index = this.wpCardView.findRenderedCard(classIdentifier);\n\n    // Update single selection if no modifier present\n    if (!(evt.ctrlKey || evt.metaKey || evt.shiftKey)) {\n      this.wpTableSelection.setSelection(wpId, index);\n    }\n\n    // Multiple selection if shift present\n    if (evt.shiftKey) {\n      this.wpTableSelection.setMultiSelectionFrom(this.wpCardView.renderedCards, wpId, index);\n    }\n\n    // Single selection expansion if ctrl / cmd(mac)\n    if (evt.ctrlKey || evt.metaKey) {\n      this.wpTableSelection.toggleRow(wpId);\n    }\n\n    // The current card is the last selected work package\n    // not matter what other card are (de-)selected below.\n    // Thus save that card for the details view button.\n    this.wpTableFocus.updateFocus(wpId);\n  }\n\n}\n","import {Injector} from '@angular/core';\nimport {tdClassName} from './cell-builder';\nimport {OpTableActionsService} from 'core-components/wp-table/table-actions/table-actions.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {contextMenuSpanClassName, contextMenuTdClassName} from \"core-components/wp-table/table-actions/table-action\";\nimport {internalContextMenuColumn} from \"core-components/wp-fast-table/builders/internal-sort-columns\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class TableActionRenderer {\n\n  // Injections\n  @InjectField() tableActionsService:OpTableActionsService;\n\n  constructor(public readonly injector:Injector) {\n  }\n\n  public build(workPackage:WorkPackageResource):HTMLElement {\n    // Append details button\n    let td = document.createElement('td');\n    td.classList.add(tdClassName, contextMenuTdClassName, internalContextMenuColumn.id, 'hide-when-print');\n\n    // Wrap any actions in a span\n    let span = document.createElement('span');\n    span.classList.add(contextMenuSpanClassName);\n\n    this.tableActionsService\n      .render(workPackage)\n      .forEach((el:HTMLElement) => {\n        span.appendChild(el);\n      });\n\n    td.appendChild(span);\n    return td;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {locateTableRowByIdentifier} from 'core-components/wp-fast-table/helpers/wp-table-row-helpers';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {isRelationColumn, QueryColumn} from '../../../wp-query/query-column';\nimport {WorkPackageViewColumnsService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {CellBuilder, tdClassName} from '../cell-builder';\nimport {RelationCellbuilder} from '../relation-cell-builder';\nimport {checkedClassName} from '../ui-state-link-builder';\nimport {TableActionRenderer} from 'core-components/wp-fast-table/builders/table-action-renderer';\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {\n  internalContextMenuColumn,\n  internalSortColumn\n} from \"core-components/wp-fast-table/builders/internal-sort-columns\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n// Work package table row entries\nexport const tableRowClassName = 'wp-table--row';\n// Work package and timeline rows\nexport const commonRowClassName = 'wp--row';\n\nexport class SingleRowBuilder {\n\n  // Injections\n  @InjectField() wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() I18n:I18nService;\n\n  // Cell builder instance\n  protected cellBuilder = new CellBuilder(this.injector);\n  // Relation cell builder instance\n  protected relationCellBuilder = new RelationCellbuilder(this.injector);\n\n  // Details Link builder\n  protected contextLinkBuilder = new TableActionRenderer(this.injector);\n\n  // Build the augmented columns set to render with\n  protected readonly augmentedColumns:QueryColumn[] = this.buildAugmentedColumns();\n\n  constructor(public readonly injector:Injector,\n              protected workPackageTable:WorkPackageTable) {\n  }\n\n  /**\n   * Returns the current set of columns\n   */\n  public get columns():QueryColumn[] {\n    return this.wpTableColumns.getColumns();\n  }\n\n  /**\n   * Returns the current set of columns, augmented by the internal columns\n   * we add for buttons and timeline.\n   */\n  private buildAugmentedColumns():QueryColumn[] {\n    let columns = [...this.columns, internalContextMenuColumn];\n\n    if (this.workPackageTable.configuration.dragAndDropEnabled) {\n      columns.unshift(internalSortColumn);\n    }\n\n    return columns;\n  }\n\n  public buildCell(workPackage:WorkPackageResource, column:QueryColumn):HTMLElement|null {\n    // handle relation types\n    if (isRelationColumn(column)) {\n      return this.relationCellBuilder.build(workPackage, column);\n    }\n\n    // Handle property types\n    switch (column.id) {\n      case internalContextMenuColumn.id:\n        if (this.workPackageTable.configuration.actionsColumnEnabled) {\n          return this.contextLinkBuilder.build(workPackage);\n        } else if (this.workPackageTable.configuration.columnMenuEnabled) {\n          let td = document.createElement('td');\n          td.classList.add('hide-when-print');\n          return td;\n        } else {\n          return null;\n        }\n      default:\n        return this.cellBuilder.build(workPackage, column);\n    }\n  }\n\n  /**\n   * Build the columns on the given empty row\n   */\n  public buildEmpty(workPackage:WorkPackageResource):[HTMLTableRowElement, boolean] {\n    let row = this.createEmptyRow(workPackage);\n    return this.buildEmptyRow(workPackage, row);\n  }\n\n  /**\n   * Create an empty unattached row element for the given work package\n   * @param workPackage\n   * @returns {any}\n   */\n  public createEmptyRow(workPackage:WorkPackageResource) {\n    const identifier = this.classIdentifier(workPackage);\n    let tr = document.createElement('tr');\n    tr.setAttribute('tabindex', '0');\n    tr.dataset['workPackageId'] = workPackage.id!;\n    tr.dataset['classIdentifier'] = identifier;\n    tr.classList.add(\n      tableRowClassName,\n      commonRowClassName,\n      identifier,\n      `${identifier}-table`,\n      'issue'\n    );\n\n    return tr;\n  }\n\n  /**\n   * In case the table will end up empty, we insert a placeholder\n   * row to provide some space within the tbody.\n   */\n  public get placeholderRow() {\n    const tr:HTMLTableRowElement = document.createElement('tr');\n    const td:HTMLTableCellElement = document.createElement('td');\n\n    tr.classList.add('wp--placeholder-row');\n    td.colSpan = this.augmentedColumns.length;\n    tr.appendChild(td);\n\n    return tr;\n  }\n\n  public classIdentifier(workPackage:WorkPackageResource) {\n    return `wp-row-${workPackage.id}`;\n  }\n\n  /**\n   * Refresh a row that is currently being edited, that is, some edit fields may be open\n   */\n  public refreshRow(workPackage:WorkPackageResource, jRow:JQuery):JQuery {\n    // Detach all current edit cells\n    const cells = jRow.find(`.${tdClassName}`).detach();\n\n    // Remember the order of all new edit cells\n    const newCells:HTMLElement[] = [];\n\n    this.augmentedColumns.forEach((column:QueryColumn) => {\n      const oldTd = cells.filter(`td.${column.id}`);\n\n      // Treat internal columns specially\n      // and skip the replacement of the column if this is being edited.\n      if (column.id.startsWith('__internal') || this.isColumnBeingEdited(workPackage, column)) {\n        newCells.push(oldTd[0]);\n        return;\n      }\n\n      // Otherwise, refresh that cell and append it\n      const cell = this.buildCell(workPackage, column);\n\n      if (cell) {\n        newCells.push(cell);\n      }\n    });\n\n    jRow.prepend(newCells);\n    return jRow;\n  }\n\n  protected isColumnBeingEdited(workPackage:WorkPackageResource, column:QueryColumn) {\n    const form = this.workPackageTable.editing.forms[workPackage.id!];\n\n    return form && form.activeFields[column.id];\n  }\n\n  protected buildEmptyRow(workPackage:WorkPackageResource, row:HTMLTableRowElement):[HTMLTableRowElement, boolean] {\n    const change = this.workPackageTable.editing.change(workPackage);\n    let cells:{ [attribute:string]:JQuery } = {};\n\n    if (change && !change.isEmpty()) {\n      // Try to find an old instance of this row\n      const oldRow = locateTableRowByIdentifier(this.classIdentifier(workPackage));\n\n      change.changedAttributes.forEach((attribute:string) => {\n        cells[attribute] = oldRow.find(`.${tdClassName}.${attribute}`);\n      });\n    }\n\n    this.augmentedColumns.forEach((column:QueryColumn) => {\n      let cell:Element|null;\n      let oldCell:JQuery|undefined = cells[column.id];\n\n      if (oldCell && oldCell.length) {\n        debugLog(`Rendering previous open column ${column.id} on ${workPackage.id}`);\n        jQuery(row).append(oldCell);\n      } else {\n        cell = this.buildCell(workPackage, column);\n\n        if (cell) {\n          row.appendChild(cell);\n        }\n      }\n    });\n\n    // Set the row selection state\n    if (this.wpTableSelection.isSelected(workPackage.id!)) {\n      row.classList.add(checkedClassName);\n    }\n\n    return [row, false];\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {States} from '../states.service';\nimport {\n  commonRowClassName,\n  SingleRowBuilder,\n  tableRowClassName\n} from '../wp-fast-table/builders/rows/single-row-builder';\nimport {rowId} from '../wp-fast-table/helpers/wp-table-row-helpers';\nimport {WorkPackageTable} from '../wp-fast-table/wp-fast-table';\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {QueryColumn} from \"core-components/wp-query/query-column\";\nimport {tdClassName} from \"core-components/wp-fast-table/builders/cell-builder\";\nimport {internalContextMenuColumn} from \"core-components/wp-fast-table/builders/internal-sort-columns\";\nimport {EditForm} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const inlineCreateRowClassName = 'wp-inline-create-row';\nexport const inlineCreateCancelClassName = 'wp-table--cancel-create-link';\n\nexport class InlineCreateRowBuilder extends SingleRowBuilder {\n\n  // Injections\n  @InjectField() public states:States;\n  @InjectField() public wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() public wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() public I18n:I18nService;\n\n  protected text:{ cancelButton:string };\n\n  constructor(public readonly injector:Injector,\n              workPackageTable:WorkPackageTable) {\n\n    super(injector, workPackageTable);\n\n    this.text = {\n      cancelButton: this.I18n.t('js.button_cancel')\n    };\n  }\n\n  public buildCell(workPackage:WorkPackageResource, column:QueryColumn):HTMLElement|null {\n    switch (column.id) {\n      case internalContextMenuColumn.id:\n        return this.buildCancelButton();\n      default:\n        return super.buildCell(workPackage, column);\n    }\n  }\n\n  public buildNew(workPackage:WorkPackageResource, form:EditForm):[HTMLElement, boolean] {\n    // Get any existing edit state for this work package\n    const [row, hidden] = this.buildEmpty(workPackage);\n\n\n    return [row, hidden];\n  }\n\n  /**\n   * Create an empty unattached row element for the given work package\n   * @param workPackage\n   * @returns {any}\n   */\n  public createEmptyRow(workPackage:WorkPackageResource) {\n    const identifier = this.classIdentifier(workPackage);\n    const tr = document.createElement('tr');\n    tr.id = rowId(workPackage.id!);\n    tr.dataset['workPackageId'] = workPackage.id!;\n    tr.dataset['classIdentifier'] = identifier;\n    tr.classList.add(\n      inlineCreateRowClassName, commonRowClassName, tableRowClassName, 'issue',\n      identifier,\n      `${identifier}-table`\n    );\n\n    return tr;\n  }\n\n  protected buildCancelButton() {\n    const td = document.createElement('td');\n    td.classList.add(tdClassName, 'wp-table--cancel-create-td');\n\n    td.innerHTML = `\n    <a\n       href=\"#\"\n       class=\"${inlineCreateCancelClassName} icon icon-cancel\"\n       aria-label=\"${this.text.cancelButton}\">\n    </a>\n   `;\n\n    return td;\n  }\n}\n","<ng-container *ngIf=\"canAdd || canReference\">\n  <tr *ngIf=\"mode === 'inactive'\"\n      class=\"wp-inline-create-button-row hide-when-print\">\n    <td [attr.colspan]=\"colspan\"\n        class=\"wp-inline-create-button-td -no-highlighting\">\n      <div class=\"wp-inline-create-button\">\n        <a class=\"wp-inline-create--add-link\"\n                href\n                role=\"link\"\n                [focus]=\"focus\"\n                *ngIf=\"canAdd\"\n                [ngClass]=\"{'wp-inline-create--split-link': hasReferenceClass }\"\n                (accessibleClick)=\"handleAddRowClick()\"\n                [attr.disabled]=\"!isAllowed || undefined\"\n                [attr.aria-label]=\"text.create\"\n                aria-haspopup=\"true\">\n          <op-icon icon-classes=\"icon icon-add\"></op-icon>\n          <span [textContent]=\"text.create\"></span>\n        </a>\n        <ng-container *ngIf=\"canReference\">\n          <a class=\"wp-inline-create--reference-link wp-inline-create--split-link\"\n             href\n             role=\"link\"\n             (accessibleClick)=\"handleReferenceClick()\"\n             [attr.disabled]=\"!isAllowed || undefined\"\n             [attr.aria-label]=\"text.create\"\n             aria-haspopup=\"true\">\n            <op-icon icon-classes=\"icon icon-link\"></op-icon>\n            <span [textContent]=\"text.reference\"></span>\n          </a>\n        </ng-container>\n      </div>\n    </td>\n  </tr>\n  <tr *ngIf=\"hasReferenceClass && mode === 'reference'\"\n      class=\"wp-inline-create-button-row hide-when-print\">\n    <td [attr.colspan]=\"colspan\"\n        class=\"wp-inline-reference-row-td -no-highlighting\">\n      <ng-container *ngComponentOutlet=\"referenceClass; injector: injector\"></ng-container>\n    </td>\n  </tr>\n</ng-container>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostListener,\n  Injector,\n  Input,\n  OnInit\n} from '@angular/core';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {filter} from 'rxjs/operators';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {onClickOrEnter} from '../wp-fast-table/handlers/click-or-enter-handler';\nimport {WorkPackageTable} from '../wp-fast-table/wp-fast-table';\nimport {WorkPackageCreateService} from '../wp-new/wp-create.service';\nimport {\n  inlineCreateCancelClassName,\n  InlineCreateRowBuilder,\n  inlineCreateRowClassName\n} from './inline-create-row-builder';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {FocusHelperService} from 'core-app/modules/common/focus/focus-helper';\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {Subscription} from 'rxjs';\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {EditForm} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: '[wpInlineCreate]',\n  templateUrl: './wp-inline-create.component.html'\n})\nexport class WorkPackageInlineCreateComponent extends UntilDestroyedMixin implements OnInit, AfterViewInit {\n\n  @Input('wp-inline-create--table') table:WorkPackageTable;\n  @Input('wp-inline-create--project-identifier') projectIdentifier:string;\n\n  // inner state\n  public canAdd:boolean = false;\n  public canReference:boolean = false;\n\n  // Inline create / reference row is active\n  public mode:'inactive'|'create'|'reference' = 'inactive';\n\n  public focus:boolean = false;\n\n  public text = this.wpInlineCreate.buttonTexts;\n\n  private currentWorkPackage:WorkPackageResource|null;\n\n  private workPackageEditForm:EditForm|undefined;\n\n  private editingSubscription:Subscription|undefined;\n\n  private $element:JQuery;\n\n  constructor(public readonly injector:Injector,\n              protected readonly elementRef:ElementRef,\n              protected readonly FocusHelper:FocusHelperService,\n              protected readonly I18n:I18nService,\n              protected readonly querySpace:IsolatedQuerySpace,\n              protected readonly cdRef:ChangeDetectorRef,\n              protected readonly wpCreate:WorkPackageCreateService,\n              protected readonly wpInlineCreate:WorkPackageInlineCreateService,\n              protected readonly wpTableColumns:WorkPackageViewColumnsService,\n              protected readonly wpTableFocus:WorkPackageViewFocusService,\n              protected readonly authorisationService:AuthorisationService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.authorisationService\n      .observeUntil(componentDestroyed(this))\n      .subscribe(() => {\n        this.canReference = this.hasReferenceClass && this.wpInlineCreate.canReference;\n        this.canAdd = this.wpInlineCreate.canAdd;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  get isActive():boolean {\n    return this.mode !== 'inactive';\n  }\n\n  ngAfterViewInit() {\n    // Mirror the row height in timeline\n    const container = jQuery(this.table.timelineBody);\n    container.addClass('-inline-create-mirror');\n\n    // Register callback on newly created work packages\n    this.registerCreationCallback();\n\n    // Watch on this scope when the columns change and refresh this row\n    this.refreshOnColumnChanges();\n\n    // Cancel edition of current new row\n    this.registerCancelHandler();\n  }\n\n  /**\n   * Reset the inline creation row on the cancel button,\n   * which is dynamically inserted into the action row by the inline create renderer.\n   */\n  private registerCancelHandler() {\n    this.$element.on('click keydown', `.${inlineCreateCancelClassName}`, (evt:JQuery.TriggeredEvent) => {\n      onClickOrEnter(evt, () => {\n        this.resetRow();\n      });\n\n      evt.stopImmediatePropagation();\n      return false;\n    });\n  }\n\n  /**\n   * Since the table is refreshed imperatively whenever columns are changed,\n   * we need to manually ensure the inline create row gets refreshed as well.\n   */\n  private refreshOnColumnChanges() {\n    this.wpTableColumns\n      .updates$()\n      .pipe(\n        filter(() => this.isActive), // Take only when row is inserted\n        this.untilDestroyed()\n      )\n      .subscribe(() => this.refreshRow());\n  }\n\n  /**\n   * Listen to newly created work packages to detect whether the WP is the one we created,\n   * and properly reset inline create in this case\n   */\n  private registerCreationCallback() {\n    this.wpCreate\n      .onNewWorkPackage()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        if (this.currentWorkPackage && this.currentWorkPackage.__initialized_at === wp.__initialized_at) {\n          // Remove row and focus\n          this.resetRow();\n\n          // Split view on the last inserted id if any\n          if (!this.table.configuration.isEmbedded) {\n            this.wpTableFocus.updateFocus(wp.id!);\n          }\n\n          // Notify inline create service\n          this.wpInlineCreate.newInlineWorkPackageCreated.next(wp.id!);\n        } else {\n          // Remove current row\n          this.wpCreate.cancelCreation();\n          this.removeWorkPackageRow();\n          this.showRow();\n        }\n\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public handleAddRowClick() {\n    this.addWorkPackageRow();\n    return false;\n  }\n\n  public handleReferenceClick() {\n    this.mode = 'reference';\n    return false;\n  }\n\n  public get referenceClass() {\n    return this.wpInlineCreate.referenceComponentClass;\n  }\n\n  public get hasReferenceClass() {\n    return !!this.referenceClass;\n  }\n\n  public addWorkPackageRow() {\n    this.wpCreate\n      .createOrContinueWorkPackage(this.projectIdentifier)\n      .then((change:WorkPackageChangeset) => {\n\n        const wp = this.currentWorkPackage = change.projectedResource;\n\n        this.editingSubscription = this\n          .wpCreate\n          .changesetUpdates$()\n          .pipe(\n            filter(() => !!this.currentWorkPackage),\n          ).subscribe((form) => {\n            if (!this.isActive) {\n              this.insertRow(wp);\n            } else {\n              this.currentWorkPackage!.overriddenSchema = form!.schema;\n              this.refreshRow();\n            }\n          });\n      });\n  }\n\n  private insertRow(wp:WorkPackageResource) {\n    // Actually render the row\n    const form = this.workPackageEditForm = this.renderInlineCreateRow(wp);\n\n    setTimeout(() => {\n      // Activate any required fields\n      form.activateMissingFields();\n\n      // Hide the button row\n      this.hideRow();\n    });\n  }\n\n  private refreshRow() {\n    const builder = new InlineCreateRowBuilder(this.injector, this.table);\n    const rowElement = this.$element.find(`.${inlineCreateRowClassName}`);\n\n    if (rowElement.length && this.currentWorkPackage) {\n      builder.refreshRow(this.currentWorkPackage, rowElement);\n    }\n  }\n\n  /**\n   * Actually render the row manually\n   * in the same fashion as all rows in the table are rendered.\n   *\n   * @param wp Work package to be rendered\n   * @returns The work package form of the row\n   */\n  private renderInlineCreateRow(wp:WorkPackageResource):EditForm {\n    const builder = new InlineCreateRowBuilder(this.injector, this.table);\n    const form = this.table.editing.startEditing(wp, builder.classIdentifier(wp));\n\n    const [row,] = builder.buildNew(wp, form);\n    this.$element.append(row);\n\n    return form;\n  }\n\n  /**\n   * Reset the new work package row and refocus on the button\n   */\n  @HostListener('keydown.escape')\n  public resetRow() {\n    this.focus = true;\n    this.removeWorkPackageRow();\n    // Manually cancelled, show the row again\n    setTimeout(() => {\n      this.showRow();\n      this.cdRef.detectChanges();\n    }, 50);\n  }\n\n  public removeWorkPackageRow() {\n    this.wpCreate.cancelCreation();\n    this.currentWorkPackage = null;\n    this.$element.find('.wp-row-new').remove();\n    if (this.editingSubscription) {\n      this.editingSubscription.unsubscribe();\n    }\n  }\n\n  public showRow() {\n    this.mode = 'inactive';\n    this.cdRef.detectChanges();\n  }\n\n  public hideRow() {\n    this.mode = 'create';\n    this.cdRef.detectChanges();\n  }\n\n  public get colspan():number {\n    return this.wpTableColumns.columnCount + 1;\n  }\n\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\n\n@Injectable()\nexport class PayloadDmService {\n  public extract<T extends HalResource=HalResource>(resource:T, schema:SchemaResource) {\n    let payload:any = {\n      '_links': {}\n    }\n\n    var nonLinkProperties = [];\n\n    for(var key in schema) {\n      if (schema.hasOwnProperty(key) && schema[key].writable) {\n        if (resource.$links[key]) {\n          if (Array.isArray(resource[key])) {\n            payload['_links'][key] = _.map(resource[key], element => {\n              return { href: (element as HalResource).$href }\n            });\n          } else {\n            payload['_links'][key] = {\n              href: (resource[key] && resource[key].$href)\n            }\n          };\n        } else {\n          nonLinkProperties.push(key);\n        }\n      }\n    }\n\n    _.each(nonLinkProperties, property => {\n      if (resource.hasOwnProperty(property) || resource[property]) {\n        if (Array.isArray(resource[property])) {\n          payload[property] = _.map(resource[property], (element:any) => {\n            if (element instanceof HalResource) {\n              return this.extract(element, element.currentSchema || element.schema)\n            } else {\n              return element;\n            }\n          });\n        } else {\n          payload[property] = resource[property];\n        }\n      }\n    });\n\n    return payload;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {States} from 'core-components/states.service';\nimport {combine} from 'reactivestates';\nimport {mapTo} from 'rxjs/operators';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {Observable} from 'rxjs';\nimport {QuerySortByResource} from 'core-app/modules/hal/resources/query-sort-by-resource';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {QueryColumn} from \"core-components/wp-query/query-column\";\n\n@Injectable()\nexport class WorkPackageViewSortByService extends WorkPackageQueryStateService<QuerySortByResource[]> {\n\n  constructor(protected readonly states:States,\n              protected readonly querySpace:IsolatedQuerySpace,\n              protected readonly pathHelper:PathHelperService) {\n    super(querySpace);\n  }\n\n  public valueFromQuery(query:QueryResource) {\n    return [...query.sortBy];\n  }\n\n  public onReadyWithAvailable():Observable<null> {\n    return combine(this.pristineState, this.states.queries.sortBy)\n      .values$()\n      .pipe(\n        mapTo(null)\n      );\n  }\n\n  public hasChanged(query:QueryResource) {\n    const comparer = (sortBy:QuerySortByResource[]) => sortBy.map(el => el.href);\n\n    return !_.isEqual(\n      comparer(query.sortBy),\n      comparer(this.current)\n    );\n  }\n\n  public applyToQuery(query:QueryResource) {\n    const wasManuallySorted = this.isManuallySorted(query.sortBy);\n\n    query.sortBy = [...this.current];\n\n    // Reload every time unless we stayed in manual sort mode\n    return !(wasManuallySorted && this.isManualSortingMode);\n  }\n\n  public isSortable(column:QueryColumn):boolean {\n    return !!_.find(\n      this.available,\n      (candidate) => candidate.column.$href === column.$href\n    );\n  }\n\n  public addSortCriteria(column:QueryColumn, criteria:string) {\n    let available = this.findAvailableDirection(column, criteria);\n\n    if (available) {\n      this.add(available);\n    }\n  }\n\n  public setAsSingleSortCriteria(column:QueryColumn, criteria:string) {\n    let available:QuerySortByResource = this.findAvailableDirection(column, criteria)!;\n\n    if (available) {\n      this.update([available]);\n    }\n  }\n\n  public findAvailableDirection(column:QueryColumn, direction:string):QuerySortByResource | undefined {\n    return _.find(\n      this.available,\n      (candidate) => (candidate.column.$href === column.$href &&\n        candidate.direction.$href === direction)\n    );\n  }\n\n  public add(sortBy:QuerySortByResource) {\n    let newValue = _\n      .uniqBy([sortBy, ...this.current], sortBy => sortBy.column.$href)\n      .slice(0, 3);\n\n    this.update(newValue);\n  }\n\n  public get isManualSortingMode():boolean {\n    return this.isManuallySorted(this.current);\n  }\n\n  public switchToManualSorting(query:QueryResource):boolean {\n    let manualSortObject =  this.manualSortObject;\n    if (manualSortObject && !this.isManualSortingMode) {\n\n      if (query && query.persisted) {\n        // Save the query if it is persisted\n        query.sortBy = [manualSortObject];\n        return true;\n      } else {\n        // Query cannot be saved, just update the props for now\n        this.update([manualSortObject]);\n      }\n    }\n\n    return false;\n  }\n\n  public get current():QuerySortByResource[] {\n    return this.lastUpdatedState.getValueOr([]);\n  }\n\n  private get availableState() {\n    return this.states.queries.sortBy;\n  }\n\n  public get available():QuerySortByResource[] {\n    return this.availableState.getValueOr([]);\n  }\n\n  private isManuallySorted(sortBy:QuerySortByResource[]):boolean {\n    if (sortBy && sortBy.length > 0) {\n      return sortBy[0].column.href!.endsWith('/manualSorting');\n    }\n\n    return false;\n  }\n\n  private get manualSortObject() {\n    return _.find(this.available, sort => {\n      return sort.column.$href!.endsWith('/manualSorting');\n    });\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectionStrategy, Component, Input, OnChanges, OnInit, Output, ViewChild} from '@angular/core';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageFiltersService} from \"core-components/filters/wp-filters/wp-filters.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\nconst ADD_FILTER_SELECT_INDEX = -1;\n\n\n@Component({\n  selector: 'query-filters',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './query-filters.component.html'\n})\nexport class QueryFiltersComponent extends UntilDestroyedMixin implements OnInit, OnChanges {\n\n  @ViewChild(NgSelectComponent) public ngSelectComponent:NgSelectComponent;\n  @Input() public filters:QueryFilterInstanceResource[];\n  @Input() public showCloseFilter:boolean = false;\n  @Output() public filtersChanged = new DebouncedEventEmitter<QueryFilterInstanceResource[]>(componentDestroyed(this));\n\n\n  public remainingFilters:any[] = [];\n  public eeShowBanners:boolean = false;\n  public focusElementIndex:number = 0;\n  public trackByName = AngularTrackingHelpers.trackByName;\n\n  public text = {\n    open_filter: this.I18n.t('js.filter.description.text_open_filter'),\n    label_filter_add: this.I18n.t('js.work_packages.label_filter_add'),\n    close_filter: this.I18n.t('js.filter.description.text_close_filter'),\n    upsale_for_more: this.I18n.t('js.filter.upsale_for_more'),\n    upsale_link: this.I18n.t('js.filter.upsale_link'),\n    close_form: this.I18n.t('js.close_form_title'),\n    selected_filter_list: this.I18n.t('js.label_selected_filter_list'),\n    button_delete: this.I18n.t('js.button_delete'),\n    please_select: this.I18n.t('js.placeholders.selection'),\n    filter_by_text: this.I18n.t('js.work_packages.label_filter_by_text')\n  };\n\n  constructor(readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly wpFiltersService:WorkPackageFiltersService,\n              readonly I18n:I18nService,\n              readonly bannerService:BannersService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.eeShowBanners = this.bannerService.eeShowBanners;\n  }\n\n  ngOnChanges() {\n    this.updateRemainingFilters();\n  }\n\n  public onFilterAdded(filterToBeAdded:QueryFilterResource) {\n    if (filterToBeAdded) {\n      let newFilter = this.wpTableFilters.instantiate(filterToBeAdded);\n      this.filters.push(newFilter);\n\n      const index = this.currentFilterLength();\n      this.updateFilterFocus(index);\n      this.updateRemainingFilters();\n\n      this.filtersChanged.emit(this.filters);\n      this.ngSelectComponent.clearItem(filterToBeAdded);\n    }\n  }\n\n  public closeFilter() {\n    this.wpFiltersService.toggleVisibility();\n  }\n\n  public isHiddenFilter(filter:QueryFilterResource) {\n    return _.includes(this.wpTableFilters.hidden, filter.id);\n  }\n\n  public deactivateFilter(removedFilter:QueryFilterInstanceResource) {\n    let index = this.filters.indexOf(removedFilter);\n    _.remove(this.filters, f => f.id === removedFilter.id);\n\n    this.filtersChanged.emit(this.filters);\n\n    this.updateFilterFocus(index);\n    this.updateRemainingFilters();\n  }\n\n  public get isSecondSpacerVisible():boolean {\n    const hasSearch = !!_.find(this.filters, (f) => f.id === 'search');\n    const hasAvailableFilter = !!_.find(this.filters, (f) => f.id !== 'search' && this.isFilterAvailable(f.id));\n\n    return hasSearch && hasAvailableFilter;\n  }\n\n  private updateRemainingFilters() {\n    this.remainingFilters = _.sortBy(this.wpTableFilters.remainingVisibleFilters(this.filters), 'name');\n  }\n\n  private updateFilterFocus(index:number) {\n    var activeFilterCount = this.currentFilterLength();\n\n    if (activeFilterCount === 0) {\n      this.focusElementIndex = ADD_FILTER_SELECT_INDEX;\n    } else {\n      const filterIndex = (index < activeFilterCount) ? index : activeFilterCount - 1;\n      const filter = this.currentFilterAt(filterIndex);\n      this.focusElementIndex = this.filters.indexOf(filter);\n    }\n  }\n\n  public currentFilterLength() {\n    return this.filters.length;\n  }\n\n  public currentFilterAt(index:number) {\n    return this.filters[index];\n  }\n\n  public isFilterAvailable(id:string):boolean {\n    return (this.wpTableFilters.availableFilters.some(filter => filter.id === id));\n  }\n\n  public onOpen() {\n    setTimeout(() => {\n      const component = this.ngSelectComponent as any;\n      if (component && component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n    }, 25);\n  }\n}\n","<fieldset id=\"filters\" *ngIf=\"filters\" class=\"advanced-filters--container\">\n  <legend [textContent]=\"text.selected_filter_list\"></legend>\n\n  <a *ngIf=\"showCloseFilter\"\n     [attr.title]=\"text.close_form\"\n     class=\"advanced-filters--close icon-context icon-close\"\n     (click)=\"closeFilter()\">\n  </a>\n\n  <ul class=\"advanced-filters--filters\">\n    <li id=\"filter_search\"\n        class=\"advanced-filters--filter --without-operator\">\n      <label for=\"filter-by-text-input\"\n             class=\"advanced-filters--filter-name\"\n             [textContent]=\"text.filter_by_text\"\n             [attr.title]=\"text.filter_by_text\">\n      </label>\n\n      <div class=\"advanced-filters--filter-value\">\n        <wp-filter-by-text-input\n          (deactivateFilter)=\"deactivateFilter($event)\">\n        </wp-filter-by-text-input>\n      </div>\n    </li>\n\n    <li class=\"advanced-filters--spacer\"></li>\n\n    <ng-container *ngFor=\"let filter of filters; trackBy: trackByName ; let index = index\">\n      <li *ngIf=\"isFilterAvailable(filter.id)\"\n          id=\"filter_{{filter.id}}\"\n          query-filter\n          [shouldFocus]=\"index == focusElementIndex\"\n          [filter]=\"filter\"\n          (deactivateFilter)=\"deactivateFilter($event)\"\n          (filterChanged)=\"filtersChanged.emit(filters)\"\n          [hidden]=\"isHiddenFilter(filter)\"\n          class=\"advanced-filters--filter\">\n      </li>\n    </ng-container>\n\n    <li class=\"advanced-filters--spacer\" *ngIf=\"isSecondSpacerVisible\"></li>\n\n    <li class=\"advanced-filters--add-filter\">\n      <!-- Add filters -->\n      <label for=\"add_filter_select\" aria-hidden=\"true\" class=\"advanced-filters--add-filter-label\">\n        <op-icon icon-classes=\"icon-add icon4\"></op-icon>\n        {{ text.label_filter_add }}:\n      </label>\n      <label for=\"add_filter_select\" class=\"hidden-for-sighted\">\n        {{ text.label_filter_add }}\n        {{ text.open_filter }}\n        {{ text.close_filter }}\n      </label>\n\n      <div class=\"advanced-filters--add-filter-value\">\n        <ng-select #ngSelectComponent\n                   [items]=\"remainingFilters\"\n                   [clearSearchOnAdd]=\"true\"\n                   [multiple]=\"false\"\n                   [clearable]=\"true\"\n                   [clearOnBackspace]=\"true\"\n                   [closeOnSelect]=\"true\"\n                   [virtualScroll]=\"true\"\n                   [placeholder]=\"text.please_select\"\n                   (open)=\"onOpen()\"\n                   (change)=\"onFilterAdded($event)\"\n                   id=\"add_filter_select\"\n                   bindLabel=\"name\"\n                   appendTo=\"body\">\n        </ng-select>\n      </div>\n    </li>\n  </ul>\n  <enterprise-banner class=\"advanced-filters--add-filter-info\"\n                     *ngIf=\"eeShowBanners\"\n                     [linkMessage]=\"text.upsale_link\"\n                     [textMessage]=\"text.upsale_for_more\"\n                     opReferrer=\"wp-filter#filters\">\n  </enterprise-banner>\n</fieldset>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, EventEmitter, Injector, Input, OnDestroy, OnInit, Optional, Output} from '@angular/core';\nimport {StateService, Transition, TransitionService} from '@uirouter/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {EditableAttributeFieldComponent} from 'core-app/modules/fields/edit/field/editable-attribute-field.component';\nimport {input} from 'reactivestates';\nimport {filter, map, take} from 'rxjs/operators';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {\n  activeFieldClassName,\n  activeFieldContainerClassName,\n  EditForm\n} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {EditingPortalService} from \"core-app/modules/fields/edit/editing-portal/editing-portal-service\";\nimport {EditFormRoutingService} from \"core-app/modules/fields/edit/edit-form/edit-form-routing.service\";\nimport {ResourceChangesetCommit} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\n\n@Component({\n  selector: 'edit-form,[edit-form]',\n  template: '<ng-content></ng-content>'\n})\nexport class EditFormComponent extends EditForm<HalResource> implements OnInit, OnDestroy {\n  @Input('resource') resource:HalResource;\n  @Input('inEditMode') initializeEditMode:boolean = false;\n  @Input('skippedFields') skippedFields:string[] = [];\n\n  @Output('onSaved') onSavedEmitter = new EventEmitter<{ savedResource:HalResource, isInitial:boolean }>();\n\n  public fields:{ [attribute:string]:EditableAttributeFieldComponent } = {};\n  private registeredFields = input<string[]>();\n  private unregisterListener:Function;\n\n  constructor(public readonly injector:Injector,\n              protected readonly elementRef:ElementRef,\n              protected readonly $transitions:TransitionService,\n              protected readonly ConfigurationService:ConfigurationService,\n              protected readonly editingPortalService:EditingPortalService,\n              protected readonly $state:StateService,\n              protected readonly I18n:I18nService,\n              @Optional() protected readonly editFormRouting:EditFormRoutingService) {\n    super(injector);\n\n    const confirmText = I18n.t('js.work_packages.confirm_edit_cancel');\n    const requiresConfirmation = ConfigurationService.warnOnLeavingUnsaved();\n\n    this.unregisterListener = $transitions.onBefore({}, (transition:Transition) => {\n      if (!this.editing) {\n        return undefined;\n      }\n\n      // Show confirmation message when transitioning to a new state\n      // that's not within the edit mode.\n      if (!this.editFormRouting || this.editFormRouting.blockedTransition(transition)) {\n        if (requiresConfirmation && !window.confirm(confirmText)) {\n          return false;\n        }\n\n        this.cancel(false);\n      }\n\n      return true;\n    });\n  }\n\n  ngOnDestroy() {\n    this.unregisterListener();\n  }\n\n  ngOnInit() {\n    this.editMode = this.initializeEditMode;\n\n    if (this.initializeEditMode) {\n      this.start();\n    }\n  }\n\n  public async activateField(form:EditForm, schema:IFieldSchema, fieldName:string, errors:string[]):Promise<EditFieldHandler> {\n    return this.waitForField(fieldName).then((ctrl) => {\n      ctrl.setActive(true);\n      const container = ctrl.editContainer.nativeElement;\n      return this.editingPortalService.create(\n        container,\n        this.injector,\n        form,\n        schema,\n        fieldName,\n        errors\n      );\n    });\n  }\n\n  public async reset(fieldName:string, focus:boolean = false) {\n    const ctrl = await this.waitForField(fieldName);\n    ctrl.reset();\n    ctrl.deactivate(focus);\n  }\n\n  public onSaved(commit:ResourceChangesetCommit) {\n    this.cancel(false);\n    this.onSavedEmitter.emit({savedResource: commit.resource, isInitial: commit.wasNew });\n  }\n\n  public cancel(reset:boolean = false) {\n    this.editMode = false;\n    this.closeEditFields('all', reset);\n\n    if (reset) {\n      this.halEditing.reset(this.change)\n    }\n  }\n\n  public requireVisible(fieldName:string):Promise<void> {\n    return new Promise<void>((resolve, _) => {\n      const interval = setInterval(() => {\n        const field = this.fields[fieldName];\n\n        if (field !== undefined) {\n          clearInterval(interval);\n          resolve();\n        }\n      }, 50);\n    });\n  }\n\n  public get editing():boolean {\n    return this.editMode || this.hasActiveFields();\n  }\n\n  public register(field:EditableAttributeFieldComponent) {\n    this.fields[field.fieldName] = field;\n    this.registeredFields.putValue(_.keys(this.fields));\n\n    const shouldActivate =\n      (this.editMode && !this.skipField(field) || this.activeFields[field.fieldName]);\n\n    if (shouldActivate) {\n      field.activateOnForm(true);\n    }\n  }\n\n  public waitForField(name:string):Promise<EditableAttributeFieldComponent> {\n    return this.registeredFields\n      .values$()\n      .pipe(\n        filter(keys => keys.indexOf(name) >= 0),\n        take(1),\n        map(() => this.fields[name])\n      )\n      .toPromise();\n  }\n\n  public start() {\n    _.each(this.fields, ctrl => this.activate(ctrl.fieldName));\n  }\n\n  protected focusOnFirstError():void {\n    // Focus the first field that is erroneous\n    jQuery(this.elementRef.nativeElement)\n      .find(`.${activeFieldContainerClassName}.-error .${activeFieldClassName}`)\n      .first()\n      .trigger('focus');\n  }\n\n  private skipField(field:EditableAttributeFieldComponent) {\n    const fieldName = field.fieldName;\n\n    const isSkipField = this.skippedFields.indexOf(fieldName) !== -1;\n\n    // Only skip status or type\n    if (!isSkipField) {\n      return false;\n    }\n\n    // Only skip if value present and not changed in changeset\n    const hasDefault = this.resource[fieldName];\n    const changed = this.change.changes[fieldName];\n\n    return hasDefault && !changed;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'filter-date-value',\n  templateUrl: './filter-date-value.component.html'\n})\nexport class FilterDateValueComponent extends UntilDestroyedMixin {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new DebouncedEventEmitter<QueryFilterInstanceResource>(componentDestroyed(this));\n\n  constructor(readonly timezoneService:TimezoneService,\n              readonly I18n:I18nService) {\n    super();\n  }\n\n  public get value():HalResource|string {\n    return this.filter.values[0];\n  }\n\n  public set value(val) {\n    this.filter.values = [val as string];\n    this.filterChanged.emit(this.filter);\n  }\n\n  public parser(data:any) {\n    if (moment(data, 'YYYY-MM-DD', true).isValid()) {\n      return data;\n    } else {\n      return null;\n    }\n  }\n\n  public formatter(data:any) {\n    if (moment(data, 'YYYY-MM-DD', true).isValid()) {\n      var d = this.timezoneService.parseDate(data);\n      return this.timezoneService.formattedISODate(d);\n    } else {\n      return null;\n    }\n  }\n}\n","<div id=\"div-values-{{filter.id}}\">\n  <op-date-picker (onChange)=\"value = parser($event)\"\n                  [initialDate]=\"formatter(value)\"\n                  [focus]=\"shouldFocus\"\n                  required=\"true\"\n                  [id]=\"'values-' + filter.id\"\n                  [name]=\"'v[' + filter.id + ']'\"\n                  classes=\"advanced-filters--date-field\"\n                  size=\"10\">\n  </op-date-picker>\n</div>\n","import {AfterViewInit, ChangeDetectorRef, Directive, Input, SimpleChanges} from '@angular/core';\nimport {CurrentProjectService} from '../../projects/current-project.service';\nimport {WorkPackageStatesInitializationService} from '../../wp-list/wp-states-initialization.service';\nimport {\n  WorkPackageTableConfiguration,\n  WorkPackageTableConfigurationObject\n} from 'core-components/wp-table/wp-table-configuration';\nimport {LoadingIndicatorService} from 'core-app/modules/common/loading-indicator/loading-indicator.service';\nimport {QueryDmService} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackagesViewBase} from \"core-app/modules/work_packages/routing/wp-view-base/work-packages-view.base\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Directive()\nexport abstract class WorkPackageEmbeddedBaseComponent extends WorkPackagesViewBase implements AfterViewInit {\n  @Input('configuration') protected providedConfiguration:WorkPackageTableConfigurationObject;\n  @Input() public uniqueEmbeddedTableName:string = `embedded-table-${Date.now()}`;\n  @Input() public initialLoadingIndicator:boolean = true;\n\n  public renderTable = false;\n  public showTablePagination = false;\n  public configuration:WorkPackageTableConfiguration;\n  public error:string|null = null;\n\n  protected initialized:boolean = false;\n\n  @InjectField() QueryDm:QueryDmService;\n  @InjectField() querySpace:IsolatedQuerySpace;\n  @InjectField() I18n:I18nService;\n  @InjectField() urlParamsHelper:UrlParamsHelperService;\n  @InjectField() loadingIndicatorService:LoadingIndicatorService;\n  @InjectField() wpStatesInitialization:WorkPackageStatesInitializationService;\n  @InjectField() currentProject:CurrentProjectService;\n  @InjectField() cdRef:ChangeDetectorRef;\n\n  ngOnInit() {\n    this.configuration = new WorkPackageTableConfiguration(this.providedConfiguration);\n    // Set embedded status in configuration\n    this.configuration.isEmbedded = true;\n    this.initialized = true;\n\n    super.ngOnInit();\n  }\n\n  ngAfterViewInit():void {\n    // Load initially\n    this.loadQuery(true, false);\n  }\n\n  ngOnChanges(changes:SimpleChanges) {\n    if (this.initialized && (changes.queryId || changes.queryProps)) {\n      this.loadQuery(this.initialLoadingIndicator, false);\n    }\n  }\n\n  public get projectIdentifier() {\n    if (this.configuration.projectContext) {\n      return this.currentProject.identifier || undefined;\n    } else {\n      return this.configuration.projectIdentifier || undefined;\n    }\n  }\n\n  public buildQueryProps() {\n    const query = this.querySpace.query.value!;\n    this.wpStatesInitialization.applyToQuery(query);\n\n    return this.urlParamsHelper.buildV3GetQueryFromQueryResource(query);\n  }\n\n  protected setLoaded() {\n    this.renderTable = this.configuration.tableVisible;\n    this.cdRef.detectChanges();\n  }\n\n  public refresh(visible:boolean = true, firstPage:boolean = false):Promise<any> {\n    const query = this.querySpace.query.value!;\n    const pagination = this.wpTablePagination.paginationObject;\n\n    if (firstPage) {\n      pagination.offset = 1;\n    }\n\n    const promise = this.QueryDm.loadResults(query, pagination)\n      .then((query) => this.wpStatesInitialization.updateQuerySpace(query, query.results));\n\n    if (visible) {\n      this.loadingIndicator = promise;\n    }\n    return promise;\n  }\n\n  public get isInitialized() {\n    return !!this.configuration;\n  }\n\n  public set loadingIndicator(promise:Promise<any>) {\n    if (this.configuration.tableVisible) {\n      this.loadingIndicatorService\n        .indicator(this.uniqueEmbeddedTableName)\n        .promise = promise;\n    }\n  }\n\n  public abstract loadQuery(visible:boolean, firstPage:boolean):Promise<any>;\n\n  protected get queryProjectScope() {\n    if (!this.configuration.projectContext) {\n      return undefined;\n    } else {\n      return this.projectIdentifier;\n    }\n  }\n\n  protected initializeStates(query:QueryResource) {\n    this.wpStatesInitialization.clearStates();\n    this.wpStatesInitialization.initializeFromQuery(query, query.results);\n    this.wpStatesInitialization.updateQuerySpace(query, query.results);\n  }\n}\n","<div *ngIf=\"configuration\"\n     class=\"work-packages-embedded-view--container loading-indicator--location\"\n     [ngClass]=\"{ '-hierarchy-disabled': !configuration.hierarchyToggleEnabled,\n                  '-compact-tables': configuration.compactTableStyle,\n                  '-external-height': externalHeight }\"\n     [attr.data-indicator-name]=\"uniqueEmbeddedTableName\">\n\n  <ng-container *ngIf=\"renderTable\">\n    <!-- Filter container (if requested) -->\n    <filter-container *ngIf=\"configuration.withFilters\"\n                      [showFilterButton]=\"configuration.showFilterButton\"\n                      [filterButtonText]=\"configuration.filterButtonText\">\n\n    </filter-container>\n\n    <!-- TABLE + TIMELINE horizontal split -->\n    <wp-table *ngIf=\"!configuration.isCardView\"\n              [projectIdentifier]=\"projectIdentifier\"\n              [configuration]=\"configuration\"\n              class=\"work-packages-split-view--tabletimeline-content\"></wp-table>\n\n    <!-- GRID representation of the WP -->\n    <div class=\"work-packages-embedded-view--grid-view\" >\n      <wp-grid *ngIf=\"configuration.isCardView\"\n               [configuration]=\"configuration\">\n      </wp-grid>\n    </div>\n\n    <!-- Footer -->\n    <div class=\"work-packages-split-view--tabletimeline-footer hide-when-print\">\n      <wp-table-pagination [hideForSinglePageResults]=\"true\">\n      </wp-table-pagination>\n    </div>\n  </ng-container>\n\n  <div class=\"notification-box -error\" *ngIf=\"error\">\n    <span [textContent]=\"error.message || error\"></span>\n  </div>\n</div>\n","import {AfterViewInit, Component, EventEmitter, Input, OnDestroy, OnInit, Output} from '@angular/core';\nimport {WorkPackageViewTimelineService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service';\nimport {WorkPackageViewPaginationService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service';\nimport {OpTableActionFactory} from 'core-components/wp-table/table-actions/table-action';\nimport {OpTableActionsService} from 'core-components/wp-table/table-actions/table-actions.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QueryDmService} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {WpTableConfigurationModalComponent} from 'core-components/wp-table/configuration-modal/wp-table-configuration.modal';\nimport {OpModalService} from 'core-components/op-modals/op-modal.service';\nimport {WorkPackageEmbeddedBaseComponent} from \"core-components/wp-table/embedded/wp-embedded-base.component\";\nimport {QueryFormResource} from \"core-app/modules/hal/resources/query-form-resource\";\nimport {QueryFormDmService} from \"core-app/modules/hal/dm-services/query-form-dm.service\";\nimport {distinctUntilChanged, map, take, withLatestFrom} from \"rxjs/operators\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Component({\n  selector: 'wp-embedded-table',\n  templateUrl: './wp-embedded-table.html'\n})\nexport class WorkPackageEmbeddedTableComponent extends WorkPackageEmbeddedBaseComponent implements OnInit, AfterViewInit, OnDestroy {\n  @Input('queryId') public queryId?:string;\n  @Input('queryProps') public queryProps:any = {};\n  @Input() public tableActions:OpTableActionFactory[] = [];\n  @Input() public externalHeight:boolean = false;\n\n  /** Inform about loading errors */\n  @Output() public onError = new EventEmitter<string>();\n\n  /** Inform about loaded query */\n  @Output() public onQueryLoaded = new EventEmitter<QueryResource>();\n\n  @InjectField() QueryDm:QueryDmService;\n  @InjectField() opModalService:OpModalService;\n  @InjectField() tableActionsService:OpTableActionsService;\n  @InjectField() wpTableTimeline:WorkPackageViewTimelineService;\n  @InjectField() wpTablePagination:WorkPackageViewPaginationService;\n  @InjectField() QueryFormDm:QueryFormDmService;\n\n  // Cache the form promise\n  private formPromise:Promise<QueryFormResource>|undefined;\n\n  // If the query was provided to use via the query space,\n  // use it to cache first loading\n  private loadedQuery:QueryResource|undefined;\n\n  ngOnInit() {\n    super.ngOnInit();\n    this.loadedQuery = this.querySpace.query.value;\n  }\n\n  ngAfterViewInit():void {\n    super.ngAfterViewInit();\n\n    // Provision embedded table actions\n    if (this.tableActions) {\n      this.tableActionsService.setActions(...this.tableActions);\n    }\n\n    // Reload results on changes to pagination (Regression #29845)\n    this.wpTablePagination\n      .updates$()\n      .pipe(\n        map(pagination => [pagination.page, pagination.perPage]),\n        distinctUntilChanged(),\n        this.untilDestroyed(),\n        withLatestFrom(this.querySpace.query.values$())\n      ).subscribe(([_, query]) => {\n      this.loadingIndicator = this.QueryDm\n        .loadResults(query, this.wpTablePagination.paginationObject)\n        .then((query) => this.initializeStates(query));\n    });\n  }\n\n  public openConfigurationModal(onUpdated:() => void) {\n    this.querySpace.query\n      .valuesPromise()\n      .then(() => {\n        const modal = this.opModalService\n          .show(WpTableConfigurationModalComponent, this.injector);\n\n        // Detach this component when the modal closes and pass along the query data\n        modal.onDataUpdated.subscribe(onUpdated);\n      });\n  }\n\n  protected initializeStates(query:QueryResource) {\n    // If the configuration requests filters, we need to load the query form as well.\n    if (this.configuration.withFilters) {\n      this.loadForm(query);\n    }\n\n    super.initializeStates(query);\n\n    this.querySpace\n      .initialized\n      .values$()\n      .pipe(take(1))\n      .subscribe(() => {\n        this.showTablePagination = query.results.total > query.results.count;\n        this.setLoaded();\n\n        // Disable compact mode when timeline active\n        if (this.wpTableTimeline.isVisible) {\n          this.configuration = { ...this.configuration, compactTableStyle: false };\n        }\n      });\n  }\n\n  private loadForm(query:QueryResource):Promise<QueryFormResource> {\n    if (this.formPromise) {\n      return this.formPromise;\n    }\n\n    return this.formPromise = this.QueryFormDm\n      .load(query)\n      .then((form:QueryFormResource) => {\n        this.wpStatesInitialization.updateStatesFromForm(query, form);\n        return form;\n      })\n      .catch(() => this.formPromise = undefined);\n  }\n\n  public loadQuery(visible:boolean = true, firstPage:boolean = false):Promise<QueryResource> {\n    // Ensure we are loading the form.\n    this.formPromise = undefined;\n\n    if (this.loadedQuery) {\n      const query = this.loadedQuery;\n      this.loadedQuery = undefined;\n      this.initializeStates(query);\n      return Promise.resolve(this.loadedQuery!);\n    }\n\n    // HACK: Decrease loading time of queries when results are not needed.\n    // We should allow the backend to disable results embedding instead.\n    if (!this.configuration.tableVisible) {\n      this.queryProps.pageSize = 1;\n    }\n\n    // Set first page\n    if (firstPage) {\n      this.queryProps.page = 1;\n    }\n\n    this.error = null;\n    const promise = this.QueryDm\n      .find(\n        this.queryProps,\n        this.queryId,\n        this.queryProjectScope\n      )\n      .then((query:QueryResource) => {\n        this.initializeStates(query);\n        this.onQueryLoaded.emit(query);\n        return query;\n      })\n      .catch((error) => {\n        this.error = this.I18n.t(\n          'js.error.embedded_table_loading',\n          { message: _.get(error, 'message', error) }\n        );\n        this.onError.emit(error);\n      });\n\n    if (visible) {\n      this.loadingIndicator = promise;\n    }\n\n    return promise;\n  }\n}\n","import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Injector,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output\n} from \"@angular/core\";\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {\n  OpEditingPortalChangesetToken,\n  OpEditingPortalHandlerToken,\n  OpEditingPortalSchemaToken\n} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {createLocalInjector} from \"core-app/modules/fields/edit/editing-portal/edit-form-portal.injector\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {EditFieldService, IEditFieldType} from \"core-app/modules/fields/edit/edit-field.service\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\n\n@Component({\n  selector: 'edit-form-portal',\n  templateUrl: './edit-form-portal.component.html'\n})\nexport class EditFormPortalComponent implements OnInit, OnDestroy, AfterViewInit {\n  @Input() schemaInput:IFieldSchema;\n  @Input() changeInput:ResourceChangeset;\n  @Input() editFieldHandler:EditFieldHandler;\n  @Output() public onEditFieldReady = new EventEmitter<void>();\n\n  public handler:EditFieldHandler;\n  public schema:IFieldSchema;\n  public change:ResourceChangeset;\n  public fieldInjector:Injector;\n\n  public componentClass:IEditFieldType;\n  public htmlId:string;\n  public label:string;\n\n  constructor(readonly injector:Injector,\n              readonly editField:EditFieldService,\n              readonly elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    if (this.editFieldHandler && this.schemaInput) {\n      this.handler = this.editFieldHandler;\n      this.schema = this.schemaInput;\n      this.change = this.changeInput;\n\n    } else {\n      this.handler = this.injector.get<EditFieldHandler>(OpEditingPortalHandlerToken);\n      this.schema = this.injector.get<IFieldSchema>(OpEditingPortalSchemaToken);\n      this.change = this.injector.get<ResourceChangeset>(OpEditingPortalChangesetToken);\n    }\n\n    this.componentClass = this.editField.getSpecificClassFor(this.change.pristineResource._type, this.handler.fieldName, this.schema.type);\n    this.fieldInjector = createLocalInjector(this.injector, this.change, this.handler, this.schema);\n  }\n\n  ngOnDestroy() {\n    this.onEditFieldReady.complete();\n  }\n\n  ngAfterViewInit() {\n    // Fire in a timeout to avoid same execution context in AfterViewInit\n    setTimeout(() => {\n      this.onEditFieldReady.emit();\n    });\n  }\n}\n","<div *ngIf=\"handler\"\n     class=\"inline-edit--active-field inplace-edit {{ handler.fieldName }}\"\n     [ngClass]=\"{'-error': handler.isErrorenous }\">\n  <form (submit)=\"handler.handleUserSubmit()\"\n        role=\"form\"\n        tabindex=\"-1\">\n\n    <label [for]=\"handler.htmlId\"\n           class=\"hidden-for-sighted\">\n      {{handler.fieldLabel}}\n\n      {{handler.errorMessageOnLabel}}\n    </label>\n    <ng-container *ngComponentOutlet=\"componentClass; injector: fieldInjector\"></ng-container>\n  </form>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\n\n@Injectable({ providedIn: 'root' })\nexport class FocusHelperService {\n  private minimumOffsetForNewSwitchInMs = 100;\n  private lastFocusSwitch = -this.minimumOffsetForNewSwitchInMs;\n  private lastPriority = -1;\n\n  private static FOCUSABLE_SELECTORS = 'a, button, :input, [tabindex], select';\n\n  public throttleAndCheckIfAllowedFocusChangeBasedOnTimeout() {\n    var allowFocusSwitch = (Date.now() - this.lastFocusSwitch) >= this.minimumOffsetForNewSwitchInMs;\n\n    // Always update so that a chain of focus-change-requests gets considered as one\n    this.lastFocusSwitch = Date.now();\n\n    return allowFocusSwitch;\n  }\n\n  public checkIfAllowedFocusChange(priority?:any) {\n    var checkTimeout = this.throttleAndCheckIfAllowedFocusChangeBasedOnTimeout();\n\n    if (checkTimeout) {\n      // new timeout window -> reset priority\n      this.lastPriority = -1;\n    } else {\n      // within timeout window\n      if (priority > this.lastPriority) {\n        this.lastPriority = priority;\n        return true;\n      }\n    }\n\n    return checkTimeout;\n  }\n\n  public getFocusableElement(element:JQuery) {\n    var focusser = element.find('input.ui-select-focusser');\n\n    if (focusser.length > 0) {\n      return focusser[0];\n    }\n\n    var focusable = element;\n\n    if (!element.is(FocusHelperService.FOCUSABLE_SELECTORS)) {\n      focusable = element.find(FocusHelperService.FOCUSABLE_SELECTORS);\n    }\n\n    return focusable[0];\n  }\n\n  public focus(element:JQuery) {\n    var focusable = jQuery(this.getFocusableElement(element)),\n      $focusable = jQuery(focusable),\n      isDisabled = $focusable.is('[disabled]');\n\n    if (isDisabled && !$focusable.attr('ng-disabled')) {\n      $focusable.prop('disabled', false);\n    }\n\n    focusable.focus();\n\n    if (isDisabled && !$focusable.attr('ng-disabled')) {\n      $focusable.prop('disabled', true);\n    }\n  }\n\n  public focusElement(element:JQuery, priority?:any) {\n    if (!this.checkIfAllowedFocusChange(priority)) {\n      return;\n    }\n\n    setTimeout(() => {\n      this.focus(element);\n    }, 10);\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {WorkPackageViewDisplayRepresentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\n\n@Injectable()\nexport class WorkPackageViewHierarchyIdentationService {\n\n  constructor(private wpViewHierarchies:WorkPackageViewHierarchiesService,\n              private wpDisplayRepresentation:WorkPackageViewDisplayRepresentationService,\n              private states:States,\n              private wpRelationHierarchy:WorkPackageRelationsHierarchyService,\n              private wpCacheService:WorkPackageCacheService,\n              private querySpace:IsolatedQuerySpace) {\n  }\n\n  /**\n   * Return whether the current hierarchy mode is active\n   */\n  public get applicable():boolean {\n    return this.wpViewHierarchies.isEnabled && this.wpDisplayRepresentation.isList;\n  }\n\n  /**\n   * Returns whether the given work package can be indented in the current render order\n   * @param workPackage\n   */\n  public canIndent(workPackage:WorkPackageResource):boolean {\n    if (!workPackage.changeParent || !this.applicable) {\n      return false;\n    }\n\n    const rendered = this.renderedWorkPackageIds;\n    const index = rendered.indexOf(workPackage.id!);\n\n    // We can never indent the first item\n    if (index === 0) {\n      return false;\n    }\n\n    // We can not indent work packages whose predecessors are already their ancestors\n    const ancestors = workPackage.ancestorIds;\n    const ancestorCount = ancestors.length;\n\n    // We can always indent if the ancestor count is 0\n    if (ancestorCount === 0) {\n      return true;\n    }\n\n    // Otherwise, we can only indent if the predecessor is NOT the last ancestor\n    const lastAncestor:string = ancestors[ancestorCount - 1];\n    const predecessorId:string = rendered[index - 1];\n\n    return predecessorId !== lastAncestor;\n  }\n\n  /**\n   * Returns whether the given work package can be outdented\n   * @param workPackage\n   */\n  public canOutdent(workPackage:WorkPackageResource):boolean {\n    if (!workPackage.changeParent || !this.applicable) {\n      return false;\n    }\n\n    // We can always outdent if the work package has a parent\n    return !!workPackage.parent;\n  }\n\n  /**\n   * Try to indent the work package.\n   * @return a Promise with the change parent result\n   */\n  public async indent(workPackage:WorkPackageResource):Promise<unknown> {\n    if (!this.canIndent(workPackage)) {\n      return Promise.reject();\n    }\n\n    const rendered = this.renderedWorkPackageIds;\n    const index = rendered.indexOf(workPackage.id!);\n    const predecessorId:string = rendered[index - 1];\n\n    // By default, assume we're going to insert under parent\n    let newParentId = predecessorId;\n\n    // If the predecessor is in an ancestor chain.\n    // get the first element of the ancestor chain that workPackage is not in\n    const predecessor = await this.wpCacheService.require(predecessorId);\n\n    const difference = _.difference(predecessor.ancestorIds, workPackage.ancestorIds);\n    if (difference && difference.length > 0) {\n      newParentId = difference[0];\n    }\n\n    return this\n      .wpRelationHierarchy\n      .changeParent(workPackage, newParentId);\n  }\n\n  /**\n   * Try to outdent the work package.\n   * @return a Promise with the change parent result\n   */\n  public outdent(workPackage:WorkPackageResource):Promise<unknown> {\n    if (!this.canOutdent(workPackage)) {\n      return Promise.reject();\n    }\n\n    let newParentId:string|null = null;\n\n    // If we have more than one ancestor,\n    // just drop the last one\n    const ancestorIds = workPackage.ancestorIds;\n    const ancestorCount = ancestorIds.length;\n    if (ancestorCount > 1) {\n      newParentId = ancestorIds[ancestorCount - 2];\n    }\n\n    return this\n      .wpRelationHierarchy\n      .changeParent(workPackage, newParentId);\n  }\n\n  /**\n   * Get the currently rendered work packages\n   */\n  private get renderedWorkPackageIds():string[] {\n    return this.querySpace.renderedWorkPackageIds.getValueOr([]);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageCacheService} from '../work-package-cache.service';\nimport {Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageWatchersService} from 'core-components/wp-single-view-tabs/watchers-tab/wp-watchers.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'wp-watcher-button',\n  templateUrl: './wp-watcher-button.html'\n})\nexport class WorkPackageWatcherButtonComponent extends UntilDestroyedMixin implements OnInit {\n  @Input('workPackage') public workPackage:WorkPackageResource;\n  @Input('showText') public showText:boolean = false;\n  @Input('disabled') public disabled:boolean = false;\n\n  public buttonText:string;\n  public buttonTitle:string;\n  public buttonClass:string;\n  public buttonId:string;\n  public watchIconClass:string;\n\n  constructor(readonly I18n:I18nService,\n              readonly wpWatchersService:WorkPackageWatchersService,\n              readonly wpCacheService:WorkPackageCacheService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.wpCacheService.loadWorkPackage(this.workPackage.id!)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.workPackage = wp;\n        this.setWatchStatus();\n      });\n  }\n\n  public get isWatched() {\n    return this.workPackage.hasOwnProperty('unwatch');\n  }\n\n  public get displayWatchButton() {\n    return this.isWatched || this.workPackage.hasOwnProperty('watch');\n  }\n\n  public toggleWatch() {\n    const toggleLink = this.nextStateLink();\n\n    toggleLink(toggleLink.$link.payload).then(() => {\n      this.wpWatchersService.clear(this.workPackage.id!);\n      this.wpCacheService.loadWorkPackage(this.workPackage.id!, true);\n    });\n  }\n\n  public nextStateLink() {\n    const linkName = this.isWatched ? 'unwatch' : 'watch';\n    return this.workPackage[linkName];\n  }\n\n  private setWatchStatus() {\n    if (this.isWatched) {\n      this.buttonTitle = this.I18n.t('js.label_unwatch_work_package');\n      this.buttonText = this.I18n.t('js.label_unwatch');\n      this.buttonClass = '-active';\n      this.buttonId = 'unwatch-button';\n      this.watchIconClass = 'icon-watched';\n\n    } else {\n      this.buttonTitle = this.I18n.t('js.label_watch_work_package');\n      this.buttonText = this.I18n.t('js.label_watch');\n      this.buttonClass = '';\n      this.buttonId = 'watch-button';\n      this.watchIconClass = 'icon-unwatched';\n    }\n  }\n}\n","<button *ngIf=\"displayWatchButton\"\n        (click)=\"toggleWatch()\"\n        [attr.title]=\"buttonTitle\"\n        [disabled]=\"disabled\"\n        [ngClass]=\"buttonClass\"\n        class=\"button toolbar-icon\"\n        [id]=\"buttonId\">\n\n  <op-icon icon-classes=\"button--icon {{watchIconClass}}\"></op-icon>\n  <span class=\"button--text\" *ngIf=\"showText\" [textContent]=\"buttonText\"></span>\n</button>\n","export namespace SelectionHelpers {\n\n  /**\n   * Test whether we currently have a selection within.\n   * @param {HTMLElement} target\n   * @return {boolean}\n   */\n  export function hasSelectionWithin(target:Element):boolean {\n    try {\n      const selection = window.getSelection()!;\n      const hasSelection = selection.toString().length > 0;\n      const isWithin = target.contains(selection.anchorNode);\n\n      return hasSelection && isWithin;\n    } catch (e) {\n      console.error('Failed to test whether in selection ', e);\n      return false;\n    }\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {States} from 'core-components/states.service';\nimport {\n  displayClassName,\n  DisplayFieldRenderer,\n  editFieldContainerClass\n} from 'core-components/wp-edit-form/display-field-renderer';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {SelectionHelpers} from '../../../../helpers/selection-helpers';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  Input,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {ClickPositionMapper} from \"core-app/modules/common/set-click-position/set-click-position\";\nimport {EditFormComponent} from \"core-app/modules/fields/edit/edit-form/edit-form.component\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'editable-attribute-field',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './editable-attribute-field.component.html'\n})\nexport class EditableAttributeFieldComponent extends UntilDestroyedMixin implements OnInit, OnDestroy {\n  @Input('fieldName') public fieldName:string;\n  @Input('resource') public resource:HalResource;\n  @Input('wrapperClasses') public wrapperClasses?:string;\n  @Input('displayFieldOptions') public displayFieldOptions:any = {};\n  @Input('displayPlaceholder') public displayPlaceholder?:string;\n  @Input('isDropTarget') public isDropTarget?:boolean = false;\n\n  @ViewChild('displayContainer', { static: true }) readonly displayContainer:ElementRef;\n  @ViewChild('editContainer', { static: true }) readonly editContainer:ElementRef;\n\n  public fieldRenderer:DisplayFieldRenderer;\n  public editFieldContainerClass = editFieldContainerClass;\n  public active = false;\n  private $element:JQuery;\n\n  public destroyed:boolean = false;\n\n  constructor(protected states:States,\n              protected injector:Injector,\n              protected elementRef:ElementRef,\n              protected halNotification:HalResourceNotificationService,\n              protected ConfigurationService:ConfigurationService,\n              protected opContextMenu:OPContextMenuService,\n              protected halEditing:HalResourceEditingService,\n              protected wpCacheService:WorkPackageCacheService,\n              // Get parent field group from injector\n              protected editForm:EditFormComponent,\n              protected NotificationsService:NotificationsService,\n              protected cdRef:ChangeDetectorRef,\n              protected I18n:I18nService) {\n    super();\n  }\n\n  public setActive(active:boolean = true) {\n    this.active = active;\n    if (!this.componentDestroyed) {\n      this.cdRef.detectChanges();\n    }\n  }\n\n  public ngOnInit() {\n    this.fieldRenderer = new DisplayFieldRenderer(this.injector, 'single-view', this.displayFieldOptions);\n    this.$element = jQuery(this.elementRef.nativeElement);\n    this.editForm.register(this);\n\n    this.halEditing\n      .temporaryEditResource(this.resource)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(resource => {\n        this.resource = resource;\n        this.render();\n      });\n  }\n\n  // Open the field when its closed and relay drag & drop events to it.\n  public startDragOverActivation(event:JQuery.TriggeredEvent) {\n    if (!this.isDropTarget || !this.isEditable || this.active) {\n      return true;\n    }\n\n    this.handleUserActivate(null);\n    event.preventDefault();\n    return false;\n  }\n\n  public render() {\n    const el = this.fieldRenderer.render(this.resource, this.fieldName, null, this.displayPlaceholder);\n    this.displayContainer.nativeElement.innerHTML = '';\n    this.displayContainer.nativeElement.appendChild(el);\n  }\n\n  public deactivate(focus:boolean = false) {\n    this.editContainer.nativeElement.innerHTML = '';\n    this.editContainer.nativeElement.hidden = true;\n    this.setActive(false);\n\n    if (focus) {\n      setTimeout(() => this.$element.find(`.${displayClassName}`).focus(), 20);\n    }\n  }\n\n  public get isEditable() {\n    const fieldSchema = this.resource.schema[this.fieldName] as IFieldSchema;\n    return this.resource.isAttributeEditable(this.fieldName) && fieldSchema && fieldSchema.writable;\n  }\n\n  public activateIfEditable(event:JQuery.TriggeredEvent) {\n    // Ignore selections\n    if (SelectionHelpers.hasSelectionWithin(event.target)) {\n      debugLog(`Not activating ${this.fieldName} because of active selection within`);\n      return true;\n    }\n\n    // Skip activation if the user clicked on a link or within a macro\n    const target = jQuery(event.target);\n    if (target.closest('a,macro', this.displayContainer.nativeElement).length > 0) {\n      return true;\n    }\n\n    if (this.isEditable) {\n      this.handleUserActivate(event);\n    }\n\n    this.opContextMenu.close();\n    event.preventDefault();\n    event.stopImmediatePropagation();\n\n    return false;\n  }\n\n  public activateOnForm(noWarnings:boolean = false) {\n    // Activate the field\n    this.setActive(true);\n\n    return this.editForm\n      .activate(this.fieldName, noWarnings)\n      .catch(() => this.deactivate(true));\n  }\n\n  public handleUserActivate(evt:JQuery.TriggeredEvent|null) {\n    let positionOffset = 0;\n\n    if (evt) {\n      // Get the position where the user clicked.\n      positionOffset = ClickPositionMapper.getPosition(evt);\n    }\n\n    this.activateOnForm()\n      .then((handler) => {\n        if (!handler) {\n          return;\n        }\n\n        handler.$onUserActivate.next();\n        handler.focus(positionOffset);\n      });\n\n    return false;\n  }\n\n  public reset() {\n    this.render();\n    this.deactivate();\n  }\n\n}\n","<div [ngClass]=\"[\n      editFieldContainerClass,\n      fieldName,\n      active && '-active' || '',\n      wrapperClasses || '-small'\n     ]\"\n     (dragover)=\"startDragOverActivation($event)\">\n\n  <div #editContainer\n       [hidden]=\"!active\">\n  </div>\n\n  <div (accessibleClick)=\"activateIfEditable($event)\"\n       [accessibleClickStopEvent]=\"false\"\n       [hidden]=\"active\"\n       tabindex=\"-1\"\n       #displayContainer></div>\n</div>\n","import {Injectable, Injector, Optional} from '@angular/core';\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackageCreateService} from \"core-components/wp-new/wp-create.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {DragAndDropHelpers} from \"core-app/modules/common/drag-and-drop/drag-and-drop.helpers\";\nimport {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Injectable()\nexport class WorkPackageCardDragAndDropService {\n\n  private _workPackages:WorkPackageResource[];\n\n  /** Whether the card view has an active inline created wp */\n  public activeInlineCreateWp?:WorkPackageResource;\n\n  /** A reference to the component in use, to have access to the current input variables */\n  public cardView:WorkPackageCardViewComponent;\n\n\n  public constructor(readonly states:States,\n                     readonly injector:Injector,\n                     readonly reorderService:WorkPackageViewOrderService,\n                     readonly wpCreate:WorkPackageCreateService,\n                     readonly notificationService:WorkPackageNotificationService,\n                     readonly wpCacheService:WorkPackageCacheService,\n                     readonly currentProject:CurrentProjectService,\n                     @Optional() readonly dragService:DragAndDropService,\n                     readonly wpInlineCreate:WorkPackageInlineCreateService) {\n\n  }\n\n  public init(componentRef:WorkPackageCardViewComponent) {\n    this.cardView = componentRef;\n  }\n\n  public destroy() {\n    if (this.dragService !== null) {\n      this.dragService.remove(this.cardView.container.nativeElement);\n    }\n  }\n\n  public registerDragAndDrop() {\n    // The DragService may not have been provided\n    // in which case we do not provide drag and drop\n    if (this.dragService === null) {\n      return;\n    }\n\n    this.dragService.register({\n      dragContainer: this.cardView.container.nativeElement,\n      scrollContainers: [this.cardView.container.nativeElement],\n      moves: (card:HTMLElement) => {\n        const wpId:string = card.dataset.workPackageId!;\n        const workPackage = this.states.workPackages.get(wpId).value;\n\n        return !!workPackage && this.cardView.canDragOutOf(workPackage) && !card.dataset.isNew;\n      },\n      accepts: () => this.cardView.dragInto,\n      onMoved: async (card:HTMLElement) => {\n        const wpId:string = card.dataset.workPackageId!;\n        const toIndex = DragAndDropHelpers.findIndex(card);\n\n        const newOrder = await this.reorderService.move(this.currentOrder, wpId, toIndex);\n        this.updateOrder(newOrder);\n\n        this.cardView.onMoved.emit();\n      },\n      onRemoved: (card:HTMLElement) => {\n        const wpId:string = card.dataset.workPackageId!;\n\n        const newOrder = this.reorderService.remove(this.currentOrder, wpId);\n        this.updateOrder(newOrder);\n      },\n      onAdded: async (card:HTMLElement) => {\n        const wpId:string = card.dataset.workPackageId!;\n        const toIndex = DragAndDropHelpers.findIndex(card);\n\n        const workPackage = await this.wpCacheService.require(wpId);\n        const result = await this.addWorkPackageToQuery(workPackage, toIndex);\n\n        if (card.parentElement) {\n          card.parentElement.removeChild(card);\n        }\n\n        return result;\n      }\n    });\n  }\n\n  /**\n   * Get the current work packages\n   */\n  public get workPackages():WorkPackageResource[] {\n    return this._workPackages;\n  }\n\n  /**\n   * Set work packages array,\n   * remembering to keep the active inline-create\n   */\n  public set workPackages(workPackages:WorkPackageResource[]) {\n    if (this.activeInlineCreateWp) {\n      let existingNewWp = this._workPackages.find(o => o.isNew);\n\n      // If there is already a card for a new WP,\n      // we have to replace this one by the new activeInlineCreateWp\n      if (existingNewWp) {\n        let index = this._workPackages.indexOf(existingNewWp);\n        this._workPackages[index] = this.activeInlineCreateWp;\n      } else {\n        this._workPackages = [this.activeInlineCreateWp, ...workPackages];\n      }\n    } else {\n      this._workPackages = [...workPackages];\n    }\n  }\n\n  /**\n   * Get current order\n   */\n  private get currentOrder():string[] {\n    return this.workPackages\n      .filter(wp => wp && !wp.isNew)\n      .map(el => el.id!);\n  }\n\n  /**\n   * Update current order\n   */\n  private updateOrder(newOrder:string[]) {\n    newOrder = _.uniq(newOrder);\n\n    Promise\n      .all(newOrder.map(id => this.wpCacheService.require(id)))\n      .then((workPackages:WorkPackageResource[]) => {\n        this.workPackages = workPackages;\n        this.cardView.cdRef.detectChanges();\n      });\n  }\n\n  /**\n   * Inline create a new card\n   */\n  public addNewCard() {\n    this.wpCreate\n      .createOrContinueWorkPackage(this.currentProject.identifier)\n      .then((changeset:WorkPackageChangeset) => {\n        this.activeInlineCreateWp = changeset.projectedResource;\n        this.workPackages = this.workPackages;\n        this.cardView.cdRef.detectChanges();\n      });\n  }\n\n  /**\n   * Add the given work package to the query\n   */\n  async addWorkPackageToQuery(workPackage:WorkPackageResource, toIndex:number = -1):Promise<boolean> {\n    try {\n      await this.cardView.workPackageAddedHandler(workPackage);\n      const newOrder = await this.reorderService.add(this.currentOrder, workPackage.id!, toIndex);\n      this.updateOrder(newOrder);\n      return true;\n    } catch (e) {\n      this.notificationService.handleRawError(e, workPackage);\n    }\n\n    return false;\n  }\n\n  /**\n   * Remove the new card\n   */\n  public removeReferenceWorkPackageForm() {\n    if (this.activeInlineCreateWp) {\n      this.removeCard(this.activeInlineCreateWp);\n    }\n  }\n\n  removeCard(wp:WorkPackageResource) {\n    const index = this.workPackages.indexOf(wp);\n    this.workPackages.splice(index, 1);\n    this.activeInlineCreateWp = undefined;\n\n    if (!wp.isNew) {\n      const newOrder = this.reorderService.remove(this.currentOrder, wp.id!);\n      this.updateOrder(newOrder);\n    }\n  }\n\n  /**\n   * On new card saved\n   */\n  async onCardSaved(wp:WorkPackageResource) {\n    const index = this.workPackages.findIndex((el) => el.id === 'new');\n\n    if (index !== -1) {\n      this.activeInlineCreateWp = undefined;\n\n      // Add this item to the results\n      const newOrder = await this.reorderService.add(this.currentOrder, wp.id!, index);\n      this.updateOrder(newOrder);\n\n      // Notify inline create service\n      this.wpInlineCreate.newInlineWorkPackageCreated.next(wp.id!);\n    }\n  }\n}\n","export namespace DomHelpers {\n  export function setBodyCursor(cursor:string, priority:'important'|'' = '') {\n    document.body.style.setProperty('cursor', cursor, priority);\n  }\n}","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {InputState} from 'reactivestates';\n\nexport class SchemaResource extends HalResource {\n\n  public get state():InputState<this> {\n    return this.states.schemas.get(this.href as string) as any;\n  }\n\n  public get availableAttributes() {\n    return _.keys(this.$source).filter(name => name.indexOf('_') !== 0);\n  }\n}\n\nexport class SchemaAttributeObject<T = HalResource> {\n  public type:string;\n  public name:string;\n  public required:boolean;\n  public hasDefault:boolean;\n  public writable:boolean;\n  public allowedValues:T[] | CollectionResource<T>;\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {InputState} from 'reactivestates';\n\nexport class TypeResource extends HalResource {\n  public color:string;\n\n  public get state():InputState<this> {\n    return this.states.types.get(this.href as string) as any;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class SchemaDependencyResource extends HalResource {\n\n  public dependencies:any;\n\n  public forValue(value:string):any {\n    return this.dependencies[value];\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport interface WorkPackageCollectionResourceEmbedded {\n  elements:WorkPackageResource[];\n  groups:GroupObject[];\n}\n\nexport class WorkPackageCollectionResource extends CollectionResource<WorkPackageResource> {\n  public schemas:CollectionResource<SchemaResource>;\n  public createWorkPackage:any;\n  public elements:WorkPackageResource[];\n  public groups:GroupObject[];\n  public totalSums?:Object;\n  public sumsSchema?:SchemaResource;\n  public representations:Array<HalResource>;\n}\n\nexport interface WorkPackageCollectionResource extends WorkPackageCollectionResourceEmbedded {\n}\n\n/**\n * A reference to a group object as returned from the API.\n * Augmented with state information such as collapsed state.\n */\nexport interface GroupObject {\n  value:any;\n  count:number;\n  collapsed?:boolean;\n  index:number;\n  identifier:string;\n  href:{ href:string }[];\n  _links:{\n    valueLink:{ href:string }[];\n    groupBy:{ href:string };\n  };\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {\n  ErrorResource,\n  v3ErrorIdentifierMultipleErrors\n} from 'core-app/modules/hal/resources/error-resource';\n\nexport interface FormResourceLinks<T = HalResource> {\n  commit(payload:any):Promise<T>;\n}\n\nexport class FormResource<T = HalResource> extends HalResource {\n\n  public schema:SchemaResource;\n  public validationErrors:{ [attribute:string]:ErrorResource };\n\n  public getErrors():ErrorResource|null {\n    const errors = _.values(this.validationErrors);\n    const count = errors.length;\n\n    if (count === 0) {\n      return null;\n    }\n\n    let resource;\n    if (count === 1) {\n      resource = new ErrorResource(this.injector, errors[0], true, this.halInitializer, 'Error');\n    } else {\n      resource = new ErrorResource(this.injector, {}, true, this.halInitializer, 'Error');\n      resource.errorIdentifier = v3ErrorIdentifierMultipleErrors;\n      resource.errors = errors;\n    }\n    resource.isValidationError = true;\n    return resource;\n  }\n}\n\nexport interface FormResource extends FormResourceLinks {}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {\n  SchemaAttributeObject,\n  SchemaResource\n} from 'core-app/modules/hal/resources/schema-resource';\nimport {SchemaDependencyResource} from 'core-app/modules/hal/resources/schema-dependency-resource';\nimport {QueryOperatorResource} from 'core-app/modules/hal/resources/query-operator-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport interface QueryFilterInstanceSchemaResourceLinks {\n  filter:QueryFilterResource;\n}\n\nexport class QueryFilterInstanceSchemaResource extends SchemaResource {\n\n  public $links:QueryFilterInstanceSchemaResourceLinks;\n\n  public operator:SchemaAttributeObject;\n  public filter:SchemaAttributeObject<QueryFilterResource>;\n  public dependency:SchemaDependencyResource;\n  public values:SchemaAttributeObject|null;\n\n  public get _type() {\n    return 'QueryFilterInstanceSchema';\n  }\n\n  public get availableOperators():HalResource[] | CollectionResource {\n    return this.operator.allowedValues;\n  }\n\n  public get allowedFilterValue():QueryFilterResource {\n    if (this.filter.allowedValues instanceof CollectionResource) {\n      return this.filter.allowedValues.elements[0];\n    }\n\n    return this.filter.allowedValues[0];\n  }\n\n  public $initialize(source:any) {\n    super.$initialize(source);\n\n    if (source._dependencies) {\n      this.dependency = new SchemaDependencyResource(this.injector, source._dependencies[0], true, this.halInitializer, 'SchemaDependency');\n    }\n  }\n\n  public getFilter():QueryFilterInstanceResource {\n    let operator = (this.operator.allowedValues as HalResource[])[0];\n    let filter = (this.filter.allowedValues as HalResource[])[0];\n    let source:any = {\n      name: filter.name,\n      _links: {\n        filter: filter.$source._links.self,\n        schema: this.$source._links.self,\n        operator: operator.$source._links.self\n      }\n    }\n\n    if (this.definesAllowedValues()) {\n      source._links['values'] = [];\n    } else {\n      source['values'] = [];\n    }\n\n    let newFilter = new QueryFilterInstanceResource(this.injector, source, true, this.halInitializer, 'QueryFilterInstance');\n\n    newFilter.schema = this;\n\n    return newFilter;\n  }\n\n  public isValueRequired():boolean {\n    return !!(this.values);\n  }\n\n  public isResourceValue():boolean {\n    return !!(this.values && this.values.allowedValues);\n  }\n\n  public resultingSchema(operator:QueryOperatorResource):QueryFilterInstanceSchemaResource {\n    let staticSchema = this.$source;\n    let dependentSchema = this.dependency.forValue(operator.href!.toString());\n    let resultingSchema = {};\n\n    _.merge(resultingSchema, staticSchema, dependentSchema);\n\n    return new QueryFilterInstanceSchemaResource(this.injector, resultingSchema, true, this.halInitializer, 'QueryFilterInstanceSchema');\n  }\n\n  private definesAllowedValues() {\n    return _.some(this._dependencies[0].dependencies,\n      (dependency:any) => dependency.values && dependency.values._links && dependency.values._links.allowedValues);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\n\nexport class RootResource extends HalResource {\n\n  public user:UserResource;\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class QueryOperatorResource extends HalResource {\n  public get id():string {\n    return this.$source.id || this.idFromLink;\n  }\n\n  public get idFromLink():string {\n    if (this.$href) {\n      const idPart = HalResource.idFromLink(this.$href);\n      return decodeURIComponent(idPart);\n    }\n\n    return '';\n  }\n\n\n  public set id(val:string) {\n    this.$source.id = val;\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {CallableHalLink} from 'core-app/modules/hal/hal-link/hal-link';\n\nexport class HelpTextResource extends HalResource {\n\n  public id:string;\n  public attribute:string;\n  public attributeCaption:string;\n  public scope:string;\n  public helpText:api.v3.Formattable;\n}\n\nexport interface HelpTextResource {\n  editText?:CallableHalLink;\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {Attachable} from 'core-app/modules/hal/resources/mixins/attachable-mixin';\n\n\nexport interface WikiPageResourceLinks {\n  addAttachment(attachment:HalResource):Promise<any>;\n}\n\nclass WikiPageBaseResource extends HalResource {\n  public $links:WikiPageResourceLinks;\n\n  private attachmentsBackend = false;\n}\n\nexport const WikiPageResource = Attachable(WikiPageBaseResource);\n\nexport interface WikiPageResource extends HalResource {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {Attachable} from 'core-app/modules/hal/resources/mixins/attachable-mixin';\n\n\nexport interface MeetingContentResourceLinks {\n  addAttachment(attachment:HalResource):Promise<any>;\n}\n\nclass MeetingContentBaseResource extends HalResource {\n  public $links:MeetingContentResourceLinks;\n\n  private attachmentsBackend = false;\n}\n\nexport const MeetingContentResource = Attachable(MeetingContentBaseResource);\n\nexport interface MeetingContentResource extends HalResource {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {Attachable} from 'core-app/modules/hal/resources/mixins/attachable-mixin';\n\nexport interface PostResourceLinks {\n  addAttachment(attachment:HalResource):Promise<any>;\n}\n\nclass PostBaseResource extends HalResource {\n  public $links:PostResourceLinks;\n\n  private attachmentsBackend = false;\n}\n\nexport const PostResource = Attachable(PostBaseResource);\n\nexport interface PostResource extends PostResourceLinks {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {InputState} from 'reactivestates';\n\nexport class StatusResource extends HalResource {\n\n  isClosed:boolean;\n  isDefault:boolean;\n\n  public get state():InputState<this> {\n    return this.states.statuses.get(this.href as string) as any;\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class NewsResource extends HalResource {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\nimport {RoleResource} from \"core-app/modules/hal/resources/role-resource\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\n\nexport interface MembershipResourceLinks {\n  update(payload:unknown):Promise<unknown>;\n  updateImmediately(payload:unknown):Promise<unknown>;\n  delete():Promise<unknown>;\n}\n\nexport interface MembershipResourceEmbedded {\n  principal:UserResource;\n  roles:RoleResource[];\n  project:ProjectResource;\n}\n\nexport class MembershipResource extends HalResource {\n}\n\nexport interface MembershipResource extends MembershipResourceLinks, MembershipResourceEmbedded {}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class RoleResource extends HalResource {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class ProjectResource extends HalResource {\n  @InjectField() private schemaCacheService:SchemaCacheService;\n\n  public get state() {\n    return this.states.projects.get(this.id!) as any;\n  }\n\n  public getEditorTypeFor(fieldName:string):\"full\"|\"constrained\" {\n    if (['statusExplanation', 'description'].indexOf(fieldName) !== -1) {\n      return 'full';\n    }\n\n    return 'constrained';\n  }\n\n  /**\n   * Get the schema of the project\n   * ensure that it's loaded\n   *\n   * TODO this is duplicating the WorkPackageResource#schema getter\n   */\n  public get schema():SchemaResource {\n    const state = this.schemaCacheService.state(this as any);\n\n    if (!state.hasValue()) {\n      throw `Accessing schema of ${this.id} without it being loaded.`;\n    }\n\n    return state.value!;\n  }\n\n  /**\n   * Exclude the schema _link from the linkable Resources.\n   */\n  public $linkableKeys():string[] {\n    return _.without(super.$linkableKeys(), 'schema');\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class GroupResource extends HalResource {\n  public name:string;\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {TypeResource} from 'core-app/modules/hal/resources/type-resource';\nimport {SchemaDependencyResource} from 'core-app/modules/hal/resources/schema-dependency-resource';\nimport {ErrorResource} from 'core-app/modules/hal/resources/error-resource';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {FormResource} from 'core-app/modules/hal/resources/form-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {QueryFilterInstanceSchemaResource} from 'core-app/modules/hal/resources/query-filter-instance-schema-resource';\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {RootResource} from 'core-app/modules/hal/resources/root-resource';\nimport {QueryOperatorResource} from 'core-app/modules/hal/resources/query-operator-resource';\nimport {HelpTextResource} from 'core-app/modules/hal/resources/help-text-resource';\nimport {CustomActionResource} from 'core-app/modules/hal/resources/custom-action-resource';\nimport {\n  HalResourceFactoryConfigInterface,\n  HalResourceService\n} from 'core-app/modules/hal/services/hal-resource.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {WikiPageResource} from \"core-app/modules/hal/resources/wiki-page-resource\";\nimport {MeetingContentResource} from \"core-app/modules/hal/resources/meeting-content-resource\";\nimport {PostResource} from \"core-app/modules/hal/resources/post-resource\";\nimport {StatusResource} from \"core-app/modules/hal/resources/status-resource\";\nimport {AttachmentCollectionResource} from \"core-app/modules/hal/resources/attachment-collection-resource\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {NewsResource} from \"core-app/modules/hal/resources/news-resource\";\nimport {VersionResource} from \"core-app/modules/hal/resources/version-resource\";\nimport {MembershipResource} from \"core-app/modules/hal/resources/membership-resource\";\nimport {RoleResource} from \"core-app/modules/hal/resources/role-resource\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {GroupResource} from \"core-app/modules/hal/resources/group-resource\";\n\nconst halResourceDefaultConfig:{ [typeName:string]:HalResourceFactoryConfigInterface } = {\n  WorkPackage: {\n    cls: WorkPackageResource,\n    attrTypes: {\n      parent: 'WorkPackage',\n      ancestors: 'WorkPackage',\n      children: 'WorkPackage',\n      relations: 'Relation',\n      schema: 'Schema',\n      status: 'Status',\n      type: 'Type'\n    }\n  },\n  Activity: {\n    cls: HalResource,\n    attrTypes: {\n      user: 'User'\n    }\n  },\n  'Activity::Comment': {\n    cls: HalResource,\n    attrTypes: {\n      user: 'User'\n    }\n  },\n  'Activity::Revision': {\n    cls: HalResource,\n    attrTypes: {\n      user: 'User'\n    }\n  },\n  Relation: {\n    cls: RelationResource,\n    attrTypes: {\n      from: 'WorkPackage',\n      to: 'WorkPackage'\n    }\n  },\n  Schema: {\n    cls: SchemaResource\n  },\n  Type: {\n    cls: TypeResource\n  },\n  Status: {\n    cls: StatusResource\n  },\n  SchemaDependency: {\n    cls: SchemaDependencyResource\n  },\n  Error: {\n    cls: ErrorResource\n  },\n  User: {\n    cls: UserResource\n  },\n  Group: {\n    cls: GroupResource\n  },\n  Collection: {\n    cls: CollectionResource\n  },\n  WorkPackageCollection: {\n    cls: WorkPackageCollectionResource\n  },\n  AttachmentCollection: {\n    cls: AttachmentCollectionResource\n  },\n  Query: {\n    cls: QueryResource,\n    attrTypes: {\n      filters: 'QueryFilterInstance'\n    }\n  },\n  Form: {\n    cls: FormResource,\n    attrTypes: {\n      payload: 'FormPayload'\n    }\n  },\n  FormPayload: {\n    cls: HalResource,\n    attrTypes: {\n      attachments: 'AttachmentsCollection'\n    }\n  },\n  QueryFilterInstance: {\n    cls: QueryFilterInstanceResource,\n    attrTypes: {\n      schema: 'QueryFilterInstanceSchema',\n      filter: 'QueryFilter',\n      operator: 'QueryOperator'\n    }\n  },\n  QueryFilterInstanceSchema: {\n    cls: QueryFilterInstanceSchemaResource,\n  },\n  QueryFilter: {\n    cls: QueryFilterResource,\n  },\n  Root: {\n    cls: RootResource,\n  },\n  QueryOperator: {\n    cls: QueryOperatorResource,\n  },\n  HelpText: {\n    cls: HelpTextResource,\n  },\n  CustomAction: {\n    cls: CustomActionResource\n  },\n  WikiPage: {\n    cls: WikiPageResource\n  },\n  MeetingContent: {\n    cls: MeetingContentResource\n  },\n  Post: {\n    cls: PostResource\n  },\n  Project: {\n    cls: ProjectResource\n  },\n  Role: {\n    cls: RoleResource\n  },\n  Grid: {\n    cls: GridResource,\n  },\n  GridWidget: {\n    cls: GridWidgetResource\n  },\n  TimeEntry: {\n    cls: TimeEntryResource\n  },\n  Membership: {\n    cls: MembershipResource\n  },\n  News: {\n    cls: NewsResource\n  },\n  Version: {\n    cls: VersionResource\n  }\n};\n\nexport function initializeHalResourceConfig(halResourceService:HalResourceService) {\n  return () => {\n    _.each(halResourceDefaultConfig, (value, key) => halResourceService.registerResource(key, value));\n  };\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {RootResource} from 'core-app/modules/hal/resources/root-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {TypeResource} from 'core-app/modules/hal/resources/type-resource';\nimport {States} from 'core-app/components/states.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\n\n@Injectable()\nexport class TypeDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected states:States,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public loadAll(projectIdentifier:string|undefined):Promise<TypeResource[]> {\n    const typeUrl = this.pathHelper.api.v3.withOptionalProject(projectIdentifier).types.toString();\n\n    return this.halResourceService\n      .get<CollectionResource<TypeResource>>(typeUrl)\n      .toPromise()\n      .then((result:CollectionResource<TypeResource>) => {\n        // TODO move into a TypeCacheService\n        _.each(result.elements, (type) => this.states.types.get(type.href!).putValue(type));\n        return result.elements;\n      });\n  }\n\n  public load():Promise<RootResource> {\n    return this.halResourceService\n      .get<RootResource>(this.pathHelper.api.v3.root.toString())\n      .toPromise();\n  }\n}\n","import {ErrorHandler, Injectable} from \"@angular/core\";\nimport {ErrorResource} from \"core-app/modules/hal/resources/error-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\n\n@Injectable()\nexport class HalAwareErrorHandler extends ErrorHandler {\n  private text = {\n    internal_error: this.I18n.t('js.error.internal')\n  };\n\n  constructor(private readonly I18n:I18nService) {\n    super();\n  }\n\n  public handleError(error:unknown) {\n    let message:string = this.text.internal_error;\n\n    if (error instanceof ErrorResource) {\n      console.error(\"Returned error resource %O\", error);\n      message += ` ${error.errorMessages.join(\"\\n\")}`;\n    } else if (error instanceof HalResource) {\n      console.error(\"Returned hal resource %O\", error);\n      message += `Resource returned ${error.name}`;\n    } else if (error instanceof Error) {\n      window.ErrorReporter.captureException(error);\n    } else if (typeof error === 'string') {\n      window.ErrorReporter.captureMessage(error);\n      message = error;\n    }\n\n    super.handleError(message);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {APP_INITIALIZER, ErrorHandler, NgModule} from '@angular/core';\nimport {HTTP_INTERCEPTORS, HttpClientModule} from '@angular/common/http';\nimport {initializeHalResourceConfig} from 'core-app/modules/hal/services/hal-resource.config';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {ConfigurationDmService} from 'core-app/modules/hal/dm-services/configuration-dm.service';\nimport {HelpTextDmService} from 'core-app/modules/hal/dm-services/help-text-dm.service';\nimport {PayloadDmService} from 'core-app/modules/hal/dm-services/payload-dm.service';\nimport {QueryDmService} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {QueryFormDmService} from 'core-app/modules/hal/dm-services/query-form-dm.service';\nimport {RelationsDmService} from 'core-app/modules/hal/dm-services/relations-dm.service';\nimport {RootDmService} from 'core-app/modules/hal/dm-services/root-dm.service';\nimport {TypeDmService} from 'core-app/modules/hal/dm-services/type-dm.service';\nimport {OpenProjectHeaderInterceptor} from 'core-app/modules/hal/http/openproject-header-interceptor';\nimport {UserDmService} from 'core-app/modules/hal/dm-services/user-dm.service';\nimport {ProjectDmService} from 'core-app/modules/hal/dm-services/project-dm.service';\nimport {GridDmService} from \"core-app/modules/hal/dm-services/grid-dm.service\";\nimport {TimeEntryDmService} from './dm-services/time-entry-dm.service';\nimport {CommonModule} from \"@angular/common\";\nimport {NewsDmService} from './dm-services/news-dm.service';\nimport {StatusDmService} from \"core-app/modules/hal/dm-services/status-dm.service\";\nimport {VersionDmService} from \"core-app/modules/hal/dm-services/version-dm.service\";\nimport {QueryOrderDmService} from \"core-app/modules/hal/dm-services/query-order-dm.service\";\nimport {MembershipDmService} from \"core-app/modules/hal/dm-services/membership-dm.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {HalAwareErrorHandler} from \"core-app/modules/hal/services/hal-aware-error-handler\";\n\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n  ],\n  providers: [\n    { provide: ErrorHandler, useClass: HalAwareErrorHandler },\n    { provide: HTTP_INTERCEPTORS, useClass: OpenProjectHeaderInterceptor, multi: true },\n    { provide: APP_INITIALIZER, useFactory: initializeHalResourceConfig, deps: [HalResourceService], multi: true },\n    ConfigurationDmService,\n    GridDmService,\n    HelpTextDmService,\n    MembershipDmService,\n    NewsDmService,\n    PayloadDmService,\n    ProjectDmService,\n    QueryDmService,\n    QueryOrderDmService,\n    QueryFormDmService,\n    RelationsDmService,\n    RootDmService,\n    TimeEntryDmService,\n    TypeDmService,\n    UserDmService,\n    StatusDmService,\n    VersionDmService,\n    HalResourceNotificationService\n  ]\n})\nexport class OpenprojectHalModule { }\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {OpContextMenuItem} from 'core-components/op-context-menu/op-context-menu.types';\nimport {StateService} from '@uirouter/core';\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {Directive, ElementRef, Input} from \"@angular/core\";\nimport {LinkHandling} from \"core-app/modules/common/link-handling/link-handling\";\nimport {OpContextMenuTrigger} from \"core-components/op-context-menu/handlers/op-context-menu-trigger.directive\";\nimport {TypeResource} from 'core-app/modules/hal/resources/type-resource';\nimport {Highlighting} from 'core-app/components/wp-fast-table/builders/highlighting/highlighting.functions';\nimport {BrowserDetector} from \"core-app/modules/common/browser/browser-detector.service\";\nimport {WorkPackageCreateService} from 'core-components/wp-new/wp-create.service';\n\n@Directive({\n  selector: '[opTypesCreateDropdown]'\n})\nexport class OpTypesContextMenuDirective extends OpContextMenuTrigger {\n  @Input('projectIdentifier') public projectIdentifier:string|null|undefined;\n  @Input('stateName') public stateName:string;\n  @Input('dropdownActive') active:boolean;\n\n  private loadingPromise:Promise<any>;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly browserDetector:BrowserDetector,\n              readonly wpCreate:WorkPackageCreateService,\n              readonly $state:StateService) {\n    super(elementRef, opContextMenu);\n  }\n\n  ngAfterViewInit():void {\n    super.ngAfterViewInit();\n\n    if (!this.active) {\n        return;\n    }\n\n    // Force full-view create if in mobile view\n    if (this.browserDetector.isMobile) {\n      this.stateName = 'work-packages.new';\n    }\n\n    this.loadingPromise = this\n      .wpCreate\n      .getEmptyForm(this.projectIdentifier)\n      .then(form => {\n        return this.buildItems(form.schema.type.allowedValues);\n      });\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.loadingPromise.then(() => {\n      this.opContextMenu.show(this, evt);\n    });\n  }\n\n  public get locals():{ showAnchorRight?:boolean, contextMenuId?:string, items:OpContextMenuItem[] } {\n    return {\n      items: this.items,\n      contextMenuId: 'types-context-menu'\n    };\n  }\n\n  private buildItems(types:TypeResource[]) {\n    this.items = types.map((type:TypeResource) => {\n      return {\n        disabled: false,\n        linkText: type.name,\n        href: this.$state.href(this.stateName, { type: type.id! }),\n        ariaLabel: type.name,\n        class: Highlighting.inlineClass('type', type.id!),\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (LinkHandling.isClickedWithModifier($event)) {\n            return false;\n          }\n\n          this.$state.go(this.stateName, { type: type.id });\n          return true;\n        }\n      };\n    });\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {ChangeDetectorRef, Component, ElementRef, Inject} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport interface ConfirmDialogOptions {\n  text:{\n    title:string;\n    text:string;\n    button_continue?:string;\n    button_cancel?:string;\n  };\n  closeByEscape?:boolean;\n  showClose?:boolean;\n  closeByDocument?:boolean;\n  passedData?:string[];\n  dangerHighlighting?:boolean;\n}\n\n@Component({\n  templateUrl: './confirm-dialog.modal.html'\n})\nexport class ConfirmDialogModal extends OpModalComponent {\n\n  public showClose:boolean;\n\n  public confirmed = false;\n\n  private options:ConfirmDialogOptions;\n\n  public text:any = {\n    title: this.I18n.t('js.modals.form_submit.title'),\n    text: this.I18n.t('js.modals.form_submit.text'),\n    button_continue: this.I18n.t('js.button_continue'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  public passedData:string[];\n\n  public dangerHighlighting:boolean;\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n    this.options = locals.options || {};\n\n    this.dangerHighlighting = _.defaultTo(this.options.dangerHighlighting, false);\n    this.passedData = _.defaultTo(this.options.passedData, []);\n    this.closeOnEscape = _.defaultTo(this.options.closeByEscape, true);\n    this.closeOnOutsideClick = _.defaultTo(this.options.closeByDocument, true);\n    this.showClose = _.defaultTo(this.options.showClose, true);\n    // override default texts if any\n    this.text = _.defaults(this.options.text, this.text);\n  }\n\n  public confirmAndClose(evt:JQuery.TriggeredEvent) {\n    this.confirmed = true;\n    this.closeMe(evt);\n  }\n}\n\n","<div class=\"op-modal--portal confirm-form-submit--modal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container confirm-dialog--modal loading-indicator--location\"\n       [ngClass]=\"{'-highlight -danger-zone' : dangerHighlighting }\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i\n          class=\"icon-close\"\n          (click)=\"closeMe($event)\"\n          [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <p>\n        <span [textContent]=\"text.text\"></span>\n        <br/>\n        <span *ngFor=\"let data of passedData\">\n          <br/>\n          <strong>{{data}}</strong>\n        </span>\n      </p>\n    </div>\n\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"confirm-form-submit--continue button\"\n              [ngClass]=\"dangerHighlighting ? '-danger': '-highlight'\"\n              (click)=\"confirmAndClose($event)\"\n              [textContent]=\"text.button_continue\"\n              [attr.title]=\"text.button_continue\">\n      </button>\n      <button class=\"confirm-form-submit--cancel button\"\n              (click)=\"closeMe($event)\"\n              [textContent]=\"text.button_cancel\"\n              [attr.title]=\"text.button_cancel\">\n      </button>\n\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++    Ng1FieldControlsWrapper,\n\n\nimport {FormsModule} from \"@angular/forms\";\nimport {NgModule} from \"@angular/core\";\nimport {AccessibleClickDirective} from \"core-app/modules/a11y/accessible-click.directive\";\nimport {AccessibleByKeyboardComponent} from \"core-app/modules/a11y/accessible-by-keyboard.component\";\nimport {CommonModule} from \"@angular/common\";\nimport {DoubleClickOrTapDirective} from \"core-app/modules/a11y/double-click-or-tap.directive\";\n\n@NgModule({\n  imports: [\n    FormsModule,\n    CommonModule,\n  ],\n  exports: [\n    AccessibleClickDirective,\n    DoubleClickOrTapDirective,\n    AccessibleByKeyboardComponent,\n  ],\n  declarations: [\n    AccessibleClickDirective,\n    AccessibleByKeyboardComponent,\n    DoubleClickOrTapDirective,\n  ]\n})\nexport class OpenprojectAccessibilityModule {\n}\n\n\n","<i class=\"icon-info1\" aria-hidden=\"true\"></i>\n<span class=\"generic-table--no-results-title\">\n  {{ title }}\n  <span *ngIf=\"description\" [textContent]=\"description\"></span>\n</span>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, HostBinding} from '@angular/core';\n\n@Component({\n  templateUrl: './no-results.component.html',\n  selector: 'no-results'\n})\n\nexport class NoResultsComponent {\n  @Input() title:string;\n  @Input() description:string;\n\n  @HostBinding('class.generic-table--no-results-container') setHostClass = true;\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {groupName} from './grouped-rows-helpers';\nimport {GroupObject} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {rowGroupClassName} from \"core-components/wp-fast-table/builders/modes/grouped/grouped-classes.constants\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport function groupClassNameFor(group:GroupObject) {\n  return `group-${group.identifier}`;\n}\n\nexport class GroupHeaderBuilder {\n\n  @InjectField() public I18n:I18nService;\n  public text:{ collapse:string, expand:string };\n\n  constructor(public readonly injector:Injector) {\n    this.text = {\n      collapse: this.I18n.t('js.label_collapse'),\n      expand: this.I18n.t('js.label_expand'),\n    };\n  }\n\n  public buildGroupRow(group:GroupObject, colspan:number) {\n    let row = document.createElement('tr');\n    let togglerIconClass, text;\n\n    if (group.collapsed) {\n      text = this.text.expand;\n      togglerIconClass = 'icon-plus';\n    } else {\n      text = this.text.collapse;\n      togglerIconClass = 'icon-minus2';\n    }\n\n    row.classList.add(rowGroupClassName, groupClassNameFor(group));\n    row.id = `wp-table-rowgroup-${group.index}`;\n    row.dataset['groupIndex'] = (group.index).toString();\n    row.dataset['groupIdentifier'] = group.identifier;\n    row.innerHTML = `\n      <td colspan=\"${colspan}\" class=\"-no-highlighting\">\n        <div class=\"expander icon-context ${togglerIconClass}\">\n          <span class=\"hidden-for-sighted\">${_.escape(text)}</span>\n        </div>\n        <div class=\"group--value\">\n          ${_.escape(groupName(group))}\n          <span class=\"count\">\n            (${group.count})\n          </span>\n        </div>\n      </td>\n    `;\n\n    return row;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageTable} from '../../../wp-fast-table';\nimport {WorkPackageTableRow} from '../../../wp-table.interfaces';\nimport {SingleRowBuilder} from '../../rows/single-row-builder';\nimport {PlainRenderPass} from '../plain/plain-render-pass';\nimport {groupClassNameFor, GroupHeaderBuilder} from './group-header-builder';\nimport {groupByProperty, groupedRowClassName} from './grouped-rows-helpers';\nimport {GroupObject} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {collapsedRowClass} from \"core-components/wp-fast-table/builders/modes/grouped/grouped-classes.constants\";\n\nexport class GroupedRenderPass extends PlainRenderPass {\n\n  constructor(public readonly injector:Injector,\n              public workPackageTable:WorkPackageTable,\n              public groups:GroupObject[],\n              public headerBuilder:GroupHeaderBuilder,\n              public colspan:number) {\n\n    super(injector, workPackageTable, new SingleRowBuilder(injector, workPackageTable));\n  }\n\n  /**\n   * Rebuild the entire grouped tbody from the given table\n   */\n  protected doRender() {\n    let currentGroup:GroupObject | null = null;\n    this.workPackageTable.originalRows.forEach((wpId:string) => {\n      let row = this.workPackageTable.originalRowIndex[wpId];\n      let nextGroup = this.matchingGroup(row.object);\n\n      if (nextGroup && currentGroup !== nextGroup) {\n        const groupClass = groupClassNameFor(nextGroup);\n        let rowElement = this.headerBuilder.buildGroupRow(nextGroup, this.colspan);\n        this.appendNonWorkPackageRow(rowElement, groupClass);\n        currentGroup = nextGroup;\n      }\n\n      row.group = currentGroup;\n      this.buildSingleRow(row);\n    });\n  }\n\n  /**\n   * Find a matching group for the given work package.\n   * The API sadly doesn't provide us with the information which group a WP belongs to.\n   */\n  private matchingGroup(workPackage:WorkPackageResource) {\n    return _.find(this.groups, (group:GroupObject) => {\n      let property = workPackage[groupByProperty(group)];\n      // explicitly check for undefined as `false` (bool) is a valid value.\n      if (property === undefined) {\n        property = null;\n      }\n\n      // If the property is a multi-value\n      // Compare the href's of all resources with the ones in valueLink\n      if (_.isArray(property)) {\n        return this.matchesMultiValue(property as HalResource[], group);\n      }\n\n      //// If its a linked resource, compare the href,\n      //// which is an array of links the resource offers\n      if (property && property.$href) {\n        return !!_.find(group._links.valueLink, (l:any):any => property.$href === l.href);\n      }\n\n      // Otherwise, fall back to simple value comparison.\n      let value = group.value === '' ? null : group.value;\n\n      if (value) {\n        // For matching we have to remove the % sign which is shown when grouping after progress\n        value = value.replace('%', '');\n      }\n\n      // Values provided by the API are always string\n      // so avoid triple equal here\n      // tslint:disable-next-line\n      return value == property;\n    }) as GroupObject;\n  }\n\n  private matchesMultiValue(property:HalResource[], group:GroupObject) {\n    if (property.length !== group.href.length) {\n      return false;\n    }\n\n    let joinedOrderedHrefs = (objects:any[]) => {\n      return _.map(objects, object => object.href).sort().join(', ');\n    };\n\n    return _.isEqualWith(\n      property,\n      group.href,\n      (a, b) => joinedOrderedHrefs(a) === joinedOrderedHrefs(b)\n    );\n  }\n\n  /**\n   * Enhance a row from the rowBuilder with group information.\n   */\n  private buildSingleRow(row:WorkPackageTableRow):void {\n    const group = row.group!;\n    const hidden = group.collapsed;\n\n    let additionalClasses:string[] = [];\n\n    let [tr, _] = this.rowBuilder.buildEmpty(row.object);\n    additionalClasses.push(groupedRowClassName(group.index));\n\n    if (hidden) {\n      additionalClasses.push(collapsedRowClass);\n    }\n\n\n    row.element = tr;\n    tr.classList.add(...additionalClasses);\n    this.appendRow(row.object, tr, additionalClasses, hidden);\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {States} from '../../../../states.service';\nimport {WorkPackageTable} from '../../../wp-fast-table';\nimport {tableRowClassName} from '../../rows/single-row-builder';\nimport {RowsBuilder} from '../rows-builder';\nimport {GroupHeaderBuilder} from './group-header-builder';\nimport {GroupedRenderPass} from './grouped-render-pass';\nimport {groupedRowClassName, groupIdentifier} from './grouped-rows-helpers';\nimport {GroupObject} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {\n  collapsedRowClass,\n  rowGroupClassName\n} from \"core-components/wp-fast-table/builders/modes/grouped/grouped-classes.constants\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class GroupedRowsBuilder extends RowsBuilder {\n\n  // Injections\n  @InjectField() private readonly querySpace:IsolatedQuerySpace;\n  @InjectField() public states:States;\n  @InjectField() public wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() public I18n:I18nService;\n\n  constructor(public readonly injector:Injector, workPackageTable:WorkPackageTable) {\n    super(injector, workPackageTable);\n  }\n\n  /**\n   * The hierarchy builder is only applicable if the hierachy mode is active\n   */\n  public isApplicable(table:WorkPackageTable) {\n    return !_.isEmpty(this.groups);\n  }\n\n  /**\n   * Returns the reference to the last table.groups state value\n   */\n  public get groups() {\n    return this.querySpace.groups.value || [];\n  }\n\n  /**\n   * Returns the reference to the last table.collapesedGroups state value\n   */\n  public get collapsedGroups() {\n    return this.querySpace.collapsedGroups.value || {};\n  }\n\n  public get colspan() {\n    // Columns + manual sorting column + settings column\n    return this.wpTableColumns.columnCount + 2;\n  }\n\n  public buildRows() {\n    const builder = new GroupHeaderBuilder(this.injector);\n    return new GroupedRenderPass(\n      this.injector,\n      this.workPackageTable,\n      this.getGroupData(),\n      builder,\n      this.colspan\n    ).render();\n  }\n\n  /**\n   * Refresh the group expansion state\n   */\n  public refreshExpansionState() {\n    const groups = this.getGroupData();\n    const colspan = this.wpTableColumns.columnCount + 1;\n    const rendered = this.querySpace.tableRendered.value!;\n    const builder = new GroupHeaderBuilder(this.injector);\n\n    jQuery(this.workPackageTable.tableAndTimelineContainer)\n      .find(`.${rowGroupClassName}`)\n      .each((i:number, oldRow:Element) => {\n        let groupIndex = jQuery(oldRow).data('groupIndex');\n        let group = groups[groupIndex];\n\n        // Refresh the group header\n        let newRow = builder.buildGroupRow(group, colspan);\n\n        if (oldRow.parentNode) {\n          oldRow.parentNode.replaceChild(newRow, oldRow);\n        }\n\n        // Set expansion state of contained rows\n        const affected = jQuery(this.workPackageTable.tableAndTimelineContainer)\n                          .find(`.${groupedRowClassName(groupIndex)}`);\n        affected.toggleClass(collapsedRowClass, !!group.collapsed);\n\n        // Update the hidden section of the rendered state\n        affected.filter(`.${tableRowClassName}`).each((i, el) => {\n          // Get the index of this row\n          const index = jQuery(el).index();\n\n          // Update the hidden state\n          rendered[index].hidden = !!group.collapsed;\n        });\n      });\n\n    this.querySpace.tableRendered.putValue(rendered, 'Updated hidden state of rows after group change.');\n  }\n\n  /**\n   * Augment the given groups with the current collapsed state data.\n   */\n  private getGroupData() {\n    return this.groups.map((group:GroupObject, index:number) => {\n      group.index = index;\n      if (group._links && group._links.valueLink) {\n        group.href = group._links.valueLink;\n      }\n      group.identifier = groupIdentifier(group);\n      group.collapsed = this.collapsedGroups[group.identifier];\n      return group;\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector} from '@angular/core';\nimport {Field} from \"core-app/modules/fields/field.base\";\n\nexport interface IFieldType<T extends Field> {\n  fieldType:string;\n  $injector:Injector;\n  new(...args:any[]):T;\n}\n\nexport abstract class AbstractFieldService<T extends Field, C extends IFieldType<T>> {\n  /** Default field type to fall back to */\n  public defaultFieldType:string;\n\n  /** Registered attribute types => field identifier */\n  protected fields:{[attributeType:string]:string} = {};\n\n  /** Registered field classes */\n  protected classes:{[type:string]:C} = {};\n\n  /**\n   * Get the field type for the given attribute type.\n   * If no registered type exists for the field, returns the default type.\n   *\n   * @param {string} attributeType\n   * @returns {string}\n   */\n  public fieldType(attributeType:string):string|undefined {\n    return this.fields[attributeType];\n  }\n\n  /**\n   * Get the Field class for the given field name.\n   * Returns the default class if no registered type exists\n   * @param {string} fieldName\n   * @returns {C}\n   */\n  public getClassFor(fieldName:string, type:string = 'unknown'):C {\n    let key = this.fieldType(fieldName) || this.fieldType(type) || this.defaultFieldType;\n    return this.classes[key];\n  }\n\n  public getSpecificClassFor(resourceType:string, fieldName:string, type:string = 'unknown'):C {\n    let key = this.fieldType(`${resourceType}-${fieldName}`) ||\n              this.fieldType(`${resourceType}-${type}`);\n\n    if (key) {\n      return this.classes[key];\n    }\n\n    return this.getClassFor(fieldName, type);\n  }\n\n  /**\n   * Add a field class for the given attribute names.\n   *\n   * @param fieldClass The field class\n   * @param {string} fieldType the field type identifier (e.g., 'progress')\n   * @param {string[]} attributes The schema attribute names to register for (e.g., 'Progress')\n   *\n   * @returns {this}\n   */\n  public addFieldType(fieldClass:any, fieldType:string, attributes:string[]) {\n    fieldClass.fieldType = fieldType;\n    this.register(fieldClass, attributes);\n\n    return this;\n  }\n\n  /**\n   * Add a field class for the given attribute names and a specify resource.\n   *\n   * @param resourceType The resource type (e.g Work Package)\n   * @param fieldClass The field class\n   * @param {string} fieldType the field type identifier (e.g., 'progress')\n   * @param {string[]} attributes The schema attribute names to register for (e.g., 'Progress')\n   *\n   * @returns {this}\n   */\n  public addSpecificFieldType(resourceType:string, fieldClass:any, fieldType:string, attributes:string[]) {\n    fieldClass.fieldType = `${resourceType}-${fieldType}`;\n    attributes = attributes.map((attribute) => `${resourceType}-${attribute}`);\n    this.register(fieldClass, attributes);\n\n    return this;\n  }\n\n  /**\n   * Register new schema attribute names for an existing field type\n   *\n   * @param {string} fieldType The field type to extend (e.g., 'select')\n   * @param {string[]} attributes The attribute schema names to register to the existing fieldType (e.g., 'budget')\n   *\n   * @returns {this}\n   */\n  public extendFieldType(fieldType:string, attributes:string[]) {\n    let fieldClass = this.classes[fieldType] || this.getClassFor(fieldType);\n    return this.addFieldType(fieldClass, fieldType, attributes);\n  }\n\n  /**\n   * Register the\n   * @param {C} fieldClass\n   * @param {string[]} fields\n   */\n  protected register(fieldClass:C, fields:string[] = []) {\n    const type = fieldClass.fieldType;\n    fields.forEach((field:string) => this.fields[field] = type);\n    this.classes[type] = fieldClass;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {ConfigurationDmService} from \"core-app/modules/hal/dm-services/configuration-dm.service\";\nimport {ConfigurationResource} from \"core-app/modules/hal/resources/configuration-resource\";\nimport * as moment from \"moment\";\n\n@Injectable({ providedIn: 'root' })\nexport class ConfigurationService {\n  // fetches configuration from the ApiV3 endpoint\n  // TODO: this currently saves the request between page reloads,\n  // but could easily be stored in localStorage\n  private configuration:ConfigurationResource;\n  public initialized:Promise<Boolean>;\n\n  public constructor(readonly I18n:I18nService,\n                     readonly configurationDm:ConfigurationDmService) {\n    this.initialized = this.loadConfiguration().then(() => true).catch(() => false);\n  }\n\n  public commentsSortedInDescendingOrder() {\n    return this.userPreference('commentSortDescending');\n  }\n\n  public warnOnLeavingUnsaved() {\n    return this.userPreference('warnOnLeavingUnsaved');\n  }\n\n  public autoHidePopups() {\n    return this.userPreference('autoHidePopups');\n  }\n\n  public isTimezoneSet()  {\n    return !!this.timezone();\n  }\n\n  public timezone()  {\n    return this.userPreference('timeZone');\n  }\n\n  public get maximumAttachmentFileSize() {\n    return this.systemPreference('maximumAttachmentFileSize');\n  }\n\n  public get perPageOptions() {\n    return this.systemPreference('perPageOptions');\n  }\n\n  public dateFormatPresent()  {\n    return !!this.systemPreference('dateFormat');\n  }\n\n  public dateFormat()  {\n    return this.systemPreference('dateFormat');\n  }\n\n  public timeFormatPresent()  {\n    return !!this.systemPreference('timeFormat');\n  }\n\n  public timeFormat()  {\n    return this.systemPreference('timeFormat');\n  }\n\n  public startOfWeekPresent()  {\n    return !!this.systemPreference('startOfWeek');\n  }\n\n  public startOfWeek()  {\n    if (this.startOfWeekPresent()) {\n      return this.systemPreference('startOfWeek');\n    } else {\n      return moment.localeData(I18n.locale).firstDayOfWeek();\n    }\n  }\n\n  private loadConfiguration() {\n    return this.configurationDm.load().toPromise().then((configuration) => {\n      this.configuration = configuration;\n    });\n  }\n\n  private userPreference(pref:string) {\n    return _.get(this.configuration, ['userPreferences', pref]);\n  }\n\n  private systemPreference(pref:string) {\n    return _.get(this.configuration, pref);\n  }\n}\n","import {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {OpContextMenuItem} from 'core-components/op-context-menu/op-context-menu.types';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n/**\n * Interface passed to CM service to open a particular context menu.\n * This will often be a trigger component, but does not have to be.\n */\nexport abstract class OpContextMenuHandler extends UntilDestroyedMixin {\n  protected $element:JQuery;\n  protected items:OpContextMenuItem[] = [];\n\n  constructor(readonly opContextMenu:OPContextMenuService) {\n    super();\n  }\n\n  /**\n   * Called when the service closes this context menu\n   */\n  public onClose() {\n    this.afterFocusOn.focus();\n  }\n\n  public onOpen(menu:JQuery) {\n    menu.find('.menu-item').first().focus();\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(openerEvent:JQuery.TriggeredEvent):any {\n    return {\n      my: 'left top',\n      at: 'right bottom',\n      of: openerEvent,\n      collision: 'flipfit'\n    };\n  }\n\n  /**\n   * Get the locals passed to the op-context-menu component\n   */\n  public get locals():{ showAnchorRight?:boolean, contextMenuId?:string, items:OpContextMenuItem[] } {\n    return {\n      items: this.items\n    };\n  }\n\n  /**\n   * Open this context menu\n   */\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.opContextMenu.show(this, evt);\n  }\n\n  protected get afterFocusOn():JQuery {\n    return this.$element;\n  }\n}\n","export namespace DragAndDropHelpers {\n  export function findIndex(el:HTMLElement):number {\n    if (!el.parentElement) {\n      return -1;\n    }\n\n    const children = Array.from(el.parentElement.children);\n    return children.indexOf(el);\n  }\n\n  export function reinsert(el:HTMLElement, index:number|string, container:HTMLElement) {\n    index = typeof index === 'string' ? parseInt(index, 10) : index;\n\n    const children = Array.from(container.children);\n\n    // Append to end if unknown index or no child nodes\n    if (index < 0 || index >= children.length || children.length === 0) {\n      container.appendChild(el);\n    }\n\n    // Get the element to insert before\n    const sibling = children[index];\n    if (sibling) {\n      container.insertBefore(el, sibling);\n    } else {\n      container.appendChild(el);\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {RootResource} from 'core-app/modules/hal/resources/root-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\n\n@Injectable()\nexport class RootDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public load():Promise<RootResource> {\n    return this.halResourceService\n      .get<RootResource>(this.pathHelper.api.v3.root.toString())\n      .toPromise();\n  }\n}\n","import {Injector} from '@angular/core';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {States} from '../../../states.service';\nimport {displayClassName, editableClassName, readOnlyClassName} from '../../../wp-edit-form/display-field-renderer';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {ClickOrEnterHandler} from '../click-or-enter-handler';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {ClickPositionMapper} from \"core-app/modules/common/set-click-position/set-click-position\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class EditCellHandler extends ClickOrEnterHandler implements TableEventHandler {\n\n  // Injections\n  @InjectField() public states:States;\n  @InjectField() public halEditing:HalResourceEditingService;\n\n  // Keep a reference to all\n\n  public get EVENT() {\n    return 'click.table.cell, keydown.table.cell';\n  }\n\n  public get SELECTOR() {\n    return `.${displayClassName}.${editableClassName}`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tableAndTimelineContainer);\n  }\n\n  constructor(public readonly injector:Injector, table:WorkPackageTable) {\n    super();\n  }\n\n  protected processEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean {\n    debugLog('Starting editing on cell: ', evt.target);\n    evt.preventDefault();\n\n    // Locate the cell from event\n    let target = jQuery(evt.target).closest(`.${displayClassName}`);\n    // Get the target field name\n    let fieldName = target.data('fieldName');\n\n    if (!fieldName) {\n      debugLog('Click handled by cell not a field? ', evt.target);\n      return true;\n    }\n\n    // Locate the row\n    const rowElement = target.closest(`.${tableRowClassName}`);\n    // Get the work package we're editing\n    const workPackageId = rowElement.data('workPackageId');\n    const workPackage = this.states.workPackages.get(workPackageId).value!;\n    // Get the row context\n    const classIdentifier = rowElement.data('classIdentifier');\n\n    // Get any existing edit state for this work package\n    const form = table.editing.startEditing(workPackage, classIdentifier);\n\n    // Get the position where the user clicked.\n    const positionOffset = ClickPositionMapper.getPosition(evt);\n\n    // Activate the field\n    form.activate(fieldName)\n      .then((handler) => {\n        handler.$onUserActivate.next();\n        handler.focus(positionOffset);\n      })\n      .catch(() => target.addClass(readOnlyClassName));\n\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {relationCellIndicatorClassName, relationCellTdClassName} from '../../builders/relation-cell-builder';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {ClickOrEnterHandler} from '../click-or-enter-handler';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class RelationsCellHandler extends ClickOrEnterHandler implements TableEventHandler {\n\n  // Injections\n  @InjectField() wpTableRelationColumns:WorkPackageViewRelationColumnsService;\n\n  public get EVENT() {\n    return 'click.table.relationsCell, keydown.table.relationsCell';\n  }\n\n  public get SELECTOR() {\n    return `.${relationCellIndicatorClassName}`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tableAndTimelineContainer);\n  }\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n    super();\n  }\n\n  protected processEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean {\n    debugLog('Handled click on relation cell %o', evt.target);\n    evt.preventDefault();\n\n    // Locate the relation td\n    const td = jQuery(evt.target).closest(`.${relationCellTdClassName}`);\n    const columnId = td.data('columnId');\n\n    // Locate the row\n    const rowElement = jQuery(evt.target).closest(`.${tableRowClassName}`);\n    const workPackageId = rowElement.data('workPackageId');\n\n    // If currently expanded\n    if (this.wpTableRelationColumns.getExpandFor(workPackageId) === columnId) {\n      this.wpTableRelationColumns.collapse(workPackageId);\n    } else {\n      this.wpTableRelationColumns.setExpandFor(workPackageId, columnId);\n    }\n\n    return false;\n  }\n}\n","import {Injector} from \"@angular/core\";\nimport {WorkPackageAction} from \"core-components/wp-table/context-menu-helper/wp-context-menu-helper.service\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageViewContextMenu} from \"core-components/op-context-menu/wp-context-menu/wp-view-context-menu.directive\";\nimport {WorkPackageViewHierarchyIdentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy-indentation.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageTableContextMenu extends WorkPackageViewContextMenu {\n\n  @InjectField() wpViewIndentation:WorkPackageViewHierarchyIdentationService;\n\n  constructor(public injector:Injector,\n              protected workPackageId:string,\n              protected $element:JQuery,\n              protected additionalPositionArgs:any = {},\n              protected table:WorkPackageTable) {\n    super(injector, workPackageId, $element, additionalPositionArgs, true);\n  }\n\n  public triggerContextMenuAction(action:WorkPackageAction) {\n    switch (action.key) {\n      case 'relation-precedes':\n        this.table.timelineController.startAddRelationPredecessor(this.workPackage);\n        break;\n\n      case 'relation-follows':\n        this.table.timelineController.startAddRelationFollower(this.workPackage);\n        break;\n\n      case 'hierarchy-indent':\n        this.wpViewIndentation.indent(this.workPackage);\n        break;\n\n      case 'hierarchy-outdent':\n        this.wpViewIndentation.outdent(this.workPackage);\n        break;\n\n      default:\n        super.triggerContextMenuAction(action);\n        break;\n    }\n  }\n}\n","import {Injector} from '@angular/core';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {WorkPackageTableContextMenu} from \"core-components/op-context-menu/wp-context-menu/wp-table-context-menu.directive\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport abstract class ContextMenuHandler implements TableEventHandler {\n  // Injections\n  @InjectField() public opContextMenu:OPContextMenuService;\n\n  constructor(public readonly injector:Injector,\n              protected table:WorkPackageTable) {\n  }\n\n  public get rowSelector() {\n    return `.${tableRowClassName}`;\n  }\n\n  public abstract get EVENT():string;\n\n  public abstract get SELECTOR():string;\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tableAndTimelineContainer);\n  }\n\n  public abstract handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean;\n\n  protected openContextMenu(evt:JQuery.TriggeredEvent, workPackageId:string, positionArgs?:any):void {\n    const handler = new WorkPackageTableContextMenu(this.injector, workPackageId, jQuery(evt.target) as JQuery, positionArgs, this.table);\n    this.opContextMenu.show(handler, evt);\n  }\n}\n","import {Injector} from '@angular/core';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {uiStateLinkClass} from '../../builders/ui-state-link-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {ContextMenuHandler} from './context-menu-handler';\nimport {contextMenuLinkClassName} from \"core-components/wp-table/table-actions/table-action\";\n\nexport class ContextMenuClickHandler extends ContextMenuHandler {\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n    super(injector, table);\n  }\n\n  public get EVENT() {\n    return 'click.table.contextmenu';\n  }\n\n  public get SELECTOR() {\n    return `.${contextMenuLinkClassName}`;\n  }\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean {\n    let target = jQuery(evt.target);\n\n    // We want to keep the original context menu on hrefs\n    // (currently, this is only the id\n    if (target.closest(`.${uiStateLinkClass}`).length) {\n      debugLog('Allowing original context menu on state link');\n      return true;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    // Locate the row from event\n    const element = target.closest(this.rowSelector);\n    const wpId = element.data('workPackageId');\n\n    if (wpId) {\n      super.openContextMenu(evt, wpId);\n    }\n\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {ContextMenuHandler} from './context-menu-handler';\n\nexport class ContextMenuKeyboardHandler extends ContextMenuHandler {\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n    super(injector, table);\n  }\n\n  public get EVENT() {\n    return 'keydown.table.contextmenu';\n  }\n\n  public get SELECTOR() {\n    return this.rowSelector;\n  }\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean {\n    if (!table.configuration.contextMenuEnabled) {\n      return false;\n    }\n\n    let target = jQuery(evt.target);\n\n    if (!(evt.keyCode === keyCodes.F10 && evt.shiftKey && evt.altKey)) {\n      return true;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    // Locate the row from event\n    const element = target.closest(this.SELECTOR);\n    const wpId = element.data('workPackageId');\n\n    // Set position args to open at element\n    let position = { my: 'left top', at: 'left bottom', of: target };\n\n    super.openContextMenu(evt, wpId, position);\n\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {timelineCellClassName} from '../../builders/timeline/timeline-row-builder';\nimport {uiStateLinkClass} from '../../builders/ui-state-link-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {ContextMenuHandler} from './context-menu-handler';\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class ContextMenuRightClickHandler extends ContextMenuHandler {\n\n  @InjectField() readonly wpTableSelection:WorkPackageViewSelectionService;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n\n    super(injector, table);\n  }\n\n  public get EVENT() {\n    return 'contextmenu.table.rightclick';\n  }\n\n  public get SELECTOR() {\n    return `.${tableRowClassName},.${timelineCellClassName}`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tableAndTimelineContainer);\n  }\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean {\n    if (!table.configuration.contextMenuEnabled) {\n      return false;\n    }\n    let target = jQuery(evt.target);\n\n    // We want to keep the original context menu on hrefs\n    // (currently, this is only the id\n    if (target.closest(`.${uiStateLinkClass}`).length) {\n      debugLog('Allowing original context menu on state link');\n      return true;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    // Locate the row from event\n    const element = target.closest(this.SELECTOR);\n    const wpId = element.data('workPackageId');\n\n    if (wpId) {\n      let [index,] = this.table.findRenderedRow(wpId);\n\n      if (!this.wpTableSelection.isSelected(wpId)) {\n        this.wpTableSelection.setSelection(wpId, index);\n      }\n\n      super.openContextMenu(evt, wpId);\n    }\n\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {StateService} from '@uirouter/core';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {States} from '../../../states.service';\nimport {KeepTabService} from '../../../wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {displayClassName} from \"core-components/wp-edit-form/display-field-renderer\";\nimport {activeFieldClassName} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class RowClickHandler implements TableEventHandler {\n\n  // Injections\n  @InjectField() public $state:StateService;\n  @InjectField() public states:States;\n  @InjectField() public keepTab:KeepTabService;\n  @InjectField() public wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() public wpTableFocus:WorkPackageViewFocusService;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n  }\n\n  public get EVENT() {\n    return 'click.table.row';\n  }\n\n  public get SELECTOR() {\n    return `.${tableRowClassName}`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tbody);\n  }\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent) {\n    let target = jQuery(evt.target);\n\n    // Ignore links\n    if (target.is('a') || target.parent().is('a')) {\n      return true;\n    }\n\n    // Shortcut to any clicks within a cell\n    // We don't want to handle these.\n    if (target.hasClass(`${displayClassName}`) || target.hasClass(`${activeFieldClassName}`)) {\n      debugLog('Skipping click on inner cell');\n      return true;\n    }\n\n    // Locate the row from event\n    let element = target.closest(this.SELECTOR);\n    let wpId = element.data('workPackageId');\n    let classIdentifier = element.data('classIdentifier');\n\n    if (!wpId) {\n      return true;\n    }\n\n    let [index, row] = table.findRenderedRow(classIdentifier);\n\n    // Update single selection if no modifier present\n    if (!(evt.ctrlKey || evt.metaKey || evt.shiftKey)) {\n      this.wpTableSelection.setSelection(wpId, index);\n    }\n\n    // Multiple selection if shift present\n    if (evt.shiftKey) {\n      this.wpTableSelection.setMultiSelectionFrom(table.renderedRows, wpId, index);\n    }\n\n    // Single selection expansion if ctrl / cmd(mac)\n    if (evt.ctrlKey || evt.metaKey) {\n      this.wpTableSelection.toggleRow(wpId);\n    }\n\n    // The current row is the last selected work package\n    // not matter what other rows are (de-)selected below.\n    // Thus save that row for the details view button.\n    this.wpTableFocus.updateFocus(wpId);\n    return false;\n  }\n}\n\n","import {Injector} from '@angular/core';\nimport {StateService} from '@uirouter/core';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {States} from '../../../states.service';\nimport {tdClassName} from '../../builders/cell-builder';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {LinkHandling} from \"core-app/modules/common/link-handling/link-handling\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {displayClassName} from \"core-components/wp-edit-form/display-field-renderer\";\nimport {activeFieldClassName} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class RowDoubleClickHandler implements TableEventHandler {\n\n  // Injections\n  @InjectField() public $state:StateService;\n  @InjectField() public states:States;\n  @InjectField() public wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() public wpTableFocus:WorkPackageViewFocusService;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n  }\n\n  public get EVENT() {\n    return 'dblclick.table.row';\n  }\n\n  public get SELECTOR() {\n    return `.${tdClassName}`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tbody);\n  }\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent) {\n    let target = jQuery(evt.target);\n\n    // Skip clicks with modifiers\n    if (LinkHandling.isClickedWithModifier(evt)) {\n      return true;\n    }\n\n    // Shortcut to any clicks within a cell\n    // We don't want to handle these.\n    if (target.hasClass(`${displayClassName}`) || target.hasClass(`${activeFieldClassName}`)) {\n      debugLog('Skipping click on inner cell');\n      return true;\n    }\n\n    // Locate the row from event\n    let element = target.closest(this.SELECTOR).closest(`.${tableRowClassName}`);\n    let wpId = element.data('workPackageId');\n\n    // Ignore links\n    if (target.is('a') || target.parent().is('a')) {\n      return true;\n    }\n\n    // Save the currently focused work package\n    this.wpTableFocus.updateFocus(wpId);\n\n    this.$state.go(\n      'work-packages.show',\n      {workPackageId: wpId}\n    );\n\n    return false;\n  }\n}\n\n","import {Injector} from '@angular/core';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {GroupedRowsBuilder} from '../../builders/modes/grouped/grouped-rows-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {rowGroupClassName} from \"core-components/wp-fast-table/builders/modes/grouped/grouped-classes.constants\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class GroupRowHandler implements TableEventHandler {\n\n  // Injections\n  @InjectField() public querySpace:IsolatedQuerySpace;\n\n  private builder:GroupedRowsBuilder;\n\n  constructor(public readonly injector:Injector, table:WorkPackageTable) {\n    this.builder = new GroupedRowsBuilder(injector, table);\n  }\n\n  public get EVENT() {\n    return 'click.table.groupheader';\n  }\n\n  public get SELECTOR() {\n    return `.${rowGroupClassName} .expander`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tbody);\n  }\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    let groupHeader = jQuery(evt.target).parents(`.${rowGroupClassName}`);\n    let groupIdentifier = groupHeader.data('groupIdentifier');\n    let state = this.collapsedState.value || {};\n\n    state[groupIdentifier] = !state[groupIdentifier];\n    this.collapsedState.putValue(state);\n\n    // Refresh groups\n    var t0 = performance.now();\n    this.builder.refreshExpansionState();\n    var t1 = performance.now();\n    debugLog('Group redraw took ' + (t1 - t0) + ' milliseconds.');\n  }\n\n  private get collapsedState() {\n    return this.querySpace.collapsedGroups;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {States} from '../../../states.service';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {ClickOrEnterHandler} from '../click-or-enter-handler';\nimport {TableEventHandler} from \"core-components/wp-fast-table/handlers/table-handler-registry\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HierarchyClickHandler extends ClickOrEnterHandler implements TableEventHandler {\n  // Injections\n  @InjectField() public states:States;\n  @InjectField() public wpTableHierarchies:WorkPackageViewHierarchiesService;\n\n  constructor(public readonly injector:Injector, table:WorkPackageTable) {\n    super();\n  }\n\n  public get EVENT() {\n    return 'click.table.hierarchy';\n  }\n\n  public get SELECTOR() {\n    return `.wp-table--hierarchy-indicator`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tbody);\n  }\n\n  public processEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean {\n    let target = jQuery(evt.target);\n\n    // Locate the row from event\n    let element = target.closest(`.${tableRowClassName}`);\n    let wpId = element.data('workPackageId');\n\n    this.wpTableHierarchies.toggle(wpId);\n\n    evt.stopImmediatePropagation();\n    evt.preventDefault();\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {States} from '../../../states.service';\nimport {KeepTabService} from '../../../wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {uiStateLinkClass} from '../../builders/ui-state-link-builder';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {TableEventHandler} from '../table-handler-registry';\nimport {StateService} from '@uirouter/core';\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageStateLinksHandler implements TableEventHandler {\n\n  // Injections\n  @InjectField() public $state:StateService;\n  @InjectField() public keepTab:KeepTabService;\n  @InjectField() public states:States;\n  @InjectField() public wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() public wpTableFocus:WorkPackageViewFocusService;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n  }\n\n  public get EVENT() {\n    return 'click.table.wpLink';\n  }\n\n  public get SELECTOR() {\n    return `.${uiStateLinkClass}`;\n  }\n\n  public eventScope(table:WorkPackageTable) {\n    return jQuery(table.tableAndTimelineContainer);\n  }\n\n  protected workPackage:WorkPackageResource;\n\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent) {\n    // Avoid the state capture when clicking with modifier\n    if (evt.shiftKey || evt.ctrlKey || evt.metaKey || evt.altKey) {\n      return true;\n    }\n\n    // Locate the details link from event\n    const target = jQuery(evt.target);\n    const element = target.closest(this.SELECTOR);\n    const state = element.data('wpState');\n    const workPackageId = element.data('workPackageId');\n\n    // Blur the target to avoid focus being kept there\n    target.closest('a').blur();\n\n    // The current row is the last selected work package\n    // not matter what other rows are (de-)selected below.\n    // Thus save that row for the details view button.\n    // Locate the row from event\n    let row = target.closest(`.${tableRowClassName}`);\n    let classIdentifier = row.data('classIdentifier');\n    let [index, _] = table.findRenderedRow(classIdentifier);\n\n    // Update single selection if no modifier present\n    this.wpTableSelection.setSelection(workPackageId, index);\n\n    this.$state.go(\n      (this.keepTab as any)[state],\n      {workPackageId: workPackageId, focus: true}\n    );\n\n    evt.preventDefault();\n    evt.stopPropagation();\n    return false;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {debugLog} from '../../../../helpers/debug_output';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {takeUntil} from \"rxjs/operators\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class ColumnsTransformer {\n\n  @InjectField() public querySpace:IsolatedQuerySpace;\n  @InjectField() public wpTableColumns:WorkPackageViewColumnsService;\n\n  constructor(public readonly injector:Injector,\n              public table:WorkPackageTable) {\n\n    this.wpTableColumns\n      .updates$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe(() => {\n        if (table.originalRows.length > 0) {\n\n          var t0 = performance.now();\n          // Redraw the table section, ignore timeline\n          table.redrawTable();\n\n          var t1 = performance.now();\n\n          debugLog('column redraw took ' + (t1 - t0) + ' milliseconds.');\n        }\n      });\n  }\n}\n","import {Injector} from '@angular/core';\nimport {scrollTableRowIntoView} from 'core-components/wp-fast-table/helpers/wp-table-row-helpers';\nimport {distinctUntilChanged, filter, map, takeUntil} from 'rxjs/operators';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {\n  collapsedGroupClass,\n  hierarchyGroupClass,\n  hierarchyRootClass\n} from \"core-components/wp-fast-table/helpers/wp-table-hierarchy-helpers\";\nimport {indicatorCollapsedClass} from \"core-components/wp-fast-table/builders/modes/hierarchy/single-hierarchy-row-builder\";\nimport {tableRowClassName} from \"core-components/wp-fast-table/builders/rows/single-row-builder\";\nimport {WorkPackageViewHierarchies} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-hierarchies\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HierarchyTransformer {\n\n  @InjectField() public wpTableHierarchies:WorkPackageViewHierarchiesService;\n  @InjectField() public querySpace:IsolatedQuerySpace;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n\n    this.wpTableHierarchies\n      .updates$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions),\n        map((state) => state.isVisible),\n        distinctUntilChanged()\n      )\n      .subscribe(() => {\n        // We don't have to reload all results when _disabling_ the hierarchy mode.\n        if (!this.wpTableHierarchies.isEnabled) {\n          table.redrawTableAndTimeline();\n        }\n      });\n\n    let lastValue = this.wpTableHierarchies.isEnabled;\n\n    this.wpTableHierarchies\n      .updates$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions),\n        filter(() => this.querySpace.tableRendered.hasValue())\n      )\n      .subscribe((state:WorkPackageViewHierarchies) => {\n\n        if (state.isVisible === lastValue) {\n          this.renderHierarchyState(state);\n        }\n\n        lastValue = state.isVisible;\n      });\n  }\n\n  /**\n   * Update all currently visible rows to match the selection state.\n   */\n  private renderHierarchyState(state:WorkPackageViewHierarchies) {\n    const rendered = this.querySpace.tableRendered.value!;\n\n    // Show all hierarchies\n    jQuery('[class^=\"__hierarchy-group-\"]').removeClass((i:number, classNames:string):string => {\n      return (classNames.match(/__collapsed-group-\\d+/g) || []).join(' ');\n    });\n\n    // Mark which rows were hidden by some other hierarchy group\n    // (e.g., by a collapsed parent)\n    const collapsed:{ [index:number]:boolean } = {};\n\n    // Hide all collapsed hierarchies\n    _.each(state.collapsed, (isCollapsed:boolean, wpId:string) => {\n      // Toggle the root style\n      jQuery(`.${hierarchyRootClass(wpId)} .wp-table--hierarchy-indicator`).toggleClass(indicatorCollapsedClass, isCollapsed);\n\n      // Get all affected rows\n      const affected = jQuery(`.${hierarchyGroupClass(wpId)}`);\n\n      // Hide/Show the descendants.\n      affected.toggleClass(collapsedGroupClass(wpId), isCollapsed);\n\n      // Update the hidden section of the rendered state\n      affected.filter(`.${tableRowClassName}`).each((i, el) => {\n        // Get the index of this row\n        const index = jQuery(el).index();\n\n        // Update the hidden state\n        if (!collapsed[index]) {\n          rendered[index].hidden = isCollapsed;\n          collapsed[index] = isCollapsed;\n        }\n      });\n    });\n\n    // Keep focused on the last element, if any.\n    // Based on https://stackoverflow.com/a/3782959\n    if (state.last) {\n      scrollTableRowIntoView(state.last);\n    }\n\n\n    this.querySpace.tableRendered.putValue(rendered, 'Updated hidden state of rows after hierarchy change.');\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {takeUntil} from \"rxjs/operators\";\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class RelationsTransformer {\n\n  @InjectField() public wpTableRelationColumns:WorkPackageViewRelationColumnsService;\n  @InjectField() public querySpace:IsolatedQuerySpace;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n\n    this.wpTableRelationColumns\n      .updates$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe(() => {\n        table.redrawTableAndTimeline();\n      });\n  }\n}\n","import {Injector} from '@angular/core';\nimport {filter, takeUntil} from 'rxjs/operators';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {States} from 'core-components/states.service';\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class RowsTransformer {\n\n  @InjectField() querySpace:IsolatedQuerySpace;\n  @InjectField() wpTableSortBy:WorkPackageViewSortByService;\n  @InjectField() wpTableOrder:WorkPackageViewOrderService;\n  @InjectField() states:States;\n\n  constructor(public readonly injector:Injector,\n              public table:WorkPackageTable) {\n\n    // Redraw table if the current row state changed\n    this.querySpace\n      .initialized\n      .values$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe(() => {\n        let rows:WorkPackageResource[];\n\n        if (this.wpTableSortBy.isManualSortingMode) {\n          rows = this.wpTableOrder.orderedWorkPackages();\n        } else {\n          rows = this.querySpace.results.value!.elements;\n        }\n\n        table.initialSetup(rows);\n      });\n\n    // Refresh a single row if it exists\n    this.states.workPackages.observeChange()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions.asObservable()),\n        filter(() => {\n          let rendered = this.querySpace.tableRendered.getValueOr([]);\n          return rendered && rendered.length > 0;\n        })\n      )\n      .subscribe(([changedId, wp]) => {\n        if (wp === undefined) {\n          return;\n        }\n\n        this.table.refreshRows(wp);\n      });\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {takeUntil} from 'rxjs/operators';\nimport {tableRowClassName} from '../../builders/rows/single-row-builder';\nimport {checkedClassName} from '../../builders/ui-state-link-builder';\nimport {locateTableRow, scrollTableRowIntoView} from '../../helpers/wp-table-row-helpers';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {FocusHelperService} from 'core-app/modules/common/focus/focus-helper';\nimport {\n  WorkPackageViewSelectionService,\n  WorkPackageViewSelectionState\n} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class SelectionTransformer {\n\n  @InjectField() public wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() public wpTableFocus:WorkPackageViewFocusService;\n  @InjectField() public querySpace:IsolatedQuerySpace;\n  @InjectField() public FocusHelper:FocusHelperService;\n\n  constructor(public readonly injector:Injector,\n              public readonly table:WorkPackageTable) {\n\n    // Focus a single selection when active\n    this.querySpace.tableRendered.values$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe(() => {\n\n        this.wpTableFocus.ifShouldFocus((wpId:string) => {\n          const element = locateTableRow(wpId);\n          if (element.length) {\n            scrollTableRowIntoView(wpId);\n            this.FocusHelper.focusElement(element, true);\n          }\n        });\n      });\n\n\n    // Update selection state\n    this.wpTableSelection.live$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe((state:WorkPackageViewSelectionState) => {\n        this.renderSelectionState(state);\n      });\n\n\n    this.wpTableSelection.registerSelectAllListener(() => {\n      return table.renderedRows;\n    });\n    this.wpTableSelection.registerDeselectAllListener();\n  }\n\n  /**\n   * Update all currently visible rows to match the selection state.\n   */\n  private renderSelectionState(state:WorkPackageViewSelectionState) {\n    const context = jQuery(this.table.tableAndTimelineContainer);\n\n    context.find(`.${tableRowClassName}.${checkedClassName}`).removeClass(checkedClassName);\n\n    _.each(state.selected, (selected:boolean, workPackageId:any) => {\n      context.find(`.${tableRowClassName}[data-work-package-id=\"${workPackageId}\"]`).toggleClass(checkedClassName, selected);\n    });\n  }\n}\n\n","import {Injector} from '@angular/core';\nimport {takeUntil} from 'rxjs/operators';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageTimelineState} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-timeline\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class TimelineTransformer {\n\n  @InjectField() public querySpace:IsolatedQuerySpace;\n  @InjectField() public wpTableTimeline:WorkPackageViewTimelineService;\n\n  constructor(readonly injector:Injector,\n              readonly table:WorkPackageTable) {\n\n    this.wpTableTimeline\n      .live$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe((state:WorkPackageTimelineState) => {\n        this.renderVisibility(state.visible);\n      });\n  }\n\n  /**\n   * Update all currently visible rows to match the selection state.\n   */\n  private renderVisibility(visible:boolean) {\n    const container = jQuery(this.table.tableAndTimelineContainer).parent();\n    container.find('.work-packages-tabletimeline--timeline-side').toggle(visible);\n    container.find('.work-packages-tabletimeline--table-side').toggleClass('-timeline-visible', visible);\n  }\n}\n","import {Injector} from '@angular/core';\nimport {distinctUntilChanged, takeUntil} from 'rxjs/operators';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageViewHighlightingService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HighlightingTransformer {\n\n  @InjectField() public wpTableHighlighting:WorkPackageViewHighlightingService;\n  @InjectField() public querySpace:IsolatedQuerySpace;\n\n  constructor(public readonly injector:Injector,\n              table:WorkPackageTable) {\n    this.wpTableHighlighting\n      .updates$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions),\n        distinctUntilChanged()\n      )\n      .subscribe(() => table.redrawTable());\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {take, takeUntil} from \"rxjs/operators\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {TableDragActionsRegistryService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-actions-registry.service\";\nimport {TableDragActionService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-action.service\";\nimport {States} from \"core-components/states.service\";\nimport {tableRowClassName} from \"core-components/wp-fast-table/builders/rows/single-row-builder\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {DragAndDropHelpers} from \"core-app/modules/common/drag-and-drop/drag-and-drop.helpers\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {BrowserDetector} from \"core-app/modules/common/browser/browser-detector.service\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class DragAndDropTransformer {\n\n  @InjectField() private readonly states:States;\n  @InjectField() private readonly querySpace:IsolatedQuerySpace;\n  @InjectField() private readonly inlineCreateService:WorkPackageInlineCreateService;\n  @InjectField() private readonly halNotification:HalResourceNotificationService;\n  @InjectField() private readonly wpTableSortBy:WorkPackageViewSortByService;\n  @InjectField() private readonly wpTableOrder:WorkPackageViewOrderService;\n  @InjectField() private readonly browserDetector:BrowserDetector;\n  @InjectField() private readonly wpCacheService:WorkPackageCacheService;\n  @InjectField() private readonly wpListService:WorkPackagesListService;\n  @InjectField() private readonly dragActionRegistry:TableDragActionsRegistryService;\n  @InjectField(DragAndDropService, null) private readonly dragService:DragAndDropService|null;\n\n  constructor(public readonly injector:Injector,\n              public table:WorkPackageTable) {\n\n    // The DragService may not have been provided\n    // in which case we do not provide drag and drop\n    if (this.dragService === null) {\n      return;\n    }\n\n    this.inlineCreateService.newInlineWorkPackageCreated\n      .pipe(takeUntil(this.querySpace.stopAllSubscriptions))\n      .subscribe(async (wpId) => {\n        const newOrder = await this.wpTableOrder.add(this.currentOrder, wpId);\n        this.updateRenderedOrder(newOrder);\n      });\n\n    this.querySpace.stopAllSubscriptions\n      .pipe(take(1))\n      .subscribe(() => {\n        this.dragService!.remove(this.table.tbody);\n      });\n\n    this.dragService.register({\n      dragContainer: this.table.tbody,\n      scrollContainers: [this.table.scrollContainer],\n      accepts: () => true,\n      moves: (el:any, source:any, handle:HTMLElement) => {\n        if (!handle.classList.contains('wp-table--drag-and-drop-handle')) {\n          return false;\n        }\n\n        const wpId:string = el.dataset.workPackageId!;\n        const workPackage = this.states.workPackages.get(wpId).value;\n        return !!workPackage && this.actionService.canPickup(workPackage);\n      },\n      onMoved: async (el:HTMLElement, target:HTMLElement, source:HTMLElement) => {\n        const wpId:string = el.dataset.workPackageId!;\n        const rowIndex = this.findRowIndex(el);\n\n        try {\n          const workPackage = await this.wpCacheService.require(wpId);\n          const newOrder = await this.wpTableOrder.move(this.currentOrder, wpId, rowIndex);\n          await this.actionService.handleDrop(workPackage, el);\n          this.updateRenderedOrder(newOrder);\n          this.actionService.onNewOrder(newOrder);\n\n          // Save the query when switching to manual\n          let query = this.querySpace.query.value;\n          if (query && this.wpTableSortBy.switchToManualSorting(query)) {\n            await this.wpListService.save(query);\n          }\n        } catch (e) {\n          this.halNotification.handleRawError(e);\n\n          // Restore element in from container\n          DragAndDropHelpers.reinsert(el, el.dataset.sourceIndex || -1, source);\n        }\n      },\n      onRemoved: (el:HTMLElement) => {\n        const wpId:string = el.dataset.workPackageId!;\n        const newOrder = this.wpTableOrder.remove(this.currentOrder, wpId);\n        this.updateRenderedOrder(newOrder);\n      },\n      onAdded: async (el:HTMLElement) => {\n        const wpId:string = el.dataset.workPackageId!;\n        const workPackage = await this.wpCacheService.require(wpId);\n        const rowIndex = this.findRowIndex(el);\n\n        return this.actionService\n          .handleDrop(workPackage, el)\n          .then(async () => {\n            const newOrder = await this.wpTableOrder.add(this.currentOrder, wpId, rowIndex);\n            this.updateRenderedOrder(newOrder);\n            this.actionService.onNewOrder(newOrder);\n\n            return true;\n          })\n          .catch(() => false);\n      },\n      onCloned: async (clone:HTMLElement, original:HTMLElement) => {\n        // Replace clone with one TD of the subject\n        const wpId:string = original.dataset.workPackageId!;\n        const workPackage = await this.wpCacheService.require(wpId);\n\n        const colspan = clone.children.length;\n        const td = document.createElement('td');\n        td.textContent = workPackage.subjectWithId();\n        td.colSpan = colspan;\n        td.classList.add('wp-table--cell-td', 'subject');\n\n        clone.style.maxWidth = '500px';\n        clone.innerHTML = td.outerHTML;\n      },\n      onShadowInserted: (el:HTMLElement) => {\n        if (!this.browserDetector.isEdge) {\n          this.actionService.changeShadowElement(el);\n        }\n      },\n      onCancel: (el:HTMLElement) => {\n        if (!this.browserDetector.isEdge) {\n          this.actionService.changeShadowElement(el, true);\n        }\n      },\n    });\n  }\n\n  /**\n   * Update current rendered order\n   */\n  private async updateRenderedOrder(order:string[]) {\n    order = _.uniq(order);\n\n    const mappedOrder = await Promise.all(order.map(id => this.wpCacheService.require(id)));\n\n    /** Re-render the table */\n    this.table.initialSetup(mappedOrder);\n  }\n\n  protected get actionService():TableDragActionService {\n    return this.dragActionRegistry.get(this.injector);\n  }\n\n  protected get currentOrder():string[] {\n    return this\n      .currentRenderedOrder\n      .map((row) => row.workPackageId!);\n  }\n\n  protected get currentRenderedOrder():RenderedWorkPackage[] {\n    return this\n      .querySpace\n      .renderedWorkPackages\n      .getValueOr([]);\n  }\n\n  /**\n   * Find the index of the row in the set of rendered work packages.\n   * This will skip non-work-package rows such as group headers\n   * @param el\n   */\n  private findRowIndex(el:HTMLElement):number {\n    const rows = Array.from(this.table.tbody.getElementsByClassName(tableRowClassName));\n    return rows.indexOf(el) || 0;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageTable} from '../wp-fast-table';\nimport {EditCellHandler} from './cell/edit-cell-handler';\nimport {RelationsCellHandler} from './cell/relations-cell-handler';\nimport {ContextMenuClickHandler} from './context-menu/context-menu-click-handler';\nimport {ContextMenuKeyboardHandler} from './context-menu/context-menu-keyboard-handler';\nimport {ContextMenuRightClickHandler} from './context-menu/context-menu-rightclick-handler';\nimport {RowClickHandler} from './row/click-handler';\nimport {RowDoubleClickHandler} from './row/double-click-handler';\nimport {GroupRowHandler} from './row/group-row-handler';\nimport {HierarchyClickHandler} from './row/hierarchy-click-handler';\nimport {WorkPackageStateLinksHandler} from './row/wp-state-links-handler';\nimport {ColumnsTransformer} from './state/columns-transformer';\nimport {HierarchyTransformer} from './state/hierarchy-transformer';\nimport {RelationsTransformer} from './state/relations-transformer';\nimport {RowsTransformer} from './state/rows-transformer';\nimport {SelectionTransformer} from './state/selection-transformer';\nimport {TimelineTransformer} from './state/timeline-transformer';\nimport {HighlightingTransformer} from \"core-components/wp-fast-table/handlers/state/highlighting-transformer\";\nimport {DragAndDropTransformer} from \"core-components/wp-fast-table/handlers/state/drag-and-drop-transformer\";\nimport {\n  WorkPackageViewEventHandler,\n  WorkPackageViewHandlerRegistry\n} from \"core-app/modules/work_packages/routing/wp-view-base/event-handling/event-handler-registry\";\n\ntype StateTransformers = {\n  // noinspection JSUnusedLocalSymbols\n  new(injector:Injector, table:WorkPackageTable):any;\n};\n\nexport type TableEventHandler = WorkPackageViewEventHandler<WorkPackageTable>;\n\nexport class TableHandlerRegistry extends WorkPackageViewHandlerRegistry<WorkPackageTable> {\n\n  protected eventHandlers:((t:WorkPackageTable) => WorkPackageViewEventHandler<WorkPackageTable>)[] = [\n    // Hierarchy expansion/collapsing\n    t => new HierarchyClickHandler(this.injector, t),\n    // Clicking or pressing Enter on a single cell, editable or not\n    t => new EditCellHandler(this.injector, t),\n    // Clicking on the details view\n    t => new WorkPackageStateLinksHandler(this.injector, t),\n    // Clicking on the row (not within a cell)\n    t => new RowClickHandler(this.injector, t),\n    // Double Clicking on the cell within the row\n    t => new RowDoubleClickHandler(this.injector, t),\n    // Clicking on group headers\n    t => new GroupRowHandler(this.injector, t),\n    // Right clicking on rows\n    t => new ContextMenuRightClickHandler(this.injector, t),\n    // Left clicking on the dropdown icon\n    t => new ContextMenuClickHandler(this.injector, t),\n    // SHIFT+ALT+F10 on rows\n    t => new ContextMenuKeyboardHandler(this.injector, t),\n    // Clicking on relations cells\n    t => new RelationsCellHandler(this.injector, t)\n  ];\n\n  protected readonly stateTransformers:StateTransformers[] = [\n    SelectionTransformer,\n    RowsTransformer,\n    ColumnsTransformer,\n    TimelineTransformer,\n    HierarchyTransformer,\n    RelationsTransformer,\n    HighlightingTransformer,\n    DragAndDropTransformer\n  ];\n\n  attachTo(viewRef:WorkPackageTable) {\n    this.stateTransformers.map((cls) => {\n      return new cls(this.injector, viewRef);\n    });\n\n    super.attachTo(viewRef);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nconst cssClassRowHovered = 'row-hovered';\n\nexport class WpTableHoverSync {\n\n  private lastHoveredElement:Element | null = null;\n\n  private eventListener = (evt:MouseEvent) => {\n    const target = evt.target as Element|null;\n    if (target && target !== this.lastHoveredElement) {\n      this.handleHover(target);\n    }\n    this.lastHoveredElement = target;\n  }\n\n  constructor(private tableAndTimeline:JQuery) {\n  }\n\n  activate() {\n    window.addEventListener('mousemove', this.eventListener, { passive: true });\n  }\n\n  deactivate() {\n    window.removeEventListener('mousemove', this.eventListener);\n    this.removeAllHoverClasses();\n  }\n\n  private locateHoveredTableRow(child:JQuery):Element | null {\n    const parent = child.closest('tr');\n    if (parent.length === 0) {\n      return null;\n    }\n    return parent[0];\n  }\n\n  private locateHoveredTimelineRow(child:JQuery):Element | null {\n    const parent = child.closest('div.wp-timeline-cell');\n    if (parent.length === 0) {\n      return null;\n    }\n    return parent[0];\n  }\n\n  private handleHover(element:Element) {\n    const $element = jQuery(element) as JQuery;\n    const parentTableRow = this.locateHoveredTableRow($element);\n    const parentTimelineRow = this.locateHoveredTimelineRow($element);\n\n    // remove all hover classes if cursor does not hover a row\n    if (parentTableRow === null && parentTimelineRow === null) {\n      this.removeAllHoverClasses();\n      return;\n    }\n\n    this.removeOldAndAddNewHoverClass(parentTableRow, parentTimelineRow);\n  }\n\n  private extractWorkPackageId(row:Element):number {\n    return parseInt(row.getAttribute('data-work-package-id')!);\n  }\n\n  private removeOldAndAddNewHoverClass(parentTableRow:Element | null, parentTimelineRow:Element | null) {\n    const hovered = parentTableRow !== null ? parentTableRow : parentTimelineRow;\n    const wpId = this.extractWorkPackageId(hovered!);\n\n    const tableRow:JQuery = this.tableAndTimeline.find('tr.wp-row-' + wpId).first();\n    const timelineRow:JQuery = this.tableAndTimeline.find('div.wp-row-' + wpId).first();\n\n    requestAnimationFrame(() => {\n      this.removeAllHoverClasses();\n      timelineRow.addClass(cssClassRowHovered);\n      tableRow.addClass(cssClassRowHovered);\n    });\n  }\n\n  private removeAllHoverClasses() {\n    this.tableAndTimeline\n      .find(`.${cssClassRowHovered}`)\n      .removeClass(cssClassRowHovered);\n  }\n}\n","<div class=\"work-packages-split-view--tabletimeline-content\" *ngIf=\"query\">\n  <div class=\"work-packages-tabletimeline--table-side work-package-table--container __hidden_overflow_container\">\n    <table class=\"keyboard-accessible-list generic-table work-package-table\">\n      <colgroup>\n        <col *ngIf=\"configuration.dragAndDropEnabled\">\n        <!-- Generate col elements dynamically(!) for each requested column plus one for the action menu's column. -->\n        <col highlight-col *ngFor=\"let column of [].constructor(columns.length)\">\n        <col highlight-col *ngIf=\"configuration.columnMenuEnabled\">\n        <col *ngIf=\"!configuration.columnMenuEnabled\">\n      </colgroup>\n      <caption class=\"hidden-for-sighted\">\n        <span>{{text.tableSummary}}</span>\n        <span id=\"wp-table-sort-summary\"></span>\n        <span>{{text.tableSummaryHints}}</span>\n      </caption>\n      <thead class=\"-sticky\">\n        <tr>\n          <th *ngIf=\"configuration.dragAndDropEnabled\" class=\"wp-table--manual-sort-th -short hide-when-print\">\n            <div class=\"generic-table--empty-header\">\n              <op-icon *ngIf=\"manualSortEnabled\" icon-classes=\"icon-sort-by\"></op-icon>\n            </div>\n          </th>\n          <th *ngFor=\"let column of columns; trackBy:trackByHref\"\n              class=\"wp-table--table-header\">\n            <sortHeader [headerColumn]=\"column\"\n                        [locale]=\"column.custom_field && column.custom_field.name_locale || locale\"\n                        [table]=\"workPackageTable\"\n\n                        opColumnsContextMenu\n                        [opColumnsContextMenu-column]=\"column\"\n                        [opColumnsContextMenu-table]=\"workPackageTable\">\n            </sortHeader>\n          </th>\n          <th class=\"wp-table--configuration-modal--trigger wp-table--context-menu-th -short hide-when-print\"\n              *ngIf=\"configuration.columnMenuEnabled || configuration.actionsColumnEnabled\">\n            <div class=\"generic-table--sort-header-outer\" *ngIf=\"configuration.columnMenuEnabled\">\n              <wp-table-config-menu>\n              </wp-table-config-menu>\n            </div>\n          </th>\n        </tr>\n      </thead>\n      <tbody class=\"work-package--empty-tbody\" *ngIf=\"!isEmbedded && query && results.count === 0\">\n      <tr id=\"empty-row-notification\">\n        <td [attr.colspan]=\"columns.length + 2\">\n          <span>\n            <op-icon icon-classes=\"icon-info1 icon-context\"></op-icon>\n            <span>\n              <strong>{{text.noResults.title}}</strong>\n              {{text.noResults.description}}\n            </span>\n          </span>\n        </td>\n      </tr>\n      </tbody>\n      <tbody class=\"results-tbody work-package--results-tbody\"></tbody>\n      <tbody *ngIf=\"tableElement && configuration.inlineCreateEnabled\"\n             wpInlineCreate\n             [wp-inline-create--table]=\"workPackageTable\"\n             [wp-inline-create--project-identifier]=\"projectIdentifier\"\n      >\n      </tbody>\n      <tfoot>\n      <tr wpTableSumsRow></tr>\n      </tfoot>\n    </table>\n  </div>\n\n  <div *ngIf=\"!configuration.isEmbedded\"\n       class=\"work-packages--tabletimeline--timeline--resizer hidden-for-mobile hide-when-print\">\n    <wp-resizer [elementClass]=\"'work-packages-tabletimeline--timeline-side'\"\n                [resizeEvent]=\"'wp-resize.timeline'\"\n                [localStorageKey]=\"'openProject-timelineFlexBasis'\"></wp-resizer>\n  </div>\n\n  <div class=\"work-packages-tabletimeline--timeline-side\">\n    <wp-timeline-container></wp-timeline-container>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  Input,\n  NgZone,\n  OnInit,\n  ViewEncapsulation\n} from '@angular/core';\nimport {QueryGroupByResource} from 'core-app/modules/hal/resources/query-group-by-resource';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TableHandlerRegistry} from 'core-components/wp-fast-table/handlers/table-handler-registry';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {combineLatest} from 'rxjs';\nimport {States} from '../states.service';\nimport {\n  WorkPackageTableConfiguration,\n  WorkPackageTableConfigurationObject\n} from 'core-app/components/wp-table/wp-table-configuration';\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {createScrollSync} from \"core-components/wp-table/wp-table-scroll-sync\";\nimport {WpTableHoverSync} from \"core-components/wp-table/wp-table-hover-sync\";\nimport {WorkPackageTimelineTableController} from \"core-components/wp-table/timeline/container/wp-timeline-container.directive\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './wp-table.directive.html',\n  styleUrls: ['./wp-table.styles.sass'],\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-table',\n})\nexport class WorkPackagesTableController extends UntilDestroyedMixin implements OnInit {\n\n  @Input() projectIdentifier:string;\n  @Input('configuration') configurationObject:WorkPackageTableConfigurationObject;\n\n  public trackByHref = AngularTrackingHelpers.trackByHref;\n\n  public configuration:WorkPackageTableConfiguration;\n\n  private $element:JQuery;\n\n  private scrollSyncUpdate:(timelineVisible:boolean) => any;\n\n  private wpTableHoverSync:WpTableHoverSync;\n\n  public tableElement:HTMLElement;\n\n  public workPackageTable:WorkPackageTable;\n\n  public tbody:JQuery;\n\n  public query:QueryResource;\n\n  public timeline:HTMLElement;\n\n  public locale:string;\n\n  public text:any;\n\n  public results:WorkPackageCollectionResource;\n\n  public groupBy:QueryGroupByResource|null;\n\n  public columns:QueryColumn[];\n\n  public numTableColumns:number;\n\n  public timelineVisible:boolean;\n\n  public manualSortEnabled:boolean;\n\n  public limitedResults = false;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly injector:Injector,\n              readonly states:States,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly zone:NgZone,\n              readonly wpTableGroupBy:WorkPackageViewGroupByService,\n              readonly wpTableTimeline:WorkPackageViewTimelineService,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly wpTableSortBy:WorkPackageViewSortByService) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.configuration = new WorkPackageTableConfiguration(this.configurationObject);\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    // Clear any old table subscribers\n    this.querySpace.stopAllSubscriptions.next();\n\n    this.locale = I18n.locale;\n\n    this.text = {\n      cancel: I18n.t('js.button_cancel'),\n      noResults: {\n        title: I18n.t('js.work_packages.no_results.title'),\n        description: I18n.t('js.work_packages.no_results.description')\n      },\n      limitedResults: (count:number, total:number) => {\n        return I18n.t('js.work_packages.limited_results', { count: count, total: total });\n      },\n      tableSummary: I18n.t('js.work_packages.table.summary'),\n      tableSummaryHints: [\n        I18n.t('js.work_packages.table.text_inline_edit'),\n        I18n.t('js.work_packages.table.text_select_hint'),\n        I18n.t('js.work_packages.table.text_sort_hint')\n      ].join(' ')\n    };\n\n    let statesCombined = combineLatest([\n      this.querySpace.results.values$(),\n      this.wpTableGroupBy.live$(),\n      this.wpTableColumns.live$(),\n      this.wpTableTimeline.live$(),\n      this.wpTableSortBy.live$()\n    ]);\n\n    statesCombined.pipe(\n      this.untilDestroyed()\n    ).subscribe(([results, groupBy, columns, timelines, sort]) => {\n      this.query = this.querySpace.query.value!;\n      this.results = results;\n\n      this.groupBy = groupBy;\n      this.columns = columns;\n      // Total columns = all available columns + id + checkbox\n      this.numTableColumns = this.columns.length + 2;\n\n      if (this.scrollSyncUpdate && this.timelineVisible !== timelines.visible) {\n        this.scrollSyncUpdate(timelines.visible);\n      }\n\n      this.timelineVisible = timelines.visible;\n\n      this.manualSortEnabled = this.wpTableSortBy.isManualSortingMode;\n      this.limitedResults = this.manualSortEnabled && results.total > results.count;\n\n      this.cdRef.detectChanges();\n    });\n\n    this.cdRef.detectChanges();\n  }\n\n  public ngOnDestroy():void {\n    super.ngOnDestroy();\n    this.wpTableHoverSync.deactivate();\n  }\n\n  public registerTimeline(controller:WorkPackageTimelineTableController, timelineBody:HTMLElement) {\n    const tbody = this.$element.find('.work-package--results-tbody');\n    const scrollContainer = this.$element.find('.work-package-table--container')[0];\n    this.workPackageTable = new WorkPackageTable(\n      this.injector,\n      // Outer container for both table + Timeline\n      this.$element[0],\n      // Scroll container for the table/timeline\n      scrollContainer,\n      // Table tbody to insert into\n      tbody[0],\n      // Timeline body to insert into\n      timelineBody,\n      // Timeline controller\n      controller,\n      // Table configuration\n      this.configuration\n    );\n    this.tbody = tbody;\n    controller.workPackageTable = this.workPackageTable;\n    new TableHandlerRegistry(this.injector).attachTo(this.workPackageTable);\n\n    // Locate table and timeline elements\n    const tableAndTimeline = this.getTableAndTimelineElement();\n    this.tableElement = tableAndTimeline[0];\n    this.timeline = tableAndTimeline[1];\n\n    // sync hover from table to timeline\n    this.wpTableHoverSync = new WpTableHoverSync(this.$element);\n    this.wpTableHoverSync.activate();\n\n    // sync scroll from table to timeline\n    this.scrollSyncUpdate = createScrollSync(this.$element);\n    this.scrollSyncUpdate(this.timelineVisible);\n\n    this.cdRef.detectChanges();\n  }\n\n  public get isEmbedded() {\n    return this.configuration.isEmbedded;\n  }\n\n  private getTableAndTimelineElement():[HTMLElement, HTMLElement] {\n    const $tableSide = this.$element.find('.work-packages-tabletimeline--table-side');\n    const $timelineSide = this.$element.find('.work-packages-tabletimeline--timeline-side');\n\n    if ($timelineSide.length === 0 || $tableSide.length === 0) {\n      throw new Error('invalid state');\n    }\n\n    return [$tableSide[0], $timelineSide[0]];\n  }\n}\n","import {Injector} from '@angular/core';\nimport {States} from '../../../states.service';\nimport {WorkPackageCacheService} from '../../../work-packages/work-package-cache.service';\nimport {WorkPackageTable} from '../../wp-fast-table';\nimport {commonRowClassName} from '../rows/single-row-builder';\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const timelineCellClassName = 'wp-timeline-cell';\n\nexport class TimelineRowBuilder {\n\n  @InjectField() public states:States;\n  @InjectField() public wpTableTimeline:WorkPackageViewTimelineService;\n  @InjectField() public wpCacheService:WorkPackageCacheService;\n\n  constructor(public readonly injector:Injector,\n              protected workPackageTable:WorkPackageTable) {\n  }\n\n  public build(workPackageId:string|null) {\n    const cell = document.createElement('div');\n    cell.classList.add(timelineCellClassName, commonRowClassName);\n\n    if (workPackageId) {\n      cell.dataset['workPackageId'] = workPackageId;\n    }\n\n    return cell;\n  }\n\n  /**\n   * Build and insert a timeline row for the given work package using the additional classes.\n   * @param workPackage\n   * @param timelineBody\n   * @param rowClasses\n   */\n  public insert(workPackageId:string|null,\n                timelineBody:DocumentFragment|HTMLElement,\n                rowClasses:string[] = []) {\n\n    const cell = this.build(workPackageId);\n    cell.classList.add(...rowClasses);\n\n    timelineBody.appendChild(cell);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {Component, OnInit} from \"@angular/core\";\nimport {\n  FormattableEditFieldComponent,\n  formattableFieldTemplate\n} from \"core-app/modules/fields/edit/field-types/formattable-edit-field.component\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Component({\n  template: formattableFieldTemplate\n})\nexport class WorkPackageCommentFieldComponent extends FormattableEditFieldComponent implements OnInit {\n  public isBusy:boolean = false;\n\n  @InjectField() public ConfigurationService:ConfigurationService;\n\n  public get name() {\n    return 'comment';\n  }\n\n  public get required() {\n    return true;\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n    this.rawValue = this.rawValue || '';\n  }\n}\n","import {Component, Input, OnInit} from '@angular/core';\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './wp-relations-count.html',\n  selector: 'wp-watchers-count',\n})\nexport class WorkPackageWatchersCountComponent extends UntilDestroyedMixin implements OnInit {\n  @Input('wpId') wpId:string;\n  public count:number = 0;\n\n  constructor(protected wpCacheService:WorkPackageCacheService) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.wpCacheService.loadWorkPackage(this.wpId.toString()).values$()\n      .pipe(\n        this.untilDestroyed()\n      ).subscribe((workPackage) => {\n      this.count = _.size(workPackage.watchers.elements);\n    });\n  }\n}\n","<span class=\"wp-tabs-count\"\n      *ngIf=\"count > 0\"\n      [textContent]=\"count\"></span>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Transition} from \"@uirouter/core\";\nimport {Injectable} from \"@angular/core\";\n\n@Injectable()\nexport class EditFormRoutingService {\n  /**\n   * Return whether the given transition is cancelled during the editing of this form\n   *\n   * @param transition The transition that is underway.\n   * @return A boolean marking whether the transition should be blocked.\n   */\n  public blockedTransition(transition:Transition):boolean {\n    // By default, don't allow any transitions to continue\n    return true;\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {QueryFilterInstanceSchemaResource} from 'core-app/modules/hal/resources/query-filter-instance-schema-resource';\nimport {QueryOperatorResource} from 'core-app/modules/hal/resources/query-operator-resource';\n\nexport class QueryFilterInstanceResource extends HalResource {\n  public filter:QueryFilterResource;\n  public operator:QueryOperatorResource;\n  public values:HalResource[]|string[];\n  public schema:QueryFilterInstanceSchemaResource;\n  private memoizedCurrentSchemas:{ [key:string]:QueryFilterInstanceSchemaResource } = {};\n\n  /**\n   * Create a copied filter, taking over the manually set schema instance.\n   */\n  public $copy<T extends HalResource = HalResource>():T {\n    let clone = super.$copy<T>() as any;\n    clone.schema = this.schema;\n\n    return clone;\n  }\n\n  public get id():string {\n    return this.filter.id;\n  }\n\n  public get name():string {\n    return this.filter.name;\n  }\n\n  /**\n   * Get the complete current schema.\n   *\n   * The filter instance's schema is made up of a static and a variable part.\n   * The variable part depends on the currently selected operator.\n   * Therefore, the schema differs based on the selected operator.\n   */\n  public get currentSchema():QueryFilterInstanceSchemaResource|null {\n    if (!this.schema || !this.operator) {\n      return null;\n    }\n\n    let key = this.operator.href!.toString();\n\n    if (this.memoizedCurrentSchemas[key] === undefined) {\n      this.memoizedCurrentSchemas[key] = this.schema.resultingSchema(this.operator);\n    }\n\n    return this.memoizedCurrentSchemas[key];\n  }\n\n  public isCompletelyDefined() {\n    return this.values.length || (this.currentSchema && !this.currentSchema.isValueRequired());\n  }\n\n  public findOperator(operatorSymbol:string):QueryOperatorResource|undefined {\n    return _.find(this.schema.availableOperators, (operator:QueryOperatorResource) => operator.id === operatorSymbol) as QueryOperatorResource|undefined;\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class BoardActionsRegistryService {\n\n  private mapping:{ [attribute:string]:BoardActionService } = {};\n\n  public add(attribute:string, service:BoardActionService) {\n    this.mapping[attribute] = service;\n  }\n\n  public available() {\n    return _.map(this.mapping, (service:BoardActionService, attribute:string) => {\n      return { attribute: attribute, text: service.localizedName };\n    });\n  }\n\n  public get(attribute:string):BoardActionService {\n    if (this.mapping[attribute]) {\n      return this.mapping[attribute];\n    }\n\n    throw(`No action service exists for ${attribute}`);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {StateService} from '@uirouter/core';\nimport {Injectable} from \"@angular/core\";\nimport {HttpClient} from \"@angular/common/http\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalDeletedEvent, HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\n\n@Injectable()\nexport class WorkPackageService {\n\n  private text = {\n    successful_delete: this.I18n.t('js.work_packages.message_successful_bulk_delete')\n  };\n\n  constructor(private readonly http:HttpClient,\n              private readonly $state:StateService,\n              private readonly PathHelper:PathHelperService,\n              private readonly UrlParamsHelper:UrlParamsHelperService,\n              private readonly NotificationsService:NotificationsService,\n              private readonly I18n:I18nService,\n              private readonly halEvents:HalEventsService) {\n  }\n\n  public performBulkDelete(ids:string[], defaultHandling:boolean) {\n    const params = {\n      'ids[]': ids\n    };\n    const promise = this.http\n      .delete(\n        this.PathHelper.workPackagesBulkDeletePath(),\n        {params: params, withCredentials: true}\n      )\n      .toPromise();\n\n    if (defaultHandling) {\n      promise\n        .then(() => {\n          this.NotificationsService.addSuccess(this.text.successful_delete);\n\n          ids.forEach(id => this.halEvents.push({_type:'WorkPackage', id: id}, { eventType: 'deleted'} as HalDeletedEvent));\n\n          if (this.$state.includes('**.list.details.**')\n            && ids.indexOf(this.$state.params.workPackageId) > -1) {\n            this.$state.go('work-packages.partitioned.list', this.$state.params);\n          }\n        })\n        .catch(() => {\n          const urlParams = this.UrlParamsHelper.buildQueryString(params);\n          window.location.href = this.PathHelper.workPackagesBulkDeletePath() + '?' + urlParams;\n        });\n    }\n\n    return promise;\n  }\n}\n","import {OnDestroyMixin, untilComponentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {OnDestroy} from \"@angular/core\";\nimport {Observable} from \"rxjs\";\n\n/**\n * Mixin function to provide access to observable and flags\n * whether this component has been destroyed.\n *\n * Use for rxjs with .pipe(this.untilDestroyed)\n */\nexport class UntilDestroyedMixin extends OnDestroyMixin implements OnDestroy {\n  public componentDestroyed = false;\n\n  ngOnDestroy():void {\n    this.componentDestroyed = true;\n    super.ngOnDestroy();\n  }\n\n  /**\n   * Helper function to access `untilComponentDestroyed`\n   */\n  protected untilDestroyed<T>():(source:Observable<T>) => Observable<T> {\n    return untilComponentDestroyed(this);\n  }\n}","import {\n  Component,\n  Injector,\n  OnInit,\n} from '@angular/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {QueryFilterResource} from \"core-app/modules/hal/resources/query-filter-resource\";\nimport {QueryOperatorResource} from \"core-app/modules/hal/resources/query-operator-resource\";\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\n\n@Component({\n  templateUrl: './wp-table-configuration-relation-selector.html',\n  selector: 'wp-table-configuration-relation-selector'\n})\nexport class WpTableConfigurationRelationSelectorComponent implements OnInit  {\n  private relationFilterIds:string[] = [\n    'parent',\n    'precedes',\n    'follows',\n    'relates',\n    'duplicates',\n    'duplicated',\n    'blocks',\n    'blocked',\n    'partof',\n    'includes',\n    'requires',\n    'required'\n  ];\n\n  public availableRelationFilters:QueryFilterResource[] = [];\n  public selectedRelationFilter:QueryFilterResource|undefined = undefined;\n\n  public text = {\n    filter_work_packages_by_relation_type: this.I18n.t('js.work_packages.table_configuration.relation_filters.filter_work_packages_by_relation_type'),\n    please_select: this.I18n.t('js.placeholders.selection'),\n    // We need to inverse the translation strings, as the filters's are named the other way around than what\n    // a user knows from the relations tab:\n    parent:        this.I18n.t('js.relation_labels.children'),\n    precedes:      this.I18n.t('js.relation_labels.follows'),\n    follows:       this.I18n.t('js.relation_labels.precedes'),\n    relates:     this.I18n.t('js.relation_labels.relates'),\n    duplicates:    this.I18n.t('js.relation_labels.duplicated'),\n    duplicated:  this.I18n.t('js.relation_labels.duplicates'),\n    blocks:        this.I18n.t('js.relation_labels.blocked'),\n    blocked:     this.I18n.t('js.relation_labels.blocks'),\n    requires:      this.I18n.t('js.relation_labels.required'),\n    required:    this.I18n.t('js.relation_labels.requires'),\n    partof:        this.I18n.t('js.relation_labels.includes'),\n    includes:      this.I18n.t('js.relation_labels.partof')\n  };\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly ConfigurationService:ConfigurationService) {\n  }\n\n  ngOnInit() {\n    let self:WpTableConfigurationRelationSelectorComponent = this;\n\n    this.wpTableFilters\n      .onReady()\n      .then(() => {\n        self.availableRelationFilters = self.relationFiltersOf(self.wpTableFilters.availableFilters) as QueryFilterResource[];\n        self.setSelectedRelationFilter();\n      });\n  }\n\n  private setSelectedRelationFilter():void {\n    let currentRelationFilters:QueryFilterInstanceResource[] = this.relationFiltersOf(this.wpTableFilters.current) as QueryFilterInstanceResource[];\n    if (currentRelationFilters.length > 0) {\n      this.selectedRelationFilter = _.find(this.availableRelationFilters, { id: currentRelationFilters[0].id }) as QueryFilterResource;\n    } else {\n      this.selectedRelationFilter = this.availableRelationFilters[0];\n    }\n    this.onRelationFilterSelected();\n  }\n\n  public onRelationFilterSelected() {\n    if (this.selectedRelationFilter) {\n      this.removeRelationFiltersFromCurrentState();\n      this.addFilterToCurrentState(this.selectedRelationFilter as QueryFilterResource);\n    }\n  }\n\n  private removeRelationFiltersFromCurrentState() {\n    let filtersToRemove = this.relationFiltersOf(this.wpTableFilters.current) as QueryFilterInstanceResource[];\n    this.wpTableFilters.remove(...filtersToRemove);\n  }\n\n  private relationFiltersOf(filters:QueryFilterResource[]|QueryFilterInstanceResource[]):QueryFilterResource[]|QueryFilterInstanceResource[] {\n    return _.filter(filters, (filter:QueryFilterResource|QueryFilterInstanceResource) => _.includes(this.relationFilterIds, filter.id));\n  }\n\n  private addFilterToCurrentState(filter:QueryFilterResource):void {\n    let newFilter = this.wpTableFilters.instantiate(filter);\n    let operator:QueryOperatorResource = this.getOperatorForId(newFilter, '=');\n    newFilter.operator = operator;\n    newFilter.values = [{href: '/api/v3/work_packages/{id}'}] as HalResource[];\n\n    this.wpTableFilters.add(newFilter);\n  }\n\n  private getOperatorForId(filter:QueryFilterResource, id:string):QueryOperatorResource {\n    return _.find(filter.schema.availableOperators, { 'id': id}) as QueryOperatorResource;\n  }\n\n  public compareRelationFilters(f1:undefined|QueryFilterResource, f2:undefined|QueryFilterResource):boolean {\n    return f1 && f2 ? f1.id === f2.id : f1 === f2;\n  }\n}\n","<div class=\"relation-filter-selector\">\n  <h5>\n    <span [textContent]=\"text.filter_work_packages_by_relation_type\"></span>\n    &ngsp;\n    <select class=\"form--select form--inline-select\"\n            id=\"\"\n            [(ngModel)]=\"selectedRelationFilter\"\n            (ngModelChange)=\"onRelationFilterSelected()\"\n            [compareWith]=\"compareRelationFilters\">\n      <option *ngFor=\"let filter of availableRelationFilters\"\n              [textContent]=\"text[filter.id]\"\n              [ngValue]=\"filter\">\n      </option>\n    </select>\n  </h5>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectorRef, Component, ElementRef, Injector, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {OpContextMenuItem} from \"core-components/op-context-menu/op-context-menu.types\";\n\n@Component({\n  selector: 'icon-triggered-context-menu',\n  templateUrl: './icon-triggered-context-menu.component.html',\n  styleUrls: ['./icon-triggered-context-menu.component.sass']\n})\nexport class IconTriggeredContextMenuComponent extends OpContextMenuTrigger {\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly opModalService:OpModalService,\n              readonly injector:Injector,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  @Input('menu-items') menuItems:Function;\n\n  protected async open(evt:JQuery.TriggeredEvent) {\n    this.items = await this.buildItems();\n    this.opContextMenu.show(this, evt);\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let additionalPositionArgs = {\n      my: 'right top',\n      at: 'right bottom'\n    };\n\n    let position = super.positionArgs(evt);\n    _.assign(position, additionalPositionArgs);\n\n    return position;\n  }\n\n  private async buildItems() {\n    let items:OpContextMenuItem[] = [];\n\n    // Add action specific menu entries\n    if (this.menuItems) {\n      const additional = await this.menuItems();\n      return items.concat(additional);\n    }\n\n    return items;\n  }\n}\n","<a href=\"#\">\n  <op-icon icon-classes=\"icon-show-more-horizontal\"></op-icon>\n</a>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QueryGroupByResource} from 'core-app/modules/hal/resources/query-group-by-resource';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {States} from 'core-components/states.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {QueryColumn} from \"core-components/wp-query/query-column\";\n\n@Injectable()\nexport class WorkPackageViewGroupByService extends WorkPackageQueryStateService<QueryGroupByResource|null> {\n  public constructor(readonly states:States,\n                     readonly querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  valueFromQuery(query:QueryResource) {\n    return query.groupBy || null;\n  }\n\n  public hasChanged(query:QueryResource) {\n    const comparer = (groupBy:QueryColumn|null|undefined) => groupBy ? groupBy.href : null;\n\n    return !_.isEqual(\n      comparer(query.groupBy),\n      comparer(this.current)\n    );\n  }\n\n  public applyToQuery(query:QueryResource) {\n    const current = this.current;\n    query.groupBy = current === null ? undefined : current;\n    return true;\n  }\n\n  public isGroupable(column:QueryColumn):boolean {\n    return !!_.find(this.available, candidate => candidate.id === column.id);\n  }\n\n  public disable() {\n    this.update(null);\n  }\n\n  public setBy(column:QueryColumn) {\n    let groupBy = _.find(this.available, candidate => candidate.id === column.id);\n\n    if (groupBy) {\n      this.update(groupBy);\n    }\n  }\n\n  public get current():QueryGroupByResource|null {\n    return this.lastUpdatedState.getValueOr(null);\n  }\n\n  protected get availableState() {\n    return this.states.queries.groupBy;\n  }\n\n  public get isEnabled():boolean {\n    return !!this.current;\n  }\n\n  public get available():QueryGroupByResource[] {\n    return this.availableState.getValueOr([]);\n  }\n\n  public isCurrentlyGroupedBy(column:QueryColumn):boolean {\n    let cur = this.current;\n    return !!(cur && cur.id === column.id);\n  }\n}\n","export const environment = {\n  production: true\n};\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {QueryGroupByResource} from 'core-app/modules/hal/resources/query-group-by-resource';\nimport {ProjectResource} from 'core-app/modules/hal/resources/project-resource';\nimport {QuerySortByResource} from 'core-app/modules/hal/resources/query-sort-by-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {HighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\nimport {QueryOrder} from \"core-app/modules/hal/dm-services/query-order-dm.service\";\n\nexport interface QueryResourceEmbedded {\n  results:WorkPackageCollectionResource;\n  columns:QueryColumn[];\n  groupBy:QueryGroupByResource|undefined;\n  project:ProjectResource;\n  sortBy:QuerySortByResource[];\n  filters:QueryFilterInstanceResource[];\n}\n\nexport type TimelineZoomLevel = 'days'|'weeks'|'months'|'quarters'|'years'|'auto';\n\nexport interface TimelineLabels {\n  left:string|null;\n  right:string|null;\n  farRight:string|null;\n}\n\nexport class QueryResource extends HalResource {\n  public $embedded:QueryResourceEmbedded;\n  public results:WorkPackageCollectionResource;\n  public columns:QueryColumn[];\n  public groupBy:QueryGroupByResource|undefined;\n  public sortBy:QuerySortByResource[];\n  public filters:QueryFilterInstanceResource[];\n  public starred:boolean;\n  public sums:boolean;\n  public hasError:boolean;\n  public timelineVisible:boolean;\n  public timelineZoomLevel:TimelineZoomLevel;\n  public highlightingMode:HighlightingMode;\n  public highlightedAttributes:HalResource[]|undefined;\n  public displayRepresentation:string|undefined;\n  public timelineLabels:TimelineLabels;\n  public showHierarchies:boolean;\n  public public:boolean;\n  public hidden:boolean;\n  public project:ProjectResource;\n  public ordered_work_packages:QueryOrder;\n\n  public $initialize(source:any) {\n    super.$initialize(source);\n\n    this.filters = this\n      .filters\n      .map((filter:Object) => new QueryFilterInstanceResource(\n          this.injector,\n          filter,\n          true,\n          this.halInitializer,\n          'QueryFilterInstance'\n        )\n      );\n  }\n}\n\nexport interface QueryResourceLinks {\n  updateImmediately?(attributes:any):Promise<any>;\n}\n\nexport interface QueryResource extends QueryResourceLinks {\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Component, ElementRef, EventEmitter, Input, Output, ViewChild} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n\n\n@Component({\n  selector: 'wp-relations-group',\n  templateUrl: './wp-relations-group.template.html'\n})\nexport class WorkPackageRelationsGroupComponent {\n  @Input() public relatedWorkPackages:WorkPackageResource[];\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public header:string;\n  @Input() public firstGroup:boolean;\n  @Input() public groupByWorkPackageType:boolean;\n\n  @Output() public onToggleGroupBy = new EventEmitter<undefined>();\n\n  @ViewChild('wpRelationGroupByToggler') readonly toggleElement:ElementRef;\n\n  public text = {\n    groupByType: this.I18n.t('js.relation_buttons.group_by_wp_type'),\n    groupByRelation: this.I18n.t('js.relation_buttons.group_by_relation_type')\n  };\n\n  constructor(\n    readonly I18n:I18nService) {\n  }\n\n  public get togglerText() {\n    if (this.groupByWorkPackageType) {\n      return this.text.groupByRelation;\n    } else {\n      return this.text.groupByType;\n    }\n  }\n\n  public toggleButton() {\n    this.onToggleGroupBy.emit();\n\n    setTimeout(() => {\n      this.toggleElement.nativeElement.focus();\n    }, 20);\n  }\n}\n","<div class=\"attributes-group\">\n  <div class=\"attributes-group--header\">\n    <div class=\"attributes-group--header-container\">\n      <h3 class=\"attributes-group--header-text relation-group--header\"\n          [textContent]=\"header\">\n      </h3>\n    </div>\n    <div class=\"attributes-group--header-toggle\"\n         *ngIf=\"firstGroup\">\n      <accessible-by-keyboard id=\"wp-relation-group-by-toggle\"\n                              #wpRelationGroupByToggler\n                              (execute)=\"toggleButton()\"\n                              linkClass=\"button -small -transparent -with-icon icon-group-by icon-small hide-when-print\"\n                              [linkAriaLabel]=\"togglerText\">\n        <span [textContent]=\"togglerText\"></span>\n      </accessible-by-keyboard>\n    </div>\n  </div>\n\n  <div class=\"content\"\n       *ngIf=\"relatedWorkPackages\">\n    <wp-relation-row\n        *ngFor=\"let relatedWorkPackage of relatedWorkPackages\"\n        [workPackage]=\"workPackage\"\n        [groupByWorkPackageType]=\"groupByWorkPackageType\"\n        [relatedWorkPackage]=\"relatedWorkPackage\"></wp-relation-row>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {KeepTabService} from '../../wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {States} from '../../states.service';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {StateService, TransitionService} from '@uirouter/core';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, OnDestroy} from '@angular/core';\nimport {AbstractWorkPackageButtonComponent} from 'core-components/wp-buttons/wp-buttons.module';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  templateUrl: '../wp-button.template.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-details-view-button',\n})\nexport class WorkPackageDetailsViewButtonComponent extends AbstractWorkPackageButtonComponent implements OnDestroy {\n  public projectIdentifier:string;\n  public accessKey:number = 8;\n  public activeState:string = 'work-packages.partitioned.list.details';\n  public listState:string = 'work-packages.partitioned.list';\n  public buttonId:string = 'work-packages-details-view-button';\n  public buttonClass:string = 'toolbar-icon';\n  public iconClass:string = 'icon-info2';\n\n  public activateLabel:string;\n  public deactivateLabel:string;\n\n  private transitionListener:Function;\n\n  constructor(\n    readonly $state:StateService,\n    readonly I18n:I18nService,\n    readonly transitions:TransitionService,\n    readonly cdRef:ChangeDetectorRef,\n    public states:States,\n    public wpTableFocus:WorkPackageViewFocusService,\n    public keepTab:KeepTabService) {\n    super(I18n);\n\n    this.activateLabel = I18n.t('js.button_open_details');\n    this.deactivateLabel = I18n.t('js.button_close_details');\n\n    this.transitionListener = this.transitions.onSuccess({}, () => {\n      this.isActive = this.$state.includes(this.activeState);\n      this.cdRef.detectChanges();\n    });\n  }\n\n  public ngOnDestroy() {\n    super.ngOnDestroy();\n    this.transitionListener();\n  }\n\n  public get label():string {\n    if (this.isActive) {\n      return this.deactivateLabel;\n    } else {\n      return this.activateLabel;\n    }\n  }\n\n  public isToggle():boolean {\n    return true;\n  }\n\n  public performAction(event:Event) {\n    if (this.isActive) {\n      this.openListView();\n    } else {\n      this.openDetailsView();\n    }\n  }\n\n  public openListView() {\n    var params = {\n      projectPath: this.projectIdentifier\n    };\n\n    _.extend(params, this.$state.params);\n    this.$state.go(this.listState, params);\n  }\n\n  public openDetailsView() {\n    var params = {\n      workPackageId: this.wpTableFocus.focusedWorkPackage,\n      projectPath: this.projectIdentifier,\n    };\n\n    _.extend(params, this.$state.params);\n    this.$state.go(this.keepTab.currentDetailsState, params);\n  }\n}\n","<button class=\"button {{ buttonClass }}\"\n        type=\"button\"\n        [ngClass]=\"{ '-active': isActive }\"\n        [disabled]=\"disabled || (!isToggle() && isActive)\"\n        [attr.id]=\"buttonId\"\n        [attr.title]=\"label\"\n        [attr.accesskey]=\"accessKey\"\n        (accessibleClick)=\"performAction($event)\">\n  <op-icon icon-classes=\"{{ iconClass }} button--icon\"></op-icon>\n</button>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {HTTPSupportedMethods} from \"core-app/modules/hal/http/http.interfaces\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\n\nexport interface HalLinkInterface {\n  href:string|null;\n  method:HTTPSupportedMethods;\n  title?:string;\n  templated?:boolean;\n  payload?:any;\n  type?:string;\n  identifier?:string;\n}\n\nexport interface HalLinkSource {\n  href:string|null;\n  title:string;\n}\n\nexport interface CallableHalLink extends HalLinkInterface {\n  $link:this;\n  data?:Promise<HalResource>;\n}\n\nexport class HalLink implements HalLinkInterface {\n  constructor(public requestMethod:(method:HTTPSupportedMethods, href:string, data:any, headers:any) => Promise<HalResource>,\n              public href:string|null = null,\n              public title:string = '',\n              public method:HTTPSupportedMethods = 'get',\n              public templated:boolean = false,\n              public payload?:any,\n              public type:string = 'application/json',\n              public identifier?:string) {\n  }\n\n  /**\n   * Create the HalLink from an object with the HalLinkInterface.\n   */\n  public static fromObject(halResourceService:HalResourceService, link:HalLinkInterface):HalLink {\n    return new HalLink(\n      (method:HTTPSupportedMethods, href:string, data:any, headers:any) =>\n        halResourceService.request(method, href, data, headers).toPromise(),\n      link.href,\n      link.title,\n      link.method,\n      link.templated,\n      link.payload,\n      link.type,\n      link.identifier\n    );\n  }\n\n  /**\n   * Fetch the resource.\n   */\n  public $fetch(...params:any[]):Promise<HalResource> {\n    const [data, headers] = params;\n    return this.requestMethod(this.method, this.href as string, data, headers);\n  }\n\n  /**\n   * Prepare the templated link and return a CallableHalLink with the templated parameters set\n   *\n   * @returns {CallableHalLink}\n   */\n  public $prepare(templateValues:{ [templateKey:string]:string }) {\n    if (!this.templated) {\n      throw 'The link ' + this.href + ' is not templated.';\n    }\n\n    let href = _.clone(this.href) || '';\n    _.each(templateValues, (value:string, key:string) => {\n      let regexp = new RegExp('{' + key + '}');\n      href = href.replace(regexp, value);\n    });\n\n    return new HalLink(\n      this.requestMethod,\n      href,\n      this.title,\n      this.method,\n      false,\n      this.payload,\n      this.type,\n      this.identifier\n    ).$callable();\n  }\n\n  /**\n   * Return a function that fetches the resource.\n   *\n   * @returns {CallableHalLink}\n   */\n  public $callable():CallableHalLink {\n    const linkFunc:any = (...params:any[]) => this.$fetch(...params);\n\n    _.extend(linkFunc, {\n      $link: this,\n      href: this.href,\n      title: this.title,\n      method: this.method,\n      templated: this.templated,\n      payload: this.payload,\n      type: this.type,\n      identifier: this.identifier,\n    });\n\n    return linkFunc;\n  }\n}\n","import {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {CardHighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\nimport {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\n\nexport type BoardType = 'free'|'action';\n\nexport interface BoardWidgetOption {\n  queryId:string;\n  filters:ApiV3Filter[];\n}\n\nexport class Board {\n  constructor(public grid:GridResource) {\n  }\n\n  public get id() {\n    return this.grid.id;\n  }\n\n  public get name() {\n    return this.grid.name;\n  }\n\n  public get editable() {\n    return !!this.grid.updateImmediately;\n  }\n\n  public get isFree() {\n    return !this.isAction;\n  }\n\n  public get isAction() {\n    return this.grid.options.type === 'action';\n  }\n\n  public get actionAttribute():string|undefined {\n    if (this.isFree) {\n      return undefined;\n    }\n\n    return this.grid.options.attribute as string;\n  }\n\n  public set highlightingMode(val:CardHighlightingMode) {\n    this.grid.options.highlightingMode = val;\n  }\n\n  public get highlightingMode():CardHighlightingMode {\n    return (this.grid.options.highlightingMode || 'none') as CardHighlightingMode;\n  }\n\n  public set name(name:string) {\n    this.grid.name = name;\n  }\n\n  public addQuery(widget:GridWidgetResource) {\n    widget.isNewWidget = true;\n    this.grid.widgets.push(widget);\n  }\n\n  public removeQuery(widget:GridWidgetResource) {\n    this.grid.widgets = this.grid.widgets.filter(el => el.options.queryId !== widget.options.queryId);\n  }\n\n  public get queries():GridWidgetResource[] {\n    return this.grid.widgets;\n  }\n\n  public get createdAt() {\n    return this.grid.createdAt;\n  }\n\n  public get filters():ApiV3Filter[] {\n    return (this.grid.options.filters || []) as ApiV3Filter[];\n  }\n\n  public set filters(filters:ApiV3Filter[]) {\n    this.grid.options.filters = filters;\n  }\n\n  public sortWidgets() {\n    this.grid.widgets = this.grid.widgets.sort((a, b) => {\n      return a.startColumn - b.startColumn;\n    });\n  }\n\n  public showStatusButton() {\n    return this.actionAttribute !== 'status';\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nexport namespace ContainHelpers {\n\n  /**\n   * Execute the callback when the element is outside\n   * @param {Element} within\n   * @param {Function} callback\n   */\n  export function whenOutside(within:Element, callback:Function) {\n    setTimeout(() => {\n      if (!insideOrSelf(within, document.activeElement!)) {\n        callback();\n      }\n    }, 20);\n  }\n\n  /**\n   * Return whether the target element is either the same as within, or contained within it.\n   *\n   * @param {Element} within\n   * @param {Element} target\n   * @returns {boolean}\n   */\n  export function insideOrSelf(within:Element, target:Element):boolean {\n    return within === target || within.contains(target);\n  }\n}\n","/**\n * Returns the collapsed group class for the given ancestor id\n */\nexport function collapsedGroupClass(ancestorId:string):string {\n  return `__collapsed-group-${ancestorId}`;\n}\n\nexport function hierarchyGroupClass(ancestorId:string):string {\n  return `__hierarchy-group-${ancestorId}`;\n}\n\nexport function hierarchyRootClass(ancestorId:string):string {\n  return `__hierarchy-root-${ancestorId}`;\n}\n\nexport function ancestorClassIdentifier(ancestorId:string) {\n  return `wp-ancestor-row-${ancestorId}`;\n}\n","import {Injectable} from '@angular/core';\nimport {\n  Class,\n  ExternalQueryConfigurationService\n} from \"core-components/wp-table/external-configuration/external-query-configuration.service\";\nimport {ExternalRelationQueryConfigurationComponent} from \"core-components/wp-table/external-configuration/external-relation-query-configuration.component\";\n\n@Injectable()\nexport class ExternalRelationQueryConfigurationService extends ExternalQueryConfigurationService {\n  externalQueryConfigurationComponent():Class {\n    return ExternalRelationQueryConfigurationComponent;\n  }\n}\n","<div *ngIf=\"editable\"\n     (focusout)=\"saveWhenFocusOutside($event)\"\n     class=\"editable-toolbar-title--container\">\n  <a *ngIf=\"showSave\"\n     role=\"link\"\n     class=\"editable-toolbar-title--save\"\n     (accessibleClick)=\"save($event, true)\"\n     [attr.aria-label]=\"text.query_has_changed_click_to_save\"\n     [attr.title]=\"text.query_has_changed_click_to_save\">\n    <span aria-hidden=\"true\" class=\"icon icon-save\"></span>\n  </a>\n  <input #editableTitleInput\n         type=\"text\"\n         aria-required=\"true\"\n         [attr.name]=\"selectableTitleIdentifier\"\n         [focus]=\"this.initialFocus || undefined\"\n         (focus)=\"onFocus($event)\"\n         (blur)=\"onBlur()\"\n         (keydown.escape)=\"reset($event)\"\n         (keydown.enter)=\"save($event)\"\n         [attr.placeholder]=\"text.input_placeholder\"\n         [attr.title]=\"text.input_title\"\n         [(ngModel)]=\"selectedTitle\"\n         [disabled]=\"inFlight\"\n         [ngClass]=\"{ '-error': isEmpty, '-changed': showSave }\"\n         class=\"editable-toolbar-title--input -border-on-hover-only toolbar--editable-toolbar ellipsis\"/>\n</div>\n<h2 *ngIf=\"!editable\"\n    [attr.title]=\"selectedTitle\"\n    [ngClass]=\"{ '-disabled': disabled, '-small': smallHeader }\"\n    class=\"editable-toolbar-title--fixed\"> {{ selectedTitle }}\n</h2>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Injector,\n  Input,\n  OnChanges,\n  OnInit,\n  Output,\n  SimpleChanges,\n  ViewChild\n} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ContainHelpers} from \"core-app/modules/common/focus/contain-helpers\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const triggerEditingEvent = 'op:selectableTitle:trigger';\nexport const selectableTitleIdentifier = 'editable-toolbar-title';\n\n@Component({\n  selector: 'editable-toolbar-title',\n  templateUrl: './editable-toolbar-title.html',\n  styleUrls: ['./editable-toolbar-title.sass'],\n  host: {'class': 'title-container'}\n})\nexport class EditableToolbarTitleComponent implements OnInit, OnChanges {\n  @Input('title') public inputTitle:string;\n  @Input() public editable:boolean = true;\n  @Input() public inFlight:boolean = false;\n  @Input() public showSaveCondition:boolean = false;\n  @Input() public initialFocus:boolean = false;\n  @Input() public smallHeader:boolean = false;\n\n  @Output() public onSave = new EventEmitter<string>();\n  @Output() public onEmptySubmit = new EventEmitter<void>();\n\n  @ViewChild('editableTitleInput') inputField?:ElementRef;\n\n  public selectedTitle:string;\n  public selectableTitleIdentifier = selectableTitleIdentifier;\n\n  @InjectField() protected readonly elementRef:ElementRef;\n  @InjectField() protected readonly I18n:I18nService;\n\n  public text = {\n    click_to_edit: this.I18n.t('js.work_packages.query.click_to_edit_query_name'),\n    press_enter_to_save: this.I18n.t('js.label_press_enter_to_save'),\n    query_has_changed_click_to_save: this.I18n.t('js.label_view_has_changed'),\n    input_title: '',\n    input_placeholder: this.I18n.t('js.work_packages.query.rename_query_placeholder'),\n    search_query_title: this.I18n.t('js.toolbar.search_query_title'),\n    confirm_edit_cancel: this.I18n.t('js.work_packages.query.confirm_edit_cancel'),\n    duplicate_query_title: this.I18n.t('js.work_packages.query.errors.duplicate_query_title')\n  };\n\n  constructor(readonly injector:Injector) {\n  }\n\n  ngOnInit() {\n    this.text['input_title'] = `${this.text.click_to_edit} ${this.text.press_enter_to_save}`;\n\n    jQuery(this.elementRef.nativeElement).on(triggerEditingEvent, (evt:Event, val:string = '') => {\n      // In case we're not editable, ignore request\n      if (!this.inputField) {\n        return;\n      }\n\n      this.selectedTitle = val;\n      setTimeout(() => {\n        const field:HTMLInputElement = this.inputField!.nativeElement;\n        field.focus();\n      }, 20);\n\n      evt.stopPropagation();\n    });\n  }\n\n  ngOnChanges(changes:SimpleChanges):void {\n\n    if (changes.inputTitle) {\n      this.selectedTitle = changes.inputTitle.currentValue;\n    }\n\n    if (changes.initialFocus && changes.initialFocus.firstChange && this.inputField!) {\n      const field:HTMLInputElement = this.inputField!.nativeElement;\n      this.selectInputOnInitalFocus(field);\n    }\n\n  }\n\n  public onFocus(event:FocusEvent) {\n    this.toggleToolbarButtonVisibility(true);\n    this.selectInputOnInitalFocus(event.target as HTMLInputElement);\n  }\n\n  public onBlur() {\n    this.toggleToolbarButtonVisibility(false);\n  }\n\n  public selectInputOnInitalFocus(input:HTMLInputElement) {\n    if (this.initialFocus) {\n      input.select();\n      this.initialFocus = false;\n    }\n  }\n\n  public saveWhenFocusOutside($event:FocusEvent) {\n    ContainHelpers.whenOutside(this.elementRef.nativeElement, () => this.save($event));\n  }\n\n  public reset() {\n    this.resetInputField();\n    this.selectedTitle = this.inputTitle;\n  }\n\n  public get showSave() {\n    return this.editable && this.showSaveCondition;\n  }\n\n  public save($event:Event, force = false) {\n    $event.preventDefault();\n\n    this.resetInputField();\n    this.selectedTitle = this.selectedTitle.trim();\n\n    // If the title is empty, show an error\n    if (this.isEmpty) {\n      this.onEmptyError();\n      return;\n    }\n\n    if (!force && this.inputTitle === this.selectedTitle) {\n      return; // Nothing changed\n    }\n\n    // Blur this element\n    if (this.inputField) {\n      (this.inputField.nativeElement as HTMLInputElement).blur();\n    }\n\n    // Avoid double saving\n    if (this.inFlight) {\n      return;\n    }\n\n    this.inFlight = true;\n\n    this.emitSave(this.selectedTitle);\n\n    // Unset in-flight after some delay not to trigger the blur\n    setTimeout(() => this.inFlight = false, 100);\n  }\n\n  public get isEmpty():boolean {\n    return this.selectedTitle === '';\n  }\n\n  /**\n   * Called when saving the changed title\n   */\n  private emitSave(title:string) {\n    this.onSave.emit(title);\n  }\n\n  /**\n   * Called when trying to save an empty text\n   */\n  private onEmptyError() {\n    // this.updateItemInMenu();  // Throws an error message, when name is empty\n    this.onEmptySubmit.emit();\n    this.focusInputOnError();\n  }\n\n  private focusInputOnError() {\n    if (this.inputField) {\n      const el = this.inputField.nativeElement;\n      el.classList.add('-error');\n      el.focus();\n    }\n  }\n\n  private resetInputField() {\n    if (this.inputField) {\n      const el = this.inputField.nativeElement;\n      el.classList.remove('-error');\n    }\n  }\n\n  private toggleToolbarButtonVisibility(hidden:boolean) {\n    jQuery('.toolbar-items').toggleClass('hidden-for-mobile', hidden);\n  }\n}\n","import {Component, ElementRef, Input, OnInit} from '@angular/core';\n\nexport const wpTableEntrySelector = 'wp-embedded-table-entry';\n\n@Component({\n  selector: wpTableEntrySelector,\n  template: `\n    <ng-container wp-isolated-query-space>\n      <wp-embedded-table [queryProps]=\"queryProps\"\n                         [initialLoadingIndicator]=\"initialLoadingIndicator\"\n                         [configuration]=\"configuration\">\n      </wp-embedded-table>\n    </ng-container>\n  `\n})\nexport class WorkPackageEmbeddedTableEntryComponent implements OnInit {\n  @Input() public queryProps:any;\n  @Input() public configuration:any;\n  @Input() public initialLoadingIndicator:boolean = true;\n\n  constructor(readonly elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    const element = this.elementRef.nativeElement;\n\n    if (element.getAttribute('query-props')) {\n      this.getInputsFromData(element);\n    }\n  }\n\n  private getInputsFromData(element:HTMLElement) {\n    this.queryProps = JSON.parse(element.getAttribute('query-props')!);\n    this.configuration = JSON.parse(element.getAttribute('configuration')!);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AttributeHelpTextsService} from './attribute-help-text.service';\nimport {HelpTextDmService} from 'core-app/modules/hal/dm-services/help-text-dm.service';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  Input,\n  OnInit\n} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {OpModalService} from 'core-components/op-modals/op-modal.service';\nimport {AttributeHelpTextModal} from 'core-app/modules/common/help-texts/attribute-help-text.modal';\n\nexport const attributeHelpTextSelector = 'attribute-help-text';\n\n@Component({\n  selector: attributeHelpTextSelector,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './attribute-help-text.component.html'\n})\nexport class AttributeHelpTextComponent implements OnInit {\n  // Attribute to show help text for\n  @Input() public attribute:string;\n  @Input() public additionalLabel?:string;\n\n  // Scope to search for\n  @Input() public attributeScope:string;\n  // Load single id entry if given\n  @Input() public helpTextId?:string;\n\n  public exists:boolean = false;\n\n  readonly text = {\n    open_dialog: this.I18n.t('js.help_texts.show_modal'),\n    'edit': this.I18n.t('js.button_edit'),\n    'close': this.I18n.t('js.button_close')\n  };\n\n  constructor(protected elementRef:ElementRef,\n              protected helpTextDm:HelpTextDmService,\n              protected attributeHelpTexts:AttributeHelpTextsService,\n              protected opModalService:OpModalService,\n              protected cdRef:ChangeDetectorRef,\n              protected injector:Injector,\n              protected I18n:I18nService) {\n  }\n\n  ngOnInit() {\n    const element:HTMLElement = this.elementRef.nativeElement;\n    if (element.dataset.helpTextId) {\n      this.helpTextId = element.dataset.helpTextId!;\n      this.attribute = element.dataset.attribute!;\n      this.attributeScope = element.dataset.attributeScope!;\n      this.additionalLabel = element.dataset.additionalLabel!;\n    }\n\n\n    if (this.helpTextId) {\n      this.exists = true;\n    } else {\n      // Need to load the promise to find out if the attribute exists\n      this.load().then((resource) => {\n        this.exists = !!resource;\n        this.cdRef.detectChanges();\n        return resource;\n      });\n    }\n  }\n\n  public handleClick() {\n    this.load().then((resource) => {\n      this.opModalService.show(AttributeHelpTextModal, this.injector, { helpText: resource });\n    });\n  }\n\n  private load() {\n    if (this.helpTextId) {\n      return this.helpTextDm.load(this.helpTextId);\n    } else {\n      return this.attributeHelpTexts.require(this.attribute, this.attributeScope);\n    }\n  }\n}\n\n","<accessible-by-keyboard (execute)=\"handleClick()\"\n                        *ngIf=\"exists\"\n                        [linkAriaLabel]=\"text.open_dialog\"\n                        linkClass=\"icon help-text--entry help-text--for-{{ attribute }}\">\n  <op-icon icon-classes=\"icon icon-help1\"></op-icon>\n  {{ additionalLabel }}\n</accessible-by-keyboard>\n","import {Injectable} from \"@angular/core\";\nimport {from, Observable} from \"rxjs\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {GridDmService} from \"core-app/modules/hal/dm-services/grid-dm.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {map, tap} from \"rxjs/operators\";\nimport {Board, BoardType} from \"core-app/modules/boards/board/board\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class BoardDmService {\n\n  constructor(protected GridDm:GridDmService,\n              protected PathHelper:PathHelperService,\n              protected authorisationService:AuthorisationService,\n              protected CurrentProject:CurrentProjectService,\n              protected halResourceService:HalResourceService) {\n  }\n\n  /**\n   * Return all boards in the current scope of the project\n   *\n   * @param projectIdentifier\n   */\n  public allInScope(projectIdentifier:string|null = this.CurrentProject.identifier) {\n    const path = this.boardPath(projectIdentifier);\n\n    return from(\n      this.GridDm.list({ filters: [['scope', '=', [path]]] })\n    )\n      .pipe(\n        tap(collection => this.authorisationService.initModelAuth('boards', collection.$links)),\n        map(collection => collection.elements.map(grid => new Board(grid)))\n      );\n  }\n\n  /**\n   * Load one board based on ID\n   */\n  public one(id:number):Observable<Board> {\n    return from(this.GridDm.one(id))\n      .pipe(\n        map(grid => new Board(grid))\n      );\n  }\n\n  /**\n   * Save the changes to the board\n   */\n  public save(board:Board) {\n    return this.fetchSchema(board)\n      .then(schema => this.GridDm.update(board.grid, schema))\n      .then(grid => {\n        board.grid = grid;\n        return board;\n      });\n  }\n\n  private fetchSchema(board:Board) {\n    return this.GridDm.updateForm(board.grid)\n      .then((form) => form.schema);\n  }\n\n  /**\n   * Retrieve the board path identifier for looking up grids.\n   *\n   * @param projectIdentifier The current project identifier\n   */\n  public boardPath(projectIdentifier:string|null = this.CurrentProject.identifier) {\n    return this.PathHelper.projectBoardsPath(projectIdentifier);\n  }\n\n  /**\n   * Create a new board\n   * @param type\n   * @param name\n   */\n  public async create(type:BoardType, name:string, actionAttribute?:string):Promise<Board> {\n    return this.createGrid(type, name, actionAttribute)\n      .then(grid => new Board(grid));\n  }\n\n  public delete(board:Board):Promise<unknown> {\n    if (!board.grid.delete) {\n      return Promise.reject(\"Deletion not possible\");\n    }\n\n    return board.grid.delete();\n  }\n\n\n  private createGrid(type:BoardType, name:string, actionAttribute?:string):Promise<GridResource> {\n    const path = this.boardPath();\n    let payload:any = _.set({ name: name }, '_links.scope.href', path);\n    payload.options = {\n      type: type,\n    };\n\n    if (actionAttribute) {\n      payload.options.attribute = actionAttribute;\n    }\n\n    return this.GridDm\n      .createForm(payload)\n      .then((form) => {\n        let resource = this.halResourceService.createHalResource<GridResource>(form.payload.$source);\n        return this.GridDm.create(resource, form.schema);\n      });\n  }\n\n}\n","import {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\n\nexport class WidgetChangeset extends ResourceChangeset<GridWidgetResource> {\n\n}\n","import {Directive, EventEmitter, HostBinding, Injector, Input, Output} from \"@angular/core\";\nimport {GridWidgetResource} from \"app/modules/hal/resources/grid-widget-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WidgetChangeset} from \"core-app/modules/grids/widgets/widget-changeset\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Directive()\nexport abstract class AbstractWidgetComponent extends UntilDestroyedMixin {\n  @HostBinding('style.grid-column-start') gridColumnStart:number;\n  @HostBinding('style.grid-column-end') gridColumnEnd:number;\n  @HostBinding('style.grid-row-start') gridRowStart:number;\n  @HostBinding('style.grid-row-end') gridRowEnd:number;\n\n  @Input() resource:GridWidgetResource;\n\n  @Output() resourceChanged = new EventEmitter<WidgetChangeset>();\n\n  public get widgetName():string {\n    let editableName = this.resource?.options.name as string;\n    let widgetIdentifier = this.resource?.identifier;\n\n    if (this.isEditable) {\n      return editableName;\n    } else {\n      return this.i18n.t(\n        `js.grid.widgets.${widgetIdentifier}.title`,\n        { defaultValue: editableName }\n      );\n    }\n  }\n\n  public renameWidget(name:string) {\n    let changeset = this.setChangesetOptions({ name: name });\n\n    this.resourceChanged.emit(changeset);\n  }\n\n  /**\n   * By default, all widget titles are editable by the user.\n   * We arbitrarily restrict this for some resources however,\n   * whose component classes will set this to false.\n   */\n  public get isEditable() {\n    return true;\n  }\n\n  constructor(protected i18n:I18nService,\n              protected injector:Injector) {\n    super();\n  }\n\n  protected setChangesetOptions(values:{ [key:string]:unknown; }) {\n    let changeset = new WidgetChangeset(this.resource);\n\n    changeset.setValue('options', Object.assign({}, this.resource.options, values));\n\n    return changeset;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {AbstractDmService} from \"core-app/modules/hal/dm-services/abstract-dm.service\";\nimport {NewsResource} from \"core-app/modules/hal/resources/news-resource\";\n\n@Injectable()\nexport class NewsDmService extends AbstractDmService<NewsResource> {\n  protected listUrl() {\n    return this.pathHelper.api.v3.news.toString();\n  }\n\n  protected oneUrl(id:number|string) {\n    return this.pathHelper.api.v3.news.id(id).toString();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\n\ndeclare global {\n  interface Window {\n    gon:GonType;\n  }\n}\n\nexport interface GonType {\n [key:string]:unknown;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class GonService {\n  get(...path:string[]):unknown|null {\n    return _.get(window.gon, path, null);\n  }\n\n  /**\n   * Get the gon object\n   */\n  get gon():GonType {\n    return window.gon;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component, Input} from '@angular/core';\nimport {BackRoutingService} from \"core-app/modules/common/back-routing/back-routing.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  template: `\n    <div class=\"wp-show--back-button hide-when-print\">\n      <accessible-by-keyboard (execute)=\"goBack()\"\n                              [linkClass]=\"classes()\"\n                              [linkAriaLabel]=\"text.goBack\"\n                              [linkTitle]=\"text.goBack\">\n        <op-icon icon-classes=\"button--icon icon-back-up\"></op-icon>\n      </accessible-by-keyboard>\n    </div>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'back-button',\n})\nexport class BackButtonComponent {\n  @Input() public linkClass:string;\n  @Input() public customBackMethod:Function;\n\n  public text = {\n    goBack: this.I18n.t('js.button_back')\n  };\n\n  constructor(readonly backRoutingService:BackRoutingService,\n              readonly I18n:I18nService) {\n  }\n\n  public goBack() {\n    if (this.customBackMethod) {\n      this.customBackMethod();\n    } else {\n      this.backRoutingService.goBack();\n    }\n  }\n\n  public classes():string {\n    let classes = 'button ';\n    classes += this.linkClass ? this.linkClass : '';\n\n    return classes;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {StatusResource} from \"core-app/modules/hal/resources/status-resource\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\n\n@Injectable()\nexport class StatusDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public one(id:string|number):Promise<StatusResource> {\n    return this.halResourceService\n      .get<StatusResource>(this.pathHelper.api.v3.statuses.id(id).toString())\n      .toPromise();\n  }\n\n  public list():Promise<CollectionResource<StatusResource>> {\n    return this.halResourceService\n      .get<CollectionResource<StatusResource>>(this.pathHelper.api.v3.statuses.toString())\n      .toPromise();\n  }\n\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {States} from '../states.service';\nimport {ErrorResource} from 'core-app/modules/hal/resources/error-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {WorkPackagesListInvalidQueryService} from './wp-list-invalid-query.service';\nimport {WorkPackageStatesInitializationService} from './wp-states-initialization.service';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {StateService} from '@uirouter/core';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {QueryFormDmService} from 'core-app/modules/hal/dm-services/query-form-dm.service';\nimport {PaginationObject, QueryDmService} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {from, Observable, of} from 'rxjs';\nimport {input} from \"reactivestates\";\nimport {catchError, mergeMap, share, switchMap, take} from \"rxjs/operators\";\nimport {WorkPackageViewPaginationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service\";\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\nimport {PaginationService} from \"core-components/table-pagination/pagination-service\";\n\nexport interface QueryDefinition {\n  queryParams:{ query_id?:string, query_props?:string };\n  projectIdentifier?:string;\n}\n\n@Injectable()\nexport class WorkPackagesListService {\n\n  // We remember the query requests coming in so we can ensure only the latest request is being tended to\n  private queryRequests = input<QueryDefinition>();\n\n  // This mapped observable requests the latest query automatically.\n  private queryLoading = this.queryRequests\n    .values$()\n    .pipe(\n      switchMap((q:QueryDefinition) => {\n        return from(this.ensurePerPageKnown().then(() => q));\n      }),\n      // Stream the query request, switchMap will call previous requests to be cancelled\n      switchMap((q:QueryDefinition) =>\n        this.streamQueryRequest(q.queryParams, q.projectIdentifier)\n      ),\n      // Map the observable from the stream to a new one that completes when states are loaded\n      mergeMap((query:QueryResource) => {\n        // load the form if needed\n        this.conditionallyLoadForm(query);\n\n        // Project the loaded query into the table states and confirm the query is fully loaded\n        this.wpStatesInitialization.initialize(query, query.results);\n        return of(query);\n      }),\n      // Share any consecutive requests to the same resource, this is due to switchMap\n      // diverting observables to the LATEST emitted.\n      share()\n    );\n\n  constructor(protected NotificationsService:NotificationsService,\n              readonly I18n:I18nService,\n              protected UrlParamsHelper:UrlParamsHelperService,\n              protected authorisationService:AuthorisationService,\n              protected $state:StateService,\n              protected QueryDm:QueryDmService,\n              protected QueryFormDm:QueryFormDmService,\n              protected states:States,\n              protected querySpace:IsolatedQuerySpace,\n              protected pagination:PaginationService,\n              protected configuration:ConfigurationService,\n              protected wpTablePagination:WorkPackageViewPaginationService,\n              protected wpStatesInitialization:WorkPackageStatesInitializationService,\n              protected wpListInvalidQueryService:WorkPackagesListInvalidQueryService) {\n  }\n\n  /**\n   * Stream a query request as a HTTP observable. Each request to this method will\n   * result in a new HTTP request.\n   *\n   * @param queryParams\n   * @param projectIdentifier\n   */\n  private streamQueryRequest(queryParams:{ query_id?:string, query_props?:string }, projectIdentifier ?:string):Observable<QueryResource> {\n    const decodedProps = this.getCurrentQueryProps(queryParams);\n    const queryData = this.UrlParamsHelper.buildV3GetQueryFromJsonParams(decodedProps);\n    const stream = this.QueryDm.stream(queryData, queryParams.query_id, projectIdentifier);\n\n    return stream.pipe(\n      catchError((error) => {\n        // Load a default query\n        const queryProps = this.UrlParamsHelper.buildV3GetQueryFromJsonParams(decodedProps);\n        return from(this.handleQueryLoadingError(error, queryProps, queryParams.query_id, projectIdentifier));\n      })\n    );\n  }\n\n  /**\n   * Load a query.\n   * The query is either a persisted query, identified by the query_id parameter, or the default query. Both will be modified by the parameters in the query_props parameter.\n   */\n  public fromQueryParams(queryParams:{ query_id?:string, query_props?:string }, projectIdentifier ?:string):Observable<QueryResource> {\n    this.queryRequests.clear();\n    this.queryRequests.putValue({ queryParams: queryParams, projectIdentifier: projectIdentifier });\n\n    return this\n      .queryLoading\n      .pipe(\n        take(1)\n      );\n  }\n\n  /**\n   * Get the current decoded query props, if any\n   */\n  public getCurrentQueryProps(params:{ query_props?:string }):string|null {\n    if (!!params.query_props) {\n      return decodeURIComponent(params.query_props);\n    }\n\n    return null;\n  }\n\n  /**\n   * Load the default query.\n   */\n  public loadDefaultQuery(projectIdentifier ?:string):Promise<QueryResource> {\n    return this.fromQueryParams({}, projectIdentifier).toPromise();\n  }\n\n  /**\n   * Reloads the current query and set the pagination to the first page.\n   */\n  public reloadQuery(query:QueryResource, projectIdentifier?:string):Observable<QueryResource> {\n    const pagination = { ...this.wpTablePagination.current, page: 1 };\n    const queryParams = this.UrlParamsHelper.encodeQueryJsonParams(query, pagination);\n\n    this.queryRequests.clear();\n    this.queryRequests.putValue({\n      queryParams: { query_id: query.id || undefined, query_props: queryParams },\n      projectIdentifier: projectIdentifier\n    });\n\n    return this\n      .queryLoading\n      .pipe(\n        take(1)\n      );\n  }\n\n  /**\n   * Update the list from an existing query object.\n   */\n  public loadResultsList(query:QueryResource, additionalParams:PaginationObject):Promise<WorkPackageCollectionResource> {\n    return this.QueryDm\n      .loadResults(query, additionalParams)\n      .then((loadedQuery) => {\n\n        this.wpStatesInitialization.updateQuerySpace(loadedQuery, loadedQuery.results);\n        this.wpStatesInitialization.updateChecksum(loadedQuery, loadedQuery.results);\n        return query.results;\n      });\n  }\n\n  /**\n   * Reload the list of work packages for the current query keeping the\n   * pagination options.\n   */\n  public reloadCurrentResultsList():Promise<WorkPackageCollectionResource> {\n    let pagination = this.getPaginationInfo();\n    let query = this.currentQuery;\n\n    return this.loadResultsList(query, pagination);\n  }\n\n  /**\n   * Load the query from the given state params\n   */\n  public loadCurrentQueryFromParams(projectIdentifier?:string) {\n    return this\n      .fromQueryParams(this.$state.params as any, projectIdentifier)\n      .toPromise();\n  }\n\n  public loadForm(query:QueryResource):Promise<QueryFormResource> {\n    return this.QueryFormDm.load(query).then((form:QueryFormResource) => {\n      this.wpStatesInitialization.updateStatesFromForm(query, form);\n\n      return form;\n    });\n  }\n\n  /**\n   * Persist the current query in the backend.\n   * After the update, the new query is reloaded (e.g. for the work packages)\n   */\n  public create(query:QueryResource, name:string):Promise<QueryResource> {\n    let form = this.querySpace.queryForm.value!;\n\n    query.name = name;\n\n    let promise = this.QueryDm.create(query, form);\n\n    promise\n      .then(query => {\n        this.NotificationsService.addSuccess(this.I18n.t('js.notice_successful_create'));\n\n        // Reload the query, and then reload the menu\n        this.reloadQuery(query).subscribe(() => {\n          this.states.changes.queries.next(query.id!);\n        });\n\n        return query;\n      });\n\n    return promise;\n  }\n\n  /**\n   * Destroy the current query.\n   */\n  public delete() {\n    let query = this.currentQuery;\n\n    let promise = this.QueryDm.delete(query);\n\n    promise\n      .then(() => {\n        this.NotificationsService.addSuccess(this.I18n.t('js.notice_successful_delete'));\n\n        let id;\n        if (query.project) {\n          id = query.project.$href!.split('/').pop();\n        }\n\n        this.loadDefaultQuery(id);\n\n        this.states.changes.queries.next(query.id!);\n      });\n\n\n    return promise;\n  }\n\n  public save(query?:QueryResource) {\n    query = query || this.currentQuery;\n\n    let form = this.querySpace.queryForm.value!;\n\n    let promise = this.QueryDm.update(query, form).toPromise();\n\n    promise\n      .then(() => {\n        this.NotificationsService.addSuccess(this.I18n.t('js.notice_successful_update'));\n\n        this.$state.go('.', { query_id: query!.id, query_props: null }, { reload: true });\n        this.states.changes.queries.next(query!.id!);\n      })\n      .catch((error:ErrorResource) => {\n        this.NotificationsService.addError(error.message);\n      });\n\n    return promise;\n  }\n\n  public toggleStarred(query:QueryResource):Promise<any> {\n    let promise = this.QueryDm.toggleStarred(query);\n\n    promise.then((query:QueryResource) => {\n      this.querySpace.query.putValue(query);\n\n      this.NotificationsService.addSuccess(this.I18n.t('js.notice_successful_update'));\n\n      this.states.changes.queries.next(query!.id!);\n    });\n\n    return promise;\n  }\n\n  private getPaginationInfo() {\n    return this.wpTablePagination.paginationObject;\n  }\n\n  private conditionallyLoadForm(query:QueryResource):void {\n    let currentForm = this.querySpace.queryForm.value;\n\n    if (!currentForm || query.$links.update.$href !== currentForm.$href) {\n      setTimeout(() => this.loadForm(query), 0);\n    }\n  }\n\n  private updateStatesFromQueryOnPromise(promise:Promise<QueryResource>):Promise<QueryResource> {\n    promise\n      .then(query => {\n        this.wpStatesInitialization.initialize(query, query.results);\n        return query;\n      });\n\n    return promise;\n  }\n\n  public get currentQuery() {\n    return this.querySpace.query.value!;\n  }\n\n  private handleQueryLoadingError(error:ErrorResource, queryProps:any, queryId?:string, projectIdentifier?:string|null):Promise<QueryResource> {\n    this.NotificationsService.addError(this.I18n.t('js.work_packages.faulty_query.description'), error.message);\n\n    return new Promise((resolve, reject) => {\n      this.QueryFormDm.loadWithParams(queryProps, queryId, projectIdentifier)\n        .then(form => {\n          this.QueryDm.findDefault({ pageSize: 0 }, projectIdentifier)\n            .then((query:QueryResource) => {\n              this.wpListInvalidQueryService.restoreQuery(query, form);\n\n              query.results.pageSize = queryProps.pageSize;\n              query.results.total = 0;\n\n              if (queryId) {\n                query.id = queryId;\n              }\n\n              this.wpStatesInitialization.initialize(query, query.results);\n              this.wpStatesInitialization.updateStatesFromForm(query, form);\n\n              resolve(query);\n            })\n            .catch(reject);\n        })\n        .catch(reject);\n    });\n  }\n\n  private async ensurePerPageKnown() {\n    if (this.pagination.isPerPageKnown) {\n      return true;\n    } else {\n      return this.configuration.initialized;\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {Component, Input, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport * as moment from 'moment';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'filter-dates-value',\n  templateUrl: './filter-dates-value.component.html'\n})\nexport class FilterDatesValueComponent extends UntilDestroyedMixin {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new DebouncedEventEmitter<QueryFilterInstanceResource>(componentDestroyed(this));\n\n  readonly text = {\n    spacer: this.I18n.t('js.filter.value_spacer')\n  };\n\n  constructor(readonly timezoneService:TimezoneService,\n              readonly I18n:I18nService) {\n    super();\n  }\n\n  public get begin():any {\n    return this.filter.values[0];\n  }\n\n  public set begin(val:any) {\n    this.filter.values[0] = val || '';\n    this.filterChanged.emit(this.filter);\n  }\n\n  public get end():HalResource|string {\n    return this.filter.values[1];\n  }\n\n  public set end(val) {\n    this.filter.values[1] = val || '';\n    this.filterChanged.emit(this.filter);\n  }\n\n  public parser(data:any) {\n    if (moment(data, 'YYYY-MM-DD', true).isValid()) {\n      return data;\n    } else {\n      return null;\n    }\n  }\n\n  public formatter(data:any) {\n    if (moment(data, 'YYYY-MM-DD', true).isValid()) {\n      var d = this.timezoneService.parseDate(data);\n      return this.timezoneService.formattedISODate(d);\n    } else {\n      return null;\n    }\n  }\n}\n","<div id=\"div-values-{{filter.id}}\"\n  class=\"inline-label\">\n  <op-date-picker (onChange)=\"begin = parser($event)\"\n                  [initialDate]=\"formatter(begin)\"\n                  [focus]=\"shouldFocus\"\n                  required=\"true\"\n                  [id]=\"'values-' + filter.id + '-begin'\"\n                  [name]=\"'v[' + filter.id + ']-begin'\"\n                  classes=\"advanced-filters--date-field\"\n                  size=\"10\">\n  </op-date-picker>\n\n  <span class=\"advanced-filters--affix\" [textContent]=\"text.spacer\">\n  </span>\n\n  <op-date-picker (onChange)=\"end = parser($event)\"\n                  [initialDate]=\"formatter(end)\"\n                  required=\"true\"\n                  [id]=\"'values-' + filter.id + '-end'\"\n                  [name]=\"'v[' + filter.id + ']-end'\"\n                  classes=\"advanced-filters--date-field\"\n                  size=\"10\">\n  </op-date-picker>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectorRef, Directive, Injector, OnDestroy, OnInit} from '@angular/core';\nimport {StateService, TransitionService} from '@uirouter/core';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {filter, take, withLatestFrom} from 'rxjs/operators';\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageStaticQueriesService} from 'core-components/wp-query-select/wp-static-queries.service';\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageViewSumService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageViewPaginationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {WorkPackagesListChecksumService} from \"core-components/wp-list/wp-list-checksum.service\";\nimport {WorkPackageQueryStateService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-base.service\";\nimport {QueryDmService} from \"core-app/modules/hal/dm-services/query-dm.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {WorkPackageViewDisplayRepresentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {HalEvent, HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {DeviceService} from \"core-app/modules/common/browser/device.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Directive()\nexport abstract class WorkPackagesViewBase extends UntilDestroyedMixin implements OnInit, OnDestroy {\n\n  @InjectField() $state:StateService;\n  @InjectField() states:States;\n  @InjectField() querySpace:IsolatedQuerySpace;\n  @InjectField() authorisationService:AuthorisationService;\n  @InjectField() wpTableColumns:WorkPackageViewColumnsService;\n  @InjectField() wpTableHighlighting:WorkPackageViewHighlightingService;\n  @InjectField() wpTableSortBy:WorkPackageViewSortByService;\n  @InjectField() wpTableGroupBy:WorkPackageViewGroupByService;\n  @InjectField() wpTableFilters:WorkPackageViewFiltersService;\n  @InjectField() wpTableSum:WorkPackageViewSumService;\n  @InjectField() wpTableTimeline:WorkPackageViewTimelineService;\n  @InjectField() wpTableHierarchies:WorkPackageViewHierarchiesService;\n  @InjectField() wpTablePagination:WorkPackageViewPaginationService;\n  @InjectField() wpTableOrder:WorkPackageViewOrderService;\n  @InjectField() wpListService:WorkPackagesListService;\n  @InjectField() wpListChecksumService:WorkPackagesListChecksumService;\n  @InjectField() loadingIndicatorService:LoadingIndicatorService;\n  @InjectField() $transitions:TransitionService;\n  @InjectField() I18n:I18nService;\n  @InjectField() wpStaticQueries:WorkPackageStaticQueriesService;\n  @InjectField() QueryDm:QueryDmService;\n  @InjectField() wpStatesInitialization:WorkPackageStatesInitializationService;\n  @InjectField() cdRef:ChangeDetectorRef;\n  @InjectField() wpDisplayRepresentation:WorkPackageViewDisplayRepresentationService;\n  @InjectField() halEvents:HalEventsService;\n  @InjectField() deviceService:DeviceService;\n  @InjectField() currentProject:CurrentProjectService;\n\n  /** Determine when query is initially loaded */\n  queryLoaded = false;\n\n  /** Remember explicitly when this component was destroyed */\n  destroyed = false;\n\n  constructor(public injector:Injector) {\n    super();\n  }\n\n  ngOnInit() {\n    // Listen to changes on the query state objects\n    this.setupQueryObservers();\n\n    // Listen for refresh changes\n    this.setupRefreshObserver();\n\n    // Mark tableInformationLoaded when initially loading done\n    this.setupQueryLoadedListener();\n  }\n\n  private setupQueryObservers() {\n    this.wpTablePagination\n      .updates$()\n      .pipe(\n        this.untilDestroyed(),\n        withLatestFrom(this.querySpace.query.values$())\n      ).subscribe(([pagination, query]) => {\n      if (this.wpListChecksumService.isQueryOutdated(query, pagination)) {\n        this.wpListChecksumService.update(query, pagination);\n        this.refresh(true, false);\n      }\n    });\n\n    this.setupChangeObserver(this.wpTableFilters, true);\n    this.setupChangeObserver(this.wpTableGroupBy);\n    this.setupChangeObserver(this.wpTableSortBy);\n    this.setupChangeObserver(this.wpTableSum);\n    this.setupChangeObserver(this.wpTableTimeline);\n    this.setupChangeObserver(this.wpTableHierarchies);\n    this.setupChangeObserver(this.wpTableColumns);\n    this.setupChangeObserver(this.wpTableHighlighting);\n    this.setupChangeObserver(this.wpTableOrder);\n    this.setupChangeObserver(this.wpDisplayRepresentation);\n  }\n\n  /**\n   * Listen to changes in the given service and reload the query / results if\n   * the service requests that.\n   *\n   * @param service Work package query state service to listento\n   * @param firstPage If the service requests a change, load the first page\n   */\n  protected setupChangeObserver(service:WorkPackageQueryStateService<unknown>, firstPage:boolean = false) {\n    const queryState = this.querySpace.query;\n\n    service\n      .updates$()\n      .pipe(\n        this.untilDestroyed(),\n        filter(() => queryState.hasValue() && service.hasChanged(queryState.value!))\n      )\n      .subscribe(() => {\n        const newQuery = queryState.value!;\n        const triggerUpdate = service.applyToQuery(newQuery);\n        this.querySpace.query.putValue(newQuery);\n\n        // Update the current checksum\n        this.wpListChecksumService\n          .updateIfDifferent(newQuery, this.wpTablePagination.current)\n          .then(() => {\n            // Update the page, if the change requires it\n            if (triggerUpdate) {\n              this.refresh(true, firstPage);\n            }\n          });\n      });\n  }\n\n  public get projectIdentifier() {\n    return this.currentProject.identifier || undefined;\n  }\n\n  /**\n   * Setup the listener for members of the table to request a refresh of the entire table\n   * through the refresh service.\n   */\n  protected setupRefreshObserver() {\n    this.halEvents\n      .aggregated$('WorkPackage')\n      .pipe(\n        this.untilDestroyed(),\n        filter((events:HalEvent[]) => this.filterRefreshEvents(events))\n      )\n      .subscribe((events:HalEvent[]) => {\n        this.refresh(false, false);\n      });\n  }\n\n\n  /**\n   * Refresh the set of results,\n   * showing the loading indicator if visibly is set.\n   *\n   * @param A refresh request\n   */\n  public abstract refresh(visibly:boolean, firstPage:boolean):Promise<unknown>;\n\n\n  /**\n   * Set the loading indicator for this set instance\n   * @param promise\n   */\n  protected abstract set loadingIndicator(promise:Promise<unknown>);\n\n  /**\n   * Filter the given work package events for something interesting\n   * @param events HalEvent[]\n   *\n   * @return {boolean} whether any of these events should trigger the view reloading\n   */\n  protected filterRefreshEvents(events:HalEvent[]):boolean {\n    let rendered = new Set(this.querySpace.renderedWorkPackageIds.getValueOr([]));\n\n    for (let i = 0; i < events.length; i++) {\n      const item = events[i];\n      if (rendered.has(item.id) || item.eventType === 'created') {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  protected setupQueryLoadedListener() {\n    this\n      .querySpace\n      .initialized\n      .values$()\n      .pipe(\n        take(1),\n        filter(() => !this.componentDestroyed)\n      )\n      .subscribe(() => {\n        this.queryLoaded = true;\n        this.cdRef.detectChanges();\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ConfirmDialogModal, ConfirmDialogOptions} from \"core-components/modals/confirm-dialog/confirm-dialog.modal\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {Injectable, Injector} from \"@angular/core\";\n\n@Injectable()\nexport class ConfirmDialogService {\n\n  constructor(readonly opModalService:OpModalService,\n              readonly injector:Injector) {\n  }\n\n  /**\n   * Confirm an action with an ng dialog with the given options\n   */\n  public confirm(options:ConfirmDialogOptions):Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const confirmModal = this.opModalService.show(ConfirmDialogModal, this.injector, { options: options });\n      confirmModal.closingEvent.subscribe((modal:ConfirmDialogModal) => {\n        if (modal.confirmed) {\n          resolve();\n        } else {\n          reject();\n        }\n      });\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {ApplicationRef} from \"@angular/core\";\n\n/**\n * Optional bootstrap definition to allow selecting all matching\n * DOM nodes to manually bootstrap them.\n *\n * This differs from Angular's bootstrap module definition since it expects these\n * entries to be present on ALL pages. This is never the case for our optional\n * bootstrapped components.\n */\nexport interface OptionalBootstrapDefinition {\n  // The DOM selector used to locate an optional node\n  selector:string;\n  // The component class tied to it.\n  cls:ComponentType<any>;\n  // Whether the component may be embeddable in dynamically generated responses\n  // e.g., previews\n  embeddable?:boolean;\n}\n\n/**\n * Static lookup table for dynamically bootstrapped components within our application\n */\nexport class DynamicBootstrapper {\n  private static optionalBoostrapComponents:OptionalBootstrapDefinition[] = [];\n\n  /**\n   * Register an optional bootstrap component to be dynamically bootstrapped\n   * whenever it occurs in the initially loaded DOM.\n   *\n   * @param {OptionalBootstrapDefinition} definition\n   */\n  public static register(...defs:OptionalBootstrapDefinition[]) {\n    this.optionalBoostrapComponents.push(...defs);\n  }\n\n  /**\n   * Perform bootstrapping of matched elements within the given document.\n   *\n   * @param {ApplicationRef} appRef The application reference to lookup elements.\n   * @param {Document} doc The document element\n   * @param {OptionalBootstrapDefinition[]|undefined} definitions An optional set of components to bootstrap\n   */\n  public static bootstrapOptionalDocument(appRef:ApplicationRef, doc:Document, definitions = this.optionalBoostrapComponents) {\n    this.performBootstrap(appRef, doc, false, definitions);\n  }\n\n  /**\n   * Perform bootstrapping of embeddable elements within the given node.\n   *\n   * @param {ApplicationRef} appRef The application reference to lookup elements.\n   * @param {HTMLElement} element A node to bootstrap elements within.\n   * @param {OptionalBootstrapDefinition[]|undefined} definitions An optional set of components to bootstrap\n   */\n  public static bootstrapOptionalEmbeddable(appRef:ApplicationRef, element:HTMLElement, definitions = this.optionalBoostrapComponents) {\n    this.performBootstrap(appRef, element, true, definitions);\n  }\n\n  /**\n   * Get embeddable components\n   */\n  public static getEmbeddable() {\n    return this.optionalBoostrapComponents.filter(el => el.embeddable);\n  }\n\n  /**\n   * Bootstrap within a given document (globally, all components available) or within an element (embeddable compoennts\n   * only).\n   *\n   * @param {ApplicationRef} appRef\n   * @param {Document | HTMLElement} root\n   * @param {boolean} embedded\n   */\n  private static performBootstrap(appRef:ApplicationRef, root:Document|HTMLElement, embedded:boolean, definitions:OptionalBootstrapDefinition[]) {\n    definitions\n      .forEach(el => {\n\n        // Skip non-embeddable components in an embedded bootstrap.\n        if (embedded && !el.embeddable) {\n          return;\n        }\n\n        const elements = root.querySelectorAll(el.selector);\n        for (let i = 0; i < elements.length; i++) {\n          appRef.bootstrap(el.cls, elements[i]);\n        }\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {WorkPackagesListChecksumService} from \"core-components/wp-list/wp-list-checksum.service\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {TransitionService} from \"@uirouter/core\";\nimport {Subject} from \"rxjs\";\n\n@Injectable()\nexport class QueryParamListenerService {\n  readonly wpListChecksumService:WorkPackagesListChecksumService = this.injector.get(WorkPackagesListChecksumService);\n  readonly wpListService:WorkPackagesListService = this.injector.get(WorkPackagesListService);\n  readonly $transitions:TransitionService = this.injector.get(TransitionService);\n\n  public observe$ = new Subject<any>();\n  public queryChangeListener:Function;\n\n  constructor(readonly injector:Injector) {\n    this.listenForQueryParamsChanged();\n  }\n\n  public listenForQueryParamsChanged():any {\n    // Listen for param changes\n    return this.queryChangeListener = this.$transitions.onSuccess({}, (transition):any => {\n      let options = transition.options();\n      const params = transition.params('to');\n\n      let newChecksum = this.wpListService.getCurrentQueryProps(params);\n      let newId:string = params.query_id ? params.query_id.toString() : null;\n\n      // Avoid performing any changes when we're going to reload\n      if (options.reload || (options.custom && options.custom.notify === false)) {\n        return true;\n      }\n\n      return this.wpListChecksumService\n        .executeIfOutdated(newId,\n          newChecksum,\n          () => {\n            this.observe$.next(newChecksum);\n          });\n    });\n  }\n\n  public removeQueryChangeListener() {\n    this.queryChangeListener();\n  }\n}\n","import {derive, input, InputState, State, StatesGroup} from 'reactivestates';\nimport {Subject} from 'rxjs';\nimport {Injectable} from '@angular/core';\nimport {map} from 'rxjs/operators';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {GroupObject, WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {QueryFormResource} from \"core-app/modules/hal/resources/query-form-resource\";\nimport {QueryColumn} from \"core-components/wp-query/query-column\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\n\n@Injectable()\nexport class IsolatedQuerySpace extends StatesGroup {\n\n  constructor() {\n    super();\n  }\n\n  name = 'IsolatedQuerySpace';\n\n  // The query that results in this table state\n  query:InputState<QueryResource> = input<QueryResource>();\n\n  // the query form associated with the table\n  queryForm = input<QueryFormResource>();\n\n  // the results associated with the table\n  results = input<WorkPackageCollectionResource>();\n  // all groups returned as results\n  groups = input<GroupObject[]>();\n  // Set of columns in strict order of appearance\n  columns = input<QueryColumn[]>();\n\n  // Current state of collapsed groups (if any)\n  collapsedGroups = input<{ [identifier:string]:boolean }>();\n\n  // State to be updated when the table is up to date\n  tableRendered = input<RenderedWorkPackage[]>();\n\n  // Event to be raised when the timeline is up to date\n  timelineRendered = new Subject<null>();\n\n  renderedWorkPackages:State<RenderedWorkPackage[]> = derive(this.tableRendered, $ => $.pipe(\n    map(rows => rows.filter(row => !!row.workPackageId)))\n  );\n\n  renderedWorkPackageIds:State<string[]> = derive(this.renderedWorkPackages, $ => $.pipe(\n    map(rows => rows.map(row => row.workPackageId!.toString())))\n  );\n\n  // Subject used to unregister all listeners of states above.\n  stopAllSubscriptions = new Subject();\n\n  // Required work packages to be rendered by hierarchy mode + relation columns\n  additionalRequiredWorkPackages = input<null>();\n\n  // Input state that emits whenever table services have initialized\n  initialized = input<unknown>();\n}\n","export enum keyCodes {\n  BACKSPACE = 8,\n  TAB = 9,\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE = 19,\n  CAPS_LOCK = 20,\n  ESCAPE = 27,\n  SPACE = 32,\n  PAGE_UP = 33,\n  PAGE_DOWN = 34,\n  END = 35,\n  HOME = 36,\n  LEFT_ARROW = 37,\n  UP_ARROW = 38,\n  RIGHT_ARROW = 39,\n  DOWN_ARROW = 40,\n  INSERT = 45,\n  DELETE = 46,\n  KEY_0 = 48,\n  KEY_1 = 49,\n  KEY_2 = 50,\n  KEY_3 = 51,\n  KEY_4 = 52,\n  KEY_5 = 53,\n  KEY_6 = 54,\n  KEY_7 = 55,\n  KEY_8 = 56,\n  KEY_9 = 57,\n  KEY_A = 65,\n  KEY_B = 66,\n  KEY_C = 67,\n  KEY_D = 68,\n  KEY_E = 69,\n  KEY_F = 70,\n  KEY_G = 71,\n  KEY_H = 72,\n  KEY_I = 73,\n  KEY_J = 74,\n  KEY_K = 75,\n  KEY_L = 76,\n  KEY_M = 77,\n  KEY_N = 78,\n  KEY_O = 79,\n  KEY_P = 80,\n  KEY_Q = 81,\n  KEY_R = 82,\n  KEY_S = 83,\n  KEY_T = 84,\n  KEY_U = 85,\n  KEY_V = 86,\n  KEY_W = 87,\n  KEY_X = 88,\n  KEY_Y = 89,\n  KEY_Z = 90,\n  LEFT_META = 91,\n  RIGHT_META = 92,\n  SELECT = 93,\n  NUMPAD_0 = 96,\n  NUMPAD_1 = 97,\n  NUMPAD_2 = 98,\n  NUMPAD_3 = 99,\n  NUMPAD_4 = 100,\n  NUMPAD_5 = 101,\n  NUMPAD_6 = 102,\n  NUMPAD_7 = 103,\n  NUMPAD_8 = 104,\n  NUMPAD_9 = 105,\n  MULTIPLY = 106,\n  ADD = 107,\n  SUBTRACT = 109,\n  DECIMAL = 110,\n  DIVIDE = 111,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  NUM_LOCK = 144,\n  SCROLL_LOCK = 145,\n  SEMICOLON = 186,\n  EQUALS = 187,\n  COMMA = 188,\n  DASH = 189,\n  PERIOD = 190,\n  FORWARD_SLASH = 191,\n  GRAVE_ACCENT = 192,\n  OPEN_BRACKET = 219,\n  BACK_SLASH = 220,\n  CLOSE_BRACKET = 221,\n  SINGLE_QUOTE = 222\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\n\n@Injectable()\nexport class WorkPackageViewSumService extends WorkPackageQueryStateService<boolean> {\n\n  public constructor(querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  public valueFromQuery(query:QueryResource) {\n    return !!query.sums;\n  }\n\n  public initialize(query:QueryResource) {\n    this.pristineState.putValue(!!query.sums);\n  }\n\n  public hasChanged(query:QueryResource) {\n    return query.sums !== this.isEnabled;\n  }\n\n  public applyToQuery(query:QueryResource) {\n    query.sums = this.isEnabled;\n    return true;\n  }\n\n  public toggle() {\n    this.updatesState.putValue(!this.current);\n  }\n\n  public setEnabled(value:boolean) {\n    this.updatesState.putValue(value);\n  }\n\n  public get isEnabled() {\n    return this.current;\n  }\n\n  public get current():boolean {\n    return this.lastUpdatedState.getValueOr(false);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Input, EventEmitter, Output} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageRelationsHierarchyService} from 'core-app/components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  templateUrl: './wp-breadcrumb-parent.html',\n  selector: 'wp-breadcrumb-parent',\n})\nexport class WorkPackageBreadcrumbParentComponent {\n  @Input('workPackage') workPackage:WorkPackageResource;\n  @Output('onSwitch') onSwitch = new EventEmitter<boolean>();\n\n  public isSaving = false;\n  public text = {\n    edit_parent: this.I18n.t('js.relation_buttons.change_parent'),\n    set_or_remove_parent: this.I18n.t('js.relations_autocomplete.parent_placeholder'),\n    remove_parent: this.I18n.t('js.relation_buttons.remove_parent'),\n    set_parent: this.I18n.t('js.relation_buttons.set_parent'),\n  };\n\n  private editing:boolean;\n\n  public constructor(\n    protected readonly I18n:I18nService,\n    protected readonly wpRelationsHierarchy:WorkPackageRelationsHierarchyService,\n    protected readonly notificationService:WorkPackageNotificationService\n    ) {\n  }\n\n  public canModifyParent():boolean {\n    return !!this.workPackage.changeParent;\n  }\n\n  public get parent() {\n    return this.workPackage && this.workPackage.parent;\n  }\n\n  public get active():boolean {\n    return this.editing;\n  }\n\n  public close():void {\n    this.toggle(false);\n  }\n\n  public open():void {\n    this.toggle(true);\n  }\n\n  public updateParent(newParent:WorkPackageResource|null) {\n    this.close();\n    let newParentId = newParent ? newParent.id : null;\n    if (_.get(this.parent, 'id', null) === newParentId) {\n      return;\n    }\n\n    this.isSaving = true;\n    this.wpRelationsHierarchy.changeParent(this.workPackage, newParentId)\n      .catch((error:any) => {\n        this.notificationService.handleRawError(error, this.workPackage);\n      })\n      .then(() => this.isSaving = false); // Behaves as .finally()\n  }\n\n  private toggle(state:boolean) {\n    if (this.editing !== state) {\n      this.editing = state;\n      this.onSwitch.emit(this.editing);\n    }\n  }\n}\n\n\n","<ng-container *ngIf=\"!active\">\n  <a *ngIf=\"parent\"\n    [attr.title]=\"parent.name\"\n    uiSref=\"work-packages.show.activity\"\n    [uiParams]=\"{workPackageId: parent.id}\"\n    class=\"wp-breadcrumb-parent breadcrumb-project-title nocut\">\n    <span [textContent]=\"parent.name\"></span>\n  </a>\n  <accessible-by-keyboard\n    (execute)=\"open()\"\n    *ngIf=\"canModifyParent()\"\n    [linkTitle]=\"parent ? text.edit_parent : text.set_parent\"\n    linkClass=\"wp-relation--parent-change -no-decoration hide-when-print icon-small {{ parent ? 'icon-edit icon5' : 'icon-add icon4' }}\">\n    <span *ngIf=\"!parent\" [textContent]=\"text.set_parent\"></span>\n  </accessible-by-keyboard>\n  <accessible-by-keyboard\n      (execute)=\"updateParent(null)\"\n      *ngIf=\"canModifyParent() && parent\"\n      [linkTitle]=\"text.remove_parent\"\n      linkClass=\"wp-relation--parent-remove hide-when-print -no-decoration icon-small icon-remove icon4\">\n  </accessible-by-keyboard>\n</ng-container>\n\n<wp-relations-autocomplete\n  *ngIf=\"active\"\n  [inputPlaceholder]=\"text.set_or_remove_parent\"\n  [workPackage]=\"workPackage\"\n  (onCancel)=\"close()\"\n  (onSelected)=\"updateParent($event)\"\n  filterCandidatesFor=\"parent\">\n</wp-relations-autocomplete>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  templateUrl: './wp-settings-button.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WorkPackageSettingsButtonComponent {\n  public text = {\n    'button_settings': this.I18n.t('js.button_settings')\n  };\n\n  constructor(readonly I18n:I18nService) {\n  }\n}\n","<button id=\"work-packages-settings-button\"\n        title=\"{{ text.button_settings }}\"\n        class=\"button last work-packages-settings-button toolbar-icon\"\n        opSettingsContextMenu\n        opSettingsContextMenu-query=\"query\">\n  <op-icon icon-classes=\"button--icon icon-show-more\"></op-icon>\n</button>\n","import {ChangeDetectorRef, Component, ElementRef, Inject, OnDestroy, OnInit, ViewChild} from '@angular/core';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {WorkPackageViewColumnsService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {HalLink} from \"core-app/modules/hal/hal-link/hal-link\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport * as URI from 'urijs';\nimport {HttpClient, HttpErrorResponse, HttpResponse} from '@angular/common/http';\nimport {\n  LoadingIndicatorService,\n  withDelayedLoadingIndicator\n} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {switchMap, takeWhile, map} from 'rxjs/operators';\nimport {interval, Observable, Subscription} from 'rxjs';\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\n\ninterface ExportLink extends HalLink {\n  identifier:string;\n}\n\n/*\nModal for exporting work packages to different formats. The user may choose from a variety of formats (e.g. PDF and CSV).\n\nThe backend may choose to provide the export right away (synchronously) or delayed. In the later case, the modal will poll the\nbackend until the export is done.\nBecause the modal has to deal with both cases, without knowing upfront whether the download will be delayed or not, it needs\nto treat every download expecting it to be delayed. Because of this, the modal cannot simply provide download hrefs which would\n allow the browser to download the export but rather has to first check whether an export is delayed or not, and if it is delayed,\n it has to wait until the export is ready. Because of the necessary check, the modal has a hidden link that it clicks on to perform\n the actual download once the export is ready (delayed or not).\n\nThe modal might also be used to only display the progress of an export. This will happen if a link for exporting is provided via the locals.\n */\n@Component({\n  templateUrl: './wp-table-export.modal.html',\n  styleUrls: ['./wp-table-export.modal.sass']\n})\nexport class WpTableExportModal extends OpModalComponent implements OnInit, OnDestroy {\n\n  /* Close on escape? */\n  public closeOnEscape = true;\n\n  /* Close on outside click */\n  public closeOnOutsideClick = true;\n\n  public $element:JQuery;\n  public exportOptions:{ identifier:string, label:string, url:string }[];\n\n  public text = {\n    title: this.I18n.t('js.label_export'),\n    closePopup: this.I18n.t('js.close_popup_title'),\n    exportPreparing: this.I18n.t('js.label_export_preparing')\n  };\n\n  public downloadHref:string;\n  public isLoading = false;\n  private subscription?:Subscription;\n\n  @ViewChild('downloadLink') downloadLink:ElementRef;\n\n  constructor(@Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly elementRef:ElementRef,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly cdRef:ChangeDetectorRef,\n              readonly httpClient:HttpClient,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly loadingIndicator:LoadingIndicatorService,\n              readonly notifications:NotificationsService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    if (this.locals.link) {\n      this.downloadSwitched(this.locals.link);\n    } else {\n      this.querySpace.results\n        .valuesPromise()\n        .then((results) => this.exportOptions = this.buildExportOptions(results!));\n    }\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n    this.safeUnsubscribe();\n  }\n\n  private buildExportOptions(results:WorkPackageCollectionResource) {\n    return results.representations.map(format => {\n      const link = format.$link as ExportLink;\n\n      return {\n        identifier: link.identifier,\n        label: link.title,\n        url: this.addColumnsToHref(format.href!)\n      };\n    });\n  }\n\n  private triggerByLink(url:string, event:MouseEvent) {\n    event.preventDefault();\n\n    this.downloadSwitched(url);\n  }\n\n  private downloadSwitched(url:string) {\n    this\n      .performRequest(url)\n      .subscribe(\n        (data) => {\n          if (data.status === 200) {\n            this.download(data.url!);\n          }\n\n          if (data.status === 202 && this.linkHeaderUrl(data)) {\n            this.pollUntilDownload(this.linkHeaderUrl(data)!);\n          }\n        },\n        (error:HttpErrorResponse) => this.handleError(error.message));\n  }\n\n  private pollUntilDownload(url:string) {\n    this.isLoading = true;\n\n    this.subscription = interval(1000)\n                        .pipe(\n                          switchMap(() => this.performRequest(url)),\n                          takeWhile(response => response.status === 200, true),\n                          map(response => JSON.parse(response.body)),\n                          takeWhile(body => body.status === 'Processing', true),\n                          withDelayedLoadingIndicator(this.loadingIndicator.getter('modal')),\n                        ).subscribe(body => {\n                            if (body.status === 'Completed') {\n                              this.download(body.link!);\n                            } else if (body.status === 'Error') {\n                              this.handleError(body.message);\n                            }\n                          },\n                          error => this.handleError(error.message),\n                          () => this.isLoading = false\n                        );\n  }\n\n  private performRequest(url:string):Observable<HttpResponse<any>> {\n    return this\n      .httpClient\n      .get(url, { observe: 'response', responseType: 'text' });\n  }\n\n  private handleError(error:string) {\n    this.isLoading = false;\n    this.notifications.addError(error || this.I18n.t('js.error.internal'));\n  }\n\n  private addColumnsToHref(href:string) {\n    let columns = this.wpTableColumns.getColumns();\n\n    let columnIds = columns.map(function (column) {\n      return column.id;\n    });\n\n    let url = URI(href);\n    // Remove current columns\n    url.removeSearch('columns[]');\n    url.addSearch('columns[]', columnIds);\n\n    return url.toString();\n  }\n\n  protected get afterFocusOn():JQuery {\n    return jQuery('#work-packages-settings-button');\n  }\n\n  private download(url:string) {\n    this.downloadHref = url;\n\n    setTimeout(() => {\n      this.downloadLink.nativeElement.click();\n      this.service.close();\n    });\n  }\n\n  private linkHeaderUrl(data:HttpResponse<any>) {\n    let link = data.headers.get('link');\n\n    if (!link) {\n      return null;\n    }\n\n    let match = link.match(/<([^>]+)>/);\n\n    if (!match) {\n      return null;\n    } else {\n      return match[1];\n    }\n  }\n\n  private safeUnsubscribe() {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n}\n","<div class=\"op-modal--portal \">\n  <div class=\"op-modal--modal-container wp-table--configuration-modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 [textContent]=\"text.title\"></h3>\n\n      <a class=\"op-modal--modal-close-button\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.closePopup\">\n        </i>\n      </a>\n    </div>\n\n    <ul *ngIf=\"exportOptions\" class=\"export-options\" [ngClass]=\"{'-hidden': isLoading}\">\n      <li *ngFor=\"let option of exportOptions\">\n        <a [attr.href]=\"option.url\"\n           (click)=\"triggerByLink(option.url, $event)\"\n           id=\"export-{{ option.identifier }}\">\n          <op-icon icon-classes=\"icon-export-{{ option.identifier }} icon-big\"></op-icon>\n          <span class=\"export-label\" [textContent]=\"option.label\"></span>\n        </a>\n      </li>\n    </ul>\n    <div *ngIf=\"isLoading\">\n      <div class=\"loading-indicator--location\"\n           data-indicator-name=\"modal\">\n      </div>\n      <div [textContent]=\"text.exportPreparing\"></div>\n    </div>\n\n    <a #downloadLink\n       id=\"download-link\"\n       [title]=\"'Export'\"\n       class=\"button\"\n       download\n       [attr.href]=\"downloadHref\">\n    </a>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {Injectable} from '@angular/core';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QuerySchemaResource} from 'core-app/modules/hal/resources/query-schema-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {combine, input, InputState} from 'reactivestates';\nimport {cloneHalResourceCollection} from 'core-app/modules/hal/helpers/hal-resource-builder';\nimport {QueryFilterResource} from \"core-app/modules/hal/resources/query-filter-resource\";\nimport {QueryFilterInstanceSchemaResource} from \"core-app/modules/hal/resources/query-filter-instance-schema-resource\";\nimport {States} from \"core-components/states.service\";\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {mapTo, take} from \"rxjs/operators\";\n\n@Injectable()\nexport class WorkPackageViewFiltersService extends WorkPackageQueryStateService<QueryFilterInstanceResource[]> {\n  public hidden:string[] = [\n    'id',\n    'parent',\n    'datesInterval',\n    'precedes',\n    'follows',\n    'relates',\n    'duplicates',\n    'duplicated',\n    'blocks',\n    'blocked',\n    'partof',\n    'includes',\n    'requires',\n    'required',\n    'search',\n    'subjectOrId'\n  ];\n\n  /** Flag state to determine whether the filters are incomplete */\n  private incomplete = input<boolean>(false);\n\n  constructor(protected readonly states:States,\n              readonly querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  /**\n   * Load all schemas for the current filters and fill respective states\n   * @param query\n   * @param schema\n   */\n  public initializeFilters(query:QueryResource, schema:QuerySchemaResource) {\n    let filters = cloneHalResourceCollection<QueryFilterInstanceResource>(query.filters);\n\n    this.loadCurrentFiltersSchemas(filters).then(() => {\n      this.availableState.putValue(schema.filtersSchemas.elements);\n      this.pristineState.putValue(filters);\n    });\n  }\n\n  /**\n   * Return whether the filters are empty\n   */\n  public get isEmpty() {\n    const value = this.lastUpdatedState.value;\n    return !value || value.length === 0;\n  }\n\n  public get availableState():InputState<QueryFilterInstanceSchemaResource[]> {\n    return this.states.queries.filters;\n  }\n\n  /** Return whether the filters the user is working on are incomplete */\n  public get incomplete$() {\n    return this.incomplete.values$();\n  }\n\n\n  /**\n   * Add a filter instantiation from the set of available filter schemas\n   *\n   * @param filter\n   */\n  public add(filter:QueryFilterInstanceResource) {\n    this.updatesState.putValue([...this.rawFilters, filter]);\n  }\n\n  /**\n   * Replace a filter, or add a new one\n   */\n  public replace(id:string, modifier:(filter:QueryFilterInstanceResource) => void):void {\n    let filter:QueryFilterInstanceResource = this.instantiate(id);\n\n    let newFilters = [...this.rawFilters];\n    modifier(filter);\n\n    const index = this.findIndex(id);\n    if (index === -1) {\n      newFilters.push(filter);\n    } else {\n      newFilters.splice(index, 1, filter);\n    }\n\n    this.update(newFilters);\n  }\n\n  /**\n   * Modify a live filter and push it to the state.\n   * Avoids copying the resource.\n   *\n   * Returns whether the filter was found and modified\n   */\n  public modify(id:string, modifier:(filter:QueryFilterInstanceResource) => void):boolean {\n    const index = this.findIndex(id);\n\n    if (index === -1) {\n      return false;\n    }\n\n    let filters = [...this.rawFilters];\n    modifier(filters[index]!);\n    this.update(filters);\n\n    return true;\n  }\n\n  /**\n   * Get an instantiated filter without adding it to the current state\n   * @param filterOrId The query filter or id to instantiate\n   */\n  public instantiate(filterOrId:QueryFilterResource|string):QueryFilterInstanceResource {\n    let id = (filterOrId instanceof QueryFilterResource) ? filterOrId.id : filterOrId;\n\n    let schema = _.find(\n      this.availableSchemas,\n      schema => (schema.filter.allowedValues as HalResource)[0].id === id\n    )!;\n\n    return schema.getFilter();\n  }\n\n  /**\n   * Remove one or more filters from the live state of filters.\n   * @param filters Filters to be removed\n   */\n  public remove(...filters:(QueryFilterInstanceResource|string)[]) {\n    let mapper = (f:QueryFilterInstanceResource|string) => (f instanceof QueryFilterInstanceResource) ? f.id : f;\n    let set = new Set<string>(filters.map(mapper));\n\n    this.update(\n      this.rawFilters.filter(f => !set.has(mapper(f)))\n    );\n  }\n\n  /**\n   * Return the remaining visible filters from the given filters set.\n   * @param filters Array of active filters, defaults to the current live state.\n   */\n  public remainingVisibleFilters(filters = this.current) {\n    return this\n      .remainingFilters(filters)\n      .filter((filter) => this.hidden.indexOf(filter.id) === -1);\n  }\n\n  /**\n   * Return all available filter resources.\n   * They need to be instantiated before using them in this service.\n   */\n  public get availableFilters():QueryFilterResource[] {\n    return this.availableSchemas.map(schema => schema.allowedFilterValue);\n  }\n\n  private get availableSchemas():QueryFilterInstanceSchemaResource[] {\n    return this.availableState.getValueOr([]);\n  }\n\n  /**\n   * Determine whether all given filters are completely defined.\n   * @param filters\n   */\n  public isComplete(filters:QueryFilterInstanceResource[]):boolean {\n    return _.every(filters, filter => filter.isCompletelyDefined());\n  }\n\n  /**\n   * Compare the current set of filters to the given query.\n   * @param query\n   */\n  public hasChanged(query:QueryResource) {\n    const comparer = (filter:HalResource[]) => filter.map(el => el.$source);\n\n    return !_.isEqual(\n      comparer(query.filters),\n      comparer(this.rawFilters)\n    );\n  }\n\n  public valueFromQuery(query:QueryResource) {\n    return undefined;\n  }\n\n  update(value:QueryFilterInstanceResource[]) {\n    super.update(value);\n    this.incomplete.putValue(false);\n  }\n\n  /**\n   * Returns the live filter instance for the given ID, or undefined\n   * if it does not exist.\n   *\n   * @param id Identifier of the filter\n   */\n  public find(id:string):QueryFilterInstanceResource|undefined {\n    const index = this.findIndex(id);\n\n    if (index === -1) {\n      return;\n    }\n\n    return this.rawFilters[index];\n  }\n\n  /**\n   * Returns the index of the filter, or -1 if it does not exist\n   * @param id Identifier of the filter\n   */\n  public findIndex(id:string):number {\n    return _.findIndex(this.current, f => f.id === id);\n  }\n\n  public applyToQuery(query:QueryResource) {\n    query.filters = this.cloneFilters();\n    return true;\n  }\n\n  /**\n   * Returns a shallow copy of the current filters.\n   * Modifications to filters themselves will still\n   */\n  public get current():QueryFilterInstanceResource[] {\n    return [...this.rawFilters];\n  }\n\n  /**\n   * Returns a deep clone of the current filters set, may be used\n   * to modify the filters without altering this state.\n   */\n  public cloneFilters() {\n    return cloneHalResourceCollection<QueryFilterInstanceResource>(this.rawFilters);\n  }\n\n  /**\n   * Returns the live state array, used for inspection of the filters\n   * without modification.\n   */\n  protected get rawFilters():QueryFilterInstanceResource[] {\n    return this.lastUpdatedState.value || [];\n  }\n\n  public get currentlyVisibleFilters() {\n    const invisibleFilters = new Set(this.hidden);\n    invisibleFilters.delete('search');\n\n    return _.reject(this.currentFilterResources, (filter) => invisibleFilters.has(filter.id));\n  }\n\n  /**\n   * Replace this filter state, but only if the given filters are complete\n   * @param newState\n   */\n  public replaceIfComplete(newState:QueryFilterInstanceResource[]) {\n    if (this.isComplete(newState)) {\n      this.update(newState);\n    } else {\n      this.incomplete.putValue(true);\n    }\n  }\n\n  /**\n   * Filters service depends on two states\n   */\n  public onReady() {\n    return combine(this.pristineState, this.availableState)\n      .values$()\n      .pipe(\n        take(1),\n        mapTo(null)\n      )\n      .toPromise();\n  }\n\n  /**\n   * Get all filters that are not in the current active set\n   */\n  private remainingFilters(filters = this.rawFilters) {\n    return _.differenceBy(this.availableFilters, filters, filter => filter.id);\n  }\n\n  /**\n   * Map current filter instances to their FilterResource\n   */\n  private get currentFilterResources():QueryFilterResource[] {\n    return this.rawFilters.map((filter:QueryFilterInstanceResource) => filter.filter);\n  }\n\n  /**\n   * Ensure all filter schemas are loaded.\n   * @param filters\n   */\n  private loadCurrentFiltersSchemas(filters:QueryFilterInstanceResource[]):Promise<unknown> {\n    return Promise.all(filters.map((filter:QueryFilterInstanceResource) => {\n      const href = `/api/v3/queries/filter_instance_schemas/${filter.id}`;\n      if (filter.schema) {\n        return filter.schema.$load();\n      } else {\n        return this.states.schemas\n          .get(href)\n          .valuesPromise()\n          .then(schema => filter.schema = schema as QueryFilterInstanceSchemaResource);\n      }\n    }));\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageViewColumnsService} from './wp-view-columns.service';\nimport {WorkPackageViewBaseService} from './wp-view-base.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {WorkPackageViewRelationColumns} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-relation-columns\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {RelationsStateValue, WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {Injectable} from \"@angular/core\";\nimport {\n  QueryColumn,\n  queryColumnTypes,\n  RelationQueryColumn,\n  TypeRelationQueryColumn\n} from \"core-components/wp-query/query-column\";\n\nexport type RelationColumnType = 'toType'|'ofType';\n\n@Injectable()\nexport class WorkPackageViewRelationColumnsService extends WorkPackageViewBaseService<WorkPackageViewRelationColumns> {\n  constructor(public querySpace:IsolatedQuerySpace,\n              public wpTableColumns:WorkPackageViewColumnsService,\n              public halResourceService:HalResourceService,\n              public wpCacheService:WorkPackageCacheService,\n              public wpRelations:WorkPackageRelationsService) {\n    super(querySpace);\n  }\n\n  public valueFromQuery(query:QueryResource):WorkPackageViewRelationColumns {\n    // Take over current expanded values\n    // which are not yet saved\n    return this.current;\n  }\n\n  /**\n   * Returns a subset of all relations that the user has currently expanded.\n   *\n   * @param workPackage\n   * @param relation\n   */\n  public relationsToExtendFor(workPackage:WorkPackageResource,\n                              relations:RelationsStateValue|undefined,\n                              eachCallback:(relation:RelationResource, column:QueryColumn, type:RelationColumnType) => void) {\n    // Only if any relation columns or stored expansion state exist\n    if (!(this.wpTableColumns.hasRelationColumns() && this.lastUpdatedState.hasValue())) {\n      return;\n    }\n\n    // Only if any relations exist for this work package\n    if (_.isNil(relations)) {\n      return;\n    }\n\n    // Only if the work package has anything expanded\n    const expanded = this.getExpandFor(workPackage.id!);\n    if (expanded === undefined) {\n      return;\n    }\n\n    const column = this.wpTableColumns.findById(expanded)!;\n    const type = this.relationColumnType(column);\n\n    if (type !== null) {\n      _.each(this.relationsForColumn(workPackage, relations, column),\n        (relation) => eachCallback(relation, column, type));\n    }\n  }\n\n  /**\n   * Get the subset of relations for the work package that belong to this relation column\n   *\n   * @param workPackage A work package resource\n   * @param relations The RelationStateValue of this work package\n   * @param column The relation column to filter for\n   * @return The filtered relations\n   */\n  public relationsForColumn(workPackage:WorkPackageResource, relations:RelationsStateValue|undefined, column:QueryColumn) {\n    if (_.isNil(relations)) {\n      return [];\n    }\n\n    // Get the type of TO work package\n    const type = this.relationColumnType(column);\n    if (type === 'toType') {\n      const typeHref = (column as TypeRelationQueryColumn).type.href;\n\n      return _.filter(relations, (relation:RelationResource) => {\n        const denormalized = relation.denormalized(workPackage);\n        const target = this.wpCacheService.state(denormalized.targetId).value;\n\n        return _.get(target, 'type.href') === typeHref;\n      });\n    }\n\n    // Get the relation types for OF relation columns\n    if (type === 'ofType') {\n      const relationType = (column as RelationQueryColumn).relationType;\n\n      return _.filter(relations, (relation:RelationResource) => {\n        return relation.denormalized(workPackage).relationType === relationType;\n      });\n    }\n\n    return [];\n  }\n\n  public relationColumnType(column:QueryColumn):RelationColumnType|null {\n    switch (column._type) {\n      case queryColumnTypes.RELATION_TO_TYPE:\n        return 'toType';\n      case queryColumnTypes.RELATION_OF_TYPE:\n        return 'ofType';\n      default:\n        return null;\n    }\n  }\n\n  public getExpandFor(workPackageId:string):string|undefined {\n    return this.current[workPackageId];\n  }\n\n  public setExpandFor(workPackageId:string, columnId:string) {\n    const nextState = { ...this.current };\n    nextState[workPackageId] = columnId;\n\n    this.update(nextState);\n  }\n\n  public collapse(workPackageId:string) {\n    const nextState = { ...this.current };\n    delete nextState[workPackageId];\n\n    this.update(nextState);\n  }\n\n  public get current():WorkPackageViewRelationColumns {\n    return this.lastUpdatedState.getValueOr({});\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector, OnDestroy} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Subject} from \"rxjs\";\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Injectable()\nexport class WorkPackageInlineCreateService implements OnDestroy {\n\n  @InjectField() protected readonly I18n:I18nService;\n  @InjectField() protected readonly authorisationService:AuthorisationService;\n\n  constructor(readonly injector:Injector) {\n  }\n\n  /**\n   * A separate reference pane for the inline create component\n   */\n  public readonly referenceComponentClass:ComponentType<any>|null = null;\n\n  /**\n   * A related work package for the inline create context\n   */\n  public referenceTarget:WorkPackageResource|null = null;\n\n  /**\n   * Reference button text\n   */\n  public readonly buttonTexts = {\n    reference: '',\n    create: this.I18n.t('js.label_create_work_package'),\n  };\n\n  public get canAdd() {\n    return this.canCreateWorkPackages || this.authorisationService.can('work_package', 'addChild');\n  }\n\n  public get canReference() {\n    return false;\n  }\n\n  public get canCreateWorkPackages() {\n    return this.authorisationService.can('work_packages', 'createWorkPackage') &&\n      this.authorisationService.can('work_packages', 'editWorkPackage');\n  }\n\n  /** Allow callbacks to happen on newly created inline work packages */\n  public newInlineWorkPackageCreated = new Subject<string>();\n\n  /** Allow callbacks to happen on newly created inline work packages */\n  public newInlineWorkPackageReferenced = new Subject<string>();\n\n  /**\n   * Ensure hierarchical injected versions of this service correctly unregister\n   */\n  ngOnDestroy() {\n    this.newInlineWorkPackageCreated.complete();\n    this.newInlineWorkPackageReferenced.complete();\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Directive, ElementRef, Injector, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {States} from 'core-components/states.service';\nimport {WorkPackagesListService} from 'core-components/wp-list/wp-list.service';\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {WpTableExportModal} from \"core-components/modals/export-modal/wp-table-export.modal\";\nimport {SaveQueryModal} from \"core-components/modals/save-modal/save-query.modal\";\nimport {QuerySharingModal} from \"core-components/modals/share-modal/query-sharing.modal\";\nimport {WpTableConfigurationModalComponent} from 'core-components/wp-table/configuration-modal/wp-table-configuration.modal';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {\n  selectableTitleIdentifier,\n  triggerEditingEvent\n} from \"core-app/modules/common/editable-toolbar-title/editable-toolbar-title.component\";\n\n@Directive({\n  selector: '[opSettingsContextMenu]'\n})\nexport class OpSettingsMenuDirective extends OpContextMenuTrigger {\n  @Input('opSettingsContextMenu-query') public query:QueryResource;\n  private form:QueryFormResource;\n  private loadingPromise:PromiseLike<any>;\n  private focusAfterClose = true;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly opModalService:OpModalService,\n              readonly wpListService:WorkPackagesListService,\n              readonly authorisationService:AuthorisationService,\n              readonly states:States,\n              readonly injector:Injector,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly I18n:I18nService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  ngAfterViewInit():void {\n    super.ngAfterViewInit();\n\n    this.querySpace.query.values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(queryUpdate => {\n        this.query = queryUpdate;\n      });\n\n    this.loadingPromise = this.querySpace.queryForm.valuesPromise();\n\n    this.querySpace.queryForm.values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(formUpdate => {\n        this.form = formUpdate;\n      });\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.loadingPromise.then(() => {\n      this.buildItems();\n      this.opContextMenu.show(this, evt);\n    });\n  }\n\n  public get locals() {\n    return {\n      contextMenuId: 'settingsDropdown',\n      items: this.items\n    };\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let additionalPositionArgs = {\n      my: 'right top',\n      at: 'right bottom'\n    };\n\n    let position = super.positionArgs(evt);\n    _.assign(position, additionalPositionArgs);\n\n    return position;\n  }\n\n  public onClose() {\n    if (this.focusAfterClose) {\n      this.afterFocusOn.focus();\n    }\n  }\n\n  private allowQueryAction(event:JQuery.TriggeredEvent, action:any) {\n    return this.allowAction(event, 'query', action);\n  }\n\n  private allowWorkPackageAction(event:JQuery.TriggeredEvent, action:any) {\n    return this.allowAction(event, 'work_packages', action);\n  }\n\n  private allowFormAction(event:JQuery.TriggeredEvent, action:string) {\n    if (this.form.$links[action]) {\n      return true;\n    } else {\n      event.stopPropagation();\n      return false;\n    }\n  }\n\n  private allowAction(event:JQuery.TriggeredEvent, modelName:string, action:any) {\n    if (this.authorisationService.can(modelName, action)) {\n      return true;\n    } else {\n      event.stopPropagation();\n      return false;\n    }\n  }\n\n  private buildItems() {\n    this.items = [\n      {\n        // Configuration modal\n        disabled: false,\n        linkText: this.I18n.t('js.toolbar.settings.configure_view'),\n        icon: 'icon-settings',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          this.opContextMenu.close();\n          this.opModalService.show(WpTableConfigurationModalComponent, this.injector);\n\n          return true;\n        }\n      },\n      {\n        // Insert columns\n        linkText: this.I18n.t('js.work_packages.query.insert_columns'),\n        icon: 'icon-columns',\n        class: 'hidden-for-mobile',\n        onClick: () => {\n          this.opModalService.show<WpTableConfigurationModalComponent>(\n            WpTableConfigurationModalComponent,\n            this.injector,\n            { initialTab: 'columns' }\n          );\n          return true;\n        }\n      },\n      {\n        // Sort by\n        linkText: this.I18n.t('js.toolbar.settings.sort_by'),\n        icon: 'icon-sort-by',\n        onClick: () => {\n          this.opModalService.show<WpTableConfigurationModalComponent>(\n            WpTableConfigurationModalComponent,\n            this.injector,\n            { initialTab: 'sort-by' }\n          );\n          return true;\n        }\n      },\n      {\n        // Group by\n        linkText: this.I18n.t('js.toolbar.settings.group_by'),\n        icon: 'icon-group-by',\n        class: 'hidden-for-mobile',\n        onClick: () => {\n          this.opModalService.show<WpTableConfigurationModalComponent>(\n            WpTableConfigurationModalComponent,\n            this.injector,\n            { initialTab: 'display-settings' }\n          );\n          return true;\n        }\n      },\n      {\n        // Rename query shortcut\n        disabled: !this.query.id || this.authorisationService.cannot('query', 'updateImmediately'),\n        linkText: this.I18n.t('js.toolbar.settings.page_settings'),\n        icon: 'icon-edit',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (this.allowQueryAction($event, 'update')) {\n            this.focusAfterClose = false;\n            jQuery(`${selectableTitleIdentifier}`).trigger(triggerEditingEvent);\n          }\n\n          return true;\n        }\n      },\n      {\n        // Query save modal\n        disabled: this.authorisationService.cannot('query', 'updateImmediately'),\n        linkText: this.I18n.t('js.toolbar.settings.save'),\n        icon: 'icon-save',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          const query = this.query;\n          if (!query.persisted && this.allowQueryAction($event, 'updateImmediately')) {\n            this.opModalService.show(SaveQueryModal, this.injector);\n          } else if (query.id && this.allowQueryAction($event, 'updateImmediately')) {\n            this.wpListService.save(query);\n          }\n\n          return true;\n        }\n      },\n      {\n        // Query save as modal\n        disabled: this.form ? !this.form.$links.create_new : this.authorisationService.cannot('query', 'updateImmediately'),\n        linkText: this.I18n.t('js.toolbar.settings.save_as'),\n        icon: 'icon-save',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (this.allowFormAction($event, 'create_new')) {\n            this.opModalService.show(SaveQueryModal, this.injector);\n          }\n\n          return true;\n        }\n      },\n      {\n        // Delete query\n        disabled: this.authorisationService.cannot('query', 'delete'),\n        linkText: this.I18n.t('js.toolbar.settings.delete'),\n        icon: 'icon-delete',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (this.allowQueryAction($event, 'delete') &&\n            window.confirm(this.I18n.t('js.text_query_destroy_confirmation'))) {\n            this.wpListService.delete();\n          }\n\n          return true;\n        }\n      },\n      {\n        // Export query\n        disabled: this.authorisationService.cannot('work_packages', 'representations'),\n        linkText: this.I18n.t('js.toolbar.settings.export'),\n        icon: 'icon-export',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (this.allowWorkPackageAction($event, 'representations')) {\n            this.opModalService.show(WpTableExportModal, this.injector);\n          }\n\n          return true;\n        }\n      },\n      {\n        // Sharing modal\n        disabled: this.authorisationService.cannot('query', 'unstar') && this.authorisationService.cannot('query', 'star'),\n        linkText: this.I18n.t('js.toolbar.settings.visibility_settings'),\n        icon: 'icon-watched',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (this.allowQueryAction($event, 'unstar') || this.allowQueryAction($event, 'star')) {\n            this.opModalService.show(QuerySharingModal, this.injector);\n          }\n\n          return true;\n        }\n      },\n      {\n        divider: true,\n        hidden: !(this.query.results.customFields && this.form.configureForm)\n      },\n      {\n        // Settings modal\n        hidden: !this.query.results.customFields,\n        href: this.query.results.customFields && this.query.results.customFields.href,\n        linkText: this.query.results.customFields && this.query.results.customFields.name,\n        icon: 'icon-custom-fields',\n        onClick: () => false\n      }\n    ];\n  }\n}\n","import {QueryColumn} from \"core-components/wp-query/query-column\";\n\nexport const internalSortColumn = {\n  id: '__internal-sorthandle'\n} as QueryColumn;\n\nexport const internalContextMenuColumn = {\n  id: '__internal-contextMenu'\n} as QueryColumn;\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n// 'Global' dependencies\n//\n// dependencies required by classic (Rails) and Angular application.\n\n// Angular 4 deps. Must be loaded early!\n// require('reflect-metadata');\n// require('zone.js');\n// require('@angular/core');\n\n// ES6 Promise polyfill\nrequire('expose-loader?Promise!es6-promise');\n\n// Lodash\nrequire('expose-loader?_!lodash');\n\n// jQuery\nrequire('expose-loader?jQuery!jquery');\nrequire('jquery-ujs');\n\nrequire('expose-loader?mousetrap!mousetrap/mousetrap.js');\n\n// Angular dependencies\nrequire('expose-loader?dragula!dragula/dist/dragula.min.js');\nrequire('@uirouter/angular');\n\n// Jquery UI\nrequire('jquery-ui/ui/core.js');\nrequire('jquery-ui/ui/position.js');\nrequire('jquery-ui/ui/widgets/datepicker.js');\nrequire('jquery-ui/ui/widgets/dialog.js');\nrequire('jquery-ui/ui/widgets/autocomplete.js');\nrequire('jquery-ui/ui/widgets/sortable.js');\nrequire('jquery-ui/ui/widgets/tooltip.js');\nrequire('./misc/datepicker-defaults');\n\nrequire('jquery-ui/ui/i18n/datepicker-en-GB.js');\nrequire('jquery-ui/ui/i18n/datepicker-de.js');\n\nrequire('jquery-ui/ui/widgets/dialog.js');\n\nrequire('expose-loader?moment!moment');\nrequire('moment/locale/en-gb.js');\nrequire('moment/locale/de.js');\n\nrequire('jquery.caret');\n// Text highlight for autocompleter\nrequire('mark.js/dist/jquery.mark.min.js');\n// Micro Text fuzzy search library\nrequire('fuse.js');\n\nrequire('moment-timezone/builds/moment-timezone-with-data.min.js');\n\nrequire('expose-loader?URI!urijs');\nrequire('urijs/src/URITemplate');\n\nrequire(\"expose-loader?I18n!../vendor/i18n\");\n\n// Localization for fullcalendar\nrequire(\"@fullcalendar/core/locales-all.min\");\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ApplicationRef, ComponentFactoryResolver, ComponentRef, Injectable, Injector} from \"@angular/core\";\nimport {DynamicBootstrapper} from \"core-app/globals/dynamic-bootstrapper\";\n\n@Injectable()\nexport class CKEditorPreviewService {\n\n  constructor(private readonly componentFactoryResolver:ComponentFactoryResolver,\n              private readonly appRef:ApplicationRef,\n              private readonly injector:Injector) {\n  }\n\n  /**\n   * Render preview into the given element, return a remover function to disconnect all\n   * dynamic components (if any).\n   *\n   * @param {HTMLElement} hostElement\n   * @param {string} preview\n   * @returns {() => void}\n   */\n  public render(hostElement:HTMLElement, preview:string):() => void {\n    hostElement.innerHTML = preview;\n    let refs:ComponentRef<any>[] = [];\n\n    DynamicBootstrapper\n      .getEmbeddable()\n      .forEach((entry) => {\n      const matchedElements = hostElement.querySelectorAll(entry.selector);\n\n      for (let i = 0, l = matchedElements.length; i < l; i++) {\n        const factory = this.componentFactoryResolver.resolveComponentFactory(entry.cls);\n        const componentRef = factory.create(this.injector, [], matchedElements[i]);\n\n        refs.push(componentRef);\n        this.appRef.attachView(componentRef.hostView);\n        componentRef.changeDetectorRef.detectChanges();\n      }\n    });\n\n    return () => {\n      refs.forEach(ref => {\n        this.appRef.detachView(ref.hostView);\n        ref.destroy();\n      });\n      refs.length = 0;\n      hostElement.innerHTML = '';\n    };\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpenprojectCommonModule} from 'core-app/modules/common/openproject-common.module';\nimport {OpenprojectFieldsModule} from 'core-app/modules/fields/openproject-fields.module';\nimport {NgModule} from '@angular/core';\nimport {OpenprojectHalModule} from \"core-app/modules/hal/openproject-hal.module\";\n\n\n@NgModule({\n  imports: [\n    // Commons\n    OpenprojectCommonModule,\n\n    OpenprojectHalModule,\n    OpenprojectFieldsModule,\n  ]\n})\nexport class OpenprojectProjectsModule {\n}\n","\nimport {debugLog} from '../../../helpers/debug_output';\nexport namespace ClickPositionMapper {\n\n  /**\n   * Try to set the position on the given input element.\n   *\n   * @param element The element to set the cursor to\n   * @param offset The character offset retrieved from getPosition.\n   */\n  export function setPosition(element:HTMLInputElement, offset:number):void {\n    try {\n      element.setSelectionRange(offset, offset);\n    } catch (e) {\n      debugLog('Failed to set click position for edit field.', e);\n    }\n  }\n\n  /**\n   * Get the cursor offset from the click event.\n   *\n   * @param evt\n   * @return {number}\n   */\n  export function getPosition(evt:any):number {\n    const originalEvt = evt.originalEvent;\n\n    try {\n      if (document.caretRangeFromPoint) {\n        return document\n          .caretRangeFromPoint(evt.clientX!, evt.clientY!)\n          .startOffset;\n      } else if (originalEvt.rangeParent) {\n        let range = document.createRange();\n        range.setStart(originalEvt.rangeParent, originalEvt.rangeOffset);\n        return range.startOffset;\n      }\n\n      return 0;\n    } catch (e) {\n      debugLog('Failed to get click position for edit field.', e);\n      return 0;\n    }\n  }\n}\n","export type ChangeItem = {\n  from:unknown;\n  to:unknown;\n};\nexport type ChangeMap = { [attribute:string]:ChangeItem };\n\nexport class Changeset {\n  private changes:ChangeMap = {};\n\n  /**\n   * Return whether a change value exist for the given attribute key.\n   * @param {string} key\n   * @return {boolean}\n   */\n  public contains(key:string) {\n    return this.changes.hasOwnProperty(key);\n  }\n\n  /**\n   * Get changed attribute names\n   * @returns {string[]}\n   */\n  public get changed():string[] {\n    return _.keys(this.changes);\n  }\n\n  /**\n   * Returns the live set of the changes.\n   */\n  public get all():ChangeMap {\n    return this.changes;\n  }\n\n  /**\n   * Reset one or multiple changes\n   * @param key\n   */\n  public reset(...keys:string[]) {\n    keys.forEach((k) => {\n      delete this.changes[k];\n    });\n  }\n\n  /**\n   * Reset the entire changeset\n   */\n  public clear():void {\n    this.changes = {};\n  }\n\n  public set(key:string, value:unknown, pristineValue:unknown):void {\n    this.changes[key] = {\n      from: pristineValue,\n      to: value\n    };\n  }\n\n  /**\n   * Get a change item for the given key, if any\n   * @param key\n   */\n  public getItem(key:string):ChangeItem|undefined {\n    return this.changes[key];\n  }\n\n  /**\n   * Get a single value from the changeset\n   * @param key\n   */\n  public getValue(key:string):unknown|undefined {\n    return this.getItem(key)?.to;\n  }\n\n  /**\n   * Get a single pristine value from the changeset\n   * @param key\n   */\n  public getPristine(key:string):unknown|undefined {\n    return this.changes[key]?.from;\n  }\n}\n","import {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {ChangeItem, ChangeMap, Changeset} from \"core-app/modules/fields/changeset/changeset\";\nimport {input, InputState} from \"reactivestates\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {take} from \"rxjs/operators\";\n\nexport const PROXY_IDENTIFIER = '__is_changeset_proxy';\n\n/**\n * Temporary class living while a resource is being edited\n * Maintains references to:\n *  - The source resource (a pristine base)\n *  - The open set of changes (a changeset object)\n *  - The current form (due to temporary type/project changes)\n *\n * Provides access to:\n *  - The projected resource with all changes applied as properties\n */\nexport class ResourceChangeset<T extends HalResource|{ [key:string]:unknown; } = HalResource> {\n  /** Maintain a single change set while editing */\n  protected changeset = new Changeset();\n\n  /** Reference and load promise for the current form */\n  protected form$ = input<FormResource>();\n\n  /** Request cache for objects within the changeset for the current form */\n  protected cache:{ [key:string]:Promise<unknown> } = {};\n\n  /** Flag whether this is currently being saved */\n  public inFlight = false;\n\n  /** Keep a reference to the original resource */\n  protected _pristineResource:T;\n\n  /** The projected resource, which will proxy values from the change set */\n  public projectedResource:T;\n\n  constructor(pristineResource:T,\n              public readonly state?:InputState<ResourceChangeset<T>>,\n              loadedForm:FormResource|null = null) {\n    this.updatePristineResource(pristineResource);\n    if (loadedForm) {\n      this.form$.putValue(loadedForm);\n    }\n  }\n\n  /**\n   * Push the change to the editing state to notify others.\n   * This will happen internally on resource wide changes\n   */\n  public push() {\n    if (this.state) {\n      this.state.putValue(this);\n    }\n  }\n\n  /**\n   * Build the request attributes against the fresh form\n   */\n  public buildRequestPayload():Promise<Object> {\n    return this\n      .getForm()\n      .then(() => this.buildPayloadFromChanges());\n  }\n\n  /**\n   * Update the pristine resource in case it changed\n   *\n   * @param attribute\n   */\n  public updatePristineResource(resource:T) {\n    // Ensure we're not passing in a proxy\n    if ((resource as any)[PROXY_IDENTIFIER]) {\n      throw \"You're trying to pass proxy object as a pristine resource. This will cause errors\";\n    }\n\n    this._pristineResource = resource;\n    this.projectedResource = new Proxy(\n      this._pristineResource,\n      {\n        get: (_, key:string) => this.proxyGet(key),\n        set: (_, key:string, val:any) => {\n          this.setValue(key, val);\n          return true;\n        },\n      }\n    );\n  }\n\n  public get pristineResource():T {\n    return this._pristineResource;\n  }\n\n  public getSchemaName(attribute:string):string {\n    if (this.projectedResource.getSchemaName) {\n      return this.projectedResource.getSchemaName(attribute);\n    } else {\n      return attribute;\n    }\n  }\n\n  /**\n   * Returns the cached form or loads it if necessary.\n   */\n  public getForm():Promise<FormResource> {\n    if (this.form$.isPristine() && !this.form$.hasActivePromiseRequest()) {\n      return this.updateForm();\n    }\n\n    return this\n      .form$\n      .values$()\n      .pipe(take(1))\n      .toPromise();\n  }\n\n  /**\n   * Cache some promised value in the course of this changeset.\n   * Will get cleared automatically by the changeset on destroy/submission\n   */\n\n  /**\n   * Posts to the form with the current changes\n   * to get the up to date projected object.\n   */\n  protected updateForm():Promise<FormResource> {\n    let payload = this.buildPayloadFromChanges();\n\n    const promise = this.pristineResource\n      .$links\n      .update(payload)\n      .then((form:FormResource) => {\n        this.cache = {};\n        this.form$.putValue(form);\n        this.setNewDefaults(form);\n        this.push();\n        return form;\n      });\n\n    this.form$.putFromPromiseIfPristine(() => promise);\n    return promise;\n  }\n\n  /**\n   * Return whether no changes were made to the work package\n   */\n  public isEmpty() {\n    return this.changeset.changed.length === 0;\n  }\n\n  /**\n   * Return the ID of the resource we're editing\n   */\n  public get id():string {\n    return this.pristineResource.id as string;\n  }\n\n  /**\n   * Return the HAL href of the resource we're editing\n   */\n  public get href():string {\n    return this.pristineResource.href as string;\n  }\n\n  /**\n   * Returns the changed `to` values of the ChangeMap\n   */\n  public get changes():{ [key:string]:unknown } {\n    let changes:{ [key:string]:unknown } = {};\n\n    _.each(this.changeset.all, (item, key) => {\n      changes[key] = item.to;\n    });\n\n    return changes;\n  }\n\n  /**\n   * Returns the change map with from and to values\n   */\n  public get changeMap():ChangeMap {\n    return { ...this.changeset.all };\n  }\n\n  /**\n   * Return the changed attributes in this change;\n   */\n  public get changedAttributes():string[] {\n    return this.changeset.changed;\n  }\n\n  /**\n   * Return whether the element is writable\n   * given the current best schema.\n   *\n   * @param key\n   */\n  public isWritable(key:string):boolean {\n    const fieldSchema = this.schema[key] as IFieldSchema|null;\n    return !!(fieldSchema && fieldSchema.writable);\n  }\n\n  /**\n   * Return the best humanized name for this attribute\n   * @param attribute\n   */\n  public humanName(attribute:string):string {\n    return _.get(this.schema, `${attribute}.name`, attribute);\n  }\n\n  /**\n   * Returns whether the given attribute was changed\n   */\n  public contains(key:string) {\n    return this.changeset.contains(key);\n  }\n\n  /**\n   * Proxy getters to base or changeset.\n   * Special case for schema , which is overridden.\n   * @param key\n   */\n  private proxyGet(key:string) {\n    if (key === 'schema') {\n      return this.schema;\n    }\n\n    if (key === '__is_proxy') {\n      return true;\n    }\n\n    return this.value(key);\n  }\n\n  /**\n   * Retrieve the editing value for the given attribute\n   *\n   * @param {string} key The attribute to read\n   * @return {any} Either the value from the overriden change, or the default value\n   */\n  public value(key:string) {\n    // Overridden value by user?\n    if (this.changeset.contains(key)) {\n      return this.changeset.getValue(key);\n    }\n\n    // Return whatever is on the base.\n    return this.pristineResource[key];\n  }\n\n  /**\n   * Return whether the given value exists,\n   * even if its undefined.\n   *\n   * @param key\n   */\n  public valueExists(key:string):boolean {\n    return this.changeset.contains(key) || this.pristineResource.hasOwnProperty(key);\n  }\n\n  /**\n   * Change the value of the projected resource to some value\n   *\n   * @param key\n   * @param val\n   */\n  public setValue(key:string, val:any) {\n    this.changeset.set(key, val, this.pristineResource[key]);\n  }\n\n  /**\n   * Clear the changed value of the projected resource\n   *\n   * @param keys A set of keys to reset\n   */\n  public clearValue(...keys:string[]) {\n    this.changeset.reset(...keys);\n  }\n\n  public clear() {\n    this.state && this.state.clear();\n    this.changeset.clear();\n    this.cache = {};\n    this.form$.clear();\n  }\n\n  /**\n   * Reset the given changed attribute\n   * @param key\n   */\n  public reset(key:string) {\n    this.changeset.reset(key);\n  }\n\n  /**\n   * Return whether a change value exist for the given attribute key.\n   * @param {string} key\n   * @return {boolean}\n   */\n  public isOverridden(key:string) {\n    return this.changes.hasOwnProperty(key);\n  }\n\n  /**\n   * Get the best schema currently available, either the default resource schema (must exist).\n   * If loaded, return the form schema, which provides better information on writable status\n   * and contains available values.\n   */\n  public get schema():SchemaResource {\n    return this.form$.getValueOr(this.pristineResource).schema;\n  }\n\n  /**\n   * Access some promised value\n   * that should be cached for the lifetime duration of the form.\n   */\n  public cacheValue<T>(key:string, request:() => Promise<T>):Promise<T> {\n    if (this.cache[key]) {\n      return this.cache[key] as Promise<T>;\n    }\n\n    return this.cache[key] = request();\n  }\n\n  protected get minimalPayload() {\n    return { lockVersion: this.pristineResource.lockVersion, _links: {} };\n  }\n\n  /**\n   * Merge the current changes into the payload resource.\n   *\n   * @param {plainPayload:unknown} A set of attributes to merge into the payload\n   * @return {any}\n   */\n  protected applyChanges(plainPayload:any) {\n    // Fall back to the last known state of the HalResource should the form not be loaded.\n    let reference = this.pristineResource.$source;\n    if (this.form$.value) {\n      reference = this.form$.value.payload.$source;\n    }\n\n    _.each(this.changeset.all, (val:ChangeItem, key:string) => {\n      const fieldSchema:IFieldSchema|undefined = this.schema[key];\n      if (!(typeof (fieldSchema) === 'object' && fieldSchema.writable)) {\n        debugLog(`Trying to write ${key} but is not writable in schema`);\n        return;\n      }\n\n      // Override in _links if it is a linked property\n      if (reference._links[key]) {\n        plainPayload._links[key] = this.getLinkedValue(val.to, fieldSchema);\n      } else {\n        plainPayload[key] = val.to;\n      }\n    });\n\n    return plainPayload;\n  }\n\n  /**\n   * Create the payload from the current changes, and extend it with the current lock version.\n   * -- This is the place to add additional logic when the lockVersion changed in between --\n   */\n  protected buildPayloadFromChanges() {\n    let payload;\n\n    if (this.pristineResource.isNew) {\n      // If the resource is new, we need to pass the entire form payload\n      // to let all default values be transmitted (type, status, etc.)\n      // We clone the object to avoid later manipulations to affect the original resource.\n      if (this.form$.value) {\n        payload = _.cloneDeep(this.form$.value.payload.$source);\n      } else {\n        payload = _.cloneDeep(this.pristineResource.$source);\n      }\n\n      // Add attachments to be assigned.\n      // They will already be created on the server but now\n      // we need to claim them for the newly created work package.\n      if (this.pristineResource.attachments) {\n        payload['_links']['attachments'] = this.pristineResource\n          .attachments\n          .elements\n          .map((a:HalResource) => {\n            return { href: a.href };\n          });\n      }\n\n    } else {\n      // Otherwise, simply use the bare minimum\n      payload = this.minimalPayload;\n    }\n\n    return this.applyChanges(payload);\n  }\n\n  /**\n   * Extract the link(s) in the given changed value\n   */\n  protected getLinkedValue(val:any, fieldSchema:IFieldSchema) {\n    // Links should always be nullified as { href: null }, but\n    // this wasn't always the case, so ensure null values are returned as such.\n    if (_.isNil(val)) {\n      return { href: null };\n    }\n\n    // Test if we either have a CollectionResource or a HAL array,\n    // or a single hal value.\n    let isArrayType = (fieldSchema.type || '').startsWith('[]');\n    let isArray = false;\n\n    if (val.forEach || val.elements) {\n      isArray = true;\n    }\n\n    if (isArray && isArrayType) {\n      let links:{ href:string }[] = [];\n\n      if (val) {\n        let elements = (val.forEach && val) || val.elements;\n\n        elements.forEach((link:{ href:string }) => {\n          if (link.href) {\n            links.push({ href: link.href });\n          }\n        });\n      }\n\n      return links;\n    } else {\n      return { href: _.get(val, 'href', null) };\n    }\n  }\n\n  /**\n   * When changing type or project, new custom fields may be present\n   * that we need to set.\n   */\n  protected setNewDefaults(form:FormResource) {\n    _.each(form.payload, (val:unknown, key:string) => {\n      const fieldSchema:IFieldSchema|undefined = this.schema[key];\n      if (!(typeof (fieldSchema) === 'object' && fieldSchema.writable)) {\n        return;\n      }\n\n      this.setNewDefaultFor(key, val);\n    });\n  }\n\n  /**\n   * Set the default for the given attribute\n   */\n  protected setNewDefaultFor(key:string, val:unknown) {\n    if (!this.valueExists(key)) {\n      debugLog(\"Taking over default value from form for \" + key);\n      this.setValue(key, val);\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {HttpClient} from \"@angular/common/http\";\n\nexport type QueryOrder = { [wpId:string]:number };\n\n@Injectable()\nexport class QueryOrderDmService {\n  constructor(protected http:HttpClient,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public get(id:string):Promise<QueryOrder> {\n    return this.http\n      .get<QueryOrder>(\n        this.orderPath(id)\n      )\n      .toPromise()\n      .then(result => result || {});\n  }\n\n  public update(id:string, delta:QueryOrder):Promise<string> {\n    return this.http\n      .patch(\n        this.orderPath(id),\n        { delta: delta },\n        { withCredentials: true }\n      )\n      .toPromise()\n      .then((response:{t:string}) => response.t);\n  }\n\n  public delete(id:string, ...wpIds:string[]) {\n    let delta:QueryOrder = {}\n    wpIds.forEach(id => delta[id] = -1);\n\n    return this.update(id, delta);\n  }\n\n  protected orderPath(id:string) {\n    return this.pathHelper.api.v3.queries.id(id).order.toString();\n  }\n}\n","/**\n * A PortalOutlet that lets multiple components live for the lifetime of the outlet,\n * allowing faster switching and persistent data.\n */\nimport {ComponentPortal} from '@angular/cdk/portal';\nimport {\n  ApplicationRef,\n  ComponentFactoryResolver,\n  ComponentRef,\n  EmbeddedViewRef,\n  Injector\n} from '@angular/core';\n\nexport interface TabInterface {\n  name:string;\n  title:string;\n  disableBecause?:string;\n  componentClass:{ new(...args:any[]):TabComponent };\n}\n\nexport interface TabComponent {\n  onSave:() => void;\n}\n\nexport interface ActiveTabInterface {\n  name:string;\n  portal:ComponentPortal<TabComponent>;\n  componentRef:ComponentRef<TabComponent>;\n  dispose:() => void;\n}\n\nexport class TabPortalOutlet {\n\n  // Active tabs that have been instantiated\n  public activeTabs:{ [name:string]:ActiveTabInterface } = {};\n\n  // The current tab\n  public currentTab:ActiveTabInterface|null = null;\n\n  constructor(\n    public availableTabs:TabInterface[],\n    public outletElement:HTMLElement,\n    private componentFactoryResolver:ComponentFactoryResolver,\n    private appRef:ApplicationRef,\n    private injector:Injector) {\n  }\n\n  public get activeComponents():TabComponent[] {\n    const tabs = _.values(this.activeTabs);\n    return tabs.map((tab:ActiveTabInterface) => tab.componentRef.instance);\n  }\n\n  public switchTo(name:string) {\n    const tab = _.find(this.availableTabs, tab => tab.name === name);\n\n    if (!tab) {\n      throw(`Trying to switch to unknown tab ${name}.`);\n    }\n\n    if (tab.disableBecause != null) {\n      return false;\n    }\n\n    // Detach any current instance\n    this.detach();\n\n    // Get existing or new component instance\n    const instance = this.activateInstance(tab);\n\n    // At this point the component has been instantiated, so we move it to the location in the DOM\n    // where we want it to be rendered.\n    this.outletElement.innerHTML = '';\n    this.outletElement.appendChild(this._getComponentRootNode(instance.componentRef));\n    this.outletElement.dataset.tabName = tab.title;\n    this.currentTab = instance;\n\n    return false;\n  }\n\n  public detach():void {\n    const current = this.currentTab;\n    if (current !== null) {\n      current.portal.setAttachedHost(null);\n      this.currentTab = null;\n    }\n  }\n\n  /**\n   * Clears out a portal from the DOM.\n   */\n  dispose():void {\n    // Dispose all active tabs\n    _.each(this.activeTabs, active => active.dispose());\n\n    // Remove outlet element\n    if (this.outletElement.parentNode != null) {\n      this.outletElement.parentNode.removeChild(this.outletElement);\n    }\n  }\n\n  private activateInstance(tab:TabInterface):ActiveTabInterface {\n    if (!this.activeTabs[tab.name]) {\n      this.activeTabs[tab.name] = this.createComponent(tab);\n    }\n\n    return this.activeTabs[tab.name] || null;\n  }\n\n  private createComponent(tab:TabInterface):ActiveTabInterface {\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(tab.componentClass);\n    const componentRef = componentFactory.create(this.injector);\n    const portal = new ComponentPortal(tab.componentClass, null, this.injector);\n\n    // Attach component view\n    this.appRef.attachView(componentRef.hostView);\n\n    return {\n      name: tab.name,\n      portal: portal,\n      componentRef: componentRef,\n      dispose: () => {\n        this.appRef.detachView(componentRef.hostView);\n        componentRef.destroy();\n      }\n    };\n  }\n\n  /** Gets the root HTMLElement for an instantiated component. */\n  private _getComponentRootNode(componentRef:ComponentRef<any>):HTMLElement {\n    return (componentRef.hostView as EmbeddedViewRef<any>).rootNodes[0] as HTMLElement;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Directive, ElementRef, Injector} from '@angular/core';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {OpTableActionsService} from \"core-components/wp-table/table-actions/table-actions.service\";\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {WorkPackageViewPaginationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageViewSumService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service\";\nimport {WorkPackageViewAdditionalElementsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-additional-elements.service\";\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {WorkPackageCreateService} from \"core-components/wp-new/wp-create.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {WorkPackageViewFocusService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {WorkPackageService} from \"core-components/work-packages/work-package.service\";\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {WorkPackageFiltersService} from \"core-components/filters/wp-filters/wp-filters.service\";\nimport {WorkPackageContextMenuHelperService} from \"core-components/wp-table/context-menu-helper/wp-context-menu-helper.service\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WpChildrenInlineCreateService} from \"core-components/wp-relations/embedded/children/wp-children-inline-create.service\";\nimport {WpRelationInlineCreateService} from \"core-components/wp-relations/embedded/relations/wp-relation-inline-create.service\";\nimport {WorkPackagesListChecksumService} from \"core-components/wp-list/wp-list-checksum.service\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {TableDragActionsRegistryService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-actions-registry.service\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {CausedUpdatesService} from \"core-app/modules/boards/board/caused-updates/caused-updates.service\";\nimport {WorkPackageCardViewService} from \"core-components/wp-card-view/services/wp-card-view.service\";\nimport {WorkPackageViewDisplayRepresentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {WorkPackageViewHierarchyIdentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy-indentation.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {TimeEntryCreateService} from \"core-app/modules/time_entries/create/create.service\";\n\n/**\n * Directive to open a work package query 'space', an isolated injector hierarchy\n * that provides access to query-bound data and services, especially around the querySpace services.\n *\n * If you add services that depend on a table state, they should be provided here, not globally\n * in a module.\n */\n@Directive({\n  selector: '[wp-isolated-query-space]',\n  providers: [\n    // Override the hal notification service\n    { provide: HalResourceNotificationService, useExisting: WorkPackageNotificationService },\n\n    // Open the isolated space first, order is important here\n    IsolatedQuerySpace,\n    OpTableActionsService,\n\n    // Work package table services\n    WorkPackagesListChecksumService,\n    WorkPackagesListService,\n    WorkPackageViewRelationColumnsService,\n    WorkPackageViewPaginationService,\n    WorkPackageViewGroupByService,\n    WorkPackageViewHierarchiesService,\n    WorkPackageViewSortByService,\n    WorkPackageViewColumnsService,\n    WorkPackageViewFiltersService,\n    WorkPackageViewTimelineService,\n    WorkPackageViewSelectionService,\n    WorkPackageViewSumService,\n    WorkPackageViewAdditionalElementsService,\n    WorkPackageViewFocusService,\n    WorkPackageViewHighlightingService,\n    WorkPackageViewDisplayRepresentationService,\n    WorkPackageViewOrderService,\n    WorkPackageViewHierarchyIdentationService,\n    CausedUpdatesService,\n\n    WorkPackageService,\n    WorkPackageRelationsHierarchyService,\n    WorkPackageFiltersService,\n    WorkPackageContextMenuHelperService,\n\n    // Provide a separate service for creation events of WP Inline create\n    // This can be hierarchically injected to provide isolated events on an embedded table\n    WorkPackageInlineCreateService,\n    WpChildrenInlineCreateService,\n    WpRelationInlineCreateService,\n\n    WorkPackageCardViewService,\n\n    HalResourceEditingService,\n    TimeEntryCreateService,\n    WorkPackageCreateService,\n\n    WorkPackageStatesInitializationService,\n\n    // Table Drag & Drop actions\n    TableDragActionsRegistryService,\n  ]\n})\nexport class WorkPackageIsolatedQuerySpaceDirective {\n\n  constructor(private elementRef:ElementRef,\n              public querySpace:IsolatedQuerySpace,\n              private injector:Injector) {\n    debugLog(\"Opening isolated query space %O in %O\", injector, elementRef.nativeElement);\n  }\n}\n","import {\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n} from '@angular/common/http';\nimport {Observable} from 'rxjs';\nimport { Injectable } from \"@angular/core\";\n\n@Injectable()\nexport class OpenProjectHeaderInterceptor implements HttpInterceptor {\n  intercept(req:HttpRequest<any>, next:HttpHandler):Observable<HttpEvent<any>> {\n    const csrf_token:string|undefined = jQuery('meta[name=csrf-token]').attr('content');\n\n    if (req.withCredentials !== false) {\n\n      let newHeaders = req.headers\n        .set('X-Authentication-Scheme', 'Session')\n        .set('X-Requested-With', 'XMLHttpRequest');\n\n      if (csrf_token) {\n        newHeaders = newHeaders.set('X-CSRF-TOKEN',  csrf_token);\n      }\n\n      // Clone the request to add the new header\n      const clonedRequest = req.clone({\n        withCredentials: true,\n        headers: newHeaders\n      });\n\n      // Pass the cloned request instead of the original request to the next handle\n      return next.handle(clonedRequest);\n    }\n\n    return next.handle(req);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit, OnDestroy} from '@angular/core';\n\n@Component({\n  selector: 'col[highlight-col]',\n  template: ''\n})\n\nexport class HighlightColDirective implements OnInit, OnDestroy {\n  private $element:JQuery;\n  private thead:JQuery;\n\n  constructor(private elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n    this.thead = this.$element\n      .parent('colgroup')\n      .siblings('thead');\n\n    // Separate handling instead of toggle is necessary to avoid\n    // unwanted side effects when adding/removing columns via keyboard in the modal\n    this.thead.on('mouseenter', 'th', (evt:JQuery.TriggeredEvent) => {\n      if (this.$element.index() === jQuery(evt.currentTarget).index()) {\n        this.$element.addClass('hover');\n      }\n    });\n\n    this.thead.on('mouseleave', 'th', (evt:JQuery.TriggeredEvent) => {\n      if (this.$element.index() === jQuery(evt.currentTarget).index()) {\n        this.$element.removeClass('hover');\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.thead.off('mouseenter mouseleave');\n  }\n}\n\nexport const highlightColBootstrap = {\n  selector: 'col[highlight-col]',\n  cls: HighlightColDirective\n};\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, EventEmitter, Injector, Input, OnInit, Output, ViewChild} from '@angular/core';\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {ApiV3FilterBuilder, FilterOperator} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Observable} from \"rxjs\";\nimport {map} from \"rxjs/operators\";\nimport {DebouncedRequestSwitchmap, errorNotificationHandler} from \"core-app/helpers/rxjs/debounced-input-switchmap\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\n\nexport const usersAutocompleterSelector = 'user-autocompleter';\n\n@Component({\n  templateUrl: './user-autocompleter.component.html',\n  selector: usersAutocompleterSelector\n})\nexport class UserAutocompleterComponent implements OnInit {\n  userTracker = (item:any) => item.href || item.id;\n\n  @ViewChild(NgSelectComponent, { static: true }) public ngSelectComponent:NgSelectComponent;\n  @Output() public onChange = new EventEmitter<void>();\n  @Input() public clearAfterSelection:boolean = false;\n\n  // Load all users as default\n  @Input() public url:string = this.pathHelper.api.v3.users.path;\n  @Input() public allowEmpty:boolean = false;\n  @Input() public appendTo:string = '';\n  @Input() public multiple:boolean = false;\n\n  @Input() public initialSelection:number|null = null;\n\n  // Update an input field after changing, used when externally loaded\n  private updateInputField:HTMLInputElement|undefined;\n\n  /** Keep a switchmap for search term and loading state */\n  public requests = new DebouncedRequestSwitchmap<string, {[key:string]:string|null}>(\n    (searchTerm:string) => this.getAvailableUsers(this.url, searchTerm),\n    errorNotificationHandler(this.halNotification)\n  );\n\n  public inputFilters:ApiV3FilterBuilder = new ApiV3FilterBuilder();\n\n  constructor(protected elementRef:ElementRef,\n              protected halResourceService:HalResourceService,\n              protected I18n:I18nService,\n              protected halNotification:HalResourceNotificationService,\n              readonly pathHelper:PathHelperService,\n              readonly injector:Injector) {\n  }\n\n  ngOnInit() {\n    const input = this.elementRef.nativeElement.dataset['updateInput'];\n    const allowEmpty = this.elementRef.nativeElement.dataset['allowEmpty'];\n    const appendTo = this.elementRef.nativeElement.dataset['appendTo'];\n    const multiple = this.elementRef.nativeElement.dataset['multiple'];\n    const url = this.elementRef.nativeElement.dataset['url'];\n\n    if (input) {\n      this.updateInputField = document.getElementsByName(input)[0] as HTMLInputElement|undefined;\n      this.setInitialSelection();\n    }\n\n    let filterInput  = this.elementRef.nativeElement.dataset['additionalFilter'];\n    if (filterInput) {\n      JSON.parse(filterInput).forEach((filter:{selector:string; operator:FilterOperator, values:string[]}) => {\n        this.inputFilters.add(filter['selector'], filter['operator'], filter['values']);\n      });\n    }\n\n    if (allowEmpty === 'true') {\n      this.allowEmpty = true;\n    }\n\n    if (appendTo) {\n      this.appendTo = appendTo;\n    }\n\n    if (multiple === 'true') {\n      this.multiple = true;\n    }\n\n    if (url) {\n      this.url = url;\n    }\n  }\n\n  public onFocus() {\n    if (!this.requests.lastRequestedValue) {\n      this.requests.input$.next('');\n    }\n  }\n\n  public onModelChange(user:any) {\n    if (user) {\n      this.onChange.emit(user);\n      this.requests.input$.next('');\n\n      if (this.clearAfterSelection) {\n        this.ngSelectComponent.clearItem(user);\n      }\n\n      if (this.updateInputField) {\n        if (this.multiple) {\n          this.updateInputField.value = user.map((u:UserResource) => u.id);\n        } else {\n          this.updateInputField.value = user.id;\n        }\n      }\n    }\n  }\n\n  protected getAvailableUsers(url:string, searchTerm:any):Observable<{[key:string]:string|null}[]> {\n    // Need to clone the filters to not add additional filters on every\n    // search term being processed.\n    let searchFilters = this.inputFilters.clone();\n\n    if (searchTerm && searchTerm.length) {\n      searchFilters.add('name', '~', [searchTerm]);\n    }\n\n    return this.halResourceService\n      .get(url, { filters: searchFilters.toJson() })\n      .pipe(\n        map(res => {\n          let options = res.elements.map((el:any) => {\n            return {name: el.name, id: el.id, href: el.href, avatar: el.avatar};\n          });\n\n          if (this.allowEmpty) {\n            options.unshift({name: this.I18n.t('js.timelines.filter.noneSelection'), href: null, id: null});\n          }\n\n          return options;\n        })\n      );\n  }\n\n  private setInitialSelection() {\n    if (this.updateInputField) {\n      const id = parseInt(this.updateInputField.value);\n      this.initialSelection = isNaN(id) ? null : id;\n    }\n  }\n}\n\n","<ng-select [items]=\"requests.output$ | async\"\n           bindLabel=\"name\"\n           bindValue=\"id\"\n           [ngModel]=\"initialSelection\"\n           [virtualScroll]=\"true\"\n           [trackByFn]=\"userTracker\"\n           [typeahead]=\"requests.input$\"\n           [loading]=\"requests.loading$ | async\"\n           (focus)=\"onFocus()\"\n           (change)=\"onModelChange($event)\"\n           [appendTo]=\"appendTo\"\n           [multiple]=\"multiple\" >\n  <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\">\n    <user-avatar *ngIf=\"item && item.id\"\n                 [user]=\"item\"\n                 data-class-list=\"avatar-mini\">\n    </user-avatar>\n    {{ item.name }}\n  </ng-template>\n</ng-select>","import {\n  ApplicationRef,\n  ComponentFactoryResolver,\n  ComponentRef,\n  Injectable,\n  InjectionToken,\n  Injector\n} from '@angular/core';\nimport {ComponentPortal, ComponentType, DomPortalOutlet, PortalInjector} from '@angular/cdk/portal';\nimport {TransitionService} from '@uirouter/core';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {FocusHelperService} from 'core-app/modules/common/focus/focus-helper';\n\nexport const OpModalLocalsToken = new InjectionToken<any>('OP_MODAL_LOCALS');\n\n@Injectable({ providedIn: 'root' })\nexport class OpModalService {\n  public active:OpModalComponent|null = null;\n\n  // Hold a reference to the DOM node we're using as a host\n  private portalHostElement:HTMLElement;\n  // And a reference to the actual portal host interface on top of the element\n  private bodyPortalHost:DomPortalOutlet;\n\n  // Remember when we're opening a new modal to avoid the outside click bubbling up.\n  private opening:boolean = false;\n\n  constructor(private componentFactoryResolver:ComponentFactoryResolver,\n              readonly FocusHelper:FocusHelperService,\n              private appRef:ApplicationRef,\n              private $transitions:TransitionService,\n              private injector:Injector) {\n\n    const hostElement = this.portalHostElement = document.createElement('div');\n    hostElement.classList.add('op-modals--overlay');\n    document.body.appendChild(hostElement);\n\n    // Listen to keyups on window to close context menus\n    jQuery(window).on('keydown', (evt:JQuery.TriggeredEvent) => {\n      if (this.active && this.active.closeOnEscape && evt.which === keyCodes.ESCAPE) {\n        this.active.closeOnEscapeFunction(evt);\n      }\n\n      return true;\n    });\n\n    // Listen to any click when should close outside modal\n    jQuery(window).on('click', (evt:JQuery.TriggeredEvent) => {\n      if (this.active &&\n        !this.opening &&\n        this.active.closeOnOutsideClick &&\n        this.activeModal[0] === evt.target as Element) {\n        this.close();\n      }\n    });\n\n    this.bodyPortalHost = new DomPortalOutlet(\n      hostElement,\n      this.componentFactoryResolver,\n      this.appRef,\n      this.injector\n    );\n  }\n\n  /**\n   * Open a Modal reference and append it to the portal\n   *\n   * @param modal The modal component class to show\n   * @param injector The injector to pass into the component. Ensure this is the hierarchical injector if needed.\n   *                 Can be passed 'global' to take the default (global!) injector of this service.\n   * @param locals A map to be injected via token into the component.\n   */\n  public show<T extends OpModalComponent>(modal:ComponentType<T>, injector:Injector|'global', locals:any = {}):T {\n    this.close();\n\n    // Prevent closing events during the opening time frame.\n    this.opening = true;\n\n    // Allow users to pass the global injector when deliberately requested.\n    if (injector === 'global') {\n      injector = this.injector;\n    }\n\n    // Create a portal for the given component class and render it\n    const portal = new ComponentPortal(modal, null, this.injectorFor(injector, locals));\n    const ref:ComponentRef<OpModalComponent> = this.bodyPortalHost.attach(portal) as ComponentRef<OpModalComponent>;\n    const instance = ref.instance as T;\n    this.active = instance;\n    this.portalHostElement.style.display = 'block';\n\n    setTimeout(() => {\n      // Focus on the first element\n      this.active && this.active.onOpen(this.activeModal);\n\n      // Mark that we've opened the modal now\n      this.opening = false;\n    }, 20);\n\n    jQuery('.op-modal--modal-container').focus();\n\n    return this.active as T;\n  }\n\n  public isActive(modal:OpModalComponent) {\n    return this.active && this.active === modal;\n  }\n\n  /**\n   * Closes currently open modal window\n   */\n  public close() {\n    // Detach any component currently in the portal\n    if (this.active && this.active.onClose()) {\n      this.active.closingEvent.emit(this.active);\n      this.bodyPortalHost.detach();\n      this.portalHostElement.style.display = 'none';\n      this.active = null;\n    }\n  }\n\n  public get activeModal():JQuery {\n    return jQuery(this.portalHostElement).find('.op-modal--portal');\n  }\n\n  /**\n   * Create an augmented injector that is equal to this service's injector + the additional data\n   * passed into +show+.\n   * This allows callers to pass data into the newly created modal.\n   *\n   */\n  private injectorFor(injector:Injector, data:any) {\n    const injectorTokens = new WeakMap();\n    // Pass the service because otherwise we're getting a cyclic dependency between the portal\n    // host service and the bound portal\n    data.service = this;\n\n    injectorTokens.set(OpModalLocalsToken, data);\n\n    return new PortalInjector(injector, injectorTokens);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {Injector} from '@angular/core';\nimport {FocusHelperService} from 'core-app/modules/common/focus/focus-helper';\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {ClickPositionMapper} from \"core-app/modules/common/set-click-position/set-click-position\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {Subject} from 'rxjs';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {EditForm} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HalResourceEditFieldHandler extends EditFieldHandler {\n  // Injections\n  @InjectField() FocusHelper:FocusHelperService;\n  @InjectField() ConfigurationService:ConfigurationService;\n  @InjectField() I18n:I18nService;\n\n  // Subject to fire when user demanded activation\n  public $onUserActivate = new Subject<void>();\n\n  // Current errors of the field\n  public errors:string[];\n\n  constructor(public injector:Injector,\n              public form:EditForm,\n              public fieldName:string,\n              public schema:IFieldSchema,\n              public element:HTMLElement,\n              protected pathHelper:PathHelperService,\n              protected withErrors?:string[]) {\n\n    super();\n\n    if (withErrors !== undefined) {\n      this.setErrors(withErrors);\n    }\n  }\n\n  /**\n   * Stop this event from propagating out of the edit field context.\n   */\n  public stopPropagation(evt:JQuery.TriggeredEvent) {\n    evt.stopPropagation();\n    return false;\n  }\n\n  public get inEditMode() {\n    return this.form.editMode;\n  }\n\n  public get inFlight() {\n    return this.form.change.inFlight;\n  }\n\n  public get active() {\n    return true;\n  }\n\n  public focus(setClickOffset?:number) {\n    const target = this.element.querySelector('.inline-edit--field') as HTMLElement;\n\n    if (!target) {\n      debugLog(`Tried to focus on ${this.fieldName}, but element does not (yet) exist.`);\n      return;\n    }\n\n    // Focus the input\n    target.focus();\n\n    // Set selection state if input element\n    if (setClickOffset && target.tagName === 'INPUT') {\n      ClickPositionMapper.setPosition(target as HTMLInputElement, setClickOffset);\n    }\n  }\n\n  public onFocusOut() {\n    // In case of inline create or erroneous forms: do not save on focus loss\n    // const specialField = this.resource.shouldCloseOnFocusOut(this.fieldName);\n    if (this.resource.subject && this.withErrors && this.withErrors!.length === 0) {\n      this.handleUserSubmit();\n    }\n  }\n\n  public setErrors(newErrors:string[]) {\n    this.errors = newErrors;\n    this.element.classList.toggle('-error', this.isErrorenous);\n  }\n\n  /**\n   * Handle a user submitting the field (e.g, ng-change)\n   */\n  public handleUserSubmit():Promise<any> {\n    if (this.inFlight || this.form.editMode) {\n      return Promise.resolve();\n    }\n\n    return this\n      .onSubmit()\n      .then(() => this.form.submit());\n  }\n\n  /**\n   * Handle users pressing enter inside an edit mode.\n   * Outside an edit mode, the regular save event is captured by handleUserSubmit (submit event).\n   * In an edit mode, we can't derive from a submit event wheteher the user pressed enter\n   * (and on what field he did that).\n   */\n  public handleUserKeydown(event:JQuery.TriggeredEvent, onlyCancel:boolean = false) {\n    // Only handle submission in edit mode\n    if (this.inEditMode && !onlyCancel) {\n      if (event.which === keyCodes.ENTER) {\n        this.form.submit();\n        return false;\n      }\n      return true;\n    }\n\n    // Escape editing when not in edit mode\n    if (event.which === keyCodes.ESCAPE) {\n      this.handleUserCancel();\n      return false;\n    }\n\n    // If enter is pressed here, it will continue to handleUserSubmit()\n    // due to the form submission event.\n    return true;\n  }\n\n  /**\n   * Cancel edit\n   */\n  public handleUserCancel() {\n    this.reset();\n  }\n\n  /**\n   * Cancel any pending changes\n   */\n  public reset() {\n    this.form.change.reset(this.fieldName);\n    this.deactivate(true);\n  }\n\n  /**\n   * Close the field, resetting it with its display value.\n   */\n  public deactivate(focus:boolean = false) {\n    delete this.form.activeFields[this.fieldName];\n    this.onDestroy.next();\n    this.onDestroy.complete();\n    this.form.reset(this.fieldName, focus);\n  }\n\n  /**\n   * Returns whether the field has any errors set.\n   */\n  public get isErrorenous():boolean {\n    return this.errors.length > 0;\n  }\n\n  /**\n   * Returns whether the field has been changed\n   */\n  public isChanged():boolean {\n    return this.form.change.contains(this.fieldName);\n  }\n\n  /**\n   * Reference the form's resource\n   */\n  public get resource():HalResource {\n    return this.form.resource;\n  }\n\n  /**\n   * Reference the current set project\n   */\n  public get project() {\n    return this.form.change.projectedResource.project;\n  }\n\n  /**\n   * Return a unique ID for this edit field\n   */\n  public get htmlId() {\n    return `wp-${this.resource.id}-inline-edit--field-${this.fieldName}`;\n  }\n\n  /**\n   * Return the field label\n   */\n  public get fieldLabel() {\n    return this.schema.name || this.fieldName;\n  }\n\n  public get errorMessageOnLabel() {\n    if (!this.isErrorenous) {\n      return '';\n    } else {\n      return this.I18n.t('js.inplace.errors.messages_on_field',\n        {messages: this.errors.join(' ')});\n    }\n  }\n\n  public previewContext(resource:HalResource) {\n    return resource.previewPath();\n  }\n}\n","/**\n * A CDK portal implementation to wrap edit-fields in non-angular contexts.\n */\nimport {ApplicationRef, ComponentFactoryResolver, Injectable, Injector} from \"@angular/core\";\nimport {ComponentPortal, DomPortalOutlet} from \"@angular/cdk/portal\";\nimport {EditFormPortalComponent} from \"core-app/modules/fields/edit/editing-portal/edit-form-portal.component\";\nimport {createLocalInjector} from \"core-app/modules/fields/edit/editing-portal/edit-form-portal.injector\";\nimport {take} from \"rxjs/operators\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {EditForm} from \"core-app/modules/fields/edit/edit-form/edit-form\";\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {HalResourceEditFieldHandler} from \"core-app/modules/fields/edit/field-handler/hal-resource-edit-field-handler\";\n\n@Injectable({ providedIn: 'root' })\nexport class EditingPortalService {\n\n  constructor(private readonly appRef:ApplicationRef,\n              private readonly componentFactoryResolver:ComponentFactoryResolver,\n              private readonly pathHelper:PathHelperService) {\n\n  }\n\n  public create(container:HTMLElement,\n                injector:Injector,\n                form:EditForm,\n                schema:IFieldSchema,\n                fieldName:string,\n                errors:string[]):Promise<EditFieldHandler> {\n\n    // Create the portal outlet\n    const outlet = this.createDomOutlet(container, injector);\n\n    // Create a field handler for the newly active field\n    const fieldHandler = new HalResourceEditFieldHandler(\n      injector,\n      form,\n      fieldName,\n      schema,\n      container,\n      this.pathHelper,\n      errors\n    );\n\n    fieldHandler\n      .onDestroy\n      .pipe(take(1))\n      // Don't call .dispose() on the outlet, it destroys the DOM element\n      .subscribe(() => outlet.detach());\n\n    // Create an injector that contains injectable reference to the edit field and handler\n    const localInjector = createLocalInjector(injector, form.change, fieldHandler, schema);\n\n    // Create a portal for the edit-form/field\n    const portal = new ComponentPortal(EditFormPortalComponent, null, localInjector);\n\n    // Clear the container\n    container.innerHTML = '';\n\n    // Attach the portal to the outlet\n    const ref = outlet.attachComponentPortal(portal);\n\n    // Wait until the content is initialized\n    return ref\n      .instance\n      .onEditFieldReady\n      .pipe(\n        take(1)\n      )\n      .toPromise()\n      .then(() => fieldHandler);\n  }\n\n  /**\n   * Creates a dom outlet for attaching the portal.\n   *\n   * @param {HTMLElement} hostElement The element where the portal will be attached into\n   * @returns {DomPortalOutlet}\n   */\n  private createDomOutlet(hostElement:HTMLElement, injector:Injector) {\n    return new DomPortalOutlet(\n      hostElement,\n      this.componentFactoryResolver,\n      this.appRef,\n      injector\n    );\n  }\n}\n\n\n","import {\n  Component,\n} from '@angular/core';\nimport {WpTableConfigurationService} from 'core-components/wp-table/configuration-modal/wp-table-configuration.service';\nimport {RestrictedWpTableConfigurationService} from 'core-components/wp-table/external-configuration/restricted-wp-table-configuration.service';\nimport {WpTableConfigurationRelationSelectorComponent} from \"core-components/wp-table/configuration-modal/wp-table-configuration-relation-selector\";\nimport {WpTableConfigurationModalPrependToken} from \"core-components/wp-table/configuration-modal/wp-table-configuration.modal\";\nimport {ExternalQueryConfigurationComponent} from \"core-components/wp-table/external-configuration/external-query-configuration.component\";\n\n@Component({\n  templateUrl: './external-query-configuration.template.html',\n  providers: [\n    [\n      { provide: WpTableConfigurationService, useClass: RestrictedWpTableConfigurationService }\n    ],\n    { provide: WpTableConfigurationModalPrependToken, useValue: WpTableConfigurationRelationSelectorComponent }\n  ],\n})\nexport class ExternalRelationQueryConfigurationComponent extends ExternalQueryConfigurationComponent {\n}\n","<ng-container wp-isolated-query-space>\n  <wp-embedded-table #embeddedTableForConfiguration\n    [queryProps]=\"locals.currentQuery || {}\"\n    [configuration]=\"{ tableVisible: false }\">\n  </wp-embedded-table>\n</ng-container>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {AbstractFieldService, IFieldType} from \"core-app/modules/fields/field.service\";\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\n\nexport interface IDisplayFieldType extends IFieldType<DisplayField> {\n  new(resource:HalResource, attributeType:string, schema:IFieldSchema, context:DisplayFieldContext):DisplayField;\n}\n\nexport interface DisplayFieldContext {\n  /** The injector to use for the context of this field. Relevant for embedded service injection */\n  injector:Injector;\n\n  /** Where will the field be rendered? This may result in different styles (Multi select field, e.g.,) */\n  container: 'table'|'single-view'|'timeline';\n\n  /** Options passed to the display field */\n  options:{ [key:string]:any };\n}\n\n@Injectable({ providedIn: 'root' })\nexport class DisplayFieldService extends AbstractFieldService<DisplayField, IDisplayFieldType> {\n\n  /**\n   * Create an instance of the field type T given the required arguments\n   * with either in descending order:\n   *\n   *  1. The registered field name (most specific)\n   *  2. The registered field for the schema attribute type\n   *  3. The default field type\n   *\n   * @param resource\n   * @param {string} fieldName\n   * @param {IFieldSchema} schema\n   * @param {string} context\n   * @returns {T}\n   */\n  public getField(resource:HalResource, fieldName:string, schema:IFieldSchema, context:DisplayFieldContext):DisplayField {\n    const fieldClass = this.getSpecificClassFor(resource._type, fieldName, schema.type);\n    let instance = new fieldClass(fieldName, context);\n    instance.apply(resource, schema);\n    return instance;\n  }\n}\n","import {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {Constructor} from \"@angular/cdk/table\";\n\nexport class SimpleResourceCollection<T = SimpleResource> {\n  // Base path\n  public readonly path:string;\n\n  constructor(protected basePath:string, readonly segment:string, protected resource?:Constructor<T>) {\n    this.path = `${this.basePath}/${segment}`;\n  }\n\n  public id(id:string|number):T {\n    return new (this.resource || SimpleResource)(this.path, id) as T;\n  }\n\n  public optionalId(id?:string|number):this|T {\n    if (_.isNil(id)) {\n      return this;\n    } else {\n      return this.id(id);\n    }\n  }\n\n  public toString():string {\n    return this.path;\n  }\n\n  public toPath():string {\n    return this.path;\n  }\n\n  public filtered(filters:ApiV3FilterBuilder) {\n    return this.toString() + '/?' + filters.toParams();\n  }\n}\n\nexport class SimpleResource {\n  public readonly path:string;\n\n  constructor(protected basePath:string, readonly id:string|number) {\n    this.path = `${this.basePath}/${id}`;\n  }\n\n  public toString() {\n    return this.path;\n  }\n\n  public toPath():string {\n    return this.path;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {States} from 'core-components/states.service';\nimport {Injectable} from '@angular/core';\nimport {cloneHalResourceCollection} from 'core-app/modules/hal/helpers/hal-resource-builder';\nimport {QueryColumn, queryColumnTypes} from \"core-components/wp-query/query-column\";\n\n@Injectable()\nexport class WorkPackageViewColumnsService extends WorkPackageQueryStateService<QueryColumn[]> {\n\n  public constructor(readonly states:States, readonly querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  public valueFromQuery(query:QueryResource):QueryColumn[] {\n    return [...query.columns];\n  }\n\n  public hasChanged(query:QueryResource) {\n    return !this.isCurrentlyEqualTo(query.columns);\n  }\n\n  public isCurrentlyEqualTo(a:QueryColumn[]) {\n    const comparer = (columns:QueryColumn[]) => columns.map(c => c.href);\n\n    return _.isEqual(\n      comparer(a),\n      comparer(this.getColumns())\n    );\n  }\n\n  public applyToQuery(query:QueryResource) {\n    const toApply = this.getColumns();\n\n    const oldColumns = query.columns.map(el => el.id);\n    const newColumns = toApply.map(el => el.id);\n    query.columns = cloneHalResourceCollection<QueryColumn>(toApply);\n\n    // We can avoid reloading even with relation columns if we only removed columns\n    const onlyRemoved = _.difference(newColumns, oldColumns).length === 0;\n\n    // Reload the table visibly if adding relation columns.\n    return !onlyRemoved && this.hasRelationColumns();\n  }\n\n  /**\n   * Returns whether the current set of columns include relations\n   */\n  public hasRelationColumns() {\n    const relationColumns = [queryColumnTypes.RELATION_OF_TYPE, queryColumnTypes.RELATION_TO_TYPE];\n    return !!_.find(this.getColumns(), (c) => relationColumns.indexOf(c._type) >= 0);\n  }\n\n  /**\n   * Retrieve the QueryColumn objects for the selected columns.\n   * Returns a shallow copy with the original column objects.\n   */\n  public getColumns():QueryColumn[] {\n    return [ ...this.current ];\n  }\n\n  /**\n   * Return the index of the given column or -1 if it is not contained.\n   */\n  public index(id:string):number {\n    return _.findIndex(this.getColumns(), column => column.id === id);\n  }\n\n  /**\n   * Return the column object for the given id.\n   * @param id\n   */\n  public findById(id:string):QueryColumn|undefined {\n    return _.find(this.getColumns(), column => column.id === id);\n  }\n\n  /**\n   * Return the previous column of the given column name\n   * @param column\n   */\n  public previous(column:QueryColumn):QueryColumn|null {\n    let index = this.index(column.id);\n\n    if (index <= 0) {\n      return null;\n    }\n\n    return this.getColumns()[index - 1];\n  }\n\n  /**\n   * Return the next column of the given column name\n   * @param column\n   */\n  public next(column:QueryColumn):QueryColumn|null {\n    let index = this.index(column.id);\n\n    if (index === -1 || this.isLast(name)) {\n      return null;\n    }\n\n    return this.getColumns()[index + 1];\n  }\n\n  /**\n   * Returns true if the column is the first selected\n   */\n  public isFirst(column:QueryColumn):boolean {\n    return this.index(column.id) === 0;\n  }\n\n  /**\n   * Returns true if the column is the last selected\n   */\n  public isLast(column:QueryColumn):boolean {\n    return this.index(column.id) === this.columnCount - 1;\n  }\n\n  /**\n   * Update the selected columns to a new set of columns.\n   */\n  public setColumns(columns:QueryColumn[]) {\n    // Don't publish if this is the same content\n    if (this.isCurrentlyEqualTo(columns)) {\n      return;\n    }\n\n    this.update(columns);\n  }\n\n  public setColumnsById(columnIds:string[]) {\n    const mapped = columnIds.map(id => _.find(this.all, c => c.id === id));\n    this.setColumns(_.compact(mapped));\n  }\n\n  /**\n   * Move the column at index {fromIndex} to {toIndex}.\n   * - If toIndex is larger than all columns, insert at the end.\n   * - If toIndex is less than zero, insert at the start.\n   */\n  public moveColumn(fromIndex:number, toIndex:number) {\n    let columns = this.getColumns();\n\n    if (toIndex >= columns.length) {\n      toIndex = columns.length - 1;\n    }\n\n    if (toIndex < 0) {\n      toIndex = 0;\n    }\n\n    let element = columns[fromIndex];\n    columns.splice(fromIndex, 1);\n    columns.splice(toIndex, 0, element);\n\n    this.setColumns(columns);\n  }\n\n  /**\n   * Shift the given column name X indices,\n   * where X is the offset in indices (-1 = shift one to left)\n   */\n  public shift(column:QueryColumn, offset:number) {\n    let index = this.index(column.id);\n    if (index === -1) {\n      return;\n    }\n\n    this.moveColumn(index, index + offset);\n  }\n\n  /**\n   * Add a new column to the selection at the given position\n   */\n  public addColumn(id:string, position?:number) {\n    let columns = this.getColumns();\n\n    if (position === undefined) {\n      position = columns.length;\n    }\n\n    if (this.index(id) === -1) {\n      let newColumn =  _.find(this.all, (column) => column.id === id);\n\n      if (!newColumn) {\n        throw \"Column with provided name is not found\";\n      }\n\n      columns.splice(position, 0, newColumn);\n      this.setColumns(columns);\n    }\n  }\n\n  /**\n   * Remove a column from the active list\n   */\n  public removeColumn(column:QueryColumn) {\n    let index = this.index(column.id);\n\n    if (index !== -1) {\n      let columns = this.getColumns();\n      columns.splice(index, 1);\n      this.setColumns(columns);\n    }\n  }\n\n  // only exists to cast the state\n  protected get current() {\n    return this.lastUpdatedState.getValueOr([]);\n  }\n\n  // Get the available state\n  protected get availableState() {\n    return this.states.queries.columns;\n  }\n\n  /**\n   * Return the number of selected rows.\n   */\n  public get columnCount():number {\n    return this.getColumns().length;\n  }\n\n  /**\n   * Get all available columns (regardless of whether they are selected already)\n   */\n  public get all():QueryColumn[] {\n    return this.availableState.getValueOr([]);\n  }\n\n  public get allPropertyColumns():QueryColumn[] {\n    return this\n      .all\n      .filter((column:QueryColumn) => column._type === queryColumnTypes.PROPERTY);\n  }\n\n  /**\n   * Get columns not yet selected\n   */\n  public get unused():QueryColumn[] {\n    return _.differenceBy(this.all, this.getColumns(), '$href');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {SimpleResource} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class ApiV3WorkPackagePaths extends SimpleResource {\n  constructor(basePath:string, readonly workPackageId:string|number) {\n    super(basePath, workPackageId);\n  }\n\n  // /api/v3/(?:projectPath)/work_packages/(:workPackageId)/relations\n  public readonly relations = this.path + '/relations';\n\n  // /api/v3/(?:projectPath)/work_packages/(:workPackageId)/revisions\n  public readonly revisions = this.path + '/revisions';\n\n  // /api/v3/(?:projectPath)/work_packages/(:workPackageId)/activities\n  public readonly activities = this.path + '/activities';\n\n  // /api/v3/(?:projectPath)/work_packages/(:workPackageId)/available_watchers\n  public readonly available_watchers = this.path + '/available_watchers';\n\n  // /api/v3/(?:projectPath)/work_packages/(:workPackageId)/available_projects\n  public readonly available_projects = this.path + '/available_projects';\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ApiV3WorkPackagePaths} from 'core-app/modules/common/path-helper/apiv3/work_packages/apiv3-work-package-paths';\nimport {\n  SimpleResource,\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class ApiV3WorkPackagesPaths extends SimpleResourceCollection<ApiV3WorkPackagePaths> {\n  // Base path\n  public readonly path:string;\n\n  constructor(basePath:string) {\n    super(basePath, 'work_packages');\n  }\n\n  // Static paths\n\n  // /api/v3/(projects/:projectIdentifier)/work_packages/form\n  public readonly form = new SimpleResource(this.path, 'form');\n\n  // /api/v3/(projects/:projectIdentifier)/work_packages/:workPackageId\n  public id(workPackageId:string|number):ApiV3WorkPackagePaths {\n    return new ApiV3WorkPackagePaths(this.path, workPackageId);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {SimpleResource} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class ApiV3UserPaths extends SimpleResource {\n  constructor(basePath:string, readonly userId:string|number) {\n    super(basePath, userId);\n  }\n\n  // /api/v3/users/(:userId)/avatar\n  public readonly avatar = this.path + '/avatar';\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {ApiV3UserPaths} from \"core-app/modules/common/path-helper/apiv3/users/apiv3-user-paths\";\n\nexport class Apiv3UsersPaths extends SimpleResourceCollection {\n  constructor(basePath:string) {\n    super(basePath, 'users');\n  }\n\n  // Static paths\n\n  // /api/v3/users/me\n  public readonly me = this.path + '/me';\n\n  // /api/v3/users/:userId\n  public id(userId:string|number) {\n    return new ApiV3UserPaths(this.path, userId);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {SimpleResource} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3QueryPaths extends SimpleResource {\n  constructor(basePath:string, queryId:string|number) {\n    super(basePath, queryId);\n  }\n\n  // Static paths\n  readonly form = new SimpleResource(this.path, 'form');\n\n  // Order path\n  readonly order = new SimpleResource(this.path, 'order');\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource,\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3QueryPaths} from 'core-app/modules/common/path-helper/apiv3/queries/apiv3-query-paths';\n\nexport class Apiv3QueriesPaths extends SimpleResourceCollection<Apiv3QueryPaths> {\n  constructor(basePath:string) {\n    super(basePath, 'queries');\n  }\n\n  // Static paths\n  readonly form = new SimpleResource(this.path, 'form');\n\n  readonly default = new SimpleResource(this.path, 'default');\n\n  // /api/v3/users/:userId\n  public id(userId:string|number):Apiv3QueryPaths {\n    return new Apiv3QueryPaths(this.path, userId);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3QueryPaths} from 'core-app/modules/common/path-helper/apiv3/queries/apiv3-query-paths';\n\nexport class Apiv3TypesPaths extends SimpleResourceCollection<Apiv3QueryPaths> {\n  constructor(basePath:string) {\n    super(basePath, 'types');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource,\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3VersionPaths extends SimpleResourceCollection {\n  // Base path\n  public readonly path:string;\n  // /api/v3/versions/form\n  public readonly form = new SimpleResource(this.path, 'form');\n\n  public readonly availableProjects = new SimpleResource(this.path, 'available_projects');\n\n  constructor(basePath:string) {\n    super(basePath, 'versions');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {SimpleResource} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3QueriesPaths} from 'core-app/modules/common/path-helper/apiv3/queries/apiv3-queries-paths';\nimport {Apiv3TypesPaths} from \"core-app/modules/common/path-helper/apiv3/types/apiv3-types-paths\";\nimport {ApiV3WorkPackagesPaths} from \"core-app/modules/common/path-helper/apiv3/work_packages/apiv3-work-packages-paths\";\nimport {Apiv3VersionPaths} from \"core-app/modules/common/path-helper/apiv3/versions/apiv3-version-paths\";\n\nexport class Apiv3ProjectPaths extends SimpleResource {\n  // Base path\n  public readonly path:string;\n\n  constructor(projectPath:string, readonly projectId:string|number) {\n    super(projectPath, projectId);\n  }\n\n  // /api/v3/projects/:project_id/available_assignees\n  public readonly available_assignees = this.path + '/available_assignees';\n\n  public readonly queries = new Apiv3QueriesPaths(this.path);\n\n  public readonly types = new Apiv3TypesPaths(this.path);\n\n  public readonly work_packages = new ApiV3WorkPackagesPaths(this.path);\n\n  public readonly versions = new Apiv3VersionPaths(this.path);\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {SimpleResourceCollection} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3ProjectPaths} from 'core-app/modules/common/path-helper/apiv3/projects/apiv3-project-paths';\n\nexport class Apiv3ProjectsPaths extends SimpleResourceCollection<Apiv3ProjectPaths> {\n  constructor(basePath:string) {\n    super(basePath, 'projects');\n  }\n\n  // /api/v3/projects/:projectIdentifier\n  public id(projectIdentifier:string|number):Apiv3ProjectPaths {\n    return new Apiv3ProjectPaths(this.path, projectIdentifier);\n  }\n\n  // /api/v3/projects/schema\n  public readonly schema = this.path + '/schema';\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3GridPaths extends SimpleResource {\n  constructor(basePath:string, gridId:string|number) {\n    super(basePath, gridId);\n  }\n\n  // Static paths\n  readonly form = new SimpleResource(this.path, 'form');\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource,\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3GridPaths} from \"core-app/modules/common/path-helper/apiv3/grids/apiv3-grid-paths\";\n\nexport class Apiv3GridsPaths extends SimpleResourceCollection {\n  constructor(basePath:string) {\n    super(basePath, 'grids');\n  }\n\n  public id(gridId:string|number) {\n    return new Apiv3GridPaths(this.path, gridId);\n  }\n\n  public form() {\n    return new SimpleResource(this.path, 'form');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3NewsPaths extends SimpleResource {\n  constructor(basePath:string, newsId:string|number) {\n    super(basePath, newsId);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3NewsPaths} from \"core-app/modules/common/path-helper/apiv3/news/apiv3-news-paths\";\n\nexport class Apiv3NewsesPaths extends SimpleResourceCollection {\n  constructor(basePath:string) {\n    super(basePath, 'news');\n  }\n\n  public id(gridId:string|number) {\n    return new Apiv3NewsPaths(this.path, gridId);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3TimeEntryPaths extends SimpleResource {\n  constructor(basePath:string, newsId:string|number) {\n    super(basePath, newsId);\n  }\n\n  // Static paths\n  readonly form = new SimpleResource(this.path, 'form');\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResource,\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3TimeEntryPaths} from \"core-app/modules/common/path-helper/apiv3/time-entries/apiv3-time-entry-paths\";\n\nexport class Apiv3TimeEntriesPaths extends SimpleResourceCollection {\n  constructor(basePath:string) {\n    super(basePath, 'time_entries');\n  }\n\n  public id(timeEntryId:string|number) {\n    return new Apiv3TimeEntryPaths(this.path, timeEntryId);\n  }\n\n  public readonly form = new SimpleResource(this.path, 'form');\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {SimpleResourceCollection} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3MembershipsPaths extends SimpleResourceCollection {\n  constructor(basePath:string) {\n    super(basePath, 'memberships');\n  }\n\n  // /api/v3/memberships/available_projects\n  public readonly available_projects = this.path + '/available_projects';\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\n\nexport class Apiv3GroupsPaths extends SimpleResourceCollection {\n  constructor(basePath:string) {\n    super(basePath, 'groups');\n  }\n\n  public toString():string {\n    throw 'Backend does not yet offer this end point';\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ApiV3WorkPackagesPaths} from 'core-app/modules/common/path-helper/apiv3/work_packages/apiv3-work-packages-paths';\nimport {Apiv3UsersPaths} from 'core-app/modules/common/path-helper/apiv3/users/apiv3-users-paths';\nimport {Apiv3ProjectsPaths} from 'core-app/modules/common/path-helper/apiv3/projects/apiv3-projects-paths';\nimport {\n  SimpleResource,\n  SimpleResourceCollection\n} from 'core-app/modules/common/path-helper/apiv3/path-resources';\nimport {Apiv3QueriesPaths} from 'core-app/modules/common/path-helper/apiv3/queries/apiv3-queries-paths';\nimport {Apiv3ProjectPaths} from 'core-app/modules/common/path-helper/apiv3/projects/apiv3-project-paths';\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {Apiv3TypesPaths} from \"core-app/modules/common/path-helper/apiv3/types/apiv3-types-paths\";\nimport {Apiv3GridsPaths} from \"core-app/modules/common/path-helper/apiv3/grids/apiv3-grids-paths\";\nimport {Apiv3NewsesPaths} from \"core-app/modules/common/path-helper/apiv3/news/apiv3-newses-paths\";\nimport {Apiv3TimeEntriesPaths} from \"core-app/modules/common/path-helper/apiv3/time-entries/apiv3-time-entries-paths\";\nimport {Apiv3VersionPaths} from \"core-app/modules/common/path-helper/apiv3/versions/apiv3-version-paths\";\nimport {Apiv3MembershipsPaths} from \"core-app/modules/common/path-helper/apiv3/memberships/apiv3-memberships-paths\";\nimport {Apiv3GroupsPaths} from \"core-app/modules/common/path-helper/apiv3/groups/apiv3-groups-path\";\n\nexport class ApiV3Paths {\n  // Base path\n  public readonly apiV3Base  = this.appBasePath + '/api/v3';\n\n  // /api/v3/attachments\n  public readonly attachments = new SimpleResource(this.apiV3Base, 'attachments');\n\n  // /api/v3/configuration\n  public readonly configuration = new SimpleResource(this.apiV3Base, 'configuration');\n\n  // /api/v3/root\n  public readonly root = new SimpleResource(this.apiV3Base, '');\n\n  // /api/v3/statuses\n  public readonly statuses = new SimpleResourceCollection(this.apiV3Base, 'statuses');\n\n  // /api/v3/relations\n  public readonly relations = new SimpleResourceCollection(this.apiV3Base, 'relations');\n\n  // /api/v3/priorities\n  public readonly priorities = new SimpleResourceCollection(this.apiV3Base, 'priorities');\n\n  // /api/v3/time_entries\n  public readonly time_entries = new Apiv3TimeEntriesPaths(this.apiV3Base);\n\n  // /api/v3/memberships\n  public readonly memberships = new Apiv3MembershipsPaths(this.apiV3Base);\n\n  // /api/v3/news\n  public readonly news = new Apiv3NewsesPaths(this.apiV3Base);\n\n  // /api/v3/types\n  public readonly types = new Apiv3TypesPaths(this.apiV3Base);\n\n  // /api/v3/versions\n  public readonly versions = new Apiv3VersionPaths(this.apiV3Base);\n\n  // /api/v3/work_packages\n  public readonly work_packages = new ApiV3WorkPackagesPaths(this.apiV3Base);\n\n  // /api/v3/queries\n  public readonly queries = new Apiv3QueriesPaths(this.apiV3Base);\n\n  // /api/v3/projects\n  public readonly projects = new Apiv3ProjectsPaths(this.apiV3Base);\n\n  // /api/v3/users\n  public readonly users = new Apiv3UsersPaths(this.apiV3Base);\n\n  // /api/v3/help_texts\n  public readonly help_texts = new SimpleResourceCollection(this.apiV3Base, 'help_texts');\n\n  // /api/v3/grids\n  public readonly grids = new Apiv3GridsPaths(this.apiV3Base);\n\n  // /api/v3/groups\n  public readonly groups = new Apiv3GroupsPaths(this.apiV3Base);\n\n\n  constructor(readonly appBasePath:string) {\n  }\n\n  /**\n   * Returns possible subpaths either in this api root or below /projects/:id/\n   *\n   * @param {string | number} projectIdentifier\n   * @returns {Apiv3ProjectPaths | this}\n   */\n  public withOptionalProject(projectIdentifier:string|number|null|undefined):Apiv3ProjectPaths|this {\n    if (_.isNil(projectIdentifier)) {\n      return this;\n    } else {\n      return this.projects.id(projectIdentifier);\n    }\n  }\n\n  /**\n   * returns a resource segment from (/base)/api/v3/(resource)\n   * @param segment\n   */\n  public resource(segment:string) {\n    if (!segment.startsWith('/')) {\n      segment = '/' + segment;\n    }\n\n    return this.apiV3Base + segment;\n  }\n\n  public previewMarkup(context:string) {\n    let base = this.apiV3Base + '/render/markdown';\n\n    if (context) {\n      return base + `?context=${context}`;\n    } else {\n      return base;\n    }\n  }\n\n  public principals(projectId:string|number, term:string|null) {\n    let filters:ApiV3FilterBuilder = new ApiV3FilterBuilder();\n    // Only real and activated users:\n    filters.add('status', '!', ['3']);\n    // that are members of that project:\n    filters.add('member', '=', [projectId.toString()]);\n    // That are users:\n    filters.add('type', '=', ['User', 'Group']);\n    // That are not the current user:\n    filters.add('id', '!', ['me']);\n\n    if (term && term.length > 0) {\n      // Containing the that substring:\n      filters.add('name', '~', [term]);\n    }\n\n    return this.apiV3Base +\n      '/principals?' +\n      filters.toParams({ sortBy: '[[\"name\",\"asc\"]]', offset: '1', pageSize: '10' });\n  }\n\n  public wpBySubjectOrId(term:string, idOnly:boolean = false) {\n    let filters:ApiV3FilterBuilder = new ApiV3FilterBuilder();\n\n    if (idOnly) {\n      filters.add('id', '=', [term]);\n    } else {\n      filters.add('subjectOrId', '**', [term]);\n    }\n\n    return this.apiV3Base +\n      '/work_packages?' +\n      filters.toParams({ sortBy: '[[\"updatedAt\",\"desc\"]]', offset: '1', pageSize: '10' });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ApiV3Paths} from 'core-app/modules/common/path-helper/apiv3/apiv3-paths';\nimport {Injectable} from '@angular/core';\n\n@Injectable({ providedIn: 'root' })\nexport class PathHelperService {\n  public readonly appBasePath:string;\n  public readonly api:{ v3:ApiV3Paths };\n\n  constructor() {\n    this.appBasePath = window.appBasePath ? window.appBasePath : '';\n    this.api = {\n      v3: new ApiV3Paths(this.appBasePath)\n    };\n  }\n\n  public get staticBase() {\n    return this.appBasePath;\n  }\n\n  public attachmentDownloadPath(attachmentIdentifier:string, slug:string|undefined) {\n    let path = this.staticBase + '/attachments/' + attachmentIdentifier;\n\n    if (slug) {\n      return path + \"/\" + slug;\n    } else {\n      return path;\n    }\n  }\n\n  public ifcModelsPath(projectIdentifier:string) {\n    return this.staticBase + `/projects/${projectIdentifier}/ifc_models`;\n  }\n\n  public bimDetailsPath(projectIdentifier:string, workPackageId:string, viewpoint:number|string|null = null) {\n    let path = this.projectPath(projectIdentifier) + `/bcf/split/details/${workPackageId}`;\n\n    if (viewpoint !== null) {\n      path += `?viewpoint=${viewpoint}`;\n    }\n\n    return path;\n  }\n\n  public highlightingCssPath() {\n    return this.staticBase + '/highlighting/styles';\n  }\n\n  public forumPath(projectIdentifier:string, forumIdentifier:string) {\n    return this.projectForumPath(projectIdentifier) + '/' + forumIdentifier;\n  }\n\n  public keyboardShortcutsHelpPath() {\n    return this.staticBase + '/help/keyboard_shortcuts';\n  }\n\n  public messagePath(messageIdentifier:string) {\n    return this.staticBase + '/topics/' + messageIdentifier;\n  }\n\n  public myPagePath() {\n    return this.staticBase + '/my/page';\n  }\n\n  public newsPath(newsId:string) {\n    return this.staticBase + '/news/' + newsId;\n  }\n\n  public loginPath() {\n    return this.staticBase + '/login';\n  }\n\n  public projectsPath() {\n    return this.staticBase + '/projects';\n  }\n\n  public projectPath(projectIdentifier:string) {\n    return this.projectsPath() + '/' + projectIdentifier;\n  }\n\n  public projectActivityPath(projectIdentifier:string) {\n    return this.projectPath(projectIdentifier) + '/activity';\n  }\n\n  public projectForumPath(projectIdentifier:string) {\n    return this.projectPath(projectIdentifier) + '/forums';\n  }\n\n  public projectCalendarPath(projectId:string) {\n    return this.projectPath(projectId) + '/work_packages/calendar';\n  }\n\n  public projectMembershipsPath(projectId:string) {\n    return this.projectPath(projectId) + '/members';\n  }\n\n  public projectNewsPath(projectId:string) {\n    return this.projectPath(projectId) + '/news';\n  }\n\n  public projectTimelinesPath(projectId:string) {\n    return this.projectPath(projectId) + '/timelines';\n  }\n\n  public projectTimeEntriesPath(projectIdentifier:string) {\n    return this.projectPath(projectIdentifier) + '/time_entries';\n  }\n\n  public projectWikiPath(projectId:string) {\n    return this.projectPath(projectId) + '/wiki';\n  }\n\n  public projectWorkPackagePath(projectId:string, wpId:string|number) {\n    return this.projectWorkPackagesPath(projectId) + '/' + wpId;\n  }\n\n  public projectWorkPackagesPath(projectId:string) {\n    return this.projectPath(projectId) + '/work_packages';\n  }\n\n  public projectWorkPackageNewPath(projectId:string) {\n    return this.projectWorkPackagesPath(projectId) + '/new';\n  }\n\n  public projectBoardsPath(projectIdentifier:string|null) {\n    if (projectIdentifier) {\n      return this.projectPath(projectIdentifier) + '/boards';\n    } else {\n      return this.staticBase + '/boards';\n    }\n  }\n\n  public projectDashboardsPath(projectIdentifier:string) {\n    return this.projectPath(projectIdentifier) + '/dashboards';\n  }\n\n  public timeEntriesPath(workPackageId:string|number) {\n    var suffix = '/time_entries';\n\n    if (workPackageId) {\n      return this.workPackagePath(workPackageId) + suffix;\n    } else {\n      return this.staticBase + suffix; // time entries root path\n    }\n  }\n\n  public usersPath() {\n    return this.staticBase + '/users';\n  }\n\n  public userPath(id:string|number) {\n    return this.usersPath() + '/' + id;\n  }\n\n  public versionsPath() {\n    return this.staticBase + '/versions';\n  }\n\n  public versionEditPath(id:string|number) {\n    return this.staticBase + '/versions/' + id + '/edit';\n  }\n\n  public versionShowPath(id:string|number) {\n    return this.staticBase + '/versions/' + id;\n  }\n\n  public workPackagesPath() {\n    return this.staticBase + '/work_packages';\n  }\n\n  public workPackagePath(id:string|number) {\n    return this.staticBase + '/work_packages/' + id;\n  }\n\n  public workPackageCopyPath(workPackageId:string|number) {\n    return this.workPackagePath(workPackageId) + '/copy';\n  }\n\n  public workPackageDetailsCopyPath(projectIdentifier:string, workPackageId:string|number) {\n    return this.projectWorkPackagesPath(projectIdentifier) + '/details/' + workPackageId + '/copy';\n  }\n\n  public workPackagesBulkDeletePath() {\n    return this.workPackagesPath() + '/bulk';\n  }\n\n  public projectLevelListPath() {\n    return this.projectsPath() + '/level_list.json';\n  }\n\n  public textFormattingHelp() {\n    return this.staticBase + '/help/text_formatting';\n  }\n\n}\n","import {BehaviorSubject} from \"rxjs\";\nimport {filter, take} from \"rxjs/operators\";\nimport {Injectable} from \"@angular/core\";\n\n@Injectable({ providedIn: 'root' })\nexport class MainMenuNavigationService {\n\n  public navigationEvents$ = new BehaviorSubject<string>('');\n\n  public onActivate(...names:string[]) {\n    return this\n      .navigationEvents$\n      .pipe(\n        filter(evt => names.indexOf(evt) !== -1),\n        take(1)\n      );\n  }\n\n  private recreateToggler() {\n    let that = this;\n    // rejigger the main-menu sub-menu functionality.\n    jQuery(\"#main-menu .toggler\").remove(); // remove the togglers so they're inserted properly later.\n\n    var toggler = jQuery('<a class=\"toggler\" href=\"#\"><i class=\"icon6 icon-toggler icon-arrow-right3\" aria-hidden=\"true\"></i><span class=\"hidden-for-sighted\"></span></a>')\n      .on('click', function() {\n        let target = jQuery(this);\n        if (target.hasClass('toggler')) {\n\n          // TODO: Instead of hiding the sidebar move sidebar's contents to submenus and cache it.\n          jQuery('#sidebar').toggleClass('-hidden', true);\n\n          jQuery(\".menu_root li\").removeClass('open')\n          jQuery(\".menu_root\").removeClass('open').addClass('closed');\n\n          let targetLi = target.closest('li')\n          targetLi\n            .addClass('open')\n            .find('li > a:first, .tree-menu--title:first').first().focus();\n\n          console.log(\"Activating \" + targetLi.data('name'));\n          that.navigationEvents$.next(targetLi.data('name'));\n        }\n        return false;\n      });\n    toggler.attr('title', I18n.t('js.project_menu_details'));\n\n    return toggler;\n  }\n\n  private wrapMainItem() {\n    var mainItems = jQuery('#main-menu li > a').not('ul ul a');\n\n    mainItems.wrap((index:number) => {\n      var item = mainItems[index];\n      var elementId = item.id;\n\n      var wrapperElement = jQuery('<div class=\"main-item-wrapper\"/>')\n\n      // inherit element id\n      if (elementId) {\n        wrapperElement.attr('id', elementId + '-wrapper')\n      }\n\n      return wrapperElement;\n    });\n  }\n\n  register() {\n\n    // Wrap main item\n    this.wrapMainItem();\n\n    // Scroll to the active item\n    const selected = jQuery('.main-item-wrapper a.selected');\n    if (selected.length > 0) {\n      selected[0].scrollIntoView();\n    }\n\n\n    // Recreate toggler\n    const toggler = this.recreateToggler();\n\n    // Emit first active\n    let active = jQuery('#main-menu .menu_root > li.open').data('name');\n    let activeRoot = jQuery('#main-menu .menu_root.open > li').data('name');\n    if (active || activeRoot) {\n      this.navigationEvents$.next(active || activeRoot);\n    }\n\n    jQuery('#main-menu li:has(ul) .main-item-wrapper > a').not('ul ul a')\n    // 1. unbind the current click functions\n      .unbind('click')\n      // 2. wrap each in a span that we'll use for the new click element\n      .wrapInner('<span class=\"ellipsis\"/>')\n      // 3. reinsert the <span class=\"toggler\"> so that it sits outside of the above\n      .after(toggler);\n\n    function navigateUp(this:any, event:any) {\n      event.preventDefault();\n      var target = jQuery(this);\n      jQuery(target).parents('li').first().removeClass('open');\n      jQuery(\".menu_root\").removeClass('closed').addClass('open');\n\n      target.parents('li').first().find('.toggler').first().focus();\n\n      // TODO: Instead of hiding the sidebar move sidebar's contents to submenus and cache it.\n      jQuery('#sidebar').toggleClass('-hidden', false);\n    }\n\n    jQuery('#main-menu ul.main-menu--children').each(function(_i, child) {\n      var title = jQuery(child).parents('li').find('.main-item-wrapper .menu-item--title').contents()[0].textContent;\n      var parentURL = jQuery(child).parents('li').find('.main-item-wrapper > a').attr('href');\n      var header = jQuery('<div class=\"main-menu--children-menu-header\"></div>');\n      var upLink = jQuery('<a class=\"main-menu--arrow-left-to-project\" href=\"#\"><i class=\"icon-arrow-left1\" aria-hidden=\"true\"></i></a>');\n      var parentLink = jQuery('<a href=\"' + parentURL + '\" class=\"main-menu--parent-node ellipsis\">' + title + '</a>');\n      upLink.attr('title', I18n.t('js.label_up'));\n      upLink.on('click', navigateUp);\n      header.append(upLink);\n      header.append(parentLink);\n      jQuery(child).before(header);\n    });\n\n    if (jQuery('.menu_root').hasClass('closed')) {\n      // TODO: Instead of hiding the sidebar move sidebar's contents to submenus and cache it.\n      jQuery('#sidebar').toggleClass('-hidden', true);\n    }\n  }\n\n}\n","import {Injectable} from '@angular/core';\n\n@Injectable({ providedIn: 'root' })\nexport class DeviceService {\n\n  public mobileWidthTreshold:number = 680;\n\n  public get isMobile():boolean {\n    return (window.innerWidth < this.mobileWidthTreshold);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {ChangeDetectorRef, Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {concatAll} from \"rxjs/operators\";\nimport {combineLatest} from \"rxjs\";\n\n@Component({\n  selector: 'wp-status-button',\n  styleUrls: ['./wp-status-button.component.sass'],\n  templateUrl: './wp-status-button.html'\n})\nexport class WorkPackageStatusButtonComponent extends UntilDestroyedMixin implements OnInit {\n  @Input('workPackage') public workPackage:WorkPackageResource;\n  @Input('containerClass') public containerClass:string;\n\n  public text = {\n    explanation: this.I18n.t('js.label_edit_status'),\n    workPackageReadOnly: this.I18n.t('js.work_packages.message_work_package_read_only'),\n    workPackageStatusBlocked: this.I18n.t('js.work_packages.message_work_package_status_blocked')\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly wpCacheService:WorkPackageCacheService,\n              readonly halEditing:HalResourceEditingService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.halEditing\n      .temporaryEditResource(this.workPackage)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp) => {\n        this.workPackage = wp;\n\n        if (this.workPackage.status) {\n          this.workPackage.status.$load();\n        }\n\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public get buttonTitle() {\n    if (this.workPackage.isReadonly) {\n      return this.text.workPackageReadOnly;\n    } else if (this.workPackage.isEditable && !this.allowed) {\n      return this.text.workPackageStatusBlocked;\n    } else {\n      return '';\n    }\n  }\n\n  public get statusHighlightClass() {\n    let status = this.status;\n    if (!status) {\n      return;\n    }\n    return Highlighting.backgroundClass('status', status.id!);\n  }\n\n  public get status():HalResource {\n    return this.workPackage.status;\n  }\n\n  public get allowed() {\n    return this.workPackage.isAttributeEditable('status');\n  }\n}\n","<div class=\"wp-status-button\"\n     [ngClass]=\"containerClass\"\n     [attr.title]=\"buttonTitle\"\n     *ngIf=\"status\">\n  <button class=\"button\"\n          [ngClass]=\"statusHighlightClass\"\n          [disabled]=\"!allowed\"\n          [attr.aria-label]=\"text.explanation\"\n          wpStatusDropdown\n          [wpStatusDropdown-workPackage]=\"workPackage\">\n\n    <span *ngIf=\"workPackage.isReadonly\"\n          class=\"button--text\">\n      <op-icon icon-classes=\"button--icon icon-locked\"></op-icon>\n    </span>\n    <span class=\"button--text\"\n          aria-hidden=\"true\"\n          [textContent]=\"status.name\"></span>\n    <op-icon icon-classes=\"button--icon icon-small icon-pulldown\"></op-icon>\n  </button>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {Injectable} from \"@angular/core\";\nimport {input} from \"reactivestates\";\nimport {Observable} from \"rxjs\";\nimport {takeUntil} from \"rxjs/operators\";\n\nexport type ModelLinks = {[action:string]:any};\nexport type ModelLinksHash = { [model:string]:ModelLinks };\n\n@Injectable({ providedIn: 'root' })\nexport class AuthorisationService {\n  private links = input<ModelLinksHash>({});\n\n  public initModelAuth(modelName:string, modelLinks:ModelLinks) {\n    this.links.doModify((value:ModelLinksHash) => {\n      let links = { ...value };\n      links[modelName] = modelLinks;\n      return links;\n    });\n  }\n\n  public observeUntil(unsubscribe:Observable<any>) {\n    return this.links.values$().pipe(takeUntil(unsubscribe));\n  }\n\n  public can(modelName:string, action:string) {\n    const links:ModelLinksHash = this.links.getValueOr({});\n    return links[modelName] && (action in links[modelName]);\n  }\n\n  public cannot(modelName:string, action:string) {\n    return !this.can(modelName, action);\n  }\n}\n","import {Injector} from '@angular/core';\nimport {WorkPackageTable} from '../../../wp-fast-table';\nimport {PrimaryRenderPass} from '../../primary-render-pass';\nimport {SingleRowBuilder} from '../../rows/single-row-builder';\n\nexport class PlainRenderPass extends PrimaryRenderPass {\n\n  constructor(public readonly injector:Injector,\n              public workPackageTable:WorkPackageTable,\n              public rowBuilder:SingleRowBuilder) {\n\n    super(injector, workPackageTable, rowBuilder);\n  }\n\n  /**\n   * The actual render function of this renderer.\n   */\n  protected doRender():void {\n    this.workPackageTable.originalRows.forEach((wpId:string) => {\n      let row = this.workPackageTable.originalRowIndex[wpId];\n      let [tr,] = this.rowBuilder.buildEmpty(row.object);\n      row.element = tr;\n      this.appendRow(row.object, tr);\n      this.tableBody.appendChild(tr);\n    });\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {AttachmentCollectionResource} from 'core-app/modules/hal/resources/attachment-collection-resource';\nimport {OpenProjectFileUploadService, UploadFile} from 'core-components/api/op-file-upload/op-file-upload.service';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {HttpErrorResponse} from \"@angular/common/http\";\n\ntype Constructor<T = {}> = new (...args:any[]) => T;\n\nexport function Attachable<TBase extends Constructor<HalResource>>(Base:TBase) {\n  return class extends Base {\n    public attachments:AttachmentCollectionResource;\n\n    private NotificationsService:NotificationsService;\n    private halNotification:HalResourceNotificationService;\n    private opFileUpload:OpenProjectFileUploadService;\n    private pathHelper:PathHelperService;\n\n    /**\n     * Can be used in the mixed in class to disable\n     * attempts to upload attachments right away.\n     */\n    private attachmentsBackend:boolean|null;\n\n    /**\n     * Return whether the user is able to upload an attachment.\n     *\n     * If either the `addAttachment` link is provided or the resource is being created,\n     * adding attachments is allowed.\n     */\n    public get canAddAttachments():boolean {\n      return !!this.$links.addAttachment || this.isNew;\n    }\n\n    /**\n     *\n     */\n    public get hasAttachments():boolean {\n      return _.get(this.attachments, 'elements.length', 0) > 0;\n    }\n\n    /**\n     * Try to find an existing file's download URL given its filename\n     * @param file\n     */\n    public lookupDownloadLocationByName(file:string):string|null {\n      if (!(this.attachments && this.attachments.elements)) {\n        return null;\n      }\n\n      const match = _.find(this.attachments.elements, (res:HalResource) => res.name === file);\n      return _.get(match, 'staticDownloadLocation.href', null);\n    }\n\n    /**\n     * Remove the given attachment either from the pending attachments or from\n     * the attachment collection, if it is a resource.\n     *\n     * Removing it from the elements array assures that the view gets updated immediately.\n     * If an error occurs, the user gets notified and the attachment is pushed to the elements.\n     */\n    public removeAttachment(attachment:any):Promise<any> {\n      _.pull(this.attachments.elements, attachment);\n\n      if (attachment.$isHal) {\n        return attachment.delete()\n          .then(() => {\n            if (!!this.attachmentsBackend) {\n              this.updateAttachments();\n            } else {\n              this.attachments.count = Math.max(this.attachments.count - 1, 0);\n            }\n          })\n          .catch((error:any) => {\n            this.halNotification.handleRawError(error, this as any);\n            this.attachments.elements.push(attachment);\n          });\n      }\n      return Promise.resolve();\n    }\n\n    /**\n     * Get updated attachments from the server and push the state\n     *\n     * Return a promise that returns the attachments. Reject, if the work package has\n     * no attachments.\n     */\n    public updateAttachments():Promise<HalResource> {\n      return this\n        .attachments\n        .updateElements()\n        .then(() => {\n          this.updateState();\n          return this.attachments;\n        });\n    }\n\n    /**\n     * Upload the given attachments, update the resource and notify the user.\n     * Return an updated AttachmentCollectionResource.\n     */\n    public uploadAttachments(files:UploadFile[]):Promise<{ response:HalResource, uploadUrl:string }[]> {\n      const {uploads, finished} = this.performUpload(files);\n\n      const message = I18n.t('js.label_upload_notification');\n      const notification = this.NotificationsService.addAttachmentUpload(message, uploads);\n\n      return finished\n        .then((result:{ response:HalResource, uploadUrl:string }[]) => {\n          setTimeout(() => this.NotificationsService.remove(notification), 700);\n\n          this.attachments.count += result.length;\n          result.forEach(r => {\n            this.attachments.elements.push(r.response);\n          });\n          this.updateState();\n\n          return result;\n        })\n        .catch((error:HttpErrorResponse) => {\n          let message:undefined|string;\n          console.error(\"Error while uploading: %O\", error);\n\n          if (error.error instanceof ErrorEvent) {\n            // A client-side or network error occurred.\n            message = this.I18n.t('js.error_attachment_upload', {error: error});\n          } else if (_.get(error, 'error._type') === 'Error') {\n            message = error.error.message;\n          } else {\n            // The backend returned an unsuccessful response code.\n            message = error.error;\n          }\n\n          this.halNotification.handleRawError(message);\n          return message || I18n.t('js.error.internal');\n        });\n    }\n\n    private performUpload(files:UploadFile[]) {\n      let href = '';\n\n      if (this.isNew || !this.id || !this.attachmentsBackend) {\n        href = this.pathHelper.api.v3.attachments.path;\n      } else {\n        href = this.addAttachment.$link.href;\n      }\n\n      return this.opFileUpload.uploadAndMapResponse(href, files);\n    }\n\n    private updateState() {\n      if (this.state) {\n        this.state.putValue(this as any);\n      }\n    }\n\n    public $initialize(source:any) {\n      if (!this.NotificationsService) {\n        this.NotificationsService = this.injector.get(NotificationsService);\n      }\n      if (!this.halNotification) {\n        this.halNotification = this.injector.get(HalResourceNotificationService);\n      }\n      if (!this.opFileUpload) {\n        this.opFileUpload = this.injector.get(OpenProjectFileUploadService);\n      }\n\n      if (!this.pathHelper) {\n        this.pathHelper = this.injector.get(PathHelperService);\n      }\n\n      super.$initialize(source);\n\n      let attachments = this.attachments || {$source: {}, elements: []};\n      this.attachments = new AttachmentCollectionResource(\n        this.injector,\n        attachments,\n        false,\n        this.halInitializer,\n        'HalResource'\n      );\n    }\n  };\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayFieldContext} from \"core-app/modules/fields/display/display-field.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport interface IFieldSchema {\n  type:string;\n  writable:boolean;\n  allowedValues?:any;\n  required?:boolean;\n  hasDefault:boolean;\n  name?:string;\n  options?:any;\n}\n\nexport class Field extends UntilDestroyedMixin {\n  public static type:string;\n  public resource:any;\n  public name:string;\n  public schema:IFieldSchema;\n  public context:DisplayFieldContext;\n\n  public get displayName():string {\n    return this.schema.name || this.name;\n  }\n\n  public get value() {\n    return this.resource[this.name];\n  }\n\n  public get type():string {\n    return (this.constructor as typeof Field).type;\n  }\n\n  public get required():boolean {\n    return !!this.schema.required;\n  }\n\n  public get writable():boolean {\n    return this.schema.writable && this.resource.isAttributeEditable(this.name);\n  }\n\n  public get hasDefault():boolean {\n    return this.schema.hasDefault;\n  }\n\n  public get options():boolean {\n    return this.schema.options;\n  }\n\n  public isEmpty():boolean {\n    return !this.value;\n  }\n\n  public get unknownAttribute():boolean {\n    return this.isEmpty && !this.schema;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {\n  AfterContentInit,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter, HostListener,\n  Input,\n  Output,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {from, Observable, of, Subject} from \"rxjs\";\nimport {catchError, debounceTime, distinctUntilChanged, map, switchMap, tap} from \"rxjs/operators\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  selector: 'wp-relations-autocomplete',\n  templateUrl: './wp-relations-autocomplete.html',\n\n  // Allow styling the embedded ng-select\n  encapsulation: ViewEncapsulation.None,\n  styleUrls: ['./wp-relations-autocomplete.sass']\n})\nexport class WorkPackageRelationsAutocomplete implements AfterContentInit {\n  readonly text = {\n    placeholder: this.I18n.t('js.relations_autocomplete.placeholder')\n  };\n\n  @Input() inputPlaceholder:string = this.text.placeholder;\n  @Input() workPackage:WorkPackageResource;\n  @Input() selectedRelationType:string;\n  @Input() filterCandidatesFor:string;\n\n  /** Do we take the current query filters into account? */\n  @Input() additionalFilters:ApiV3Filter[] = [];\n\n  @Input() hiddenOverflowContainer:string = 'body';\n  @ViewChild(NgSelectComponent, { static: true }) public ngSelectComponent:NgSelectComponent;\n\n  @Output() onCancel = new EventEmitter<undefined>();\n  @Output() onSelected = new EventEmitter<WorkPackageResource>();\n  @Output() onEmptySelected = new EventEmitter<undefined>();\n\n  // Whether we're currently loading\n  public isLoading = false;\n\n  // Search input from ng-select\n  public searchInput$ = new Subject<string>();\n\n  public appendToContainer = 'body';\n\n  // Search results mapped to input\n  public results$:Observable<WorkPackageResource[]> = this.searchInput$.pipe(\n    debounceTime(250),\n    distinctUntilChanged(),\n    tap(() => this.isLoading = true),\n    switchMap(queryString => this.autocompleteWorkPackages(queryString))\n  );\n\n  constructor(private readonly querySpace:IsolatedQuerySpace,\n              private readonly pathHelper:PathHelperService,\n              private readonly notificationService:WorkPackageNotificationService,\n              private readonly CurrentProject:CurrentProjectService,\n              private readonly halResourceService:HalResourceService,\n              private readonly schemaCacheService:SchemaCacheService,\n              private readonly cdRef:ChangeDetectorRef,\n              private readonly I18n:I18nService) {\n  }\n\n  @HostListener('keydown.escape')\n  public reset() {\n    this.cancel();\n  }\n\n  ngAfterContentInit():void {\n    if (!this.ngSelectComponent) {\n      return;\n    }\n\n    setTimeout(() => {\n      this.ngSelectComponent.focus();\n    }, 25);\n  }\n\n  cancel() {\n    this.onCancel.emit();\n  }\n\n  public onWorkPackageSelected(workPackage?:WorkPackageResource) {\n    if (workPackage) {\n      this.schemaCacheService\n        .ensureLoaded(workPackage)\n        .then(() => {\n          this.onSelected.emit(workPackage);\n          this.ngSelectComponent.close();\n        });\n    }\n  }\n\n  private autocompleteWorkPackages(query:string):Observable<WorkPackageResource[]> {\n    // Return when the search string is empty\n    if (query === null || query.length === 0) {\n      this.isLoading = false;\n      return of([]);\n    }\n\n    // Remove prefix # from search\n    query = query.replace(/^#/, '');\n\n    return from(\n      this.workPackage.availableRelationCandidates.$link.$fetch({\n        query: query,\n        filters: JSON.stringify(this.additionalFilters),\n        type: this.filterCandidatesFor || this.selectedRelationType\n      }) as Promise<WorkPackageCollectionResource>\n    )\n    .pipe(\n        map(collection => collection.elements),\n        catchError((error:unknown) => {\n          this.notificationService.handleRawError(error);\n          return of([]);\n        }),\n        tap(() => this.isLoading = false)\n      );\n  }\n\n  onOpen() {\n    // Force reposition as a workaround for BUG\n    // https://github.com/ng-select/ng-select/issues/1259\n    setTimeout(() => {\n      const component = (this.ngSelectComponent) as any;\n      if (component && component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n\n      jQuery(this.hiddenOverflowContainer).one('scroll', () => {\n        this.ngSelectComponent.close();\n      });\n    }, 25);\n\n  }\n}\n","<div class=\"wp-relations--autocomplete\">\n<ng-select ngClass=\"wp-inline-create--reference-autocompleter\"\n           [items]=\"results$ | async\"\n           [appendTo]=\"appendToContainer\"\n           [multiple]=\"false\"\n           [loading]=\"isLoading\"\n           [placeholder]=\"inputPlaceholder\"\n           [typeahead]=\"searchInput$\"\n           [closeOnSelect]=\"true\"\n           (open)=\"onOpen()\"\n           (change)=\"onWorkPackageSelected($event)\">\n  <ng-template ng-label-tmp let-item=\"item\">\n    {{item.type.name }} #{{ item.id }} {{ item.subject }}\n  </ng-template>\n  <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\" let-search=\"searchTerm\">\n    {{item.type.name }} #{{ item.id }} {{ item.subject }}\n  </ng-template>\n</ng-select>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {InputState} from \"reactivestates\";\nimport {HalLinkInterface} from 'core-app/modules/hal/hal-link/hal-link';\nimport {Injector} from '@angular/core';\nimport {States} from 'core-components/states.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport interface HalResourceClass<T extends HalResource = HalResource> {\n  new(injector:Injector,\n      source:any,\n      $loaded:boolean,\n      halInitializer:(halResource:T) => void,\n      $halType:string):T;\n}\n\nexport class HalResource {\n  // TODO this is the source of many issues in the frontend\n  // because it no longer properly type checks stuff\n  // Since 2019-10-21 I'm documenting what bugs this caused:\n  // https://community.openproject.com/wp/31462\n  [attribute:string]:any;\n\n  // The API type reported from API\n  public _type:string;\n\n  // Internal initialization time for objects\n  // created in the frontend\n  public __initialized_at:Number;\n\n  // The HalResource that this type maps to\n  // This will almost always be equal to _type, however may be different for dynamic types\n  // e.g., { _type: 'StatusFilterInstance', $halType: 'QueryFilterInstance' }.\n  //\n  // This is required for attributes to be correctly mapped according to their configuration.\n  public $halType:string;\n\n  @InjectField() states:States;\n  @InjectField() I18n:I18nService;\n\n  /**\n   * Constructs and initializes the HalResource. For this, the halResoureFactory is required.\n   *\n   * However, We can't inject the HalResourceFactory here because it itself depends on this class.\n   * So if you need to initialize a HalResource, use +HalResourceFactory.createHalResource+ instead.\n   *\n   * @param {Injector} injector\n   * @param $halType The HalResource type that this instance maps to\n   * @param $source\n   * @param {boolean} $loaded\n   * @param {Function} initializer The initializer callback to HAL-transform all linked and embedded resources.\n   *\n   */\n  public constructor(public injector:Injector,\n                     public $source:any,\n                     public $loaded:boolean,\n                     public halInitializer:(halResource:any) => void,\n                     $halType:string) {\n    this.$halType = $halType;\n    this.$initialize($source);\n  }\n\n  public static getEmptyResource(self:{ href:string|null } = {href: null}):any {\n    return {_links: {self: self}};\n  }\n\n  public $links:any = {};\n  public $embedded:any = {};\n  public $self:Promise<this>;\n\n  public _name:string;\n\n  public static idFromLink(href:string):string {\n    return href.split('/').pop()!;\n  }\n\n  public get idFromLink():string {\n    if (this.$href) {\n      return HalResource.idFromLink(this.$href);\n    }\n\n    return '';\n  }\n\n  public $initialize(source:any) {\n    this.$source = source.$source || source;\n    this.halInitializer(this);\n  }\n\n  /**\n   * Override toString to ensure the resource can\n   * be printed nicely on console and in errors\n   */\n  public toString() {\n    if (this.$href) {\n      return `[HalResource href=${this.$href}]`;\n    } else {\n      return `[HalResource id=${this.id}]`;\n    }\n  }\n\n  /**\n   * Returns the ID and ensures it's a string, null.\n   * Returns a string when:\n   *  - The embedded ID is actually set\n   *  - The self link is terminated by a number.\n   */\n  public get id():string|null {\n    if (this.$source.id) {\n      return this.$source.id.toString();\n    }\n\n    const id = this.idFromLink;\n    if (id.match(/^\\d+$/)) {\n      return id;\n    }\n\n    return null;\n  }\n\n  public set id(val:string|null) {\n    this.$source.id = val;\n  }\n\n  public get isNew():boolean {\n    return this.id === 'new';\n  }\n\n  public get persisted() {\n    return !!(this.id && this.id !== 'new');\n  }\n\n  /**\n   * Return whether the resource is editable with the user's permission\n   * on the given resource package attribute.\n   * In order to be editable, there needs to be an update link on the resource and the schema for\n   * the attribute needs to indicate the writability.\n   *\n   * @param property\n   */\n  public isAttributeEditable(property:string):boolean {\n    const fieldSchema = this.schema[property];\n    return this.$links.update && fieldSchema && fieldSchema.writable;\n  }\n\n  /**\n   * Retain the internal tracking identifier from the given other work package.\n   * This is due to us needing to identify a work package beyond its actual ID,\n   * because that changes upon saving.\n   *\n   * @param other\n   */\n  public retainFrom(other:HalResource) {\n    this.__initialized_at = other.__initialized_at;\n  }\n\n\n  /**\n   * Create a HalResource from the copied source of the given, other HalResource.\n   *\n   * @param {HalResource} other\n   * @returns A HalResource with the identitical copied source of other.\n   */\n  public $copy<T extends HalResource = HalResource>(source:Object = {}):T {\n    let clone:HalResourceClass<T> = this.constructor as any;\n\n    return new clone(this.injector, _.merge(this.$plain(), source), this.$loaded, this.halInitializer, this.$halType);\n  }\n\n  public $plain():any {\n    return _.cloneDeep(this.$source);\n  }\n\n  public get $isHal():boolean {\n    return true;\n  }\n\n  public get $link():HalLinkInterface {\n    return this.$links.self.$link;\n  }\n\n  public get name():string {\n    return this._name || this.$link.title || '';\n  }\n\n  public set name(name:string) {\n    this._name = name;\n  }\n\n  /**\n   * Alias for $href.\n   */\n  public get href():string|null {\n    return this.$link.href;\n  }\n\n  public get $href():string|null {\n    return this.$link.href;\n  }\n\n  /**\n   * Return the associated state to this HAL resource, if any.\n   */\n  public get state():InputState<this>|null {\n    return null;\n  }\n\n  /**\n   * Update the state\n   */\n  public push(newValue:this):Promise<unknown> {\n    if (this.state) {\n      this.state.putValue(newValue);\n    }\n\n    return Promise.resolve();\n  }\n\n  public previewPath():string|undefined {\n    if (this.isNew && this.project) {\n      return this.project.href;\n    }\n\n    return undefined;\n  }\n\n  public getEditorTypeFor(_fieldName:string):'full'|'constrained' {\n    return 'constrained';\n  }\n\n  public $load(force = false):Promise<this> {\n    if (!this.state) {\n      return this.$loadResource(force);\n    }\n\n    const state = this.state;\n\n    if (force) {\n      state.clear();\n    }\n\n    // If nobody has asked yet for the resource to be $loaded, do it ourselves.\n    // Otherwise, we risk returning a promise, that will never be resolved.\n    state.putFromPromiseIfPristine(() => this.$loadResource(force));\n\n    return <Promise<this>>state.valuesPromise().then((source:any) => {\n      this.$initialize(source);\n      this.$loaded = true;\n      return this;\n    });\n  }\n\n  protected $loadResource(force = false):Promise<this> {\n    if (!force) {\n      if (this.$loaded) {\n        return Promise.resolve(this);\n      }\n\n      if (!this.$loaded && this.$self) {\n        return this.$self;\n      }\n    }\n\n    // Reset and load this resource\n    this.$loaded = false;\n    this.$self = this.$links.self({}).then((source:any) => {\n      this.$loaded = true;\n      this.$initialize(source.$source);\n      return this;\n    });\n\n    return this.$self;\n  }\n\n  /**\n   * Update the resource ignoring the cache.\n   */\n  public $update() {\n    return this.$load(true);\n  }\n\n  /**\n   * Specify this resource's embedded keys that should be transformed with resources.\n   * Use this to restrict, e.g., links that should not be made properties if you have a custom get/setter.\n   */\n  public $embeddableKeys():string[] {\n    const properties = Object.keys(this.$source);\n    return _.without(properties, '_links', '_embedded', 'id');\n  }\n\n  /**\n   * Specify this resource's keys that should not be transformed with resources.\n   * Use this to restrict, e.g., links that should not be made properties if you have a custom get/setter.\n   */\n  public $linkableKeys():string[] {\n    const properties = Object.keys(this.$links);\n    return _.without(properties, 'self');\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input} from '@angular/core';\n\n@Component({\n  selector: 'op-icon',\n  host: { 'class': 'op-icon--wrapper' },\n  template: `\n      <i [ngClass]=\"iconClasses\"\n         [title]=\"iconTitle\"\n         aria-hidden=\"true\"></i>\n      <span\n        class=\"hidden-for-sighted\"\n        [textContent]=\"iconTitle\"\n        *ngIf=\"iconTitle\"></span>\n    `\n})\nexport class OpIcon {\n  @Input('icon-classes') iconClasses:string;\n  @Input('icon-title') iconTitle:string = '';\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {MultiInputState} from 'reactivestates';\nimport {States} from '../states.service';\nimport {StateCacheService} from '../states/state-cache.service';\nimport {Injectable} from '@angular/core';\nimport {ProjectResource} from 'core-app/modules/hal/resources/project-resource';\nimport {ProjectDmService} from 'core-app/modules/hal/dm-services/project-dm.service';\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class ProjectCacheService extends StateCacheService<ProjectResource> {\n\n  constructor(readonly states:States,\n              readonly schemaCacheService:SchemaCacheService,\n              readonly projectDmService:ProjectDmService) {\n    super();\n  }\n\n  protected loadAll(ids:string[]):Promise<undefined> {\n    return Promise\n      .all(ids.map(id => this.load(id)))\n      .then(_ => undefined);\n  }\n\n  updateValue(id:string, val:ProjectResource) {\n    this.schemaCacheService.ensureLoaded(val).then(() => {\n      super.updateValue(id, val);\n    });\n  }\n\n  protected load(id:string):Promise<ProjectResource> {\n    return this\n        .projectDmService\n        .one(parseInt(id))\n        .then((project) => {\n          return this.schemaCacheService.ensureLoaded(project).then(() => project);\n        });\n  }\n\n  protected get multiState():MultiInputState<ProjectResource> {\n    return this.states.projects;\n  }\n\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\nexport interface RelationResourceLinks {\n  delete():Promise<any>;\n\n  updateImmediately(payload:any):Promise<any>;\n}\n\nexport class RelationResource extends HalResource {\n\n  static RELATION_TYPES(includeParentChild:boolean = true):string[] {\n    const types = [\n      'relates',\n      'duplicates',\n      'duplicated',\n      'blocks',\n      'blocked',\n      'precedes',\n      'follows',\n      'includes',\n      'partof',\n      'requires',\n      'required'\n    ];\n\n    if (includeParentChild) {\n      types.push('parent', 'children');\n    }\n\n    return types;\n  }\n\n  static LOCALIZED_RELATION_TYPES(includeParentchild:boolean = true) {\n    const relationTypes = RelationResource.RELATION_TYPES(includeParentchild);\n\n    return relationTypes.map((key:string) => {\n      return {name: key, label: I18n.t('js.relation_labels.' + key)};\n    });\n  }\n\n  static DEFAULT() {\n    return 'relates';\n  }\n\n  // Properties\n  public description:string|null;\n  public name:string;\n  public type:any;\n  public reverseType:string;\n\n  // Links\n  public $links:RelationResourceLinks;\n  public to:WorkPackageResource;\n  public from:WorkPackageResource;\n\n  public normalizedType(workPackage:WorkPackageResource) {\n    return this.denormalized(workPackage).relationType;\n  }\n\n  /**\n   * Return the denormalized relation data, seeing the relation.from to be `workPackage`.\n   *\n   * @param workPackage\n   * @return {{id, href, relationType: string, workPackageType}}\n   */\n  public denormalized(workPackage:WorkPackageResource):DenormalizedRelationData {\n    const target = (this.to.href === workPackage.$href) ? 'from' : 'to';\n\n    return {\n      target: this[target],\n      targetId: this[target].id!,\n      relationType: target === 'from' ? this.reverseType : this.type,\n      reverseRelationType: target === 'from' ? this.type : this.reverseType\n    };\n  }\n\n  /**\n   * Return whether the given work package id is involved in this relation.\n   * @param wpId\n   * @return {boolean}\n   */\n  public isInvolved(wpId:string) {\n    return _.values(this.ids).indexOf(wpId.toString()) >= 0;\n  }\n\n  /**\n   * Get the involved IDs, returning an object to the ids.\n   */\n  public get ids() {\n    return {\n      from: WorkPackageResource.idFromLink(this.from.href!),\n      to: WorkPackageResource.idFromLink(this.to.href!)\n    };\n  }\n\n  public updateDescription(description:string) {\n    return this.$links.updateImmediately({description: description});\n  }\n\n  public updateType(type:any) {\n    return this.$links.updateImmediately({type: type});\n  }\n}\n\nexport interface RelationResource extends RelationResourceLinks {\n}\n\nexport interface DenormalizedRelationData {\n  target:WorkPackageResource;\n  targetId:string;\n  relationType:string;\n  reverseRelationType:string;\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ResourcesDisplayField} from \"./resources-display-field.module\";\nimport {cssClassCustomOption} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class MultipleLinesStringObjectsDisplayField extends ResourcesDisplayField {\n\n  public render(element:HTMLElement, displayText:string):void {\n    const values = this.value;\n    element.setAttribute('title', displayText);\n    element.textContent = displayText;\n\n    element.innerHTML = '';\n\n    if (values.length === 0) {\n      this.renderEmpty(element);\n    } else {\n      this.renderValues(values, element);\n    }\n  }\n\n  protected renderValues(values:string[], element:HTMLElement) {\n    values.forEach((value) => {\n      const div = document.createElement('div');\n      div.classList.add(cssClassCustomOption, '-multiple-lines');\n      div.setAttribute('title', value);\n      div.textContent = value;\n\n      element.appendChild(div);\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ProgressDisplayField} from './progress-display-field.module';\n\nexport class ProgressTextDisplayField extends ProgressDisplayField {\n  public render(element:HTMLElement, displayText:string):void {\n    const label = this.percentLabel;\n    element.setAttribute('title', label);\n    element.innerHTML = '';\n    element.textContent = label;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ResourcesDisplayField} from \"./resources-display-field.module\";\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UserAvatarRendererService} from \"core-components/user/user-avatar/user-avatar-renderer.service\";\n\nexport class MultipleLinesUserFieldModule extends ResourcesDisplayField {\n  @InjectField() avatarRenderer:UserAvatarRendererService;\n\n  public render(element:HTMLElement, displayText:string):void {\n    const values = this.attribute;\n    element.setAttribute('title', displayText);\n    element.textContent = displayText;\n\n    element.innerHTML = '';\n\n    if (values.length === 0) {\n      this.renderEmpty(element);\n    } else {\n      this.renderValues(values, element);\n    }\n  }\n\n  protected renderValues(values:UserResource[], element:HTMLElement) {\n    this.avatarRenderer.renderMultiple(element, values, true, true);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DateDisplayField} from \"core-app/modules/fields/display/field-types/date-display-field.module\";\n\nexport class CombinedDateDisplayField extends DateDisplayField {\n  text = {\n    placeholder: {\n      startDate: this.I18n.t('js.label_no_start_date'),\n      dueDate: this.I18n.t('js.label_no_due_date')\n    },\n  };\n\n  public render(element:HTMLElement, displayText:string):void {\n    var startDateElement = this.createDateDisplayField('startDate');\n    var dueDateElement = this.createDateDisplayField('dueDate');\n\n    var separator = document.createElement('span');\n    separator.textContent = ' - ';\n\n    element.appendChild(startDateElement);\n    element.appendChild(separator);\n    element.appendChild(dueDateElement);\n  }\n\n  private createDateDisplayField(date:'dueDate'|'startDate'):HTMLElement {\n    var dateElement = document.createElement('span');\n    var dateDisplayField = new DateDisplayField(date, this.context);\n    var text = this.resource[date] ?\n      this.timezoneService.formattedDate(this.resource[date]) :\n      this.text.placeholder[date];\n\n    dateDisplayField.apply(this.resource, this.schema);\n    dateDisplayField.render(dateElement, text);\n\n    return dateElement;\n  }\n}\n","import {Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {DisplayFieldContext, DisplayFieldService} from \"core-app/modules/fields/display/display-field.service\";\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {MultipleLinesStringObjectsDisplayField} from \"core-app/modules/fields/display/field-types/multiple-lines-string-objects-display-field.module\";\nimport {ProgressTextDisplayField} from \"core-app/modules/fields/display/field-types/progress-text-display-field.module\";\nimport {MultipleLinesUserFieldModule} from \"core-app/modules/fields/display/field-types/multiple-lines-user-display-field.module\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {CombinedDateDisplayField} from \"core-app/modules/fields/display/field-types/combined-date-display.field\";\n\nexport const editableClassName = '-editable';\nexport const requiredClassName = '-required';\nexport const readOnlyClassName = '-read-only';\nexport const placeholderClassName = '-placeholder';\nexport const displayClassName = 'inline-edit--display-field';\nexport const editFieldContainerClass = 'inline-edit--container';\nexport const cellEmptyPlaceholder = '-';\n\nexport class DisplayFieldRenderer<T extends HalResource = HalResource> {\n\n  @InjectField() displayFieldService:DisplayFieldService;\n  @InjectField() I18n:I18nService;\n\n  /** We cache the previously used fields to avoid reinitialization */\n  private fieldCache:{ [key:string]:DisplayField } = {};\n\n  constructor(public readonly injector:Injector,\n              public readonly container:'table'|'single-view'|'timeline',\n              public readonly options:{ [key:string]:any } = {}) {\n  }\n\n  public render(resource:T,\n                name:string,\n                change:ResourceChangeset<T>|null,\n                placeholder?:string):HTMLSpanElement {\n\n    const [field, span] = this.renderFieldValue(resource, name, change, placeholder);\n\n    if (field === null) {\n      return span;\n    }\n\n    this.setSpanAttributes(span, field, name, resource);\n\n    return span;\n  }\n\n  public renderFieldValue(resource:T,\n                          name:string,\n                          change:ResourceChangeset<T>|null,\n                          placeholder?:string):[DisplayField|null, HTMLSpanElement] {\n    const span = document.createElement('span');\n    const schemaName = this.getSchemaName(resource, change, name);\n    const fieldSchema = resource.schema[schemaName];\n\n    // If the resource does not have that field, return an empty\n    // span (e.g., for the table).\n    if (!fieldSchema) {\n      return [null, span];\n    }\n\n    const field = this.getField(resource, fieldSchema, schemaName, change);\n    field.render(span, this.getText(field, fieldSchema, placeholder), fieldSchema.options);\n\n    const title = field.title;\n    if (title) {\n      span.setAttribute('title', title);\n    }\n    span.setAttribute('aria-label', this.getAriaLabel(field, resource));\n\n    return [field, span];\n  }\n\n  public getField(resource:T,\n                  fieldSchema:IFieldSchema,\n                  name:string,\n                  change:ResourceChangeset<T>|null):DisplayField {\n    let field = this.fieldCache[name];\n\n    if (!field) {\n      field = this.fieldCache[name] = this.getFieldForCurrentContext(resource, name, fieldSchema);\n    }\n\n    field.apply(resource, fieldSchema);\n    field.activeChange = change;\n\n    return field;\n  }\n\n  private getFieldForCurrentContext(resource:T, name:string, fieldSchema:IFieldSchema):DisplayField {\n    const context:DisplayFieldContext = {container: this.container, injector: this.injector, options: this.options};\n\n    // We handle multi value fields differently in the single view context\n    const isCustomMultiLinesField = ['[]CustomOption'].indexOf(fieldSchema.type) >= 0;\n    if (this.container === 'single-view' && isCustomMultiLinesField) {\n      return new MultipleLinesStringObjectsDisplayField(name, context) as DisplayField;\n    }\n    const isUserMultiLinesField = ['[]User'].indexOf(fieldSchema.type) >= 0;\n    if (this.container === 'single-view' && isUserMultiLinesField) {\n      return new MultipleLinesUserFieldModule(name, context) as DisplayField;\n    }\n\n    // In the single view, start and end date are shown in a combined date field\n    if (this.container === 'single-view' && (name === 'startDate')) {\n      return new CombinedDateDisplayField(name, context) as DisplayField;\n    }\n\n    // We handle progress differently in the timeline\n    if (this.container === 'timeline' && name === 'percentageDone') {\n      return new ProgressTextDisplayField(name, context);\n    }\n\n    return this.displayFieldService.getField(resource, name, fieldSchema, context);\n  }\n\n  private getText(field:DisplayField, fieldSchema:IFieldSchema, placeholder?:string):string {\n    if (field.isEmpty()) {\n      return placeholder || this.getDefaultPlaceholder(fieldSchema);\n    } else {\n      return field.valueString;\n    }\n  }\n\n  private setSpanAttributes(span:HTMLElement, field:DisplayField, name:string, resource:T):void {\n    span.classList.add(displayClassName, name);\n    span.dataset['fieldName'] = name;\n\n    // Make span tabbable unless it's an id field\n    span.setAttribute('tabindex', name === 'id' ? '-1' : '0');\n\n    if (field.required) {\n      span.classList.add(requiredClassName);\n    }\n\n    if (field.isEmpty()) {\n      span.classList.add(placeholderClassName);\n    }\n\n    if (field.writable) {\n      span.classList.add(editableClassName);\n      span.setAttribute('role', 'button');\n    } else {\n      span.classList.add(readOnlyClassName);\n    }\n  }\n\n  private getAriaLabel(field:DisplayField, resource:T):string {\n    let titleContent;\n    let labelContent = this.getLabelContent(field);\n\n    if (field.isFormattable && !field.isEmpty()) {\n      try {\n        titleContent = _.escape(jQuery(`<div>${labelContent}</div>`).text());\n      } catch (e) {\n        console.error(\"Failed to parse formattable labelContent\");\n        titleContent = \"Label for \" + field.displayName;\n      }\n\n    } else {\n      titleContent = labelContent;\n    }\n\n    if (field.writable && resource.isAttributeEditable(field.name)) {\n      return this.I18n.t('js.inplace.button_edit', {attribute: `${field.displayName} ${titleContent}`});\n    } else {\n      return `${field.displayName} ${titleContent}`;\n    }\n  }\n\n  private getLabelContent(field:DisplayField):string {\n    if (field.isEmpty()) {\n      return this.I18n.t('js.inplace.null_value_label');\n    } else {\n      return field.valueString;\n    }\n  }\n\n  /**\n   * Get the schema name from either the changeset, the resource (if available) or\n   * return the attribute itself.\n   *\n   * @param resource\n   * @param change\n   * @param name\n   */\n  private getSchemaName(resource:T, change:ResourceChangeset<T>|null, name:string) {\n    if (change) {\n      return change.getSchemaName(name);\n    }\n\n    if (!!resource.getSchemaName) {\n      return resource.getSchemaName(name);\n    }\n\n    return name;\n  }\n\n  private getDefaultPlaceholder(fieldSchema:IFieldSchema):string {\n    if (fieldSchema.type === 'Formattable') {\n      return this.I18n.t('js.work_packages.placeholders.formattable', {name: fieldSchema.name});\n    }\n\n    return cellEmptyPlaceholder;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageFiltersService} from 'core-components/filters/wp-filters/wp-filters.service';\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {AngularTrackingHelpers} from 'core-components/angular/tracking-functions';\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\n\n@Component({\n  selector: '[query-filter]',\n  templateUrl: './query-filter.component.html'\n})\nexport class QueryFilterComponent implements OnInit {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new EventEmitter<QueryFilterResource>();\n  @Output() public deactivateFilter = new EventEmitter<QueryFilterResource>();\n\n  public availableOperators:any;\n  public showValuesInput:boolean = false;\n  public eeShowBanners:boolean = false;\n  public trackByHref = AngularTrackingHelpers.halHref;\n  public compareByHref = AngularTrackingHelpers.compareByHref;\n\n  public text = {\n    open_filter: this.I18n.t('js.filter.description.text_open_filter'),\n    close_filter: this.I18n.t('js.filter.description.text_close_filter'),\n    label_filter_add: this.I18n.t('js.work_packages.label_filter_add'),\n    upsale_for_more: this.I18n.t('js.filter.upsale_for_more'),\n    upsale_link: this.I18n.t('js.filter.upsale_link'),\n    button_delete: this.I18n.t('js.button_delete'),\n  };\n\n  constructor(readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly wpFiltersService:WorkPackageFiltersService,\n              readonly I18n:I18nService,\n              readonly bannerService:BannersService) {\n  }\n\n  public onFilterUpdated(filter:QueryFilterInstanceResource) {\n    this.filter = filter;\n    this.showValuesInput = this.filter.currentSchema!.isValueRequired();\n    this.filterChanged.emit(this.filter);\n  }\n\n  public removeThisFilter() {\n    this.deactivateFilter.emit(this.filter);\n  }\n\n  public get valueType():string|undefined {\n    if (this.filter.currentSchema && this.filter.currentSchema.values) {\n      return this.filter.currentSchema.values.type;\n    }\n\n    return undefined;\n  }\n\n  ngOnInit() {\n    this.eeShowBanners = this.bannerService.eeShowBanners;\n    this.availableOperators = this.filter.schema.availableOperators;\n    this.showValuesInput = this.filter.currentSchema!.isValueRequired();\n  }\n}\n","<ng-container>\n  <!-- Name -->\n  <label for=\"operators-{{filter.id}}\"\n         class=\"advanced-filters--filter-name\"\n         [textContent]=\"filter.name\"\n         [attr.title]=\"filter.name\">\n  </label>\n\n  <!-- Operator -->\n  <div class=\"advanced-filters--filter-operator\">\n\n    <label for=\"operators-{{filter.id}}\"\n           class=\"hidden-for-sighted\">\n      {{ filter.name }}\n      {{ text.open_filter }}\n    </label>\n\n    <select required\n            class=\"advanced-filters--select\"\n            id=\"operators-{{filter.id}}\"\n            name=\"op[{{filter.id}}]\"\n            [(ngModel)]=\"filter.operator\"\n            (ngModelChange)=\"onFilterUpdated(filter)\"\n            [compareWith]=\"compareByHref\"\n            style=\"vertical-align: top;\">\n      <option *ngFor=\"let operator of availableOperators\"\n              [textContent]=\"operator.name\"\n              [ngValue]=\"operator\">\n      </option>\n    </select>\n  </div>\n\n  <!-- Values -->\n  <ng-container *ngIf=\"showValuesInput && valueType\">\n    <div class=\"advanced-filters--filter-value\" [ngSwitch]=\"valueType\">\n      <filter-integer-value *ngSwitchCase=\"'[1]Integer'\"\n                            (filterChanged)=\"onFilterUpdated($event)\"\n                            [shouldFocus]=\"shouldFocus\"\n                            [filter]=\"filter\"></filter-integer-value>\n\n      <filter-date-value *ngSwitchCase=\"'[1]Date'\"\n                         (filterChanged)=\"onFilterUpdated($event)\"\n                         [shouldFocus]=\"shouldFocus\"\n                         [filter]=\"filter\"></filter-date-value>\n\n      <filter-dates-value *ngSwitchCase=\"'[2]Date'\"\n                          (filterChanged)=\"onFilterUpdated($event)\"\n                          [shouldFocus]=\"shouldFocus\"\n                          [filter]=\"filter\"></filter-dates-value>\n\n      <filter-date-time-value *ngSwitchCase=\"'[1]DateTime'\"\n                              (filterChanged)=\"onFilterUpdated($event)\"\n                              [shouldFocus]=\"shouldFocus\"\n                              [filter]=\"filter\"></filter-date-time-value>\n\n      <filter-date-times-value *ngSwitchCase=\"'[2]DateTime'\"\n                               [shouldFocus]=\"shouldFocus\"\n                               (filterChanged)=\"onFilterUpdated($event)\"\n                               [filter]=\"filter\"></filter-date-times-value>\n\n      <filter-string-value *ngSwitchCase=\"'[1]String'\"\n                           (filterChanged)=\"onFilterUpdated($event)\"\n                           [shouldFocus]=\"shouldFocus\"\n                           [filter]=\"filter\"></filter-string-value>\n\n      <filter-string-value *ngSwitchCase=\"'[1]Float'\"\n                           (filterChanged)=\"onFilterUpdated($event)\"\n                           [shouldFocus]=\"shouldFocus\"\n                           [filter]=\"filter\"></filter-string-value>\n\n      <filter-boolean-value *ngSwitchCase=\"'[1]Boolean'\"\n                            (filterChanged)=\"onFilterUpdated($event)\"\n                            [shouldFocus]=\"shouldFocus\"\n                            [filter]=\"filter\"></filter-boolean-value>\n\n      <filter-toggled-multiselect-value *ngSwitchDefault\n                                        (filterChanged)=\"onFilterUpdated($event)\"\n                                        [shouldFocus]=\"shouldFocus\"\n                                        [filter]=\"filter\"></filter-toggled-multiselect-value>\n    </div>\n  </ng-container>\n\n  <div class=\"advanced-filters--filter-value\" *ngIf=\"!showValuesInput\">\n  </div>\n\n  <div class=\"advanced-filters--remove-filter\">\n    <accessible-by-keyboard (execute)=\"removeThisFilter()\">\n      <op-icon icon-classes=\"icon-close advanced-filters--remove-filter-icon\"\n               [icon-title]=\"text.button_delete\"></op-icon>\n    </accessible-by-keyboard>\n  </div>\n</ng-container>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HttpParameterCodec} from '@angular/common/http';\n\nexport class URLParamsEncoder implements HttpParameterCodec {\n  encodeKey(key:string):string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value:string):string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key:string):string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value:string):string {\n    return decodeURIComponent(value);\n  }\n}\n\n\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class VersionResource extends HalResource {\n  status:string;\n\n  public definingProject:HalResource;\n\n  public isLocked() {\n    return this.status === 'locked';\n  }\n\n  public isOpen() {\n    return this.status === 'open';\n  }\n\n  public isClosed() {\n    return this.status === 'closed';\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {take} from 'rxjs/operators';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageCreateComponent} from 'core-components/wp-new/wp-create.component';\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {Directive} from \"@angular/core\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Directive()\nexport class WorkPackageCopyController extends WorkPackageCreateComponent {\n  private __initialized_at:Number;\n  private copiedWorkPackageId:string;\n\n  /** Are we in the copying substates ? */\n  public copying = true;\n\n  @InjectField() wpRelations:WorkPackageRelationsService;\n  @InjectField() halEditing:HalResourceEditingService;\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.wpCreate.onNewWorkPackage()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        if (wp.__initialized_at === this.__initialized_at) {\n          this.wpRelations.addCommonRelation(wp.id!, 'relates', this.copiedWorkPackageId);\n        }\n      });\n  }\n\n  protected createdWorkPackage() {\n    this.copiedWorkPackageId = this.stateParams.copiedFromWorkPackageId;\n    return new Promise<WorkPackageChangeset>((resolve, reject) => {\n      this.wpCacheService.loadWorkPackage(this.copiedWorkPackageId)\n        .values$()\n        .pipe(\n          take(1)\n        )\n        .subscribe((wp:WorkPackageResource) => {\n          this.createCopyFrom(wp).then(resolve, reject);\n        });\n    });\n  }\n\n  protected setTitle() {\n    this.titleService.setFirstPart(this.I18n.t('js.work_packages.copy.title'));\n  }\n\n  private createCopyFrom(wp:WorkPackageResource) {\n    let sourceChangeset = this.halEditing.changeFor(wp) as WorkPackageChangeset;\n\n    return this.wpCreate\n      .copyWorkPackage(sourceChangeset)\n      .then((copyChangeset:WorkPackageChangeset) => {\n        this.__initialized_at = copyChangeset.pristineResource.__initialized_at;\n\n        this.wpCacheService.updateWorkPackage(copyChangeset.pristineResource);\n        this.halEditing.updateValue('new', copyChangeset);\n\n        return copyChangeset;\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class ProgressDisplayField extends DisplayField {\n  public get value() {\n    if (this.schema) {\n      return this.resource[this.name] || 0;\n    }\n    else {\n      return null;\n    }\n  }\n\n  public get percentLabel() {\n    return this.roundedProgress + '%';\n  }\n\n  public get roundedProgress() {\n    return Math.round(Number(this.value)) || 0;\n  }\n\n  public render(element:HTMLElement, displayText:string):void {\n    element.setAttribute('title', displayText);\n    element.innerHTML = `\n      <span>\n        <span style=\"width: 80px\" class=\"progress-bar\">\n          <span style=\"width: ${this.roundedProgress}%\" class=\"inner-progress closed\"></span>\n          <span style=\"width: 0%\" class=\"inner-progress done\"></span>\n        </span>\n        <span class=\"progress-bar-legend\">${this.percentLabel}</span>\n      </span>\n    `;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {ActivityPanelBaseController} from 'core-components/wp-single-view-tabs/activity-panel/activity-base.controller';\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\n\n@Component({\n  templateUrl: './activity-tab.html',\n  selector: 'wp-activity-tab',\n})\nexport class WorkPackageActivityTabComponent extends ActivityPanelBaseController {\n  public workPackage:WorkPackageResource;\n  public tabName = this.I18n.t('js.work_packages.tabs.activity');\n  public trackByHref = AngularTrackingHelpers.trackByHrefAndProperty('version');\n\n  ngOnInit() {\n    this.workPackageId = this.$transition.params('to').workPackageId;\n    super.ngOnInit();\n  }\n}\n","<work-package-comment [workPackage]=\"workPackage\">\n  <ng-template>\n    <div class=\"detail-activity\">\n      <div class=\"work-package-details-activities-list\">\n        <div *ngFor=\"let inf of visibleActivities; trackBy:trackByHref; let first = first\"\n            class=\"work-package-details-activities-activity\">\n          <h3 class=\"activity-date\"\n              [ngClass]=\"{'-with-toggler': first && showToggler}\"\n              *ngIf=\"first || inf.isNextDate\">\n            <span class=\"activity-date--label\" [textContent]=\"inf.date\"></span>\n            <accessible-by-keyboard (execute)=\"toggleComments()\"\n                                    *ngIf=\"first && showToggler\"\n                                    linkClass=\"activity-comments--toggler button -small -transparent -with-icon icon-filter icon-small hide-when-print\"\n                                    [linkAriaLabel]=\"togglerText\">\n              <span [textContent]=\"togglerText\"></span>\n            </accessible-by-keyboard>\n          </h3>\n\n          <activity-entry [workPackage]=\"workPackage\"\n                          [activity]=\"inf.activity\"\n                          [activityNo]=\"inf.number(inf.isReversed)\"\n                          [isInitial]=\"inf.isInitial()\">\n          </activity-entry>\n        </div>\n      </div>\n    </div>\n  </ng-template>\n</work-package-comment>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport * as URI from 'urijs';\n\n@Injectable()\nexport class QueryFormDmService {\n  constructor(readonly halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  /**\n   * Load the query form for the given existing (or new) query resource\n   * @param query\n   */\n  public load(query:QueryResource):Promise<QueryFormResource> {\n    // We need a valid payload so that we\n    // can check whether form saving is possible.\n    // The query needs a name to be valid.\n    let payload:any = {\n      'name': query.name || '!!!__O__o__O__!!!'\n    };\n\n    if (query.project) {\n      payload['_links'] = {\n        'project': {\n          'href': query.project.$href\n        }\n      };\n    }\n\n    return query.$links.update(payload);\n  }\n\n  /**\n   * Load the query form only with the given query props.\n   *\n   * @param params\n   * @param queryId\n   * @param projectIdentifier\n   * @param payload\n   */\n  public loadWithParams(params:{[key:string]:unknown}, queryId:string|undefined, projectIdentifier:string|undefined|null, payload:any = {}):Promise<QueryFormResource> {\n    // We need a valid payload so that we\n    // can check whether form saving is possible.\n    // The query needs a name to be valid.\n    if (!queryId && !payload.name) {\n      payload.name = '!!!__O__o__O__!!!';\n    }\n\n    if (projectIdentifier) {\n      payload._links = payload._links || {};\n      payload._links.project = {\n        'href': this.pathHelper.api.v3.projects.id(projectIdentifier).toString()\n      };\n\n    }\n\n    let href:string = this.pathHelper.api.v3.queries.optionalId(queryId).form.toString();\n    href = URI(href).search(params).toString();\n\n    return this.halResourceService\n      .post<QueryFormResource>(href, payload)\n      .toPromise();\n  }\n\n  public buildQueryResource(form:QueryFormResource):QueryResource {\n    return this.halResourceService.createHalResourceOfType<QueryResource>('Query', form.payload);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageViewColumnsService} from './wp-view-columns.service';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {WorkPackageViewHierarchiesService} from './wp-view-hierarchy.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {RelationsStateValue, WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Injectable()\nexport class WorkPackageViewAdditionalElementsService {\n\n  constructor(readonly querySpace:IsolatedQuerySpace,\n              readonly wpTableHierarchies:WorkPackageViewHierarchiesService,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly halResourceService:HalResourceService,\n              readonly wpCacheService:WorkPackageCacheService,\n              readonly wpRelations:WorkPackageRelationsService) {\n  }\n\n  public initialize(rows:WorkPackageResource[]) {\n    // Add relations to the stack\n    Promise.all([\n      this.requireInvolvedRelations(rows.map(el => el.id!)),\n      this.requireHierarchyElements(rows)\n    ]).then((results:string[][]) => {\n      this.loadAdditional(_.flatten(results));\n    });\n  }\n\n  private loadAdditional(wpIds:string[]) {\n    this.wpCacheService.requireAll(wpIds)\n      .then(() => {\n        this.querySpace.additionalRequiredWorkPackages.putValue(null, 'All required work packages are loaded');\n      })\n      .catch((e) => {\n        this.querySpace.additionalRequiredWorkPackages.putValue(null, 'Failure loading required work packages');\n        this.notificationService.handleRawError(e);\n      });\n  }\n\n  /**\n   * Requires both the relation resource of the given work package ids as well\n   * as the `to` work packages returned from the relations\n   */\n  private requireInvolvedRelations(rows:string[]):Promise<string[]> {\n\n    if (!this.wpTableColumns.hasRelationColumns()) {\n      return Promise.resolve([]);\n    }\n    return this.wpRelations\n      .requireAll(rows, true)\n      .then(() => {\n        const ids = this.getInvolvedWorkPackages(rows.map(id => {\n          return this.wpRelations.state(id).value!;\n        }));\n        return _.flatten(ids);\n      });\n  }\n\n  /**\n   * Return the id of all ancestors for visible rows in the table.\n   * @param rows\n   * @return {string[]}\n   */\n  private requireHierarchyElements(rows:WorkPackageResource[]):Promise<string[]> {\n    if (!this.wpTableHierarchies.isEnabled) {\n      return Promise.resolve([]);\n    }\n\n    const ids = _.flatten(rows.map(el => el.ancestorIds));\n    return Promise.resolve(ids);\n  }\n\n  /**\n   * From a set of relations state values, return all involved IDs.\n   * @param states\n   * @return {string[]}\n   */\n  private getInvolvedWorkPackages(states:RelationsStateValue[]) {\n    const ids:string[] = [];\n    _.each(states, (relations:RelationsStateValue) => {\n      _.each(relations, (resource:RelationResource) => {\n        ids.push(resource.ids.from, resource.ids.to);\n      });\n    });\n\n    return ids;\n  }\n}\n","import {createPointCB, getClientRect as getRect, pointInside} from 'dom-plane';\n\nexport class DomAutoscrollService {\n  public elements:Element[];\n  public scrolling:boolean;\n  public down:boolean = false;\n  public scrollWhenOutside:boolean;\n  public autoScroll:() => boolean;\n  public maxSpeed:number;\n  public margin:number;\n  public animationFrame:number;\n  public windowAnimationFrame:number;\n  public current:HTMLElement[];\n  public outerScrollContainer:HTMLElement;\n  public point:any;\n  public pointCB:any;\n\n  constructor(elements:Element[],\n              params:any) {\n    this.elements = elements;\n    this.scrollWhenOutside = params.scrollWhenOutside || false;\n    this.maxSpeed = params.maxSpeed || 5;\n    this.margin = params.margin || 10;\n    this.scrollWhenOutside = params.scrollWhenOutside || false;\n    this.autoScroll = params.autoScroll;\n    this.point = {};\n    this.pointCB = createPointCB(this.point);\n\n    this.init();\n  }\n\n  public init() {\n    jQuery(window).on('mousemove.domautoscroll touchmove.domautoscroll', (evt:any) => {\n      this.pointCB(evt);\n      this.onMove(evt);\n    });\n    jQuery(window).on('mouseup.domautoscroll touchend.domautoscroll', () => this.onUp());\n    jQuery(window).on('scroll.domautoscroll', (evt:any) => this.setScroll(evt));\n  }\n\n  public destroy() {\n    jQuery(window).off('.domautoscroll');\n\n    this.elements = [];\n    this.cleanAnimation();\n  }\n\n  public add(el:Element) {\n    this.elements.push(el);\n  }\n\n  public onUp() {\n    cancelAnimationFrame(this.animationFrame);\n    cancelAnimationFrame(this.windowAnimationFrame);\n  }\n\n  public setScroll(e:any) {\n    for (let i = 0; i < this.elements.length; i++) {\n      if (this.elements[i] === e.target) {\n        this.scrolling = true;\n        break;\n      }\n    }\n\n    if (this.scrolling) {\n      requestAnimationFrame(() => this.scrolling = false);\n    }\n  }\n\n  public cleanAnimation() {\n    cancelAnimationFrame(this.animationFrame);\n    cancelAnimationFrame(this.windowAnimationFrame);\n  }\n\n  public getTarget(target:HTMLElement):HTMLElement[] {\n    if (!target) {\n      return [];\n    }\n\n    let results = [];\n    if (this.elements.includes(target)) {\n      results.push(target);\n    }\n\n    let targetObject = target;\n    while (targetObject = targetObject.parentNode as HTMLElement) {\n      if (this.elements.includes(targetObject)) {\n        results.push(targetObject);\n      }\n    }\n\n    return results;\n  }\n\n  public getElementsUnderPoint():HTMLElement[] {\n    let underPoint = [];\n\n    for (var i = 0; i < this.elements.length; i++) {\n      if (this.inside(this.point, this.elements[i])) {\n        underPoint.push(this.elements[i] as HTMLElement);\n      }\n    }\n\n    return underPoint;\n  }\n\n  public onMove(event:any) {\n    if (!this.autoScroll()) {\n      return;\n    }\n\n    if (event.dispatched) {\n      return;\n    }\n\n    let target = [] as HTMLElement[];\n    if (event.target !== null) {\n      target.push(event.target as HTMLElement);\n    }\n    let body = document.body;\n\n    if (target.length > 0 && target[0].parentNode === body) {\n      //The special condition to improve speed.\n      target = this.getElementsUnderPoint();\n    } else {\n      target = this.getTarget(target[0]);\n\n      if (target.length === 0) {\n        target = this.getElementsUnderPoint();\n      }\n    }\n\n    this.current = target;\n\n    if (this.current.length === 0) {\n      this.current = [this.outerScrollContainer];\n    }\n\n    cancelAnimationFrame(this.animationFrame);\n    this.animationFrame = requestAnimationFrame(this.scrollTick.bind(this));\n  }\n\n  public setOuterScrollContainer(el:HTMLElement) {\n    this.outerScrollContainer = el;\n  }\n\n  public scrollTick() {\n    if (this.current.length === 0) {\n      return;\n    }\n\n    this.current.forEach((e?:Element) => {\n      if (e) {\n        this.scrollAutomatically(e);\n      }\n    });\n\n    cancelAnimationFrame(this.animationFrame);\n    this.animationFrame = requestAnimationFrame(this.scrollTick.bind(this));\n\n  }\n\n\n  public scrollAutomatically(el:Element) {\n    let rect = getRect(el);\n    let scrollx:number;\n    let scrolly:number;\n\n    if (this.point.x < rect.left + this.margin) {\n      scrollx = -this.maxSpeed;\n    } else if (this.point.x > rect.right - this.margin) {\n      scrollx = this.maxSpeed;\n    } else {\n      scrollx = 0;\n    }\n\n    if (this.point.y < rect.top + this.margin) {\n      scrolly = -this.maxSpeed;\n    } else if (this.point.y > rect.bottom - this.margin) {\n      scrolly = this.maxSpeed;\n    } else {\n      scrolly = 0;\n    }\n\n    setTimeout(() => {\n      if (scrolly) {\n        this.scrollY(el, scrolly);\n      }\n\n      if (scrollx) {\n        this.scrollX(el, scrollx);\n      }\n    });\n  }\n\n  public scrollY(el:any, amount:number) {\n    if (el === window) {\n      window.scrollTo(el.pageXOffset, el.pageYOffset + amount);\n    } else {\n      el.scrollTop += amount;\n    }\n  }\n\n  public scrollX(el:any, amount:number) {\n    if (el === window) {\n      window.scrollTo(el.pageXOffset + amount, el.pageYOffset);\n    } else {\n      el.scrollLeft += amount;\n    }\n  }\n\n  public inside(point:any, el:Element, rect?:any) {\n    if (!rect) {\n      return pointInside(point, el);\n    } else {\n      return (point.y > rect.top && point.y < rect.bottom &&\n        point.x > rect.left && point.x < rect.right);\n    }\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {RootResource} from 'core-app/modules/hal/resources/root-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {RootDmService} from 'core-app/modules/hal/dm-services/root-dm.service';\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {AngularTrackingHelpers} from 'core-components/angular/tracking-functions';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {HalResourceSortingService} from \"core-app/modules/hal/services/hal-resource-sorting.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\n\n@Component({\n  selector: 'filter-toggled-multiselect-value',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './filter-toggled-multiselect-value.component.html'\n})\nexport class FilterToggledMultiselectValueComponent implements OnInit, AfterViewInit {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new EventEmitter<QueryFilterInstanceResource>();\n\n  @ViewChild('ngSelectInstance', { static: true }) ngSelectInstance:NgSelectComponent;\n\n  public _availableOptions:HalResource[] = [];\n  public compareByHrefOrString = AngularTrackingHelpers.compareByHrefOrString;\n\n  private _isEmpty:boolean;\n\n  readonly text = {\n    placeholder: this.I18n.t('js.placeholders.selection'),\n  };\n\n  constructor(readonly RootDm:RootDmService,\n              readonly halResourceService:HalResourceService,\n              readonly halSorting:HalResourceSortingService,\n              readonly PathHelper:PathHelperService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n  }\n\n  ngOnInit() {\n    this.fetchAllowedValues();\n  }\n\n  ngAfterViewInit():void {\n    if (this.ngSelectInstance && this.shouldFocus) {\n      this.ngSelectInstance.focus();\n    }\n  }\n\n  public get value() {\n    return this.filter.values;\n  }\n\n  public setValues(val:any) {\n    this.filter.values = _.castArray(val);\n    this.filterChanged.emit(this.filter);\n    this.cdRef.detectChanges();\n  }\n\n  public get availableOptions() {\n    return this._availableOptions;\n  }\n\n  public set availableOptions(val:HalResource[]) {\n    this._availableOptions = this.halSorting.sort(val);\n  }\n\n  public get isEmpty():boolean {\n    return this._isEmpty = this.value.length === 0;\n  }\n\n  public repositionDropdown() {\n    if (this.ngSelectInstance) {\n      setTimeout(() => {\n        const component = (this.ngSelectInstance) as any;\n        if (component && component.dropdownPanel) {\n          component.dropdownPanel._updatePosition();\n        }\n      }, 25);\n    }\n  }\n\n  private get isUserResource() {\n    let type = _.get(this.filter.currentSchema, 'values.type', null);\n    return type && type.indexOf('User') > 0;\n  }\n\n  private fetchAllowedValues() {\n    if ((this.filter.currentSchema!.values!.allowedValues as CollectionResource)['$load']) {\n      this.loadAllowedValues();\n    } else {\n      this.availableOptions = (this.filter.currentSchema!.values!.allowedValues as HalResource[]);\n    }\n  }\n\n  private loadAllowedValues() {\n    let valuesSchema = this.filter.currentSchema!.values!;\n    let loadingPromises = [(valuesSchema.allowedValues as any).$load()];\n\n    // If it is a User resource, we want to have the 'me' option.\n    // We therefore fetch the current user from the api and copy\n    // the current user's value from the set of allowedValues. The\n    // copy will have it's name altered to 'me' and will then be\n    // prepended to the list.\n    if (this.isUserResource) {\n      loadingPromises.push(this.RootDm.load());\n    }\n\n    Promise.all(loadingPromises)\n      .then(((resources:Array<HalResource>) => {\n        let options = (resources[0] as CollectionResource).elements;\n\n        this.availableOptions = options;\n\n        if (this.isUserResource && this.filter.filter.id !== 'memberOfGroup') {\n          this.addMeValue((resources[1] as RootResource).user);\n        }\n      }));\n  }\n\n  private addMeValue(currentUser:UserResource) {\n    if (!(currentUser && currentUser.$href)) {\n      return;\n    }\n\n    let me:HalResource = this.halResourceService.createHalResource(\n      {\n        _links: {\n          self: {\n            href: this.PathHelper.api.v3.users.me,\n            title: this.I18n.t('js.label_me')\n          }\n        }\n      }, true\n    );\n\n    this._availableOptions.unshift(me);\n  }\n}\n","<div class=\"inline-label ng-select-container\"\n     id=\"div-values-{{filter.id}}\">\n\n  <ng-select #ngSelectInstance\n             [ngModel]=\"filter.values\"\n             (change)=\"setValues($event)\"\n             (add)=\"repositionDropdown()\"\n             (remove)=\"repositionDropdown()\"\n             (open)=\"repositionDropdown()\"\n             [compareWith]=\"compareByHrefOrString\"\n             [clearSearchOnAdd]=\"true\"\n             [placeholder]=\"text.placeholder\"\n             [ngClass]=\"{'-required-highlighting' : isEmpty}\"\n             class=\"advanced-filters--ng-select -multi-select\"\n             [id]=\"'values-' + filter.id\"\n             [items]=\"availableOptions\"\n             [multiple]=\"true\"\n             [closeOnSelect]=\"false\"\n             [hideSelected]=\"true\"\n             appendTo=\"body\"\n             bindLabel=\"name\"\n             [virtualScroll]=\"true\">\n  </ng-select>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {StateService} from '@uirouter/core';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\n\nexport class WorkPackageAuthorization {\n\n  public project:any;\n\n  constructor(public workPackage:WorkPackageResource,\n              readonly PathHelper:PathHelperService,\n              readonly $state:StateService) {\n    this.project = workPackage.project;\n  }\n\n  public get allActions():any {\n    return {\n      workPackage: this.workPackage,\n      project: this.project\n    };\n  }\n\n  public copyLink() {\n    const stateName = this.$state.current.name as string;\n    if (stateName.indexOf('work-packages.partitioned.list.details') === 0) {\n      return this.PathHelper.workPackageDetailsCopyPath(this.project.identifier, this.workPackage.id!);\n    } else {\n      return this.PathHelper.workPackageCopyPath(this.workPackage.id!);\n    }\n  }\n\n  public linkForAction(action:any) {\n    if (action.key === 'copy') {\n      action.link = this.copyLink();\n    }\n    else {\n      action.link = this.allActions[action.resource][action.link].href;\n    }\n\n    return action;\n  }\n\n  public isPermitted(action:any) {\n    return this.allActions[action.resource] !== undefined &&\n      this.allActions[action.resource][action.link] !== undefined;\n  }\n\n  public permittedActionKeys(allowedActions:any) {\n    var validActions = _.filter(allowedActions, (action:any) => this.isPermitted(action));\n\n    return _.map(validActions, function (action:any) {\n      return action.key;\n    });\n  }\n\n  public permittedActionsWithLinks(allowedActions:any) {\n    var validActions = _.filter(_.cloneDeep(allowedActions), (action:any) => this.isPermitted(action));\n\n    var allowed = _.map(validActions, (action:any) => this.linkForAction(action));\n\n    return allowed;\n  }\n}\n","import {Directive, ElementRef, Injector, Input} from '@angular/core';\nimport {StateService} from '@uirouter/core';\nimport {LinkHandling} from 'core-app/modules/common/link-handling/link-handling';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HookService} from 'core-app/modules/plugins/hook-service';\nimport {WpDestroyModal} from 'core-components/modals/wp-destroy-modal/wp-destroy.modal';\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {OpContextMenuItem} from 'core-components/op-context-menu/op-context-menu.types';\nimport {PERMITTED_CONTEXT_MENU_ACTIONS} from 'core-components/op-context-menu/wp-context-menu/wp-static-context-menu-actions';\nimport {OpModalService} from 'core-components/op-modals/op-modal.service';\nimport {WorkPackageAuthorization} from 'core-components/work-packages/work-package-authorization.service';\nimport {WorkPackageAction} from 'core-components/wp-table/context-menu-helper/wp-context-menu-helper.service';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {TimeEntryCreateService} from \"core-app/modules/time_entries/create/create.service\";\n\n@Directive({\n  selector: '[wpSingleContextMenu]'\n})\nexport class WorkPackageSingleContextMenuDirective extends OpContextMenuTrigger {\n  @Input('wpSingleContextMenu-workPackage') public workPackage:WorkPackageResource;\n\n  @InjectField() public timeEntryCreateService:TimeEntryCreateService;\n\n  constructor(readonly HookService:HookService,\n              readonly $state:StateService,\n              readonly injector:Injector,\n              readonly PathHelper:PathHelperService,\n              readonly elementRef:ElementRef,\n              readonly opModalService:OpModalService,\n              readonly opContextMenuService:OPContextMenuService,\n              readonly authorisationService:AuthorisationService) {\n    super(elementRef, opContextMenuService);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.workPackage.project.$load().then(() => {\n      this.authorisationService.initModelAuth('work_package', this.workPackage.$links);\n\n      var authorization = new WorkPackageAuthorization(this.workPackage, this.PathHelper, this.$state);\n      const permittedActions = this.getPermittedActions(authorization);\n\n      this.buildItems(permittedActions);\n      this.opContextMenu.show(this, evt);\n    });\n  }\n\n  public triggerContextMenuAction(action:WorkPackageAction, key:string) {\n    const link = action.link;\n\n    switch (key) {\n      case 'copy':\n        this.$state.go('work-packages.copy', { copiedFromWorkPackageId: this.workPackage.id });\n        break;\n      case 'delete':\n        this.opModalService.show(WpDestroyModal, this.injector, { workPackages: [this.workPackage] });\n        break;\n      case 'log_time':\n        this.timeEntryCreateService\n          .create(moment(new Date()), this.workPackage, false)\n          .catch(() => {\n            // do nothing, the user closed without changes\n          });\n        break;\n\n      default:\n        window.location.href = link!;\n        break;\n    }\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let additionalPositionArgs = {\n      my: 'right top',\n      at: 'right bottom'\n    };\n\n    let position = super.positionArgs(evt);\n    _.assign(position, additionalPositionArgs);\n\n    return position;\n  }\n\n  private getPermittedActions(authorization:WorkPackageAuthorization) {\n    let actions:WorkPackageAction[] = authorization.permittedActionsWithLinks(PERMITTED_CONTEXT_MENU_ACTIONS);\n\n    // Splice plugin actions onto the core actions\n    _.each(this.getPermittedPluginActions(authorization), (action:WorkPackageAction) => {\n      let index = action.indexBy ? action.indexBy(actions) : actions.length;\n      actions.splice(index, 0, action);\n    });\n\n    return actions;\n  }\n\n  private getPermittedPluginActions(authorization:WorkPackageAuthorization) {\n    let actions:WorkPackageAction[] = this.HookService.call('workPackageSingleContextMenu');\n    return authorization.permittedActionsWithLinks(actions);\n  }\n\n  protected buildItems(permittedActions:WorkPackageAction[]):OpContextMenuItem[] {\n    const configureFormLink = this.workPackage.configureForm;\n\n    this.items = permittedActions.map((action:WorkPackageAction) => {\n      const key = action.key;\n      return {\n        disabled: false,\n        linkText: I18n.t('js.button_' + key),\n        href: action.link,\n        icon: action.icon || `icon-${key}`,\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (action.link && LinkHandling.isClickedWithModifier($event)) {\n            return false;\n          }\n\n          this.triggerContextMenuAction(action, key);\n          return true;\n        }\n      };\n    });\n\n    if (configureFormLink) {\n      this.items.push(\n        {\n          href: configureFormLink.href,\n          icon: 'icon-settings3',\n          linkText: I18n.t('js.button_configure-form'),\n          onClick: () => false\n        }\n      );\n    }\n\n    return this.items;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport flatpickr from \"flatpickr\";\nimport {Instance} from \"flatpickr/dist/types/instance\";\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport DateOption = flatpickr.Options.DateOption;\n\nexport class DatePicker {\n  private datepickerFormat = 'Y-m-d';\n\n  private datepickerCont:JQuery = jQuery(this.datepickerElemIdentifier);\n  public datepickerInstance:Instance;\n\n  constructor(private datepickerElemIdentifier:string,\n              private date:any,\n              private options:any,\n              private datepickerTarget?:HTMLElement,\n              private configurationService?:ConfigurationService) {\n    this.initialize(options);\n  }\n\n  private initialize(options:any) {\n    const I18n = new I18nService();\n    const firstDayOfWeek =\n      this.configurationService?.startOfWeekPresent() ? this.configurationService.startOfWeek() : 1;\n\n    const mergedOptions = _.extend({}, options, {\n      weekNumbers: true,\n      dateFormat: this.datepickerFormat,\n      defaultDate: this.date,\n      locale: {\n        weekdays: {\n          shorthand: I18n.t('date.abbr_day_names'),\n          longhand: I18n.t('date.day_names'),\n        },\n        months: {\n          shorthand: (I18n.t('date.abbr_month_names') as any).slice(1),\n          longhand: (I18n.t('date.month_names') as any).slice(1),\n        },\n        firstDayOfWeek: firstDayOfWeek,\n        weekAbbreviation: I18n.t('date.abbr_week')\n      },\n    });\n\n    var datePickerInstances:Instance|Instance[];\n    if (this.datepickerTarget) {\n      datePickerInstances = flatpickr(this.datepickerTarget as Node, mergedOptions);\n    } else {\n      datePickerInstances = flatpickr(this.datepickerElemIdentifier, mergedOptions);\n    }\n\n    this.datepickerInstance = Array.isArray(datePickerInstances) ? datePickerInstances[0] : datePickerInstances;\n  }\n\n  public clear() {\n    this.datepickerInstance.clear();\n  }\n\n  public destroy() {\n    this.hide();\n    this.datepickerInstance.destroy();\n  }\n\n  public hide() {\n    if (this.isOpen) {\n      this.datepickerInstance.close();\n    }\n\n    this.datepickerCont.scrollParent().off('scroll');\n  }\n\n  public show() {\n    this.datepickerInstance.open();\n    this.hideDuringScroll();\n  }\n\n  public setDates(dates:DateOption|DateOption[]) {\n    this.datepickerInstance.setDate(dates);\n  }\n\n  public get isOpen():boolean {\n    return this.datepickerInstance.isOpen;\n  }\n\n  private hideDuringScroll() {\n    let reshowTimeout:any = null;\n    let scrollParent = this.datepickerCont.scrollParent();\n\n    scrollParent.scroll(() => {\n      this.datepickerInstance.close();\n      if (reshowTimeout) {\n        clearTimeout(reshowTimeout);\n      }\n\n      reshowTimeout = setTimeout(() => {\n        if (this.visibleAndActive()) {\n          this.datepickerInstance.open();\n        }\n      }, 50);\n    });\n  }\n\n  private visibleAndActive() {\n    var input = this.datepickerCont;\n\n    try {\n      return document.elementFromPoint(input.offset()!.left, input.offset()!.top) === input[0] &&\n        document.activeElement === input[0];\n    } catch (e) {\n      console.error(\"Failed to test visibleAndActive \" + e)\n      return false;\n    }\n  };\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\n\nexport class GridWidgetResource extends HalResource {\n  public identifier:string;\n  public startRow:number;\n  public endRow:number;\n  public startColumn:number;\n  public endColumn:number;\n\n  public options:{[key:string]:unknown};\n\n  public get height() {\n    return this.endRow - this.startRow;\n  }\n\n  public get width() {\n    return this.endColumn - this.startColumn;\n  }\n\n  public grid:GridResource;\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ErrorResource} from 'core-app/modules/hal/resources/error-resource';\nimport {StateService} from '@uirouter/core';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable, Injector} from '@angular/core';\nimport {LoadingIndicatorService} from 'core-app/modules/common/loading-indicator/loading-indicator.service';\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HttpErrorResponse} from \"@angular/common/http\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Injectable()\nexport class HalResourceNotificationService {\n\n  @InjectField() protected I18n:I18nService;\n  @InjectField() protected $state:StateService;\n  @InjectField() protected halResourceService:HalResourceService;\n  @InjectField() protected NotificationsService:NotificationsService;\n  @InjectField() protected loadingIndicator:LoadingIndicatorService;\n\n  constructor(public injector:Injector) {\n  }\n\n  public showSave(resource:HalResource, isCreate:boolean = false) {\n    let message:any = {\n      message: this.I18n.t('js.notice_successful_' + (isCreate ? 'create' : 'update')),\n    };\n\n    this.NotificationsService.addSuccess(message);\n  }\n\n  /**\n   * Handle any kind of error response:\n   * - HAL ErrorResources\n   * - Angular HttpErrorResponses\n   * - Older .data error responses\n   * - String error messages\n   *\n   * @param response\n   * @param resource\n   */\n  public handleRawError(response:unknown, resource?:HalResource) {\n    console.error(\"Handling error message %O for work package %O\", response, resource);\n\n    // Some transformation may already have returned the error as a HAL resource,\n    // which we will forward to handleErrorResponse\n    if (response instanceof ErrorResource) {\n      return this.handleErrorResponse(response, resource);\n    }\n\n    const errorBody = this.retrieveError(response);\n\n    if (errorBody instanceof HalResource) {\n      return this.handleErrorResponse(errorBody, resource);\n    }\n\n    if (typeof (response) === 'string') {\n      this.NotificationsService.addError(response);\n      return;\n    }\n\n    this.showGeneralError(errorBody || response);\n  }\n\n  /**\n   * Retrieve an error message string from the given unknown response.\n   * @param response\n   */\n  public retrieveErrorMessage(response:unknown):string {\n    const error = this.retrieveError(response);\n\n    if (error instanceof ErrorResource) {\n      return error.message;\n    }\n\n    if (typeof (error) === 'string') {\n      return error;\n    }\n\n    return this.I18n.t('js.error.internal');\n  }\n\n  public retrieveError(response:unknown):ErrorResource|unknown {\n    // we try to detect what we got, this may either be an HttpErrorResponse,\n    // some older XHR response object or a string\n    let errorBody:any = response;\n\n    // Angular http response have an error body attribute\n    if (response instanceof HttpErrorResponse) {\n      errorBody = response.message || response.error;\n    }\n\n    // Some older response may have a data attribute\n    if (_.get(response, 'data._type') === 'Error') {\n      errorBody = (response as any).data;\n    }\n\n    if (errorBody && errorBody._type === 'Error') {\n      return this.halResourceService.createHalResourceOfClass(ErrorResource, errorBody);\n    }\n\n    return errorBody;\n  }\n\n  protected handleErrorResponse(errorResource:any, resource?:HalResource) {\n    if (!(errorResource instanceof ErrorResource)) {\n      return this.showGeneralError(errorResource);\n    }\n\n    if (resource) {\n      return this.showError(errorResource, resource);\n    }\n\n    this.showApiErrorMessages(errorResource);\n  }\n\n  public showError(errorResource:any, resource:HalResource) {\n    this.showCustomError(errorResource, resource) || this.showApiErrorMessages(errorResource);\n  }\n\n  public showGeneralError(message?:unknown) {\n    let error = this.I18n.t('js.error.internal');\n\n    if (typeof (message) === 'string' || _.has(message, 'toString')) {\n      error += ' ' + (message as any).toString();\n    }\n\n    this.NotificationsService.addError(error);\n  }\n\n  public showEditingBlockedError(attribute:string) {\n    this.NotificationsService.addError(this.I18n.t(\n      'js.hal.error.edit_prohibited',\n      {attribute: attribute}\n    ));\n  }\n\n  protected showCustomError(errorResource:any, resource:HalResource) {\n\n    if (errorResource.errorIdentifier === 'urn:openproject-org:api:v3:errors:PropertyFormatError') {\n\n      let attributeName = resource.schema[errorResource.details.attribute].name;\n      let attributeType = resource.schema[errorResource.details.attribute].type.toLowerCase();\n      let i18nString = 'js.hal.error.format.' + attributeType;\n\n      if (this.I18n.lookup(i18nString) === undefined) {\n        return false;\n      }\n\n      this.NotificationsService.addError(this.I18n.t(i18nString,\n        {attribute: attributeName}));\n\n      return true;\n    }\n    return false;\n  }\n\n  protected showApiErrorMessages(errorResource:any) {\n    let messages = errorResource.errorMessages;\n\n    if (messages.length > 1) {\n      this.NotificationsService.addError('', messages);\n    } else {\n      this.NotificationsService.addError(messages[0]);\n    }\n\n    return true;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {AbstractDmService} from \"core-app/modules/hal/dm-services/abstract-dm.service\";\nimport {MembershipResource} from \"core-app/modules/hal/resources/membership-resource\";\nimport {DmListParameter} from \"core-app/modules/hal/dm-services/dm.service.interface\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\n\n@Injectable()\nexport class MembershipDmService extends AbstractDmService<MembershipResource> {\n  public listAvailableProjects(params:DmListParameter|null) {\n    return this.listRequest(this.availableProjectsUrl(), params) as Promise<CollectionResource<ProjectResource>>;\n  }\n\n  protected listUrl() {\n    return this.pathHelper.api.v3.memberships.toString();\n  }\n\n  protected oneUrl(id:number|string) {\n    return this.pathHelper.api.v3.memberships.id(id).toString();\n  }\n\n  protected availableProjectsUrl() {\n    return this.pathHelper.api.v3.memberships.available_projects.toString();\n  }\n}\n","import {AfterViewInit, Directive, ElementRef} from \"@angular/core\";\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {OpContextMenuHandler} from \"core-components/op-context-menu/op-context-menu-handler\";\nimport {OpContextMenuItem} from \"core-components/op-context-menu/op-context-menu.types\";\n\n@Directive({\n  selector: '[opContextMenuTrigger]'\n})\nexport class OpContextMenuTrigger extends OpContextMenuHandler implements AfterViewInit {\n  protected $element:JQuery;\n  protected items:OpContextMenuItem[] = [];\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService) {\n    super(opContextMenu);\n  }\n\n  ngAfterViewInit():void {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    // Open by clicking the element\n    this.$element.on('click', (evt:JQuery.TriggeredEvent) => {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      // When clicking the same trigger twice, close the element instead.\n      if (this.opContextMenu.isActive(this)) {\n        this.opContextMenu.close();\n        return false;\n      }\n\n      this.open(evt);\n      return false;\n    });\n\n    // Open with keyboard combination as well\n    Mousetrap(this.$element[0]).bind('shift+alt+f10', (evt:any) => {\n      this.open(evt);\n    });\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(openerEvent:JQuery.TriggeredEvent) {\n    return {\n      my: 'left top',\n      at: 'left bottom',\n      of: this.$element,\n      collision: 'flipfit'\n    };\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport namespace OpenprojectHalModuleHelpers {\n  export function lazy(obj:HalResource,\n                       property:string,\n                       getter:{ ():any },\n                       setter?:{ (value:any):void }):void {\n\n    if (_.isObject(obj)) {\n      let done = false;\n      let value:any;\n      let config:any = {\n        get() {\n          if (!done) {\n            value = getter();\n            done = true;\n          }\n          return value;\n        },\n        set: ():void => undefined,\n\n        configurable: true,\n        enumerable: true\n      };\n\n      if (setter) {\n        config.set = (val:any) => {\n          value = setter(val);\n          done = true;\n        };\n      }\n\n      Object.defineProperty(obj, property, config);\n    }\n  }\n}\n","import {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {OpenprojectHalModuleHelpers} from 'core-app/modules/hal/helpers/lazy-accessor';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {HalLink} from 'core-app/modules/hal/hal-link/hal-link';\n\nconst ObservableArray:any = require('observable-array');\n\ninterface HalSource {\n  _links:any;\n  _embedded:any;\n  _type?:string;\n  type?:any;\n}\n\nexport function cloneHalResourceCollection<T extends HalResource>(values:T[]|undefined):T[] {\n  if (_.isNil(values)) {\n    return [];\n  } else {\n    return values.map(v => v.$copy<T>());\n  }\n}\n\nexport function cloneHalResource<T extends HalResource>(value:T|undefined):T|undefined {\n  if (_.isNil(value)) {\n    return value;\n  } else {\n    return value.$copy<T>();\n  }\n}\n\nexport function initializeHalProperties<T extends HalResource>(halResourceService:HalResourceService, halResource:T) {\n  setSource();\n  setupLinks();\n  setupEmbedded();\n  proxyProperties();\n  setLinksAsProperties();\n  setEmbeddedAsProperties();\n\n  function setSource() {\n    if (!halResource.$source._links) {\n      halResource.$source._links = {};\n    }\n\n    if (!halResource.$source._links.self) {\n      halResource.$source._links.self = { href: null };\n    }\n  }\n\n  function asHalResource(value?:HalSource, loaded:boolean = true):HalResource|HalSource|undefined|null {\n    if (_.isNil(value)) {\n      return value;\n    }\n\n    if (value._links || value._embedded || value._type) {\n      return halResourceService.createHalResource(value, loaded);\n    }\n\n    return value;\n  }\n\n  function proxyProperties() {\n    halResource.$embeddableKeys().forEach((property:any) => {\n      Object.defineProperty(halResource, property, {\n        get() {\n          const value = halResource.$source[property];\n          return asHalResource(value, true);\n        },\n\n        set(value) {\n          halResource.$source[property] = value;\n        },\n\n        enumerable: true,\n        configurable: true\n      });\n    });\n  }\n\n  function setLinksAsProperties() {\n    halResource.$linkableKeys().forEach((linkName:string) => {\n      OpenprojectHalModuleHelpers.lazy(halResource, linkName,\n        () => {\n          const link:any = halResource.$links[linkName].$link || halResource.$links[linkName];\n\n          if (Array.isArray(link)) {\n            var items = link.map(item => halResourceService.createLinkedResource(halResource,\n              linkName,\n              item.$link));\n            var property:HalResource[] = new ObservableArray(...items).on('change', () => {\n              property.forEach(item => {\n                if (!item.$link) {\n                  property.splice(property.indexOf(item), 1);\n                }\n              });\n\n              halResource.$source._links[linkName] = property.map(item => item.$link);\n            });\n\n            return property;\n          }\n\n          if (link.href) {\n            if (link.method !== 'get') {\n              return HalLink.fromObject(halResourceService, link).$callable();\n            }\n\n            return halResourceService.createLinkedResource(halResource, linkName, link);\n          }\n\n          return null;\n        },\n        (val:any) => setter(val, linkName)\n      );\n    });\n  }\n\n  function setEmbeddedAsProperties() {\n    if (!halResource.$source._embedded) {\n      return;\n    }\n\n    Object.keys(halResource.$source._embedded).forEach(name => {\n      OpenprojectHalModuleHelpers.lazy(halResource,\n        name,\n        () => halResource.$embedded[name],\n        (val:any) => setter(val, name));\n    });\n  }\n\n  function setupProperty(name:string, callback:(element:any) => any) {\n    const instanceName = '$' + name;\n    const sourceName = '_' + name;\n    const sourceObj:any = halResource.$source[sourceName];\n\n    if (_.isObject(sourceObj)) {\n      Object.keys(sourceObj).forEach(propName => {\n        OpenprojectHalModuleHelpers.lazy((halResource)[instanceName],\n          propName,\n          () => callback((sourceObj as any)[propName]));\n      });\n    }\n  }\n\n  function setupLinks() {\n    setupProperty('links',\n      (link) => {\n        if (Array.isArray(link)) {\n          return link.map(l => HalLink.fromObject(halResourceService, l).$callable());\n        } else {\n          return HalLink.fromObject(halResourceService, link).$callable();\n        }\n      });\n  }\n\n  function setupEmbedded() {\n    setupProperty('embedded', (element:any) => {\n\n      if (Array.isArray(element)) {\n        return element.map((source) => asHalResource(source, true));\n      }\n\n      if (_.isObject(element)) {\n        _.each(element, (child:any, name:string) => {\n          if (child && (child._embedded || child._links)) {\n            OpenprojectHalModuleHelpers.lazy(element as any,\n              name,\n              () => asHalResource(child, true));\n          }\n        });\n      }\n\n      return asHalResource(element, true);\n    });\n  }\n\n  function setter(val:HalResource[]|HalResource|{ href?:string }, linkName:string) {\n    const isArray = Array.isArray(val);\n\n    if (!val) {\n      halResource.$source._links[linkName] = { href: null };\n    } else if (isArray) {\n      halResource.$source._links[linkName] = (val as HalResource[]).map((el:any) => {\n        return { href: el.href };\n      });\n    } else if (val.hasOwnProperty('$link')) {\n      const link = (val as HalResource).$link;\n\n      if (link.href) {\n        halResource.$source._links[linkName] = link;\n      }\n    } else if ('href' in val) {\n      halResource.$source._links[linkName] = { href: val.href };\n    }\n\n    if (halResource.$embedded && halResource.$embedded[linkName]) {\n      halResource.$embedded[linkName] = val;\n\n      if (isArray) {\n        halResource.$source._embedded[linkName] = (val as HalResource[]).map(el => el.$source);\n      } else {\n        halResource.$source._embedded[linkName] = _.get(val, '$source', val);\n      }\n    }\n\n    return val;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {StateService, Transition, TransitionService} from '@uirouter/core';\nimport {ReplaySubject} from 'rxjs';\nimport {Injectable} from \"@angular/core\";\n\n@Injectable()\nexport class KeepTabService {\n  protected currentTab:string = 'overview';\n\n  protected subject = new ReplaySubject<{ [tab:string]:string; }>(1);\n\n  constructor(protected $state:StateService,\n              protected $transitions:TransitionService) {\n\n    this.updateTabs();\n    $transitions.onSuccess({}, (transition:Transition) => {\n      this.updateTabs(transition.to().name);\n    });\n  }\n\n  public get observable() {\n    return this.subject;\n  }\n\n  /**\n   * Return the last active tab.\n   */\n  public get lastActiveTab():string {\n    if (this.isCurrentState('show')) {\n      return this.currentShowTab;\n    }\n\n    return this.currentDetailsTab;\n  }\n\n  public get currentShowState():string {\n    return 'work-packages.show.' + this.currentShowTab;\n  }\n\n  public get currentDetailsState():string {\n    return 'work-packages.partitioned.list.details.' + this.currentDetailsTab;\n  }\n\n  public isDetailsState(stateName:string) {\n    return stateName === 'work-packages.partitioned.list.details';\n  }\n\n  public get currentShowTab():string {\n    // Show view doesn't have overview\n    // use activity instead\n    if (this.currentTab === 'overview') {\n      return 'activity';\n    }\n\n    return this.currentTab;\n  }\n\n  public get currentDetailsTab():string {\n    return this.currentTab;\n  }\n\n  protected notify() {\n    // Notify when updated\n    this.subject.next({\n      active: this.lastActiveTab,\n      show: this.currentShowState,\n      details: this.currentDetailsState\n    });\n  }\n\n  protected updateTab(stateName:string) {\n    if (this.isCurrentState(stateName)) {\n      const current = this.$state.current.name as string;\n      this.currentTab = (current.split('.') as any[]).pop();\n\n      this.notify();\n    }\n  }\n\n  protected isCurrentState(stateName:string):boolean {\n    if (stateName === 'show') {\n      return this.$state.includes('work-packages.show.*');\n    }\n\n    if (stateName === 'details') {\n      return this.$state.includes('work-packages.partitioned.list.details.*');\n    }\n\n    return false;\n  }\n\n  public updateTabs(stateName?:string) {\n\n    // Ignore the switch from show#activity to details#activity\n    // and show details#overview instead\n\n    if (stateName === 'work-packages.show.activity') {\n      this.currentTab = 'overview';\n      return this.notify();\n    }\n\n    this.updateTab('show');\n    this.updateTab('details');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\nimport {QueryResource, TimelineLabels, TimelineZoomLevel} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {input} from 'reactivestates';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {WorkPackageTimelineState} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-timeline\";\nimport {zoomLevelOrder} from \"core-components/wp-table/timeline/wp-timeline\";\n\n@Injectable()\nexport class WorkPackageViewTimelineService extends WorkPackageQueryStateService<WorkPackageTimelineState> {\n\n  /** Remember the computed zoom level to correct zooming after leaving autozoom */\n  public appliedZoomLevel$ = input<TimelineZoomLevel>('auto');\n\n  public constructor(protected readonly querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  public valueFromQuery(query:QueryResource) {\n    return {\n      ...this.defaultState,\n      visible: query.timelineVisible,\n      zoomLevel: query.timelineZoomLevel,\n      labels: query.timelineLabels\n    };\n  }\n\n  public set appliedZoomLevel(val:TimelineZoomLevel) {\n    this.appliedZoomLevel$.putValue(val);\n  }\n\n  public get appliedZoomLevel() {\n    return this.appliedZoomLevel$.value!;\n  }\n\n  public hasChanged(query:QueryResource) {\n    const visibilityChanged = this.isVisible !== query.timelineVisible;\n    const zoomLevelChanged = this.zoomLevel !== query.timelineZoomLevel;\n    const labelsChanged = !_.isEqual(this.current.labels, query.timelineLabels);\n\n    return visibilityChanged || zoomLevelChanged || labelsChanged;\n  }\n\n  public applyToQuery(query:QueryResource) {\n    query.timelineVisible = this.isVisible;\n    query.timelineZoomLevel = this.zoomLevel;\n    query.timelineLabels = this.current.labels;\n\n    return false;\n  }\n\n  public toggle() {\n    let currentState = this.current;\n    this.setVisible(!currentState.visible);\n  }\n\n  public setVisible(value:boolean) {\n    this.updatesState.putValue({...this.current, visible: value});\n  }\n\n  public get isVisible() {\n    return this.current.visible;\n  }\n\n  public get zoomLevel() {\n    return this.current.zoomLevel;\n  }\n\n  public get labels() {\n    if (_.isEmpty(this.current.labels)) {\n      return this.defaultLabels;\n    }\n\n    return this.current.labels;\n  }\n\n  public updateLabels(labels:TimelineLabels) {\n    this.modify({ labels: labels });\n  }\n\n  public getNormalizedLabels(workPackage:WorkPackageResource) {\n    let labels:TimelineLabels = this.defaultLabels;\n\n    _.each(this.current.labels, (attribute:string | null, positionAsString:string) => {\n      // RR: Lodash typings declare the position as string. However, it is save to cast\n      // to `keyof TimelineLabels` because `this.current.labels` is of type TimelineLabels.\n      const position:keyof TimelineLabels = positionAsString as keyof TimelineLabels;\n\n      // Set to null to explicitly disable\n      if (attribute === '') {\n        labels[position] = null;\n      } else {\n        labels[position] = attribute;\n      }\n    });\n\n    return labels;\n  }\n\n  public setZoomLevel(level:TimelineZoomLevel) {\n    this.modify({ zoomLevel: level });\n  }\n\n  public updateZoomWithDelta(delta:number):void {\n    let level = this.current.zoomLevel;\n    if (level !== 'auto') {\n      return this.applyZoomLevel(level, delta);\n    }\n\n    const applied = this.appliedZoomLevel;\n    if (applied && applied !== 'auto') {\n      // When we have a real zoom value, use delta on that one\n      this.applyZoomLevel(applied, delta);\n    } else {\n      // Use the maximum zoom value\n      const target = delta < 0 ? 'days' : 'years';\n      this.setZoomLevel(target);\n    }\n  }\n\n  public isAutoZoom():boolean {\n    return this.current.zoomLevel === 'auto';\n  }\n\n  public enableAutozoom() {\n    this.modify({ zoomLevel: \"auto\" });\n  }\n\n  public get current():WorkPackageTimelineState {\n    return this.lastUpdatedState.getValueOr(this.defaultState);\n  }\n\n  /**\n   * Modify the state, updating with parts of properties\n   * @param update\n   */\n  private modify(update:Partial<WorkPackageTimelineState>) {\n    this.update({ ...this.current, ...update } as WorkPackageTimelineState);\n  }\n\n  /**\n   * Apply a zoom level\n   *\n   * @param level Any zoom level except auto.\n   * @param delta The delta (e.g., 1, -1) to apply.\n   */\n  private applyZoomLevel(level:Exclude<TimelineZoomLevel, 'auto'>, delta:number) {\n    let idx = zoomLevelOrder.indexOf(level);\n    idx += delta;\n\n    if (idx >= 0 && idx < zoomLevelOrder.length) {\n      this.setZoomLevel(zoomLevelOrder[idx]);\n    }\n  }\n\n  private get defaultLabels():TimelineLabels {\n    return {\n      left: '',\n      right: '',\n      farRight: 'subject'\n    };\n  }\n\n  private get defaultState():WorkPackageTimelineState {\n    return {\n      zoomLevel: 'auto',\n      visible: false,\n      labels: this.defaultLabels\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({ providedIn: 'root' })\nexport class ColorsService {\n  public toHsl(value:string) {\n    return `hsl(${this.valueHash(value)}, 50%, 50%)`;\n  }\n\n  public toHsla(value:string, opacity:number) {\n    return `hsla(${this.valueHash(value)}, 50%, 50%, ${opacity}%)`;\n  }\n\n  protected valueHash(value:string) {\n    let hash = 0;\n    for (let i = 0; i < value.length; i++) {\n      hash = value.charCodeAt(i) + ((hash << 5) - hash);\n    }\n\n    return hash % 360;\n  }\n}","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component, Injector, OnInit} from '@angular/core';\nimport {StateService} from '@uirouter/core';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {States} from \"core-components/states.service\";\nimport {FirstRouteService} from \"core-app/modules/router/first-route-service\";\nimport {KeepTabService} from \"core-components/wp-single-view-tabs/keep-tab/keep-tab.service\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageSingleViewBase} from \"core-app/modules/work_packages/routing/wp-view-base/work-package-single-view.base\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {BackRoutingService} from \"core-app/modules/common/back-routing/back-routing.service\";\n\n@Component({\n  templateUrl: './wp-split-view.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-split-view-entry',\n  providers: [\n    { provide: HalResourceNotificationService, useClass: WorkPackageNotificationService }\n  ]\n})\nexport class WorkPackageSplitViewComponent extends WorkPackageSingleViewBase implements OnInit {\n\n  /** Reference to the base route e.g., work-packages.partitioned.list or bim.partitioned.split */\n  private baseRoute:string = this.$state.current.data.baseRoute;\n\n  constructor(public injector:Injector,\n              public states:States,\n              public firstRoute:FirstRouteService,\n              public keepTab:KeepTabService,\n              public wpTableSelection:WorkPackageViewSelectionService,\n              public wpTableFocus:WorkPackageViewFocusService,\n              readonly $state:StateService,\n              readonly backRouting:BackRoutingService) {\n    super(injector, $state.params['workPackageId']);\n  }\n\n  ngOnInit():void {\n    this.observeWorkPackage();\n\n    let wpId = this.$state.params['workPackageId'];\n    let focusedWP = this.wpTableFocus.focusedWorkPackage;\n\n    if (!focusedWP) {\n      // Focus on the work package if we're the first route\n      const isFirstRoute = this.firstRoute.name === `${this.baseRoute}.details.overview`;\n      const isSameID = this.firstRoute.params && wpId === this.firstRoute.params.workPackageI;\n      this.wpTableFocus.updateFocus(wpId, (isFirstRoute && isSameID));\n    } else {\n      this.wpTableFocus.updateFocus(wpId, false);\n    }\n\n    if (this.wpTableSelection.isEmpty) {\n      this.wpTableSelection.setRowState(wpId, true);\n    }\n\n    this.wpTableFocus.whenChanged()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(newId => {\n        const idSame = wpId.toString() === newId.toString();\n        if (!idSame && this.$state.includes(`${this.baseRoute}.details`)) {\n          this.$state.go(\n            (this.$state.current.name as string),\n            { workPackageId: newId, focus: false }\n          );\n        }\n      });\n  }\n\n\n  public close() {\n    this.$state.go(this.baseRoute, this.$state.params);\n  }\n\n  public switchToFullscreen() {\n    this.$state.go(this.keepTab.currentShowState, this.$state.params);\n  }\n\n  public get shouldFocus() {\n    return this.$state.params.focus === true;\n  }\n\n  public showBackButton():boolean {\n    return this.baseRoute.includes('bim');\n  }\n\n  public backToList() {\n    this.backRouting.goToBaseState();\n  }\n\n  protected initializeTexts() {\n    super.initializeTexts();\n    this.text.closeDetailsView = this.I18n.t('js.button_close_details');\n    this.text.goTofullScreen = this.I18n.t('js.work_packages.message_successful_show_in_fullscreen');\n  }\n}\n","<div class=\"work-packages--details loading-indicator--location\"\n      data-indicator-name=\"wpDetails\"\n      *ngIf=\"workPackage\">\n    <div id=\"tabs\">\n      <ul class=\"tabrow\">\n        <!-- The hrefs with empty URLs are necessary for IE10 to focus these links\n        properly. Thus, don't remove the hrefs or the empty URLs! -->\n        <li uiSref=\".overview\"\n            uiSrefActive=\"selected\">\n          <a href=\"\" [textContent]=\"text.tabs.overview\"></a>\n        </li>\n        <li uiSref=\".activity\"\n            uiSrefActive=\"selected\">\n          <a href=\"\" [textContent]=\"text.tabs.activity\"></a>\n        </li>\n        <li uiSref=\".relations\"\n                    uiSrefActive=\"selected\">\n          <a href=\"\" [textContent]=\"text.tabs.relations\"></a>\n          <wp-relations-count [wpId]=\"workPackage.id\"></wp-relations-count>\n        </li>\n        <li *ngIf=\"canViewWorkPackageWatchers()\"\n            uiSref=\".watchers\"\n            uiSrefActive=\"selected\">\n          <a href=\"\" [textContent]=\"text.tabs.watchers\"></a>\n          <wp-watchers-count [wpId]=\"workPackage.id\"></wp-watchers-count>\n        </li>\n        <li class=\"tab-icon\">\n          <accessible-by-keyboard (execute)=\"switchToFullscreen()\"\n                                  [linkAriaLabel]=\"text.goTofullScreen\"\n                                  [linkTitle]=\"text.goTofullScreen\"\n                                  linkClass=\"work-packages--details-fullscreen-icon\"\n                                  spanClass=\"icon-context icon-to-fullscreen\">\n          </accessible-by-keyboard>\n        </li>\n        <li class=\"tab-icon\">\n          <accessible-by-keyboard (execute)=\"close()\"\n                                  [linkAriaLabel]=\"text.closeDetailsView\"\n                                  [linkTitle]=\"text.closeDetailsView\"\n                                  linkClass=\"work-packages--details-close-icon\"\n                                  spanClass=\"icon-context icon-close\">\n          </accessible-by-keyboard>\n        </li>\n      </ul>\n    </div>\n    <div class=\"work-packages--details-content work-packages-tab-view--overflow\" *ngIf=\"workPackage\">\n    <span class=\"hidden-for-sighted\" tabindex=\"-1\" focus=\"shouldFocus\" [textContent]=\"focusAnchorLabel\">\n      </span>\n\n      <wp-breadcrumb [workPackage]=\"workPackage\"></wp-breadcrumb>\n\n      <edit-form [resource]=\"workPackage\">\n        <div class=\"wp-show--header-container\">\n          <back-button *ngIf=\"showBackButton()\"\n                       linkClass=\"work-packages-back-button\"\n                       [customBackMethod]=\"backToList.bind(this)\">\n          </back-button>\n\n          <div class=\"subject-header\">\n            <wp-subject></wp-subject>\n          </div>\n        </div>\n\n        <div class=\"work-package-details-tab\" ui-view></div>\n      </edit-form>\n    </div>\n\n    <div class=\"work-packages--details-toolbar-container\" *ngIf=\"workPackage\">\n      <wp-details-toolbar [workPackage]=\"workPackage\"></wp-details-toolbar>\n    </div>\n\n    <div class=\"work-packages--details--resizer hidden-for-mobile hide-when-print\">\n      <wp-resizer [elementClass]=\"'work-packages-partitioned-page--content-right'\"\n                  [localStorageKey]=\"'openProject-splitViewFlexBasis'\"></wp-resizer>\n    </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, EventEmitter, Output} from '@angular/core';\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageCacheService} from \"app/components/work-packages/work-package-cache.service\";\nimport {Subject} from \"rxjs\";\nimport {debounceTime, distinctUntilChanged, map, tap} from \"rxjs/operators\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {input} from \"reactivestates\";\nimport {QueryFilterResource} from \"core-app/modules/hal/resources/query-filter-resource\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'wp-filter-by-text-input',\n  templateUrl: './quick-filter-by-text-input.html'\n})\n\nexport class WorkPackageFilterByTextInputComponent extends UntilDestroyedMixin {\n  @Output() public deactivateFilter = new EventEmitter<QueryFilterResource>();\n\n  public text = {\n    createWithDropdown: this.I18n.t('js.work_packages.create.button'),\n    createButton: this.I18n.t('js.label_work_package'),\n    explanation: this.I18n.t('js.label_create_work_package'),\n    placeholder: this.I18n.t('js.work_packages.placeholder_filter_by_text')\n  };\n\n  /** Observable to the current search filter term */\n  public searchTerm = input<string>('');\n\n  /** Input for search requests */\n  public searchTermChanged:Subject<string> = new Subject<string>();\n\n  constructor(readonly I18n:I18nService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly wpCacheService:WorkPackageCacheService) {\n    super();\n\n    this.wpTableFilters\n      .pristine$()\n      .pipe(\n        this.untilDestroyed(),\n        map(() => {\n          const currentSearchFilter = this.wpTableFilters.find('search');\n          return currentSearchFilter ? (currentSearchFilter.values[0] as string) : '';\n        }),\n      )\n      .subscribe((upstreamTerm:string) => {\n        console.log(\"upstream \" + upstreamTerm + \" \" + (this.searchTerm as any).timestampOfLastValue);\n        if (!this.searchTerm.value || this.searchTerm.isValueOlderThan(500)) {\n          console.log(\"Upstream value setting to \" + upstreamTerm);\n          this.searchTerm.putValue(upstreamTerm);\n        }\n      });\n\n    this.searchTermChanged\n      .pipe(\n        this.untilDestroyed(),\n        distinctUntilChanged(),\n        tap((val) => this.searchTerm.putValue(val)),\n        debounceTime(500),\n      )\n      .subscribe(term => {\n        if (term.length > 0) {\n          this.wpTableFilters.replace('search', filter => {\n            filter.operator = filter.findOperator('**')!;\n            filter.values = [term];\n          });\n        } else {\n          let filter = this.wpTableFilters.find('search');\n\n          this.wpTableFilters.remove(filter!);\n\n          this.deactivateFilter.emit(filter);\n        }\n      });\n  }\n}\n","<input id=\"filter-by-text-input\"\n       type=\"text\"\n       placeholder=\"{{text.placeholder}}\"\n       [ngModel]=\"searchTerm.values$() | async\"\n       (ngModelChange)=\"searchTermChanged.next($event)\">\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {cssClassCustomOption, DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class ResourcesDisplayField extends DisplayField {\n  public isEmpty():boolean {\n    return _.isEmpty(this.value);\n  }\n\n  public get value() {\n    let cf = this.resource[this.name];\n    if (this.schema && cf) {\n\n      if (cf.elements) {\n        return cf.elements.map((e:any) => e.name);\n      } else if (cf.map) {\n        return cf.map((e:any) => e.name);\n      } else if (cf.name) {\n        return [cf.name];\n      } else {\n        return [\"error: \" + JSON.stringify(cf)];\n      }\n    }\n\n    return [];\n  }\n\n  public render(element:HTMLElement, displayText:string):void {\n    const values = this.value;\n    element.innerHTML = '';\n    element.setAttribute('title', values.join(', '));\n\n    if (values.length === 0) {\n      this.renderEmpty(element);\n    } else {\n      this.renderValues(values, element);\n    }\n  }\n\n  /**\n   * Renders at most the first two values, followed by a badge indicating\n   * the total count.\n   */\n  protected renderValues(values:any[], element:HTMLElement) {\n    const content = document.createDocumentFragment();\n    const abridged = this.optionDiv(this.valueAbridged(values));\n\n    content.appendChild(abridged);\n\n    if (values.length > 2) {\n      const badge = this.optionDiv(values.length.toString(), 'badge', '-secondary');\n      content.appendChild(badge);\n    }\n\n    element.appendChild(content);\n  }\n\n  /**\n   * Build .custom-option div/span nodes with the given text\n   */\n  protected optionDiv(text:string, ...classes:string[]) {\n    const div = document.createElement('div');\n    const span = document.createElement('span');\n    div.classList.add(cssClassCustomOption);\n    span.classList.add(...classes);\n    span.textContent = text;\n\n    div.appendChild(span);\n\n    return div;\n  }\n\n  /**\n   * Return the first two joined values, if any.\n   */\n  protected valueAbridged(values:any[]) {\n    const valueForDisplay = _.take(values, 2);\n\n    if (values.length > 2) {\n      valueForDisplay.push('... ');\n    }\n\n    return valueForDisplay.join(', ');\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Injectable} from \"@angular/core\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageViewHierarchyIdentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy-indentation.service\";\nimport {WorkPackageViewDisplayRepresentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\n\nexport type WorkPackageAction = {\n  text:string;\n  key:string;\n  icon?:string;\n  indexBy?:(actions:WorkPackageAction[]) => number,\n  link?:string;\n  href?:string;\n};\n\n@Injectable()\nexport class WorkPackageContextMenuHelperService {\n\n  private BULK_ACTIONS = [\n    {\n      text: I18n.t('js.work_packages.bulk_actions.edit'),\n      key: 'edit',\n      link: 'update',\n      href: this.PathHelper.staticBase + '/work_packages/bulk/edit'\n    },\n    {\n      text: I18n.t('js.work_packages.bulk_actions.move'),\n      key: 'move',\n      link: 'move',\n      href: this.PathHelper.staticBase + '/work_packages/move/new'\n    },\n    {\n      text: I18n.t('js.work_packages.bulk_actions.copy'),\n      key: 'copy',\n      link: 'copy',\n      href: this.PathHelper.staticBase + '/work_packages/move/new?copy=true'\n    },\n    {\n      text: I18n.t('js.work_packages.bulk_actions.delete'),\n      key: 'delete',\n      link: 'delete',\n      href: this.PathHelper.staticBase + '/work_packages/bulk?_method=delete'\n    }\n  ];\n\n  constructor(private HookService:HookService,\n              private UrlParamsHelper:UrlParamsHelperService,\n              private wpViewRepresentation:WorkPackageViewDisplayRepresentationService,\n              private wpViewTimeline:WorkPackageViewTimelineService,\n              private wpViewIndent:WorkPackageViewHierarchyIdentationService,\n              private PathHelper:PathHelperService) {\n  }\n\n  public getPermittedActionLinks(workPackage:WorkPackageResource, permittedActionConstants:any, allowSplitScreenActions:boolean):WorkPackageAction[] {\n    let singularPermittedActions:any[] = [];\n\n    let allowedActions = this.getAllowedActions(workPackage, permittedActionConstants);\n\n    allowedActions = allowedActions.concat(this.getAllowedParentActions(workPackage));\n\n    allowedActions = allowedActions.concat(this.getAllowedRelationActions(workPackage, allowSplitScreenActions));\n\n    _.each(allowedActions, (allowedAction) => {\n      singularPermittedActions.push({\n        key: allowedAction.key,\n        text: allowedAction.text,\n        icon: allowedAction.icon,\n        link: allowedAction.link ? workPackage[allowedAction.link].href : undefined\n      });\n    });\n\n    return singularPermittedActions;\n  }\n\n  public getIntersectOfPermittedActions(workPackages:any) {\n    let bulkPermittedActions:any = [];\n\n    let permittedActions = _.filter(this.BULK_ACTIONS, (action:any) => {\n      return _.every(workPackages, (workPackage:WorkPackageResource) => {\n        return this.getAllowedActions(workPackage, [action]).length >= 1;\n      });\n    });\n\n    _.each(permittedActions, (permittedAction:any) => {\n      bulkPermittedActions.push({\n        key: permittedAction.key,\n        text: permittedAction.text,\n        link: this.getBulkActionLink(permittedAction, workPackages)\n      });\n    });\n\n    return bulkPermittedActions;\n  }\n\n  public getBulkActionLink(action:any, workPackages:any) {\n    let workPackageIdParams = {\n      'ids[]': workPackages.map(function(wp:any) {\n        return wp.id;\n      })\n    };\n    let serializedIdParams = this.UrlParamsHelper.buildQueryString(workPackageIdParams);\n\n    let linkAndQueryString = action.href.split('?');\n    let link = linkAndQueryString.shift();\n    let queryParts = linkAndQueryString.concat(new Array(serializedIdParams));\n\n    return link + '?' + queryParts.join('&');\n  }\n\n  private getAllowedActions(workPackage:WorkPackageResource, actions:WorkPackageAction[]):WorkPackageAction[] {\n    let allowedActions:WorkPackageAction[] = [];\n\n    _.each(actions, (action) => {\n      if (action.link && workPackage.hasOwnProperty(action.link)) {\n        action.text = action.text || I18n.t('js.button_' + action.key);\n        allowedActions.push(action);\n      }\n    });\n\n    _.each(this.HookService.call('workPackageTableContextMenu'), (action) => {\n      if (workPackage.hasOwnProperty(action.link)) {\n        let index = action.indexBy ? action.indexBy(allowedActions) : allowedActions.length;\n        allowedActions.splice(index, 0, action);\n      }\n    });\n\n    return allowedActions;\n  }\n\n  private getAllowedParentActions(workPackage:WorkPackageResource) {\n    let actions:WorkPackageAction[] = [];\n\n    // Do not add these actions unless we're in the table\n    if (!this.wpViewRepresentation.isList) {\n      return [];\n    }\n\n    // Can only outdent this item if it has ancestors\n    if (this.wpViewIndent.canOutdent(workPackage)) {\n      actions.push({\n        key: 'hierarchy-outdent',\n        icon: 'icon-paragraph-left',\n        text: I18n.t(\"js.relation_buttons.hierarchy_outdent\")\n      });\n    }\n\n    // Can only indent if not first and immediate predecessor is not the parent\n    if (this.wpViewIndent.canIndent(workPackage)) {\n      actions.push({\n        key: 'hierarchy-indent',\n        icon: 'icon-paragraph-right',\n        text: I18n.t(\"js.relation_buttons.hierarchy_indent\")\n      });\n    }\n\n    return actions;\n  }\n\n  private getAllowedRelationActions(workPackage:WorkPackageResource, allowSplitScreenActions:boolean) {\n    let allowedActions:WorkPackageAction[] = [];\n\n    if (workPackage.addRelation && this.wpViewTimeline.isVisible) {\n      allowedActions.push({\n        key: \"relation-precedes\",\n        text: I18n.t(\"js.relation_buttons.add_predecessor\"),\n        link: \"addRelation\"\n      });\n      allowedActions.push({\n        key: \"relation-follows\",\n        text: I18n.t(\"js.relation_buttons.add_follower\"),\n        link: \"addRelation\"\n      });\n    }\n\n    if (!!workPackage.addChild && allowSplitScreenActions) {\n      allowedActions.push({\n        key: \"relation-new-child\",\n        text: I18n.t(\"js.relation_buttons.add_new_child\"),\n        link: \"addChild\"\n      });\n    }\n\n    return allowedActions;\n  }\n\n\n  public getPermittedActions(workPackages:WorkPackageResource[], permittedActionConstants:any, allowSplitScreenActions:boolean):WorkPackageAction[] {\n    if (workPackages.length === 1) {\n      return this.getPermittedActionLinks(workPackages[0], permittedActionConstants, allowSplitScreenActions);\n    } else {\n      return this.getIntersectOfPermittedActions(workPackages);\n    }\n  }\n}\n","\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nexport const queryColumnTypes = {\n  PROPERTY: 'QueryColumn::Property',\n  RELATION_OF_TYPE: 'QueryColumn::RelationOfType',\n  RELATION_TO_TYPE: 'QueryColumn::RelationToType',\n};\n\nexport function isRelationColumn(column:QueryColumn) {\n  const relationTypes = [queryColumnTypes.RELATION_TO_TYPE, queryColumnTypes.RELATION_OF_TYPE];\n  return relationTypes.indexOf(column._type) >= 0;\n}\n\n/**\n * A reference to a query column object as returned from the API.\n */\nexport interface QueryColumn extends HalResource {\n  id:string;\n  name:string;\n  custom_field?:any;\n  _links?: {\n    self:{ href:string, title:string };\n  };\n}\n\nexport interface TypeRelationQueryColumn extends QueryColumn {\n  type:{ href: string, name:string },\n  _links?: {\n    self:{ href:string, title:string },\n    type:{ href:string, title:string }\n  }\n}\n\nexport interface RelationQueryColumn extends QueryColumn {\n  relationType: string;\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input} from '@angular/core';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\n\n@Component({\n  selector: 'op-date-time',\n  template: `\n    <span title=\"{{date}} {{ time }}\">\n      <span [textContent]=\"date\"></span>\n      <span>&nbsp;</span>\n      <span [textContent]=\"time\"></span>\n    </span>\n  `\n})\nexport class OpDateTimeComponent {\n\n  @Input('dateTimeValue') dateTimeValue:any;\n\n  public date:any;\n  public time:any;\n\n  constructor(readonly timezoneService:TimezoneService) {\n  }\n\n  ngOnInit() {\n    var c = this.timezoneService.formattedDatetimeComponents(this.dateTimeValue);\n    this.date = c[0];\n    this.time = c[1];\n  }\n}\n","export const enterpriseEditionUrl = \"https://www.openproject.org/enterprise-edition/?op_edtion=community-edition\";\n\nexport const enterpriseDemoUrl = \"https://www.openproject.org/enterprise-demo/\";\n","export function randomString(length:number = 16) {\n  let pattern = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let random = '';\n  for (let _element of new Array(length)) {\n    random += pattern.charAt(Math.floor(Math.random() * pattern.length));\n  }\n  return random;\n}\n","export namespace Highlighting {\n  export function backgroundClass(property:string, id:string|number) {\n    return `__hl_background_${property}_${id}`;\n  }\n\n  export function inlineClass(property:string, id:string|number) {\n    return `__hl_inline_${property}_${id}`;\n  }\n\n  export function colorClass(highlightColorTextInline:boolean, id:string|number) {\n    if (highlightColorTextInline) {\n      return `__hl_inline_color_${id}_text`;\n    } else {\n      return `__hl_inline_color_${id}_dot`;\n    }\n  }\n\n  /**\n   * Given the difference from today (negative = n days in the past),\n   * output the fixed overdue classes\n   * @param diff\n   */\n  export function overdueDate(diff:number):string {\n    if (diff === 0) {\n      return '__hl_date_due_today';\n    }\n    // At least one day\n    if (diff <= -1) {\n      return '__hl_date_overdue';\n    }\n\n    return '__hl_date_not_overdue';\n  }\n\n  export function isBright(styles:CSSStyleDeclaration, property:string, id:string|number) {\n    const variable = `--hl-${property}-${id}-dark`;\n    return styles.getPropertyValue(variable) !== '';\n  }\n}\n","import { AfterContentInit, Directive, ElementRef, Input } from '@angular/core';\nimport {FocusHelperService} from \"core-app/modules/common/focus/focus-helper\";\n\n@Directive({\n  selector: '[autoFocus]'\n})\nexport class AutofocusDirective implements AfterContentInit {\n  @Input('autoFocus-condition') public condition:boolean = true;\n\n  public constructor(private el:ElementRef,\n                     private focusHelper:FocusHelperService) {\n\n  }\n\n  public ngAfterContentInit() {\n    if (!this.condition) {\n      return;\n    }\n\n    setTimeout(() => {\n      this.focusHelper.focusElement(jQuery(this.el.nativeElement));\n    }, 100);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport interface CustomActionResourceLinks {\n  self():Promise<CustomActionResource>;\n  executeImmediately(payload:any):Promise<WorkPackageResource>;\n}\n\nexport class CustomActionResource extends HalResource {\n  public name:string;\n  public description:string;\n}\n\nexport interface CustomActionResource extends CustomActionResourceLinks {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nexport type FilterOperator = '='|'!*'|'!'|'~'|'o'|'>t-'|'<>d'|'**'|'ow' ;\n\nexport interface ApiV3FilterValue {\n  operator:FilterOperator;\n  values:any;\n}\n\nexport interface ApiV3Filter {\n  [filter:string]:ApiV3FilterValue;\n}\n\nexport type ApiV3FilterObject = { [filter:string]:ApiV3FilterValue };\n\nexport class ApiV3FilterBuilder {\n\n  private filterMap:ApiV3FilterObject = {};\n\n  public add(name:string, operator:FilterOperator, values:any):this {\n    this.filterMap[name] = {\n      operator: operator,\n      values: values\n    };\n\n    return this;\n  }\n\n  /**\n   * Remove from the filter set\n   * @param name\n   */\n  public remove(name:string) {\n    delete this.filterMap[name];\n  }\n\n  /**\n   * Turns the array-map style of query filters to an actual object\n   *\n   * @param filters APIv3 filter array [ {foo: { operator: '=', val: ['bar'] } }, ...]\n   * @return A map { foo: { operator: '=', val: ['bar'] } , ... }\n   */\n  public toFilterObject(filters:ApiV3Filter[]):ApiV3FilterObject {\n    let map:ApiV3FilterObject = {};\n\n    filters.forEach((item:ApiV3Filter) => {\n      _.each(item, (val:ApiV3FilterValue, filter:string) => {\n        map[filter] = val;\n      });\n    });\n\n    return map;\n  }\n\n  /**\n   * Merges the other filters into the current set,\n   * replacing them if the are duplicated.\n   *\n   * @param filters\n   * @param only Only apply the given filters\n   */\n  public merge(filters:ApiV3Filter[], ...only:string[]) {\n    const toAdd:ApiV3FilterObject = _.pickBy(\n      this.toFilterObject(filters),\n      (_, filter:string) => only.includes(filter)\n    );\n\n    this.filterMap = {\n      ...this.filterMap,\n      ...toAdd\n    };\n  }\n\n  public get filters():ApiV3Filter[] {\n    let filters:ApiV3Filter[] = [];\n    _.each(this.filterMap, (val:ApiV3FilterValue, filter:string) => {\n      filters.push({ [filter]: val });\n    });\n\n    return filters;\n  }\n\n  public toJson():string {\n    return JSON.stringify(this.filters);\n  }\n\n  public toParams(mergeParams:{ [key:string]:string } = {}):string {\n    let transformedFilters:string[] = [];\n\n    transformedFilters = this.filters.map((filter:ApiV3Filter) => {\n      return this.serializeFilter(filter);\n    });\n\n    let params = { filters: `[${transformedFilters.join(\",\")}]`, ...mergeParams };\n    return new URLSearchParams(params).toString();\n  }\n\n  public clone() {\n    let newFilters = new ApiV3FilterBuilder();\n\n    this.filters.forEach(filter => {\n      Object.keys(filter).forEach(name => {\n        newFilters.add(name, filter[name].operator, filter[name].values);\n      });\n    });\n\n    return newFilters;\n  }\n\n  private serializeFilter(filter:ApiV3Filter) {\n    let transformedFilter:string;\n    let keys:Array<string>;\n\n    keys = Object.keys(filter);\n\n    let typeName = keys[0];\n    let operatorAndValues:any = filter[typeName];\n\n    transformedFilter = `{\"${typeName}\":{\"operator\":\"${operatorAndValues['operator']}\",\"values\":[${operatorAndValues['values']\n      .map((val:any) => this.serializeFilterValue(val))\n      .join(',')}]}}`;\n\n    return transformedFilter;\n  }\n\n  private serializeFilterValue(filterValue:any) {\n    return `\"${filterValue}\"`;\n  }\n}\n\nexport function buildApiV3Filter(name:string, operator:FilterOperator, values:any) {\n  return new ApiV3FilterBuilder().add(name, operator, values);\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Directive, ViewChild} from \"@angular/core\";\nimport {WorkPackageEmbeddedTableComponent} from \"core-components/wp-table/embedded/wp-embedded-table.component\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Directive()\nexport abstract class WorkPackageRelationQueryBase extends UntilDestroyedMixin {\n  public workPackage:WorkPackageResource;\n\n  /** Input is either a query resource, or directly query props */\n  public query:QueryResource|Object;\n\n  /** Query props are derived from the query resource, if any */\n  public queryProps:Object;\n\n  /** Whether this section should be hidden completely (due to missing permissions e.g.) */\n  public hidden:boolean = false;\n\n  /** Reference to the embedded table instance */\n  @ViewChild('embeddedTable') protected embeddedTable:WorkPackageEmbeddedTableComponent;\n\n  constructor(protected queryUrlParamsHelper:UrlParamsHelperService) {\n    super();\n  }\n\n  /**\n   * Request to refresh the results of the embedded table\n   */\n  public refreshTable() {\n    this.embeddedTable.isInitialized && this.embeddedTable.loadQuery(true, false);\n  }\n\n  /**\n   * Special handling for query loading when a project filter is involved.\n   *\n   * Ensure that at least one project was visible to the user or otherwise,\n   * hide the creation from them.\n   * cf. OP#30106\n   * @param query\n   */\n  public handleQueryLoaded(loaded:QueryResource) {\n    // We only handle loaded queries\n    if (!(this.query instanceof QueryResource)) {\n      return;\n    }\n\n    const filtersLength = this.projectValuesCount(this.query);\n    const loadedFiltersLength = this.projectValuesCount(loaded);\n\n    // Does the default have a project filter, but the other does not?\n    if (filtersLength !== null && loadedFiltersLength === null) {\n      this.hidden = true;\n    }\n\n    // Has a project filter been reduced to zero elements?\n    if (filtersLength && loadedFiltersLength && filtersLength > 0 && loadedFiltersLength === 0) {\n      this.hidden = true;\n    }\n  }\n\n  /**\n   * Get the filters of the query props\n   */\n  protected projectValuesCount(query:QueryResource):number|null {\n    const project = query.filters.find(f => f.id === 'project');\n    return project ? project.values.length : null;\n  }\n\n  /**\n   * Set up the query props from input\n   */\n  protected buildQueryProps() {\n    if (this.query instanceof QueryResource) {\n      return this.queryUrlParamsHelper.buildV3GetQueryFromQueryResource(\n        this.query,\n        { valid_subset: true },\n        { id: this.workPackage.id! }\n      );\n    } else {\n      return this.query;\n    }\n  }\n}\n","var map = {\n\t\"./af\": \"K/tc\",\n\t\"./af.js\": \"K/tc\",\n\t\"./ar\": \"jnO4\",\n\t\"./ar-dz\": \"o1bE\",\n\t\"./ar-dz.js\": \"o1bE\",\n\t\"./ar-kw\": \"Qj4J\",\n\t\"./ar-kw.js\": \"Qj4J\",\n\t\"./ar-ly\": \"HP3h\",\n\t\"./ar-ly.js\": \"HP3h\",\n\t\"./ar-ma\": \"CoRJ\",\n\t\"./ar-ma.js\": \"CoRJ\",\n\t\"./ar-sa\": \"gjCT\",\n\t\"./ar-sa.js\": \"gjCT\",\n\t\"./ar-tn\": \"bYM6\",\n\t\"./ar-tn.js\": \"bYM6\",\n\t\"./ar.js\": \"jnO4\",\n\t\"./az\": \"SFxW\",\n\t\"./az.js\": \"SFxW\",\n\t\"./be\": \"H8ED\",\n\t\"./be.js\": \"H8ED\",\n\t\"./bg\": \"hKrs\",\n\t\"./bg.js\": \"hKrs\",\n\t\"./bm\": \"p/rL\",\n\t\"./bm.js\": \"p/rL\",\n\t\"./bn\": \"kEOa\",\n\t\"./bn.js\": \"kEOa\",\n\t\"./bo\": \"0mo+\",\n\t\"./bo.js\": \"0mo+\",\n\t\"./br\": \"aIdf\",\n\t\"./br.js\": \"aIdf\",\n\t\"./bs\": \"JVSJ\",\n\t\"./bs.js\": \"JVSJ\",\n\t\"./ca\": \"1xZ4\",\n\t\"./ca.js\": \"1xZ4\",\n\t\"./cs\": \"PA2r\",\n\t\"./cs.js\": \"PA2r\",\n\t\"./cv\": \"A+xa\",\n\t\"./cv.js\": \"A+xa\",\n\t\"./cy\": \"l5ep\",\n\t\"./cy.js\": \"l5ep\",\n\t\"./da\": \"DxQv\",\n\t\"./da.js\": \"DxQv\",\n\t\"./de\": \"tGlX\",\n\t\"./de-at\": \"s+uk\",\n\t\"./de-at.js\": \"s+uk\",\n\t\"./de-ch\": \"u3GI\",\n\t\"./de-ch.js\": \"u3GI\",\n\t\"./de.js\": \"tGlX\",\n\t\"./dv\": \"WYrj\",\n\t\"./dv.js\": \"WYrj\",\n\t\"./el\": \"jUeY\",\n\t\"./el.js\": \"jUeY\",\n\t\"./en-SG\": \"zavE\",\n\t\"./en-SG.js\": \"zavE\",\n\t\"./en-au\": \"Dmvi\",\n\t\"./en-au.js\": \"Dmvi\",\n\t\"./en-ca\": \"OIYi\",\n\t\"./en-ca.js\": \"OIYi\",\n\t\"./en-gb\": \"Oaa7\",\n\t\"./en-gb.js\": \"Oaa7\",\n\t\"./en-ie\": \"4dOw\",\n\t\"./en-ie.js\": \"4dOw\",\n\t\"./en-il\": \"czMo\",\n\t\"./en-il.js\": \"czMo\",\n\t\"./en-nz\": \"b1Dy\",\n\t\"./en-nz.js\": \"b1Dy\",\n\t\"./eo\": \"Zduo\",\n\t\"./eo.js\": \"Zduo\",\n\t\"./es\": \"iYuL\",\n\t\"./es-do\": \"CjzT\",\n\t\"./es-do.js\": \"CjzT\",\n\t\"./es-us\": \"Vclq\",\n\t\"./es-us.js\": \"Vclq\",\n\t\"./es.js\": \"iYuL\",\n\t\"./et\": \"7BjC\",\n\t\"./et.js\": \"7BjC\",\n\t\"./eu\": \"D/JM\",\n\t\"./eu.js\": \"D/JM\",\n\t\"./fa\": \"jfSC\",\n\t\"./fa.js\": \"jfSC\",\n\t\"./fi\": \"gekB\",\n\t\"./fi.js\": \"gekB\",\n\t\"./fo\": \"ByF4\",\n\t\"./fo.js\": \"ByF4\",\n\t\"./fr\": \"nyYc\",\n\t\"./fr-ca\": \"2fjn\",\n\t\"./fr-ca.js\": \"2fjn\",\n\t\"./fr-ch\": \"Dkky\",\n\t\"./fr-ch.js\": \"Dkky\",\n\t\"./fr.js\": \"nyYc\",\n\t\"./fy\": \"cRix\",\n\t\"./fy.js\": \"cRix\",\n\t\"./ga\": \"USCx\",\n\t\"./ga.js\": \"USCx\",\n\t\"./gd\": \"9rRi\",\n\t\"./gd.js\": \"9rRi\",\n\t\"./gl\": \"iEDd\",\n\t\"./gl.js\": \"iEDd\",\n\t\"./gom-latn\": \"DKr+\",\n\t\"./gom-latn.js\": \"DKr+\",\n\t\"./gu\": \"4MV3\",\n\t\"./gu.js\": \"4MV3\",\n\t\"./he\": \"x6pH\",\n\t\"./he.js\": \"x6pH\",\n\t\"./hi\": \"3E1r\",\n\t\"./hi.js\": \"3E1r\",\n\t\"./hr\": \"S6ln\",\n\t\"./hr.js\": \"S6ln\",\n\t\"./hu\": \"WxRl\",\n\t\"./hu.js\": \"WxRl\",\n\t\"./hy-am\": \"1rYy\",\n\t\"./hy-am.js\": \"1rYy\",\n\t\"./id\": \"UDhR\",\n\t\"./id.js\": \"UDhR\",\n\t\"./is\": \"BVg3\",\n\t\"./is.js\": \"BVg3\",\n\t\"./it\": \"bpih\",\n\t\"./it-ch\": \"bxKX\",\n\t\"./it-ch.js\": \"bxKX\",\n\t\"./it.js\": \"bpih\",\n\t\"./ja\": \"B55N\",\n\t\"./ja.js\": \"B55N\",\n\t\"./jv\": \"tUCv\",\n\t\"./jv.js\": \"tUCv\",\n\t\"./ka\": \"IBtZ\",\n\t\"./ka.js\": \"IBtZ\",\n\t\"./kk\": \"bXm7\",\n\t\"./kk.js\": \"bXm7\",\n\t\"./km\": \"6B0Y\",\n\t\"./km.js\": \"6B0Y\",\n\t\"./kn\": \"PpIw\",\n\t\"./kn.js\": \"PpIw\",\n\t\"./ko\": \"Ivi+\",\n\t\"./ko.js\": \"Ivi+\",\n\t\"./ku\": \"JCF/\",\n\t\"./ku.js\": \"JCF/\",\n\t\"./ky\": \"lgnt\",\n\t\"./ky.js\": \"lgnt\",\n\t\"./lb\": \"RAwQ\",\n\t\"./lb.js\": \"RAwQ\",\n\t\"./lo\": \"sp3z\",\n\t\"./lo.js\": \"sp3z\",\n\t\"./lt\": \"JvlW\",\n\t\"./lt.js\": \"JvlW\",\n\t\"./lv\": \"uXwI\",\n\t\"./lv.js\": \"uXwI\",\n\t\"./me\": \"KTz0\",\n\t\"./me.js\": \"KTz0\",\n\t\"./mi\": \"aIsn\",\n\t\"./mi.js\": \"aIsn\",\n\t\"./mk\": \"aQkU\",\n\t\"./mk.js\": \"aQkU\",\n\t\"./ml\": \"AvvY\",\n\t\"./ml.js\": \"AvvY\",\n\t\"./mn\": \"lYtQ\",\n\t\"./mn.js\": \"lYtQ\",\n\t\"./mr\": \"Ob0Z\",\n\t\"./mr.js\": \"Ob0Z\",\n\t\"./ms\": \"6+QB\",\n\t\"./ms-my\": \"ZAMP\",\n\t\"./ms-my.js\": \"ZAMP\",\n\t\"./ms.js\": \"6+QB\",\n\t\"./mt\": \"G0Uy\",\n\t\"./mt.js\": \"G0Uy\",\n\t\"./my\": \"honF\",\n\t\"./my.js\": \"honF\",\n\t\"./nb\": \"bOMt\",\n\t\"./nb.js\": \"bOMt\",\n\t\"./ne\": \"OjkT\",\n\t\"./ne.js\": \"OjkT\",\n\t\"./nl\": \"+s0g\",\n\t\"./nl-be\": \"2ykv\",\n\t\"./nl-be.js\": \"2ykv\",\n\t\"./nl.js\": \"+s0g\",\n\t\"./nn\": \"uEye\",\n\t\"./nn.js\": \"uEye\",\n\t\"./pa-in\": \"8/+R\",\n\t\"./pa-in.js\": \"8/+R\",\n\t\"./pl\": \"jVdC\",\n\t\"./pl.js\": \"jVdC\",\n\t\"./pt\": \"8mBD\",\n\t\"./pt-br\": \"0tRk\",\n\t\"./pt-br.js\": \"0tRk\",\n\t\"./pt.js\": \"8mBD\",\n\t\"./ro\": \"lyxo\",\n\t\"./ro.js\": \"lyxo\",\n\t\"./ru\": \"lXzo\",\n\t\"./ru.js\": \"lXzo\",\n\t\"./sd\": \"Z4QM\",\n\t\"./sd.js\": \"Z4QM\",\n\t\"./se\": \"//9w\",\n\t\"./se.js\": \"//9w\",\n\t\"./si\": \"7aV9\",\n\t\"./si.js\": \"7aV9\",\n\t\"./sk\": \"e+ae\",\n\t\"./sk.js\": \"e+ae\",\n\t\"./sl\": \"gVVK\",\n\t\"./sl.js\": \"gVVK\",\n\t\"./sq\": \"yPMs\",\n\t\"./sq.js\": \"yPMs\",\n\t\"./sr\": \"zx6S\",\n\t\"./sr-cyrl\": \"E+lV\",\n\t\"./sr-cyrl.js\": \"E+lV\",\n\t\"./sr.js\": \"zx6S\",\n\t\"./ss\": \"Ur1D\",\n\t\"./ss.js\": \"Ur1D\",\n\t\"./sv\": \"X709\",\n\t\"./sv.js\": \"X709\",\n\t\"./sw\": \"dNwA\",\n\t\"./sw.js\": \"dNwA\",\n\t\"./ta\": \"PeUW\",\n\t\"./ta.js\": \"PeUW\",\n\t\"./te\": \"XLvN\",\n\t\"./te.js\": \"XLvN\",\n\t\"./tet\": \"V2x9\",\n\t\"./tet.js\": \"V2x9\",\n\t\"./tg\": \"Oxv6\",\n\t\"./tg.js\": \"Oxv6\",\n\t\"./th\": \"EOgW\",\n\t\"./th.js\": \"EOgW\",\n\t\"./tl-ph\": \"Dzi0\",\n\t\"./tl-ph.js\": \"Dzi0\",\n\t\"./tlh\": \"z3Vd\",\n\t\"./tlh.js\": \"z3Vd\",\n\t\"./tr\": \"DoHr\",\n\t\"./tr.js\": \"DoHr\",\n\t\"./tzl\": \"z1FC\",\n\t\"./tzl.js\": \"z1FC\",\n\t\"./tzm\": \"wQk9\",\n\t\"./tzm-latn\": \"tT3J\",\n\t\"./tzm-latn.js\": \"tT3J\",\n\t\"./tzm.js\": \"wQk9\",\n\t\"./ug-cn\": \"YRex\",\n\t\"./ug-cn.js\": \"YRex\",\n\t\"./uk\": \"raLr\",\n\t\"./uk.js\": \"raLr\",\n\t\"./ur\": \"UpQW\",\n\t\"./ur.js\": \"UpQW\",\n\t\"./uz\": \"Loxo\",\n\t\"./uz-latn\": \"AQ68\",\n\t\"./uz-latn.js\": \"AQ68\",\n\t\"./uz.js\": \"Loxo\",\n\t\"./vi\": \"KSF8\",\n\t\"./vi.js\": \"KSF8\",\n\t\"./x-pseudo\": \"/X5v\",\n\t\"./x-pseudo.js\": \"/X5v\",\n\t\"./yo\": \"fzPg\",\n\t\"./yo.js\": \"fzPg\",\n\t\"./zh-cn\": \"XDpg\",\n\t\"./zh-cn.js\": \"XDpg\",\n\t\"./zh-hk\": \"SatO\",\n\t\"./zh-hk.js\": \"SatO\",\n\t\"./zh-tw\": \"kOpN\",\n\t\"./zh-tw.js\": \"kOpN\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"RnhZ\";","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Subject} from \"rxjs\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Injectable()\nexport class CommentService {\n\n  // Replacement for ng1 $scope.$emit on activty-entry to mark comments to be quoted.\n  // Should be generalized if needed for more than that.\n  public quoteEvents = new Subject<string>();\n\n  constructor(\n    readonly I18n:I18nService,\n    private workPackageNotificationService:WorkPackageNotificationService,\n    private NotificationsService:NotificationsService) {\n  }\n\n  public createComment(workPackage:WorkPackageResource, comment:{ raw:string }) {\n    return workPackage.addComment(\n      { comment: comment },\n      { 'Content-Type': 'application/json; charset=UTF-8' }\n    )\n      .catch((error:any) => this.errorAndReject(error, workPackage));\n  }\n\n  public updateComment(activity:HalResource, comment:string) {\n    const options = {\n      ajax: {\n        method: 'PATCH',\n        data: JSON.stringify({ comment: comment }),\n        contentType: 'application/json; charset=utf-8'\n      }\n    };\n\n    return activity.update(\n      { comment: comment },\n      { 'Content-Type': 'application/json; charset=UTF-8' }\n    ).then((activity:HalResource) => {\n      this.NotificationsService.addSuccess(\n        this.I18n.t('js.work_packages.comment_updated')\n      );\n\n      return activity;\n    }).catch((error:any) => this.errorAndReject(error));\n  }\n\n  private errorAndReject(error:HalResource, workPackage?:WorkPackageResource) {\n    this.workPackageNotificationService.handleRawError(error, workPackage);\n\n    // returning a reject will enable to correctly work with subsequent then/catch handlers.\n    return Promise.reject(error);\n  }\n}\n","import {Component, Input, OnInit} from '@angular/core';\nimport {WorkPackageRelationsService} from '../../wp-relations/wp-relations.service';\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {combineLatest} from 'rxjs';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './wp-relations-count.html',\n  selector: 'wp-relations-count',\n})\nexport class WorkPackageRelationsCountComponent extends UntilDestroyedMixin implements OnInit {\n  @Input('wpId') wpId:string;\n  public count:number = 0;\n\n  constructor(protected wpCacheService:WorkPackageCacheService,\n              protected wpRelations:WorkPackageRelationsService) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.wpRelations.require(this.wpId.toString());\n\n    combineLatest(\n      this.wpRelations.state(this.wpId.toString()).values$(),\n      this.wpCacheService.loadWorkPackage(this.wpId.toString()).values$()\n    ).pipe(\n      this.untilDestroyed()\n    ).subscribe(([relations, workPackage]) => {\n      let relationCount = _.size(relations);\n      let childrenCount = _.size(workPackage.children);\n\n      this.count = relationCount + childrenCount;\n    });\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from \"@angular/core\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {checkedClassName, uiStateLinkClass} from \"core-components/wp-fast-table/builders/ui-state-link-builder\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {StateService} from \"@uirouter/core\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageCardViewService} from \"core-components/wp-card-view/services/wp-card-view.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CardHighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\nimport {CardViewOrientation} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {WorkPackageViewFocusService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service\";\nimport {splitViewRoute} from \"core-app/modules/work_packages/routing/split-view-routes.helper\";\n\n@Component({\n  selector: 'wp-single-card',\n  styleUrls: ['./wp-single-card.component.sass'],\n  templateUrl: './wp-single-card.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkPackageSingleCardComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public showInfoButton:boolean = false;\n  @Input() public showStatusButton:boolean = true;\n  @Input() public showRemoveButton:boolean = false;\n  @Input() public highlightingMode:CardHighlightingMode = 'inline';\n  @Input() public draggable:boolean = false;\n  @Input() public orientation:CardViewOrientation = 'vertical';\n  @Input() public shrinkOnMobile:boolean = false;\n\n  @Output() public onRemove = new EventEmitter<WorkPackageResource>();\n\n  public uiStateLinkClass:string = uiStateLinkClass;\n\n  public text = {\n    removeCard: this.I18n.t('js.card.remove_from_list'),\n    detailsView: this.I18n.t('js.button_open_details')\n  };\n\n  constructor(readonly pathHelper:PathHelperService,\n              readonly I18n:I18nService,\n              readonly $state:StateService,\n              readonly wpTableSelection:WorkPackageViewSelectionService,\n              readonly wpTableFocus:WorkPackageViewFocusService,\n              readonly cardView:WorkPackageCardViewService,\n              readonly cdRef:ChangeDetectorRef) {\n    super();\n  }\n\n  ngOnInit():void {\n    // Update selection state\n    this.wpTableSelection.live$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public classIdentifier(wp:WorkPackageResource) {\n    return this.cardView.classIdentifier(wp);\n  }\n\n  public openSplitScreen(wp:WorkPackageResource) {\n    let classIdentifier = this.classIdentifier(wp);\n    this.wpTableSelection.setSelection(wp.id!, this.cardView.findRenderedCard(classIdentifier));\n    this.wpTableFocus.updateFocus(wp.id!);\n    this.$state.go(\n      splitViewRoute(this.$state),\n      { workPackageId: wp.id! }\n    );\n  }\n\n  public cardClasses() {\n    let classes = this.isSelected(this.workPackage) ? checkedClassName : '';\n    classes += this.draggable ? ' -draggable' : '';\n    classes += this.workPackage.isNew ? ' -new' : '';\n    classes += ' wp-card-' + this.workPackage.id;\n    classes += ' -' + this.orientation;\n    classes += this.shrinkOnMobile ? ' -shrink' : '';\n    return classes;\n  }\n\n  public wpTypeAttribute(wp:WorkPackageResource) {\n    return wp.type.name;\n  }\n\n  public wpSubject(wp:WorkPackageResource) {\n    return wp.subject;\n  }\n\n  public wpProjectName(wp:WorkPackageResource) {\n    return wp.project?.name;\n  }\n\n  public cardHighlightingClass(wp:WorkPackageResource) {\n    return this.cardHighlighting(wp);\n  }\n\n  public typeHighlightingClass(wp:WorkPackageResource) {\n    return this.attributeHighlighting('type', wp);\n  }\n\n  public onRemoved(wp:WorkPackageResource) {\n    this.onRemove.emit(wp);\n  }\n\n  public cardCoverImageShown(wp:WorkPackageResource):boolean {\n    return this.bcfSnapshotPath(wp) !== null;\n  }\n\n  public bcfSnapshotPath(wp:WorkPackageResource) {\n    return wp.bcfViewpoints && wp.bcfViewpoints.length > 0 ? wp.bcfViewpoints[0].href + '/snapshot' : null;\n  }\n\n  private isSelected(wp:WorkPackageResource):boolean {\n    return this.wpTableSelection.isSelected(wp.id!);\n  }\n\n  private cardHighlighting(wp:WorkPackageResource) {\n    if (['status', 'priority', 'type'].includes(this.highlightingMode)) {\n      return Highlighting.backgroundClass(this.highlightingMode, wp[this.highlightingMode].id);\n    }\n    return '';\n  }\n\n  private attributeHighlighting(type:string, wp:WorkPackageResource) {\n    return Highlighting.inlineClass(type, wp.type.id!);\n  }\n}\n","<div class=\"wp-card\"\n     [ngClass]=\"cardClasses()\">\n\n  <div class=\"wp-card--highlighting\"\n       [ngClass]=\"cardHighlightingClass(workPackage)\">\n  </div>\n\n  <div class=\"wp-card--inline-buttons hidden-for-mobile\">\n    <a class=\"wp-card--details-button -no-decoration\"\n       *ngIf=\"!workPackage.isNew && showInfoButton\"\n       [title]=\"text.detailsView\"\n       (accessibleClick)=\"openSplitScreen(workPackage)\">\n      <op-icon icon-classes=\"icon icon-info2\"></op-icon>\n    </a>\n    <a class=\"wp-card--inline-cancel-button -no-decoration\"\n       *ngIf=\"workPackage.isNew || showRemoveButton\"\n       [ngClass]=\"{ '-show': workPackage.isNew }\"\n       [title]=\"text.removeCard\"\n       (accessibleClick)=\"onRemoved(workPackage)\">\n      <op-icon icon-classes=\"icon icon-close\"></op-icon>\n    </a>\n  </div>\n  <edit-form [resource]=\"workPackage\" \n             [inEditMode]=\"workPackage.isNew\"\n             *ngIf=\"workPackage.isNew\">\n    <div class=\"wp-card--content -new\">\n      <editable-attribute-field [resource]=\"workPackage\"\n                                [wrapperClasses]=\"'work-packages--type-selector'\"\n                                [fieldName]=\"'type'\"\n                                class=\"wp-card--type\">\n      </editable-attribute-field>\n      <editable-attribute-field [resource]=\"workPackage\"\n                                fieldName=\"subject\"\n                                class=\"wp-card--subject -bold\">\n      </editable-attribute-field>\n    </div>\n  </edit-form>\n\n  <div *ngIf=\"!workPackage.isNew\"\n       class=\"wp-card--content\">\n    <span [textContent]=\"wpProjectName(workPackage)\"\n          class=\"wp-card--project-name\">\n    </span>\n    <span [textContent]=\"wpTypeAttribute(workPackage)\" \n          class=\"wp-card--type\"\n          [ngClass]=\"typeHighlightingClass(workPackage)\">\n    </span>\n    <a uiSref=\"work-packages.show\" \n       [uiParams]=\"{workPackageId: workPackage.id}\"\n       class=\"wp-card--id\"\n       [ngClass]=\"uiStateLinkClass\">\n      #{{workPackage.id}}\n    </a>\n    <span [textContent]=\"wpSubject(workPackage)\" \n          class=\"wp-card--subject\">\n    </span>\n    <img *ngIf=\"this.cardCoverImageShown(workPackage)\" \n         [src]=\"this.bcfSnapshotPath(workPackage)\"\n         class=\"wp-card--cover-image\">\n    <wp-status-button *ngIf=\"showStatusButton\"\n                      [workPackage]=\"workPackage\"\n                      class=\"wp-card--status\">\n    </wp-status-button>\n    <user-avatar *ngIf=\"workPackage.assignee\"\n                 [user]=\"workPackage.assignee\"\n                 data-class-list=\"avatar-mini\"\n                 class=\"wp-card--assignee\">\n    </user-avatar>\n  </div>\n</div>","import {Injector} from '@angular/core';\nimport {CardEventHandler} from \"core-components/wp-card-view/event-handler/card-view-handler-registry\";\nimport {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {StateService} from \"@uirouter/core\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class CardDblClickHandler implements CardEventHandler {\n  @InjectField() $state:StateService;\n  @InjectField() wpTableSelection:WorkPackageViewSelectionService;\n\n  constructor(public readonly injector:Injector,\n              card:WorkPackageCardViewComponent) {\n  }\n\n  public get EVENT() {\n    return 'dblclick.cardView.card';\n  }\n\n  public get SELECTOR() {\n    return `.wp-card`;\n  }\n\n  public eventScope(card:WorkPackageCardViewComponent) {\n    return jQuery(card.container.nativeElement);\n  }\n\n  public handleEvent(card:WorkPackageCardViewComponent, evt:JQuery.TriggeredEvent) {\n    let target = jQuery(evt.target);\n\n    // Ignore links\n    if (target.is('a') || target.parent().is('a')) {\n      return true;\n    }\n\n    // Locate the row from event\n    let element = target.closest('wp-single-card');\n    let wpId = element.data('workPackageId');\n\n    if (!wpId) {\n      return true;\n    }\n\n    this.handleWorkPackage(wpId);\n\n    return false;\n  }\n\n  protected handleWorkPackage(wpId:string) {\n    this.$state.go(\n      'work-packages.show',\n      {workPackageId: wpId}\n    );\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {combine, deriveRaw, InputState, multiInput, MultiInputState, State, StatesGroup} from 'reactivestates';\nimport {filter, map} from 'rxjs/operators';\nimport {Injectable, Injector} from '@angular/core';\nimport {Subject} from \"rxjs\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {ChangeMap} from \"core-app/modules/fields/changeset/changeset\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {StateCacheService} from \"core-components/states/state-cache.service\";\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\n\nclass ChangesetStates extends StatesGroup {\n  name = 'Changesets';\n\n  changesets = multiInput<ResourceChangeset>();\n\n  constructor() {\n    super();\n    this.initializeMembers();\n  }\n}\n\n/**\n * Wrapper class for the saved change of a work package,\n * used to access the previous save and or previous state\n * of the work package (e.g., whether it was new).\n */\nexport class ResourceChangesetCommit<T extends HalResource = HalResource> {\n  /**\n   * The work package id of the change\n   * (This is the new work package ID if +wasNew+ is true.\n   */\n  public readonly id:string;\n\n  /**\n   * The resulting, saved work package.\n   */\n  public readonly resource:T;\n\n  /** Whether the commit saved an initial work package */\n  public readonly wasNew:boolean = false;\n\n  /** The previous changes */\n  public readonly changes:ChangeMap;\n\n  /**\n   * Create a change commit from the change object\n   * @param change The change object that resulted in the save\n   * @param saved The returned work package\n   */\n  constructor(change:ResourceChangeset<T>, saved:T) {\n    this.id = saved.id!.toString();\n    this.wasNew = change.pristineResource.isNew;\n    this.resource = saved;\n    this.changes = change.changeMap;\n  }\n}\n\nexport interface ResourceChangesetClass {\n  new(...args:any[]):ResourceChangeset;\n}\n\n@Injectable()\nexport class HalResourceEditingService extends StateCacheService<ResourceChangeset> {\n\n  /** Committed / saved changes to work packages observable */\n  public comittedChanges = new Subject<ResourceChangesetCommit>();\n\n  /** State group of changes to wrap */\n  private stateGroup = new ChangesetStates();\n\n  constructor(protected readonly injector:Injector,\n              protected readonly halEvents:HalEventsService,\n              protected readonly hook:HookService) {\n    super();\n  }\n\n  public async save<V extends HalResource, T extends ResourceChangeset<V>>(change:T):Promise<ResourceChangesetCommit<V>> {\n    // Form the payload we're going to save\n    const payload = await change.buildRequestPayload();\n    const savedResource = await change.pristineResource.$links.updateImmediately(payload);\n\n    // Initialize any potentially new HAL values\n    savedResource.retainFrom(change.pristineResource);\n\n    await this.onSaved(savedResource);\n\n    // Complete the change\n    return this.complete(change, savedResource);\n  }\n\n  /**\n   * Mark the given change as completed, notify changes\n   * and reset it.\n   */\n  private complete<V extends HalResource, T extends ResourceChangeset<V>>(change:T, saved:V):ResourceChangesetCommit<V> {\n    const commit = new ResourceChangesetCommit<V>(change, saved);\n    this.comittedChanges.next(commit);\n    this.reset(change);\n\n    const eventType = commit.wasNew ? 'created' : 'updated';\n    this.halEvents.push(commit.resource, { eventType, commit });\n\n    return commit;\n  }\n\n  /**\n   * Reset the given change, either due to cancelling or successful submission.\n   * @param change\n   */\n  public reset<V extends HalResource, T extends ResourceChangeset<V>>(change:T) {\n    change.clear();\n    this.clearSome(change.href);\n  }\n\n  /**\n   * Returns the typed state value. Use this to get a changeset\n   * for a subtype of ResourceChangeset<HalResource>.\n   * @param resource\n   */\n  public typedState<V extends HalResource, T extends ResourceChangeset<V>>(resource:V):State<T> {\n    return this.multiState.get(resource.href!) as InputState<T>;\n  }\n\n  /**\n   * Create a new changeset for the given work package, discarding any previous changeset that might exist.\n   *\n   * @param resource\n   * @param form\n   *\n   * @return The state for the created changeset\n   */\n  public edit<V extends HalResource, T extends ResourceChangeset<V>>(resource:V, form?:FormResource):T {\n    const state = this.multiState.get(resource.href!) as InputState<T>;\n    const changeset = this.newChangeset(resource, state, form);\n\n    state.putValue(changeset);\n\n    return changeset;\n  }\n\n  protected newChangeset<V extends HalResource, T extends ResourceChangeset<V>>(resource:V, state:InputState<T>, form?:FormResource):T {\n    // we take the last registered group component which means that\n    // plugins will have their say if they register for it.\n    const cls = this.hook.call('halResourceChangesetClass', resource).pop() || ResourceChangeset;\n    return new cls(resource, state, form) as T;\n  }\n\n  /**\n   * Start or continue editing the work package with a given edit context\n   * @param {resource} Hal resource to edit\n   * @param {form:FormResource} Initialize with an existing form\n   * @return {ResourceChangeset} Change object to work on\n   */\n  public changeFor<V extends HalResource, T extends ResourceChangeset<V>>(fallback:V):T {\n    const state = this.multiState.get(fallback.href!) as InputState<T>;\n    let resource = fallback;\n    if (fallback.state) {\n      resource = fallback.state.getValueOr(fallback);\n    }\n    let changeset = state.value;\n\n    // If there is no changeset, or\n    // If there is an empty one for a older work package reference\n    // build a new changeset\n    if (changeset && !changeset.isEmpty()) {\n      return changeset;\n    }\n\n    if (!changeset) {\n      return this.edit<V, T>(resource);\n    }\n\n    if (resource.hasOwnProperty('lockVersion') && changeset.pristineResource.lockVersion < resource.lockVersion) {\n      return this.edit<V, T>(resource);\n    }\n\n    changeset.updatePristineResource(resource);\n    return changeset;\n  }\n\n  /**\n   * Get a temporary view on the resource being edited.\n   * IF there is a changeset:\n   *   - Merge the changeset, including its form, into the work package resource\n   * IF there is no changeset:\n   *   - The work package itself is returned.\n   *\n   *  This resource has a read only index signature to make it clear it is NOT\n   *  meant for editing.\n   *\n   * @return {State<HalResource>}\n   */\n  public temporaryEditResource<V extends HalResource, T extends ResourceChangeset<V>>(resource:V):State<V> {\n    const combined = combine(resource.state! as State<V>, this.typedState<V, T>(resource) as State<T>);\n\n    return deriveRaw(combined,\n      ($) => $\n        .pipe(\n          filter(([resource, _]) => !!resource),\n          map(([resource, change]) => {\n            if (change) {\n              change.updatePristineResource(resource as V);\n              return change.projectedResource;\n            }\n\n            return resource;\n          })\n        )\n    );\n  }\n\n  public stopEditing(resource:HalResource|{ href:string }) {\n    this.multiState.get(resource.href!).clear();\n  }\n\n  protected load(href:string):Promise<ResourceChangeset> {\n    return Promise.reject('Loading not applicable for changesets.') as any;\n  }\n\n  protected onSaved(saved:HalResource):Promise<unknown> {\n    if (saved.state) {\n      return saved.push(saved);\n    }\n\n    return Promise.resolve();\n  }\n\n  protected loadAll(hrefs:string[]) {\n    return Promise.all(hrefs.map(href => this.load(href))) as any;\n  }\n\n  protected get multiState():MultiInputState<ResourceChangeset> {\n    return this.stateGroup.changesets;\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n(function ($) {\n  \"use strict\";\n\n  $(function() {\n    // set selected page for menu tree if provided.\n    $('[data-selected-page].tree-menu--container').each(function(_i:number, tree:HTMLElement) {\n      let selectedPage = $(tree).data('selected-page');\n      if (selectedPage) {\n        $('[slug=' + selectedPage + ']', tree).toggleClass('-selected', true);\n      }\n    });\n\n    function toggle (event:any) {\n      // ignore the event if a key different from ENTER was pressed.\n      if (event.type === 'keypress' && event.which !== 13) { return false; }\n\n      let target = $(event.target);\n      let targetList = target.closest('ul.-with-hierarchy > li');\n      targetList.toggleClass('-hierarchy-collapsed -hierarchy-expanded');\n      return false;\n    }\n\n    // set click handlers for expanding and collapsing tree nodes\n    $('.pages-hierarchy.-with-hierarchy .tree-menu--hierarchy-span').on('click keypress', toggle);\n  });\n}(jQuery));\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {Moment} from 'moment';\nimport {AbstractDateTimeValueController} from '../abstract-filter-date-time-value/abstract-filter-date-time-value.controller'\nimport {Component, Input, OnInit, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'filter-date-times-value',\n  templateUrl: './filter-date-times-value.component.html'\n})\nexport class FilterDateTimesValueComponent extends AbstractDateTimeValueController implements OnInit {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new DebouncedEventEmitter<QueryFilterInstanceResource>(componentDestroyed(this));\n\n  readonly text = {\n    spacer: this.I18n.t('js.filter.value_spacer')\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly timezoneService:TimezoneService) {\n    super(I18n, timezoneService);\n  }\n\n  public get begin():HalResource|string {\n    return this.filter.values[0];\n  }\n\n  public set begin(val) {\n    this.filter.values[0] = val || '';\n    this.filterChanged.emit(this.filter);\n  }\n\n  public get end() {\n    return this.filter.values[1];\n  }\n\n  public set end(val) {\n    this.filter.values[1] = val || '';\n    this.filterChanged.emit(this.filter);\n  }\n\n  public get lowerBoundary():Moment|null {\n    if (this.begin && this.timezoneService.isValidISODateTime(this.begin.toString())) {\n      return this.timezoneService.parseDatetime(this.begin.toString());\n    } else {\n      return null;\n    }\n  }\n\n  public get upperBoundary():Moment|null {\n    if (this.end && this.timezoneService.isValidISODateTime(this.end.toString())) {\n      return this.timezoneService.parseDatetime(this.end.toString());\n    } else {\n      return null;\n    }\n  }\n}\n","<div id=\"div-values-{{filter.id}}\" class=\"inline-label\">\n  <op-date-picker (onChange)=\"begin = isoDateParser($event)\"\n                  [initialDate]=\"isoDateFormatter(begin)\"\n                  [focus]=\"shouldFocus\"\n                  required=\"true\"\n                  [id]=\"'values-' + filter.id + '-begin'\"\n                  [name]=\"'v[' + filter.id + ']-begin'\"\n                  classes=\"advanced-filters--date-field\"\n                  size=\"10\">\n  </op-date-picker>\n\n  <span class=\"advanced-filters--affix\" [textContent]=\"text.spacer\">\n  </span>\n\n  <op-date-picker (onChange)=\"end = isoDateParser($event)\"\n                  [initialDate]=\"isoDateFormatter(end)\"\n                  [id]=\"'values-' + filter.id + '-end'\"\n                  [name]=\"'v[' + filter.id + ']-end'\"\n                  classes=\"advanced-filters--date-field\"\n                  size=\"10\">\n  </op-date-picker>\n  <span class=\"advanced-filters--tooltip-trigger -multiline\"\n        *ngIf=\"isTimeZoneDifferent\"\n        [attr.data-tooltip]=\"timeZoneText\">\n    <op-icon icon-classes=\"icon icon-warning\"></op-icon>\n  </span>\n</div>\n","import {ChangeDetectorRef, ElementRef, EventEmitter, OnDestroy, OnInit} from '@angular/core';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {OpModalService} from 'core-components/op-modals/op-modal.service';\n\nexport abstract class OpModalComponent implements OnInit, OnDestroy {\n\n  /* Close on escape? */\n  public closeOnEscape:boolean = true;\n  public closeOnEscapeFunction = this.closeMe;\n\n  /* Close on outside click */\n  public closeOnOutsideClick:boolean = true;\n\n  /* Reference to service */\n  protected service:OpModalService = this.locals.service;\n\n  public $element:JQuery;\n\n  /** Closing event called from the service when closing this modal */\n  public closingEvent = new EventEmitter<this>();\n\n  public openingEvent = new EventEmitter<this>();\n\n  constructor(public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n  }\n\n  ngOnDestroy() {\n    this.closingEvent.complete();\n    this.openingEvent.complete();\n  }\n\n  /**\n   * Called when the user attempts to close the modal window.\n   * The service will close this modal if this method returns true\n   * @returns {boolean}\n   */\n  public onClose():boolean {\n    this.afterFocusOn && this.afterFocusOn.focus();\n    return true;\n  }\n\n  public closeMe(evt?:JQuery.TriggeredEvent) {\n    this.service.close();\n\n    if (evt) {\n      evt.stopPropagation();\n      evt.preventDefault();\n    }\n  }\n\n  public onOpen(modalElement:JQuery) {\n    this.openingEvent.emit();\n    this.cdRef.detectChanges();\n  }\n\n  protected get afterFocusOn():JQuery {\n    return this.$element;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {BehaviorSubject} from 'rxjs';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {DeviceService} from \"app/modules/common/browser/device.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Injectable({ providedIn: 'root' })\nexport class MainMenuToggleService {\n  public toggleTitle:string;\n  private elementWidth:number;\n  private elementMinWidth = 11;\n  private readonly defaultWidth:number = 230;\n  private readonly localStorageKey:string = 'openProject-mainMenuWidth';\n  private readonly localStorageStateKey:string = 'openProject-mainMenuCollapsed';\n\n  @InjectField() currentProject:CurrentProjectService;\n\n  private global = (window as any);\n  private htmlNode = document.getElementsByTagName('html')[0];\n  private mainMenu = jQuery('#main-menu')[0];  // main menu, containing sidebar and resizer\n  private hideElements = jQuery('.can-hide-navigation');\n\n  // Title needs to be sync in main-menu-toggle.component.ts and main-menu-resizer.component.ts\n  private titleData = new BehaviorSubject<string>('');\n  public titleData$ = this.titleData.asObservable();\n\n  // Notes all changes of the menu size (currently needed in wp-resizer.component.ts)\n  private changeData = new BehaviorSubject<any>({});\n  public changeData$ = this.changeData.asObservable();\n\n  constructor(protected I18n:I18nService,\n              public injector:Injector,\n              readonly deviceService:DeviceService) {\n  }\n\n  public initializeMenu():void {\n    if (!this.mainMenu) { return; }\n\n    this.elementWidth = parseInt(window.OpenProject.guardedLocalStorage(this.localStorageKey) as string);\n    const menuCollapsed = window.OpenProject.guardedLocalStorage(this.localStorageStateKey) as string;\n\n    if (!this.elementWidth) {\n      this.saveWidth(this.mainMenu.offsetWidth);\n    } else if (menuCollapsed && JSON.parse(menuCollapsed)) {\n      this.closeMenu();\n    }\n    else {\n      this.setWidth();\n    }\n\n    let currentProject:CurrentProjectService = this.injector.get(CurrentProjectService);\n    if (jQuery(document.body).hasClass('controller-my') && this.elementWidth === 0 || currentProject.id === null) {\n      this.saveWidth(this.defaultWidth);\n    }\n\n    // mobile version default: hide menu on initialization\n    this.closeWhenOnMobile();\n  }\n\n  // click on arrow or hamburger icon\n  public toggleNavigation(event?:JQuery.TriggeredEvent):void {\n    if (event) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n\n    if (!this.showNavigation) { // sidebar is hidden -> show menu\n      if (this.deviceService.isMobile) { // mobile version\n        this.setWidth(window.innerWidth);\n      } else { // desktop version\n        const savedWidth = parseInt(window.OpenProject.guardedLocalStorage(this.localStorageKey) as string);\n        const widthToSave = savedWidth >= this.elementMinWidth ? savedWidth : this.defaultWidth;\n\n        this.saveWidth(widthToSave);\n      }\n    } else { // sidebar is expanded -> close menu\n      this.closeMenu();\n    }\n\n    // Set focus on first visible main menu item.\n    // This needs to be called after AngularJS has rendered the menu, which happens some when after(!) we leave this\n    // method here. So we need to set the focus after a timeout.\n    setTimeout(function () {\n      jQuery('#main-menu [class*=\"-menu-item\"]:visible').first().focus();\n    }, 500);\n  }\n\n  public closeMenu():void {\n    this.setWidth(0);\n    window.OpenProject.guardedLocalStorage(this.localStorageStateKey, 'true');\n    jQuery('.wp-query-menu--search-input').blur();\n  }\n\n  public closeWhenOnMobile():void {\n    if (this.deviceService.isMobile) {\n      this.closeMenu();\n      window.OpenProject.guardedLocalStorage(this.localStorageStateKey, 'false');\n    }\n  }\n  public saveWidth(width?:number):void {\n    this.setWidth(width);\n    window.OpenProject.guardedLocalStorage(this.localStorageKey, String(this.elementWidth));\n    window.OpenProject.guardedLocalStorage(this.localStorageStateKey, String(this.elementWidth === 0));\n  }\n\n  public setWidth(width?:any):void {\n    if (width !== undefined) {\n      // Leave a minimum amount of space for space fot the content\n      let maxMenuWidth = this.deviceService.isMobile ? window.innerWidth - 120 : window.innerWidth - 520;\n      if (width > maxMenuWidth) {\n        this.elementWidth = maxMenuWidth;\n      } else {\n        this.elementWidth = width as number;\n      }\n    }\n\n    this.snapBack();\n    this.setToggleTitle();\n    this.toggleClassHidden();\n\n    this.global.showNavigation = this.showNavigation;\n    this.htmlNode.style.setProperty(\"--main-menu-width\", this.elementWidth + 'px');\n\n    // Send change event when size of menu is changing (menu toggled or resized)\n    // Event should only be fired, when transition is finished\n    let changeEvent = jQuery.Event(\"change\");\n    jQuery('#content-wrapper').on('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd', () => {\n      this.changeData.next(changeEvent);\n    });\n  }\n\n  public get showNavigation():boolean {\n    return (this.elementWidth >= this.elementMinWidth);\n  }\n\n  private snapBack():void {\n    if (this.elementWidth < this.elementMinWidth) {\n      this.elementWidth = 0;\n    }\n  }\n\n  private setToggleTitle():void {\n    if (this.showNavigation) {\n      this.toggleTitle = this.I18n.t('js.label_hide_project_menu');\n    } else {\n      this.toggleTitle = this.I18n.t('js.label_expand_project_menu');\n    }\n    this.titleData.next(this.toggleTitle);\n  }\n\n  private toggleClassHidden():void {\n    this.hideElements.toggleClass('hidden-navigation', !this.showNavigation);\n  }\n}\n","import {GroupObject} from 'core-app/modules/hal/resources/wp-collection-resource';\n\nexport function groupIdentifier(group:GroupObject) {\n  let value = group.value || 'nullValue';\n\n  if (group.href) {\n    try {\n      value += group.href.map(el => el.href).join('-');\n    } catch (e) {\n      console.error('Failed to extract group identifier for ' + group.value);\n    }\n  }\n\n  value = value.toLowerCase().replace(/[^a-z0-9]+/g, '-');\n  return `${groupByProperty(group)}-${value}`;\n}\n\nexport function groupName(group:GroupObject) {\n  let value = group.value;\n  if (value === null) {\n    return '-';\n  } else {\n    return value;\n  }\n}\n\nexport function groupByProperty(group:GroupObject):string {\n  return group._links.groupBy.href.split('/').pop()!;\n}\n\n/**\n * Get the row group class name for the given group id.\n */\nexport function groupedRowClassName(groupIndex:number) {\n  return `__row-group-${groupIndex}`;\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, EventEmitter, Input, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\n\n@Component({\n  selector: 'filter-boolean-value',\n  templateUrl: './filter-boolean-value.component.html'\n})\nexport class FilterBooleanValueComponent {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new EventEmitter<QueryFilterInstanceResource>();\n\n  public text = {\n    placeholder: this.I18n.t('js.placeholders.selection'),\n    true: this.I18n.t('js.general_text_Yes'),\n    false: this.I18n.t('js.general_text_No')\n  };\n\n  constructor(readonly I18n:I18nService) {\n  }\n\n  public get value():HalResource | string {\n    return this.filter.values[0];\n  }\n\n  public set value(val) {\n    this.filter.values[0] = val;\n    this.filterChanged.emit(this.filter);\n  }\n\n  public get hasNoValue() {\n    return _.isEmpty(this.filter.values);\n  }\n\n  public get availableOptions() {\n    return [true, false];\n  }\n}\n","<div id=\"div-values-{{filter.name}}\">\n  <select [(ngModel)]=\"value\"\n          [focus]=\"shouldFocus\"\n          class=\"advanced-filters--select-field\"\n          id=\"values-{{filter.name}}\"\n          name=\"v[{{filter.name}}]\" >\n    <option value=\"\"\n            disabled\n            [textContent]=\"text.placeholder\"\n            *ngIf=\"hasNoValue\">\n    </option>\n    <option *ngFor=\"let value of availableOptions\"\n            [textContent]=\"text[value]\"\n            [ngValue]=\"value\"></option>\n  </select>\n</div>\n","var map = {\n\t\"./apl/apl.js\": [\n\t\t\"4kmW\",\n\t\t0,\n\t\t26\n\t],\n\t\"./asciiarmor/asciiarmor.js\": [\n\t\t\"Jt+K\",\n\t\t0,\n\t\t27\n\t],\n\t\"./asn.1/asn.1.js\": [\n\t\t\"0OHD\",\n\t\t0,\n\t\t28\n\t],\n\t\"./asterisk/asterisk.js\": [\n\t\t\"yGjk\",\n\t\t0,\n\t\t29\n\t],\n\t\"./brainfuck/brainfuck.js\": [\n\t\t\"oF4/\",\n\t\t0,\n\t\t30\n\t],\n\t\"./clike/clike.js\": [\n\t\t\"S6bl\",\n\t\t0,\n\t\t5\n\t],\n\t\"./clojure/clojure.js\": [\n\t\t\"LA1u\",\n\t\t0,\n\t\t31\n\t],\n\t\"./cmake/cmake.js\": [\n\t\t\"qE+Q\",\n\t\t0,\n\t\t32\n\t],\n\t\"./cobol/cobol.js\": [\n\t\t\"JNJg\",\n\t\t0,\n\t\t33\n\t],\n\t\"./coffeescript/coffeescript.js\": [\n\t\t\"oL3q\",\n\t\t0,\n\t\t1\n\t],\n\t\"./commonlisp/commonlisp.js\": [\n\t\t\"kmAK\",\n\t\t0,\n\t\t34\n\t],\n\t\"./crystal/crystal.js\": [\n\t\t\"JRJP\",\n\t\t0,\n\t\t35\n\t],\n\t\"./css/css.js\": [\n\t\t\"ewDg\",\n\t\t0,\n\t\t3\n\t],\n\t\"./cypher/cypher.js\": [\n\t\t\"vW+e\",\n\t\t0,\n\t\t36\n\t],\n\t\"./d/d.js\": [\n\t\t\"zRyg\",\n\t\t0,\n\t\t37\n\t],\n\t\"./dart/dart.js\": [\n\t\t\"6q/U\",\n\t\t0,\n\t\t5,\n\t\t38\n\t],\n\t\"./diff/diff.js\": [\n\t\t\"3fnu\",\n\t\t0,\n\t\t39\n\t],\n\t\"./django/django.js\": [\n\t\t\"SzTn\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t1,\n\t\t17\n\t],\n\t\"./dockerfile/dockerfile.js\": [\n\t\t\"R6x9\",\n\t\t0,\n\t\t1,\n\t\t40\n\t],\n\t\"./dtd/dtd.js\": [\n\t\t\"/YIB\",\n\t\t0,\n\t\t41\n\t],\n\t\"./dylan/dylan.js\": [\n\t\t\"PLH4\",\n\t\t0,\n\t\t42\n\t],\n\t\"./ebnf/ebnf.js\": [\n\t\t\"AvIz\",\n\t\t0,\n\t\t43\n\t],\n\t\"./ecl/ecl.js\": [\n\t\t\"rSpl\",\n\t\t0,\n\t\t44\n\t],\n\t\"./eiffel/eiffel.js\": [\n\t\t\"t86p\",\n\t\t0,\n\t\t45\n\t],\n\t\"./elm/elm.js\": [\n\t\t\"Rba3\",\n\t\t0,\n\t\t46\n\t],\n\t\"./erlang/erlang.js\": [\n\t\t\"9RTS\",\n\t\t0,\n\t\t47\n\t],\n\t\"./factor/factor.js\": [\n\t\t\"yv4w\",\n\t\t0,\n\t\t1,\n\t\t48\n\t],\n\t\"./fcl/fcl.js\": [\n\t\t\"xvvs\",\n\t\t0,\n\t\t49\n\t],\n\t\"./forth/forth.js\": [\n\t\t\"CDkR\",\n\t\t0,\n\t\t50\n\t],\n\t\"./fortran/fortran.js\": [\n\t\t\"UYub\",\n\t\t0,\n\t\t51\n\t],\n\t\"./gas/gas.js\": [\n\t\t\"Upog\",\n\t\t0,\n\t\t52\n\t],\n\t\"./gfm/gfm.js\": [\n\t\t\"RKCW\",\n\t\t0,\n\t\t7,\n\t\t1,\n\t\t53\n\t],\n\t\"./gherkin/gherkin.js\": [\n\t\t\"tkAH\",\n\t\t0,\n\t\t54\n\t],\n\t\"./go/go.js\": [\n\t\t\"T/QY\",\n\t\t0,\n\t\t55\n\t],\n\t\"./groovy/groovy.js\": [\n\t\t\"X7TR\",\n\t\t0,\n\t\t56\n\t],\n\t\"./haml/haml.js\": [\n\t\t\"c+b1\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t1,\n\t\t18\n\t],\n\t\"./handlebars/handlebars.js\": [\n\t\t\"4d6s\",\n\t\t0,\n\t\t1\n\t],\n\t\"./haskell-literate/haskell-literate.js\": [\n\t\t\"INem\",\n\t\t0,\n\t\t1,\n\t\t57\n\t],\n\t\"./haskell/haskell.js\": [\n\t\t\"0+DK\",\n\t\t0,\n\t\t1\n\t],\n\t\"./haxe/haxe.js\": [\n\t\t\"We/1\",\n\t\t0,\n\t\t58\n\t],\n\t\"./htmlembedded/htmlembedded.js\": [\n\t\t\"dLt8\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t1,\n\t\t19\n\t],\n\t\"./htmlmixed/htmlmixed.js\": [\n\t\t\"1p+/\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t24\n\t],\n\t\"./http/http.js\": [\n\t\t\"scEK\",\n\t\t0,\n\t\t59\n\t],\n\t\"./idl/idl.js\": [\n\t\t\"HqpV\",\n\t\t0,\n\t\t60\n\t],\n\t\"./javascript/javascript.js\": [\n\t\t\"+dQi\",\n\t\t0,\n\t\t2\n\t],\n\t\"./jinja2/jinja2.js\": [\n\t\t\"ToA7\",\n\t\t0,\n\t\t61\n\t],\n\t\"./jsx/jsx.js\": [\n\t\t\"onn/\",\n\t\t0,\n\t\t2,\n\t\t25\n\t],\n\t\"./julia/julia.js\": [\n\t\t\"NGrM\",\n\t\t0,\n\t\t62\n\t],\n\t\"./livescript/livescript.js\": [\n\t\t\"5RX+\",\n\t\t0,\n\t\t63\n\t],\n\t\"./lua/lua.js\": [\n\t\t\"jrMQ\",\n\t\t0,\n\t\t64\n\t],\n\t\"./markdown/markdown.js\": [\n\t\t\"lZu9\",\n\t\t0,\n\t\t7\n\t],\n\t\"./mathematica/mathematica.js\": [\n\t\t\"ztbM\",\n\t\t0,\n\t\t65\n\t],\n\t\"./mbox/mbox.js\": [\n\t\t\"6mA5\",\n\t\t0,\n\t\t66\n\t],\n\t\"./mirc/mirc.js\": [\n\t\t\"o5kb\",\n\t\t0,\n\t\t67\n\t],\n\t\"./mllike/mllike.js\": [\n\t\t\"NU+Z\",\n\t\t0,\n\t\t68\n\t],\n\t\"./modelica/modelica.js\": [\n\t\t\"lQiH\",\n\t\t0,\n\t\t69\n\t],\n\t\"./mscgen/mscgen.js\": [\n\t\t\"6gTk\",\n\t\t0,\n\t\t70\n\t],\n\t\"./mumps/mumps.js\": [\n\t\t\"Q7su\",\n\t\t0,\n\t\t71\n\t],\n\t\"./nginx/nginx.js\": [\n\t\t\"srmC\",\n\t\t0,\n\t\t72\n\t],\n\t\"./nsis/nsis.js\": [\n\t\t\"bYLO\",\n\t\t0,\n\t\t1,\n\t\t73\n\t],\n\t\"./ntriples/ntriples.js\": [\n\t\t\"PWBO\",\n\t\t0,\n\t\t74\n\t],\n\t\"./octave/octave.js\": [\n\t\t\"mybg\",\n\t\t0,\n\t\t75\n\t],\n\t\"./oz/oz.js\": [\n\t\t\"yhmh\",\n\t\t0,\n\t\t76\n\t],\n\t\"./pascal/pascal.js\": [\n\t\t\"lB9V\",\n\t\t0,\n\t\t77\n\t],\n\t\"./pegjs/pegjs.js\": [\n\t\t\"ZGb1\",\n\t\t0,\n\t\t2,\n\t\t78\n\t],\n\t\"./perl/perl.js\": [\n\t\t\"kG+r\",\n\t\t0,\n\t\t79\n\t],\n\t\"./php/php.js\": [\n\t\t\"RNWO\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t5,\n\t\t20\n\t],\n\t\"./pig/pig.js\": [\n\t\t\"860+\",\n\t\t0,\n\t\t80\n\t],\n\t\"./powershell/powershell.js\": [\n\t\t\"naPG\",\n\t\t0,\n\t\t81\n\t],\n\t\"./properties/properties.js\": [\n\t\t\"3Fvf\",\n\t\t0,\n\t\t82\n\t],\n\t\"./protobuf/protobuf.js\": [\n\t\t\"cHwl\",\n\t\t0,\n\t\t83\n\t],\n\t\"./pug/pug.js\": [\n\t\t\"W+/v\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t6\n\t],\n\t\"./puppet/puppet.js\": [\n\t\t\"cwoo\",\n\t\t0,\n\t\t84\n\t],\n\t\"./python/python.js\": [\n\t\t\"25Eh\",\n\t\t0,\n\t\t1\n\t],\n\t\"./q/q.js\": [\n\t\t\"MiqB\",\n\t\t0,\n\t\t85\n\t],\n\t\"./r/r.js\": [\n\t\t\"kD6b\",\n\t\t0,\n\t\t86\n\t],\n\t\"./rpm/rpm.js\": [\n\t\t\"Qs4+\",\n\t\t0,\n\t\t87\n\t],\n\t\"./rst/rst.js\": [\n\t\t\"jIQM\",\n\t\t0,\n\t\t1,\n\t\t88\n\t],\n\t\"./ruby/ruby.js\": [\n\t\t\"hTYL\",\n\t\t0,\n\t\t1\n\t],\n\t\"./rust/rust.js\": [\n\t\t\"sY4N\",\n\t\t0,\n\t\t1,\n\t\t89\n\t],\n\t\"./sas/sas.js\": [\n\t\t\"Sh3j\",\n\t\t0,\n\t\t90\n\t],\n\t\"./sass/sass.js\": [\n\t\t\"G2Pi\",\n\t\t0,\n\t\t3,\n\t\t1\n\t],\n\t\"./scheme/scheme.js\": [\n\t\t\"8wdy\",\n\t\t0,\n\t\t91\n\t],\n\t\"./shell/shell.js\": [\n\t\t\"AvDn\",\n\t\t0,\n\t\t92\n\t],\n\t\"./sieve/sieve.js\": [\n\t\t\"1dRh\",\n\t\t0,\n\t\t93\n\t],\n\t\"./slim/slim.js\": [\n\t\t\"VI2i\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t1,\n\t\t21\n\t],\n\t\"./smalltalk/smalltalk.js\": [\n\t\t\"n4Nj\",\n\t\t0,\n\t\t94\n\t],\n\t\"./smarty/smarty.js\": [\n\t\t\"QWhe\",\n\t\t0,\n\t\t95\n\t],\n\t\"./solr/solr.js\": [\n\t\t\"xhF3\",\n\t\t0,\n\t\t96\n\t],\n\t\"./soy/soy.js\": [\n\t\t\"vH+N\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t22\n\t],\n\t\"./sparql/sparql.js\": [\n\t\t\"++e5\",\n\t\t0,\n\t\t97\n\t],\n\t\"./spreadsheet/spreadsheet.js\": [\n\t\t\"bEWP\",\n\t\t0,\n\t\t98\n\t],\n\t\"./sql/sql.js\": [\n\t\t\"/9rB\",\n\t\t0,\n\t\t99\n\t],\n\t\"./stex/stex.js\": [\n\t\t\"+NIl\",\n\t\t0,\n\t\t1\n\t],\n\t\"./stylus/stylus.js\": [\n\t\t\"dtKC\",\n\t\t0,\n\t\t8\n\t],\n\t\"./swift/swift.js\": [\n\t\t\"wOIU\",\n\t\t0,\n\t\t100\n\t],\n\t\"./tcl/tcl.js\": [\n\t\t\"BEBj\",\n\t\t0,\n\t\t101\n\t],\n\t\"./textile/textile.js\": [\n\t\t\"TD3l\",\n\t\t0,\n\t\t102\n\t],\n\t\"./tiddlywiki/tiddlywiki.js\": [\n\t\t\"9+NH\",\n\t\t0,\n\t\t103\n\t],\n\t\"./tiki/tiki.js\": [\n\t\t\"Km7L\",\n\t\t0,\n\t\t104\n\t],\n\t\"./toml/toml.js\": [\n\t\t\"0sou\",\n\t\t0,\n\t\t105\n\t],\n\t\"./tornado/tornado.js\": [\n\t\t\"xbNY\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t1,\n\t\t23\n\t],\n\t\"./troff/troff.js\": [\n\t\t\"s1o1\",\n\t\t0,\n\t\t106\n\t],\n\t\"./ttcn-cfg/ttcn-cfg.js\": [\n\t\t\"hmTv\",\n\t\t0,\n\t\t107\n\t],\n\t\"./ttcn/ttcn.js\": [\n\t\t\"TYrp\",\n\t\t0,\n\t\t108\n\t],\n\t\"./turtle/turtle.js\": [\n\t\t\"P3N9\",\n\t\t0,\n\t\t109\n\t],\n\t\"./twig/twig.js\": [\n\t\t\"SII/\",\n\t\t0,\n\t\t1,\n\t\t110\n\t],\n\t\"./vb/vb.js\": [\n\t\t\"Kr55\",\n\t\t0,\n\t\t111\n\t],\n\t\"./vbscript/vbscript.js\": [\n\t\t\"axah\",\n\t\t0,\n\t\t112\n\t],\n\t\"./velocity/velocity.js\": [\n\t\t\"/kYp\",\n\t\t0,\n\t\t113\n\t],\n\t\"./verilog/verilog.js\": [\n\t\t\"m2bc\",\n\t\t0,\n\t\t114\n\t],\n\t\"./vhdl/vhdl.js\": [\n\t\t\"PP56\",\n\t\t0,\n\t\t115\n\t],\n\t\"./vue/vue.js\": [\n\t\t\"aT2M\",\n\t\t0,\n\t\t2,\n\t\t3,\n\t\t8,\n\t\t6,\n\t\t1,\n\t\t116\n\t],\n\t\"./webidl/webidl.js\": [\n\t\t\"PVgs\",\n\t\t0,\n\t\t117\n\t],\n\t\"./xml/xml.js\": [\n\t\t\"1eCo\",\n\t\t0,\n\t\t118\n\t],\n\t\"./xquery/xquery.js\": [\n\t\t\"bJEP\",\n\t\t0,\n\t\t119\n\t],\n\t\"./yacas/yacas.js\": [\n\t\t\"WThJ\",\n\t\t0,\n\t\t120\n\t],\n\t\"./yaml-frontmatter/yaml-frontmatter.js\": [\n\t\t\"0gIM\",\n\t\t0,\n\t\t1,\n\t\t121\n\t],\n\t\"./yaml/yaml.js\": [\n\t\t\"ztCB\",\n\t\t0,\n\t\t1\n\t],\n\t\"./z80/z80.js\": [\n\t\t\"dRHf\",\n\t\t0,\n\t\t122\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(function() {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = \"TKcc\";\nmodule.exports = webpackAsyncContext;","export const PERMITTED_CONTEXT_MENU_ACTIONS = [\n  {\n    key: 'log_time',\n    link: 'logTime',\n    resource: 'workPackage'\n  },\n  {\n    key: 'change_project',\n    icon: 'icon-move',\n    link: 'move',\n    resource: 'workPackage'\n  },\n  {\n    key: 'copy',\n    link: 'copy',\n    resource: 'workPackage'\n  },\n  {\n    key: 'delete',\n    link: 'delete',\n    resource: 'workPackage'\n  },\n  {\n    key: 'export-pdf',\n    link: 'pdf',\n    resource: 'workPackage'\n  },\n  {\n    key: 'export-atom',\n    link: 'atom',\n    resource: 'workPackage'\n  }\n];\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\n\n@Injectable()\nexport class UserDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public load(id:number|string):Promise<UserResource> {\n    const path = this.pathHelper.api.v3.users.id(id).toString();\n\n    return this.halResourceService\n      .get<UserResource>(path)\n      .toPromise();\n  }\n}\n","<div class=\"op-modal--portal op-modal--macro-modal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container\" tabindex=\"1\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <form class=\"form -vertical\" (submit)=\"applyAndClose($event)\">\n        <fieldset class=\"form--fieldset\">\n          <legend [textContent]=\"text.page\"></legend>\n          <div class=\"form--field\">\n            <label\n                for=\"selected-page\"\n                [textContent]=\"text.page\"\n                class=\"form--label hidden-for-sighted\">\n            </label>\n            <div class=\"form--field-container\">\n              <div class=\"form--select-container\">\n                <input\n                    #selectedPageInput\n                    tabindex=\"2\"\n                    type=\"text\"\n                    id=\"selected-page\"\n                    name=\"selected-page\"\n                    [value]=\"selectedPage\"\n                    (change)=\"selectedPage = $event.target.value\"\n                    class=\"form--select\" />\n              </div>\n            </div>\n            <p [textContent]=\"text.hint\"></p>\n            <p><kbd>project-identifier:my-wiki-page</kbd></p>\n          </div>\n        </fieldset>\n      </form>\n    </div>\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"op-modal--cancel-button button\"\n              (click)=\"closeMe($event)\"\n              tabindex=\"4\"\n              [textContent]=\"text.button_cancel\"\n              [attr.title]=\"text.button_cancel\">\n      </button>\n      <button class=\"op-modal--submit-button button -highlight\"\n              (click)=\"applyAndClose($event)\"\n              tabindex=\"3\"\n              [textContent]=\"text.button_save\"\n              [attr.title]=\"text.button_save\">\n      </button>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {AfterViewInit, ChangeDetectorRef, Component, ElementRef, Inject, ViewChild} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  templateUrl: './wiki-include-page-macro.modal.html'\n})\nexport class WikiIncludePageMacroModal extends OpModalComponent implements AfterViewInit {\n\n  public changed = false;\n  public showClose = true;\n  public closeOnEscape = true;\n  public closeOnOutsideClick = true;\n\n  public selectedPage:string;\n  public page:string = '';\n\n  @ViewChild('selectedPageInput', { static: true }) selectedPageInput:ElementRef;\n\n  public text:any = {\n    title: this.I18n.t('js.editor.macro.wiki_page_include.button'),\n    hint: this.I18n.t('js.editor.macro.wiki_page_include.hint'),\n    page: this.I18n.t('js.editor.macro.wiki_page_include.page'),\n    button_save: this.I18n.t('js.button_save'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n    this.selectedPage = this.page = this.locals.page;\n\n    // We could provide an autocompleter here to get correct page names\n  }\n\n  public applyAndClose(evt:JQuery.TriggeredEvent) {\n    this.changed = true;\n    this.page = this.selectedPage;\n    this.closeMe(evt);\n  }\n\n  ngAfterViewInit() {\n    this.selectedPageInput.nativeElement.focus();\n  }\n}\n\n","<div class=\"op-modal--portal op-modal--macro-modal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container -wide\" tabindex=\"1\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <form class=\"form -vertical\">\n        <textarea name=\"codemirror-element\"\n                  id=\"codemirror-element\"\n                  [ngModel]=\"content\"\n                  #codeMirrorPane></textarea>\n        <hr/>\n        <div class=\"form--field\">\n          <label\n              for=\"selected-language\"\n              [textContent]=\"text.language\"\n              class=\"form--label hidden-for-sighted\">\n          </label>\n          <div class=\"form--field-container\">\n            <div class=\"form--select-container\">\n              <input\n                  #selectedLanguage\n                  tabindex=\"2\"\n                  type=\"text\"\n                  id=\"selected-language\"\n                  name=\"selected-language\"\n                  [ngModel]=\"language\"\n                  (ngModelChange)=\"updateLanguage($event)\"\n                  class=\"form--select\" />\n            </div>\n          </div>\n          <p [textContent]=\"text.language_hint\"></p>\n        </div>\n      </form>\n    </div>\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"op-modal--cancel-button button\"\n              (click)=\"closeMe($event)\"\n              tabindex=\"4\"\n              [textContent]=\"text.button_cancel\"\n              [attr.title]=\"text.button_cancel\">\n      </button>\n      <button class=\"op-modal--submit-button button -highlight\"\n              (click)=\"applyAndClose($event)\"\n              tabindex=\"3\"\n              [textContent]=\"text.button_save\"\n              [attr.title]=\"text.button_save\">\n      </button>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {AfterViewInit, ChangeDetectorRef, Component, ElementRef, Inject, ViewChild} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  templateUrl: './code-block-macro.modal.html'\n})\nexport class CodeBlockMacroModal extends OpModalComponent implements AfterViewInit {\n\n  public changed = false;\n  public showClose = true;\n  public closeOnEscape = true;\n  public closeOnOutsideClick = true;\n\n  // Language class from markdown, something like 'language-ruby'\n  public languageClass:string;\n\n  // Language string, e.g, 'ruby'\n  public _language:string = '';\n  public content:string;\n\n  // Codemirror instance\n  public codeMirrorInstance:undefined|any;\n\n  public debouncedLanguageLoader = _.debounce(() => this.loadLanguageAsMode(this.language), 300);\n\n  @ViewChild('codeMirrorPane', { static: true }) codeMirrorPane:ElementRef;\n\n  public text:any = {\n    title: this.I18n.t('js.editor.macro.code_block.title'),\n    language: this.I18n.t('js.editor.macro.code_block.language'),\n    language_hint: this.I18n.t('js.editor.macro.code_block.language_hint'),\n    button_save: this.I18n.t('js.button_save'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n    this.languageClass = locals.languageClass || 'language-text';\n    this.content = locals.content;\n\n    const match = this.languageClass.match(/language-(\\w+)/);\n    if (match) {\n      this.language = match[1];\n    } else {\n      this.language = 'text';\n    }\n  }\n\n  public applyAndClose(evt:JQuery.TriggeredEvent) {\n    this.content = this.codeMirrorInstance.getValue();\n    const lang = this.language || 'text';\n    this.languageClass = `language-${lang}`;\n\n    this.changed = true;\n    this.closeMe(evt);\n  }\n\n  ngAfterViewInit() {\n    import('codemirror').then((imported:any) => {\n      const CodeMirror = imported.default;\n      this.codeMirrorInstance = CodeMirror.fromTextArea(\n        this.codeMirrorPane.nativeElement,\n        {\n          lineNumbers: true,\n          smartIndent: true,\n          autofocus: true,\n          value: this.content,\n          mode: ''\n        }\n      );\n    });\n  }\n\n  get language() {\n    return this._language;\n  }\n\n  set language(val:string) {\n    this._language = val;\n    this.debouncedLanguageLoader();\n  }\n\n  loadLanguageAsMode(language:string) {\n    // For the special language 'text', don't try to load anything\n    if (!language || language === 'text') {\n      return this.updateCodeMirrorMode('');\n    }\n\n    import(/* webpackChunkName: \"codemirror-mode\" */ `codemirror/mode/${language}/${language}.js`)\n      .then(() => {\n        this.updateCodeMirrorMode(language);\n      })\n      .catch((e) => {\n        console.error(`Failed to load language ${language}: ${e}`);\n        this.updateCodeMirrorMode('');\n      });\n  }\n\n  updateCodeMirrorMode(newLanguage:string) {\n    const editor = this.codeMirrorInstance;\n    editor && editor.setOption('mode', newLanguage);\n  }\n\n  updateLanguage(newValue?:string) {\n    if (!newValue) {\n      this.language = '';\n      return;\n    }\n\n    if (newValue.match(/^\\w+$/)) {\n      this.language = newValue;\n    } else {\n      console.error(\"Not updating non-matching language: \" + newValue);\n    }\n  }\n}\n\n","<div class=\"op-modal--portal op-modal--macro-modal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container\" tabindex=\"1\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <form class=\"form -vertical\" (submit)=\"applyAndClose($event)\">\n        <fieldset class=\"form--fieldset\">\n          <legend [textContent]=\"text.page\"></legend>\n          <div class=\"form--field\">\n            <label\n                for=\"selected-page\"\n                [textContent]=\"text.page\"\n                class=\"form--label hidden-for-sighted\">\n            </label>\n            <div class=\"form--field-container\">\n              <div class=\"form--select-container\">\n                <input\n                    #selectedPageInput\n                    tabindex=\"2\"\n                    type=\"text\"\n                    id=\"selected-page\"\n                    name=\"selected-page\"\n                    [value]=\"selectedPage\"\n                    (change)=\"selectedPage = $event.target.value\"\n                    class=\"form--select\"\n                    placeholder=\"my-project:my-page\" />\n              </div>\n            </div>\n          </div>\n          <div class=\"form--field\">\n            <div class=\"form--field-container\">\n              <label class=\"form--label-with-check-box\">\n                <div class=\"form--check-box-container\">\n                  <input\n                          #parentIncludedInput\n                          tabindex=\"3\"\n                          type=\"checkbox\"\n                          id=\"include-parent\"\n                          name=\"include-parent\"\n                          [ngModel]=\"selectedIncludeParent\"\n                          (ngModelChange)=\"updateIncludeParent($event)\"\n                          class=\"form--check-box\" />\n                </div>\n                {{ text.include_parent }}\n              </label>\n            </div>\n          </div>\n          <p [textContent]=\"text.hint\"></p>\n        </fieldset>\n      </form>\n    </div>\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"op-modal--cancel-button button\"\n              (click)=\"closeMe($event)\"\n              tabindex=\"4\"\n              [textContent]=\"text.button_cancel\"\n              [attr.title]=\"text.button_cancel\">\n      </button>\n      <button class=\"op-modal--submit-button button -highlight\"\n              (click)=\"applyAndClose($event)\"\n              tabindex=\"3\"\n              [textContent]=\"text.button_save\"\n              [attr.title]=\"text.button_save\">\n      </button>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {AfterViewInit, ChangeDetectorRef, Component, ElementRef, Inject, ViewChild} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  templateUrl: './child-pages-macro.modal.html'\n})\nexport class ChildPagesMacroModal extends OpModalComponent implements AfterViewInit {\n\n  public changed = false;\n  public showClose = true;\n  public closeOnEscape = true;\n  public closeOnOutsideClick = true;\n\n  public selectedPage:string;\n  public selectedIncludeParent:boolean;\n  public page:string = '';\n  public includeParent:boolean = false;\n\n  @ViewChild('selectedPageInput', { static: true }) selectedPageInput:ElementRef;\n\n  public text:any = {\n    title: this.I18n.t('js.editor.macro.child_pages.button'),\n    hint: this.I18n.t('js.editor.macro.child_pages.hint'),\n    page: this.I18n.t('js.editor.macro.child_pages.page'),\n    include_parent: this.I18n.t('js.editor.macro.child_pages.include_parent'),\n    button_save: this.I18n.t('js.button_save'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n    this.selectedPage = this.page = this.locals.page;\n    this.selectedIncludeParent = this.includeParent = this.locals.includeParent;\n\n    // We could provide an autocompleter here to get correct page names\n  }\n\n  public applyAndClose(evt:JQuery.TriggeredEvent) {\n    this.changed = true;\n    this.page = this.selectedPage;\n    this.includeParent = this.selectedIncludeParent;\n    this.closeMe(evt);\n  }\n\n  ngAfterViewInit() {\n    this.selectedPageInput.nativeElement.focus();\n  }\n\n  updateIncludeParent(val:boolean) {\n    this.selectedIncludeParent = val;\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {Injectable, Injector} from \"@angular/core\";\nimport {WpButtonMacroModal} from \"core-components/modals/editor/macro-wp-button-modal/wp-button-macro.modal\";\nimport {WikiIncludePageMacroModal} from \"core-components/modals/editor/macro-wiki-include-page-modal/wiki-include-page-macro.modal\";\nimport {CodeBlockMacroModal} from \"core-components/modals/editor/macro-code-block-modal/code-block-macro.modal\";\nimport {ChildPagesMacroModal} from \"core-components/modals/editor/macro-child-pages-modal/child-pages-macro.modal\";\n\n@Injectable()\nexport class EditorMacrosService {\n\n  constructor(readonly opModalService:OpModalService,\n              readonly injector:Injector) {\n  }\n\n  /**\n   * Show a modal to edit the work package button macro settings.\n   * Used from within ckeditor.\n   */\n  public configureWorkPackageButton(typeName?:string, classes?:string):Promise<{ type:string, classes:string }> {\n    return new Promise<{ type:string, classes:string }>((resolve, reject) => {\n      const modal = this.opModalService.show(WpButtonMacroModal, this.injector, { type: typeName, classes: classes });\n      modal.closingEvent.subscribe((modal:WpButtonMacroModal) => {\n        if (modal.changed) {\n          resolve({type: modal.type, classes: modal.classes});\n        }\n      });\n    });\n  }\n\n  /**\n   * Show a modal to edit the wiki include macro.\n   * Used from within ckeditor.\n   */\n  public configureWikiPageInclude(page:string):Promise<string> {\n    return new Promise<string>((resolve, _) => {\n      const pageValue = page || '';\n      const modal = this.opModalService.show(WikiIncludePageMacroModal, this.injector, { page: pageValue });\n      modal.closingEvent.subscribe((modal:WikiIncludePageMacroModal) => {\n        if (modal.changed) {\n          resolve(modal.page);\n        }\n      });\n    });\n  }\n\n  /**\n   * Show a modal to show an enhanced code editor for editing code blocks.\n   * Used from within ckeditor.\n   */\n  public editCodeBlock(content:string, languageClass:string):Promise<{ content:string, languageClass:string }> {\n    return new Promise<{ content:string, languageClass:string }>((resolve, _) => {\n      const modal = this.opModalService.show(CodeBlockMacroModal, this.injector, { content: content, languageClass: languageClass });\n      modal.closingEvent.subscribe((modal:CodeBlockMacroModal) => {\n        if (modal.changed) {\n          resolve({languageClass: modal.languageClass, content: modal.content});\n        }\n      });\n    });\n  }\n\n   /**\n   * Show a modal to edit the child pages macro.\n   * Used from within ckeditor.\n   */\n  public configureChildPages(page:string, includeParent:string):Promise<object> {\n    return new Promise<object>((resolve, _) => {\n      const modal = this.opModalService.show(ChildPagesMacroModal, this.injector,{ page: page, includeParent: includeParent });\n      modal.closingEvent.subscribe((modal:ChildPagesMacroModal) => {\n        if (modal.changed) {\n          resolve({\n            page: modal.page,\n            includeParent: modal.includeParent\n          });\n        }\n      });\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Input, OnInit} from \"@angular/core\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n\n@Component({\n  selector: 'activity-entry',\n  templateUrl: './activity-entry.component.html'\n})\nexport class ActivityEntryComponent implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public activity:any;\n  @Input() public activityNo:number;\n  @Input() public isInitial:boolean;\n\n  public projectId:string;\n  public activityType:string;\n\n  constructor(readonly PathHelper:PathHelperService,\n              readonly I18n:I18nService) {\n  }\n\n\n  ngOnInit() {\n    this.projectId = this.workPackage.project.idFromLink;\n\n    this.activityType = this.activity._type;\n  }\n}\n\n","<div id=\"activity-{{ activityNo }}\">\n  <div [ngSwitch]=\"activityType\">\n    <revision-activity *ngSwitchCase=\"'Revision'\"\n                       [workPackage]=\"workPackage\"\n                       [activity]=\"activity\"\n                       [activityNo]=\"activityNo\">\n    </revision-activity>\n    <user-activity *ngSwitchDefault\n                   [workPackage]=\"workPackage\"\n                   [activity]=\"activity\"\n                   [activityNo]=\"activityNo\"\n                   [isInitial]=\"isInitial\">\n    </user-activity>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Inject,\n  ViewChild\n} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {TypeResource} from \"core-app/modules/hal/resources/type-resource\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {WorkPackageDmService} from \"core-app/modules/hal/dm-services/work-package-dm.service\";\n\n@Component({\n  templateUrl: './wp-button-macro.modal.html'\n})\nexport class WpButtonMacroModal extends OpModalComponent implements AfterViewInit {\n\n  public changed = false;\n  public showClose = true;\n  public closeOnEscape = true;\n  public closeOnOutsideClick = true;\n\n  public selectedType:string;\n  public buttonStyle:boolean;\n\n  public availableTypes:TypeResource[];\n  public type:string = '';\n  public classes:string = '';\n\n  @ViewChild('typeSelect', { static: true }) typeSelect:ElementRef;\n\n  public text:any = {\n    title: this.I18n.t('js.editor.macro.work_package_button.button'),\n    none: this.I18n.t('js.label_none'),\n    selected_type: this.I18n.t('js.editor.macro.work_package_button.type'),\n    button_style: this.I18n.t('js.editor.macro.work_package_button.button_style'),\n    button_style_hint: this.I18n.t('js.editor.macro.work_package_button.button_style_hint'),\n    button_save: this.I18n.t('js.button_save'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              protected currentProject:CurrentProjectService,\n              readonly workPackageDmService:WorkPackageDmService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n    this.selectedType = this.type = this.locals.type;\n    this.classes = this.locals.classes;\n    this.buttonStyle = this.classes === 'button';\n\n    this.workPackageDmService\n      .emptyCreateForm({}, this.currentProject.identifier)\n      .then((form:any) => {\n        this.availableTypes = form.schema.type.allowedValues;\n      });\n  }\n\n  public applyAndClose(evt:JQuery.TriggeredEvent) {\n    this.changed = true;\n    this.classes = this.buttonStyle ? 'button' : '';\n    this.type = this.selectedType;\n    this.closeMe(evt);\n  }\n\n  ngAfterViewInit() {\n    this.typeSelect.nativeElement.focus();\n  }\n}\n\n","<div class=\"op-modal--portal op-modal--macro-modal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <form class=\"form -vertical\" (submit)=\"applyAndClose($event)\">\n        <fieldset class=\"form--fieldset\">\n          <legend [textContent]=\"text.selected_type\"></legend>\n          <div class=\"form--field\">\n            <label\n                for=\"selected-type\"\n                [textContent]=\"text.selected_type\"\n                class=\"form--label hidden-for-sighted\">\n            </label>\n            <div class=\"form--field-container\">\n              <div class=\"form--select-container\">\n                <select\n                    #typeSelect\n                    id=\"selected-type\"\n                    tabindex=\"1\"\n                    name=\"selected-type\"\n                    (change)=\"selectedType = $event.target.value\"\n                    class=\"form--select\">\n                  <option [textContent]=\"text.none\"\n                          [selected]=\"!selectedType\"\n                          [value]=\"\"></option>\n                  <option *ngFor=\"let type of availableTypes\"\n                          [textContent]=\"type.name\"\n                          [selected]=\"selectedType === type.name\"\n                          [value]=\"type.name\"></option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </fieldset>\n\n        <div class=\"form--field -wide-label\">\n          <div class=\"form--field-container -vertical\">\n            <label class=\"form--label-with-check-box\">\n              <div class=\"form--check-box-container\">\n                <input type=\"checkbox\"\n                       tabindex=\"2\"\n                       id=\"wp_button_macro_style\"\n                       (change)=\"buttonStyle = $event.target.checked\"\n                       [checked]=\"buttonStyle\"\n                       name=\"button_style\" />\n              </div>\n              {{ text.button_style }}\n            </label>\n          </div>\n        </div>\n        <p [textContent]=\"text.button_style_hint\"></p>\n      </form>\n    </div>\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"op-modal--cancel-button button\"\n              (click)=\"closeMe($event)\"\n              tabindex=\"4\"\n              [textContent]=\"text.button_cancel\"\n              [attr.title]=\"text.button_cancel\">\n      </button>\n      <button class=\"op-modal--submit-button button -highlight\"\n              (click)=\"applyAndClose($event)\"\n              tabindex=\"3\"\n              [textContent]=\"text.button_save\"\n              [attr.title]=\"text.button_save\">\n      </button>\n    </div>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nexport class PaginationInstance {\n\n  constructor(public page:number,\n              public total:number,\n              public perPage:number) {\n  }\n\n  public getLowerPageBound() {\n    return this.perPage * (this.page - 1) + 1;\n  }\n\n  public getUpperPageBound(limit:number) {\n    return Math.min(this.perPage * this.page, limit);\n  }\n\n  public nextPage() {\n    this.page += 1;\n  }\n\n  public previousPage() {\n    this.page -= 1;\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nexport type WorkPackageTableConfigurationObject = Partial<{ [field in keyof WorkPackageTableConfiguration]:string|boolean }>;\n\nexport class WorkPackageTableConfiguration {\n  /** Render the table results, set to false when only wanting the table initialization */\n  public tableVisible:boolean = true;\n\n  /** Render the table as compact style */\n  public compactTableStyle:boolean = false;\n\n  /** Render the action column (last column) with the actions defined in the TableActionsService */\n  public actionsColumnEnabled:boolean = true;\n\n  /** Whether the work package context menu is enabled*/\n  public contextMenuEnabled:boolean = true;\n\n  /** Whether the column dropdown menu is enabled*/\n  public columnMenuEnabled:boolean = true;\n\n  /** Whether the query should be resolved using the current project identifier */\n  public projectContext:boolean = true;\n\n  /** Whether the embedded table should live within a specific project context (e.g., given by its parent) */\n  public projectIdentifier:string|null = null;\n\n  /** Whether inline create is enabled*/\n  public inlineCreateEnabled:boolean = true;\n\n  /** Whether the hierarchy toggler item in the subject column is enabled */\n  public hierarchyToggleEnabled:boolean = true;\n\n  /** Whether this table supports drag and drop */\n  public dragAndDropEnabled:boolean = false;\n\n  /** Whether this table is in an embedded context*/\n  public isEmbedded:boolean = false;\n\n  /** Whether the work packages shall be shown in cards instead of a table */\n  public isCardView:boolean = false;\n\n  /** Whether this table provides a UI for filters*/\n  public withFilters:boolean = false;\n\n  /** Whether the filters are expanded */\n  public filtersExpanded:boolean = false;\n\n  /** Whether the button to open filters shall be visible*/\n  public showFilterButton:boolean = false;\n\n  /** Whether this table provides a UI for filters*/\n  public filterButtonText:string = I18n.t(\"js.button_filter\");\n\n  constructor(providedConfig:WorkPackageTableConfigurationObject) {\n    _.each(providedConfig, (value, k) => {\n      let key = (k as keyof WorkPackageTableConfiguration);\n      (this as any)[key] = value;\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {InputState, MultiInputState, State} from 'reactivestates';\nimport {Observable} from \"rxjs\";\nimport {auditTime, map, startWith} from \"rxjs/operators\";\n\nexport abstract class StateCacheService<T> {\n  private cacheDurationInMs:number;\n\n  constructor(private holdValuesForSeconds:number = 3600) {\n    this.cacheDurationInMs = holdValuesForSeconds * 1000;\n  }\n\n  public state(id:string):State<T> {\n    return this.multiState.get(id);\n  }\n\n  /**\n   * Touch the current state to fire subscribers.\n   */\n  public touch(id:string):void {\n    const state = this.multiState.get(id);\n    state.putValue(state.value, 'Touching the state');\n  }\n\n  /**\n   * Get the current value\n   */\n  public current(id:string, fallback?:T):T|undefined {\n    return this.state(id).getValueOr(fallback);\n  }\n\n  /**\n   * Update the value due to application changes.\n   *\n   * @param id The value's identifier.\n   * @param val<T> The value.\n   */\n  public updateValue(id:string, val:T) {\n    this.multiState.get(id).putValue(val);\n  }\n\n  /**\n   * Observe the value of the given id\n   */\n  public observe(id:string):Observable<T> {\n    return this.state(id).values$();\n  }\n\n  /**\n   * Observe the changes of the given id\n   */\n  public changes$(id:string):Observable<T|undefined> {\n    return this.state(id).changes$();\n  }\n\n  /**\n   * Observe the entire set of loaded results\n   */\n  public observeAll():Observable<T[]> {\n    return this.multiState\n      .observeChange()\n      .pipe(\n        startWith([]),\n        auditTime(250),\n        map(() => {\n          let mapped:T[] = [];\n          _.each(this.multiState.getValueOr({}), (state:State<T>) => {\n            if (state.value) {\n              mapped.push(state.value);\n            }\n          });\n\n          return mapped;\n        })\n      );\n  }\n\n  /**\n   * Clear a set of cached states.\n   * @param ids\n   */\n  public clearSome(...ids:string[]) {\n    ids.forEach(id => this.multiState.get(id).clear());\n  }\n\n  /**\n   * Require the value to be loaded either when forced or the value is stale\n   * according to the cache interval specified for this service.\n   *\n   * @param id The value's identifier.\n   * @param force Load the value anyway.\n   */\n  public require(id:string, force:boolean = false):Promise<T> {\n    const state = this.multiState.get(id);\n\n    // Refresh when stale or being forced\n    if (this.stale(state) || force) {\n      let promise = this.load(id);\n      state.clearAndPutFromPromise(promise);\n      return promise;\n    }\n\n    return state.valuesPromise() as Promise<T>;\n  }\n\n  /**\n   * Require the value to be loaded either when forced or the value is stale\n   * according to the cache interval specified for this service.\n   *\n   * Returns an observable to the values stream of the state.\n   *\n   * @param id The value's identifier.\n   * @param force Load the value anyway.\n   */\n  public requireAndStream(id:string, force:boolean = false):Observable<T> {\n    const state = this.multiState.get(id);\n\n    // Refresh when stale or being forced\n    if (this.stale(state) || force) {\n      state.clear();\n      state.putFromPromiseIfPristine(() => this.load(id));\n    }\n\n    return state.values$();\n  }\n\n  /**\n   * Require the states of the given ids to be loaded if they're empty or stale,\n   * or all when force is given.\n   * @param ids Ids to require\n   * @param force Load the values anyway\n   * @return {Promise<undefined>} An empty promise to mark when the set of states is filled.\n   */\n  public requireAll(ids:string[], force:boolean = false):Promise<unknown> {\n    let idsToRequest:string[];\n\n    if (force) {\n      idsToRequest = ids;\n    } else {\n      idsToRequest = ids.filter((id:string) => this.stale(this.multiState.get(id)));\n    }\n\n    if (idsToRequest.length === 0) {\n      return Promise.resolve(undefined);\n    }\n\n    return this.loadAll(idsToRequest);\n  }\n\n  /**\n   * Returns whether the state\n   * @param state\n   * @return {boolean}\n   */\n  protected stale(state:InputState<T>):boolean {\n    // If there is an active request that is still pending\n    if (state.hasActivePromiseRequest()) {\n      return false;\n    }\n\n    return state.isPristine() || state.isValueOlderThan(this.cacheDurationInMs);\n  }\n\n  /**\n   * Returns the internal state object\n   */\n  protected abstract get multiState():MultiInputState<T>;\n\n  /**\n   * Load a single value into the cache state.\n   * Subclassses need to ensure it gets loaded and resolve or reject the promise\n   * @param id The identifier of the value object of type T.\n   */\n  protected abstract load(id:string):Promise<T>;\n\n  /**\n   * Load a set of required values, fill the results into the appropriate states\n   * and return a promise when all values are inserted.\n   */\n  protected abstract loadAll(ids:string[]):Promise<undefined|unknown>;\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackagesListService} from '../../wp-list/wp-list.service';\nimport {States} from '../../states.service';\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {ChangeDetectorRef, Component, ElementRef, Inject, OnInit} from \"@angular/core\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {StateService} from '@uirouter/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageService} from \"core-components/work-packages/work-package.service\";\nimport {BackRoutingService} from \"core-app/modules/common/back-routing/back-routing.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  templateUrl: './wp-destroy.modal.html'\n})\nexport class WpDestroyModal extends OpModalComponent implements OnInit {\n  // When deleting multiple\n  public workPackages:WorkPackageResource[];\n  public workPackageLabel:string;\n\n  // Single work package\n  public singleWorkPackage:WorkPackageResource;\n  public singleWorkPackageChildren:WorkPackageResource[];\n  public busy = false;\n\n  // Need to confirm deletion when children are involved\n  public childrenDeletionConfirmed = false;\n\n  public text:any = {\n    label_visibility_settings: this.I18n.t('js.label_visibility_settings'),\n    button_save: this.I18n.t('js.modals.button_save'),\n    confirm: this.I18n.t('js.button_confirm'),\n    warning: this.I18n.t('js.label_warning'),\n    cancel: this.I18n.t('js.button_cancel'),\n    close: this.I18n.t('js.close_popup_title'),\n    label_confirm_children_deletion: this.I18n.t('js.modals.destroy_work_package.confirm_deletion_children'),\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              readonly WorkPackageService:WorkPackageService,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly $state:StateService,\n              readonly states:States,\n              readonly wpTableFocus:WorkPackageViewFocusService,\n              readonly wpListService:WorkPackagesListService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly backRoutingService:BackRoutingService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.workPackages = this.locals.workPackages;\n    this.workPackageLabel = this.I18n.t('js.units.workPackage', { count: this.workPackages.length });\n\n    // Ugly way to provide the same view bindings as the ng-init in the previous template.\n    if (this.workPackages.length === 1) {\n      this.singleWorkPackage = this.workPackages[0];\n      this.singleWorkPackageChildren = this.singleWorkPackage.children;\n    }\n\n    this.text.title = this.I18n.t('js.modals.destroy_work_package.title', { label: this.workPackageLabel }),\n      this.text.text = this.I18n.t('js.modals.destroy_work_package.text', {\n        label: this.workPackageLabel,\n        count: this.workPackages.length\n      });\n\n    this.text.childCount = (wp:WorkPackageResource) => {\n      const count = this.children(wp).length;\n      return this.I18n.t('js.units.child_work_packages', { count: count });\n    };\n\n    this.text.hasChildren = (wp:WorkPackageResource) =>\n      this.I18n.t('js.modals.destroy_work_package.has_children', { childUnits: this.text.childCount(wp) }),\n\n      this.text.deletesChildren = this.I18n.t('js.modals.destroy_work_package.deletes_children');\n  }\n\n  public get blockedDueToUnconfirmedChildren() {\n    return this.mustConfirmChildren && !this.childrenDeletionConfirmed;\n  }\n\n  public get mustConfirmChildren() {\n    let result = false;\n\n    if (this.singleWorkPackage && this.singleWorkPackageChildren) {\n      let result = this.singleWorkPackageChildren.length > 0;\n    }\n\n    return result || !!_.find(this.workPackages, wp =>\n      wp.children && wp.children.length > 0);\n  }\n\n  public confirmDeletion($event:JQuery.TriggeredEvent) {\n    if (this.busy || this.blockedDueToUnconfirmedChildren) {\n      return false;\n    }\n\n    this.busy = true;\n    this.WorkPackageService.performBulkDelete(this.workPackages.map(el => el.id!), true)\n      .then(() => {\n        this.busy = false;\n        this.closeMe($event);\n        this.wpTableFocus.clear('Clearing after destroying work packages');\n\n        // Go back to a previous list state if we're in a split or full view\n        if (this.$state.current.data.baseRoute) {\n          this.backRoutingService.goBack(true);\n        }\n      })\n      .catch(() => {\n        this.busy = false;\n      });\n\n    return false;\n  }\n\n  public children(workPackage:WorkPackageResource) {\n    if (workPackage.hasOwnProperty('children')) {\n      return workPackage.children;\n    } else {\n      return [];\n    }\n  }\n}\n","<div class=\"op-modal--portal\">\n  <div id=\"wp_destroy_modal\"\n       class=\"op-modal--modal-container wp-table--configuration-modal loading-indicator--location -highlight -danger-zone\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\">\n        <i class=\"icon-close\"\n           (click)=\"closeMe($event)\"\n           [attr.title]=\"text.close\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"op-modal--modal-body\">\n      <ng-container *ngIf=\"singleWorkPackage\">\n        <p>\n          <span [textContent]=\"text.text\"></span>\n          <br/>\n          <strong>\n            {{ singleWorkPackage.type.name }}\n            #{{ singleWorkPackage.id }}\n            {{ singleWorkPackage.subject }}\n          </strong>\n        </p>\n        <div *ngIf=\"singleWorkPackageChildren && singleWorkPackageChildren.length > 0\">\n          <p class=\"danger-zone--warning\">\n            <span class=\"icon-context icon-error\"></span>\n            <strong [textContent]=\"text.warning\"></strong>:\n            <span [textContent]=\"text.hasChildren(singleWorkPackage)\"></span>\n          </p>\n          <ul>\n            <li *ngFor=\"let child of singleWorkPackageChildren\">\n              #<span [textContent]=\"child.id\"></span>\n              <span [textContent]=\"child.subject || ''\"></span>\n            </li>\n          </ul>\n          <p>\n            <span [textContent]=\"text.deletesChildren\"></span>\n          </p>\n        </div>\n      </ng-container>\n      <ng-container *ngIf=\"workPackages.length > 1\">\n        <p class=\"danger-zone--warning\">\n          <span class=\"icon-context icon-error\"></span>\n          <strong [textContent]=\"text.text\"></strong>\n        </p>\n        <ul>\n          <li *ngFor=\"let wp of workPackages\">\n            #<span [textContent]=\"wp.id\"></span>\n            &ngsp;\n            <span [textContent]=\"wp.subject\"></span>\n            <strong *ngIf=\"children(wp).length > 0\">\n              (+ {{ text.childCount(wp) }})\n            </strong>\n          </li>\n        </ul>\n      </ng-container>\n      <div *ngIf=\"mustConfirmChildren\">\n        <label class=\"form--label-with-check-box\">\n          <div class=\"form--check-box-container\">\n            <input type=\"checkbox\"\n                   name=\"confirm-children-deletion\"\n                   id=\"confirm-children-deletion\"\n                   [(ngModel)]=\"childrenDeletionConfirmed\"\n                   class=\"form--check-box\" />\n          </div>\n          {{ text.label_confirm_children_deletion }}\n        </label>\n      </div>\n    </div>\n\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"button -danger\"\n              [textContent]=\"text.confirm\"\n              [attr.disabled]=\"busy || blockedDueToUnconfirmedChildren || undefined\"\n              (click)=\"confirmDeletion($event)\">\n      </button>\n      <button class=\"button\"\n              [textContent]=\"text.cancel\"\n              (click)=\"closeMe($event)\">\n      </button>\n    </div>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {HelpTextResource} from 'core-app/modules/hal/resources/help-text-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {Injectable} from '@angular/core';\n\n@Injectable()\nexport class HelpTextDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public loadAll():Promise<CollectionResource<HelpTextResource>> {\n    return this.halResourceService\n      .get<CollectionResource<HelpTextResource>>(this.pathHelper.api.v3.help_texts.toString())\n      .toPromise();\n  }\n\n  public load(helpTextId:string):Promise<HelpTextResource> {\n    return this.halResourceService\n      .get<HelpTextResource>(this.pathHelper.api.v3.help_texts.id(helpTextId).toString())\n      .toPromise();\n  }\n}\n","\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {WorkPackageViewGroupByService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service';\nimport {QueryGroupByResource} from 'core-app/modules/hal/resources/query-group-by-resource';\nimport {WorkPackageViewHierarchiesService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service';\nimport {WorkPackageViewSumService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service';\nimport {Component, Injector} from \"@angular/core\";\n\n@Component({\n  templateUrl: './display-settings-tab.component.html'\n})\nexport class WpTableConfigurationDisplaySettingsTab implements TabComponent {\n\n  // Display mode\n  public displayMode:'hierarchy'|'grouped'|'default' = 'default';\n\n  // Grouping\n  public currentGroup:QueryGroupByResource|null;\n  public availableGroups:QueryGroupByResource[] = [];\n\n  // Sums row display\n  public displaySums:boolean = false;\n\n  public text = {\n    choose_mode: this.I18n.t('js.work_packages.table_configuration.choose_display_mode'),\n    label_group_by: this.I18n.t('js.label_group_by'),\n    title: this.I18n.t('js.label_group_by'),\n    placeholder: this.I18n.t('js.placeholders.default'),\n    please_select: this.I18n.t('js.placeholders.selection'),\n    default: '— ' + this.I18n.t('js.work_packages.table_configuration.default'),\n    display_sums: this.I18n.t('js.work_packages.query.display_sums'),\n    display_sums_hint: '— ' + this.I18n.t('js.work_packages.table_configuration.display_sums_hint'),\n    display_mode: {\n      default: this.I18n.t('js.work_packages.table_configuration.default_mode'),\n      grouped: this.I18n.t('js.work_packages.table_configuration.grouped_mode'),\n      hierarchy: this.I18n.t('js.work_packages.table_configuration.hierarchy_mode'),\n      hierarchy_hint: '— ' + this.I18n.t('js.work_packages.table_configuration.hierarchy_hint')\n    }\n  };\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly wpTableGroupBy:WorkPackageViewGroupByService,\n              readonly wpTableHierarchies:WorkPackageViewHierarchiesService,\n              readonly wpTableSums:WorkPackageViewSumService) {\n  }\n\n  public onSave() {\n    // Update hierarchy state\n    this.wpTableHierarchies.setEnabled(this.displayMode === 'hierarchy');\n\n    // Update grouping state\n    let group = this.displayMode === 'grouped' ? this.currentGroup : null;\n    this.wpTableGroupBy.update(group);\n\n    // Update sums state\n    this.wpTableSums.setEnabled(this.displaySums);\n  }\n\n  public updateGroup(href:string) {\n    this.displayMode = 'grouped';\n    this.currentGroup = _.find(this.availableGroups, group => group.href === href) || null;\n  }\n\n  ngOnInit() {\n    if (this.wpTableHierarchies.isEnabled) {\n      this.displayMode = 'hierarchy';\n    } else if (this.wpTableGroupBy.current) {\n      this.displayMode = 'grouped';\n    }\n\n    this.displaySums = this.wpTableSums.current;\n\n    this.wpTableGroupBy\n      .onReady()\n      .then(() => {\n        this.availableGroups = _.sortBy(this.wpTableGroupBy.available, 'name');\n        this.currentGroup = this.wpTableGroupBy.current;\n      });\n  }\n}\n","<div>\n  <form>\n    <p [textContent]=\"text.choose_mode\"></p>\n    <div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"displayMode\"\n                 value=\"default\"\n                 name=\"display_mode_switch\">\n          <op-icon icon-classes=\"icon-no-hierarchy\" [attr.icon-title]=\"text.display_mode.default\"></op-icon>\n          &ngsp;\n          <span [textContent]=\"text.display_mode.default\"></span>\n          &ngsp;\n          <span class=\"form--inline-instructions\" [textContent]=\"text.default\"></span>\n        </label>\n      </div>\n    </div>\n    <div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"displayMode\"\n                 value=\"hierarchy\"\n                 name=\"display_mode_switch\">\n          <op-icon icon-classes=\"icon-hierarchy\" [attr.icon-title]=\"text.display_mode.hierarchy\"></op-icon>\n          &ngsp;\n          <span [textContent]=\"text.display_mode.hierarchy\"></span>\n          &ngsp;\n          <span *ngIf=\"displayMode === 'hierarchy'\"\n                class=\"form--inline-instructions\"\n                [textContent]=\"text.display_mode.hierarchy_hint\"></span>\n        </label>\n      </div>\n    </div>\n    <div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"displayMode\"\n                 value=\"grouped\"\n                 name=\"display_mode_switch\">\n          <op-icon icon-classes=\"icon-group-by\" [attr.icon-title]=\"text.label_group_by\"></op-icon>\n          &ngsp;\n          <span [textContent]=\"text.label_group_by\"></span>\n          &ngsp;\n          <select (change)=\"updateGroup($event.target.value)\"\n                  id=\"selected_grouping\"\n                  name=\"selected_grouping\"\n                  class=\"form--select form--inline-select\">\n            <option *ngFor=\"let group of availableGroups\"\n                    [textContent]=\"group.name\"\n                    [selected]=\"currentGroup && currentGroup!.href === group.href\"\n                    [value]=\"group.href\"></option>\n          </select>\n        </label>\n      </div>\n    </div>\n\n    <hr/>\n\n    <div>\n      <div class=\"form--field -full-width\">\n        <div class=\"form--field-container\">\n          <label class=\"option-label\">\n            <input type=\"checkbox\"\n                   (change)=\"displaySums = !displaySums\"\n                   [checked]=\"displaySums\"\n                   name=\"display_sums_switch\">\n            {{ text.display_sums }}\n            <span class=\"form--inline-instructions\" [textContent]=\"text.display_sums_hint\"></span>\n          </label>\n        </div>\n      </div>\n\n    </div>\n  </form>\n</div>\n","import {QueryOrder} from \"core-app/modules/hal/dm-services/query-order-dm.service\";\nimport {debugLog, timeOutput} from \"core-app/helpers/debug_output\";\n\n// min allowed position\nexport const MIN_ORDER = -2147483647;\n// max postgres 4-byte integer position\nexport const MAX_ORDER = 2147483647;\n// default position to insert\nexport const DEFAULT_ORDER = 0;\n// The distance to keep between each element\nexport const ORDER_DISTANCE = 16384;\n\n/**\n * Computes the delta of positions for a given\n * operation and order\n */\nexport class ReorderDeltaBuilder {\n\n  // We are building a delta of positions we need to update\n  // ideally this will only be one, but more may need to be set (initially)\n  // or shifted in case of spacing issues\n  private delta:QueryOrder = {};\n\n  /**\n   * Create a delta builder\n   *\n   * @param order The current order of work packages that contains the user movement\n   * @param positions The current positions as loaded from backend / persisted from previous calls\n   * @param wpId The work package that got moved\n   * @param index The index a work package got moved into\n   * @param fromIndex If moved within the order, the previous index used for movement optimzation\n   */\n  constructor(readonly order:string[],\n              readonly positions:QueryOrder,\n              readonly wpId:string,\n              readonly index:number,\n              readonly fromIndex:number|null) {\n  }\n\n  public buildDelta():QueryOrder {\n    timeOutput(`Building delta for ${this.wpId}@${this.index}`, () => {\n\n      // Ensure positions are strictly ascending. There may be cases were this does not happen\n      // e.g., having a flat sorted list and turning on hierarchy mode\n      if (!this.isAscendingOrder()) {\n        this.rebuildPositions();\n      } else {\n        // Insert only the new element\n        this.buildInsertPosition();\n      }\n    });\n\n    debugLog(\"Order DELTA was built as %O\", this.delta);\n\n    return this.delta;\n  }\n\n\n  /**\n   * Ensure +order+ is already ascending with the exception of +index+,\n   * or otherwise reorder the positions starting from the first element.\n   */\n  private isAscendingOrder() {\n    let current:number|undefined;\n\n    for (let i = 0, l = this.order.length; i < l; i++) {\n      const id = this.order[i];\n      const position = this.positions[id];\n\n      // Skip our insertion point\n      if (i === this.index) {\n        continue;\n      }\n\n      // If neither position is set\n      if (current === undefined || position === undefined) {\n        current = position;\n        continue;\n      }\n\n      // If the next position is not larger, rebuild positions\n      if (position < current) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Reassign mixed positions so that they are strictly ascending again,\n   * but try to keep relative positions alive\n   */\n  private rebuildPositions() {\n    let [min, max] = this.minMaxPositions;\n    this.redistribute(min, max);\n  }\n\n  /**\n   * Insert +wpId+ at +index+ in a position that is determined either\n   * by its neighbors, one of them in case both do not yet have a position\n   */\n  private buildInsertPosition() {\n    // Special case, order is empty or only contains wpId\n    // Then simply insert as the default position unless it already has a position\n    if (this.order.length <= 1 && this.positions[this.wpId] === undefined) {\n      this.delta[this.wpId] = DEFAULT_ORDER;\n      return;\n    }\n\n    // Special case, shifted movement by one\n    if (this.fromIndex !== null && Math.abs(this.fromIndex - this.index) === 1 && this.positionSwap()) {\n      return;\n    }\n\n    // Special case, index is 0\n    if (this.index === 0) {\n      return this.insertAsFirst();\n    }\n\n    // Ensure previous positions exist so we can insert wpId @ index\n    const predecessorPosition = this.buildUpPredecessorPosition();\n\n    // Ensure we reorder when predecessor is at max already\n    if (predecessorPosition >= MAX_ORDER) {\n      debugLog(`Predecessor position is at max order, need to reorder`);\n      return this.reorderedInsert();\n    }\n\n    // Get the actual successor position, it might vary wildly from the optimal position\n    const successorPosition = this.positionFor(this.index + 1);\n\n    if (successorPosition === undefined) {\n      // Successor does not have a position yet (is NULL), any position will work\n      // so let's use the optimal one which is halfway to a potential successor\n      this.delta[this.wpId] = predecessorPosition + (ORDER_DISTANCE / 2);\n      return;\n    }\n\n    // Ensure we reorder when successor is at max already\n    if (successorPosition >= MAX_ORDER) {\n      debugLog(`Successor position is at max order, need to reorder`);\n      return this.reorderedInsert();\n    }\n\n    // successor exists and has a position\n    // We will want to insert at the half way from predecessorPosition ... successorPosition\n    const distance = Math.floor((successorPosition - predecessorPosition) / 2);\n\n    // If there is no space to insert, we're going to optimize the available space\n    if (distance < 1) {\n      debugLog(\"Cannot insert at optimal position, no space left. Need to reorder\");\n      return this.reorderedInsert();\n    }\n\n    this.delta[this.wpId] = predecessorPosition + distance;\n  }\n\n  /**\n   * Insert wpId as the first element\n   */\n  private insertAsFirst() {\n    // Get the actual successor position, it might vary wildly from the optimal position\n    const successorPosition = this.positionFor(this.index + 1);\n\n    // If the successor also has no position yet, simply assign the default\n    if (successorPosition === undefined) {\n      this.delta[this.wpId] = DEFAULT_ORDER;\n    } else {\n      this.delta[this.wpId] = successorPosition - (ORDER_DISTANCE / 2);\n    }\n  }\n\n  /**\n   * Since from and to index or only one apart,\n   * we can swap the positions.\n   */\n  private positionSwap():boolean {\n    const myPosition = this.positionFor(this.index!);\n    const neighbor = this.order[this.fromIndex!];\n    const neighborPosition = this.positionFor(this.fromIndex!);\n\n    // If either the neighbor or wpid have no position yet,\n    // go through the regular update flow\n    if (myPosition === undefined || neighborPosition === undefined) {\n      return false;\n    }\n\n    // Simply swap the two positions\n    this.delta[this.wpId] = neighborPosition;\n    this.delta[neighbor] = myPosition;\n\n    return true;\n  }\n\n\n  /**\n   * Builds any previous unset position from 0 .. index\n   * so we can properly insert the wpId @ index.\n   */\n  private buildUpPredecessorPosition() {\n    let predecessorPosition:number = DEFAULT_ORDER - ORDER_DISTANCE;\n\n    for (let i = 0; i < this.index; i++) {\n      const id = this.order[i];\n      const position = this.positions[id];\n\n      // If this current ID has no position yet, assign the current one\n      if (position === undefined) {\n        predecessorPosition = this.delta[id] = predecessorPosition + ORDER_DISTANCE;\n      } else {\n        predecessorPosition = position;\n      }\n    }\n\n    return predecessorPosition;\n  }\n\n  /**\n   * Return the position number for the given index\n   */\n  private positionFor(index:number):number|undefined {\n    const wpId = this.order[index];\n    return this.livePosition(wpId);\n  }\n\n  /**\n   * Return either the delta position or the previous persisted position,\n   * in that order.\n   *\n   * @param wpId\n   */\n  private livePosition(wpId:string):number|undefined {\n    return this.delta[wpId] || this.positions[wpId];\n  }\n\n  /**\n   * There was no space left at the desired insert position,\n   * we're going to evenly distribute all items again\n   */\n  private reorderedInsert() {\n    // Get the current distance between orders\n    // Both must be set by now due to +buildUpPredecessorPosition+ having run.\n    let min = this.firstPosition!;\n    let max = this.lastPosition!;\n\n    this.redistribute(min, max);\n  }\n\n  /**\n   * Distribute the items over a given min/max\n   */\n  private redistribute(min:number, max:number) {\n    const itemsToDistribute = this.order.length;\n\n    // We can keep min and max orders if distance/(items to distribute) >= 1\n    let space = Math.floor((max - min) / (itemsToDistribute - 1));\n\n    // If no space is left, first try to add to the max item\n    // Or subtract from the min item\n    if (space < 1) {\n      if ((max + itemsToDistribute) <= MAX_ORDER) {\n        max += itemsToDistribute;\n      } else if ((min - itemsToDistribute) >= MIN_ORDER) {\n        min -= itemsToDistribute;\n      } else {\n        // This should not happen in a 4-byte integer with our frontend\n        throw \"Elements cannot be moved further and no space is left. Too many elements\";\n      }\n\n      // Rebuild space\n      space = Math.floor((max - min) / (itemsToDistribute - 1));\n    }\n\n    // Assign positions for all values in between min/max\n    for (let i = 0; i < itemsToDistribute; i++) {\n      const wpId = this.order[i];\n      this.delta[wpId] = min + (i * space);\n    }\n  }\n\n  /**\n   * Get the absolute minimum and maximum positions\n   * currently assigned in the slot.\n   *\n   * If there is at least two positions assigned, returns the maximum\n   * between them.\n   *\n   * Otherwise, returns the optimum min max for the given order length.\n   */\n  private get minMaxPositions():[number, number] {\n    let min:number = MAX_ORDER;\n    let max:number = MIN_ORDER;\n    let any:boolean = false;\n\n    for (let i = this.order.length - 1; i >= 0; i--) {\n      let wpId = this.order[i];\n      let position = this.livePosition(wpId);\n\n      if (position !== undefined) {\n        min = Math.min(position, min);\n        max = Math.max(position, max);\n        any = true;\n      }\n    }\n\n    if (any && min !== max) {\n      return [min, max];\n    } else {\n      return [DEFAULT_ORDER, this.order.length * ORDER_DISTANCE];\n    }\n  }\n\n\n  /**\n   * Returns the minimal position assigned currently\n   */\n  private get firstPosition():number {\n    const wpId = this.order[0]!;\n    return this.livePosition(wpId)!;\n  }\n\n  /**\n   * Returns the maximum position assigned currently.\n   * Note that a list can be unpositioned at the beginning, so this may return undefined\n   */\n  private get lastPosition():number|undefined {\n    for (let i = this.order.length - 1; i >= 0; i--) {\n      let wpId = this.order[i];\n      let position = this.livePosition(wpId);\n\n      // Return the first set position.\n      if (position !== undefined) {\n        return position;\n      }\n    }\n\n    return;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {Injectable} from '@angular/core';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {States} from \"core-components/states.service\";\nimport {QuerySchemaResource} from \"core-app/modules/hal/resources/query-schema-resource\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {MAX_ORDER, ReorderDeltaBuilder} from \"core-app/modules/common/drag-and-drop/reorder-delta-builder\";\nimport {QueryOrder, QueryOrderDmService} from \"core-app/modules/hal/dm-services/query-order-dm.service\";\nimport {take} from \"rxjs/operators\";\nimport {InputState} from \"reactivestates\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {CausedUpdatesService} from \"core-app/modules/boards/board/caused-updates/caused-updates.service\";\n\n\n@Injectable()\nexport class WorkPackageViewOrderService extends WorkPackageQueryStateService<QueryOrder> {\n\n  constructor(protected readonly querySpace:IsolatedQuerySpace,\n              protected readonly queryOrderDm:QueryOrderDmService,\n              protected readonly states:States,\n              protected readonly causedUpdates:CausedUpdatesService,\n              protected readonly wpTableSortBy:WorkPackageViewSortByService,\n              protected readonly pathHelper:PathHelperService) {\n    super(querySpace);\n  }\n\n  public initialize(query:QueryResource, results:WorkPackageCollectionResource, schema?:QuerySchemaResource):Promise<unknown> {\n    // Take over our current value if the query is not saved\n    if (!query.persisted && this.positions.hasValue()) {\n      this.applyToQuery(query);\n    }\n\n\n    if (this.wpTableSortBy.isManualSortingMode) {\n      return this.withLoadedPositions();\n    }\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Move an item in the list\n   */\n  public async move(order:string[], wpId:string, toIndex:number):Promise<string[]> {\n    // Find index of the work package\n    let fromIndex:number = order.findIndex((id) => id === wpId);\n\n    order.splice(fromIndex, 1);\n    order.splice(toIndex, 0, wpId);\n\n    await this.assignPosition(order, wpId, toIndex, fromIndex);\n\n    return order;\n  }\n\n  /**\n   * Pull an item from the rendered list\n   */\n  public remove(order:string[], wpId:string):string[] {\n    _.remove(order, id => id === wpId);\n    this.update({ [wpId]: -1 });\n    return order;\n  }\n\n  /**\n   * Add an item to the list\n   */\n  public async add(order:string[], wpId:string, toIndex:number = -1):Promise<string[]> {\n    if (toIndex === -1) {\n      order.push(wpId);\n      toIndex = order.length - 1;\n    } else {\n      order.splice(toIndex, 0, wpId);\n    }\n\n    await this.assignPosition(order, wpId, toIndex);\n\n    return order;\n  }\n\n  public get applicable() {\n    return this.currentQuery.persisted;\n  }\n\n  protected get currentQuery():QueryResource {\n    return this.querySpace.query.value!;\n  }\n\n  /**\n   * Assign a position for the given work package and its index given the current order\n   * @param order Current order the work package was inserted to\n   * @param wpId The work package ID that was moved\n   * @param toIndex The id of the work package in order\n   */\n  protected async assignPosition(order:string[], wpId:string, toIndex:number, fromIndex:number|null = null) {\n    const positions = await this.withLoadedPositions();\n    const delta = new ReorderDeltaBuilder(order, positions, wpId, toIndex, fromIndex).buildDelta();\n\n    await this.update(delta);\n  }\n\n  protected get positions():InputState<QueryOrder> {\n    return this.updatesState;\n  }\n\n  /**\n   * Update the order state\n   */\n  public async update(delta:QueryOrder) {\n    let current = this.positions.getValueOr({});\n    this.positions.putValue({ ...current, ...delta });\n\n    // Push the update if the query is saved\n    if (this.currentQuery.persisted) {\n      const updatedAt = await this.queryOrderDm.update(this.currentQuery.id!, delta);\n      this.currentQuery.updatedAt = updatedAt;\n\n      // Remember that we caused this update\n      this.causedUpdates.add(this.currentQuery);\n    }\n\n    // Push into the query object\n    this.applyToQuery(this.currentQuery);\n\n    // Update the query\n    this.querySpace.query.putValue(this.currentQuery);\n  }\n\n  /**\n   * Initialize (or load if persisted) the order for the query space\n   */\n  public withLoadedPositions():Promise<QueryOrder> {\n    if (this.currentQuery.persisted) {\n      const value = this.positions.value;\n\n      // Remove empty or stale values given we can reload them\n      if ((value === {} || this.positions.isValueOlderThan(60000))) {\n        this.positions.clear(\"Clearing old positions value\");\n      }\n\n      // Load the current order from backend\n      this.positions.putFromPromiseIfPristine(\n        () => this.queryOrderDm.get(this.currentQuery.id!)\n      );\n    } else if (this.positions.isPristine()) {\n      // Insert an empty fallback in case we have no data yet\n      this.positions.putValue({});\n    }\n\n    return this.positions\n      .values$()\n      .pipe(take(1))\n      .toPromise();\n  }\n\n  public valueFromQuery(query:QueryResource) {\n    return undefined;\n  }\n\n  /**\n   * Return ordered work packages\n   */\n  orderedWorkPackages():WorkPackageResource[] {\n    const upstreamOrder = this.querySpace\n      .results\n      .value!\n      .elements\n      .map(wp => this.states.workPackages.get(wp.id!).getValueOr(wp));\n\n    if (this.currentQuery.persisted || this.positions.isPristine()) {\n      return upstreamOrder;\n    } else {\n      const positions = this.positions.value!;\n      return _.sortBy(upstreamOrder, (wp) => {\n        const pos = positions[wp.id!];\n        return pos !== undefined ? pos : MAX_ORDER;\n      });\n    }\n  }\n\n  applyToQuery(query:QueryResource):boolean {\n    query.orderedWorkPackages = this.positions.getValueOr({});\n    return false;\n  }\n\n  hasChanged(query:QueryResource):boolean {\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectorRef,\n  Directive,\n  ElementRef,\n  Inject,\n  InjectionToken,\n  Injector,\n  OnDestroy,\n  OnInit\n} from \"@angular/core\";\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Field, IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\n\nexport const OpEditingPortalSchemaToken = new InjectionToken('editing-portal--schema');\nexport const OpEditingPortalHandlerToken = new InjectionToken('editing-portal--handler');\nexport const OpEditingPortalChangesetToken = new InjectionToken('editing-portal--changeset');\n\nexport const overflowingContainerSelector = '.__overflowing_element_container';\nexport const overflowingContainerAttribute = 'overflowingIdentifier';\n\nexport const editModeClassName = '-editing';\n\n@Directive()\nexport abstract class EditFieldComponent extends Field implements OnInit, OnDestroy {\n  /** Self reference */\n  public self = this;\n\n  /** JQuery accessor to element ref */\n  protected $element:JQuery;\n\n  constructor(readonly I18n:I18nService,\n              readonly elementRef:ElementRef,\n              @Inject(OpEditingPortalChangesetToken) protected change:ResourceChangeset<HalResource>,\n              @Inject(OpEditingPortalSchemaToken) public schema:IFieldSchema,\n              @Inject(OpEditingPortalHandlerToken) readonly handler:EditFieldHandler,\n              readonly cdRef:ChangeDetectorRef,\n              readonly injector:Injector) {\n    super();\n    this.schema = this.schema || this.change.schema[this.name];\n\n    if (this.change.state) {\n      this.change.state\n        .values$()\n        .pipe(\n          this.untilDestroyed()\n        )\n        .subscribe((change) => {\n          const fieldSchema = change.schema[this.name];\n\n          if (!fieldSchema) {\n            return handler.deactivate(false);\n          }\n\n          this.change = change;\n          this.schema = change.schema[this.name];\n          this.initialize();\n          this.cdRef.markForCheck();\n        });\n    }\n  }\n\n  ngOnInit():void {\n    this.$element = jQuery(this.elementRef.nativeElement);\n    this.initialize();\n  }\n\n  public get overflowingSelector() {\n    if (this.$element) {\n      return this.$element\n        .closest(overflowingContainerSelector)\n        .data(overflowingContainerAttribute);\n    } else {\n      return null;\n    }\n  }\n\n  public get inFlight() {\n    return this.handler.inFlight;\n  }\n\n  public get value() {\n    return this.resource[this.name];\n  }\n\n  public get name() {\n    // Get the mapped schema name, as this is not always the attribute\n    // e.g., startDate in table for milestone => date attribute\n    return this.change.getSchemaName(this.handler.fieldName);\n  }\n\n  public set value(value:any) {\n    this.resource[this.name] = this.parseValue(value);\n  }\n\n  public get placeholder() {\n    if (this.name === 'subject') {\n      return this.I18n.t('js.placeholders.subject');\n    }\n\n    return '';\n  }\n\n  public get resource() {\n    return this.change.projectedResource;\n  }\n\n  /**\n   * Initialize the field after constructor was called.\n   */\n  protected initialize() {\n  }\n\n  /**\n   * Parse the value from the model for setting\n   */\n  protected parseValue(val:any) {\n    return val;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {WorkPackageLinkedResourceCache} from 'core-components/wp-single-view-tabs/wp-linked-resource-cache.service';\n\n@Injectable()\nexport class WorkPackageWatchersService extends WorkPackageLinkedResourceCache<HalResource[]> {\n\n  protected load(workPackage:WorkPackageResource) {\n    return workPackage.watchers.$update()\n      .then((collection:CollectionResource<HalResource>) => {\n        return collection.elements;\n    });\n  }\n}\n","// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnInit, ViewChild, ChangeDetectionStrategy} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {OpCkeditorComponent} from \"core-app/modules/common/ckeditor/op-ckeditor.component\";\nimport {ICKEditorContext, ICKEditorInstance} from \"core-app/modules/common/ckeditor/ckeditor-setup.service\";\n\nexport const formattableFieldTemplate = `\n    <div class=\"textarea-wrapper\">\n      <div class=\"op-ckeditor--wrapper op-ckeditor-element\">\n        <op-ckeditor [context]=\"ckEditorContext\"\n                     [content]=\"rawValue\"\n                     (onContentChange)=\"onContentChange($event)\"\n                     (onInitializationFailed)=\"initializationError = true\"\n                     (onInitialized)=\"onCkeditorSetup($event)\"\n                     [ckEditorType]=\"editorType\">\n        </op-ckeditor>\n      </div>\n      <edit-field-controls *ngIf=\"!(handler.inEditMode || initializationError)\"\n                           [fieldController]=\"field\"\n                           (onSave)=\"handleUserSubmit()\"\n                           (onCancel)=\"handler.handleUserCancel()\"\n                           [saveTitle]=\"text.save\"\n                           [cancelTitle]=\"text.cancel\">\n      </edit-field-controls>\n    </div>\n`;\n\n@Component({\n  template: formattableFieldTemplate,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormattableEditFieldComponent extends EditFieldComponent implements OnInit {\n  public readonly field = this;\n\n  // Detect when inner component could not be initalized\n  public initializationError = false;\n\n  @ViewChild(OpCkeditorComponent, { static: true }) editor:OpCkeditorComponent;\n\n  // Values used in template\n  public isPreview:boolean = false;\n  public previewHtml:string = '';\n  public text:any = {};\n\n  public editorType = this.resource.getEditorTypeFor(this.field.name);\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.handler.registerOnSubmit(() => this.getCurrentValue());\n    this.text = {\n      attachmentLabel: this.I18n.t('js.label_formattable_attachment_hint'),\n      save: this.I18n.t('js.inplace.button_save', {attribute: this.schema.name}),\n      cancel: this.I18n.t('js.inplace.button_cancel', {attribute: this.schema.name})\n    };\n  }\n\n  public onCkeditorSetup(editor:ICKEditorInstance) {\n    if (!this.resource.isNew) {\n      setTimeout(() => editor.editing.view.focus());\n    }\n  }\n\n  public getCurrentValue():Promise<void> {\n    return this.editor\n      .getTransformedContent()\n      .then((val) => {\n        this.rawValue = val;\n      });\n  }\n\n  public onContentChange(value:string) {\n    // Have the guard clause to avoid the text being set\n    // in the changeset when no actual change has taken place.\n    if (this.rawValue !== value) {\n      this.rawValue = value;\n    }\n  }\n\n  public handleUserSubmit() {\n    this.getCurrentValue()\n      .then(() => {\n        this.handler.handleUserSubmit();\n      });\n\n    return false;\n  }\n\n  public get ckEditorContext():ICKEditorContext {\n    return {\n      resource: this.change.pristineResource,\n      macros: 'none' as 'none',\n      previewContext: this.previewContext,\n      options: { rtl: this.schema.options && this.schema.options.rtl }\n    };\n  }\n\n  private get previewContext() {\n    return this.handler.previewContext(this.resource);\n  }\n\n  public reset() {\n    if (this.editor && this.editor.initialized) {\n      this.editor.content = this.rawValue;\n\n      this.cdRef.markForCheck();\n    }\n  }\n\n  public get rawValue() {\n    if (this.value && this.value.raw) {\n      return this.value.raw;\n    } else {\n      return '';\n    }\n  }\n\n  public set rawValue(val:string) {\n    this.value = { raw: val };\n  }\n\n  public isEmpty():boolean {\n    return !(this.value && this.value.raw);\n  }\n\n  protected initialize() {\n    if (this.resource.isNew && this.editor) {\n      // Reset CKEditor when reloading after type/form changes\n      this.reset();\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {States} from '../../states.service';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {ChangeDetectorRef, Component, ElementRef, Inject, ViewChild} from \"@angular/core\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {QuerySharingChange} from \"core-components/modals/share-modal/query-sharing-form.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\n\n@Component({\n  templateUrl: './save-query.modal.html'\n})\nexport class SaveQueryModal extends OpModalComponent {\n  public queryName:string = '';\n  public isStarred = false;\n  public isPublic = false;\n  public isBusy = false;\n\n  @ViewChild('queryNameField', { static: true }) queryNameField:ElementRef;\n\n  public text = {\n    title: this.I18n.t('js.modals.form_submit.title'),\n    text: this.I18n.t('js.modals.form_submit.text'),\n    save_as: this.I18n.t('js.label_save_as'),\n    label_name: this.I18n.t('js.modals.label_name'),\n    label_visibility_settings: this.I18n.t('js.label_visibility_settings'),\n    button_save: this.I18n.t('js.modals.button_save'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly states:States,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly wpListService:WorkPackagesListService,\n              readonly halNotification:HalResourceNotificationService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly notificationsService:NotificationsService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  public setValues(change:QuerySharingChange) {\n    this.isStarred = change.isStarred;\n    this.isPublic = change.isPublic;\n  }\n\n  public onOpen() {\n    this.queryNameField.nativeElement.focus();\n  }\n\n  public get afterFocusOn() {\n    return jQuery('#work-packages-settings-button');\n  }\n\n  public saveQueryAs($event:JQuery.TriggeredEvent) {\n    if (this.isBusy || !this.queryName) {\n      return;\n    }\n\n    this.isBusy = true;\n    const query = this.querySpace.query.value!;\n    query.public = this.isPublic;\n\n    this.wpListService\n      .create(query, this.queryName)\n      .then((savedQuery:QueryResource):Promise<any> => {\n        if (this.isStarred && !savedQuery.starred) {\n          return this.wpListService.toggleStarred(savedQuery).then(() => this.closeMe($event));\n        }\n\n        this.closeMe($event);\n        return Promise.resolve(true);\n      })\n      .catch((error:any) => this.halNotification.handleRawError(error))\n      .then(() => this.isBusy = false); // Same as .finally()\n  }\n}\n","<div class=\"op-modal--portal \">\n  <div class=\"op-modal--modal-container wp-table--configuration-modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 [textContent]=\"text.save_as\"></h3>\n\n      <a class=\"op-modal--modal-close-button\">\n        <i\n            class=\"icon-close\"\n            (accessibleClick)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n    </div>\n\n    <form name=\"modalSaveForm\" class=\"form\">\n      <div class=\"form--field -required\">\n        <label class=\"form--label\" for=\"save-query-name\" [textContent]=\"text.label_name\"></label>\n        <div class=\"form--field-container\">\n          <div class=\"form--text-field-container\">\n            <input\n                class=\"form--text-field\"\n                type=\"text\"\n                name=\"save-query-name\"\n                id=\"save-query-name\"\n                #queryNameField\n                [(ngModel)]=\"queryName\"\n                required/>\n          </div>\n        </div>\n      </div>\n\n      <section class=\"form--section\">\n        <h3 [textContent]=\"text.label_visibility_settings\"></h3>\n        <query-sharing-form\n            [isSave]=\"true\"\n            (onChange)=\"setValues($event)\"\n            [isStarred]=\"isStarred\"\n            [isPublic]=\"isPublic\">\n        </query-sharing-form>\n      </section>\n\n      <div class=\"form--space\">\n        <button class=\"button -highlight -with-icon icon-checkmark\"\n                (click)=\"saveQueryAs($event)\"\n                [textContent]=\"text.button_save\"\n                [disabled]=\"isBusy || !queryName\">\n        </button>\n        <button class=\"button -with-icon icon-cancel\"\n                [textContent]=\"text.button_cancel\"\n                (click)=\"closeMe($event)\">\n        </button>\n      </div>\n    </form>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {VersionResource} from \"core-app/modules/hal/resources/version-resource\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {buildApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\n\n@Injectable()\nexport class VersionDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public createVersion(payload:any):Promise<VersionResource> {\n    return this.halResourceService\n      .post<VersionResource>(this.pathHelper.api.v3.versions.path, payload)\n      .toPromise();\n  }\n\n  public emptyCreateForm(payload:any):Promise<HalResource> {\n    return this.halResourceService\n      .post<VersionResource>(this.pathHelper.api.v3.versions.form.toString(), payload)\n      .toPromise();\n  }\n\n\n  public one(id:string|number):Promise<VersionResource> {\n    return this.halResourceService\n      .get<VersionResource>(this.pathHelper.api.v3.versions.id(id).toString())\n      .toPromise();\n  }\n\n  public list():Promise<CollectionResource<VersionResource>> {\n    return this.halResourceService\n      .get<CollectionResource<VersionResource>>(this.pathHelper.api.v3.versions.toString())\n      .toPromise();\n  }\n\n  public listForProject(projectId:string):Promise<CollectionResource<VersionResource>> {\n    return this.halResourceService\n      .get<CollectionResource<VersionResource>>(this.pathHelper.api.v3.projects.id(projectId).versions.toString())\n      .toPromise();\n  }\n\n  public canCreateVersionInProject(id:string):Promise<boolean> {\n    return this.halResourceService\n      .get<CollectionResource<ProjectResource>>(\n        this.pathHelper.api.v3.versions.availableProjects.toString(),\n        { filters: buildApiV3Filter('id', '=', [id]).toJson() }\n      )\n      .toPromise()\n      .then((collection) => {\n        return collection.elements.length === 1;\n      });\n  }\n\n  public listProjectsAvailableForVersions():Promise<CollectionResource<ProjectResource>> {\n    return this.halResourceService\n      .get<CollectionResource<ProjectResource>>(this.pathHelper.api.v3.versions.availableProjects.toString())\n      .toPromise();\n  }\n\n  public patch(resource:VersionResource, payload:Object):Promise<VersionResource> {\n    return this.halResourceService\n      .patch<VersionResource>(\n        this.pathHelper.api.v3.versions.id(resource.id!).toString(),\n        payload)\n      .toPromise();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\nimport {WorkPackageCopyController} from 'core-components/wp-copy/wp-copy.controller';\n\n@Component({\n  selector: 'wp-copy-full-view',\n  host: { 'class': 'work-packages-page--ui-view' },\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: '../wp-new/wp-new-full-view.html'\n})\nexport class WorkPackageCopyFullViewComponent extends WorkPackageCopyController {\n  public successState = 'work-packages.show';\n}\n\n","<div\n  class=\"work-package--new-state work-packages--new work-packages--show-view toolbar-container\"\n  *ngIf=\"newWorkPackage\">\n  <edit-form [resource]=\"newWorkPackage\"\n             [skippedFields]=\"['status', 'type']\"\n             [inEditMode]=\"true\"\n             (onSaved)=\"onSaved($event)\">\n    <div class=\"toolbar\">\n      <div class=\"title-container\">\n        <wp-type-status [workPackage]=\"newWorkPackage\"></wp-type-status>\n      </div>\n      <ul class=\"toolbar-items hide-when-print\">\n        <li class=\"toolbar-item hidden-for-mobile\">\n          <zen-mode-toggle-button></zen-mode-toggle-button>\n        </li>\n        <li class=\"toolbar-item hidden-for-mobile\">\n          <button id=\"create-wp-menu-button\"\n                  [attr.title]=\"text.button_settings\"\n                  class=\"button last work-packages-settings-button toolbar-icon\"\n                  wpCreateSettingsMenu>\n            <i class=\"button--icon icon-show-more\"></i>\n          </button>\n        </li>\n      </ul>\n    </div>\n\n    <wp-single-view [workPackage]=\"newWorkPackage\"\n                    [showProject]=\"copying\">\n    </wp-single-view>\n    <wp-edit-actions-bar (onCancel)=\"cancelAndBackToList()\">\n    </wp-edit-actions-bar>\n  </edit-form>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {States} from 'core-components/states.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\n\n\nexport const wpDisplayListRepresentation = 'list';\nexport const wpDisplayCardRepresentation = 'card';\nexport type WorkPackageDisplayRepresentationValue = 'list'|'card';\n\n@Injectable()\nexport class WorkPackageViewDisplayRepresentationService extends WorkPackageQueryStateService<string|null> {\n  public constructor(readonly states:States,\n                     readonly querySpace:IsolatedQuerySpace) {\n    super(querySpace);\n  }\n\n  public hasChanged(query:QueryResource) {\n    return this.current !== query.displayRepresentation;\n  }\n\n  valueFromQuery(query:QueryResource) {\n    return query.displayRepresentation || null;\n  }\n\n  public applyToQuery(query:QueryResource) {\n    const current = this.current;\n    query.displayRepresentation = current === null ? undefined : current;\n\n    return false;\n  }\n\n  public get current():string|null {\n    return this.lastUpdatedState.getValueOr(null);\n  }\n\n  public get isList():boolean {\n    const current = this.current;\n    return !current || current === wpDisplayListRepresentation;\n  }\n\n  public get isCards():boolean {\n    return this.current === wpDisplayCardRepresentation;\n  }\n\n  public setDisplayRepresentation(representation:WorkPackageDisplayRepresentationValue) {\n    this.update(representation);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {States} from '../../states.service';\nimport {StateService} from '@uirouter/core';\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Injectable()\nexport class WorkPackageRelationsHierarchyService {\n  constructor(protected $state:StateService,\n              protected states:States,\n              protected halEvents:HalEventsService,\n              protected notificationService:WorkPackageNotificationService,\n              protected pathHelper:PathHelperService,\n              protected wpCacheService:WorkPackageCacheService) {\n\n  }\n\n  public changeParent(workPackage:WorkPackageResource, parentId:string|null) {\n    let payload:any = {\n      lockVersion: workPackage.lockVersion\n    };\n\n    if (parentId) {\n      payload['_links'] = {\n        parent: {\n          href: this.pathHelper.api.v3.work_packages.id(parentId).toString()\n        }\n      };\n    } else {\n      payload['_links'] = {\n        parent: {\n          href: null\n        }\n      };\n    }\n\n    return workPackage\n      .changeParent(payload)\n      .then((wp:WorkPackageResource) => {\n        this.wpCacheService.updateWorkPackage(wp);\n        this.notificationService.showSave(wp);\n        this.halEvents.push(workPackage, {\n          eventType: 'association',\n          relatedWorkPackage: parentId,\n          relationType: 'parent'\n        });\n\n        return wp;\n      })\n      .catch((error) => {\n        this.notificationService.handleRawError(error, workPackage);\n        return Promise.reject(error);\n      });\n  }\n\n  public removeParent(workPackage:WorkPackageResource) {\n    return this.changeParent(workPackage, null);\n  }\n\n  public addExistingChildWp(workPackage:WorkPackageResource, childWpId:string):Promise<WorkPackageResource> {\n    return this.wpCacheService\n      .require(childWpId)\n      .then((wpToBecomeChild:WorkPackageResource|undefined) => {\n        return this.changeParent(wpToBecomeChild!, workPackage.id!)\n          .then(wp => {\n            this.wpCacheService.loadWorkPackage(workPackage.id!, true);\n            this.halEvents.push(workPackage, {\n              eventType: 'association',\n              relatedWorkPackage: wpToBecomeChild!.id!,\n              relationType: 'child'\n            });\n\n            return wp;\n          });\n      });\n  }\n\n  public addNewChildWp(baseRoute:string, workPackage:WorkPackageResource) {\n    workPackage.project.$load()\n      .then(() => {\n        const args = [\n          baseRoute + '.new',\n          {\n            parent_id: workPackage.id\n          }\n        ];\n\n        if (this.$state.includes('work-packages.show')) {\n          args[0] = 'work-packages.new';\n        }\n\n        (<any>this.$state).go(...args);\n      });\n  }\n\n  public removeChild(childWorkPackage:WorkPackageResource) {\n    return childWorkPackage.$load().then(() => {\n      let parentWorkPackage = childWorkPackage.parent;\n      return childWorkPackage.changeParent({\n        _links: {\n          parent: {\n            href: null\n          }\n        },\n        lockVersion: childWorkPackage.lockVersion\n      }).then(wp => {\n        if (parentWorkPackage) {\n          this.wpCacheService.require(parentWorkPackage.id!, true);\n        }\n\n        this.wpCacheService.updateWorkPackage(wp);\n      })\n        .catch((error) => {\n          this.notificationService.handleRawError(error, childWorkPackage);\n          return Promise.reject(error);\n        });\n    });\n  }\n}\n","<div class=\"-columns-2\">\n  <div class=\"attributes-key-value\"\n       [ngClass]=\"{'-span-all-columns': descriptor.spanAll }\"\n       *ngFor=\"let descriptor of group.members; trackBy:trackByName\">\n    <ng-template [ngIf]=\"!shouldHideField(descriptor)\">\n      <div\n        class=\"attributes-key-value--key\"\n        *ngIf=\"!descriptor.multiple && descriptor.field\">\n        <wp-replacement-label [fieldName]=\"descriptor.name\">\n          {{ descriptor.label }}\n          <span class=\"required\"\n                *ngIf=\"descriptor.field!.required && descriptor.field!.writable\"> *</span>\n        </wp-replacement-label>\n        <attribute-help-text [attribute]=\"descriptor.name\" [attributeScope]=\"'WorkPackage'\"></attribute-help-text>\n      </div>\n      <div *ngIf=\"!descriptor.multiple && descriptor.field\"\n           class=\"attributes-key-value--value-container\">\n\n        <editable-attribute-field *ngIf=\"descriptor.field!.isFormattable\"\n                       class=\"wp-edit-formattable-field\"\n                       [resource]=\"workPackage\"\n                       [isDropTarget]=\"true\"\n                       [fieldName]=\"descriptor.name\">\n        </editable-attribute-field>\n        <editable-attribute-field *ngIf=\"!descriptor.field.isFormattable\"\n                       [resource]=\"workPackage\"\n                       [fieldName]=\"descriptor.name\">\n        </editable-attribute-field>\n      </div>\n    </ng-template>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Injector, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {FieldDescriptor, GroupDescriptor} from 'core-components/work-packages/wp-single-view/wp-single-view.component';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {EditFormComponent} from \"core-app/modules/fields/edit/edit-form/edit-form.component\";\n\n@Component({\n  selector: 'wp-attribute-group',\n  templateUrl: './wp-attribute-group.template.html'\n})\nexport class WorkPackageFormAttributeGroupComponent {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public group:GroupDescriptor;\n\n  constructor(readonly I18n:I18nService,\n              public wpeditForm:EditFormComponent,\n              protected injector:Injector) {\n  }\n\n  public trackByName(_index:number, elem:{ name:string }) {\n    return elem.name;\n  }\n\n  /**\n   * Hide read-only fields, but only when in the create mode\n   * @param {FieldDescriptor} field\n   */\n  public shouldHideField(descriptor:FieldDescriptor) {\n    const field = descriptor.field || descriptor.fields![0];\n    return this.wpeditForm.editMode && !field.writable;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector} from '@angular/core';\nimport * as moment from 'moment';\nimport {WorkPackageCacheService} from '../../../work-packages/work-package-cache.service';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {RenderInfo} from '../wp-timeline';\nimport {TimelineCellRenderer} from './timeline-cell-renderer';\nimport {WorkPackageCellLabels} from './wp-timeline-cell';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {QueryDmService} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport Moment = moment.Moment;\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {take} from \"rxjs/operators\";\n\nexport const classNameBar = 'bar';\nexport const classNameLeftHandle = 'leftHandle';\nexport const classNameRightHandle = 'rightHandle';\nexport const classNameBarLabel = 'bar-label';\n\n\nexport function registerWorkPackageMouseHandler(this:void,\n                                                injector:Injector,\n                                                getRenderInfo:() => RenderInfo,\n                                                workPackageTimeline:WorkPackageTimelineTableController,\n                                                wpCacheService:WorkPackageCacheService,\n                                                halEditing:HalResourceEditingService,\n                                                halEvents:HalEventsService,\n                                                notificationService:WorkPackageNotificationService,\n                                                loadingIndicator:LoadingIndicatorService,\n                                                cell:HTMLElement,\n                                                bar:HTMLDivElement,\n                                                labels:WorkPackageCellLabels,\n                                                renderer:TimelineCellRenderer,\n                                                renderInfo:RenderInfo) {\n\n  const querySpace:IsolatedQuerySpace = injector.get(IsolatedQuerySpace);\n\n  let mouseDownStartDay:number | null = null; // also flag to signal active drag'n'drop\n  renderInfo.change = halEditing.changeFor(renderInfo.workPackage) as WorkPackageChangeset;\n\n  let dateStates:any;\n  let placeholderForEmptyCell:HTMLElement;\n  const jBody = jQuery('body');\n\n  // handles change to existing work packages\n  bar.onmousedown = (ev:MouseEvent) => {\n    if (ev.which === 1) {\n      // Left click only\n      workPackageMouseDownFn(bar, ev);\n    }\n  };\n\n  // handles initial creation of start/due values\n  cell.onmousemove = handleMouseMoveOnEmptyCell;\n\n  function applyDateValues(renderInfo:RenderInfo, dates:{ [name:string]:Moment }) {\n    // Let the renderer decide which fields we change\n    renderer.assignDateValues(renderInfo.change, labels, dates);\n  }\n\n  function getCursorOffsetInDaysFromLeft(renderInfo:RenderInfo, ev:MouseEvent) {\n    const leftOffset = workPackageTimeline.getAbsoluteLeftCoordinates();\n    const cursorOffsetLeftInPx = ev.clientX - leftOffset;\n    const cursorOffsetLeftInDays = Math.floor(cursorOffsetLeftInPx / renderInfo.viewParams.pixelPerDay);\n    return cursorOffsetLeftInDays;\n  }\n\n  function workPackageMouseDownFn(bar:HTMLDivElement, ev:MouseEvent) {\n    ev.preventDefault();\n\n    // add/remove css class while drag'n'drop is active\n    const classNameActiveDrag = 'active-drag';\n    bar.classList.add(classNameActiveDrag);\n    jBody.on('mouseup.timelinecell', () => bar.classList.remove(classNameActiveDrag));\n\n    workPackageTimeline.disableViewParamsCalculation = true;\n    mouseDownStartDay = getCursorOffsetInDaysFromLeft(renderInfo, ev);\n\n    // If this wp is a parent element, changing it is not allowed.\n    // But adding a relation to it is.\n    if (!renderInfo.workPackage.isLeaf && !renderInfo.viewParams.activeSelectionMode) {\n      return;\n    }\n\n    // Determine what attributes of the work package should be changed\n    const direction = renderer.onMouseDown(ev, null, renderInfo, labels, bar);\n\n    jBody.on('mousemove.timelinecell', createMouseMoveFn(direction));\n    jBody.on('keyup.timelinecell', keyPressFn);\n    jBody.on('mouseup.timelinecell', () => deactivate(false));\n  }\n\n  function createMouseMoveFn(direction:'left'|'right'|'both'|'create'|'dragright') {\n    return (ev:JQuery.MouseMoveEvent) => {\n\n      const days = getCursorOffsetInDaysFromLeft(renderInfo, ev.originalEvent!) - mouseDownStartDay!;\n      const offsetDayCurrent = Math.floor(ev.offsetX / renderInfo.viewParams.pixelPerDay);\n      const dayUnderCursor = renderInfo.viewParams.dateDisplayStart.clone().add(offsetDayCurrent, 'days');\n\n      dateStates = renderer.onDaysMoved(renderInfo.change, dayUnderCursor, days, direction);\n      applyDateValues(renderInfo, dateStates);\n      renderer.update(bar, labels, renderInfo);\n    };\n  }\n\n  function keyPressFn(ev:JQuery.TriggeredEvent) {\n    const kev:KeyboardEvent = ev as any;\n    if (kev.keyCode === keyCodes.ESCAPE) {\n      deactivate(true);\n    }\n  }\n\n  function handleMouseMoveOnEmptyCell(ev:MouseEvent) {\n    const wp = renderInfo.workPackage;\n\n    if (!renderer.isEmpty(wp)) {\n      return;\n    }\n\n    if (!(wp.isLeaf && renderer.canMoveDates(wp))) {\n      cell.style.cursor = 'not-allowed';\n      return;\n    }\n\n    // placeholder logic\n    cell.style.cursor = '';\n    placeholderForEmptyCell && placeholderForEmptyCell.remove();\n    placeholderForEmptyCell = renderer.displayPlaceholderUnderCursor(ev, renderInfo);\n    cell.appendChild(placeholderForEmptyCell);\n\n    // abort if mouse leaves cell\n    cell.onmouseleave = () => {\n      placeholderForEmptyCell.remove();\n    };\n\n    // create logic\n    cell.onmousedown = (ev) => {\n      placeholderForEmptyCell.remove();\n      bar.style.pointerEvents = 'none';\n      ev.preventDefault();\n\n      const offsetDayStart = Math.floor(ev.offsetX / renderInfo.viewParams.pixelPerDay);\n      const clickStart = renderInfo.viewParams.dateDisplayStart.clone().add(offsetDayStart, 'days');\n      const dateForCreate = clickStart.format('YYYY-MM-DD');\n      const mouseDownType = renderer.onMouseDown(ev, dateForCreate, renderInfo, labels, bar);\n      renderer.update(bar, labels, renderInfo);\n\n      if (mouseDownType === 'create') {\n        deactivate(false);\n        ev.preventDefault();\n        return;\n      }\n\n      cell.onmousemove = (ev) => {\n        const offsetDayCurrent = Math.floor(ev.offsetX / renderInfo.viewParams.pixelPerDay);\n        const dayUnderCursor = renderInfo.viewParams.dateDisplayStart.clone().add(offsetDayCurrent, 'days');\n        const widthInDays = offsetDayCurrent - offsetDayStart;\n        const moved = renderer.onDaysMoved(renderInfo.change, dayUnderCursor, widthInDays, mouseDownType);\n        renderer.assignDateValues(renderInfo.change, labels, moved);\n        renderer.update(bar, labels, renderInfo);\n      };\n\n      cell.onmouseleave = () => {\n        deactivate(true);\n      };\n\n      cell.onmouseup = () => {\n        deactivate(false);\n      };\n\n      jBody.on('keyup.timelinecell', keyPressFn);\n    };\n  }\n\n  function deactivate(cancelled:boolean) {\n    workPackageTimeline.disableViewParamsCalculation = false;\n\n    cell.onmousemove = handleMouseMoveOnEmptyCell;\n    cell.onmousedown = _.noop;\n    cell.onmouseleave = _.noop;\n    cell.onmouseup = _.noop;\n\n    bar.style.pointerEvents = 'auto';\n\n    jBody.off('.timelinecell');\n    workPackageTimeline.resetCursor();\n    mouseDownStartDay = null;\n    dateStates = {};\n\n    // const renderInfo = getRenderInfo();\n    if (cancelled || renderInfo.change.isEmpty()) {\n      renderInfo.change.clear();\n      renderer.update(bar, labels, renderInfo);\n      renderer.onMouseDownEnd(labels, renderInfo.change);\n      workPackageTimeline.refreshView();\n    } else {\n      const stopAndRefresh = () => {\n        renderInfo.change.clear();\n        renderer.onMouseDownEnd(labels, renderInfo.change);\n      };\n\n      // Persist the changes\n      saveWorkPackage(renderInfo.change)\n        .then(stopAndRefresh)\n        .catch(stopAndRefresh);\n    }\n\n  }\n\n  function saveWorkPackage(change:WorkPackageChangeset) {\n    const queryDm:QueryDmService = injector.get(QueryDmService);\n    const querySpace:IsolatedQuerySpace = injector.get(IsolatedQuerySpace);\n\n    // Remember the time before saving the work package to know which work packages to update\n    const updatedAt = moment().toISOString();\n\n    return loadingIndicator.table.promise = halEditing\n      .save<WorkPackageResource, WorkPackageChangeset>(change)\n      .then((result) => {\n        notificationService.showSave(result.resource);\n        const ids = _.map(querySpace.tableRendered.value!, row => row.workPackageId);\n        return queryDm.loadIdsUpdatedSince(ids, updatedAt).then(workPackageCollection => {\n          wpCacheService.updateWorkPackageList(workPackageCollection.elements);\n\n          halEvents.push(result.resource, { eventType: 'updated' });\n          return querySpace.timelineRendered.pipe(take(1)).toPromise();\n        });\n      })\n      .catch((error) => {\n        notificationService.handleRawError(error, renderInfo.workPackage);\n      });\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {States} from '../../../states.service';\nimport {WorkPackageCacheService} from '../../../work-packages/work-package-cache.service';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {RenderInfo} from '../wp-timeline';\nimport {TimelineCellRenderer} from './timeline-cell-renderer';\nimport {TimelineMilestoneCellRenderer} from './timeline-milestone-cell-renderer';\nimport {registerWorkPackageMouseHandler} from './wp-timeline-cell-mouse-handler';\nimport {Injector} from '@angular/core';\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const classNameLeftLabel = 'labelLeft';\nexport const classNameRightContainer = 'containerRight';\nexport const classNameRightLabel = 'labelRight';\nexport const classNameLeftHoverLabel = 'labelHoverLeft';\nexport const classNameRightHoverLabel = 'labelHoverRight';\nexport const classNameHoverStyle = '-label-style';\nexport const classNameFarRightLabel = 'labelFarRight';\nexport const classNameShowOnHover = 'show-on-hover';\nexport const classNameHideOnHover = 'hide-on-hover';\n\nexport class WorkPackageCellLabels {\n\n  constructor(public readonly center:HTMLDivElement|null,\n              public readonly left:HTMLDivElement,\n              public readonly leftHover:HTMLDivElement|null,\n              public readonly right:HTMLDivElement,\n              public readonly rightHover:HTMLDivElement|null,\n              public readonly farRight:HTMLDivElement) {\n  }\n\n}\n\nexport class WorkPackageTimelineCell {\n  @InjectField() wpCacheService:WorkPackageCacheService;\n  @InjectField() halEditing:HalResourceEditingService;\n  @InjectField() halEvents:HalEventsService;\n  @InjectField() notificationService:WorkPackageNotificationService;\n  @InjectField() states:States;\n  @InjectField() loadingIndicator:LoadingIndicatorService;\n\n  private wpElement:HTMLDivElement|null = null;\n\n  private elementShape:string;\n\n  private timelineCell:JQuery;\n  private labels:WorkPackageCellLabels;\n\n  constructor(public readonly injector:Injector,\n              public workPackageTimeline:WorkPackageTimelineTableController,\n              public renderers:{ milestone:TimelineMilestoneCellRenderer, generic:TimelineCellRenderer },\n              public latestRenderInfo:RenderInfo,\n              public classIdentifier:string,\n              public workPackageId:string) {\n  }\n\n  getMarginLeftOfLeftSide():number {\n    const renderer = this.cellRenderer(this.latestRenderInfo.workPackage);\n    return renderer.getMarginLeftOfLeftSide(this.latestRenderInfo);\n  }\n\n  getMarginLeftOfRightSide():number {\n    const renderer = this.cellRenderer(this.latestRenderInfo.workPackage);\n    return renderer.getMarginLeftOfRightSide(this.latestRenderInfo);\n  }\n\n  getPaddingLeftForIncomingRelationLines():number {\n    const renderer = this.cellRenderer(this.latestRenderInfo.workPackage);\n    return renderer.getPaddingLeftForIncomingRelationLines(this.latestRenderInfo);\n  }\n\n  getPaddingRightForOutgoingRelationLines():number {\n    const renderer = this.cellRenderer(this.latestRenderInfo.workPackage);\n    return renderer.getPaddingRightForOutgoingRelationLines(this.latestRenderInfo);\n  }\n\n  canConnectRelations():boolean {\n    const wp = this.latestRenderInfo.workPackage;\n    if (wp.isMilestone) {\n      return !_.isNil(wp.date);\n    }\n\n    return !_.isNil(wp.startDate) || !_.isNil(wp.dueDate);\n  }\n\n  public clear() {\n    this.cellElement.html('');\n    this.wpElement = null;\n  }\n\n  private get cellContainer() {\n    return this.workPackageTimeline.timelineBody;\n  }\n\n  private get cellElement():JQuery {\n    return this.cellContainer.find(`.${this.classIdentifier}`);\n  }\n\n  private lazyInit(renderer:TimelineCellRenderer, renderInfo:RenderInfo):Promise<void> {\n    const body = this.workPackageTimeline.timelineBody[0];\n    const cell = this.cellElement;\n\n    if (!cell.length) {\n      return Promise.reject('uninitialized');\n    }\n\n    const wasRendered = this.wpElement !== null && body.contains(this.wpElement);\n\n    // If already rendered with correct shape, ignore\n    if (wasRendered && (this.elementShape === renderer.type)) {\n      return Promise.resolve();\n    }\n\n    // Remove the element first if we're redrawing\n    this.clear();\n\n    // Render the given element\n    this.wpElement = renderer.render(renderInfo);\n    this.labels = renderer.createAndAddLabels(renderInfo, this.wpElement);\n    this.elementShape = renderer.type;\n\n    // Register the element\n    cell.append(this.wpElement);\n\n    // Allow editing if editable\n    if (renderer.canMoveDates(renderInfo.workPackage)) {\n      this.wpElement.classList.add('-editable');\n\n      registerWorkPackageMouseHandler(\n        this.injector,\n        () => this.latestRenderInfo,\n        this.workPackageTimeline,\n        this.wpCacheService,\n        this.halEditing,\n        this.halEvents,\n        this.notificationService,\n        this.loadingIndicator,\n        cell[0],\n        this.wpElement,\n        this.labels,\n        renderer,\n        renderInfo);\n    }\n\n    return Promise.resolve();\n  }\n\n  private cellRenderer(workPackage:WorkPackageResource):TimelineCellRenderer {\n    if (workPackage.isMilestone) {\n      return this.renderers.milestone;\n    }\n\n    return this.renderers.generic;\n  }\n\n  public refreshView(renderInfo:RenderInfo) {\n    this.latestRenderInfo = renderInfo;\n    const renderer = this.cellRenderer(renderInfo.workPackage);\n\n    // Render initial element if necessary\n    this.lazyInit(renderer, renderInfo)\n      .then(() => {\n        // Render the upgrade from renderInfo\n        const shouldBeDisplayed = renderer.update(\n          this.wpElement as HTMLDivElement,\n          this.labels,\n          renderInfo);\n\n        if (!shouldBeDisplayed) {\n          this.clear();\n        }\n      })\n      .catch(() => null);\n  }\n\n}\n","import * as moment from 'moment';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {\n  calculatePositionValueForDayCount,\n  calculatePositionValueForDayCountingPx,\n  RenderInfo,\n  timelineBackgroundElementClass,\n  timelineElementCssClass,\n  timelineMarkerSelectionStartClass\n} from '../wp-timeline';\nimport {\n  classNameFarRightLabel,\n  classNameHideOnHover,\n  classNameHoverStyle,\n  classNameLeftHoverLabel,\n  classNameLeftLabel,\n  classNameRightContainer,\n  classNameRightHoverLabel,\n  classNameRightLabel,\n  classNameShowOnHover,\n  WorkPackageCellLabels\n} from './wp-timeline-cell';\nimport {classNameBarLabel, classNameLeftHandle, classNameRightHandle} from './wp-timeline-cell-mouse-handler';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {DisplayFieldRenderer} from '../../../wp-edit-form/display-field-renderer';\nimport {Injector} from '@angular/core';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {HierarchyRenderPass} from \"core-components/wp-fast-table/builders/modes/hierarchy/hierarchy-render-pass\";\nimport Moment = moment.Moment;\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport interface CellDateMovement {\n  // Target values to move work package to\n  startDate?:moment.Moment;\n  dueDate?:moment.Moment;\n  // Target value to move milestone to\n  date?:moment.Moment;\n}\n\nexport type LabelPosition = 'left'|'right'|'farRight';\n\nexport class TimelineCellRenderer {\n  @InjectField() wpTableTimeline:WorkPackageViewTimelineService;\n  @InjectField() TimezoneService:TimezoneService;\n  public fieldRenderer:DisplayFieldRenderer = new DisplayFieldRenderer(this.injector, 'timeline');\n\n  protected dateDisplaysOnMouseMove:{ left?:HTMLElement; right?:HTMLElement } = {};\n\n  constructor(readonly injector:Injector,\n              readonly workPackageTimeline:WorkPackageTimelineTableController) {\n  }\n\n  public get type():string {\n    return 'bar';\n  }\n\n  public canMoveDates(wp:WorkPackageResource) {\n    return wp.schema.startDate.writable && wp.schema.dueDate.writable && wp.isAttributeEditable('startDate');\n  }\n\n  public isEmpty(wp:WorkPackageResource) {\n    const start = moment(wp.startDate as any);\n    const due = moment(wp.dueDate as any);\n    const noStartAndDueValues = _.isNaN(start.valueOf()) && _.isNaN(due.valueOf());\n    return noStartAndDueValues;\n  }\n\n  public displayPlaceholderUnderCursor(ev:MouseEvent, renderInfo:RenderInfo):HTMLElement {\n    const days = Math.floor(ev.offsetX / renderInfo.viewParams.pixelPerDay);\n\n    const placeholder = document.createElement('div');\n    placeholder.style.pointerEvents = 'none';\n    placeholder.style.position = 'absolute';\n    placeholder.style.height = '1em';\n    placeholder.style.width = '30px';\n    placeholder.style.zIndex = '9999';\n    placeholder.style.left = (days * renderInfo.viewParams.pixelPerDay) + 'px';\n\n    this.applyTypeColor(renderInfo, placeholder);\n\n    return placeholder;\n  }\n\n  /**\n   * Assign changed dates to the work package.\n   * For generic work packages, assigns start and finish date.\n   *\n   */\n  public assignDateValues(change:WorkPackageChangeset,\n                          labels:WorkPackageCellLabels,\n                          dates:any):void {\n\n    this.assignDate(change, 'startDate', dates.startDate);\n    this.assignDate(change, 'dueDate', dates.dueDate);\n\n    this.updateLabels(true, labels, change);\n  }\n\n  /**\n   * Handle movement by <delta> days of the work package to either (or both) edge(s)\n   * depending on which initial date was set.\n   */\n  public onDaysMoved(change:WorkPackageChangeset,\n                     dayUnderCursor:Moment,\n                     delta:number,\n                     direction:'left'|'right'|'both'|'create'|'dragright'):CellDateMovement {\n\n    const initialStartDate = change.pristineResource.startDate;\n    const initialDueDate = change.pristineResource.dueDate;\n\n    const now = moment().format('YYYY-MM-DD');\n\n    const startDate = moment(change.projectedResource.startDate);\n    const dueDate = moment(change.projectedResource.dueDate);\n\n    let dates:CellDateMovement = {};\n\n    if (direction === 'left') {\n      dates.startDate = moment(initialStartDate || initialDueDate).add(delta, 'days');\n    } else if (direction === 'right') {\n      dates.dueDate = moment(initialDueDate || now).add(delta, 'days');\n    } else if (direction === 'both') {\n      if (initialStartDate) {\n        dates.startDate = moment(initialStartDate).add(delta, 'days');\n      }\n      if (initialDueDate) {\n        dates.dueDate = moment(initialDueDate).add(delta, 'days');\n      }\n    } else if (direction === 'dragright') {\n      dates.dueDate = startDate.clone().add(delta, 'days');\n    }\n\n    // avoid negative \"overdrag\" if only start or due are changed\n    if (direction !== 'both') {\n      if (dates.startDate !== undefined && dates.startDate.isAfter(dueDate)) {\n        dates.startDate = dueDate;\n      } else if (dates.dueDate !== undefined && dates.dueDate.isBefore(startDate)) {\n        dates.dueDate = startDate;\n      }\n    }\n\n    return dates;\n  }\n\n  public onMouseDown(ev:MouseEvent,\n                     dateForCreate:string|null,\n                     renderInfo:RenderInfo,\n                     labels:WorkPackageCellLabels,\n                     elem:HTMLElement):'left'|'right'|'both'|'dragright'|'create' {\n\n    // check for active selection mode\n    if (renderInfo.viewParams.activeSelectionMode) {\n      renderInfo.viewParams.activeSelectionMode(renderInfo.workPackage);\n      ev.preventDefault();\n      return 'both'; // irrelevant\n    }\n\n    const projection = renderInfo.change.projectedResource;\n    let direction:'left'|'right'|'both'|'dragright';\n\n    // Update the cursor and maybe set start/due values\n    if (jQuery(ev.target!).hasClass(classNameLeftHandle)) {\n      // only left\n      direction = 'left';\n      this.workPackageTimeline.forceCursor('col-resize');\n      if (projection.startDate === null) {\n        projection.startDate = projection['dueDate'];\n      }\n    } else if (jQuery(ev.target!).hasClass(classNameRightHandle) || dateForCreate) {\n      // only right\n      direction = 'right';\n      this.workPackageTimeline.forceCursor('col-resize');\n    } else {\n      // both\n      direction = 'both';\n      this.workPackageTimeline.forceCursor('ew-resize');\n    }\n\n    if (dateForCreate) {\n      projection.startDate = dateForCreate;\n      projection.dueDate = dateForCreate;\n      direction = 'dragright';\n    }\n\n    this.updateLabels(true, labels, renderInfo.change);\n\n    return direction;\n  }\n\n  public onMouseDownEnd(labels:WorkPackageCellLabels, change:WorkPackageChangeset) {\n    this.updateLabels(false, labels, change);\n  }\n\n  /**\n   * @return true, if the element should still be displayed.\n   *         false, if the element must be removed from the timeline.\n   */\n  public update(element:HTMLDivElement, labels:WorkPackageCellLabels|null, renderInfo:RenderInfo):boolean {\n    const change = renderInfo.change;\n    const bar = element.querySelector(`.${timelineBackgroundElementClass}`) as HTMLElement;\n\n    const viewParams = renderInfo.viewParams;\n    let start = moment(change.projectedResource.startDate);\n    let due = moment(change.projectedResource.dueDate);\n\n    if (_.isNaN(start.valueOf()) && _.isNaN(due.valueOf())) {\n      element.style.visibility = 'hidden';\n    } else {\n      element.style.visibility = 'visible';\n    }\n\n    // only start date, fade out bar to the right\n    if (_.isNaN(due.valueOf()) && !_.isNaN(start.valueOf())) {\n      // Set due date to today\n      due = moment();\n      bar.style.backgroundImage = `linear-gradient(90deg, rgba(255,255,255,0) 0%, #F1F1F1 100%)`;\n    }\n\n    // only finish date, fade out bar to the left\n    if (_.isNaN(start.valueOf()) && !_.isNaN(due.valueOf())) {\n      start = due.clone();\n      bar.style.backgroundImage = `linear-gradient(90deg, #F1F1F1 0%, rgba(255,255,255,0) 80%)`;\n    }\n\n    // offset left\n    const offsetStart = start.diff(viewParams.dateDisplayStart, 'days');\n    element.style.left = calculatePositionValueForDayCount(viewParams, offsetStart);\n\n    // duration\n    const duration = due.diff(start, 'days') + 1;\n    element.style.width = calculatePositionValueForDayCount(viewParams, duration);\n\n    // ensure minimum width\n    if (!_.isNaN(start.valueOf()) || !_.isNaN(due.valueOf())) {\n      const minWidth = _.max([renderInfo.viewParams.pixelPerDay, 2]);\n      element.style.minWidth = minWidth + 'px';\n    }\n\n    // Update labels if any\n    if (labels) {\n      this.updateLabels(false, labels, change);\n    }\n\n    this.checkForActiveSelectionMode(renderInfo, bar);\n    this.checkForSpecialDisplaySituations(renderInfo, bar);\n    this.applyTypeColor(renderInfo, bar);\n\n    return true;\n  }\n\n  protected checkForActiveSelectionMode(renderInfo:RenderInfo, element:HTMLElement) {\n    if (renderInfo.viewParams.activeSelectionMode) {\n      element.style.backgroundImage = ''; // required! unable to disable \"fade out bar\" with css\n\n      if (renderInfo.viewParams.selectionModeStart === '' + renderInfo.workPackage.id!) {\n        jQuery(element).addClass(timelineMarkerSelectionStartClass);\n        element.style.background = 'none';\n      }\n    }\n  }\n\n  getMarginLeftOfLeftSide(renderInfo:RenderInfo):number {\n    const projection = renderInfo.change.projectedResource;\n\n    let start = moment(projection.startDate);\n    let due = moment(projection.dueDate);\n    start = _.isNaN(start.valueOf()) ? due.clone() : start;\n\n    const offsetStart = start.diff(renderInfo.viewParams.dateDisplayStart, 'days');\n\n    return calculatePositionValueForDayCountingPx(renderInfo.viewParams, offsetStart);\n  }\n\n  getMarginLeftOfRightSide(renderInfo:RenderInfo):number {\n    const projection = renderInfo.change.projectedResource;\n\n    let start = moment(projection.startDate);\n    let due = moment(projection.dueDate);\n\n    start = _.isNaN(start.valueOf()) ? due.clone() : start;\n    due = _.isNaN(due.valueOf()) ? start.clone() : due;\n\n    const offsetStart = start.diff(renderInfo.viewParams.dateDisplayStart, 'days');\n    const duration = due.diff(start, 'days') + 1;\n\n    return calculatePositionValueForDayCountingPx(renderInfo.viewParams, offsetStart + duration);\n  }\n\n  getPaddingLeftForIncomingRelationLines(renderInfo:RenderInfo):number {\n    return renderInfo.viewParams.pixelPerDay / 8;\n  }\n\n  getPaddingRightForOutgoingRelationLines(renderInfo:RenderInfo):number {\n    return 0;\n  }\n\n  /**\n   * Render the generic cell element, a bar spanning from\n   * start to finish date.\n   */\n  public render(renderInfo:RenderInfo):HTMLDivElement {\n    const container = document.createElement('div');\n    const bar = document.createElement('div');\n    const left = document.createElement('div');\n    const right = document.createElement('div');\n\n    container.className = timelineElementCssClass + ' ' + this.type;\n    bar.className = timelineBackgroundElementClass;\n    left.className = classNameLeftHandle;\n    right.className = classNameRightHandle;\n    container.appendChild(bar);\n    container.appendChild(left);\n    container.appendChild(right);\n\n    return container;\n  }\n\n  createAndAddLabels(renderInfo:RenderInfo, element:HTMLElement):WorkPackageCellLabels {\n    // create center label\n    const labelCenter = document.createElement('div');\n    labelCenter.classList.add(classNameBarLabel);\n    this.applyTypeColor(renderInfo, labelCenter);\n    element.appendChild(labelCenter);\n\n    // create left label\n    const labelLeft = document.createElement('div');\n    labelLeft.classList.add(classNameLeftLabel, classNameHideOnHover);\n    element.appendChild(labelLeft);\n\n    // create right container\n    const containerRight = document.createElement('div');\n    containerRight.classList.add(classNameRightContainer);\n    element.appendChild(containerRight);\n\n    // create right label\n    const labelRight = document.createElement('div');\n    labelRight.classList.add(classNameRightLabel, classNameHideOnHover);\n    containerRight.appendChild(labelRight);\n\n    // create far right label\n    const labelFarRight = document.createElement('div');\n    labelFarRight.classList.add(classNameFarRightLabel, classNameHideOnHover);\n    containerRight.appendChild(labelFarRight);\n\n    // create left hover label\n    const labelHoverLeft = document.createElement('div');\n    labelHoverLeft.classList.add(classNameLeftHoverLabel, classNameShowOnHover, classNameHoverStyle);\n    element.appendChild(labelHoverLeft);\n\n    // create right hover label\n    const labelHoverRight = document.createElement('div');\n    labelHoverRight.classList.add(classNameRightHoverLabel, classNameShowOnHover, classNameHoverStyle);\n    element.appendChild(labelHoverRight);\n\n    const labels = new WorkPackageCellLabels(labelCenter, labelLeft, labelHoverLeft, labelRight, labelHoverRight, labelFarRight);\n    this.updateLabels(false, labels, renderInfo.change);\n\n    return labels;\n  }\n\n  protected applyTypeColor(renderInfo:RenderInfo, bg:HTMLElement):void {\n    let wp = renderInfo.workPackage;\n    let type = wp.type;\n    let selectionMode = renderInfo.viewParams.activeSelectionMode;\n\n    // Don't apply the class in selection mode or for parents (clamps)\n    const id = type.id;\n    if (selectionMode || this.isParentWithVisibleChildren(wp)) {\n      bg.classList.remove(Highlighting.backgroundClass('type', id!));\n    } else {\n      bg.classList.add(Highlighting.backgroundClass('type', id!));\n    }\n  }\n\n  protected assignDate(change:WorkPackageChangeset, attributeName:string, value:moment.Moment) {\n    if (value) {\n      change.projectedResource[attributeName] = value.format('YYYY-MM-DD');\n    }\n  }\n\n  /**\n   * Changes the presentation of the work package.\n   *\n   * Known cases:\n   * 1. Display a clamp if this work package is a parent element\n   */\n  checkForSpecialDisplaySituations(renderInfo:RenderInfo, bar:HTMLElement) {\n    const wp = renderInfo.workPackage;\n    let selectionMode = renderInfo.viewParams.activeSelectionMode;\n\n    // Cannot edit the work package if it has children\n    if (!wp.isLeaf && !selectionMode) {\n      bar.classList.add('-readonly');\n    } else {\n      bar.classList.remove('-readonly');\n    }\n\n    // Display the parent as clamp-style when it has children in the table\n    if (this.isParentWithVisibleChildren(wp)) {\n      bar.classList.add('-clamp-style');\n      bar.style.borderStyle = 'solid';\n      bar.style.borderWidth = '2px';\n      bar.style.borderBottom = 'none';\n      bar.style.background = 'none';\n    }\n  }\n\n  protected updateLabels(activeDragNDrop:boolean,\n                         labels:WorkPackageCellLabels,\n                         change:WorkPackageChangeset) {\n\n    const labelConfiguration = this.wpTableTimeline.getNormalizedLabels(change.projectedResource);\n\n    if (!activeDragNDrop) {\n      // normal display\n      this.renderLabel(change, labels, 'left', labelConfiguration.left);\n      this.renderLabel(change, labels, 'right', labelConfiguration.right);\n      this.renderLabel(change, labels, 'farRight', labelConfiguration.farRight);\n    }\n\n    // Update hover labels\n    this.renderHoverLabels(labels, change);\n  }\n\n  protected renderHoverLabels(labels:WorkPackageCellLabels, change:WorkPackageChangeset) {\n    this.renderLabel(change, labels, 'leftHover', 'startDate');\n    this.renderLabel(change, labels, 'rightHover', 'dueDate');\n  }\n\n  protected renderLabel(change:WorkPackageChangeset,\n                        labels:WorkPackageCellLabels,\n                        position:LabelPosition|'leftHover'|'rightHover',\n                        attribute:string|null) {\n\n    // Get the label position\n    // Skip label if it does not exist (milestones)\n    let label = labels[position];\n    if (!label) {\n      return;\n    }\n\n    // Reset label value\n    label.innerHTML = '';\n\n    if (attribute === null) {\n      label.classList.remove('not-empty');\n      return;\n    }\n\n    // Get the rendered field\n    let [field, span] = this.fieldRenderer.renderFieldValue(change.projectedResource, attribute, change);\n\n    if (label && field && span) {\n      span.classList.add('label-content');\n      label.appendChild(span);\n      label.classList.add('not-empty');\n    } else if (label) {\n      label.classList.remove('not-empty');\n    }\n  }\n\n  protected isParentWithVisibleChildren(wp:WorkPackageResource):boolean {\n    if (!this.workPackageTimeline.inHierarchyMode) {\n      return false;\n    }\n\n    const renderPass = this.workPackageTimeline.workPackageTable.lastRenderPass as HierarchyRenderPass|null;\n    if (renderPass) {\n      return !!renderPass.parentsWithVisibleChildren[wp.id!];\n    }\n\n    return false;\n  }\n}\n","import * as moment from 'moment';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {\n  calculatePositionValueForDayCountingPx,\n  RenderInfo,\n  timelineElementCssClass\n} from '../wp-timeline';\nimport {CellDateMovement, LabelPosition, TimelineCellRenderer} from './timeline-cell-renderer';\nimport {\n  classNameFarRightLabel,\n  classNameHideOnHover,\n  classNameHoverStyle,\n  classNameLeftLabel,\n  classNameRightContainer,\n  classNameRightHoverLabel,\n  classNameRightLabel,\n  classNameShowOnHover,\n  WorkPackageCellLabels\n} from './wp-timeline-cell';\nimport Moment = moment.Moment;\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\n\nexport class TimelineMilestoneCellRenderer extends TimelineCellRenderer {\n  public get type():string {\n    return 'milestone';\n  }\n\n  public isEmpty(wp:WorkPackageResource) {\n    const date = moment(wp.date as any);\n    return _.isNaN(date.valueOf());\n  }\n\n  public canMoveDates(wp:WorkPackageResource) {\n    return wp.schema.date.writable && wp.isAttributeEditable('date');\n  }\n\n  public displayPlaceholderUnderCursor(ev:MouseEvent, renderInfo:RenderInfo):HTMLElement {\n    const days = Math.floor(ev.offsetX / renderInfo.viewParams.pixelPerDay);\n\n    const placeholder = document.createElement('div');\n    placeholder.className = 'timeline-element milestone';\n    placeholder.style.pointerEvents = 'none';\n    placeholder.style.height = '1em';\n    placeholder.style.width = '1em';\n    placeholder.style.left = (days * renderInfo.viewParams.pixelPerDay) + 'px';\n\n    const diamond = document.createElement('div');\n    diamond.className = 'diamond';\n    diamond.style.left = '0.5em';\n    diamond.style.height = '1em';\n    diamond.style.width = '1em';\n    placeholder.appendChild(diamond);\n\n    this.applyTypeColor(renderInfo, diamond);\n\n    return placeholder;\n  }\n\n  /**\n   * Assign changed dates to the work package.\n   * For generic work packages, assigns start and finish date .\n   *\n   */\n  public assignDateValues(change:WorkPackageChangeset,\n                          labels:WorkPackageCellLabels,\n                          dates:any):void {\n\n    this.assignDate(change, 'date', dates.date);\n    this.updateLabels(true, labels, change);\n  }\n\n  /**\n   * Handle movement by <delta> days of milestone.\n   */\n  public onDaysMoved(change:WorkPackageChangeset,\n                     dayUnderCursor:Moment,\n                     delta:number,\n                     direction:'left' | 'right' | 'both' | 'create' | 'dragright') {\n\n    const initialDate = change.pristineResource.date;\n    let dates:CellDateMovement = {};\n\n    if (initialDate) {\n      dates.date = moment(initialDate).add(delta, 'days');\n    }\n\n    return dates;\n  }\n\n  public onMouseDown(ev:MouseEvent,\n                     dateForCreate:string | null,\n                     renderInfo:RenderInfo,\n                     labels:WorkPackageCellLabels,\n                     elem:HTMLElement):'left' | 'right' | 'both' | 'create' | 'dragright' {\n\n    // check for active selection mode\n    if (renderInfo.viewParams.activeSelectionMode) {\n      renderInfo.viewParams.activeSelectionMode(renderInfo.workPackage);\n      ev.preventDefault();\n      return 'both'; // irrelevant\n    }\n\n    let direction:'both' | 'create' = 'both';\n    this.workPackageTimeline.forceCursor('ew-resize');\n\n    if (dateForCreate) {\n      renderInfo.change.projectedResource.date = dateForCreate;\n      direction = 'create';\n      return direction;\n    }\n\n    this.updateLabels(true, labels, renderInfo.change);\n\n    return direction;\n  }\n\n  public update(element:HTMLDivElement, labels:WorkPackageCellLabels|null, renderInfo:RenderInfo):boolean {\n    const viewParams = renderInfo.viewParams;\n    const date = moment(renderInfo.change.projectedResource.date);\n\n    // abort if no date\n    if (_.isNaN(date.valueOf())) {\n      return false;\n    }\n\n    const diamond = jQuery('.diamond', element)[0];\n\n    diamond.style.width = 15 + 'px';\n    diamond.style.height = 15 + 'px';\n    diamond.style.width = 15 + 'px';\n    diamond.style.height = 15 + 'px';\n    diamond.style.marginLeft = -(15 / 2) + (renderInfo.viewParams.pixelPerDay / 2) + 'px';\n    this.applyTypeColor(renderInfo, diamond);\n\n    // offset left\n    const offsetStart = date.diff(viewParams.dateDisplayStart, 'days');\n    element.style.left = calculatePositionValueForDayCountingPx(viewParams, offsetStart) + 'px';\n\n    // Update labels if any\n    if (labels) {\n      this.updateLabels(false, labels, renderInfo.change);\n    }\n\n    this.checkForActiveSelectionMode(renderInfo, diamond);\n\n    return true;\n  }\n\n  getMarginLeftOfLeftSide(renderInfo:RenderInfo):number {\n    const change = renderInfo.change;\n    let start = moment(change.projectedResource.date);\n    const offsetStart = start.diff(renderInfo.viewParams.dateDisplayStart, 'days');\n    return calculatePositionValueForDayCountingPx(renderInfo.viewParams, offsetStart);\n  }\n\n  getMarginLeftOfRightSide(ri:RenderInfo):number {\n    return this.getMarginLeftOfLeftSide(ri) + ri.viewParams.pixelPerDay;\n  }\n\n  getPaddingLeftForIncomingRelationLines(renderInfo:RenderInfo):number {\n    return (renderInfo.viewParams.pixelPerDay / 2) - 1;\n  }\n\n  getPaddingRightForOutgoingRelationLines(renderInfo:RenderInfo):number {\n    return (15 / 2);\n  }\n\n  /**\n   * Render a milestone element, a single day event with no resize, but\n   * move functionality.\n   */\n  public render(renderInfo:RenderInfo):HTMLDivElement {\n    const element = document.createElement('div');\n    element.className = timelineElementCssClass + ' ' + this.type;\n\n    const diamond = document.createElement('div');\n    diamond.className = 'diamond';\n    element.appendChild(diamond);\n\n    return element;\n  }\n\n  createAndAddLabels(renderInfo:RenderInfo, element:HTMLElement):WorkPackageCellLabels {\n    // create left label\n    const labelLeft = document.createElement('div');\n    labelLeft.classList.add(classNameLeftLabel, classNameHideOnHover);\n    element.appendChild(labelLeft);\n\n    // create right container\n    const containerRight = document.createElement('div');\n    containerRight.classList.add(classNameRightContainer);\n    element.appendChild(containerRight);\n\n    // create right label\n    const labelRight = document.createElement('div');\n    labelRight.classList.add(classNameRightLabel, classNameHideOnHover);\n    containerRight.appendChild(labelRight);\n\n    // create far right label\n    const labelFarRight = document.createElement('div');\n    labelFarRight.classList.add(classNameFarRightLabel, classNameHideOnHover);\n    containerRight.appendChild(labelFarRight);\n\n    // Create right hover label\n    const labelHoverRight = document.createElement('div');\n    labelHoverRight.classList.add(classNameRightHoverLabel, classNameShowOnHover, classNameHoverStyle);\n    element.appendChild(labelHoverRight);\n\n    const labels = new WorkPackageCellLabels(null, labelLeft, null, labelRight, labelHoverRight, labelFarRight);\n    this.updateLabels(false, labels, renderInfo.change);\n\n    return labels;\n  }\n\n  protected renderHoverLabels(labels:WorkPackageCellLabels, change:WorkPackageChangeset) {\n    this.renderLabel(change, labels, 'rightHover', 'date');\n  }\n\n  protected updateLabels(activeDragNDrop:boolean,\n                         labels:WorkPackageCellLabels,\n                         change:WorkPackageChangeset) {\n\n    const labelConfiguration = this.wpTableTimeline.getNormalizedLabels(change.projectedResource);\n\n    if (!activeDragNDrop) {\n      // normal display\n\n      // Show only one date field if left=start, right=dueDate\n      if (labelConfiguration.left === 'startDate' && labelConfiguration.right === 'dueDate') {\n        this.renderLabel(change, labels, 'left', null);\n        this.renderLabel(change, labels, 'right', 'date');\n      } else {\n        this.renderLabel(change, labels, 'left', labelConfiguration.left);\n        this.renderLabel(change, labels, 'right', labelConfiguration.right);\n      }\n\n      this.renderLabel(change, labels, 'farRight', labelConfiguration.farRight);\n    }\n\n    // Update hover labels\n    this.renderHoverLabels(labels, change);\n  }\n\n  protected renderLabel(change:WorkPackageChangeset,\n                        labels:WorkPackageCellLabels,\n                        position:LabelPosition|'leftHover'|'rightHover',\n                        attribute:string|null) {\n    // Normalize attribute\n    if (attribute === 'startDate' || attribute === 'dueDate') {\n      attribute = 'date';\n    }\n\n    super.renderLabel(change, labels, position, attribute);\n  }\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector} from '@angular/core';\nimport {States} from '../../../states.service';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {RenderInfo} from '../wp-timeline';\nimport {TimelineCellRenderer} from './timeline-cell-renderer';\nimport {TimelineMilestoneCellRenderer} from './timeline-milestone-cell-renderer';\nimport {WorkPackageTimelineCell} from './wp-timeline-cell';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageTimelineCellsRenderer {\n\n  // Injections\n  @InjectField() public states:States;\n  @InjectField() public halEditing:HalResourceEditingService;\n\n  public cells:{ [classIdentifier:string]:WorkPackageTimelineCell } = {};\n\n  private cellRenderers:{ milestone:TimelineMilestoneCellRenderer, generic:TimelineCellRenderer };\n\n  constructor(readonly injector:Injector,\n              readonly wpTimeline:WorkPackageTimelineTableController) {\n    this.cellRenderers = {\n      milestone: new TimelineMilestoneCellRenderer(this.injector, wpTimeline),\n      generic: new TimelineCellRenderer(this.injector, wpTimeline)\n    };\n  }\n\n  public hasCell(wpId:string) {\n    return this.getCellsFor(wpId).length > 0;\n  }\n\n  public getCellsFor(wpId:string):WorkPackageTimelineCell[] {\n    return _.filter(this.cells, (cell) => cell.workPackageId === wpId) || [];\n  }\n\n  /**\n   * Synchronize the currently active cells and render them all\n   */\n  public refreshAllCells() {\n    // Create new cells and delete old ones\n    this.synchronizeCells();\n\n    // Update all cells\n    _.each(this.cells, (cell) => this.refreshSingleCell(cell));\n  }\n\n  public refreshCellsFor(wpId:string) {\n    _.each(this.getCellsFor(wpId), (cell) => this.refreshSingleCell(cell));\n  }\n\n  public refreshSingleCell(cell:WorkPackageTimelineCell) {\n    const renderInfo = this.renderInfoFor(cell.workPackageId);\n\n    if (renderInfo.workPackage) {\n      cell.refreshView(renderInfo);\n    }\n  }\n\n  /**\n   * Synchronize the current cells:\n   *\n   * 1. Create new cells in workPackageIdOrder not yet tracked\n   * 2. Remove old cells no longer contained.\n   */\n  private synchronizeCells() {\n    const currentlyActive:string[] = Object.keys(this.cells);\n    const newCells:string[] = [];\n\n    _.each(this.wpTimeline.workPackageIdOrder, (renderedRow:RenderedWorkPackage) => {\n      const wpId = renderedRow.workPackageId;\n\n      // Ignore extra rows not tied to a work package\n      if (!wpId) {\n        return;\n      }\n\n      const state = this.states.workPackages.get(wpId);\n      if (state.isPristine()) {\n        return;\n      }\n\n      // As work packages may occur several times, get the unique identifier\n      // to identify the cell\n      const identifier = renderedRow.classIdentifier;\n\n      // Create a cell unless we already have an active cell\n      if (!this.cells[identifier]) {\n        this.cells[identifier] = this.buildCell(identifier, wpId.toString());\n      }\n\n      newCells.push(identifier);\n    });\n\n    _.difference(currentlyActive, newCells).forEach((identifier:string) => {\n      this.cells[identifier].clear();\n      delete this.cells[identifier];\n    });\n  }\n\n  private buildCell(classIdentifier:string, workPackageId:string) {\n    return new WorkPackageTimelineCell(\n      this.injector,\n      this.wpTimeline,\n      this.cellRenderers,\n      this.renderInfoFor(workPackageId),\n      classIdentifier,\n      workPackageId\n    );\n  }\n\n  private renderInfoFor(wpId:string):RenderInfo {\n    const wp = this.states.workPackages.get(wpId).value!;\n    return {\n      viewParams: this.wpTimeline.viewParameters,\n      workPackage: wp,\n      change: this.halEditing.changeFor(wp) as WorkPackageChangeset\n    };\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, Component, ElementRef, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {INotification, NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport * as moment from 'moment';\nimport {Moment} from 'moment';\nimport {filter, takeUntil} from 'rxjs/operators';\nimport {\n  calculateDaySpan,\n  getPixelPerDayForZoomLevel,\n  requiredPixelMarginLeft,\n  timelineElementCssClass,\n  timelineHeaderSelector,\n  timelineMarkerSelectionStartClass,\n  TimelineViewParameters,\n  zoomLevelOrder\n} from '../wp-timeline';\nimport {input, InputState} from \"reactivestates\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {WorkPackageTimelineCellsRenderer} from \"core-components/wp-table/timeline/cells/wp-timeline-cells-renderer\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackagesTableController} from \"core-components/wp-table/wp-table.directive\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageTimelineCell} from \"core-components/wp-table/timeline/cells/wp-timeline-cell\";\nimport {selectorTimelineSide} from \"core-components/wp-table/wp-table-scroll-sync\";\nimport {debugLog, timeOutput} from \"core-app/helpers/debug_output\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {combineLatest} from \"rxjs\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'wp-timeline-container',\n  templateUrl: './wp-timeline-container.html'\n})\nexport class WorkPackageTimelineTableController extends UntilDestroyedMixin implements AfterViewInit {\n  private $element:JQuery;\n\n  public workPackageTable:WorkPackageTable;\n\n  private _viewParameters:TimelineViewParameters = new TimelineViewParameters();\n\n  public disableViewParamsCalculation = false;\n\n  public workPackageIdOrder:RenderedWorkPackage[] = [];\n\n  private renderers:{ [name:string]:(vp:TimelineViewParameters) => void } = {};\n\n  private cellsRenderer = new WorkPackageTimelineCellsRenderer(this.injector, this);\n\n  public outerContainer:JQuery;\n\n  public timelineBody:JQuery;\n\n  private selectionParams:{ notification:INotification|null } = {\n    notification: null\n  };\n\n  private text:{ selectionMode:string };\n\n  private refreshRequest = input<void>();\n\n  constructor(public readonly injector:Injector,\n              private elementRef:ElementRef,\n              private states:States,\n              public wpTableDirective:WorkPackagesTableController,\n              private NotificationsService:NotificationsService,\n              private wpTableTimeline:WorkPackageViewTimelineService,\n              private notificationService:WorkPackageNotificationService,\n              private wpRelations:WorkPackageRelationsService,\n              private wpTableHierarchies:WorkPackageViewHierarchiesService,\n              private halEvents:HalEventsService,\n              private querySpace:IsolatedQuerySpace,\n              readonly I18n:I18nService) {\n    super();\n  }\n\n  ngAfterViewInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.text = {\n      selectionMode: this.I18n.t('js.timelines.selection_mode.notification')\n    };\n\n    // Get the outer container for width computation\n    this.outerContainer = this.$element.find('.wp-table-timeline--outer');\n    this.timelineBody = this.$element.find('.wp-table-timeline--body');\n\n    // Register this instance to the table\n    this.wpTableDirective.registerTimeline(this, this.timelineBody[0]);\n\n    // Refresh on window resize events\n    window.addEventListener('wp-resize.timeline', () => this.refreshRequest.putValue(undefined));\n\n    combineLatest([\n      this.querySpace.tableRendered.values$(),\n      this.refreshRequest.changes$(),\n      this.wpTableTimeline.live$()\n    ]).pipe(\n      this.untilDestroyed(),\n      takeUntil(this.querySpace.stopAllSubscriptions),\n      filter(() => this.initialized && this.wpTableTimeline.isVisible)\n    )\n      .subscribe(([orderedRows, changes, timelineState]) => {\n        // Remember all visible rows in their order of appearance.\n        this.workPackageIdOrder = orderedRows.filter(row => !row.hidden);\n        this.refreshView();\n      });\n  }\n\n  workPackageCells(wpId:string):WorkPackageTimelineCell[] {\n    return this.cellsRenderer.getCellsFor(wpId);\n  }\n\n  /**\n   * Return the index of a given row by its class identifier\n   */\n  workPackageIndex(classIdentifier:string):number {\n    return this.workPackageIdOrder.findIndex((el) => el.classIdentifier === classIdentifier);\n  }\n\n  onRefreshRequested(name:string, callback:(vp:TimelineViewParameters) => void) {\n    this.renderers[name] = callback;\n  }\n\n  getAbsoluteLeftCoordinates():number {\n    return this.$element.offset()!.left;\n  }\n\n  getParentScrollContainer() {\n    return this.outerContainer.closest(selectorTimelineSide)[0];\n  }\n\n  get viewParameters():TimelineViewParameters {\n    return this._viewParameters;\n  }\n\n  get inHierarchyMode():boolean {\n    return this.wpTableHierarchies.isEnabled;\n  }\n\n  get initialized():boolean {\n    return this.workPackageTable && this.querySpace.tableRendered.hasValue();\n  }\n\n  refreshView() {\n    if (!this.wpTableTimeline.isVisible) {\n      debugLog('refreshView() requested, but TL is invisible.');\n      return;\n    }\n\n    if (this.wpTableTimeline.isAutoZoom()) {\n      // Update autozoom level\n      this.applyAutoZoomLevel();\n    } else {\n      this._viewParameters.settings.zoomLevel = this.wpTableTimeline.zoomLevel;\n      this.wpTableTimeline.appliedZoomLevel = this.wpTableTimeline.zoomLevel;\n    }\n\n    timeOutput('refreshView() in timeline container', () => {\n      // Reset the width of the outer container if its content shrinks\n      this.outerContainer.css('width', 'auto');\n\n      this.calculateViewParams(this._viewParameters);\n\n      // Update all cells\n      this.cellsRenderer.refreshAllCells();\n\n      _.each(this.renderers, (cb, key) => {\n        debugLog(`Refreshing timeline member ${key}`);\n        cb(this._viewParameters);\n      });\n\n      // Calculate overflowing width to set to outer container\n      // required to match width in all child divs.\n      // The header is the only one reliable, as it already has the final width.\n      const currentWidth = this.$element.find(timelineHeaderSelector)[0].scrollWidth;\n      this.outerContainer.width(currentWidth);\n\n      // Mark rendering event in a timeout to give DOM some time\n      setTimeout(() => {\n        this.querySpace.timelineRendered.next(null);\n      });\n    });\n  }\n\n  startAddRelationPredecessor(start:WorkPackageResource) {\n    this.activateSelectionMode(start.id!, end => {\n      this.wpRelations\n        .addCommonRelation(start.id!, 'follows', end.id!)\n        .then(() => {\n          this.halEvents.push(start, {\n            eventType: 'association',\n            relatedWorkPackage: end.id!,\n            relationType: 'follows'\n          });\n        })\n        .catch((error:any) => this.notificationService.handleRawError(error, end));\n    });\n  }\n\n  startAddRelationFollower(start:WorkPackageResource) {\n    this.activateSelectionMode(start.id!, end => {\n      this.wpRelations\n        .addCommonRelation(start.id!, 'precedes', end.id!)\n        .then(() => {\n          this.halEvents.push(start, {\n            eventType: 'association',\n            relatedWorkPackage: end.id!,\n            relationType: 'precedes'\n          });\n        })\n        .catch((error:any) => this.notificationService.handleRawError(error, end));\n    });\n  }\n\n  getFirstDayInViewport() {\n    const outerContainer = this.getParentScrollContainer();\n    const scrollLeft = outerContainer.scrollLeft;\n    const nonVisibleDaysLeft = Math.floor(scrollLeft / this.viewParameters.pixelPerDay);\n    return this.viewParameters.dateDisplayStart.clone().add(nonVisibleDaysLeft, 'days');\n  }\n\n  getLastDayInViewport() {\n    const outerContainer = this.getParentScrollContainer();\n    const scrollLeft = outerContainer.scrollLeft;\n    const width = outerContainer.offsetWidth;\n    const viewPortRight = scrollLeft + width;\n    const daysUntilViewPortEnds = Math.ceil(viewPortRight / this.viewParameters.pixelPerDay) + 1;\n    return this.viewParameters.dateDisplayStart.clone().add(daysUntilViewPortEnds, 'days');\n  }\n\n  forceCursor(cursor:string) {\n    jQuery('.' + timelineElementCssClass).css('cursor', cursor);\n    jQuery('.wp-timeline-cell').css('cursor', cursor);\n    jQuery('.hascontextmenu').css('cursor', cursor);\n    jQuery('.leftHandle').css('cursor', cursor);\n    jQuery('.rightHandle').css('cursor', cursor);\n  }\n\n  resetCursor() {\n    jQuery('.' + timelineElementCssClass).css('cursor', '');\n    jQuery('.wp-timeline-cell').css('cursor', '');\n    jQuery('.hascontextmenu').css('cursor', '');\n    jQuery('.leftHandle').css('cursor', '');\n    jQuery('.rightHandle').css('cursor', '');\n  }\n\n  private resetSelectionMode() {\n    this._viewParameters.activeSelectionMode = null;\n    this._viewParameters.selectionModeStart = null;\n\n    if (this.selectionParams.notification) {\n      this.NotificationsService.remove(this.selectionParams.notification);\n    }\n\n    Mousetrap.unbind('esc');\n\n    this.$element.removeClass('active-selection-mode');\n    jQuery('.' + timelineMarkerSelectionStartClass).removeClass(timelineMarkerSelectionStartClass);\n    this.refreshView();\n  }\n\n  private activateSelectionMode(start:string, callback:(wp:WorkPackageResource) => any) {\n    start = start.toString(); // old system bug: ID can be a 'number'\n\n    this._viewParameters.activeSelectionMode = (wp:WorkPackageResource) => {\n      callback(wp);\n      this.resetSelectionMode();\n    };\n\n    this._viewParameters.selectionModeStart = start;\n    Mousetrap.bind('esc', () => this.resetSelectionMode());\n    this.selectionParams.notification = this.NotificationsService.addNotice(this.text.selectionMode);\n\n    this.$element.addClass('active-selection-mode');\n\n    this.refreshView();\n  }\n\n  private calculateViewParams(currentParams:TimelineViewParameters):boolean {\n    if (this.disableViewParamsCalculation) {\n      return false;\n    }\n\n    const newParams = new TimelineViewParameters();\n    let changed = false;\n\n    // Calculate view parameters\n    this.workPackageIdOrder.forEach((renderedRow) => {\n      const wpId = renderedRow.workPackageId;\n\n      if (!wpId) {\n        return;\n      }\n      const workPackageState:InputState<WorkPackageResource> = this.states.workPackages.get(wpId);\n      const workPackage:WorkPackageResource|undefined = workPackageState.value;\n\n      if (!workPackage) {\n        return;\n      }\n\n      // We may still have a reference to a row that, e.g., just got deleted\n      const startDate = workPackage.startDate ? moment(workPackage.startDate) : currentParams.now;\n      const dueDate = workPackage.dueDate ? moment(workPackage.dueDate) : currentParams.now;\n      const date = workPackage.date ? moment(workPackage.date) : currentParams.now;\n\n      // start date\n      newParams.dateDisplayStart = moment.min(\n        newParams.dateDisplayStart,\n        currentParams.now,\n        startDate,\n        date);\n\n      // finish date\n      newParams.dateDisplayEnd = moment.max(\n        newParams.dateDisplayEnd,\n        currentParams.now,\n        dueDate,\n        date);\n    });\n\n    // left spacing\n    newParams.dateDisplayStart = newParams.dateDisplayStart.subtract(currentParams.dayCountForMarginLeft, 'days');\n\n    // right spacing\n    // RR: kept both variants for documentation purpose.\n    // A: calculate the minimal width based on the width of the timeline view\n    // B: calculate the minimal width based on the window width\n    const width = this.$element.children().width()!; // A\n    // const width = jQuery('body').width(); // B\n\n    const pixelPerDay = currentParams.pixelPerDay;\n    const visibleDays = Math.ceil((width / pixelPerDay) * 1.5);\n    newParams.dateDisplayEnd = newParams.dateDisplayEnd.add(visibleDays, 'days');\n\n    // Check if view params changed:\n\n    // start date\n    if (!newParams.dateDisplayStart.isSame(this._viewParameters.dateDisplayStart)) {\n      changed = true;\n      this._viewParameters.dateDisplayStart = newParams.dateDisplayStart;\n    }\n\n    // end date\n    if (!newParams.dateDisplayEnd.isSame(this._viewParameters.dateDisplayEnd)) {\n      changed = true;\n      this._viewParameters.dateDisplayEnd = newParams.dateDisplayEnd;\n    }\n\n    // Calculate the visible viewport\n    const firstDayInViewport = this.getFirstDayInViewport();\n    const lastDayInViewport = this.getLastDayInViewport();\n    const viewport:[Moment, Moment] = [firstDayInViewport, lastDayInViewport];\n    this._viewParameters.visibleViewportAtCalculationTime = viewport;\n\n    return changed;\n  }\n\n  private applyAutoZoomLevel() {\n    if (this.workPackageIdOrder.length === 0) {\n      return;\n    }\n\n    const daysSpan = calculateDaySpan(this.workPackageIdOrder, this.states.workPackages, this._viewParameters);\n    const timelineWidthInPx = this.$element.parent().width()! - (2 * requiredPixelMarginLeft);\n\n    for (let zoomLevel of zoomLevelOrder) {\n      const pixelPerDay = getPixelPerDayForZoomLevel(zoomLevel);\n      const visibleDays = timelineWidthInPx / pixelPerDay;\n\n      if (visibleDays >= daysSpan || zoomLevel === _.last(zoomLevelOrder)) {\n        // Zoom level is enough\n        const previousZoomLevel = this._viewParameters.settings.zoomLevel;\n\n        // did the zoom level changed?\n        if (previousZoomLevel !== zoomLevel) {\n          this._viewParameters.settings.zoomLevel = zoomLevel;\n          this.wpTableDirective.timeline.scrollLeft = 0;\n        }\n\n        this.wpTableTimeline.appliedZoomLevel = zoomLevel;\n        return;\n      }\n    }\n  }\n}\n","<div class=\"wp-table-timeline--outer\">\n  <div class=\"wp-table-timeline--container\">\n    <wp-timeline-header></wp-timeline-header>\n    <wp-timeline-static-elements></wp-timeline-static-elements>\n    <wp-timeline-grid></wp-timeline-grid>\n    <wp-timeline-relations></wp-timeline-relations>\n    <div class=\"wp-table-timeline--body\"></div>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Directive, ElementRef, Injector, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\n\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {OpModalService} from 'core-components/op-modals/op-modal.service';\nimport {WorkPackageViewColumnsService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service';\nimport {WorkPackageViewGroupByService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service';\nimport {WorkPackageViewHierarchiesService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service';\nimport {WorkPackageViewSortByService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service';\nimport {WorkPackageTable} from 'core-components/wp-fast-table/wp-fast-table';\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {WpTableConfigurationModalComponent} from 'core-components/wp-table/configuration-modal/wp-table-configuration.modal';\nimport {ConfirmDialogService} from \"core-components/modals/confirm-dialog/confirm-dialog.service\";\nimport {QUERY_SORT_BY_ASC, QUERY_SORT_BY_DESC} from \"core-app/modules/hal/resources/query-sort-by-resource\";\n\n@Directive({\n  selector: '[opColumnsContextMenu]'\n})\nexport class OpColumnsContextMenu extends OpContextMenuTrigger {\n  @Input('opColumnsContextMenu-column') public column:QueryColumn;\n  @Input('opColumnsContextMenu-table') public table:WorkPackageTable;\n\n  public text = {\n    confirmDelete: {\n      text: this.I18n.t('js.work_packages.table_configuration.sorting_mode.warning'),\n      title: this.I18n.t('js.modals.form_submit.title')\n    },\n  };\n\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly wpTableSortBy:WorkPackageViewSortByService,\n              readonly wpTableGroupBy:WorkPackageViewGroupByService,\n              readonly wpTableHierarchies:WorkPackageViewHierarchiesService,\n              readonly opModalService:OpModalService,\n              readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly confirmDialog:ConfirmDialogService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    if (!this.table.configuration.columnMenuEnabled) {\n      return;\n    }\n    this.buildItems();\n    this.opContextMenu.show(this, evt);\n  }\n\n  public get locals() {\n    return {\n      showAnchorRight: this.column && this.column.id !== 'id',\n      contextMenuId: 'column-context-menu',\n      items: this.items\n    };\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let additionalPositionArgs = {\n      of: this.$element.find('.generic-table--sort-header-outer'),\n    };\n\n    let position = super.positionArgs(evt);\n    _.assign(position, additionalPositionArgs);\n\n    return position;\n  }\n\n  protected get afterFocusOn():JQuery {\n    return this.$element.find(`#${this.column.id}`);\n  }\n\n  private buildItems() {\n    let c = this.column;\n\n    this.items = [\n      {\n        // Sort ascending\n        hidden: !this.wpTableSortBy.isSortable(c),\n        linkText: this.I18n.t('js.work_packages.query.sort_descending'),\n        icon: 'icon-sort-descending',\n        onClick: (evt:any) => {\n          if (this.wpTableSortBy.isManualSortingMode) {\n            this.confirmDialog.confirm({\n              text: this.text.confirmDelete,\n            }).then(() => {\n              this.wpTableSortBy.setAsSingleSortCriteria(c, QUERY_SORT_BY_DESC);\n              return true;\n            });\n            return false;\n          } else {\n            this.wpTableSortBy.addSortCriteria(c, QUERY_SORT_BY_DESC);\n            return true;\n          }\n        }\n      },\n      {\n        // Sort descending\n        hidden: !this.wpTableSortBy.isSortable(c),\n        linkText: this.I18n.t('js.work_packages.query.sort_ascending'),\n        icon: 'icon-sort-ascending',\n        onClick: (evt:any) => {\n          if (this.wpTableSortBy.isManualSortingMode) {\n            this.confirmDialog.confirm({\n              text: this.text.confirmDelete,\n            }).then(() => {\n              this.wpTableSortBy.setAsSingleSortCriteria(c, QUERY_SORT_BY_ASC);\n              return true;\n            });\n            return false;\n          } else {\n            this.wpTableSortBy.addSortCriteria(c, QUERY_SORT_BY_ASC);\n            return true;\n          }\n        }\n      },\n      {\n        // Group by\n        hidden: !this.wpTableGroupBy.isGroupable(c) || this.wpTableGroupBy.isCurrentlyGroupedBy(c),\n        linkText: this.I18n.t('js.work_packages.query.group'),\n        icon: 'icon-group-by',\n        onClick: () => {\n          if (this.wpTableHierarchies.isEnabled) {\n            this.wpTableHierarchies.setEnabled(false);\n          }\n          this.wpTableGroupBy.setBy(c);\n          return true;\n        }\n      },\n      {\n        // Move left\n        hidden: this.wpTableColumns.isFirst(c),\n        linkText: this.I18n.t('js.work_packages.query.move_column_left'),\n        icon: 'icon-column-left',\n        onClick: () => {\n          this.wpTableColumns.shift(c, -1);\n          return true;\n        }\n      },\n      {\n        // Move right\n        hidden: this.wpTableColumns.isLast(c),\n        linkText: this.I18n.t('js.work_packages.query.move_column_right'),\n        icon: 'icon-column-right',\n        onClick: () => {\n          this.wpTableColumns.shift(c, 1);\n          return true;\n        }\n      },\n      {\n        // Hide column\n        linkText: this.I18n.t('js.work_packages.query.hide_column'),\n        icon: 'icon-delete',\n        onClick: () => {\n          let focusColumn = this.wpTableColumns.previous(c) || this.wpTableColumns.next(c);\n          this.wpTableColumns.removeColumn(c);\n\n          setTimeout(() => {\n            if (focusColumn) {\n              jQuery(`#${focusColumn.id}`).focus();\n            }\n          });\n          return true;\n        }\n      },\n      {\n        // Insert columns\n        linkText: this.I18n.t('js.work_packages.query.insert_columns'),\n        icon: 'icon-columns',\n        onClick: () => {\n          this.opModalService.show<WpTableConfigurationModalComponent>(\n            WpTableConfigurationModalComponent,\n            this.injector,\n            { initialTab: 'columns' }\n          );\n          return true;\n        }\n      }\n    ];\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit} from '@angular/core';\nimport {TimelineZoomLevel} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageTimelineTableController} from 'core-components/wp-table/timeline/container/wp-timeline-container.directive';\nimport * as moment from 'moment';\nimport {\n  calculatePositionValueForDayCount,\n  getTimeSlicesForHeader,\n  timelineHeaderCSSClass,\n  timelineHeaderSelector,\n  TimelineViewParameters\n} from '../wp-timeline';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport Moment = moment.Moment;\n\n@Component({\n  selector: timelineHeaderSelector,\n  templateUrl: './wp-timeline-header.html'\n})\nexport class WorkPackageTimelineHeaderController implements OnInit {\n\n  public $element:JQuery;\n\n  private activeZoomLevel:TimelineZoomLevel;\n\n  private innerHeader:JQuery;\n\n  constructor(elementRef:ElementRef,\n              readonly I18n:I18nService,\n              readonly wpTimelineService:WorkPackageViewTimelineService,\n              readonly workPackageTimelineTableController:WorkPackageTimelineTableController) {\n\n    this.$element = jQuery(elementRef.nativeElement);\n  }\n\n  ngOnInit() {\n    this.workPackageTimelineTableController\n      .onRefreshRequested('header', (vp:TimelineViewParameters) => this.refreshView(vp));\n  }\n\n  refreshView(vp:TimelineViewParameters) {\n    this.innerHeader = this.$element.find('.wp-table-timeline--header-inner');\n    this.renderLabels(vp);\n  }\n\n  private renderLabels(vp:TimelineViewParameters) {\n    if (this.activeZoomLevel === vp.settings.zoomLevel) {\n      return;\n    }\n\n    this.innerHeader.empty();\n    this.innerHeader.attr('data-current-zoom-level', this.wpTimelineService.zoomLevel);\n\n    switch (vp.settings.zoomLevel) {\n      case 'days':\n        return this.renderLabelsDays(vp);\n      case 'weeks':\n        return this.renderLabelsWeeks(vp);\n      case 'months':\n        return this.renderLabelsMonths(vp);\n      case 'quarters':\n        return this.renderLabelsQuarters(vp);\n      case 'years':\n        return this.renderLabelsYears(vp);\n    }\n\n    this.activeZoomLevel = vp.settings.zoomLevel;\n  }\n\n  private renderLabelsDays(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'month', 0, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('MMM YYYY');\n      cell.classList.add('wp-timeline--header-top-bold-element');\n      cell.style.height = '13px';\n    });\n\n    this.renderTimeSlices(vp, 'week', 13, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('ww');\n      cell.classList.add('-top-border');\n      cell.style.height = '32px';\n    });\n\n    this.renderTimeSlices(vp, 'day', 23, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('D');\n      cell.classList.add('-top-border');\n      cell.style.height = '22px';\n    });\n\n    this.renderTimeSlices(vp, 'day', 33, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('dd');\n      cell.classList.add('wp-timeline--header-day-element');\n    });\n  }\n\n  private renderLabelsWeeks(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'month', 0, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('MMM YYYY');\n      cell.classList.add('wp-timeline--header-top-bold-element');\n    });\n\n    this.renderTimeSlices(vp, 'week', 15, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('ww');\n      cell.classList.add('-top-border');\n      cell.style.height = '22px';\n    });\n\n    this.renderTimeSlices(vp, 'day', 25, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('D');\n      cell.classList.add('wp-timeline--header-middle-element');\n    });\n  }\n\n  private renderLabelsMonths(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'year', 0, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('YYYY');\n      cell.classList.add('wp-timeline--header-top-bold-element');\n    });\n\n    this.renderTimeSlices(vp, 'month', 15, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('MMM');\n      cell.classList.add('-top-border');\n      cell.style.height = '30px';\n    });\n\n    this.renderTimeSlices(vp, 'week', 25, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('ww');\n      cell.classList.add('wp-timeline--header-middle-element');\n    });\n  }\n\n  private renderLabelsQuarters(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'year', 0, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('wp-timeline--header-top-bold-element');\n      cell.innerHTML = start.format('YYYY');\n    });\n\n    this.renderTimeSlices(vp, 'quarter', 15, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = this.I18n.t('js.timelines.quarter_label',\n        { quarter_number: start.format('Q') });\n      cell.classList.add('-top-border');\n      cell.style.height = '30px';\n    });\n\n    this.renderTimeSlices(vp, 'month', 25, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('MMM');\n      cell.classList.add('wp-timeline--header-middle-element');\n    });\n  }\n\n  private renderLabelsYears(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'year', 0, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('YYYY');\n      cell.classList.add('wp-timeline--header-top-bold-element');\n\n    });\n\n    this.renderTimeSlices(vp, 'quarter', 15, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = this.I18n.t('js.timelines.quarter_label',\n        { quarter_number: start.format('Q') });\n      cell.classList.add('-top-border');\n      cell.style.height = '30px';\n    });\n\n    this.renderTimeSlices(vp, 'month', 25, vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.innerHTML = start.format('M');\n      cell.classList.add('wp-timeline--header-middle-element');\n    });\n  }\n\n  private renderTimeSlices(vp:TimelineViewParameters,\n                           unit:moment.unitOfTime.DurationConstructor,\n                           marginTop:number,\n                           startView:Moment,\n                           endView:Moment,\n                           cellCallback:(start:Moment, cell:HTMLElement) => void) {\n\n    const {inViewportAndBoundaries, rest} = getTimeSlicesForHeader(vp, unit, startView, endView);\n\n    for (let [start, end] of inViewportAndBoundaries) {\n      const cell = this.addLabelCell();\n      cell.style.top = marginTop + 'px';\n      cell.style.left = calculatePositionValueForDayCount(vp, start.diff(startView, 'days'));\n      cell.style.width = calculatePositionValueForDayCount(vp, end.diff(start, 'days') + 1);\n      cellCallback(start, cell);\n    }\n    setTimeout(() => {\n      for (let [start, end] of rest) {\n        const cell = this.addLabelCell();\n        cell.style.top = marginTop + 'px';\n        cell.style.left = calculatePositionValueForDayCount(vp, start.diff(startView, 'days'));\n        cell.style.width = calculatePositionValueForDayCount(vp, end.diff(start, 'days') + 1);\n        cellCallback(start, cell);\n      }\n    }, 0);\n  }\n\n  private addLabelCell():HTMLElement {\n    const label = document.createElement('div');\n    label.className = timelineHeaderCSSClass;\n\n    this.innerHeader.append(label);\n    return label;\n  }\n}\n","<div class=\"wp-table-timeline--header\">\n  <div class=\"wp-table-timeline--header-inner\"></div>\n</div>\n","import {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\n\nexport function workPackagePrefix(workPackageId:string) {\n  return `__tl-relation-${workPackageId}`;\n}\n\nexport class TimelineRelationElement {\n\n  constructor(public belongsToId:string, public relation:RelationResource) {\n  }\n\n  public get classNames():string[] {\n    return [\n      workPackagePrefix(this.relation.ids.from),\n      workPackagePrefix(this.relation.ids.to)\n    ];\n  }\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, Injector, OnInit} from '@angular/core';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {State} from 'reactivestates';\nimport {combineLatest} from 'rxjs';\nimport {filter, map, take} from 'rxjs/operators';\nimport {States} from '../../../states.service';\nimport {RelationsStateValue, WorkPackageRelationsService} from '../../../wp-relations/wp-relations.service';\nimport {WorkPackageTimelineCell} from '../cells/wp-timeline-cell';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {timelineElementCssClass, TimelineViewParameters} from '../wp-timeline';\nimport {TimelineRelationElement, workPackagePrefix} from './timeline-relation-element';\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nconst DEBUG_DRAW_RELATION_LINES_WITH_COLOR = false;\n\nexport const timelineGlobalElementCssClassname = 'relation-line';\n\nfunction newSegment(vp:TimelineViewParameters,\n                    classNames:string[],\n                    yPosition:number,\n                    top:number,\n                    left:number,\n                    width:number,\n                    height:number,\n                    color?:string):HTMLElement {\n\n  const segment = document.createElement('div');\n  segment.classList.add(\n    timelineElementCssClass,\n    timelineGlobalElementCssClassname,\n    ...classNames\n  );\n\n  // segment.style.backgroundColor = color;\n  segment.style.top = ((yPosition * 40) + top) + 'px';\n  segment.style.left = left + 'px';\n  segment.style.width = width + 'px';\n  segment.style.height = height + 'px';\n\n  if (DEBUG_DRAW_RELATION_LINES_WITH_COLOR && color !== undefined) {\n    segment.style.zIndex = '9999999';\n    segment.style.backgroundColor = color;\n  }\n  return segment;\n}\n\n@Component({\n  selector: 'wp-timeline-relations',\n  template: '<div class=\"wp-table-timeline--relations\"></div>'\n})\nexport class WorkPackageTableTimelineRelations extends UntilDestroyedMixin implements OnInit {\n\n  @InjectField() querySpace:IsolatedQuerySpace;\n\n  private container:JQuery;\n\n  private workPackagesWithRelations:{ [workPackageId:string]:State<RelationsStateValue> } = {};\n\n  constructor(public readonly injector:Injector,\n              public elementRef:ElementRef,\n              public states:States,\n              public workPackageTimelineTableController:WorkPackageTimelineTableController,\n              public wpTableTimeline:WorkPackageViewTimelineService,\n              public wpRelations:WorkPackageRelationsService) {\n    super();\n  }\n\n  ngOnInit() {\n    const $element = jQuery(this.elementRef.nativeElement);\n    this.container = $element.find('.wp-table-timeline--relations');\n    this.workPackageTimelineTableController\n      .onRefreshRequested('relations', (vp:TimelineViewParameters) => this.refreshView());\n\n    this.setupRelationSubscription();\n  }\n\n  private refreshView() {\n    this.update();\n  }\n\n  private get workPackageIdOrder() {\n    return this.workPackageTimelineTableController.workPackageIdOrder;\n  }\n\n  /**\n   * Refresh relations of visible rows.\n   */\n  private setupRelationSubscription() {\n    // for all visible WorkPackage rows...\n    combineLatest([\n      this.querySpace.renderedWorkPackages.values$(),\n      this.wpTableTimeline.live$()\n    ])\n      .pipe(\n        filter(([_, timeline]) => timeline.visible),\n        this.untilDestroyed(),\n        map(([rendered, _]) => rendered)\n      )\n      .subscribe(list => {\n        // ... make sure that the corresponding relations are loaded ...\n        const wps = _.compact(list.map(row => row.workPackageId) as string[]);\n        this.wpRelations.requireAll(wps);\n\n        wps.forEach(wpId => {\n          const relationsForWorkPackage = this.wpRelations.state(wpId);\n          this.workPackagesWithRelations[wpId] = relationsForWorkPackage;\n\n          // ... once they are loaded, display them.\n          relationsForWorkPackage.values$()\n            .pipe(\n              take(1)\n            )\n            .subscribe(() => {\n              this.renderWorkPackagesRelations([wpId]);\n            });\n        });\n      });\n\n    // When a WorkPackage changes, redraw the corresponding relations\n    this.states.workPackages.observeChange()\n      .pipe(\n        this.untilDestroyed(),\n        filter(() => this.wpTableTimeline.isVisible)\n      )\n      .subscribe(([workPackageId]) => {\n        this.renderWorkPackagesRelations([workPackageId]);\n      });\n\n  }\n\n  private renderWorkPackagesRelations(workPackageIds:string[]) {\n    workPackageIds.forEach(workPackageId => {\n      const workPackageWithRelation = this.workPackagesWithRelations[workPackageId];\n      if (_.isNil(workPackageWithRelation)) {\n        return;\n      }\n\n      this.removeRelationElementsForWorkPackage(workPackageId);\n      const relations = _.values(workPackageWithRelation.value!);\n      const relationsList = _.values(relations);\n      relationsList.forEach(relation => {\n\n        if (!(relation.type === 'precedes'\n          || relation.type === 'follows')) {\n          return;\n        }\n\n        const elem = new TimelineRelationElement(relation.ids.from, relation);\n        this.renderElement(this.workPackageTimelineTableController.viewParameters, elem);\n      });\n\n    });\n  }\n\n  private update() {\n    this.removeAllVisibleElements();\n    this.renderElements();\n  }\n\n  private removeRelationElementsForWorkPackage(workPackageId:string) {\n    const className = workPackagePrefix(workPackageId);\n    const found = this.container.find('.' + className);\n    found.remove();\n  }\n\n  private removeAllVisibleElements() {\n    this.container.find('.' + timelineGlobalElementCssClassname).remove();\n  }\n\n  private renderElements() {\n    const wpIdsWithRelations:string[] = _.keys(this.workPackagesWithRelations);\n    this.renderWorkPackagesRelations(wpIdsWithRelations);\n\n  }\n\n  /**\n   * Render a single relation to all shown work packages. Since work packages may occur multiple\n   * times in the timeline, iterate all potential combinations and render them.\n   * @param vp\n   * @param e\n   */\n  private renderElement(vp:TimelineViewParameters, e:TimelineRelationElement) {\n    const involved = e.relation.ids;\n\n    const startCells = this.workPackageTimelineTableController.workPackageCells(involved.to);\n    const endCells = this.workPackageTimelineTableController.workPackageCells(involved.from);\n\n    // If either sources or targets are not rendered, ignore this relation\n    if (startCells.length === 0 || endCells.length === 0) {\n      return;\n    }\n\n    // Now, render all sources to all targets\n    startCells.forEach((startCell) => {\n      const idxFrom = this.workPackageTimelineTableController.workPackageIndex(startCell.classIdentifier);\n      endCells.forEach((endCell) => {\n        const idxTo = this.workPackageTimelineTableController.workPackageIndex(endCell.classIdentifier);\n        this.renderRelation(vp, e, idxFrom, idxTo, startCell, endCell);\n      });\n    });\n  }\n\n  private renderRelation(vp:TimelineViewParameters,\n                         e:TimelineRelationElement,\n                         idxFrom:number,\n                         idxTo:number,\n                         startCell:WorkPackageTimelineCell,\n                         endCell:WorkPackageTimelineCell) {\n\n    const rowFrom = this.workPackageIdOrder[idxFrom];\n    const rowTo = this.workPackageIdOrder[idxTo];\n\n    // If any of the targets are hidden in the table, skip\n    if (!(rowFrom && rowTo) || (rowFrom.hidden || rowTo.hidden)) {\n      return;\n    }\n\n    // Skip if relations cannot be drawn between these cells\n    if (!startCell.canConnectRelations() || !endCell.canConnectRelations()) {\n      return;\n    }\n\n    // Get X values\n    // const hookLength = endCell.getPaddingLeftForIncomingRelationLines();\n    const startX = startCell.getMarginLeftOfRightSide() - startCell.getPaddingRightForOutgoingRelationLines();\n    const targetX = endCell.getMarginLeftOfLeftSide() + endCell.getPaddingLeftForIncomingRelationLines();\n\n    // Vertical direction\n    const directionY:'toUp'|'toDown' = idxFrom < idxTo ? 'toDown' : 'toUp';\n\n    // Horizontal direction\n    const directionX:'toLeft'|'beneath'|'toRight' =\n      targetX > startX ? 'toRight' : targetX < startX ? 'toLeft' : 'beneath';\n\n    // start\n    if (!startCell) {\n      return;\n    }\n\n    // Draw the first line next to the bar/milestone element\n    const paddingRight = startCell.getPaddingRightForOutgoingRelationLines();\n    const startLineWith = endCell.getPaddingLeftForIncomingRelationLines()\n      + (paddingRight > 0 ? paddingRight : 0);\n    this.container.append(newSegment(vp, e.classNames, idxFrom, 19, startX, startLineWith, 1, 'red'));\n    let lastX = startX + startLineWith;\n    // lastX += hookLength;\n\n    // Draw vertical line between rows\n    const height = Math.abs(idxTo - idxFrom);\n    if (directionY === 'toDown') {\n      if (directionX === 'toRight' || directionX === 'beneath') {\n        this.container.append(newSegment(vp, e.classNames, idxFrom, 19, lastX, 1, height * 40, 'black'));\n      } else if (directionX === 'toLeft') {\n        this.container.append(newSegment(vp, e.classNames, idxFrom, 19, lastX, 1, (height * 40) - 10, 'black'));\n      }\n    } else if (directionY === 'toUp') {\n      this.container.append(newSegment(vp, e.classNames, idxTo, 30, lastX, 1, (height * 40) - 10, 'black'));\n    }\n\n    // Draw end corner to the target\n    if (directionX === 'toRight') {\n      if (directionY === 'toDown') {\n        this.container.append(newSegment(vp, e.classNames, idxTo, 19, lastX, targetX - lastX, 1, 'red'));\n      } else if (directionY === 'toUp') {\n        this.container.append(newSegment(vp, e.classNames, idxTo, 20, lastX, 1, 10, 'green'));\n        this.container.append(newSegment(vp, e.classNames, idxTo, 20, lastX, targetX - lastX, 1, 'lightsalmon'));\n      }\n    } else if (directionX === 'toLeft') {\n      if (directionY === 'toDown') {\n        this.container.append(newSegment(vp, e.classNames, idxTo, 0, lastX, 1, 8, 'red'));\n        this.container.append(newSegment(vp, e.classNames, idxTo, 8, targetX, lastX - targetX, 1, 'green'));\n        this.container.append(newSegment(vp, e.classNames, idxTo, 8, targetX, 1, 11, 'blue'));\n      } else if (directionY === 'toUp') {\n        this.container.append(newSegment(vp, e.classNames, idxTo, 30, targetX + 1, lastX - targetX, 1, 'red'));\n        this.container.append(newSegment(vp, e.classNames, idxTo, 19, targetX + 1, 1, 11, 'blue'));\n      }\n    }\n\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport * as moment from 'moment';\nimport {calculatePositionValueForDayCount, TimelineViewParameters} from '../wp-timeline';\nimport {TimelineStaticElement} from './timeline-static-element';\n\n\nexport class TodayLineElement extends TimelineStaticElement {\n\n  protected finishElement(elem:HTMLElement, vp:TimelineViewParameters):HTMLElement {\n    const offsetToday = vp.now.diff(vp.dateDisplayStart, 'days');\n    const dayProgress = moment().hour() / 24;\n    elem.style.left = calculatePositionValueForDayCount(vp, offsetToday + dayProgress);\n\n    return elem;\n  }\n\n  public get identifier():string {\n    return 'wp-timeline-static-element-today-line';\n  }\n}\n\n","import {TimelineViewParameters} from \"../wp-timeline\";\nexport const timelineStaticElementCssClassname = \"wp-timeline--static-element\";\n\nexport abstract class TimelineStaticElement {\n  constructor() {\n  }\n\n  /**\n   * Render the static element according to the current ViewParameters\n   * @param vp Current timeline view paraemters\n   * @returns {HTMLElement} The finished static element\n   */\n  public render(vp:TimelineViewParameters):HTMLElement {\n    const elem = document.createElement(\"div\");\n    elem.id = this.identifier;\n    elem.classList.add(...this.classNames);\n\n    return this.finishElement(elem, vp);\n  }\n\n  protected abstract finishElement(elem:HTMLElement, vp:TimelineViewParameters):HTMLElement;\n\n  public abstract get identifier():string;\n\n  public get classNames():string[] {\n    return [timelineStaticElementCssClassname];\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport {Component, ElementRef, OnInit} from '@angular/core';\nimport {States} from '../../../states.service';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {TimelineViewParameters} from '../wp-timeline';\nimport {TimelineStaticElement, timelineStaticElementCssClassname} from './timeline-static-element';\nimport {TodayLineElement} from './wp-timeline.today-line';\n\n@Component({\n  selector: 'wp-timeline-static-elements',\n  template: '<div class=\"wp-table-timeline--static-elements\"></div>'\n})\nexport class WorkPackageTableTimelineStaticElements implements OnInit {\n\n  public $element:JQuery;\n\n  private container:JQuery;\n\n  private elements:TimelineStaticElement[];\n\n  constructor(elementRef:ElementRef,\n              public states:States,\n              public workPackageTimelineTableController:WorkPackageTimelineTableController) {\n\n    this.$element = jQuery(elementRef.nativeElement);\n\n    this.elements = [\n      new TodayLineElement()\n    ];\n  }\n\n  ngOnInit() {\n    this.container = this.$element.find('.wp-table-timeline--static-elements');\n    this.workPackageTimelineTableController\n      .onRefreshRequested('static elements', (vp:TimelineViewParameters) => this.update(vp));\n  }\n\n  private update(vp:TimelineViewParameters) {\n    this.removeAllVisibleElements();\n    this.renderElements(vp);\n  }\n\n  private removeAllVisibleElements() {\n    jQuery('.' + timelineStaticElementCssClassname).remove();\n  }\n\n  private renderElements(vp:TimelineViewParameters) {\n    for (const e of this.elements) {\n      this.container[0].appendChild(e.render(vp));\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport {AfterViewInit, Component, ElementRef} from '@angular/core';\nimport * as moment from 'moment';\nimport {WorkPackageTimelineTableController} from '../container/wp-timeline-container.directive';\nimport {\n  calculatePositionValueForDayCount,\n  getTimeSlicesForHeader,\n  timelineElementCssClass,\n  timelineGridElementCssClass,\n  TimelineViewParameters\n} from '../wp-timeline';\nimport Moment = moment.Moment;\nimport {TimelineZoomLevel} from 'core-app/modules/hal/resources/query-resource';\n\nfunction checkForWeekendHighlight(date:Moment, cell:HTMLElement) {\n  const day = date.day();\n\n  // Sunday = 0\n  // Monday = 6\n  if (day === 0 || day === 6) {\n    cell.classList.add('grid-weekend');\n  }\n}\n\n@Component({\n  selector: 'wp-timeline-grid',\n  template: '<div class=\"wp-table-timeline--grid\"></div>'\n})\nexport class WorkPackageTableTimelineGrid implements AfterViewInit {\n\n  private activeZoomLevel:TimelineZoomLevel;\n\n  private gridContainer:JQuery;\n\n  constructor(private elementRef:ElementRef,\n              public wpTimeline:WorkPackageTimelineTableController) {\n  }\n\n  ngAfterViewInit() {\n    const $element = jQuery(this.elementRef.nativeElement);\n    this.gridContainer = $element.find('.wp-table-timeline--grid');\n    this.wpTimeline.onRefreshRequested('grid', (vp:TimelineViewParameters) => this.refreshView(vp));\n  }\n\n  refreshView(vp:TimelineViewParameters) {\n    this.renderLabels(vp);\n  }\n\n  private renderLabels(vp:TimelineViewParameters) {\n    if (this.activeZoomLevel === vp.settings.zoomLevel) {\n      return;\n    }\n\n    this.gridContainer.empty();\n\n    switch (vp.settings.zoomLevel) {\n      case 'days':\n        return this.renderLabelsDays(vp);\n      case 'weeks':\n        return this.renderLabelsWeeks(vp);\n      case 'months':\n        return this.renderLabelsMonths(vp);\n      case 'quarters':\n        return this.renderLabelsQuarters(vp);\n      case 'years':\n        return this.renderLabelsYears(vp);\n    }\n\n    this.activeZoomLevel = vp.settings.zoomLevel;\n  }\n\n  private renderLabelsDays(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'day', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.style.paddingTop = '1px';\n      checkForWeekendHighlight(start, cell);\n    });\n\n    this.renderTimeSlices(vp, 'year', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n      cell.style.zIndex = '2';\n    });\n  }\n\n  private renderLabelsWeeks(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'day', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      checkForWeekendHighlight(start, cell);\n    });\n\n    this.renderTimeSlices(vp, 'week', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n    });\n\n    this.renderTimeSlices(vp, 'year', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n      cell.style.zIndex = '2';\n    });\n  }\n\n  private renderLabelsMonths(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'week', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n    });\n\n    this.renderTimeSlices(vp, 'month', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n    });\n\n    this.renderTimeSlices(vp, 'year', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n      cell.style.zIndex = '2';\n    });\n  }\n\n  private renderLabelsQuarters(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'month', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n    });\n\n    this.renderTimeSlices(vp, 'quarter', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n    });\n\n    this.renderTimeSlices(vp, 'year', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n      cell.style.zIndex = '2';\n    });\n  }\n\n  private renderLabelsYears(vp:TimelineViewParameters) {\n    this.renderTimeSlices(vp, 'month', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n    });\n\n    this.renderTimeSlices(vp, 'year', vp.dateDisplayStart, vp.dateDisplayEnd, (start, cell) => {\n      cell.classList.add('-grid-highlight');\n    });\n  }\n\n  renderTimeSlices(vp:TimelineViewParameters,\n                   unit:moment.unitOfTime.DurationConstructor,\n                   startView:Moment,\n                   endView:Moment,\n                   cellCallback:(start:Moment, cell:HTMLElement) => void) {\n\n    const {inViewportAndBoundaries, rest} = getTimeSlicesForHeader(vp, unit, startView, endView);\n\n    for (let [start, end] of inViewportAndBoundaries) {\n      const cell = document.createElement('div');\n      cell.classList.add(timelineElementCssClass, timelineGridElementCssClass);\n      cell.style.left = calculatePositionValueForDayCount(vp, start.diff(startView, 'days'));\n      cell.style.width = calculatePositionValueForDayCount(vp, end.diff(start, 'days') + 1);\n      this.gridContainer[0].appendChild(cell);\n      cellCallback(start, cell);\n    }\n    setTimeout(() => {\n      for (let [start, end] of rest) {\n        const cell = document.createElement('div');\n        cell.classList.add(timelineElementCssClass, timelineGridElementCssClass);\n        cell.style.left = calculatePositionValueForDayCount(vp, start.diff(startView, 'days'));\n        cell.style.width = calculatePositionValueForDayCount(vp, end.diff(start, 'days') + 1);\n        this.gridContainer[0].appendChild(cell);\n        cellCallback(start, cell);\n      }\n    }, 0);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageWatchersTabComponent} from './watchers-tab.component';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\n\n@Component({\n  templateUrl: './wp-watcher-entry.html',\n  selector: 'wp-watcher-entry',\n})\nexport class WorkPackageWatcherEntryComponent implements OnInit {\n  @Input('watcher') public watcher:UserResource;\n  public deleting = false;\n  public text:{ remove:string };\n\n  constructor(readonly I18n:I18nService,\n              readonly panelCtrl:WorkPackageWatchersTabComponent) {\n  }\n\n  ngOnInit() {\n    this.text = {\n      remove: this.I18n.t('js.label_remove_watcher', { name: this.watcher.name })\n    };\n  }\n\n  public remove() {\n    this.deleting = true;\n    this.panelCtrl.removeWatcher(this.watcher);\n  }\n}\n","<div class=\"form--selected-value--container\" focus-within=\"accessible-by-keyboard\">\n  <span class=\"form--selected-value\">\n    <span [ngClass]=\"{'deleting': deleting }\">\n      <a [attr.href]=\"watcher.showUser.href\">\n        <user-avatar [attr.data-user-name]=\"watcher.name\"\n                     [attr.data-user-id]=\"watcher.id\"\n                     data-class-list=\"avatar-mini\">\n        </user-avatar>\n        <span class=\"work-package--watcher-name\" [textContent]=\"watcher.name\"></span>\n      </a>\n    </span>\n  </span>\n  <accessible-by-keyboard (execute)=\"remove()\"\n                          [linkAriaLabel]=\"text.remove\"\n                          [linkTitle]=\"text.remove\"\n                          linkClass=\"form--selected-value--remover\">\n    <op-icon icon-classes=\"icon-remove\"\n             [icon-title]=\"text.remove\"></op-icon>\n  </accessible-by-keyboard>\n</div>\n\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, Directive, ElementRef, Injector} from '@angular/core';\nimport {takeUntil} from 'rxjs/operators';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {States} from '../../states.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {DisplayFieldService} from \"core-app/modules/fields/display/display-field.service\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {QueryColumn} from \"core-components/wp-query/query-column\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {WorkPackageViewSumService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service\";\nimport {combineLatest} from \"rxjs\";\n\n@Directive({\n  selector: '[wpTableSumsRow]'\n})\nexport class WorkPackageTableSumsRowController implements AfterViewInit {\n\n  private text:{ sum:string };\n\n  private $element:JQuery;\n\n  constructor(readonly injector:Injector,\n              readonly elementRef:ElementRef,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly states:States,\n              readonly displayFieldService:DisplayFieldService,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly wpTableSums:WorkPackageViewSumService,\n              readonly I18n:I18nService) {\n\n    this.text = {\n      sum: I18n.t('js.label_sum')\n    };\n  }\n\n  ngAfterViewInit():void {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    combineLatest([\n      this.wpTableColumns.live$(),\n      this.wpTableSums.live$(),\n      this.querySpace.results.values$(),\n    ])\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions)\n      )\n      .subscribe(([columns, sum, resource]) => {\n        if (sum && resource.sumsSchema) {\n          resource.sumsSchema.$load().then((schema:SchemaResource) => {\n            this.refresh(columns, resource, schema);\n          });\n        } else {\n          this.clear();\n        }\n      });\n  }\n\n  private clear() {\n    this.$element.empty();\n  }\n\n  private refresh(columns:QueryColumn[], resource:WorkPackageCollectionResource, schema:SchemaResource) {\n    this.clear();\n    this.render(columns, resource, schema);\n  }\n\n  private render(columns:QueryColumn[], resource:WorkPackageCollectionResource, schema:SchemaResource) {\n    // build\n    columns.forEach((column, i:number) => {\n      const td = document.createElement('td');\n      td.classList.add('wp-table--sum-container');\n      const div = this.renderContent(resource.totalSums!, column.id, schema[column.id]);\n\n      if (i === 0) {\n        this.appendFirstLabel(div);\n        // colspan 2 for the d&d column\n        td.setAttribute('colspan', '2');\n      }\n\n      td.appendChild(div);\n      this.$element.append(td);\n    });\n\n    // Append last empty td\n    this.$element.append(`<td><div class=\"generic-table--footer-outer\"></div></td>`);\n  }\n\n  private renderContent(sums:any, name:string, fieldSchema:IFieldSchema) {\n    const div = document.createElement('div');\n\n    // The field schema for this element may be undefined\n    // because it is not summable.\n    if (!fieldSchema) {\n      return div;\n    }\n\n    const field = this.displayFieldService.getField(\n      sums,\n      name,\n      fieldSchema,\n      { injector: this.injector, container: 'table', options: {} }\n      );\n\n    if (!field.isEmpty()) {\n      field.render(div, field.valueString);\n    }\n\n    return div;\n  }\n\n  private appendFirstLabel(div:HTMLElement) {\n    const span = document.createElement('span');\n    span.textContent = `${this.text.sum}`;\n    jQuery(div).prepend(span);\n  }\n}\n","<ng-container *ngIf=\"!hidden\">\n  <div *ngIf=\"group\" class=\"attributes-group--header\">\n    <div class=\"attributes-group--header-container\">\n      <h3 class=\"attributes-group--header-text\"\n          [textContent]=\"group.name\"></h3>\n    </div>\n  </div>\n\n  <wp-embedded-table #embeddedTable\n                     (onQueryLoaded)=\"handleQueryLoaded($event)\"\n                     [initialLoadingIndicator]=\"false\"\n                     [queryProps]=\"queryProps\"\n                     [tableActions]=\"tableActions\"\n                     [configuration]=\"{ actionsColumnEnabled: true,\n                                        hierarchyToggleEnabled: false,\n                                        inlineCreateEnabled: true,\n                                        compactTableStyle: true,\n                                        columnMenuEnabled: false,\n                                        contextMenuEnabled: false,\n                                        projectIdentifier: workPackage.project.idFromLink,\n                                        projectContext: false }\" >\n  </wp-embedded-table>\n</ng-container>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Inject, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {OpUnlinkTableAction} from 'core-components/wp-table/table-actions/actions/unlink-table-action';\nimport {OpTableActionFactory} from 'core-components/wp-table/table-actions/table-action';\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WorkPackageRelationQueryBase} from \"core-components/wp-relations/embedded/wp-relation-query.base\";\nimport {WpRelationInlineCreateService} from \"core-components/wp-relations/embedded/relations/wp-relation-inline-create.service\";\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {filter} from \"rxjs/operators\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {GroupDescriptor} from \"core-components/work-packages/wp-single-view/wp-single-view.component\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  selector: 'wp-relation-query',\n  templateUrl: '../wp-relation-query.html',\n  providers: [\n    { provide: WorkPackageInlineCreateService, useClass: WpRelationInlineCreateService }\n  ]\n})\nexport class WorkPackageRelationQueryComponent extends WorkPackageRelationQueryBase implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n\n  @Input() public query:QueryResource;\n  @Input() public group:GroupDescriptor;\n\n  public tableActions:OpTableActionFactory[] = [\n    OpUnlinkTableAction.factoryFor(\n      'remove-relation-action',\n      this.I18n.t('js.relation_buttons.remove'),\n      (relatedTo:WorkPackageResource) => {\n        this.embeddedTable.loadingIndicator = this.wpRelations.require(relatedTo.id!)\n          .then(() => this.wpInlineCreate.remove(this.workPackage, relatedTo))\n          .then(() => this.refreshTable())\n          .catch((error) => this.notificationService.handleRawError(error, this.workPackage));\n      },\n      (child:WorkPackageResource) => !!child.changeParent\n    )\n  ];\n\n  constructor(protected readonly PathHelper:PathHelperService,\n              @Inject(WorkPackageInlineCreateService) protected readonly wpInlineCreate:WpRelationInlineCreateService,\n              protected readonly wpRelations:WorkPackageRelationsService,\n              protected readonly halEvents:HalEventsService,\n              protected readonly queryUrlParamsHelper:UrlParamsHelperService,\n              protected readonly notificationService:WorkPackageNotificationService,\n              protected readonly I18n:I18nService) {\n    super(queryUrlParamsHelper);\n  }\n\n  ngOnInit() {\n    let relationType = this.getRelationTypeFromQuery();\n\n    // Set reference target and reference class\n    this.wpInlineCreate.referenceTarget = this.workPackage;\n    this.wpInlineCreate.relationType = relationType;\n\n    // Set up the query props\n    this.queryProps = this.buildQueryProps();\n\n    // Wire the successful saving of a new addition to refreshing the embedded table\n    this.wpInlineCreate.newInlineWorkPackageCreated\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((toId:string) => this.addRelation(toId));\n\n    // When relations have changed, refresh this table\n    this.wpRelations.observe(this.workPackage.id!)\n      .pipe(\n        filter(val => !_.isEmpty(val)),\n        this.untilDestroyed()\n      )\n      .subscribe(() => this.refreshTable());\n  }\n\n  private addRelation(toId:string) {\n    this.wpInlineCreate\n      .add(this.workPackage, toId)\n      .then(() => {\n        this.halEvents.push(this.workPackage, {\n          eventType: 'association',\n          relatedWorkPackage: toId,\n          relationType: this.getRelationTypeFromQuery()\n        });\n      })\n      .catch(error => this.notificationService.handleRawError(error, this.workPackage));\n  }\n\n  private getRelationTypeFromQuery() {\n    return this.group.relationType!;\n  }\n}\n","import {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Component, OnInit, Injector} from '@angular/core';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {WpTableConfigurationModalComponent} from \"core-components/wp-table/configuration-modal/wp-table-configuration.modal\";\n\n@Component({\n  templateUrl: './config-menu.template.html',\n  selector: 'wp-table-config-menu',\n})\nexport class WorkPackagesTableConfigMenu implements OnInit {\n  public text:any;\n\n  constructor(readonly I18n:I18nService,\n              readonly injector:Injector,\n              readonly opModalService:OpModalService,\n              readonly opContextMenu:OPContextMenuService) {\n  }\n\n  ngOnInit():void {\n    this.text = {\n      configureTable: I18n.t('js.toolbar.settings.configure_view')\n    };\n  }\n\n  public openTableConfigurationModal() {\n    this.opContextMenu.close();\n    this.opModalService.show(WpTableConfigurationModalComponent, this.injector);\n  }\n}\n","<accessible-by-keyboard\n    (execute)=\"openTableConfigurationModal()\"\n    linkClass=\"wp-table--columns-selection\"\n    [linkTitle]=\"text.configureTable\"\n    [linkAriaLabel]=\"text.configureTable\">\n  <op-icon icon-classes=\"icon-button icon-small icon-settings\"></op-icon>\n</accessible-by-keyboard>\n","import {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport { TimeEntryResource } from 'core-app/modules/hal/resources/time-entry-resource';\n\nexport class TimeEntryChangeset extends ResourceChangeset<TimeEntryResource> {\n\n  public setValue(key:string, val:any) {\n    super.setValue(key, val);\n\n    // Update the form for fields that may alter the form itself\n    if (key === 'workPackage') {\n      this.updateForm();\n    }\n  }\n\n  protected buildPayloadFromChanges() {\n    let payload = super.buildPayloadFromChanges();\n\n    // we ignore the project and instead rely completely on the work package.\n    delete payload['_links']['project'];\n\n    return payload;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpenprojectCommonModule} from 'core-app/modules/common/openproject-common.module';\nimport {WorkPackageFormAttributeGroupComponent} from 'core-components/wp-form-group/wp-attribute-group.component';\nimport {OpenprojectFieldsModule} from 'core-app/modules/fields/openproject-fields.module';\nimport {Injector, NgModule} from '@angular/core';\nimport {\n  GroupDescriptor,\n  WorkPackageSingleViewComponent\n} from 'core-components/work-packages/wp-single-view/wp-single-view.component';\nimport {HookService} from 'core-app/modules/plugins/hook-service';\nimport {WorkPackageEmbeddedTableComponent} from 'core-components/wp-table/embedded/wp-embedded-table.component';\nimport {WorkPackageEmbeddedTableEntryComponent} from 'core-components/wp-table/embedded/wp-embedded-table-entry.component';\nimport {WorkPackagesTableController} from 'core-components/wp-table/wp-table.directive';\nimport {WorkPackageTablePaginationComponent} from 'core-components/wp-table/table-pagination/wp-table-pagination.component';\nimport {WpResizerDirective} from 'core-components/resizer/wp-resizer.component';\nimport {WorkPackageTimelineTableController} from 'core-components/wp-table/timeline/container/wp-timeline-container.directive';\nimport {WorkPackageInlineCreateComponent} from 'core-components/wp-inline-create/wp-inline-create.component';\nimport {OpTypesContextMenuDirective} from 'core-components/op-context-menu/handlers/op-types-context-menu.directive';\nimport {OpColumnsContextMenu} from 'core-components/op-context-menu/handlers/op-columns-context-menu.directive';\nimport {OpSettingsMenuDirective} from 'core-components/op-context-menu/handlers/op-settings-dropdown-menu.directive';\nimport {WorkPackageStatusDropdownDirective} from 'core-components/op-context-menu/handlers/wp-status-dropdown-menu.directive';\nimport {WorkPackageCreateSettingsMenuDirective} from 'core-components/op-context-menu/handlers/wp-create-settings-menu.directive';\nimport {WorkPackageSingleContextMenuDirective} from 'core-components/op-context-menu/wp-context-menu/wp-single-context-menu';\nimport {WorkPackageQuerySelectDropdownComponent} from 'core-components/wp-query-select/wp-query-select-dropdown.component';\nimport {WorkPackageTimelineHeaderController} from 'core-components/wp-table/timeline/header/wp-timeline-header.directive';\nimport {WorkPackageTableTimelineRelations} from 'core-components/wp-table/timeline/global-elements/wp-timeline-relations.directive';\nimport {WorkPackageTableTimelineStaticElements} from 'core-components/wp-table/timeline/global-elements/wp-timeline-static-elements.directive';\nimport {WorkPackageTableTimelineGrid} from 'core-components/wp-table/timeline/grid/wp-timeline-grid.directive';\nimport {WorkPackageTimelineButtonComponent} from 'core-components/wp-buttons/wp-timeline-toggle-button/wp-timeline-toggle-button.component';\nimport {WorkPackageOverviewTabComponent} from 'core-components/wp-single-view-tabs/overview-tab/overview-tab.component';\nimport {WorkPackageStatusButtonComponent} from 'core-components/wp-buttons/wp-status-button/wp-status-button.component';\nimport {WorkPackageReplacementLabelComponent} from 'core-components/wp-edit/wp-edit-field/wp-replacement-label.component';\nimport {NewestActivityOnOverviewComponent} from 'core-components/wp-single-view-tabs/activity-panel/activity-on-overview.component';\nimport {UserLinkComponent} from 'core-components/user/user-link/user-link.component';\nimport {WorkPackageCommentComponent} from 'core-components/work-packages/work-package-comment/work-package-comment.component';\nimport {WorkPackageCommentFieldComponent} from 'core-components/work-packages/work-package-comment/wp-comment-field.component';\nimport {ActivityEntryComponent} from 'core-components/wp-activity/activity-entry.component';\nimport {UserActivityComponent} from 'core-components/wp-activity/user/user-activity.component';\nimport {RevisionActivityComponent} from 'core-components/wp-activity/revision/revision-activity.component';\nimport {ActivityLinkComponent} from 'core-components/wp-activity/activity-link.component';\nimport {WorkPackageActivityTabComponent} from 'core-components/wp-single-view-tabs/activity-panel/activity-tab.component';\nimport {OpenprojectAttachmentsModule} from 'core-app/modules/attachments/openproject-attachments.module';\nimport {WpCustomActionComponent} from 'core-components/wp-custom-actions/wp-custom-actions/wp-custom-action.component';\nimport {WpCustomActionsComponent} from 'core-components/wp-custom-actions/wp-custom-actions.component';\nimport {WorkPackageRelationsCountComponent} from 'core-components/work-packages/wp-relations-count/wp-relations-count.component';\nimport {WorkPackageWatchersCountComponent} from 'core-components/work-packages/wp-relations-count/wp-watchers-count.component';\nimport {WorkPackageBreadcrumbComponent} from 'core-components/work-packages/wp-breadcrumb/wp-breadcrumb.component';\nimport {WorkPackageSplitViewToolbarComponent} from 'core-components/wp-details/wp-details-toolbar.component';\nimport {WorkPackageWatcherButtonComponent} from 'core-components/work-packages/wp-watcher-button/wp-watcher-button.component';\nimport {WorkPackageSubjectComponent} from 'core-components/work-packages/wp-subject/wp-subject.component';\nimport {WorkPackageRelationsTabComponent} from 'core-components/wp-single-view-tabs/relations-tab/relations-tab.component';\nimport {WorkPackageRelationsComponent} from 'core-components/wp-relations/wp-relations.component';\nimport {WorkPackageRelationsGroupComponent} from 'core-components/wp-relations/wp-relations-group/wp-relations-group.component';\nimport {WorkPackageRelationRowComponent} from 'core-components/wp-relations/wp-relation-row/wp-relation-row.component';\nimport {WorkPackageRelationsCreateComponent} from 'core-components/wp-relations/wp-relations-create/wp-relations-create.component';\nimport {WorkPackageRelationsHierarchyComponent} from 'core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.directive';\nimport {WorkPackageCreateButtonComponent} from 'core-components/wp-buttons/wp-create-button/wp-create-button.component';\nimport {WorkPackageBreadcrumbParentComponent} from 'core-components/work-packages/wp-breadcrumb/wp-breadcrumb-parent.component';\nimport {WorkPackageFilterButtonComponent} from 'core-components/wp-buttons/wp-filter-button/wp-filter-button.component';\nimport {WorkPackageFilterContainerComponent} from 'core-components/filters/filter-container/filter-container.directive';\nimport {QueryFiltersComponent} from 'core-components/filters/query-filters/query-filters.component';\nimport {QueryFilterComponent} from 'core-components/filters/query-filter/query-filter.component';\nimport {FilterBooleanValueComponent} from 'core-components/filters/filter-boolean-value/filter-boolean-value.component';\nimport {FilterDateValueComponent} from 'core-components/filters/filter-date-value/filter-date-value.component';\nimport {FilterDatesValueComponent} from 'core-components/filters/filter-dates-value/filter-dates-value.component';\nimport {FilterDateTimeValueComponent} from 'core-components/filters/filter-date-time-value/filter-date-time-value.component';\nimport {FilterDateTimesValueComponent} from 'core-components/filters/filter-date-times-value/filter-date-times-value.component';\nimport {FilterIntegerValueComponent} from 'core-components/filters/filter-integer-value/filter-integer-value.component';\nimport {FilterStringValueComponent} from 'core-components/filters/filter-string-value/filter-string-value.component';\nimport {FilterToggledMultiselectValueComponent} from 'core-components/filters/filter-toggled-multiselect-value/filter-toggled-multiselect-value.component';\nimport {WorkPackageDetailsViewButtonComponent} from 'core-components/wp-buttons/wp-details-view-button/wp-details-view-button.component';\nimport {WpTableConfigurationModalComponent} from 'core-components/wp-table/configuration-modal/wp-table-configuration.modal';\nimport {WpTableConfigurationColumnsTab} from 'core-components/wp-table/configuration-modal/tabs/columns-tab.component';\nimport {WpTableConfigurationDisplaySettingsTab} from 'core-components/wp-table/configuration-modal/tabs/display-settings-tab.component';\nimport {WpTableConfigurationFiltersTab} from 'core-components/wp-table/configuration-modal/tabs/filters-tab.component';\nimport {WpTableConfigurationSortByTab} from 'core-components/wp-table/configuration-modal/tabs/sort-by-tab.component';\nimport {WpTableConfigurationTimelinesTab} from 'core-components/wp-table/configuration-modal/tabs/timelines-tab.component';\nimport {WpTableConfigurationHighlightingTab} from 'core-components/wp-table/configuration-modal/tabs/highlighting-tab.component';\nimport {WpTableConfigurationRelationSelectorComponent} from \"core-components/wp-table/configuration-modal/wp-table-configuration-relation-selector\";\nimport {WorkPackageWatchersTabComponent} from 'core-components/wp-single-view-tabs/watchers-tab/watchers-tab.component';\nimport {WorkPackageWatcherEntryComponent} from 'core-components/wp-single-view-tabs/watchers-tab/wp-watcher-entry.component';\nimport {WorkPackageCopyFullViewComponent} from 'core-components/wp-copy/wp-copy-full-view.component';\nimport {WorkPackageCopySplitViewComponent} from 'core-components/wp-copy/wp-copy-split-view.component';\nimport {WorkPackageTypeStatusComponent} from 'core-components/work-packages/wp-type-status/wp-type-status.component';\nimport {WorkPackageNewSplitViewComponent} from 'core-components/wp-new/wp-new-split-view.component';\nimport {WorkPackageNewFullViewComponent} from 'core-components/wp-new/wp-new-full-view.component';\nimport {WpTableExportModal} from 'core-components/modals/export-modal/wp-table-export.modal';\nimport {QuerySharingModal} from 'core-components/modals/share-modal/query-sharing.modal';\nimport {SaveQueryModal} from 'core-components/modals/save-modal/save-query.modal';\nimport {WpDestroyModal} from 'core-components/modals/wp-destroy-modal/wp-destroy.modal';\nimport {QuerySharingForm} from 'core-components/modals/share-modal/query-sharing-form.component';\nimport {EmbeddedTablesMacroComponent} from 'core-components/wp-table/embedded/embedded-tables-macro.component';\nimport {WpButtonMacroModal} from 'core-components/modals/editor/macro-wp-button-modal/wp-button-macro.modal';\nimport {OpenprojectEditorModule} from 'core-app/modules/editor/openproject-editor.module';\nimport {WorkPackageTableSumsRowController} from 'core-components/wp-table/wp-table-sums-row/wp-table-sums-row.directive';\nimport {ExternalQueryConfigurationComponent} from 'core-components/wp-table/external-configuration/external-query-configuration.component';\nimport {ExternalQueryConfigurationService} from 'core-components/wp-table/external-configuration/external-query-configuration.service';\nimport {ExternalRelationQueryConfigurationComponent} from \"core-components/wp-table/external-configuration/external-relation-query-configuration.component\";\nimport {ExternalRelationQueryConfigurationService} from \"core-components/wp-table/external-configuration/external-relation-query-configuration.service\";\nimport {WorkPackageStaticQueriesService} from 'core-components/wp-query-select/wp-static-queries.service';\nimport {WorkPackagesListInvalidQueryService} from 'core-components/wp-list/wp-list-invalid-query.service';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {SchemaCacheService} from 'core-components/schemas/schema-cache.service';\nimport {WorkPackageWatchersService} from 'core-components/wp-single-view-tabs/watchers-tab/wp-watchers.service';\nimport {WorkPackagesActivityService} from 'core-components/wp-single-view-tabs/activity-panel/wp-activity.service';\nimport {KeepTabService} from 'core-components/wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {QueryFormDmService} from 'core-app/modules/hal/dm-services/query-form-dm.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageChildrenQueryComponent} from \"core-components/wp-relations/embedded/children/wp-children-query.component\";\nimport {WpRelationInlineAddExistingComponent} from \"core-components/wp-relations/embedded/inline/add-existing/wp-relation-inline-add-existing.component\";\nimport {WorkPackageRelationQueryComponent} from \"core-components/wp-relations/embedded/relations/wp-relation-query.component\";\nimport {WorkPackagesBaseComponent} from \"core-app/modules/work_packages/routing/wp-base/wp--base.component\";\nimport {WorkPackageSplitViewComponent} from \"core-app/modules/work_packages/routing/wp-split-view/wp-split-view.component\";\nimport {WorkPackagesFullViewComponent} from \"core-app/modules/work_packages/routing/wp-full-view/wp-full-view.component\";\nimport {AttachmentsUploadComponent} from 'core-app/modules/attachments/attachments-upload/attachments-upload.component';\nimport {AttachmentListComponent} from 'core-app/modules/attachments/attachment-list/attachment-list.component';\nimport {WorkPackageFilterByTextInputComponent} from \"core-components/filters/quick-filter-by-text-input/quick-filter-by-text-input.component\";\nimport {QueryFiltersService} from \"core-components/wp-query/query-filters.service\";\nimport {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageIsolatedQuerySpaceDirective} from \"core-app/modules/work_packages/query-space/wp-isolated-query-space.directive\";\nimport {WorkPackageDmService} from \"core-app/modules/hal/dm-services/work-package-dm.service\";\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {OpenprojectBcfModule} from \"core-app/modules/bim/bcf/openproject-bcf.module\";\nimport {WorkPackageRelationsAutocomplete} from \"core-components/wp-relations/wp-relations-create/wp-relations-autocomplete/wp-relations-autocomplete.component\";\nimport {CustomDateActionAdminComponent} from 'core-components/wp-custom-actions/date-action/custom-date-action-admin.component';\nimport {WorkPackagesTableConfigMenu} from \"core-components/wp-table/config-menu/config-menu.component\";\nimport {WorkPackageIsolatedGraphQuerySpaceDirective} from \"core-app/modules/work_packages/query-space/wp-isolated-graph-query-space.directive\";\nimport {WorkPackageViewToggleButton} from \"core-components/wp-buttons/wp-view-toggle-button/work-package-view-toggle-button.component\";\nimport {WorkPackagesGridComponent} from \"core-components/wp-grid/wp-grid.component\";\nimport {WorkPackageViewDropdownMenuDirective} from \"core-components/op-context-menu/handlers/wp-view-dropdown-menu.directive\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {OpenprojectProjectsModule} from \"core-app/modules/projects/openproject-projects.module\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {WorkPackageEditActionsBarComponent} from \"core-app/modules/common/edit-actions-bar/wp-edit-actions-bar.component\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {WorkPackageSingleCardComponent} from \"core-components/wp-card-view/wp-single-card/wp-single-card.component\";\nimport {TimeEntryChangeset} from 'core-app/components/time-entries/time-entry-changeset';\nimport {WorkPackageListViewComponent} from \"core-app/modules/work_packages/routing/wp-list-view/wp-list-view.component\";\nimport {PartitionedQuerySpacePageComponent} from \"core-app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component\";\nimport {WorkPackageViewPageComponent} from \"core-app/modules/work_packages/routing/wp-view-page/wp-view-page.component\";\nimport {WorkPackageSettingsButtonComponent} from \"core-components/wp-buttons/wp-settings-button/wp-settings-button.component\";\nimport {BackButtonComponent} from \"core-app/modules/common/back-routing/back-button.component\";\nimport {DatePickerModal} from \"core-components/datepicker/datepicker.modal\";\n\n@NgModule({\n  imports: [\n    // Commons\n    OpenprojectCommonModule,\n    // Display + Edit field functionality\n    OpenprojectFieldsModule,\n    // CKEditor\n    OpenprojectEditorModule,\n\n    OpenprojectAttachmentsModule,\n\n    OpenprojectBcfModule,\n\n    OpenprojectProjectsModule,\n  ],\n  providers: [\n    // Notification service\n    WorkPackageNotificationService,\n\n    // External query configuration\n    ExternalQueryConfigurationService,\n    ExternalRelationQueryConfigurationService,\n\n    // Global work package states / services\n    WorkPackageCacheService,\n    SchemaCacheService,\n\n    // Global query/table state services\n    // For any service that depends on the isolated query space,\n    // they should be provided in wp-isolated-query-space.directive instead\n    QueryFiltersService,\n    WorkPackageStaticQueriesService,\n    WorkPackagesListInvalidQueryService,\n\n    // Provide a separate service for creation events of WP Inline create\n    // This can be hierarchically injected to provide isolated events on an embedded table\n    WorkPackageRelationsService,\n    WorkPackageCacheService,\n    SchemaCacheService,\n\n    KeepTabService,\n    WorkPackageDmService,\n\n    WorkPackagesActivityService,\n    WorkPackageRelationsService,\n    WorkPackageWatchersService,\n\n    QueryFormDmService,\n    HalEventsService,\n  ],\n  declarations: [\n    // Routing\n    WorkPackagesBaseComponent,\n    PartitionedQuerySpacePageComponent,\n    WorkPackageViewPageComponent,\n\n    // WP list side\n    WorkPackageListViewComponent,\n    WorkPackageSettingsButtonComponent,\n\n    // Query injector isolation\n    WorkPackageIsolatedQuerySpaceDirective,\n    WorkPackageIsolatedGraphQuerySpaceDirective,\n\n    // WP New\n    WorkPackageNewFullViewComponent,\n    WorkPackageNewSplitViewComponent,\n    WorkPackageTypeStatusComponent,\n    WorkPackageEditActionsBarComponent,\n\n    // WP Copy\n    WorkPackageCopyFullViewComponent,\n    WorkPackageCopySplitViewComponent,\n\n    // Embedded table\n    WorkPackageEmbeddedTableComponent,\n    WorkPackageEmbeddedTableEntryComponent,\n\n    // External query configuration\n    ExternalQueryConfigurationComponent,\n    ExternalRelationQueryConfigurationComponent,\n\n    // Inline create\n    WorkPackageInlineCreateComponent,\n    WpRelationInlineAddExistingComponent,\n\n    WorkPackagesGridComponent,\n\n    WorkPackagesTableController,\n    WorkPackagesTableConfigMenu,\n    WorkPackageTablePaginationComponent,\n\n    WpResizerDirective,\n\n    WorkPackageTableSumsRowController,\n\n    // Filters\n    QueryFiltersComponent,\n    QueryFilterComponent,\n    FilterBooleanValueComponent,\n    FilterDateValueComponent,\n    FilterDatesValueComponent,\n    FilterDateTimeValueComponent,\n    FilterDateTimesValueComponent,\n    FilterIntegerValueComponent,\n    FilterStringValueComponent,\n    FilterToggledMultiselectValueComponent,\n\n    WorkPackageFilterContainerComponent,\n    WorkPackageFilterButtonComponent,\n\n    // Context menus\n    OpTypesContextMenuDirective,\n    OpColumnsContextMenu,\n    OpSettingsMenuDirective,\n    WorkPackageStatusDropdownDirective,\n    WorkPackageCreateSettingsMenuDirective,\n    WorkPackageSingleContextMenuDirective,\n    WorkPackageQuerySelectDropdownComponent,\n    WorkPackageViewDropdownMenuDirective,\n\n    // Timeline\n    WorkPackageTimelineButtonComponent,\n    WorkPackageTimelineHeaderController,\n    WorkPackageTableTimelineRelations,\n    WorkPackageTableTimelineStaticElements,\n    WorkPackageTableTimelineGrid,\n    WorkPackageTimelineTableController,\n\n    WorkPackageCreateButtonComponent,\n    WorkPackageFilterByTextInputComponent,\n\n    // Single view\n    WorkPackageOverviewTabComponent,\n    WorkPackageSingleViewComponent,\n    WorkPackageStatusButtonComponent,\n    WorkPackageReplacementLabelComponent,\n    UserLinkComponent,\n    WorkPackageChildrenQueryComponent,\n    WorkPackageRelationQueryComponent,\n    WorkPackageFormAttributeGroupComponent,\n    BackButtonComponent,\n\n    // Activity Tab\n    NewestActivityOnOverviewComponent,\n    WorkPackageCommentComponent,\n    WorkPackageCommentFieldComponent,\n    ActivityEntryComponent,\n    UserActivityComponent,\n    RevisionActivityComponent,\n    ActivityLinkComponent,\n    WorkPackageActivityTabComponent,\n\n    // Watchers tab\n    WorkPackageWatchersTabComponent,\n    WorkPackageWatcherEntryComponent,\n\n    // Relations\n    WorkPackageRelationsTabComponent,\n    WorkPackageRelationsComponent,\n    WorkPackageRelationsGroupComponent,\n    WorkPackageRelationRowComponent,\n    WorkPackageRelationsCreateComponent,\n    WorkPackageRelationsHierarchyComponent,\n    WorkPackageRelationsAutocomplete,\n    WorkPackageBreadcrumbParentComponent,\n\n    // Split view\n    WorkPackageDetailsViewButtonComponent,\n    WorkPackageSplitViewComponent,\n    WorkPackageRelationsCountComponent,\n    WorkPackageWatchersCountComponent,\n    WorkPackageBreadcrumbComponent,\n    WorkPackageSplitViewToolbarComponent,\n    WorkPackageWatcherButtonComponent,\n    WorkPackageSubjectComponent,\n\n    // Full view\n    WorkPackagesFullViewComponent,\n\n    // Modals\n    WpTableConfigurationModalComponent,\n    WpTableConfigurationColumnsTab,\n    WpTableConfigurationDisplaySettingsTab,\n    WpTableConfigurationFiltersTab,\n    WpTableConfigurationSortByTab,\n    WpTableConfigurationTimelinesTab,\n    WpTableConfigurationHighlightingTab,\n    WpTableConfigurationRelationSelectorComponent,\n    WpTableExportModal,\n    QuerySharingForm,\n    QuerySharingModal,\n    SaveQueryModal,\n    WpDestroyModal,\n    DatePickerModal,\n\n    // CustomActions\n    WpCustomActionComponent,\n    WpCustomActionsComponent,\n    CustomDateActionAdminComponent,\n\n    // CKEditor macros which could not be included in the\n    // editor module to avoid circular dependencies\n    EmbeddedTablesMacroComponent,\n    WpButtonMacroModal,\n\n    // Card view\n    WorkPackageCardViewComponent,\n    WorkPackageSingleCardComponent,\n    WorkPackageViewToggleButton,\n  ],\n  exports: [\n    WorkPackagesTableController,\n    WorkPackageTablePaginationComponent,\n    WorkPackageEmbeddedTableComponent,\n    WorkPackageEmbeddedTableEntryComponent,\n    WorkPackageCardViewComponent,\n    WorkPackageSingleCardComponent,\n    WorkPackageFilterButtonComponent,\n    WorkPackageFilterContainerComponent,\n    WorkPackageIsolatedQuerySpaceDirective,\n    WorkPackageIsolatedGraphQuerySpaceDirective,\n    QueryFiltersComponent,\n\n    WpResizerDirective,\n    WorkPackageBreadcrumbComponent,\n    WorkPackageBreadcrumbParentComponent,\n    WorkPackageSplitViewToolbarComponent,\n    WorkPackageSubjectComponent,\n    WorkPackageWatchersCountComponent,\n    WorkPackageRelationsCountComponent,\n    WorkPackagesGridComponent,\n\n    // Modals\n    WpTableConfigurationModalComponent,\n    WpTableConfigurationFiltersTab,\n\n    // Needed so that e.g. IFC can access it.\n    WorkPackageCreateButtonComponent,\n    WorkPackageTypeStatusComponent,\n    WorkPackageEditActionsBarComponent,\n    WorkPackageSingleViewComponent,\n    WorkPackageSplitViewComponent,\n    BackButtonComponent\n  ]\n})\nexport class OpenprojectWorkPackagesModule {\n  static bootstrapAttributeGroupsCalled = false;\n\n  constructor(injector:Injector) {\n    OpenprojectWorkPackagesModule.bootstrapAttributeGroups(injector);\n  }\n\n  // The static property prevents running the function\n  // multiple times. This happens e.g. when the module is included\n  // into a plugin's module.\n  public static bootstrapAttributeGroups(injector:Injector) {\n    if (this.bootstrapAttributeGroupsCalled) {\n      return;\n    }\n\n    this.bootstrapAttributeGroupsCalled = true;\n\n    const hookService = injector.get(HookService);\n\n    hookService.register('attributeGroupComponent', (group:GroupDescriptor, workPackage:WorkPackageResource) => {\n      if (group.type === 'WorkPackageFormAttributeGroup') {\n        return WorkPackageFormAttributeGroupComponent;\n      } else if (!workPackage.isNew && group.type === 'WorkPackageFormChildrenQueryGroup') {\n        return WorkPackageChildrenQueryComponent;\n      } else if (!workPackage.isNew && group.type === 'WorkPackageFormRelationQueryGroup') {\n        return WorkPackageRelationQueryComponent;\n      } else {\n        return null;\n      }\n    });\n\n    hookService.register('workPackageAttachmentUploadComponent', (workPackage:WorkPackageResource) => {\n      return AttachmentsUploadComponent;\n    });\n\n    hookService.register('workPackageAttachmentListComponent', (workPackage:WorkPackageResource) => {\n      return AttachmentListComponent;\n    });\n\n    /** Return specialized work package changeset for editing service */\n    hookService.register('halResourceChangesetClass', (resource:HalResource) => {\n      switch (resource._type) {\n        case 'WorkPackage':\n          return WorkPackageChangeset;\n        case 'TimeEntry':\n          return TimeEntryChangeset;\n        default:\n          return null;\n      }\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {StateService, TransitionPromise} from '@uirouter/core';\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {Injectable} from '@angular/core';\nimport {WorkPackageViewPagination} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-pagination\";\n\n@Injectable()\nexport class WorkPackagesListChecksumService {\n  constructor(protected UrlParamsHelper:UrlParamsHelperService,\n              protected $state:StateService) {\n  }\n\n  public id:string|null;\n  public checksum:string|null;\n  public visibleChecksum:string|null;\n\n  public updateIfDifferent(query:QueryResource,\n                           pagination:WorkPackageViewPagination):Promise<unknown> {\n\n    let newQueryChecksum = this.getNewChecksum(query, pagination);\n    let routePromise:Promise<unknown> = Promise.resolve();\n\n    if (this.isUninitialized()) {\n      // Do nothing\n    } else if (this.isIdDifferent(query.id)) {\n      routePromise = this.maintainUrlQueryState(query.id, null);\n\n      this.clear();\n\n    } else if (this.isChecksumDifferent(newQueryChecksum)) {\n      routePromise = this.maintainUrlQueryState(query.id, newQueryChecksum);\n    }\n\n    this.set(query.id, newQueryChecksum);\n    return routePromise;\n  }\n\n  public update(query:QueryResource, pagination:WorkPackageViewPagination) {\n    let newQueryChecksum = this.getNewChecksum(query, pagination);\n\n    this.set(query.id, newQueryChecksum);\n\n    this.maintainUrlQueryState(query.id, newQueryChecksum);\n  }\n\n  public setToQuery(query:QueryResource, pagination:WorkPackageViewPagination) {\n    let newQueryChecksum = this.getNewChecksum(query, pagination);\n\n    this.set(query.id, newQueryChecksum);\n\n    return this.maintainUrlQueryState(query.id, null);\n  }\n\n  public isQueryOutdated(query:QueryResource,\n                         pagination:WorkPackageViewPagination) {\n    let newQueryChecksum = this.getNewChecksum(query, pagination);\n\n    return this.isOutdated(query.id, newQueryChecksum);\n  }\n\n  public executeIfOutdated(newId:string,\n                           newChecksum:string|null,\n                           callback:Function) {\n    if (this.isUninitialized() || this.isOutdated(newId, newChecksum)) {\n      this.set(newId, newChecksum);\n\n      callback();\n    }\n  }\n\n  private set(id:string|null, checksum:string|null) {\n    this.id = id;\n    this.checksum = checksum;\n  }\n\n  public clear() {\n    this.id = null;\n    this.checksum = null;\n    this.visibleChecksum = null;\n  }\n\n  public isUninitialized() {\n    return !this.id && !this.checksum;\n  }\n\n  private isIdDifferent(otherId:string|null) {\n    return this.id !== otherId;\n  }\n\n  private isChecksumDifferent(otherChecksum:string) {\n    return this.checksum && otherChecksum !== this.checksum;\n  }\n\n  private isOutdated(otherId:string|null, otherChecksum:string|null) {\n    const hasCurrentQueryID = !!this.id;\n    const hasCurrentChecksum = !!this.checksum;\n    const idChanged = (this.id !== otherId);\n\n    const checksumChanged = (otherChecksum !== this.checksum);\n    const visibleChecksumChanged = (this.checksum && !otherChecksum && this.visibleChecksum);\n\n    return (\n      // Can only be outdated if either ID or props set\n      (hasCurrentQueryID || hasCurrentChecksum) &&\n      (\n        // Query ID changed\n        idChanged ||\n        // Query ID same + query props changed\n        (!idChanged && checksumChanged && (otherChecksum || this.visibleChecksum)) ||\n        // No query ID set\n        (!hasCurrentQueryID && visibleChecksumChanged)\n      )\n    );\n  }\n\n  private getNewChecksum(query:QueryResource, pagination:WorkPackageViewPagination) {\n    return this.UrlParamsHelper.encodeQueryJsonParams(query, _.pick(pagination, ['page', 'perPage']));\n  }\n\n  private maintainUrlQueryState(id:string|null, checksum:string|null):TransitionPromise {\n    this.visibleChecksum = checksum;\n\n    return this.$state.go(\n      '.',\n      { query_props: checksum, query_id: id },\n      { custom: { notify: false } }\n    );\n  }\n}\n","import {InjectionToken, Injector} from '@angular/core';\n\nexport interface WorkPackageViewEventHandler<T> {\n  /** Event name to register **/\n  EVENT:string;\n\n  /** Event context CSS selector */\n  SELECTOR:string;\n\n  /** Event callback handler */\n  handleEvent(view:T, evt:JQuery.TriggeredEvent):void;\n\n  /** Event scope method */\n  eventScope(view:T):JQuery;\n}\n\nexport interface WorkPackageViewHandlerClass<T> {\n  new(injector:Injector):WorkPackageViewEventHandler<any>;\n}\n\nexport const WorkPackageViewHandlerToken = new InjectionToken<WorkPackageViewEventHandler<any>>('CardEventHandler');\n\n/**\n * Abstract view handler registry for globally handling arbitrary event on the\n * view container. Used e.g., for table to register single event callbacks for the entirety\n * of the table.\n */\nexport abstract class WorkPackageViewHandlerRegistry<T> {\n\n  constructor(public readonly injector:Injector) {\n  }\n\n  protected abstract eventHandlers:((view:T) => WorkPackageViewEventHandler<T>)[];\n\n  attachTo(viewRef:T) {\n    this.eventHandlers.map(factory => {\n      let handler = factory(viewRef);\n      let target = handler.eventScope(viewRef);\n\n      target.on(handler.EVENT, handler.SELECTOR, (evt:JQuery.TriggeredEvent) => {\n        handler.handleEvent(viewRef, evt);\n      });\n\n      return handler;\n    });\n  }\n}\n","import {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Injectable} from '@angular/core';\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\n\n@Injectable()\nexport class WorkPackageCardViewService {\n  public constructor(readonly querySpace:IsolatedQuerySpace) {\n  }\n\n  public classIdentifier(wp:WorkPackageResource) {\n    // The same class names are used for the proximity to the table representation.\n    return `wp-row-${wp.id}`;\n  }\n\n  public get renderedCards() {\n    return this.querySpace.tableRendered.getValueOr([]);\n  }\n\n  public findRenderedCard(classIdentifier:string):number {\n    const index = _.findIndex(this.renderedCards, (card) => card.classIdentifier === classIdentifier);\n\n    return index;\n  }\n\n  public updateRenderedCardsValues(workPackages:WorkPackageResource[]) {\n    this.querySpace.tableRendered.putValue(\n      workPackages.map((wp) => {\n        return {\n          classIdentifier: this.classIdentifier(wp),\n          workPackageId: wp.id,\n          hidden: false\n        };\n      })\n    )\n  }\n}\n","import {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {CardClickHandler} from \"core-components/wp-card-view/event-handler/click-handler\";\nimport {CardDblClickHandler} from \"core-components/wp-card-view/event-handler/double-click-handler\";\nimport {CardRightClickHandler} from \"core-components/wp-card-view/event-handler/right-click-handler\";\nimport {\n  WorkPackageViewEventHandler,\n  WorkPackageViewHandlerRegistry\n} from \"core-app/modules/work_packages/routing/wp-view-base/event-handling/event-handler-registry\";\n\n\nexport type CardEventHandler = WorkPackageViewEventHandler<WorkPackageCardViewComponent>;\n\nexport class CardViewHandlerRegistry extends WorkPackageViewHandlerRegistry<WorkPackageCardViewComponent> {\n\n  protected eventHandlers:((c:WorkPackageCardViewComponent) => CardEventHandler)[] = [\n    // Clicking on the card (not within a cell)\n    c => new CardClickHandler(this.injector, c),\n    // Double Clicking on the row (not within a cell)\n    c => new CardDblClickHandler(this.injector, c),\n    // Right clicking on cards\n    t => new CardRightClickHandler(this.injector, t),\n  ];\n}\n","import {AfterViewInit, ChangeDetectorRef, Component, Inject, ViewChild} from '@angular/core';\nimport {WorkPackageEmbeddedTableComponent} from 'core-components/wp-table/embedded/wp-embedded-table.component';\nimport {WpTableConfigurationService} from 'core-components/wp-table/configuration-modal/wp-table-configuration.service';\nimport {RestrictedWpTableConfigurationService} from 'core-components/wp-table/external-configuration/restricted-wp-table-configuration.service';\nimport {OpQueryConfigurationLocalsToken} from \"core-components/wp-table/external-configuration/external-query-configuration.constants\";\n\nexport interface QueryConfigurationLocals {\n  service:any;\n  currentQuery:any;\n  disabledTabs:{ [key:string]:string };\n  callback:(newQuery:any) => void;\n}\n\n@Component({\n  templateUrl: './external-query-configuration.template.html',\n  providers: [[{ provide: WpTableConfigurationService, useClass: RestrictedWpTableConfigurationService }]]\n})\nexport class ExternalQueryConfigurationComponent implements AfterViewInit {\n\n  @ViewChild('embeddedTableForConfiguration', { static: true }) private embeddedTable:WorkPackageEmbeddedTableComponent;\n\n  constructor(@Inject(OpQueryConfigurationLocalsToken) readonly locals:QueryConfigurationLocals,\n              readonly cdRef:ChangeDetectorRef) {\n  }\n\n  ngAfterViewInit() {\n    // Open the configuration modal in an asynchronous step\n    // to avoid nesting components in the view initialization.\n    setTimeout(() => {\n      this.embeddedTable.openConfigurationModal(() => {\n        this.service.detach();\n        this.locals.callback(this.embeddedTable.buildQueryProps());\n      });\n      this.cdRef.detectChanges();\n    });\n  }\n\n  public get service():any {\n    return this.locals.service;\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {StateCacheService} from \"core-components/states/state-cache.service\";\nimport {multiInput, MultiInputState} from \"reactivestates\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {BoardDmService} from \"core-app/modules/boards/board/board-dm.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class BoardCacheService extends StateCacheService<Board> {\n\n  protected _state = multiInput<Board>();\n\n  constructor(protected boardDm:BoardDmService) {\n    super();\n  }\n\n  protected load(id:string):Promise<Board> {\n    return this.boardDm\n      .one(parseInt(id))\n      .toPromise()\n      .then((board:Board) => {\n        this.updateValue(id, board);\n        return board;\n      });\n\n  }\n\n  protected loadAll(ids:string[] = []):Promise<undefined> {\n    return Promise\n      .all(ids.map(id => this.load(id)))\n      .then(() => undefined);\n  }\n\n  protected get multiState():MultiInputState<Board> {\n    return this._state;\n  }\n\n  update(board:Board) {\n    this.updateValue(board.id!, board);\n  }\n}\n","<div class=\"work-package-details-activities-activity-contents\"\n     *ngIf=\"workPackage\"\n     (mouseenter)=\"focus()\"\n     (mouseleave)=\"blur()\">\n  <user-avatar *ngIf=\"userName\"\n               [attr.data-user-name]=\"userName\"\n               [attr.data-user-id]=\"userId\"\n               data-class-list=\"avatar\">\n  </user-avatar>\n\n  <span class=\"user\">\n    <user-link [user]=\"user\"></user-link>\n  </span>\n  <span class=\"date\">\n    {{ isInitial ? text.label_created_on : text.label_updated_on }}\n    <op-date-time [dateTimeValue]=\"activity.createdAt\"></op-date-time>\n  </span>\n  <div class=\"comments-number\">\n    <activity-link [workPackage]=\"workPackage\"\n                   [activityNo]=\"activityNo\">\n    </activity-link>\n    <div class=\"comments-icons\"\n         [hidden]=\"shouldHideIcons()\">\n      <accessible-by-keyboard *ngIf=\"userCanQuote\"\n                              (execute)=\"quoteComment()\"\n                              [linkTitle]=\"text.quote_comment\">\n        <op-icon icon-classes=\"action-icon icon-quote\" [icon-title]=\"text.quote_comment\"></op-icon>\n      </accessible-by-keyboard>\n      <accessible-by-keyboard *ngIf=\"userCanEdit\"\n                              (execute)=\"activate()\"\n                              [linkTitle]=\"text.edit_comment\"\n                              class=\"edit-activity--{{activityNo}}\">\n        <op-icon icon-classes=\"action-icon icon-edit\" [icon-title]=\"text.edit_comment\"></op-icon>\n      </accessible-by-keyboard>\n    </div>\n  </div>\n  <img *ngIf=\"bcfSnapshotUrl\"\n       [src]=\"bcfSnapshotUrl\"\n       class=\"activity-thumbnail\">\n  <div class=\"user-comment\" >\n    <div *ngIf=\"active\" class=\"inplace-edit\">\n      <div class=\"user-comment--form inplace-edit--write-value\">\n        <edit-form-portal [changeInput]=\"change\"\n                          [schemaInput]=\"schema\"\n                          [editFieldHandler]=\"handler\">\n        </edit-form-portal>\n      </div>\n    </div>\n    <div *ngIf=\"!active && (isComment || isBcfComment)\"\n          class=\"message wiki\"\n          [innerHtml]=\"postedComment\">\n    </div>\n    <ul class=\"work-package-details-activities-messages\" *ngIf=\"!isInitial\">\n      <li *ngFor=\"let detail of details\">\n        <span class=\"message\" [innerHtml]=\"detail\"></span>\n      </li>\n    </ul>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackagesActivityService} from 'core-components/wp-single-view-tabs/activity-panel/wp-activity.service';\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  Input,\n  OnInit\n} from \"@angular/core\";\nimport {UserCacheService} from \"core-components/user/user-cache.service\";\nimport {CommentService} from \"core-components/wp-activity/comment-service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageCommentFieldHandler} from \"core-components/work-packages/work-package-comment/work-package-comment-field-handler\";\nimport {DomSanitizer, SafeHtml} from \"@angular/platform-browser\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\n\n@Component({\n  selector: 'user-activity',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './user-activity.component.html'\n})\nexport class UserActivityComponent extends WorkPackageCommentFieldHandler implements OnInit, AfterViewInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public activity:HalResource;\n  @Input() public activityNo:number;\n  @Input() public isInitial:boolean;\n\n  public userCanEdit = false;\n  public userCanQuote = false;\n\n  public userId:string | number;\n  public user:UserResource;\n  public userName:string;\n  public userAvatar:string;\n  public details:any[] = [];\n  public isComment:boolean;\n  public isBcfComment:boolean;\n  public postedComment:SafeHtml;\n\n  public focused = false;\n\n  public text = {\n    label_created_on: this.I18n.t('js.label_created_on'),\n    label_updated_on: this.I18n.t('js.label_updated_on'),\n    quote_comment: this.I18n.t('js.label_quote_comment'),\n    edit_comment: this.I18n.t('js.label_edit_comment'),\n  };\n\n  private $element:JQuery;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly injector:Injector,\n              readonly sanitization:DomSanitizer,\n              readonly PathHelper:PathHelperService,\n              readonly wpLinkedActivities:WorkPackagesActivityService,\n              readonly commentService:CommentService,\n              readonly wpCacheService:WorkPackageCacheService,\n              readonly ConfigurationService:ConfigurationService,\n              readonly userCacheService:UserCacheService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n    super(elementRef, injector);\n  }\n\n  public ngOnInit() {\n    super.ngOnInit();\n\n    this.updateCommentText();\n    this.isComment = this.activity._type === 'Activity::Comment';\n    this.isBcfComment = this.activity._type === 'Activity::BcfComment';\n\n    this.$element = jQuery(this.elementRef.nativeElement);\n    this.reset();\n    this.userCanEdit = !!this.activity.update;\n    this.userCanQuote = !!this.workPackage.addComment;\n\n    this.$element.bind('focusin', this.focus.bind(this));\n    this.$element.bind('focusout', this.blur.bind(this));\n\n    _.each(this.activity.details, (detail:any) => {\n      this.details.push(detail.html);\n    });\n\n    this.userCacheService\n      .require(this.activity.user.idFromLink)\n      .then((user:UserResource) => {\n        this.user = user;\n        this.userId = user.id!;\n        this.userName = user.name;\n        this.userAvatar = user.avatar;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public shouldHideIcons():boolean {\n    return !((this.isComment || this.isBcfComment) && this.focussing());\n  }\n\n  public ngAfterViewInit() {\n    if (window.location.hash === 'activity-' + this.activityNo) {\n      this.elementRef.nativeElement.scrollIntoView(true);\n    }\n  }\n\n  public activate() {\n    super.activate(this.activity.comment.raw);\n    this.cdRef.detectChanges();\n  }\n\n  public handleUserSubmit() {\n    if (this.inFlight || !this.rawComment) {\n      return Promise.resolve();\n    }\n    return this.updateComment();\n  }\n\n  public quoteComment() {\n    this.commentService.quoteEvents.next(this.quotedText(this.activity.comment.raw));\n  }\n\n  public get bcfSnapshotUrl() {\n    if (_.get(this.activity, 'bcfViewpoints[0]')) {\n      return `${_.get(this.activity, 'bcfViewpoints[0]').href}/snapshot`;\n    } else {\n      return null;\n    }\n  }\n\n  public async updateComment() {\n    this.inFlight = true;\n\n    await this.onSubmit();\n    return this.commentService.updateComment(this.activity, this.rawComment || '')\n      .then((newActivity:HalResource) => {\n        this.activity = newActivity;\n        this.updateCommentText();\n        this.wpLinkedActivities.require(this.workPackage, true);\n        this.wpCacheService.updateWorkPackage(this.workPackage);\n      })\n      .finally(() => {\n        this.deactivate(true); this.inFlight = false;\n      });\n  }\n\n  public focusEditIcon() {\n    // Find the according edit icon and focus it\n    jQuery('.edit-activity--' + this.activityNo + ' a').focus();\n  }\n\n  public focus() {\n    this.focused = true;\n    this.cdRef.detectChanges();\n  }\n\n  public blur() {\n    this.focused = false;\n    this.cdRef.detectChanges();\n  }\n\n  public focussing() {\n    return this.focused;\n  }\n\n  setErrors(newErrors:string[]):void {\n    // interface\n  }\n\n  public quotedText(rawComment:string) {\n    let quoted = rawComment.split('\\n')\n      .map(function(line:string) {\n        return '\\n> ' + line;\n      })\n      .join('');\n    return this.userName + ' wrote:\\n' + quoted;\n  }\n\n  public get htmlId() {\n    return `user_activity_edit_field_${this.activityNo}`;\n  }\n\n  deactivate(focus:boolean):void {\n    super.deactivate(focus);\n\n    if (focus) {\n      this.focusEditIcon();\n    }\n  }\n\n  private updateCommentText() {\n    this.postedComment = this.sanitization.bypassSecurityTrustHtml(this.activity.comment.html);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, ChangeDetectorRef, Component, ElementRef, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {RelationQueryColumn, TypeRelationQueryColumn} from 'core-components/wp-query/query-column';\nimport {WorkPackageTable} from 'core-components/wp-fast-table/wp-fast-table';\nimport {QUERY_SORT_BY_ASC, QUERY_SORT_BY_DESC} from 'core-app/modules/hal/resources/query-sort-by-resource';\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {combineLatest} from \"rxjs\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n\n@Component({\n  selector: 'sortHeader',\n  templateUrl: './sort-header.directive.html'\n})\nexport class SortHeaderDirective extends UntilDestroyedMixin implements AfterViewInit {\n\n  @Input() headerColumn:any;\n\n  @Input() locale:string;\n\n  @Input() table:WorkPackageTable;\n\n  sortable:boolean;\n\n  directionClass:string;\n\n  public text = {\n    toggleHierarchy: this.I18n.t('js.work_packages.hierarchy.show'),\n    openMenu: this.I18n.t('js.label_open_menu'),\n    sortColumn: 'Sorting column' // TODO\n  };\n\n  isHierarchyColumn:boolean;\n\n  columnType:'hierarchy'|'relation'|'sort';\n\n  columnName:string;\n\n  hierarchyIcon:string;\n\n  isHierarchyDisabled:boolean;\n\n  private element:JQuery;\n\n  private currentSortDirection:any;\n\n  constructor(private wpTableHierarchies:WorkPackageViewHierarchiesService,\n              private wpTableSortBy:WorkPackageViewSortByService,\n              private wpTableGroupBy:WorkPackageViewGroupByService,\n              private wpTableRelationColumns:WorkPackageViewRelationColumnsService,\n              private elementRef:ElementRef,\n              private cdRef:ChangeDetectorRef,\n              private I18n:I18nService) {\n    super();\n  }\n\n  ngAfterViewInit() {\n    setTimeout(() => this.initialize());\n  }\n\n  private initialize():void {\n    this.element = jQuery(this.elementRef.nativeElement);\n\n    combineLatest([\n      this.wpTableSortBy.onReadyWithAvailable(),\n      this.wpTableSortBy.live$()\n    ])\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        let latestSortElement = this.wpTableSortBy.current[0];\n\n        if (!latestSortElement || this.headerColumn.$href !== latestSortElement.column.$href) {\n          this.currentSortDirection = null;\n        } else {\n          this.currentSortDirection = latestSortElement.direction;\n        }\n        this.setActiveColumnClass();\n\n        this.sortable = this.wpTableSortBy.isSortable(this.headerColumn);\n\n        this.directionClass = this.getDirectionClass();\n\n        this.cdRef.detectChanges();\n      });\n\n    // Place the hierarchy icon left to the subject column\n    this.isHierarchyColumn = this.headerColumn.id === 'subject';\n\n    if (this.headerColumn.id === 'sortHandle') {\n      this.columnType = 'sort';\n    }\n    if (this.isHierarchyColumn) {\n      this.columnType = 'hierarchy';\n    } else if (this.wpTableRelationColumns.relationColumnType(this.headerColumn) === 'toType') {\n      this.columnType = 'relation';\n      this.columnName = (this.headerColumn as TypeRelationQueryColumn).type.name;\n    } else if (this.wpTableRelationColumns.relationColumnType(this.headerColumn) === 'ofType') {\n      this.columnType = 'relation';\n      this.columnName = I18n.t('js.relation_labels.' + (this.headerColumn as RelationQueryColumn).relationType);\n    }\n\n\n    if (this.isHierarchyColumn) {\n      this.hierarchyIcon = 'icon-hierarchy';\n      this.isHierarchyDisabled = this.wpTableGroupBy.isEnabled;\n\n      // Disable hierarchy mode when group by is active\n      this.wpTableGroupBy\n        .live$()\n        .pipe(\n          this.untilDestroyed()\n        )\n        .subscribe(() => {\n          this.isHierarchyDisabled = this.wpTableGroupBy.isEnabled;\n          this.cdRef.detectChanges();\n        });\n\n      // Update hierarchy icon when updated elsewhere\n      this.wpTableHierarchies\n        .live$()\n        .pipe(\n          this.untilDestroyed()\n        )\n        .subscribe(() => {\n          this.setHierarchyIcon();\n          this.cdRef.detectChanges();\n        });\n\n      // Set initial icon\n      this.setHierarchyIcon();\n    }\n\n    this.cdRef.detectChanges();\n  }\n\n  public get displayDropdownIcon() {\n    return this.table && this.table.configuration.columnMenuEnabled;\n  }\n\n  public get displayHierarchyIcon() {\n    return this.table && this.table.configuration.hierarchyToggleEnabled;\n  }\n\n  toggleHierarchy(evt:JQuery.TriggeredEvent) {\n    if (this.wpTableHierarchies.toggleState()) {\n      this.wpTableGroupBy.disable();\n    }\n\n    this.setHierarchyIcon();\n\n    evt.stopPropagation();\n    return false;\n  }\n\n  setHierarchyIcon() {\n    if (this.wpTableHierarchies.isEnabled) {\n      this.text.toggleHierarchy = I18n.t('js.work_packages.hierarchy.hide');\n      this.hierarchyIcon = 'icon-hierarchy';\n    } else {\n      this.text.toggleHierarchy = I18n.t('js.work_packages.hierarchy.show');\n      this.hierarchyIcon = 'icon-no-hierarchy';\n    }\n  }\n\n  private getDirectionClass():string {\n    if (!this.currentSortDirection) {\n      return '';\n    }\n\n    switch (this.currentSortDirection.$href) {\n      case QUERY_SORT_BY_ASC:\n        return 'asc';\n      case QUERY_SORT_BY_DESC:\n        return 'desc';\n      default:\n        return '';\n    }\n  }\n\n  setActiveColumnClass() {\n    this.element.toggleClass('active-column', !!this.currentSortDirection);\n  }\n\n}\n\n\n\n","<div class=\"generic-table--sort-header-outer\" [ngSwitch]=\"columnType\">\n\n  <span class=\"generic-table--sort-header\" *ngSwitchCase=\"'hierarchy'\">\n    <span\n        class=\"hierarchy-header--icon\"\n        *ngIf=\"displayHierarchyIcon\"\n        (click)=\"toggleHierarchy($event)\"\n        [attr.title]=\"text.toggleHierarchy\"\n        tabindex=\"-1\"\n        aria-hidden=\"true\">\n      <op-icon icon-classes=\"icon {{ hierarchyIcon }}\"></op-icon>\n    </span>\n\n    <!--suppress XmlDuplicatedId -->\n    <a href=\"#\"\n       *ngIf=\"sortable\"\n       [ngClass]=\"[directionClass && 'sort', directionClass]\"\n       lang-attribute\n       lang=\"{{locale}}\"\n       id=\"{{ headerColumn.id }}\">{{headerColumn.name}}</a>\n    <a *ngIf=\"!sortable\">{{headerColumn.name}}</a>\n\n    <op-icon icon-classes=\"dropdown-indicator icon-small icon-pulldown\"\n             icon-title=\"{{ text.openMenu }}\"\n             *ngIf=\"displayDropdownIcon\"></op-icon>\n  </span>\n\n  <span class=\"generic-table--sort-header\" *ngSwitchCase=\"'relation'\">\n    <a [attr.title]=\"headerColumn.name\">\n      <op-icon icon-classes=\"icon-context icon-relations relations-header--icon\"></op-icon>\n      {{columnName}}\n    </a>\n    <op-icon icon-classes=\"dropdown-indicator icon-small icon-pulldown\"\n             icon-title=\"{{ text.openMenu }}\"\n             *ngIf=\"displayDropdownIcon\"></op-icon>\n  </span>\n\n  <span class=\"draggable-table--sort-header\"\n        [attr.title]=\"text.sortColumn\"\n        *ngSwitchCase=\"'sort'\">\n  </span>\n\n  <span class=\"generic-table--sort-header\" *ngSwitchDefault>\n\n    <!--suppress XmlDuplicatedId -->\n    <a href=\"#\"\n       *ngIf=\"sortable\"\n       [ngClass]=\"[directionClass && 'sort', directionClass]\"\n       lang-attribute\n       lang=\"{{locale}}\"\n       id=\"{{ headerColumn.id }}\">{{headerColumn.name}}</a>\n\n    <a *ngIf=\"!sortable\">{{headerColumn.name}}</a>\n\n    <op-icon icon-classes=\"dropdown-indicator icon-small icon-pulldown\"\n             icon-title=\"{{ text.openMenu }}\"\n             *ngIf=\"displayDropdownIcon\"></op-icon>\n  </span>\n\n</div>\n","import {Injectable} from \"@angular/core\";\nimport {BoardListsService} from \"core-app/modules/boards/board/board-list/board-lists.service\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {Board, BoardType} from \"core-app/modules/boards/board/board\";\nimport {BoardDmService} from \"core-app/modules/boards/board/board-dm.service\";\nimport {BoardCacheService} from \"core-app/modules/boards/board/board-cache.service\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {BehaviorSubject} from \"rxjs\";\n\nexport interface CreateBoardParams {\n  type:BoardType;\n  boardName?:string;\n  attribute?:string;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class BoardService {\n\n  public currentBoard$:BehaviorSubject<string|null> = new BehaviorSubject<string|null>(null);\n\n  private loadAllPromise:Promise<Board[]>|undefined;\n\n  private text = {\n    unnamed_board: this.I18n.t('js.boards.label_unnamed_board'),\n    action_board: (attr:string) => this.I18n.t('js.boards.board_type.action_by_attribute',\n      { attribute: this.I18n.t('js.boards.board_type.action_type.' + attr )}),\n    unnamed_list: this.I18n.t('js.boards.label_unnamed_list'),\n  };\n\n  constructor(protected boardDm:BoardDmService,\n              protected PathHelper:PathHelperService,\n              protected CurrentProject:CurrentProjectService,\n              protected halResourceService:HalResourceService,\n              protected boardCache:BoardCacheService,\n              protected boardActions:BoardActionsRegistryService,\n              protected I18n:I18nService,\n              protected boardsList:BoardListsService) {\n  }\n\n  /**\n   * Return all boards in the current scope of the project\n   *\n   * @param projectIdentifier\n   */\n  public loadAllBoards(projectIdentifier:string|null = this.CurrentProject.identifier, force = false) {\n    if (!(force || this.loadAllPromise === undefined)) {\n      return this.loadAllPromise;\n    }\n\n    return this.loadAllPromise = this.boardDm\n      .allInScope()\n      .toPromise()\n      .then((boards) => {\n        boards.forEach(b => this.buildOrderAndUpdate(b));\n        return boards;\n      });\n  }\n\n  /**\n   * Check whether the current user can manage board-type grids.\n   */\n  public canManage(board:Board):boolean {\n    return !!board.grid.$links.delete;\n  }\n\n\n  /**\n   * Save the changes to the board\n   */\n  public save(board:Board) {\n    this.reorderWidgets(board);\n    return this.boardDm.save(board)\n      .then(board => {\n        board.sortWidgets();\n        this.boardCache.update(board);\n        return board;\n      });\n  }\n\n  /**\n   * Create a new board\n   * @param name\n   */\n  public async create(params:CreateBoardParams):Promise<Board> {\n    const board = await this.boardDm.create(params.type, this.boardName(params), params.attribute);\n\n    if (params.type === 'free') {\n      await this.boardsList.addFreeQuery(board, { name: this.text.unnamed_list });\n    } else {\n      await this.boardActions.get(params.attribute!).addActionQueries(board);\n    }\n\n    await this.save(board);\n\n    return board;\n  }\n\n  public delete(board:Board):Promise<void> {\n    return this.boardDm\n      .delete(board)\n      .then(() => this.boardCache.clearSome(board.id!));\n  }\n\n  /**\n   * Build a default board name\n   */\n  private boardName(params:CreateBoardParams) {\n    if (params.boardName) {\n      return params.boardName;\n    }\n\n    if (params.type === \"action\") {\n      return this.text.action_board(params.attribute!);\n    }\n\n    return this.text.unnamed_board;\n  }\n\n  /**\n   * Reorders the widgets to correspond to the available columns\n   * @param board\n   */\n  private reorderWidgets(board:Board) {\n    board.grid.columnCount = Math.max(board.grid.widgets.length, 1);\n    board.grid.widgets.map((el:GridWidgetResource, index:number) => {\n      el.startColumn = index + 1;\n      el.endColumn = index + 2;\n      return el;\n    });\n  }\n\n  /**\n   * Put the board widgets in correct order and update cache\n   */\n  private buildOrderAndUpdate(board:Board) {\n    board.sortWidgets();\n    this.boardCache.update(board);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Component, Input} from '@angular/core';\n\n@Component({\n  selector: 'wp-type-status',\n  templateUrl: './wp-type-status.html'\n})\nexport class WorkPackageTypeStatusComponent {\n  @Input('workPackage') workPackage:WorkPackageResource;\n}\n","<div *ngIf=\"workPackage\"\n     class=\"wp-new-top-row\">\n  <div class=\"work-packages--status-selector wp-new-top-row--element\">\n    <editable-attribute-field [resource]=\"workPackage\"\n                   [displayFieldOptions]=\"{ colorize: false }\"\n                   [wrapperClasses]=\"'wp-new-top-row--status -no-label'\"\n                   [fieldName]=\"'status'\">\n    </editable-attribute-field>\n  </div>\n  <div class=\"work-packages--type-selector wp-new-top-row--element\">\n    <editable-attribute-field [resource]=\"workPackage\"\n                   [wrapperClasses]=\"'wp-new-top-row--type -no-label'\"\n                   [fieldName]=\"'type'\">\n    </editable-attribute-field>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {HttpErrorResponse} from \"@angular/common/http\";\n\nexport const v3ErrorIdentifierQueryInvalid = 'urn:openproject-org:api:v3:errors:InvalidQuery';\nexport const v3ErrorIdentifierMultipleErrors = 'urn:openproject-org:api:v3:errors:MultipleErrors';\n\nexport class ErrorResource extends HalResource {\n  public errors:any[];\n  public message:string;\n  public details:any;\n  public errorIdentifier:string;\n\n  /** We may get a reference to the underlying http error */\n  public httpError?:HttpErrorResponse;\n\n  public isValidationError:boolean = false;\n\n  /**\n   * Override toString to ensure the resource can\n   * be printed nicely on console and in errors\n   */\n  public toString() {\n    return `[ErrorResource ${this.message}]`;\n  }\n\n  public get errorMessages():string[] {\n    if (this.isMultiErrorMessage()) {\n      return this.errors.map(error => error.message);\n    }\n\n    return [this.message];\n  }\n\n  public isMultiErrorMessage() {\n    return this.errorIdentifier === v3ErrorIdentifierMultipleErrors;\n  }\n\n  public getInvolvedAttributes():string[] {\n    var columns = [];\n\n    if (this.details) {\n      columns = [{ details: this.details }];\n    }\n    else if (this.errors) {\n      columns = this.errors;\n    }\n\n    return _.flatten(columns.map((resource:ErrorResource) => {\n      if (resource.errorIdentifier === v3ErrorIdentifierMultipleErrors) {\n        return this.extractMultiError(resource)[0];\n      } else {\n        return resource.details.attribute;\n      }\n    }));\n  }\n\n  public getMessagesPerAttribute():{ [attribute:string]:string[] } {\n    let perAttribute:any = {};\n\n    if (this.details) {\n      perAttribute[this.details.attribute] = [this.message];\n    }\n    else {\n      _.forEach(this.errors, (error:any) => {\n        if (error.errorIdentifier === v3ErrorIdentifierMultipleErrors) {\n          const [attribute, messages] = this.extractMultiError(error);\n          let current = perAttribute[attribute] || [];\n          perAttribute[attribute] = current.concat(messages);\n        } else if (perAttribute[error.details.attribute]) {\n          perAttribute[error.details.attribute].push(error.message);\n        }\n        else {\n          perAttribute[error.details.attribute] = [error.message];\n        }\n      });\n    }\n\n    return perAttribute;\n  }\n\n  protected extractMultiError(resource:ErrorResource):[string, string[]] {\n    let attribute = resource.errors[0].details.attribute;\n    let messages = resource.errors.map((el:ErrorResource) => el.message);\n\n    return [attribute, messages];\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {ConfigurationResource} from 'core-app/modules/hal/resources/configuration-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {shareReplay} from \"rxjs/operators\";\nimport {Observable} from \"rxjs\";\n\n@Injectable()\nexport class ConfigurationDmService {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  private $configuration:Observable<ConfigurationResource>;\n\n  public load():Observable<ConfigurationResource> {\n    if (this.$configuration) {\n      return this.$configuration;\n    }\n\n    return this.$configuration = this.halResourceService\n      .get<ConfigurationResource>(this.pathHelper.api.v3.configuration.toString())\n      .pipe(\n        shareReplay()\n      );\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {\n  WorkPackageViewDisplayRepresentationService,\n  wpDisplayCardRepresentation,\n  wpDisplayListRepresentation\n} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {combineLatest} from \"rxjs\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n\n@Component({\n  template: `\n    <button class=\"button\"\n            id=\"wp-view-toggle-button\"\n            wpViewDropdown>\n      <op-icon icon-classes=\"button--icon icon-view-{{view}}\"></op-icon>\n      <span class=\"button--text\"\n            aria-hidden=\"true\"\n            [textContent]=\"text[view]\">\n        </span>\n      <op-icon icon-classes=\"button--icon icon-small icon-pulldown\"></op-icon>\n    </button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-view-toggle-button',\n})\nexport class WorkPackageViewToggleButton extends UntilDestroyedMixin implements OnInit {\n  public view:string;\n\n  public text:any = {\n    card: this.I18n.t('js.views.card'),\n    list: this.I18n.t('js.views.list'),\n    timeline: this.I18n.t('js.views.timeline'),\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly wpDisplayRepresentationService:WorkPackageViewDisplayRepresentationService,\n              readonly wpTableTimeline:WorkPackageViewTimelineService) {\n    super();\n  }\n\n  ngOnInit() {\n    let statesCombined = combineLatest([\n      this.wpDisplayRepresentationService.live$(),\n      this.wpTableTimeline.live$(),\n    ]);\n\n    statesCombined.pipe(\n      this.untilDestroyed()\n    ).subscribe(([display, timelines]) => {\n      this.detectView(display, timelines.visible);\n      this.cdRef.detectChanges();\n    });\n  }\n\n  public detectView(display:string|null, timelineVisible:boolean) {\n    if (display === wpDisplayCardRepresentation) {\n      this.view = wpDisplayCardRepresentation;\n      return;\n    }\n\n    if (timelineVisible) {\n      this.view = 'timeline';\n    } else {\n      this.view = wpDisplayListRepresentation;\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {WikiIncludePageMacroModal} from 'core-components/modals/editor/macro-wiki-include-page-modal/wiki-include-page-macro.modal';\nimport {CodeBlockMacroModal} from 'core-components/modals/editor/macro-code-block-modal/code-block-macro.modal';\nimport {ChildPagesMacroModal} from 'core-components/modals/editor/macro-child-pages-modal/child-pages-macro.modal';\nimport {CkeditorAugmentedTextareaComponent} from 'core-app/ckeditor/ckeditor-augmented-textarea.component';\nimport {OpenprojectAttachmentsModule} from 'core-app/modules/attachments/openproject-attachments.module';\nimport {OpCkeditorComponent} from 'core-app/modules/common/ckeditor/op-ckeditor.component';\nimport {FormsModule} from '@angular/forms';\nimport {EditorMacrosService} from 'core-components/modals/editor/editor-macros.service';\nimport {CKEditorSetupService} from 'core-app/modules/common/ckeditor/ckeditor-setup.service';\nimport {CKEditorPreviewService} from 'core-app/modules/common/ckeditor/ckeditor-preview.service';\nimport {CommonModule} from \"@angular/common\";\n\n@NgModule({\n  imports: [\n    FormsModule,\n    CommonModule,\n    OpenprojectAttachmentsModule\n  ],\n  providers: [\n    // CKEditor\n    EditorMacrosService,\n    CKEditorSetupService,\n    CKEditorPreviewService,\n  ],\n  exports: [\n    CkeditorAugmentedTextareaComponent,\n    OpCkeditorComponent,\n  ],\n  declarations: [\n    // CKEditor and Macros\n    CkeditorAugmentedTextareaComponent,\n    OpCkeditorComponent,\n    WikiIncludePageMacroModal,\n    CodeBlockMacroModal,\n    ChildPagesMacroModal,\n  ]\n})\nexport class OpenprojectEditorModule {\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Observable} from 'rxjs';\nimport {distinctUntilChanged, map} from 'rxjs/operators';\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageViewBaseService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-base.service\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\n\nexport interface WPFocusState {\n  workPackageId:string;\n  focusAfterRender:boolean;\n}\n\n@Injectable()\nexport class WorkPackageViewFocusService extends WorkPackageViewBaseService<WPFocusState> {\n\n  constructor(public querySpace:IsolatedQuerySpace,\n              public wpTableSelection:WorkPackageViewSelectionService) {\n    super(querySpace);\n  }\n\n  public isFocused(workPackageId:string) {\n    return this.focusedWorkPackage === workPackageId;\n  }\n\n  public ifShouldFocus(callback:(workPackageId:string) => void) {\n    const value = this.current;\n\n    if (value && value.focusAfterRender) {\n      callback(value.workPackageId);\n      value.focusAfterRender = false;\n      this.update(value);\n    }\n  }\n\n  public get focusedWorkPackage():string|null {\n    const value = this.current;\n\n    if (value) {\n      return value.workPackageId;\n    }\n\n    // Return the first result if none selected\n    const results = this.querySpace.results.value;\n    if (results && results.elements.length > 0) {\n      return results.elements[0].id!.toString();\n    }\n\n    return null;\n  }\n\n  public whenChanged():Observable<string> {\n    return this.live$()\n      .pipe(\n        map((val:WPFocusState) => val.workPackageId),\n        distinctUntilChanged()\n      );\n  }\n\n  public updateFocus(workPackageId:string, setFocusAfterRender:boolean = false) {\n    // Set the selection to this row, if nothing else is selected.\n    if (this.wpTableSelection.isEmpty) {\n      this.wpTableSelection.setRowState(workPackageId, true);\n    }\n    this.update({ workPackageId: workPackageId, focusAfterRender: setFocusAfterRender });\n  }\n\n  valueFromQuery(query:QueryResource, results:WorkPackageCollectionResource):WPFocusState|undefined {\n    return undefined;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\nimport {Observable} from \"rxjs\";\nimport {tap} from \"rxjs/operators\";\n\nexport const indicatorLocationSelector = '.loading-indicator--location';\nexport const indicatorBackgroundSelector = '.loading-indicator--background';\n\nexport function withLoadingIndicator<T>(indicator:LoadingIndicator, delayStopTime?:number):(source:Observable<T>) => Observable<T> {\n  return (source$:Observable<T>) => {\n    indicator.start();\n\n    return source$.pipe(\n      tap(\n        () => indicator.delayedStop(delayStopTime),\n        () => indicator.stop(),\n        () => indicator.stop()\n      )\n    );\n  };\n}\n\nexport function withDelayedLoadingIndicator<T>(indicator:() => LoadingIndicator):(source:Observable<T>) => Observable<T> {\n  return (source$:Observable<T>) => {\n    setTimeout(() => indicator().start());\n\n    return source$.pipe(\n      tap(\n        () => undefined,\n        () => indicator().stop(),\n        () => indicator().stop()\n      )\n    );\n  };\n}\n\n\nexport class LoadingIndicator {\n\n  private indicatorTemplate:string =\n    `<div class=\"loading-indicator--background\">\n      <div class=\"loading-indicator\">\n        <div class=\"block-1\"></div>\n        <div class=\"block-2\"></div>\n        <div class=\"block-3\"></div>\n        <div class=\"block-4\"></div>\n        <div class=\"block-5\"></div>\n      </div>\n    </div>\n   `;\n\n  constructor(public indicator:JQuery) {\n  }\n\n  public set promise(promise:Promise<unknown>) {\n    this.start();\n\n    // Keep bound method around\n    const stopper = () => this.delayedStop();\n\n    promise\n      .then(stopper)\n      .catch(stopper);\n  }\n\n  public start() {\n    // If we're currently having an active indicator, remove that one\n    this.stop();\n    this.indicator.prepend(this.indicatorTemplate);\n  }\n\n  public delayedStop(time = 25) {\n    setTimeout(() => this.stop(), time);\n  }\n\n  public stop() {\n    this.indicator.find('.loading-indicator--background').remove();\n  }\n}\n\n@Injectable({ providedIn: 'root' })\nexport class LoadingIndicatorService {\n\n  // Provide shortcut to the primarily used indicators\n  public get table() {\n    return this.indicator('table');\n  }\n\n  public get wpDetails() {\n    return this.indicator('wpDetails');\n  }\n\n  public get modal() {\n    return this.indicator('modal');\n  }\n\n  // Returns a getter function to an indicator\n  // in case the indicator is shown conditionally\n  public getter(name:string):() => LoadingIndicator {\n    return this.indicator.bind(this, name);\n  }\n\n  // Return an indicator by name or element\n  public indicator(indicator:string|JQuery):LoadingIndicator {\n    if (typeof indicator === 'string') {\n      indicator = this.getIndicatorAt(indicator) as JQuery;\n    }\n\n    return new LoadingIndicator(indicator);\n  }\n\n  private getIndicatorAt(name:string):JQuery {\n    return jQuery(indicatorLocationSelector).filter(`[data-indicator-name=\"${name}\"]`);\n  }\n}\n","import {EventEmitter} from '@angular/core';\nimport {Observable, Subject} from 'rxjs';\nimport {debounceTime, takeUntil} from 'rxjs/operators';\n\nexport class DebouncedEventEmitter<T> {\n\n  private emitter = new EventEmitter<T>();\n  private debouncer:Subject<T>;\n\n  constructor(takeUntil$:Observable<unknown>, debounceTimeInMs:number = 250) {\n    this.debouncer = new Subject<T>();\n    this.debouncer\n      .pipe(\n        debounceTime(debounceTimeInMs),\n        takeUntil(takeUntil$)\n      )\n      .subscribe((val) => this.emitter.emit(val));\n  }\n\n  public emit(value?:T):void {\n    this.debouncer.next(value);\n  }\n\n  public subscribe(generatorOrNext?:any, error?:any, complete?:any):any {\n    return this.emitter.subscribe(generatorOrNext, error, complete);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectorRef, Component, ElementRef, Inject} from '@angular/core';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {HelpTextResource} from 'core-app/modules/hal/resources/help-text-resource';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\n\n@Component({\n  templateUrl: './help-text.modal.html'\n})\nexport class AttributeHelpTextModal extends OpModalComponent {\n\n  /* Close on escape? */\n  public closeOnEscape = true;\n\n  /* Close on outside click */\n  public closeOnOutsideClick = false;\n\n  readonly text = {\n    'edit': this.I18n.t('js.button_edit'),\n    'close': this.I18n.t('js.button_close')\n  };\n\n  public helpText:HelpTextResource = this.locals.helpText!;\n\n  constructor(@Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly elementRef:ElementRef) {\n    super(locals, cdRef, elementRef);\n  }\n\n  public get helpTextLink() {\n    if (this.helpText.editText) {\n      return this.helpText.editText.$link.href;\n    }\n\n    return '';\n\n  }\n}\n\n","<div class=\"op-modal--portal  loading-indicator--location\"\n     data-indicator-name=\"modal\">\n  <div class=\"op-modal--modal-container attribute-help-text--modal\" tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3>\n        <span class=\"icon-context icon-help1\"></span>\n        <span class=\"ellipsis\" [textContent]=\"helpText.attributeCaption\"></span>\n      </h3>\n\n      <a class=\"op-modal--modal-close-button\">\n        <i\n          class=\"icon-close\"\n          (accessibleClick)=\"closeMe($event)\"\n          [attr.title]=\"text.close\">\n        </i>\n      </a>\n    </div>\n\n    <div class=\"op-modal--modal-body -formattable\"\n         tabindex=\"0\"\n         [innerHtml]=\"helpText.helpText.html\">\n    </div>\n\n    <div class=\"modal--form-actions\">\n      <a class=\"help-text--edit-button button\"\n         *ngIf=\"helpText.editText\"\n         [attr.href]=\"helpTextLink\"\n         [attr.title]=\"text.edit\">\n        <op-icon icon-classes=\"button--icon icon-edit\"></op-icon>\n        <span class=\"button--text\" [textContent]=\"text.edit\"></span>\n      </a>\n    </div>\n  </div>\n</div>\n","import {Component, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {\n  QUERY_SORT_BY_ASC,\n  QUERY_SORT_BY_DESC,\n  QuerySortByResource\n} from 'core-app/modules/hal/resources/query-sort-by-resource';\nimport {WorkPackageViewSortByService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\n\nexport class SortModalObject {\n  constructor(public column:SortColumn,\n              public direction:string) {\n  }\n}\n\nexport interface SortColumn {\n  name:string;\n  href:string | null;\n}\n\nexport type SortingMode = 'automatic'|'manual';\n\n@Component({\n  templateUrl: './sort-by-tab.component.html'\n})\nexport class WpTableConfigurationSortByTab implements TabComponent {\n\n  public text = {\n    title: this.I18n.t('js.label_sort_by'),\n    placeholder: this.I18n.t('js.placeholders.default'),\n    sort_criteria_1: this.I18n.t('js.filter.sorting.criteria.one'),\n    sort_criteria_2: this.I18n.t('js.filter.sorting.criteria.two'),\n    sort_criteria_3: this.I18n.t('js.filter.sorting.criteria.three'),\n    sorting_mode: {\n      description: this.I18n.t('js.work_packages.table_configuration.sorting_mode.description'),\n      automatic: this.I18n.t('js.work_packages.table_configuration.sorting_mode.automatic'),\n      manually: this.I18n.t('js.work_packages.table_configuration.sorting_mode.manually'),\n      warning: this.I18n.t('js.work_packages.table_configuration.sorting_mode.warning'),\n    },\n  };\n\n  readonly availableDirections = [\n    {$href: QUERY_SORT_BY_ASC, name: this.I18n.t('js.label_ascending')},\n    {$href: QUERY_SORT_BY_DESC, name: this.I18n.t('js.label_descending')}\n  ];\n\n  public availableColumns:SortColumn[] = [];\n  public allColumns:SortColumn[] = [];\n  public sortationObjects:SortModalObject[] = [];\n  public emptyColumn:SortColumn = {name: this.text.placeholder, href: null};\n\n  public sortingMode:SortingMode = 'automatic';\n  public manualSortColumn:SortColumn;\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly wpTableSortBy:WorkPackageViewSortByService) {\n\n  }\n\n  public onSave() {\n    let sortElements;\n    if (this.sortingMode === 'automatic') {\n      sortElements = this.sortationObjects.filter(object => object.column !== null);\n    } else {\n      sortElements = [ new SortModalObject(this.manualSortColumn, QUERY_SORT_BY_ASC) ];\n    }\n\n    sortElements = sortElements.map(object => this.getMatchingSort(object.column.href!, object.direction));\n    this.wpTableSortBy.update(_.compact(sortElements));\n  }\n\n  ngOnInit() {\n    this.wpTableSortBy\n      .onReadyWithAvailable()\n      .subscribe(() => {\n        let allColumns:SortColumn[] = this.wpTableSortBy.available.filter(\n          (sort:QuerySortByResource) => {\n            return !sort.column.$href!.endsWith('/parent');\n          }\n        ).map(\n          (sort:QuerySortByResource) => {\n            return {name: sort.column.name, href: sort.column.$href};\n          }\n        );\n\n        // For whatever reason, even though the UI doesnt implement it,\n        // QuerySortByResources are doubled for each column (one for asc/desc direction)\n        this.allColumns = _.uniqBy(allColumns, 'href');\n\n        this.getManualSortingOption();\n\n        _.each(this.wpTableSortBy.current, sort => {\n          if (!sort.column.$href!.endsWith('/parent')) {\n            this.sortationObjects.push(\n              new SortModalObject({name: sort.column.name, href: sort.column.$href},\n                sort.direction.$href!)\n            );\n            if (sort.column.href === this.manualSortColumn.href) {\n              this.updateSortingMode('manual');\n            }\n          }\n        });\n\n        this.updateUsedColumns();\n        this.fillUpSortElements();\n      });\n  }\n\n  public updateSelection(sort:SortModalObject, selected:string | null) {\n    sort.column = _.find(this.allColumns, (column) => column.href === selected) || this.emptyColumn;\n    this.updateUsedColumns();\n  }\n\n  public updateUsedColumns() {\n    let usedColumns = this.sortationObjects\n      .filter(o => o.column !== null)\n      .map((object:SortModalObject) => object.column);\n\n    this.availableColumns = _.sortBy(_.differenceBy(this.allColumns, usedColumns, 'href'), 'name');\n  }\n\n  public updateSortingMode(mode:SortingMode) {\n    this.sortingMode = mode;\n  }\n\n  private getMatchingSort(column:string, direction:string) {\n    return _.find(this.wpTableSortBy.available, sort => {\n      return sort.column.$href === column && sort.direction.$href === direction;\n    });\n  }\n\n  private fillUpSortElements() {\n    while (this.sortationObjects.length < 3) {\n      this.sortationObjects.push(new SortModalObject(this.emptyColumn, QUERY_SORT_BY_ASC));\n    }\n  }\n\n  private getManualSortingOption() {\n    this.manualSortColumn = this.allColumns.find((e) => e.href!.endsWith('/manualSorting'))!;\n    this.allColumns.splice(this.allColumns.indexOf(this.manualSortColumn), 1);\n  }\n}\n","<form name=\"modalSortingForm\">\n  <div id=\"modal-sorting\"\n       class=\"modal-content-container loading-indicator--location\"\n       data-indicator-name=\"sorting-modal\">\n\n    <p [textContent]=\"text.sorting_mode.description\"></p>\n    <div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"sortingMode\"\n                 (change)=\"updateSortingMode($event.target.value)\"\n                 name=\"sorting_mode_switch\"\n                 value=\"manual\">\n          {{ text.sorting_mode.manually }}\n        </label>\n      </div>\n    </div><div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"sortingMode\"\n                 (change)=\"updateSortingMode($event.target.value)\"\n                 name=\"sorting_mode_switch\"\n                 value=\"automatic\">\n          {{ text.sorting_mode.automatic }}\n        </label>\n      </div>\n      <div class=\"form--field-instructions\">\n        {{ text.sorting_mode.warning }}\n      </div>\n    </div>\n\n    <ng-container *ngIf=\"sortingMode === 'automatic'\">\n      <div class=\"form--row modal-sorting-row-{{index}}\"\n           *ngFor=\"let sort of sortationObjects; let index = index\">\n        <div class=\"form--field -full-width\">\n          <label\n            for=\"modal-sorting-attribute-{{index}}\"\n            [textContent]=\"text['sort_criteria_' + index]\"\n            class=\"form--label hidden-for-sighted\">\n          </label>\n          <div class=\"form--field-container\">\n            <div class=\"form--select-container\">\n              <select\n                id=\"modal-sorting-attribute-{{index}}\"\n                name=\"modal-sorting-attribute-{{index}}\"\n                (change)=\"updateSelection(sort, $event.target.value)\"\n                class=\"form--select\">\n                <option *ngIf=\"!!sort.column.href\"\n                        [textContent]=\"sort.column.name\"\n                        [value]=\"sort.column.href\"\n                        selected></option>\n\n                <!--\n                TODO:\n                The option element below used this code:\n                  [selected]=\"sort.column.href === null\"\n\n                However, the Angular template compiler wrongly complains about the comparison.\n                https://github.com/angular/angular/issues/18754\n\n                Since the explicit null comparision is safer than `!sort.column.href` the code\n                should be reverted to the old version once the bug is fixed.\n                -->\n                <option [textContent]=\"emptyColumn.name\"\n                        [value]=\"emptyColumn.href\"\n                        [selected]=\"!sort.column.href\"></option>\n\n                <option *ngFor=\"let column of availableColumns\"\n                        [textContent]=\"column.name\"\n                        [value]=\"column.href\"></option>\n              </select>\n            </div>\n          </div>\n        </div>\n        <div class=\"form--field -full-width\">\n          <div class=\"form--field-container\">\n            <label class=\"option-label\" *ngFor=\"let availableDirection of availableDirections\">\n              <input type=\"radio\"\n                     [(ngModel)]=\"sort.direction\"\n                     [value]=\"availableDirection.$href\"\n                     [textContent]=\"availableDirection.name\"\n                     name=\"modal-sorting-attribute-{{index}}--sort-direction\">\n              {{ availableDirection.name }}\n            </label>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </div>\n</form>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector, OnDestroy} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WpRelationInlineAddExistingComponent} from \"core-components/wp-relations/embedded/inline/add-existing/wp-relation-inline-add-existing.component\";\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {WpRelationInlineCreateServiceInterface} from \"core-components/wp-relations/embedded/wp-relation-inline-create.service.interface\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Injectable()\nexport class WpRelationInlineCreateService extends WorkPackageInlineCreateService implements WpRelationInlineCreateServiceInterface, OnDestroy {\n  @InjectField() wpRelations:WorkPackageRelationsService;\n\n  constructor(public injector:Injector) {\n    super(injector);\n  }\n\n  /**\n   * A separate reference pane for the inline create component\n   */\n  public readonly referenceComponentClass = WpRelationInlineAddExistingComponent;\n\n  /**\n   * Defines the relation type for the relations inline create\n   */\n  public relationType = '';\n\n  /**\n   * Add a new relation of the above type\n   */\n  public add(from:WorkPackageResource, toId:string):Promise<unknown> {\n    return this.wpRelations.addCommonRelation(toId, this.relationType, from.id!);\n  }\n\n  /**\n   * Remove a given relation\n   */\n  public remove(from:WorkPackageResource, to:WorkPackageResource):Promise<unknown> {\n    // Find the relation matching relationType and from->to which are unique together\n    const relation = this.wpRelations.find(to, from, this.relationType);\n\n    if (relation !== undefined) {\n      return this.wpRelations.removeRelation(relation);\n    } else {\n      return Promise.reject();\n    }\n  }\n\n  /**\n   * A related work package for the inline create context\n   */\n  public referenceTarget:WorkPackageResource|null = null;\n\n\n  public get canAdd() {\n    return !!(this.referenceTarget && this.canCreateWorkPackages && this.referenceTarget.addRelation);\n  }\n\n  public get canReference() {\n    return !!this.canAdd;\n  }\n\n  /**\n   * Reference button text\n   */\n  public readonly buttonTexts = {\n    reference: this.I18n.t('js.relation_buttons.add_existing'),\n    create: this.I18n.t('js.relation_buttons.create_new')\n  };\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Transition} from \"@uirouter/core\";\nimport {Injectable} from \"@angular/core\";\nimport {EditFormRoutingService} from \"core-app/modules/fields/edit/edit-form/edit-form-routing.service\";\n\n@Injectable()\nexport class WorkPackageEditFormRoutingService extends EditFormRoutingService {\n  /**\n   * Return whether the given transition is cancelled during the editing of this form\n   *\n   * @param transition The transition that is underway.\n   * @return A boolean marking whether the transition should be blocked.\n   */\n  public blockedTransition(transition:Transition):boolean {\n    const toState = transition.to();\n    const fromState = transition.from();\n    const fromParams = transition.params('from');\n    const toParams = transition.params('to');\n\n    // In new/copy mode, transitions to the same controller are allowed\n    if (fromState.name && fromState.name.match(/\\.(new|copy)$/)) {\n      return !(toState.data && toState.data.allowMovingInEditMode);\n    }\n\n    // When editing an existing WP, transitions on the same WP id are allowed\n    return toParams.workPackageId === undefined || toParams.workPackageId !== fromParams.workPackageId;\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {EditFormRoutingService} from \"core-app/modules/fields/edit/edit-form/edit-form-routing.service\";\nimport {WorkPackageEditFormRoutingService} from \"core-app/modules/work_packages/routing/wp-edit-form/wp-edit-form-routing.service\";\n\nexport const wpBaseSelector = 'work-packages-base';\n\n@Component({\n  selector: wpBaseSelector,\n  template: `\n    <div class=\"work-packages-page--ui-view\" wp-isolated-query-space>\n      <ui-view></ui-view>\n    </div>\n  `,\n  providers: [\n    { provide: EditFormRoutingService, useClass: WorkPackageEditFormRoutingService }\n  ]\n})\nexport class WorkPackagesBaseComponent {\n}\n","import {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {WorkPackageTable} from \"../wp-fast-table\";\n\n\n/**\n * Execute the callback if the given JQuery Event is either an ENTER key or a click\n */\nexport function onClickOrEnter(evt:JQuery.TriggeredEvent, callback:() => void) {\n  if (evt.type === 'click' || (evt.type === 'keydown' && evt.which === keyCodes.ENTER)) {\n    callback();\n    return false;\n  }\n\n  return true;\n}\n\n\nexport abstract class ClickOrEnterHandler {\n  public handleEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent) {\n    onClickOrEnter(evt, () => this.processEvent(table, evt));\n  }\n\n  protected abstract processEvent(table:WorkPackageTable, evt:JQuery.TriggeredEvent):boolean;\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {ProjectResource} from 'core-app/modules/hal/resources/project-resource';\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {Apiv3ProjectsPaths} from \"core-app/modules/common/path-helper/apiv3/projects/apiv3-projects-paths\";\nimport {AbstractDmService} from \"core-app/modules/hal/dm-services/abstract-dm.service\";\n\n@Injectable()\nexport class ProjectDmService extends AbstractDmService<ProjectResource> {\n  public schema():Promise<SchemaResource> {\n    return this.halResourceService\n      .get<SchemaResource>(this.projectsPath.schema)\n      .toPromise();\n  }\n\n  protected listUrl():string {\n    return this.projectsPath.toString();\n  }\n\n  protected oneUrl(id:number|string):string {\n    return this.projectsPath.id(id).toString();\n  }\n\n  private get projectsPath():Apiv3ProjectsPaths {\n    return this.pathHelper.api.v3.projects;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Input, OnInit} from '@angular/core';\nimport {UIRouterGlobals} from '@uirouter/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageCacheService} from '../work-package-cache.service';\nimport {randomString} from \"core-app/helpers/random-string\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'wp-subject',\n  templateUrl: './wp-subject.html'\n})\nexport class WorkPackageSubjectComponent extends UntilDestroyedMixin implements OnInit {\n  @Input('workPackage') workPackage:WorkPackageResource;\n\n  public readonly uniqueElementIdentifier = `work-packages--subject-type-row-${randomString(16)}`;\n\n  constructor(protected uiRouterGlobals:UIRouterGlobals,\n              protected wpCacheService:WorkPackageCacheService) {\n    super();\n  }\n\n  ngOnInit() {\n    if (!this.workPackage) {\n      this.wpCacheService.loadWorkPackage(this.uiRouterGlobals.params['workPackageId'])\n        .values$()\n        .pipe(\n          this.untilDestroyed()\n        )\n        .subscribe((wp:WorkPackageResource) => {\n          this.workPackage = wp;\n        });\n    }\n  }\n}\n","<div *ngIf=\"workPackage\"\n     class=\"work-packages--subject-type-row __overflowing_element_container\"\n     [ngClass]=\"'__overflowing_' + uniqueElementIdentifier\"\n     [attr.data-overflowing-identifier]=\"'.__overflowing_' + uniqueElementIdentifier\">\n  <div class=\"work-packages--type-selector work-packages--subject-element\">\n    <editable-attribute-field [resource]=\"workPackage\"\n                   [wrapperClasses]=\"'work-packages--type-selector work-packages--subject-element -no-label'\"\n                   [fieldName]=\"'type'\">\n    </editable-attribute-field>\n  </div>\n  <div class=\"work-packages--details--subject work-packages--subject-element\">\n    <editable-attribute-field [resource]=\"workPackage\"\n                   [wrapperClasses]=\"'work-packages--details--subject work-packages--subject-element -no-label'\"\n                   [fieldName]=\"'subject'\">\n    </editable-attribute-field>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageCreateComponent} from 'core-components/wp-new/wp-create.component';\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\n\n@Component({\n  selector: 'wp-new-split-view',\n  templateUrl: './wp-new-split-view.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WorkPackageNewSplitViewComponent extends WorkPackageCreateComponent {\n}\n","import {Injectable} from '@angular/core';\nimport {input} from 'reactivestates';\nimport {ChartType} from 'chart.js';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\n\n@Injectable()\nexport class IsolatedGraphQuerySpace extends IsolatedQuerySpace {\n  chartType = input<ChartType>();\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Directive} from '@angular/core';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {OpTableActionsService} from \"core-components/wp-table/table-actions/table-actions.service\";\nimport {WorkPackageViewRelationColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-relation-columns.service\";\nimport {WorkPackageViewPaginationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {WorkPackageViewColumnsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {WorkPackageViewSumService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sum.service\";\nimport {WorkPackageViewAdditionalElementsService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-additional-elements.service\";\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {WorkPackageCreateService} from \"core-components/wp-new/wp-create.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {WorkPackageViewFocusService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {WorkPackageService} from \"core-components/work-packages/work-package.service\";\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {WorkPackageFiltersService} from \"core-components/filters/wp-filters/wp-filters.service\";\nimport {WorkPackageContextMenuHelperService} from \"core-components/wp-table/context-menu-helper/wp-context-menu-helper.service\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WpChildrenInlineCreateService} from \"core-components/wp-relations/embedded/children/wp-children-inline-create.service\";\nimport {WpRelationInlineCreateService} from \"core-components/wp-relations/embedded/relations/wp-relation-inline-create.service\";\nimport {WorkPackagesListChecksumService} from \"core-components/wp-list/wp-list-checksum.service\";\nimport {TableDragActionsRegistryService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-actions-registry.service\";\nimport {IsolatedGraphQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-graph-query-space\";\nimport {WorkPackageIsolatedQuerySpaceDirective} from \"core-app/modules/work_packages/query-space/wp-isolated-query-space.directive\";\nimport {WorkPackageViewHierarchyIdentationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy-indentation.service\";\n\nexport const WpIsolatedGraphQuerySpaceProviders = [\n  // Open the isolated space first, order is important here\n  { provide: IsolatedQuerySpace, useClass: IsolatedGraphQuerySpace },\n  OpTableActionsService,\n\n  // Work package table services\n  WorkPackagesListChecksumService,\n  WorkPackagesListService,\n  WorkPackageViewRelationColumnsService,\n  WorkPackageViewPaginationService,\n  WorkPackageViewGroupByService,\n  WorkPackageViewHierarchiesService,\n  WorkPackageViewSortByService,\n  WorkPackageViewColumnsService,\n  WorkPackageViewFiltersService,\n  WorkPackageViewTimelineService,\n  WorkPackageViewSelectionService,\n  WorkPackageViewSumService,\n  WorkPackageViewAdditionalElementsService,\n  WorkPackageViewFocusService,\n  WorkPackageViewHighlightingService,\n  WorkPackageService,\n  WorkPackageViewHierarchyIdentationService,\n  WorkPackageRelationsHierarchyService,\n  WorkPackageFiltersService,\n  WorkPackageContextMenuHelperService,\n\n  // Provide a separate service for creation events of WP Inline create\n  // This can be hierarchically injected to provide isolated events on an embedded table\n  WorkPackageInlineCreateService,\n  WpChildrenInlineCreateService,\n  WpRelationInlineCreateService,\n\n  HalResourceEditingService,\n  WorkPackageCreateService,\n\n  WorkPackageStatesInitializationService,\n\n  // Table Drag & Drop actions\n  TableDragActionsRegistryService,\n];\n\n\n/**\n * Directive to open a work package query 'space', an isolated injector hierarchy\n * that provides access to query-bound data and services, especially around the querySpace services.\n *\n * If you add services that depend on a table state, they should be provided here, not globally\n * in a module.\n */\n@Directive({\n  selector: '[wp-isolated-graph-query-space]',\n  providers: WpIsolatedGraphQuerySpaceProviders\n})\nexport class WorkPackageIsolatedGraphQuerySpaceDirective extends WorkPackageIsolatedQuerySpaceDirective {\n}\n","import {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {EditFormComponent} from 'core-app/modules/fields/edit/edit-form/edit-form.component';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './form.component.html',\n  selector: 'te-form',\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TimeEntryFormComponent extends UntilDestroyedMixin implements OnInit, OnDestroy {\n  @Input() entry:TimeEntryResource;\n  @Input() showWorkPackageField:boolean = true;\n\n  @Output() modifiedEntry = new EventEmitter<{ savedResource:TimeEntryResource, isInital:boolean }>();\n\n  @ViewChild('editForm', { static: true }) editForm:EditFormComponent;\n\n  text = {\n    attributes: {\n      comment: this.i18n.t('js.time_entry.comment'),\n      hours: this.i18n.t('js.time_entry.hours'),\n      activity: this.i18n.t('js.time_entry.activity'),\n      workPackage: this.i18n.t('js.time_entry.work_package'),\n      spentOn: this.i18n.t('js.time_entry.spent_on'),\n    },\n    wpRequired: this.i18n.t('js.time_entry.work_package_required')\n  };\n\n  public workPackageSelected:boolean = false;\n  public customFields:{ key:string, label:string }[] = [];\n\n  constructor(readonly halEditing:HalResourceEditingService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly i18n:I18nService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.halEditing\n      .temporaryEditResource(this.entry)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(changeset => {\n        if (changeset && changeset.workPackage) {\n          this.workPackageSelected = true;\n          this.cdRef.markForCheck();\n        }\n      });\n\n    this.setCustomFields(this.entry.schema);\n    this.cdRef.detectChanges();\n  }\n\n  public signalModifiedEntry($event:{ savedResource:HalResource, isInital:boolean }) {\n    this.modifiedEntry.emit($event as { savedResource:TimeEntryResource, isInital:boolean });\n  }\n\n  public save() {\n    return this.editForm.submit();\n  }\n\n  public get inEditMode() {\n    // For now, we always want the form in edit mode.\n    // Alternatively, this.entry.isNew can be used.\n    return true;\n  }\n\n  public isRequired(field:string) {\n    // Other than defined in the schema, we consider the work package to be required.\n    // Remove once the schema requires it explicitly.\n    if (field === 'workPackage') {\n      return true;\n    } else {\n      return this.entry.schema[field].required;\n    }\n  }\n\n  private setCustomFields(schema:SchemaResource) {\n    Object.entries(schema).forEach(([key, keySchema]) => {\n      if (key.match(/customField\\d+/)) {\n        this.customFields.push({ key: key, label: keySchema.name });\n      }\n    });\n  }\n}\n","<edit-form\n  #editForm\n  [resource]=\"entry\"\n  [inEditMode]=\"inEditMode\"\n  (onSaved)=\"signalModifiedEntry($event)\">\n  <div class=\"attributes-map\">\n\n    <div class=\"attributes-map--key\"\n               [ngClass]=\"{'-required': isRequired('spentOn')}\"\n               [textContent]=\"text.attributes.spentOn\">\n    </div>\n    <div class=\"attributes-map--value\">\n      <editable-attribute-field [resource]=\"entry\"\n                                [wrapperClasses]=\"'-tiny'\"\n                                [fieldName]=\"'spentOn'\">\n      </editable-attribute-field>\n    </div>\n\n    <div class=\"attributes-map--key\"\n         [ngClass]=\"{'-required': isRequired('hours')}\"\n         [textContent]=\"text.attributes.hours\">\n    </div>\n    <div class=\"attributes-map--value\">\n      <editable-attribute-field [resource]=\"entry\"\n                                [wrapperClasses]=\"'-tiny'\"\n                                [fieldName]=\"'hours'\">\n      </editable-attribute-field>\n    </div>\n\n    <div *ngIf=\"showWorkPackageField\"\n         class=\"attributes-map--key\"\n         [ngClass]=\"{'-required': isRequired('workPackage')}\"\n         [textContent]=\"text.attributes.workPackage\">\n    </div>\n    <div *ngIf=\"showWorkPackageField\"\n         class=\"attributes-map--value\">\n      <editable-attribute-field [resource]=\"entry\"\n                                [fieldName]=\"'workPackage'\">\n      </editable-attribute-field>\n    </div>\n\n    <div class=\"attributes-map--key\"\n         [ngClass]=\"{'-required': isRequired('activity')}\"\n         [textContent]=\"text.attributes.activity\">\n    </div>\n    <div class=\"attributes-map--value\">\n      <editable-attribute-field *ngIf=\"workPackageSelected\"\n                                [resource]=\"entry\"\n                                [fieldName]=\"'activity'\">\n      </editable-attribute-field>\n      <i *ngIf=\"!workPackageSelected\"\n         [textContent]=\"text.wpRequired\">\n      </i>\n    </div>\n\n    <div class=\"attributes-map--key\"\n         [ngClass]=\"{'-required': isRequired('comment')}\"\n         [textContent]=\"text.attributes.comment\">\n    </div>\n    <div class=\"attributes-map--value\">\n      <editable-attribute-field [resource]=\"entry\"\n                                [fieldName]=\"'comment'\">\n      </editable-attribute-field>\n    </div>\n\n    <ng-container *ngFor=\"let cf of customFields\">\n      <div class=\"attributes-map--key\"\n           [ngClass]=\"{'-required': isRequired(cf.key)}\"\n           [textContent]=\"cf.label\">\n      </div>\n      <div class=\"attributes-map--value\">\n        <editable-attribute-field [resource]=\"entry\"\n                                  [fieldName]=\"cf.key\">\n        </editable-attribute-field>\n      </div>\n    </ng-container>\n  </div>\n</edit-form>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {PaginationInstance} from 'core-components/table-pagination/pagination-instance';\n\nexport class WorkPackageViewPagination {\n  public current:PaginationInstance;\n\n  constructor(results:WorkPackageCollectionResource) {\n    this.current = new PaginationInstance(results.offset, results.total, results.pageSize);\n  }\n\n  public get page() {\n    return this.current.page;\n  }\n\n  public set page(val) {\n    this.current.page = val;\n  }\n\n  public get perPage() {\n    return this.current.perPage;\n  }\n\n  public set perPage(val) {\n    this.current.perPage = val;\n  }\n\n  public get total() {\n    return this.current.total;\n  }\n\n  public set total(val) {\n    this.current.total = val;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {PaginationObject} from 'core-app/modules/hal/dm-services/query-dm.service';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {PaginationService} from 'core-components/table-pagination/pagination-service';\nimport {WorkPackageViewPagination} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-pagination\";\nimport {WorkPackageViewBaseService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-base.service\";\n\nexport interface PaginationUpdateObject {\n  page?:number;\n  perPage?:number;\n  total?:number;\n  count?:number;\n}\n\n@Injectable()\nexport class WorkPackageViewPaginationService extends WorkPackageViewBaseService<WorkPackageViewPagination> {\n  public constructor(querySpace:IsolatedQuerySpace,\n                     readonly paginationService:PaginationService) {\n    super(querySpace);\n  }\n\n  public get paginationObject():PaginationObject {\n    if (this.current) {\n      return {\n        pageSize: this.current.perPage,\n        offset: this.current.page\n      };\n    } else {\n      return {\n        pageSize: this.paginationService.getCachedPerPage([]),\n        offset: 1\n      };\n    }\n\n  }\n\n  public valueFromQuery(query:QueryResource, results:WorkPackageCollectionResource) {\n    return new WorkPackageViewPagination(results);\n  }\n\n  public updateFromObject(object:PaginationUpdateObject) {\n    let currentState = this.current;\n\n    if (object.page) {\n      currentState.page = object.page;\n    }\n    if (object.perPage) {\n      currentState.perPage = object.perPage;\n    }\n    if (object.total) {\n      currentState.total = object.total;\n    }\n\n    this.updatesState.putValue(currentState);\n  }\n\n  public updateFromResults(results:WorkPackageCollectionResource) {\n    let update = {\n      page: results.offset,\n      perPage: results.pageSize,\n      total: results.total,\n      count: results.count\n    };\n\n    this.updateFromObject(update);\n  }\n\n  public get current():WorkPackageViewPagination {\n    return this.lastUpdatedState.value!;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from \"@angular/core\";\nimport {HttpClient, HttpEvent, HttpEventType, HttpResponse} from \"@angular/common/http\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Observable} from \"rxjs\";\nimport {filter, map, share} from \"rxjs/operators\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\n\nexport interface UploadFile extends File {\n  description?:string;\n  customName?:string;\n}\n\n\nexport interface UploadBlob extends Blob {\n  description?:string;\n  customName?:string;\n  name?:string;\n}\n\nexport type UploadHttpEvent = HttpEvent<HalResource>;\nexport type UploadInProgress = [UploadFile, Observable<UploadHttpEvent>];\n\nexport interface UploadResult {\n  uploads:UploadInProgress[];\n  finished:Promise<any[]>;\n}\n\nexport interface MappedUploadResult {\n  uploads:UploadInProgress[];\n  finished:Promise<{ response:any, uploadUrl:string }[]>;\n}\n\n@Injectable()\nexport class OpenProjectFileUploadService {\n  constructor(protected http:HttpClient,\n              protected halResource:HalResourceService) {\n  }\n\n  /**\n   * Upload multiple files and return a promise for each uploading file and a single promise for all processed uploads\n   * with their accessible URLs returned.\n   * @param {string} url\n   * @param {UploadFile[]} files\n   * @param {string} method\n   * @returns {Promise<{response:HalResource; uploadUrl:any}[]>}\n   */\n  public uploadAndMapResponse(url:string, files:UploadFile[], method:string = 'post') {\n    const { uploads, finished } = this.upload(url, files);\n    const mapped = finished\n      .then((result:HalResource[]) => result.map((el:HalResource) => {\n          return { response: el, uploadUrl: el.staticDownloadLocation.href };\n      })) as Promise<{ response:HalResource, uploadUrl:string }[]>;\n\n    return { uploads: uploads, finished: mapped } as MappedUploadResult;\n  }\n\n  /**\n   * Upload multiple files and return a promise for each uploading file and a single promise for all processed uploads\n   * Ignore directories.\n   */\n  public upload(url:string, files:UploadFile[], method:string = 'post'):UploadResult {\n    files = _.filter(files, (file:UploadFile) => file.type !== 'directory');\n    const uploads:UploadInProgress[] = _.map(files, (file:UploadFile) => this.uploadSingle(url, file, method));\n\n    const finished = this.whenFinished(uploads);\n    return {uploads, finished} as UploadResult;\n  }\n\n  /**\n   * Upload a single file, get an UploadResult observable\n   * @param {string} url\n   * @param {UploadFile} file\n   * @param {string} method\n   */\n  public uploadSingle(url:string, file:UploadFile|UploadBlob, method:string = 'post', responseType:'text'|'json' = 'json') {\n    const formData = new FormData();\n    const metadata = {\n      description: file.description,\n      fileName: file.customName || file.name\n    };\n\n    // add the metadata object\n    formData.append(\n      'metadata',\n      JSON.stringify(metadata),\n    );\n\n    // Add the file\n    formData.append('file', file, metadata.fileName);\n\n    const observable = this\n      .http\n      .request<HalResource>(\n        method,\n        url,\n        {\n          body: formData,\n          // Observe the response, not the body\n          observe: 'events',\n          withCredentials: true,\n          responseType: responseType as any,\n          // Subscribe to progress events. subscribe() will fire multiple times!\n          reportProgress: true\n        }\n      )\n      .pipe(\n        share()\n      );\n\n    return [file, observable] as UploadInProgress;\n  }\n\n  /**\n   * Create a promise for all uploaded responses when all uploads are fully uploaded.\n   *\n   * @param {UploadInProgress[]} uploads\n   */\n  private whenFinished(uploads:UploadInProgress[]):Promise<HalResource[]> {\n    const promises = uploads.map(([_, observable]) => {\n      return observable\n        .pipe(\n          filter((evt) => evt.type === HttpEventType.Response),\n          map((evt:HttpResponse<HalResource>) => this.halResource.createHalResource(evt.body))\n        )\n        .toPromise();\n    });\n\n    return Promise.all(promises);\n  }\n}\n","<div class=\"work-packages-partitioned-query-space--container\"\n      [ngClass]=\"currentPartition\">\n  <div class=\"toolbar-container -editable\">\n    <div class=\"toolbar\">\n      <back-button *ngIf=\"backButtonCallback\"\n                   linkClass=\"back-button\"\n                   [customBackMethod]=\"backButtonCallback\">\n      </back-button>\n\n      <editable-toolbar-title [title]=\"selectedTitle\"\n                              [inFlight]=\"toolbarDisabled\"\n                              [showSaveCondition]=\"showToolbarSaveButton\"\n                              (onSave)=\"changeChangesFromTitle($event)\"\n                              (onEmptySubmit)=\"updateTitleName('')\"\n                              [editable]=\"titleEditingEnabled\">\n      </editable-toolbar-title>\n\n      <ul class=\"toolbar-items hide-when-print\"\n          *ngIf=\"showToolbar\">\n\n        <ng-container *ngFor=\"let definition of toolbarButtonComponents\">\n          <li class=\"toolbar-item\"\n              *ngIf=\"!definition.show || definition.show()\"\n              [ngClass]=\"definition.containerClasses\">\n            <ndc-dynamic [ndcDynamicComponent]=\"definition.component\"\n                         [ndcDynamicInputs]=\"definition.inputs\"\n                         [ndcDynamicInjector]=\"injector\"\n                         [ndcDynamicOutputs]=\"definition.outputs\">\n            </ndc-dynamic>\n          </li>\n        </ng-container>\n      </ul>\n    </div>\n  </div>\n\n  <div class=\"work-packages-partitioned-query-space--filter-area\">\n    <ndc-dynamic [ndcDynamicComponent]=\"filterContainerDefinition.component\"\n                 [ndcDynamicInputs]=\"filterContainerDefinition.inputs\"\n                 [ndcDynamicOutputs]=\"filterContainerDefinition.outputs\"\n                 [ndcDynamicInjector]=\"injector\">\n    </ndc-dynamic>\n  </div>\n\n  <div class=\"work-packages-partitioned-page--content-container\">\n    <!-- Left content view -->\n    <div class=\"work-packages-partitioned-page--content-left loading-indicator--location\"\n         data-indicator-name=\"table\"\n         ui-view=\"content-left\">\n    </div>\n\n    <!-- Right content view -->\n    <div class=\"work-packages-partitioned-page--content-right\"\n         ui-view=\"content-right\"></div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component, OnDestroy, OnInit} from \"@angular/core\";\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {OpTitleService} from \"core-components/html/op-title.service\";\nimport {WorkPackagesViewBase} from \"core-app/modules/work_packages/routing/wp-view-base/work-packages-view.base\";\nimport {take} from \"rxjs/operators\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {QueryParamListenerService} from \"core-components/wp-query/query-param-listener.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {ComponentType} from \"@angular/cdk/overlay\";\nimport {Ng2StateDeclaration} from \"@uirouter/angular\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageFilterContainerComponent} from \"core-components/filters/filter-container/filter-container.directive\";\n\nexport interface DynamicComponentDefinition {\n  component:ComponentType<any>;\n  inputs?:{ [inputName:string]:any };\n  outputs?:{ [outputName:string]:Function };\n}\n\nexport interface ToolbarButtonComponentDefinition extends DynamicComponentDefinition {\n  containerClasses?:string;\n  show?:() => boolean;\n}\n\nexport type ViewPartitionState = '-split'|'-left-only'|'-right-only';\n\n@Component({\n  selector: 'partitioned-query-space-page',\n  templateUrl: './partitioned-query-space-page.component.html',\n  styleUrls: ['./partitioned-query-space-page.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    /** We need to provide the wpNotification service here to get correct save notifications for WP resources */\n    { provide: HalResourceNotificationService, useClass: WorkPackageNotificationService },\n    QueryParamListenerService\n  ]\n})\nexport class PartitionedQuerySpacePageComponent extends WorkPackagesViewBase implements OnInit, OnDestroy {\n  @InjectField() I18n:I18nService;\n  @InjectField() titleService:OpTitleService;\n  @InjectField() queryParamListener:QueryParamListenerService;\n\n  text:{ [key:string]:string } = {\n    'jump_to_pagination': this.I18n.t('js.work_packages.jump_marks.pagination'),\n    'text_jump_to_pagination': this.I18n.t('js.work_packages.jump_marks.label_pagination'),\n  };\n\n  /** Whether the title can be edited */\n  titleEditingEnabled:boolean;\n\n  /** Current query title to render */\n  selectedTitle?:string;\n  currentQuery:QueryResource|undefined;\n\n  /** Whether we're saving the query */\n  toolbarDisabled:boolean;\n\n  /** Do we currently have query props ? */\n  showToolbarSaveButton:boolean;\n\n  /** Listener callbacks */\n  unRegisterTitleListener:Function;\n  removeTransitionSubscription:Function;\n\n  /** Determine when query is initially loaded */\n  showToolbar = false;\n\n  /** The toolbar buttons to render */\n  toolbarButtonComponents:ToolbarButtonComponentDefinition[] = [];\n\n  /** Whether filtering is allowed */\n  filterAllowed:boolean = true;\n\n  /** We need to pass the correct partition state to the view to manage the grid */\n  currentPartition:ViewPartitionState = '-split';\n\n  /** What route (if any) should we go back to using the back button left of the title? */\n  backButtonCallback:Function|undefined;\n\n  /** Which filter container component to mount */\n  filterContainerDefinition:DynamicComponentDefinition = {\n    component: WorkPackageFilterContainerComponent\n  };\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.showToolbarSaveButton = !!this.$state.params.query_props;\n    this.setPartition(this.$state.current);\n    this.removeTransitionSubscription = this.$transitions.onSuccess({}, (transition):any => {\n      const params = transition.params('to');\n      const toState = transition.to();\n      this.showToolbarSaveButton = !!params.query_props;\n      this.setPartition(toState);\n      this.cdRef.detectChanges();\n    });\n\n    // If the query was loaded, reload invisibly\n    const isFirstLoad = !this.querySpace.initialized.hasValue();\n    this.refresh(isFirstLoad, isFirstLoad);\n\n    // Mark tableInformationLoaded when initially loading done\n    this.setupInformationLoadedListener();\n\n    // Load query on URL transitions\n    this.queryParamListener\n      .observe$\n      .pipe(\n        this.untilDestroyed()\n      ).subscribe(() => {\n      /** Ensure we reload the query from the changed props */\n      this.currentQuery = undefined;\n      this.refresh(true, true);\n    });\n\n    // Update title on entering this state\n    this.unRegisterTitleListener = this.$transitions.onSuccess({}, () => {\n      this.updateTitle(this.querySpace.query.value);\n    });\n\n    this.querySpace.query.values$().pipe(\n      this.untilDestroyed()\n    ).subscribe((query) => {\n      this.onQueryUpdated(query);\n    });\n  }\n\n  /**\n   * We need to set the current partition to the grid to ensure\n   * either side gets expanded to full width if we're not in '-split' mode.\n   *\n   * @param state The current or entering state\n   */\n  protected setPartition(state:Ng2StateDeclaration) {\n    this.currentPartition = (state.data && state.data.partition) ? state.data.partition : '-split';\n  }\n\n  protected setupInformationLoadedListener() {\n    this\n      .querySpace\n      .initialized\n      .values$()\n      .pipe(take(1))\n      .subscribe(() => {\n        this.showToolbar = true;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  protected onQueryUpdated(query:QueryResource) {\n    // Update the title whenever the query changes\n    this.updateTitle(query);\n    this.currentQuery = query;\n\n    this.cdRef.detectChanges();\n  }\n\n  ngOnDestroy():void {\n    super.ngOnDestroy();\n    this.unRegisterTitleListener();\n    this.removeTransitionSubscription();\n    this.queryParamListener.removeQueryChangeListener();\n  }\n\n  public changeChangesFromTitle(val:string) {\n    if (this.currentQuery && this.currentQuery.persisted) {\n      this.updateTitleName(val);\n    } else {\n      this.wpListService\n        .create(this.currentQuery!, val)\n        .then(() => this.toolbarDisabled = false)\n        .catch(() => this.toolbarDisabled = false);\n    }\n  }\n\n  updateTitleName(val:string) {\n    this.toolbarDisabled = true;\n    this.currentQuery!.name = val;\n    this.wpListService.save(this.currentQuery)\n      .then(() => this.toolbarDisabled = false)\n      .catch(() => this.toolbarDisabled = false);\n  }\n\n  updateTitle(query?:QueryResource) {\n\n    // Too early for loaded query\n    if (!query) {\n      return;\n    }\n\n\n    if (query.persisted) {\n      this.selectedTitle = query.name;\n    } else {\n      this.selectedTitle = this.wpStaticQueries.getStaticName(query);\n    }\n\n    this.titleEditingEnabled = this.authorisationService.can('query', 'updateImmediately');\n\n    // Update the title if we're in the list state alone\n    if (this.shouldUpdateHtmlTitle()) {\n      this.titleService.setFirstPart(this.selectedTitle);\n    }\n  }\n\n  refresh(visibly:boolean = false, firstPage:boolean = false):Promise<unknown> {\n    let promise:Promise<unknown>;\n\n    if (firstPage) {\n      promise = this.loadFirstPage();\n    } else {\n      promise = this.wpListService.reloadCurrentResultsList();\n    }\n\n    if (visibly) {\n      this.loadingIndicator = promise.then(() => {\n        return this.additionalLoadingTime();\n      });\n    }\n\n    return promise;\n  }\n\n  protected loadFirstPage():Promise<QueryResource> {\n    if (this.currentQuery) {\n      return this.wpListService.reloadQuery(this.currentQuery, this.projectIdentifier).toPromise();\n    } else {\n      return this.wpListService.loadCurrentQueryFromParams(this.projectIdentifier);\n    }\n  }\n\n  protected additionalLoadingTime():Promise<unknown> {\n    return Promise.resolve();\n  }\n\n  protected set loadingIndicator(promise:Promise<unknown>) {\n    this.loadingIndicatorService.table.promise = promise;\n  }\n\n  protected shouldUpdateHtmlTitle():boolean {\n    return true;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {Component, Input, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'filter-integer-value',\n  templateUrl: './filter-integer-value.component.html'\n})\nexport class FilterIntegerValueComponent extends UntilDestroyedMixin {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new DebouncedEventEmitter<QueryFilterInstanceResource>(componentDestroyed(this));\n\n  constructor(readonly I18n:I18nService) {\n    super();\n  }\n\n  public get value() {\n    return parseInt(this.filter.values[0] as string);\n  }\n\n  public set value(val) {\n    if (typeof (val) === 'number') {\n      this.filter.values = [val.toString()];\n    } else {\n      this.filter.values = [];\n    }\n\n    this.filterChanged.emit(this.filter);\n  }\n\n  public get unit() {\n    switch ((this.filter.schema.filter.allowedValues as QueryFilterResource[])[0].id) {\n      case 'startDate':\n      case 'dueDate':\n      case 'updatedAt':\n      case 'createdAt':\n        return this.I18n.t('js.work_packages.time_relative.days');\n      default:\n        return '';\n    }\n  }\n}\n","<div id=\"div-values-{{filter.id}}\" class=\"inline-label\">\n  <input [(ngModel)]=\"value\"\n         [focus]=\"shouldFocus\"\n         required\n         class=\"advanced-filters--number-field\"\n         id=\"values-{{filter.id}}\"\n         name=\"v[{{filter.id}}]\"\n         min=\"0\"\n         type=\"number\" />\n  <label for=\"values-{{filter.id}}\"\n         [textContent]=\"unit\"\n         class=\"advanced-filters--affix\">\n  </label>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  Input,\n  OnInit\n} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {distinctUntilChanged, map} from 'rxjs/operators';\nimport {debugLog} from '../../../helpers/debug_output';\nimport {CurrentProjectService} from '../../projects/current-project.service';\nimport {States} from '../../states.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageCacheService} from '../work-package-cache.service';\nimport {DisplayFieldService} from 'core-app/modules/fields/display/display-field.service';\nimport {DisplayField} from 'core-app/modules/fields/display/display-field.module';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {HookService} from 'core-app/modules/plugins/hook-service';\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {Subject} from \"rxjs\";\nimport {randomString} from \"core-app/helpers/random-string\";\nimport {BrowserDetector} from \"core-app/modules/common/browser/browser-detector.service\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport interface FieldDescriptor {\n  name:string;\n  label:string;\n  field?:DisplayField;\n  fields?:DisplayField[];\n  spanAll:boolean;\n  multiple:boolean;\n}\n\nexport interface GroupDescriptor {\n  name:string;\n  id:string;\n  members:FieldDescriptor[];\n  query?:QueryResource;\n  relationType?:string;\n  isolated:boolean;\n  type:string;\n}\n\nexport interface ResourceContextChange {\n  isNew:boolean;\n  schema:string|null;\n  project:string|null;\n}\n\nexport const overflowingContainerAttribute = 'overflowingIdentifier';\n\n@Component({\n  templateUrl: './wp-single-view.html',\n  selector: 'wp-single-view',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkPackageSingleViewComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n\n  /** Should we show the project field */\n  @Input() public showProject:boolean = false;\n\n  // Grouped fields returned from API\n  public groupedFields:GroupDescriptor[] = [];\n\n  // State updated when structural changes to the single view may occur.\n  // (e.g., when changing the type or project context).\n  public resourceContextChange = new Subject<ResourceContextChange>();\n\n  // Project context as an indicator\n  // when editing the work package in a different project\n  public projectContext:{\n    matches:boolean,\n    href:string|null,\n    field?:FieldDescriptor[]\n  };\n  public text = {\n    attachments: {\n      label: this.I18n.t('js.label_attachments')\n    },\n    project: {\n      required: this.I18n.t('js.project.required_outside_context'),\n      context: this.I18n.t('js.project.context'),\n      switchTo: this.I18n.t('js.project.click_to_switch_context'),\n    },\n\n    fields: {\n      description: this.I18n.t('js.work_packages.properties.description'),\n    },\n    infoRow: {\n      createdBy: this.I18n.t('js.label_created_by'),\n      lastUpdatedOn: this.I18n.t('js.label_last_updated_on')\n    },\n  };\n\n  protected firstTimeFocused:boolean = false;\n\n  $element:JQuery;\n\n  constructor(readonly I18n:I18nService,\n              protected currentProject:CurrentProjectService,\n              protected PathHelper:PathHelperService,\n              protected states:States,\n              protected halEditing:HalResourceEditingService,\n              protected halResourceService:HalResourceService,\n              protected displayFieldService:DisplayFieldService,\n              protected wpCacheService:WorkPackageCacheService,\n              protected hook:HookService,\n              protected injector:Injector,\n              protected cdRef:ChangeDetectorRef,\n              readonly elementRef:ElementRef,\n              readonly browserDetector:BrowserDetector) {\n    super();\n  }\n\n  public ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    const change = this.halEditing.changeFor<WorkPackageResource, WorkPackageChangeset>(this.workPackage);\n    this.resourceContextChange.next(this.contextFrom(change.projectedResource));\n    this.refresh(change);\n\n    // Whenever the resource context changes in any way,\n    // update the visible fields.\n    this.resourceContextChange\n      .pipe(\n        this.untilDestroyed(),\n        distinctUntilChanged<ResourceContextChange>((a, b) => _.isEqual(a, b)),\n        map(() => this.halEditing.changeFor(this.workPackage))\n      )\n      .subscribe((change:WorkPackageChangeset) => this.refresh(change));\n\n    // Update the resource context on every update to the temporary resource.\n    // This allows detecting a changed type value in a new work package.\n    this.halEditing\n      .temporaryEditResource(this.workPackage)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(resource => {\n        this.resourceContextChange.next(this.contextFrom(resource));\n      });\n  }\n\n  private refresh(change:WorkPackageChangeset) {\n    // Prepare the fields that are required always\n    const isNew = this.workPackage.isNew;\n    const resource = change.projectedResource;\n\n    if (!resource.project) {\n      this.projectContext = { matches: false, href: null };\n    } else {\n      this.projectContext = {\n        href: this.PathHelper.projectWorkPackagePath(resource.project.idFromLink, this.workPackage.id!),\n        matches: resource.project.href === this.currentProject.apiv3Path\n      };\n    }\n\n    if (isNew && !this.currentProject.inProjectContext) {\n      this.projectContext.field = this.getFields(resource, ['project']);\n    }\n\n    const attributeGroups = resource.schema._attributeGroups;\n    this.groupedFields = this.rebuildGroupedFields(resource, attributeGroups);\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Returns whether a group should be hidden due to being empty\n   * (e.g., consists only of CFs and none of them are active in this project.\n   */\n  public shouldHideGroup(group:GroupDescriptor) {\n    // Hide if the group is empty\n    const isEmpty = group.members.length === 0;\n\n    // Is a query in a new screen\n    const queryInNew = this.workPackage.isNew && !!group.query;\n\n    return isEmpty || queryInNew;\n  }\n\n  /**\n   * angular 2 doesn't support track by property any more but requires a custom function\n   * https://github.com/angular/angular/issues/12969\n   * @param index\n   * @param elem\n   */\n  public trackByName(_index:number, elem:{ name:string }) {\n    return elem.name;\n  }\n\n  /**\n   * Allow other modules to register groups to insert into the single view\n   */\n  public prependedAttributeGroupComponents() {\n    return this.hook.call('prependedAttributeGroups', this.workPackage);\n  }\n\n  public attributeGroupComponent(group:GroupDescriptor) {\n    // we take the last registered group component which means that\n    // plugins will have their say if they register for it.\n    return this.hook.call('attributeGroupComponent', group, this.workPackage).pop() || null;\n  }\n\n  public attachmentListComponent() {\n    // we take the last registered group component which means that\n    // plugins will have their say if they register for it.\n    return this.hook.call('workPackageAttachmentListComponent', this.workPackage).pop() || null;\n  }\n\n  public attachmentUploadComponent() {\n    // we take the last registered group component which means that\n    // plugins will have their say if they register for it.\n    return this.hook.call('workPackageAttachmentUploadComponent', this.workPackage).pop() || null;\n  }\n\n  /*\n   * Returns the work package label\n   */\n  public get idLabel() {\n    return `#${this.workPackage.id}`;\n  }\n\n  public get projectContextText():string {\n    let id = this.workPackage.project.idFromLink;\n    let projectPath = this.PathHelper.projectPath(id);\n    let project = `<a href=\"${projectPath}\">${this.workPackage.project.name}<a>`;\n    return this.I18n.t('js.project.work_package_belongs_to', { projectname: project });\n  }\n\n  /*\n   * Show two column layout for new WP per default, but disable in MS Edge (#29941)\n   */\n  public get enableTwoColumnLayout() {\n    return this.workPackage.isNew && !this.browserDetector.isEdge;\n  }\n\n  /**\n   *\n   * @param attributeGroups\n   * @returns {any}\n   */\n  private rebuildGroupedFields(resource:WorkPackageResource, attributeGroups:any) {\n    if (!attributeGroups) {\n      return [];\n    }\n\n    return attributeGroups.map((group:any) => {\n      let groupId = this.getAttributesGroupId(group);\n\n      if (group._type === 'WorkPackageFormAttributeGroup') {\n        return {\n          name: group.name,\n          id: groupId || randomString(16),\n          members: this.getFields(resource, group.attributes),\n          type: group._type,\n          isolated: false\n        };\n      } else {\n        return {\n          name: group.name,\n          id: groupId || randomString(16),\n          query: this.halResourceService.createHalResourceOfClass(QueryResource, group._embedded.query),\n          relationType: group.relationType,\n          members: [group._embedded.query],\n          type: group._type,\n          isolated: true\n        };\n      }\n    });\n  }\n\n  /**\n   * Maps the grouped fields into their display fields.\n   * May return multiple fields (for the date virtual field).\n   */\n  private getFields(resource:WorkPackageResource, fieldNames:string[]):FieldDescriptor[] {\n    const descriptors:FieldDescriptor[] = [];\n\n    fieldNames.forEach((fieldName:string) => {\n      if (fieldName === 'date') {\n        descriptors.push(this.getDateField(resource));\n        return;\n      }\n\n      if (!resource.schema[fieldName]) {\n        debugLog('Unknown field for current schema', fieldName);\n        return;\n      }\n\n      const field:DisplayField = this.displayField(resource, fieldName);\n      descriptors.push({\n        name: fieldName,\n        label: field.label,\n        multiple: false,\n        spanAll: field.isFormattable,\n        field: field\n      });\n    });\n\n    return descriptors;\n  }\n\n  /**\n   * We need to discern between milestones, which have a single\n   * 'date' field vs. all other types which should display a\n   * combined 'start' and 'due' date field.\n   */\n  private getDateField(resource:WorkPackageResource):FieldDescriptor {\n    let object:any = {\n      label: this.I18n.t('js.work_packages.properties.date'),\n      multiple: false\n    };\n\n    if (resource.schema.hasOwnProperty('date')) {\n      object.field = this.displayField(resource, 'date');\n      object.name = 'date';\n    } else {\n      object.field = this.displayField(resource, 'startDate');\n      object.name = 'startDate';\n    }\n\n    return object;\n  }\n\n  /**\n   * Get the current resource context change from the WP resource.\n   * Used to identify changes in the schema or project that may result in visual changes\n   * to the single view.\n   *\n   * @param {WorkPackage} workPackage\n   * @returns {SchemaContext}\n   */\n  private contextFrom(workPackage:WorkPackageResource):ResourceContextChange {\n    let schema = workPackage.schema;\n\n    let schemaHref:string|null = null;\n    let projectHref:string|null = workPackage.project && workPackage.project.href;\n\n    if (schema.baseSchema) {\n      schemaHref = schema.baseSchema.href;\n    } else {\n      schemaHref = schema.href;\n    }\n\n\n    return {\n      isNew: workPackage.isNew,\n      schema: schemaHref,\n      project: projectHref\n    };\n  }\n\n  private displayField(resource:WorkPackageResource, name:string):DisplayField {\n    return this.displayFieldService.getField(\n      resource,\n      name,\n      resource.schema[name],\n      { container: 'single-view', injector: this.injector, options: {} }\n    ) as DisplayField;\n  }\n\n  private getAttributesGroupId(group:any):string {\n    let overflowingIdentifier = this.$element\n      .find(\"[data-group-name=\\'\" + group.name + \"\\']\")\n      .data(overflowingContainerAttribute);\n\n    if (overflowingIdentifier) {\n      return overflowingIdentifier.replace('.__overflowing_', '');\n    } else {\n      return '';\n    }\n  }\n}\n","<div *ngIf=\"workPackage\"\n     class=\"work-package--single-view\"\n     [ngClass]=\"{'-can-have-columns' : enableTwoColumnLayout }\">\n  <div class=\"wp-new--subject-wrapper\"\n       *ngIf=\"workPackage.isNew\">\n    <editable-attribute-field [resource]=\"workPackage\"\n                   [wrapperClasses]=\"'-no-label'\"\n                   [fieldName]=\"'subject'\"></editable-attribute-field>\n  </div>\n\n  <div class=\"wp-info-wrapper\">\n    <wp-status-button *ngIf=\"!workPackage.isNew\"\n                      [workPackage]=\"workPackage\">\n    </wp-status-button>\n    <attribute-help-text [attribute]=\"'status'\"\n                         [attributeScope]=\"'WorkPackage'\"\n                         *ngIf=\"!workPackage.isNew\"></attribute-help-text>\n\n    <div class=\"work-packages--info-row\"\n         *ngIf=\"!workPackage.isNew\">\n      <span [textContent]=\"idLabel\"></span>:\n      <span [textContent]=\"text.infoRow.createdBy\"></span>\n      <!-- The space has to be in an extra span\n      because otherwise the browser would add a second space after it -->\n      <span>&nbsp;</span>\n      <user-link class=\"user-link\"\n                 [user]=\"workPackage.author\"></user-link>.\n      <span [textContent]=\"text.infoRow.lastUpdatedOn\"></span>\n      <span>&nbsp;</span>\n      <op-date-time [dateTimeValue]=\"workPackage.updatedAt\"></op-date-time>.\n     </div>\n\n    <wp-custom-actions [workPackage]=\"workPackage\" class=\"custom-actions\"></wp-custom-actions>\n  </div>\n\n  <div class=\"attributes-group -project-context __overflowing_element_container __overflowing_project_context\"\n       *ngIf=\"projectContext && projectContext.field\"\n       data-overflowing-identifier=\".__overflowing_project_context\">\n    <div>\n      <p class=\"wp-project-context--warning\" [textContent]=\"text.project.required\"></p>\n      <div class=\"attributes-key-value\"\n           [ngClass]=\"{'-span-all-columns': descriptor.spanAll }\"\n           *ngFor=\"let descriptor of projectContext.field; trackBy:trackByName\">\n        <div class=\"attributes-key-value--key\">\n          <wp-replacement-label [fieldName]=\"descriptor.name\">\n            {{ descriptor.label }}\n            <span class=\"required\"\n                  *ngIf=\"descriptor.field.required && descriptor.field.writable\">*</span>\n          </wp-replacement-label>\n          <attribute-help-text [attribute]=\"descriptor.name\"\n                               [attributeScope]=\"'WorkPackage'\"></attribute-help-text>\n        </div>\n        <div class=\"attributes-key-value--value-container\">\n          <editable-attribute-field [resource]=\"workPackage\"\n                         [fieldName]=\"descriptor.name\"></editable-attribute-field>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"attributes-group -project-context hide-when-print\" *ngIf=\"!workPackage.isNew && projectContext && !projectContext.matches\">\n    <div>\n      <p>\n        <span [innerHTML]=\"projectContextText\"></span>\n        <br/>\n        <a [attr.href]=\"projectContext.href\"\n           class=\"project-context--switch-link\"\n           [textContent]=\"text.project.switchTo\">\n        </a>\n      </p>\n    </div>\n  </div>\n\n  <ng-container *ngFor=\"let component of prependedAttributeGroupComponents()\">\n    <ndc-dynamic [ndcDynamicComponent]=\"component\"\n                 [ndcDynamicInputs]=\"{ workPackage: workPackage }\">\n    </ndc-dynamic>\n  </ng-container>\n\n  <div class=\"attributes-group description-group\">\n    <div class=\"attributes-group--header\">\n      <div class=\"attributes-group--header-container\">\n        <h3 class=\"attributes-group--header-text\"\n            [textContent]=\"text.fields.description\"></h3>\n      </div>\n    </div>\n    <div class=\"single-attribute work-packages--details--description\">\n      <editable-attribute-field [fieldName]=\"'description'\"\n                     [resource]=\"workPackage\"\n                     [isDropTarget]=\"true\"\n                     [wrapperClasses]=\"'-no-label'\">\n      </editable-attribute-field>\n    </div>\n  </div>\n\n  <div *ngFor=\"let group of groupedFields; trackBy:trackByName\"\n       [hidden]=\"shouldHideGroup(group)\"\n       [attr.data-group-name]=\"group.name\"\n       [ngClass]=\"'__overflowing_' + group.id\"\n       [attr.data-overflowing-identifier]=\"'.__overflowing_' + group.id\"\n       class=\"attributes-group __overflowing_element_container\">\n\n    <ng-container wp-isolated-query-space *ngIf=\"group.isolated\">\n      <ndc-dynamic [ndcDynamicComponent]=\"attributeGroupComponent(group)\"\n                   [ndcDynamicInputs]=\"{ workPackage: workPackage,\n                                         group: group,\n                                         query: group.query }\" >\n      </ndc-dynamic>\n    </ng-container>\n\n    <ng-container *ngIf=\"!group.isolated\">\n      <div class=\"attributes-group--header\">\n        <div class=\"attributes-group--header-container\">\n          <h3 class=\"attributes-group--header-text\"\n              [textContent]=\"group.name\"></h3>\n        </div>\n      </div>\n\n      <ndc-dynamic [ndcDynamicComponent]=\"attributeGroupComponent(group)\"\n                   [ndcDynamicInjector]=\"injector\"\n                   [ndcDynamicInputs]=\"{ workPackage: workPackage, group: group }\">\n      </ndc-dynamic>\n    </ng-container>\n  </div>\n</div>\n\n<div class=\"work-packages--attachments attributes-group\">\n  <div class=\"work-packages--attachments-container\">\n    <div class=\"attributes-group--header\">\n      <div class=\"attributes-group--header-container\">\n        <h3 class=\"attributes-group--header-text\" [textContent]=\"text.attachments.label\"></h3>\n      </div>\n    </div>\n\n    <ndc-dynamic [ndcDynamicComponent]=\"attachmentListComponent()\"\n                 [ndcDynamicInputs]=\"{ resource: workPackage }\">\n    </ndc-dynamic>\n\n    <ndc-dynamic [ndcDynamicComponent]=\"attachmentUploadComponent()\"\n                 [ndcDynamicInputs]=\"{ resource: workPackage }\"\n                 *ngIf=\"workPackage.canAddAttachments\">\n    </ndc-dynamic>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {HighlightableDisplayField} from \"core-app/modules/fields/display/field-types/highlightable-display-field.module\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class DateDisplayField extends HighlightableDisplayField {\n  @InjectField() timezoneService:TimezoneService;\n\n  public render(element:HTMLElement, displayText:string):void {\n    super.render(element, displayText);\n\n    // Show scheduling mode in front of the start date field\n    if (this.showSchedulingMode()) {\n      const schedulingIcon = document.createElement('span');\n      schedulingIcon.classList.add('icon-context');\n      schedulingIcon.classList.add(this.resource.scheduleManually ? 'icon-pin' : 'icon-arrow-left-right');\n\n      element.prepend(schedulingIcon);\n    }\n\n    // Highlight overdue tasks\n    if (this.shouldHighlight && this.canOverdue) {\n      const diff = this.timezoneService.daysFromToday(this.value);\n      element.classList.add(Highlighting.overdueDate(diff));\n    }\n  }\n\n  public get canOverdue():boolean {\n    return ['dueDate', 'date'].indexOf(this.name) !== -1;\n  }\n\n  public get valueString() {\n    if (this.value) {\n      return this.timezoneService.formattedDate(this.value);\n    } else {\n      return '';\n    }\n  }\n\n  private showSchedulingMode():boolean {\n    return this.name === 'startDate' || this.name === 'date';\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport 'hammerjs';\n\n// Global scripts previously part of the application.js\n// Avoid require.context since that crashes angular regularly\nrequire('./globals/augmenting/modal-wrapper.augment.service');\nrequire('./globals/dynamic-bootstrapper');\nrequire('./globals/global-listeners');\nrequire('./globals/openproject');\nrequire('./globals/tree-menu');\n","import {Inject, Injectable} from \"@angular/core\";\nimport {DOCUMENT} from \"@angular/common\";\n\n@Injectable({ providedIn: 'root' })\nexport class BrowserDetector {\n\n  constructor (@Inject(DOCUMENT) private documentElement:Document) {\n  }\n\n  /**\n   * Detect mobile browser based on the Rails determined UA\n   * and resulting body class.\n   */\n  public get isMobile() {\n    return this.hasBodyClass('-browser-mobile');\n  }\n\n  /**\n   * ToDo: Remove all occurences once Edge on Chromium is released\n   */\n  public get isEdge() {\n    return this.hasBodyClass('-browser-edge');\n  }\n\n  private hasBodyClass(name:string):boolean {\n    return this.documentElement.body.classList.contains(name);\n  }\n\n}\n","import {Component, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {WorkPackageFiltersService} from 'core-components/filters/wp-filters/wp-filters.service';\nimport {WorkPackageViewFiltersService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service';\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\n\n@Component({\n  templateUrl: './filters-tab.component.html',\n  selector: 'wp-table-config-filters-tab'\n})\nexport class WpTableConfigurationFiltersTab implements TabComponent {\n\n  public filters:QueryFilterInstanceResource[] = [];\n  public eeShowBanners:boolean = false;\n\n  public text = {\n    columnsLabel: this.I18n.t('js.label_columns'),\n    selectedColumns: this.I18n.t('js.description_selected_columns'),\n    multiSelectLabel: this.I18n.t('js.work_packages.label_column_multiselect'),\n\n    upsaleRelationColumns: this.I18n.t('js.modals.upsale_relation_columns'),\n    upsaleRelationColumnsLink: this.I18n.t('js.modals.upsale_relation_columns_link')\n  };\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly wpFiltersService:WorkPackageFiltersService,\n              readonly bannerService:BannersService) {\n  }\n\n  ngOnInit() {\n    this.eeShowBanners = this.bannerService.eeShowBanners;\n    this.wpTableFilters\n      .onReady()\n      .then(() => this.filters = this.wpTableFilters.current);\n  }\n\n  public onSave() {\n    if (this.filters) {\n      this.wpTableFilters.replaceIfComplete(this.filters);\n    }\n  }\n}\n","<query-filters *ngIf=\"!!filters\"\n               (filtersChanged)=\"filters = $event\"\n               [filters]=\"filters\"></query-filters>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {\n  INotification,\n  NotificationsService,\n  NotificationType\n} from 'core-app/modules/common/notifications/notifications.service';\n\n@Component({\n  templateUrl: './notification.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'notification'\n})\nexport class NotificationComponent implements OnInit {\n  @Input() public notification:INotification;\n\n  public text = {\n    close_popup: this.I18n.t('js.close_popup_title'),\n  };\n\n  public type:NotificationType;\n  public uploadCount = 0;\n  public show = false;\n\n  constructor(readonly I18n:I18nService,\n              readonly notificationsService:NotificationsService) {\n  }\n\n  ngOnInit() {\n    this.type = this.notification.type;\n  }\n\n  public get data() {\n    return this.notification.data;\n  }\n\n  public canBeHidden() {\n    return this.data && this.data.length > 5;\n  }\n\n  public removable() {\n    return this.notification.type !== 'upload';\n  }\n\n  public remove() {\n    this.notificationsService.remove(this.notification);\n  }\n\n  /**\n   * Execute the link callback from content.link.target\n   * and close this notification.\n   */\n  public executeTarget() {\n    if (this.notification.link) {\n      this.notification.link.target();\n      this.remove();\n    }\n  }\n\n  public onUploadError(message:string) {\n    this.remove();\n  }\n\n  public onUploadSuccess() {\n    this.uploadCount += 1;\n  }\n\n  public get uploadText() {\n    return this.I18n.t('js.label_upload_counter',\n      { done: this.uploadCount, count: this.data.length});\n  }\n}\n","<div class=\"notification-box -{{ type }}\" tabindex=\"0\">\n  <div class=\"notification-box--content\" role=\"alert\" aria-atomic=\"true\">\n    <p>\n      <span [textContent]=\"notification.message\"></span>\n      <span [textContent]=\"' '\"></span>\n      <a class=\"notification-box--target-link\"\n         *ngIf=\"notification.link\"\n         (click)=\"executeTarget($event)\"\n         [textContent]=\"notification.link!.text\">\n      </a>\n    </p>\n    <div [ngSwitch]=\"type\">\n      <div *ngSwitchCase=\"'upload'\">\n        <div *ngIf=\"canBeHidden()\">\n          <a (click)=\"show = true\" [hidden]=\"show\">\n            <op-icon icon-classes=\"icon-arrow-right2\"></op-icon>\n          </a>\n          <a (click)=\"show = false\" [hidden]=\"!show\">\n            <op-icon icon-classes=\"icon-arrow-down1\"></op-icon>\n          </a>\n          <span [textContent]=\"uploadText\"></span>\n        </div>\n        <div [ngClass]=\"{ '-hidden': !show && canBeHidden() }\">\n          <ul class=\"notification-box--uploads\" *ngIf=\"data && data.length > 0\">\n            <notifications-upload-progress\n                *ngFor=\"let upload of data\"\n                [upload]=\"upload\"\n                (onSuccess)=\"onUploadSuccess()\"\n                (onError)=\"onUploadError($event)\">\n            </notifications-upload-progress>\n          </ul>\n        </div>\n      </div>\n      <div *ngSwitchCase=\"'success'\"></div>\n      <div *ngSwitchCase=\"'error'\">\n        <ul class=\"notification-box--errors\">\n          <li *ngFor=\"let error of data\" [textContent]=\"error\"></li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <accessible-by-keyboard *ngIf=\"removable()\"\n                          (execute)=\"remove()\"\n                          [linkTitle]=\"text.close_popup\"\n                          linkClass=\"notification-box--close icon-context icon-close\">\n  </accessible-by-keyboard>\n</div>\n","module.exports = global[\"I18n\"] = require(\"-!./i18n.js\");","import {KeepTabService} from 'core-components/wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {StateService} from '@uirouter/core';\n\nexport const uiStateLinkClass = '__ui-state-link';\nexport const checkedClassName = '-checked';\n\nexport class UiStateLinkBuilder {\n\n  constructor(public readonly $state:StateService,\n              public readonly keepTab:KeepTabService) {\n  }\n\n  public linkToDetails(workPackageId:string, title:string, content:string) {\n    return this.build(workPackageId, 'currentDetailsState', title, content);\n  }\n\n  public linkToShow(workPackageId:string, title:string, content:string) {\n    return this.build(workPackageId, 'currentShowState', title, content);\n  }\n\n  private build(workPackageId:string, state:string, title:string, content:string) {\n    let a = document.createElement('a');\n\n    a.href = this.$state.href((this.keepTab as any)[state], {workPackageId: workPackageId});\n    a.classList.add(uiStateLinkClass);\n    a.dataset['workPackageId'] = workPackageId;\n    a.dataset['wpState'] = state;\n\n    a.setAttribute('title', title);\n    a.textContent = content;\n\n    return a;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {DmListParameter, DmServiceInterface} from \"core-app/modules/hal/dm-services/dm.service.interface\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Injectable} from '@angular/core';\n\n// This only needs to be Injectable for the tests to work\n@Injectable()\nexport abstract class AbstractDmService<T extends HalResource> implements DmServiceInterface {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public list(params:DmListParameter|null):Promise<CollectionResource<T>> {\n    return this.listRequest(this.listUrl(), params) as Promise<CollectionResource<T>>;\n  }\n\n\n  public one(id:number):Promise<T> {\n    return this.halResourceService.get<T>(this.oneUrl(id).toString()).toPromise();\n  }\n\n  protected listRequest(url:string, params:DmListParameter|null) {\n    return this.halResourceService.get(url + this.listParamsString(params)).toPromise();\n  }\n\n  protected listParamsString(params:DmListParameter|null):string {\n    let queryProps = [];\n\n    if (params && params.sortBy) {\n      queryProps.push(`sortBy=${JSON.stringify(params.sortBy)}`);\n    }\n\n    // 0 should not be treated as false\n    if (params && params.pageSize !== undefined) {\n      queryProps.push(`pageSize=${params.pageSize}`);\n    }\n\n    if (params && params.filters) {\n      let filters = new ApiV3FilterBuilder();\n\n      params.filters.forEach((filterParam) => {\n        filters.add(...filterParam);\n      });\n\n      queryProps.push(filters.toParams());\n    }\n\n    let queryPropsString = '';\n\n    if (queryProps.length) {\n      queryPropsString = `?${queryProps.join('&')}`;\n    }\n\n    return queryPropsString;\n  }\n\n\n  protected abstract listUrl():string;\n  protected abstract oneUrl(id:number|string):string;\n}\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"crnd\";","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {input, State} from 'reactivestates';\nimport {Injectable} from '@angular/core';\nimport {UploadInProgress} from \"core-components/api/op-file-upload/op-file-upload.service\";\n\nexport function removeSuccessFlashMessages() {\n  jQuery('.flash.notice').remove();\n}\n\nexport type NotificationType = 'success'|'error'|'warning'|'info'|'upload';\nexport const OPNotificationEvent = 'op:notifications:add';\n\nexport interface INotification {\n  message:string;\n  link?:{ text:string, target:Function };\n  type:NotificationType;\n  data?:any;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class NotificationsService {\n\n  // The current stack of notifications\n  private stack = input<INotification[]>([]);\n\n  constructor(readonly configurationService:ConfigurationService) {\n    jQuery(window)\n      .on(OPNotificationEvent,\n        (event:JQuery.TriggeredEvent, notification:INotification) => {\n          this.add(notification);\n        });\n  }\n\n  /**\n   * Get a read-only view of the current stack of notifications.\n   */\n  public get current():State<INotification[]> {\n    return this.stack;\n  }\n\n  public add(notification:INotification, timeoutAfter = 5000) {\n    // Remove flash messages\n    removeSuccessFlashMessages();\n\n    this.stack.doModify((current) => {\n      let nextValue = [notification].concat(current);\n      _.remove(nextValue, (n, i) =>\n        i > 0 && (n.type === 'success' || n.type === 'error')\n      );\n      return nextValue;\n    });\n\n    // auto-hide if success\n    if (notification.type === 'success' && this.configurationService.autoHidePopups()) {\n      setTimeout(() => this.remove(notification), timeoutAfter);\n    }\n\n    return notification;\n  }\n\n  public addError(message:INotification|string, errors:any[]|string = []) {\n    if (!Array.isArray(errors)) {\n      errors = [errors];\n    }\n\n    let notification:INotification = this.createNotification(message, 'error');\n    notification.data = errors;\n\n    return this.add(notification);\n  }\n\n  public addWarning(message:INotification|string) {\n    return this.add(this.createNotification(message, 'warning'));\n  }\n\n  public addSuccess(message:INotification|string) {\n    return this.add(this.createNotification(message, 'success'));\n  }\n\n  public addNotice(message:INotification|string) {\n    return this.add(this.createNotification(message, 'info'));\n  }\n\n  public addAttachmentUpload(message:INotification|string, uploads:UploadInProgress[]) {\n    return this.add(this.createAttachmentUploadNotification(message, uploads));\n  }\n\n  public remove(notification:INotification) {\n    this.stack.doModify((current) => {\n      _.remove(current, n => n === notification);\n      return current;\n    });\n  }\n\n  public clear() {\n    this.stack.putValue([]);\n  }\n\n  private createNotification(message:INotification|string, type:NotificationType):INotification {\n    if (typeof message === 'string') {\n      return { message: message, type: type };\n    } else {\n      message.type = type;\n    }\n\n    return message;\n  }\n\n  private createAttachmentUploadNotification(message:INotification|string, uploads:UploadInProgress[]) {\n    if (!uploads.length) {\n      throw new Error('Cannot create an upload notification without uploads!');\n    }\n\n    let notification = this.createNotification(message, 'upload');\n    notification.data = uploads;\n\n    return notification;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceSchemaResource} from 'core-app/modules/hal/resources/query-filter-instance-schema-resource';\n\nexport interface QueryFilterResourceEmbedded {\n  schema:QueryFilterInstanceSchemaResource;\n}\n\nexport class QueryFilterResource extends HalResource {\n  public $embedded:QueryFilterResourceEmbedded;\n  public schema:QueryFilterInstanceSchemaResource;\n  public values:any[];\n\n  public get id():string {\n    return this.$source.id || this.idFromLink;\n  }\n\n  public set id(newId:string) {\n    this.$source.id = newId;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport {InputState, State} from 'reactivestates';\nimport {States} from '../states.service';\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Injectable} from '@angular/core';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\n\n@Injectable()\nexport class SchemaCacheService {\n\n  constructor(readonly states:States,\n              readonly halResourceService:HalResourceService) {\n  }\n\n  /**\n   * Ensure the given schema identified by its href is currently loaded.\n   * @param href The schema's href.\n   * @return A promise with the loaded schema.\n   */\n  ensureLoaded(resource:HalResource):Promise<unknown> {\n    const state = this.state(resource);\n\n    if (state.hasValue()) {\n      return Promise.resolve(state.value);\n    } else {\n      return this.load(resource).valuesPromise() as Promise<unknown>;\n    }\n  }\n\n  /**\n   * Get the associated schema state of the work package\n   *  without initializing a new resource.\n   */\n  state(resource:HalResource):InputState<SchemaResource> {\n    const schema = resource.$links.schema;\n\n    if (!schema) {\n      throw `Resource ${resource} has no schema!`;\n    }\n\n    return this.states.schemas.get(schema.href!);\n  }\n\n  /**\n   * Load the associated schema for the given work package, if needed.\n   */\n  load(resource:HalResource, forceUpdate = false):State<SchemaResource> {\n    const state = this.state(resource);\n\n    if (forceUpdate) {\n      state.clear();\n    }\n\n    state.putFromPromiseIfPristine(() => {\n      const schemaResource = this.halResourceService.createLinkedResource(resource, 'schema', resource.$links.schema.$link);\n      return schemaResource.$load() as any;\n    });\n\n    return state;\n  }\n}\n","import {Title} from \"@angular/platform-browser\";\nimport {Injectable} from \"@angular/core\";\n\nconst titlePartsSeparator = ' | ';\n\n@Injectable({ providedIn: 'root' })\nexport class OpTitleService {\n  constructor(private titleService:Title) {\n\n  }\n\n  public get current():string {\n    return this.titleService.getTitle();\n  }\n\n  public get titleParts():string[] {\n    return this.current.split(titlePartsSeparator);\n  }\n\n  public setFirstPart(value:string) {\n    let parts = this.titleParts;\n    parts[0] = value;\n\n    this.titleService.setTitle(parts.join(titlePartsSeparator));\n  }\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector} from '@angular/core';\nimport {ErrorResource} from 'core-app/modules/hal/resources/error-resource';\nimport {Subscription} from 'rxjs';\nimport {States} from 'core-components/states.service';\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\n\nimport {\n  HalResourceEditingService,\n  ResourceChangesetCommit\n} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const activeFieldContainerClassName = 'inline-edit--active-field';\nexport const activeFieldClassName = 'inline-edit--field';\n\nexport abstract class EditForm<T extends HalResource = HalResource> {\n\n  // Injections\n  @InjectField() states:States;\n  @InjectField() halEditing:HalResourceEditingService;\n  @InjectField() halNotification:HalResourceNotificationService;\n  @InjectField() halEvents:HalEventsService;\n\n  // All current active (open) edit fields\n  public activeFields:{ [fieldName:string]:EditFieldHandler } = {};\n\n  // Errors of the last operation (required when adding opening fields afterwards)\n  public errorsPerAttribute:{ [fieldName:string]:string[] } = {};\n\n  // Reference to the changeset used in this form\n  public resource:T;\n\n  // Whether this form exists in edit mode\n  public editMode:boolean = false;\n\n  protected constructor(public injector:Injector) {\n  }\n\n  /**\n   * Activate the field, returning the element and associated field handler\n   */\n  protected abstract activateField(form:EditForm, schema:IFieldSchema, fieldName:string, errors:string[]):Promise<EditFieldHandler>;\n\n  /**\n   * Show this required field. E.g., add the necessary column\n   */\n  protected abstract requireVisible(fieldName:string):Promise<void>;\n\n  /**\n   * Reset the field and re-render the current resource's value\n   */\n  abstract reset(fieldName:string, focus?:boolean):void;\n\n  /**\n   * Optional callback when the form is being saved\n   */\n  protected onSaved(commit:ResourceChangesetCommit):void {\n    // Does nothing by default\n  }\n\n  protected abstract focusOnFirstError():void;\n\n  /**\n   * Return whether this form has any active fields\n   */\n  public hasActiveFields():boolean {\n    return !_.isEmpty(this.activeFields);\n  }\n\n\n  /**\n   * Return the current or a new change object for the given resource.\n   * This will always return a valid (potentially empty) change.\n   *\n   * @return {ResourceChangeset}\n   */\n  public get change():ResourceChangeset<T> {\n    return this.halEditing.changeFor(this.resource);\n  }\n\n  /**\n   * Active the edit field upon user's request.\n   * @param fieldName\n   * @param noWarnings Ignore warnings if the field cannot be opened\n   */\n  public activate(fieldName:string, noWarnings:boolean = false):Promise<EditFieldHandler> {\n    return this.loadFieldSchema(fieldName, noWarnings)\n      .then((schema:IFieldSchema) => {\n        if (!schema.writable && !noWarnings) {\n          this.halNotification.showEditingBlockedError(schema.name || fieldName);\n          return Promise.reject();\n        }\n\n        return this.renderField(fieldName, schema);\n      });\n  }\n\n  /**\n   * Activate the field unless it is marked active already\n   * (e.g., already being activated).\n   */\n  public activateWhenNeeded(fieldName:string):Promise<unknown> {\n    const activeField = this.activeFields[fieldName];\n    if (activeField) {\n      return Promise.resolve();\n    }\n\n    return this.requireVisible(fieldName).then(() => {\n      return this.activate(fieldName, true);\n    });\n  }\n\n  /**\n   * Activate all fields that are returned in validation errors\n   */\n  public activateMissingFields() {\n    this.change.getForm().then((form:any) => {\n      _.each(form.validationErrors, (val:any, key:string) => {\n        if (key === 'id') {\n          return;\n        }\n        this.activateWhenNeeded(key);\n      });\n    });\n  }\n\n  /**\n   * Save the active changeset.\n   * @return {any}\n   */\n  public async submit():Promise<T> {\n    if (this.change.isEmpty() && !this.resource.isNew) {\n      this.closeEditFields();\n      return Promise.resolve(this.resource);\n    }\n\n    // Mark changeset as in flight\n    this.change.inFlight = true;\n\n    // Reset old error notifcations\n    this.errorsPerAttribute = {};\n\n    // Notify all fields of upcoming save\n    const openFields = _.keys(this.activeFields);\n\n    // Call onSubmit handlers\n    await Promise.all(_.map(this.activeFields, (handler:EditFieldHandler) => handler.onSubmit()));\n\n    return new Promise<T>((resolve, reject) => {\n      this.halEditing.save<T, ResourceChangeset<T>>(this.change)\n        .then(result => {\n          // Close all current fields\n          this.closeEditFields(openFields);\n\n          resolve(result.resource);\n\n          this.halNotification.showSave(result.resource, result.wasNew);\n          this.editMode = false;\n          this.onSaved(result);\n          this.change.inFlight = false;\n        })\n        .catch((error:ErrorResource|Object) => {\n          this.halNotification.handleRawError(error, this.resource);\n\n          if (error instanceof ErrorResource) {\n            this.handleSubmissionErrors(error);\n            reject();\n          }\n\n          this.change.inFlight = false;\n        });\n    });\n  }\n\n  /**\n   * Close the given or all open fields.\n   *\n   * @param {string[]} fields\n   * @param resetChange whether to undo any changes made\n   */\n  public closeEditFields(fields:string[]|'all' = 'all', resetChange:boolean = true) {\n    if (fields === 'all') {\n      fields = _.keys(this.activeFields);\n    }\n\n    fields.forEach((name:string) => {\n      const handler = this.activeFields[name];\n      handler && handler.deactivate(false);\n\n      if (resetChange) {\n        this.change.reset(name);\n      }\n    });\n  }\n\n  protected handleSubmissionErrors(error:any) {\n    // Process single API errors\n    this.handleErroneousAttributes(error);\n  }\n\n  protected handleErroneousAttributes(error:any) {\n    // Get attributes withe errors\n    const erroneousAttributes = error.getInvolvedAttributes();\n\n    // Save erroneous fields for when new fields appear\n    this.errorsPerAttribute = error.getMessagesPerAttribute();\n    if (erroneousAttributes.length === 0) {\n      return;\n    }\n\n    return this.setErrorsForFields(erroneousAttributes);\n  }\n\n  private setErrorsForFields(erroneousFields:string[]) {\n    // Accumulate errors for the given response\n    let promises:Promise<any>[] = erroneousFields.map((fieldName:string) => {\n      return this.requireVisible(fieldName).then(() => {\n        if (this.activeFields[fieldName]) {\n          this.activeFields[fieldName].setErrors(this.errorsPerAttribute[fieldName] || []);\n        }\n\n        return this.activateWhenNeeded(fieldName) as any;\n      });\n    });\n\n    Promise.all(promises)\n      .then(() => {\n        setTimeout(() => this.focusOnFirstError());\n      })\n      .catch(() => {\n        console.error('Failed to activate all erroneous fields.');\n      });\n  }\n\n  /**\n   * Load the resource form to get the current field schema with all\n   * values loaded.\n   * @param fieldName\n   */\n  private loadFieldSchema(fieldName:string, noWarnings:boolean = false):Promise<IFieldSchema> {\n    const schemaName = this.change.getSchemaName(fieldName);\n\n    return new Promise((resolve, reject) => {\n      this.loadFormAndCheck(schemaName, noWarnings);\n      const fieldSchema:IFieldSchema = this.change.schema[schemaName];\n\n      if (!fieldSchema) {\n        throw new Error();\n      }\n\n      resolve(fieldSchema);\n    });\n  }\n\n  /**\n   * Ensure the form gets loaded and we show an error when the field cannot be opened\n   * @param schemaName\n   * @param noWarnings\n   */\n  private loadFormAndCheck(fieldName:string, noWarnings:boolean = false) {\n    const schemaName = this.change.getSchemaName(fieldName);\n\n    // Ensure the form is being loaded if necessary\n    this.change\n      .getForm()\n      .then((form) => {\n        // Look up whether we're actually editable\n        const fieldSchema = form.schema[schemaName];\n        if (!fieldSchema.writable && !noWarnings) {\n          this.halNotification.showEditingBlockedError(fieldSchema.name || fieldName);\n          this.closeEditFields([fieldName]);\n        }\n      })\n      .catch((error:any) => {\n        console.error('Failed to build edit field: %o', error);\n        this.halNotification.handleRawError(error, this.resource);\n        this.closeEditFields([fieldName]);\n      });\n  }\n\n  private renderField(fieldName:string, schema:IFieldSchema):Promise<EditFieldHandler> {\n    const promise:Promise<EditFieldHandler> = this.activateField(this,\n      schema,\n      fieldName,\n      this.errorsPerAttribute[fieldName] || []);\n\n    return promise\n      .then((fieldHandler:EditFieldHandler) => {\n        this.activeFields[fieldName] = fieldHandler;\n        return fieldHandler;\n      })\n      .catch((error) => {\n        console.error('Failed to render edit field:' + error);\n        this.halNotification.handleRawError(error);\n      });\n  }\n}\n","// I18n.js\n// =======\n//\n// This small library provides the Rails I18n API on the Javascript.\n// You don't actually have to use Rails (or even Ruby) to use I18n.js.\n// Just make sure you export all translations in an object like this:\n//\n//     I18n.translations.en = {\n//       hello: \"Hello World\"\n//     };\n//\n// See tests for specific formatting like numbers and dates.\n//\n\n// Using UMD pattern from\n// https://github.com/umdjs/umd#regular-module\n// `returnExports.js` version\n;(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(\"i18n\", function(){ return factory(root);});\n  } else if (typeof module === 'object' && module.exports) {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(root);\n  } else {\n    // Browser globals (root is window)\n    root.I18n = factory(root);\n  }\n}(this, function(global) {\n  \"use strict\";\n\n  // Use previously defined object if exists in current scope\n  var I18n = global && global.I18n || {};\n\n  // Just cache the Array#slice function.\n  var slice = Array.prototype.slice;\n\n  // Apply number padding.\n  var padding = function(number) {\n    return (\"0\" + number.toString()).substr(-2);\n  };\n\n  // Improved toFixed number rounding function with support for unprecise floating points\n  // JavaScript's standard toFixed function does not round certain numbers correctly (for example 0.105 with precision 2).\n  var toFixed = function(number, precision) {\n    return decimalAdjust('round', number, -precision).toFixed(precision);\n  };\n\n  // Is a given variable an object?\n  // Borrowed from Underscore.js\n  var isObject = function(obj) {\n    var type = typeof obj;\n    return type === 'function' || type === 'object'\n  };\n\n  var isFunction = function(func) {\n    var type = typeof func;\n    return type === 'function'\n  };\n\n  // Check if value is different than undefined and null;\n  var isSet = function(value) {\n    return typeof(value) !== 'undefined' && value !== null;\n  };\n\n  // Is a given value an array?\n  // Borrowed from Underscore.js\n  var isArray = function(val) {\n    if (Array.isArray) {\n      return Array.isArray(val);\n    };\n    return Object.prototype.toString.call(val) === '[object Array]';\n  };\n\n  var isString = function(val) {\n    return typeof value == 'string' || Object.prototype.toString.call(val) === '[object String]';\n  };\n\n  var isNumber = function(val) {\n    return typeof val == 'number' || Object.prototype.toString.call(val) === '[object Number]';\n  };\n\n  var isBoolean = function(val) {\n    return val === true || val === false;\n  };\n\n  var decimalAdjust = function(type, value, exp) {\n    // If the exp is undefined or zero...\n    if (typeof exp === 'undefined' || +exp === 0) {\n      return Math[type](value);\n    }\n    value = +value;\n    exp = +exp;\n    // If the value is not a number or the exp is not an integer...\n    if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {\n      return NaN;\n    }\n    // Shift\n    value = value.toString().split('e');\n    value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));\n    // Shift back\n    value = value.toString().split('e');\n    return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));\n  }\n\n  var lazyEvaluate = function(message, scope) {\n    if (isFunction(message)) {\n      return message(scope);\n    } else {\n      return message;\n    }\n  }\n\n  var merge = function (dest, obj) {\n    var key, value;\n    for (key in obj) if (obj.hasOwnProperty(key)) {\n      value = obj[key];\n      if (isString(value) || isNumber(value) || isBoolean(value) || isArray(value)) {\n        dest[key] = value;\n      } else {\n        if (dest[key] == null) dest[key] = {};\n        merge(dest[key], value);\n      }\n    }\n    return dest;\n  };\n\n  // Set default days/months translations.\n  var DATE = {\n      day_names: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"]\n    , abbr_day_names: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\n    , month_names: [null, \"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"]\n    , abbr_month_names: [null, \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n    , meridian: [\"AM\", \"PM\"]\n  };\n\n  // Set default number format.\n  var NUMBER_FORMAT = {\n      precision: 3\n    , separator: \".\"\n    , delimiter: \",\"\n    , strip_insignificant_zeros: false\n  };\n\n  // Set default currency format.\n  var CURRENCY_FORMAT = {\n      unit: \"$\"\n    , precision: 2\n    , format: \"%u%n\"\n    , sign_first: true\n    , delimiter: \",\"\n    , separator: \".\"\n  };\n\n  // Set default percentage format.\n  var PERCENTAGE_FORMAT = {\n      unit: \"%\"\n    , precision: 3\n    , format: \"%n%u\"\n    , separator: \".\"\n    , delimiter: \"\"\n  };\n\n  // Set default size units.\n  var SIZE_UNITS = [null, \"kb\", \"mb\", \"gb\", \"tb\"];\n\n  // Other default options\n  var DEFAULT_OPTIONS = {\n    // Set default locale. This locale will be used when fallback is enabled and\n    // the translation doesn't exist in a particular locale.\n      defaultLocale: \"en\"\n    // Set the current locale to `en`.\n    , locale: \"en\"\n    // Set the translation key separator.\n    , defaultSeparator: \".\"\n    // Set the placeholder format. Accepts `{{placeholder}}` and `%{placeholder}`.\n    , placeholder: /(?:\\{\\{|%\\{)(.*?)(?:\\}\\}?)/gm\n    // Set if engine should fallback to the default locale when a translation\n    // is missing.\n    , fallbacks: false\n    // Set the default translation object.\n    , translations: {}\n    // Set missing translation behavior. 'message' will display a message\n    // that the translation is missing, 'guess' will try to guess the string\n    , missingBehaviour: 'message'\n    // if you use missingBehaviour with 'message', but want to know that the\n    // string is actually missing for testing purposes, you can prefix the\n    // guessed string by setting the value here. By default, no prefix!\n    , missingTranslationPrefix: ''\n  };\n\n  // Set default locale. This locale will be used when fallback is enabled and\n  // the translation doesn't exist in a particular locale.\n  I18n.reset = function() {\n    var key;\n    for (key in DEFAULT_OPTIONS) {\n      this[key] = DEFAULT_OPTIONS[key];\n    }\n  };\n\n  // Much like `reset`, but only assign options if not already assigned\n  I18n.initializeOptions = function() {\n    var key;\n    for (key in DEFAULT_OPTIONS) if (!isSet(this[key])) {\n      this[key] = DEFAULT_OPTIONS[key];\n    }\n  };\n  I18n.initializeOptions();\n\n  // Return a list of all locales that must be tried before returning the\n  // missing translation message. By default, this will consider the inline option,\n  // current locale and fallback locale.\n  //\n  //     I18n.locales.get(\"de-DE\");\n  //     // [\"de-DE\", \"de\", \"en\"]\n  //\n  // You can define custom rules for any locale. Just make sure you return a array\n  // containing all locales.\n  //\n  //     // Default the Wookie locale to English.\n  //     I18n.locales[\"wk\"] = function(locale) {\n  //       return [\"en\"];\n  //     };\n  //\n  I18n.locales = {};\n\n  // Retrieve locales based on inline locale, current locale or default to\n  // I18n's detection.\n  I18n.locales.get = function(locale) {\n    var result = this[locale] || this[I18n.locale] || this[\"default\"];\n\n    if (isFunction(result)) {\n      result = result(locale);\n    }\n\n    if (isArray(result) === false) {\n      result = [result];\n    }\n\n    return result;\n  };\n\n  // The default locale list.\n  I18n.locales[\"default\"] = function(locale) {\n    var locales = []\n      , list = []\n    ;\n\n    // Handle the inline locale option that can be provided to\n    // the `I18n.t` options.\n    if (locale) {\n      locales.push(locale);\n    }\n\n    // Add the current locale to the list.\n    if (!locale && I18n.locale) {\n      locales.push(I18n.locale);\n    }\n\n    // Add the default locale if fallback strategy is enabled.\n    if (I18n.fallbacks && I18n.defaultLocale) {\n      locales.push(I18n.defaultLocale);\n    }\n\n    // Locale code format 1:\n    // According to RFC4646 (http://www.ietf.org/rfc/rfc4646.txt)\n    // language codes for Traditional Chinese should be `zh-Hant`\n    //\n    // But due to backward compatibility\n    // We use older version of IETF language tag\n    // @see http://www.w3.org/TR/html401/struct/dirlang.html\n    // @see http://en.wikipedia.org/wiki/IETF_language_tag\n    //\n    // Format: `language-code = primary-code ( \"-\" subcode )*`\n    //\n    // primary-code uses ISO639-1\n    // @see http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\n    // @see http://www.iso.org/iso/home/standards/language_codes.htm\n    //\n    // subcode uses ISO 3166-1 alpha-2\n    // @see http://en.wikipedia.org/wiki/ISO_3166\n    // @see http://www.iso.org/iso/country_codes.htm\n    //\n    // @note\n    //   subcode can be in upper case or lower case\n    //   defining it in upper case is a convention only\n\n\n    // Locale code format 2:\n    // Format: `code = primary-code ( \"-\" region-code )*`\n    // primary-code uses ISO 639-1\n    // script-code uses ISO 15924\n    // region-code uses ISO 3166-1 alpha-2\n    // Example: zh-Hant-TW, en-HK, zh-Hant-CN\n    //\n    // It is similar to RFC4646 (or actually the same),\n    // but seems to be limited to language, script, region\n\n    // Compute each locale with its country code.\n    // So this will return an array containing\n    // `de-DE` and `de`\n    // or\n    // `zh-hans-tw`, `zh-hans`, `zh`\n    // locales.\n    locales.forEach(function(locale) {\n      var localeParts = locale.split(\"-\");\n      var firstFallback = null;\n      var secondFallback = null;\n      if (localeParts.length === 3) {\n        firstFallback = [\n          localeParts[0],\n          localeParts[1]\n        ].join(\"-\");\n        secondFallback = localeParts[0];\n      }\n      else if (localeParts.length === 2) {\n        firstFallback = localeParts[0];\n      }\n\n      if (list.indexOf(locale) === -1) {\n        list.push(locale);\n      }\n\n      if (! I18n.fallbacks) {\n        return;\n      }\n\n      [\n        firstFallback,\n        secondFallback\n      ].forEach(function(nullableFallbackLocale) {\n        // We don't want null values\n        if (typeof nullableFallbackLocale === \"undefined\") { return; }\n        if (nullableFallbackLocale === null) { return; }\n        // We don't want duplicate values\n        //\n        // Comparing with `locale` first is faster than\n        // checking whether value's presence in the list\n        if (nullableFallbackLocale === locale) { return; }\n        if (list.indexOf(nullableFallbackLocale) !== -1) { return; }\n\n        list.push(nullableFallbackLocale);\n      });\n    });\n\n    // No locales set? English it is.\n    if (!locales.length) {\n      locales.push(\"en\");\n    }\n\n    return list;\n  };\n\n  // Hold pluralization rules.\n  I18n.pluralization = {};\n\n  // Return the pluralizer for a specific locale.\n  // If no specify locale is found, then I18n's default will be used.\n  I18n.pluralization.get = function(locale) {\n    return this[locale] || this[I18n.locale] || this[\"default\"];\n  };\n\n  // The default pluralizer rule.\n  // It detects the `zero`, `one`, and `other` scopes.\n  I18n.pluralization[\"default\"] = function(count) {\n    switch (count) {\n      case 0: return [\"zero\", \"other\"];\n      case 1: return [\"one\"];\n      default: return [\"other\"];\n    }\n  };\n\n  // Return current locale. If no locale has been set, then\n  // the current locale will be the default locale.\n  I18n.currentLocale = function() {\n    return this.locale || this.defaultLocale;\n  };\n\n  // Check if value is different than undefined and null;\n  I18n.isSet = isSet;\n\n  // Find and process the translation using the provided scope and options.\n  // This is used internally by some functions and should not be used as an\n  // public API.\n  I18n.lookup = function(scope, options) {\n    options = options || {}\n\n    var locales = this.locales.get(options.locale).slice()\n      , requestedLocale = locales[0]\n      , locale\n      , scopes\n      , fullScope\n      , translations\n    ;\n\n    fullScope = this.getFullScope(scope, options);\n\n    while (locales.length) {\n      locale = locales.shift();\n      scopes = fullScope.split(this.defaultSeparator);\n      translations = this.translations[locale];\n\n      if (!translations) {\n        continue;\n      }\n      while (scopes.length) {\n        translations = translations[scopes.shift()];\n\n        if (translations === undefined || translations === null) {\n          break;\n        }\n      }\n\n      if (translations !== undefined && translations !== null) {\n        return translations;\n      }\n    }\n\n    if (isSet(options.defaultValue)) {\n      return lazyEvaluate(options.defaultValue, scope);\n    }\n  };\n\n  // lookup pluralization rule key into translations\n  I18n.pluralizationLookupWithoutFallback = function(count, locale, translations) {\n    var pluralizer = this.pluralization.get(locale)\n      , pluralizerKeys = pluralizer(count)\n      , pluralizerKey\n      , message;\n\n    if (isObject(translations)) {\n      while (pluralizerKeys.length) {\n        pluralizerKey = pluralizerKeys.shift();\n        if (isSet(translations[pluralizerKey])) {\n          message = translations[pluralizerKey];\n          break;\n        }\n      }\n    }\n\n    return message;\n  };\n\n  // Lookup dedicated to pluralization\n  I18n.pluralizationLookup = function(count, scope, options) {\n    options = options || {}\n    var locales = this.locales.get(options.locale).slice()\n      , requestedLocale = locales[0]\n      , locale\n      , scopes\n      , translations\n      , message\n    ;\n    scope = this.getFullScope(scope, options);\n\n    while (locales.length) {\n      locale = locales.shift();\n      scopes = scope.split(this.defaultSeparator);\n      translations = this.translations[locale];\n\n      if (!translations) {\n        continue;\n      }\n\n      while (scopes.length) {\n        translations = translations[scopes.shift()];\n        if (!isObject(translations)) {\n          break;\n        }\n        if (scopes.length == 0) {\n          message = this.pluralizationLookupWithoutFallback(count, locale, translations);\n        }\n      }\n      if (message != null && message != undefined) {\n        break;\n      }\n    }\n\n    if (message == null || message == undefined) {\n      if (isSet(options.defaultValue)) {\n        if (isObject(options.defaultValue)) {\n          message = this.pluralizationLookupWithoutFallback(count, options.locale, options.defaultValue);\n        } else {\n          message = options.defaultValue;\n        }\n        translations = options.defaultValue;\n      }\n    }\n\n    return { message: message, translations: translations };\n  };\n\n  // Rails changed the way the meridian is stored.\n  // It started with `date.meridian` returning an array,\n  // then it switched to `time.am` and `time.pm`.\n  // This function abstracts this difference and returns\n  // the correct meridian or the default value when none is provided.\n  I18n.meridian = function() {\n    var time = this.lookup(\"time\");\n    var date = this.lookup(\"date\");\n\n    if (time && time.am && time.pm) {\n      return [time.am, time.pm];\n    } else if (date && date.meridian) {\n      return date.meridian;\n    } else {\n      return DATE.meridian;\n    }\n  };\n\n  // Merge serveral hash options, checking if value is set before\n  // overwriting any value. The precedence is from left to right.\n  //\n  //     I18n.prepareOptions({name: \"John Doe\"}, {name: \"Mary Doe\", role: \"user\"});\n  //     #=> {name: \"John Doe\", role: \"user\"}\n  //\n  I18n.prepareOptions = function() {\n    var args = slice.call(arguments)\n      , options = {}\n      , subject\n    ;\n\n    while (args.length) {\n      subject = args.shift();\n\n      if (typeof(subject) != \"object\") {\n        continue;\n      }\n\n      for (var attr in subject) {\n        if (!subject.hasOwnProperty(attr)) {\n          continue;\n        }\n\n        if (isSet(options[attr])) {\n          continue;\n        }\n\n        options[attr] = subject[attr];\n      }\n    }\n\n    return options;\n  };\n\n  // Generate a list of translation options for default fallbacks.\n  // `defaultValue` is also deleted from options as it is returned as part of\n  // the translationOptions array.\n  I18n.createTranslationOptions = function(scope, options) {\n    var translationOptions = [{scope: scope}];\n\n    // Defaults should be an array of hashes containing either\n    // fallback scopes or messages\n    if (isSet(options.defaults)) {\n      translationOptions = translationOptions.concat(options.defaults);\n    }\n\n    // Maintain support for defaultValue. Since it is always a message\n    // insert it in to the translation options as such.\n    if (isSet(options.defaultValue)) {\n      translationOptions.push({ message: options.defaultValue });\n    }\n\n    return translationOptions;\n  };\n\n  // Translate the given scope with the provided options.\n  I18n.translate = function(scope, options) {\n    options = options || {}\n\n    var translationOptions = this.createTranslationOptions(scope, options);\n\n    var translation;\n\n    var optionsWithoutDefault = this.prepareOptions(options)\n    delete optionsWithoutDefault.defaultValue\n\n    // Iterate through the translation options until a translation\n    // or message is found.\n    var translationFound =\n      translationOptions.some(function(translationOption) {\n        if (isSet(translationOption.scope)) {\n          translation = this.lookup(translationOption.scope, optionsWithoutDefault);\n        } else if (isSet(translationOption.message)) {\n          translation = lazyEvaluate(translationOption.message, scope);\n        }\n\n        if (translation !== undefined && translation !== null) {\n          return true;\n        }\n      }, this);\n\n    if (!translationFound) {\n      return this.missingTranslation(scope, options);\n    }\n\n    if (typeof(translation) === \"string\") {\n      translation = this.interpolate(translation, options);\n    } else if (isObject(translation) && isSet(options.count)) {\n      translation = this.pluralize(options.count, scope, options);\n    }\n\n    return translation;\n  };\n\n  // This function interpolates the all variables in the given message.\n  I18n.interpolate = function(message, options) {\n    options = options || {}\n    var matches = message.match(this.placeholder)\n      , placeholder\n      , value\n      , name\n      , regex\n    ;\n\n    if (!matches) {\n      return message;\n    }\n\n    var value;\n\n    while (matches.length) {\n      placeholder = matches.shift();\n      name = placeholder.replace(this.placeholder, \"$1\");\n\n      if (isSet(options[name])) {\n        value = options[name].toString().replace(/\\$/gm, \"_#$#_\");\n      } else if (name in options) {\n        value = this.nullPlaceholder(placeholder, message, options);\n      } else {\n        value = this.missingPlaceholder(placeholder, message, options);\n      }\n\n      regex = new RegExp(placeholder.replace(/\\{/gm, \"\\\\{\").replace(/\\}/gm, \"\\\\}\"));\n      message = message.replace(regex, value);\n    }\n\n    return message.replace(/_#\\$#_/g, \"$\");\n  };\n\n  // Pluralize the given scope using the `count` value.\n  // The pluralized translation may have other placeholders,\n  // which will be retrieved from `options`.\n  I18n.pluralize = function(count, scope, options) {\n    options = this.prepareOptions({count: String(count)}, options)\n    var pluralizer, message, result;\n\n    result = this.pluralizationLookup(count, scope, options);\n    if (result.translations == undefined || result.translations == null) {\n      return this.missingTranslation(scope, options);\n    }\n\n    if (result.message != undefined && result.message != null) {\n      return this.interpolate(result.message, options);\n    }\n    else {\n      pluralizer = this.pluralization.get(options.locale);\n      return this.missingTranslation(scope + '.' + pluralizer(count)[0], options);\n    }\n  };\n\n  // Return a missing translation message for the given parameters.\n  I18n.missingTranslation = function(scope, options) {\n    //guess intended string\n    if(this.missingBehaviour == 'guess'){\n      //get only the last portion of the scope\n      var s = scope.split('.').slice(-1)[0];\n      //replace underscore with space && camelcase with space and lowercase letter\n      return (this.missingTranslationPrefix.length > 0 ? this.missingTranslationPrefix : '') +\n          s.replace('_',' ').replace(/([a-z])([A-Z])/g,\n          function(match, p1, p2) {return p1 + ' ' + p2.toLowerCase()} );\n    }\n\n    var localeForTranslation = (options != null && options.locale != null) ? options.locale : this.currentLocale();\n    var fullScope           = this.getFullScope(scope, options);\n    var fullScopeWithLocale = [localeForTranslation, fullScope].join(this.defaultSeparator);\n\n    return '[missing \"' + fullScopeWithLocale + '\" translation]';\n  };\n\n  // Return a missing placeholder message for given parameters\n  I18n.missingPlaceholder = function(placeholder, message, options) {\n    return \"[missing \" + placeholder + \" value]\";\n  };\n\n  I18n.nullPlaceholder = function() {\n    return I18n.missingPlaceholder.apply(I18n, arguments);\n  };\n\n  // Format number using localization rules.\n  // The options will be retrieved from the `number.format` scope.\n  // If this isn't present, then the following options will be used:\n  //\n  // - `precision`: `3`\n  // - `separator`: `\".\"`\n  // - `delimiter`: `\",\"`\n  // - `strip_insignificant_zeros`: `false`\n  //\n  // You can also override these options by providing the `options` argument.\n  //\n  I18n.toNumber = function(number, options) {\n    options = this.prepareOptions(\n        options\n      , this.lookup(\"number.format\")\n      , NUMBER_FORMAT\n    );\n\n    var negative = number < 0\n      , string = toFixed(Math.abs(number), options.precision).toString()\n      , parts = string.split(\".\")\n      , precision\n      , buffer = []\n      , formattedNumber\n      , format = options.format || \"%n\"\n      , sign = negative ? \"-\" : \"\"\n    ;\n\n    number = parts[0];\n    precision = parts[1];\n\n    while (number.length > 0) {\n      buffer.unshift(number.substr(Math.max(0, number.length - 3), 3));\n      number = number.substr(0, number.length -3);\n    }\n\n    formattedNumber = buffer.join(options.delimiter);\n\n    if (options.strip_insignificant_zeros && precision) {\n      precision = precision.replace(/0+$/, \"\");\n    }\n\n    if (options.precision > 0 && precision) {\n      formattedNumber += options.separator + precision;\n    }\n\n    if (options.sign_first) {\n      format = \"%s\" + format;\n    }\n    else {\n      format = format.replace(\"%n\", \"%s%n\");\n    }\n\n    formattedNumber = format\n      .replace(\"%u\", options.unit)\n      .replace(\"%n\", formattedNumber)\n      .replace(\"%s\", sign)\n    ;\n\n    return formattedNumber;\n  };\n\n  // Format currency with localization rules.\n  // The options will be retrieved from the `number.currency.format` and\n  // `number.format` scopes, in that order.\n  //\n  // Any missing option will be retrieved from the `I18n.toNumber` defaults and\n  // the following options:\n  //\n  // - `unit`: `\"$\"`\n  // - `precision`: `2`\n  // - `format`: `\"%u%n\"`\n  // - `delimiter`: `\",\"`\n  // - `separator`: `\".\"`\n  //\n  // You can also override these options by providing the `options` argument.\n  //\n  I18n.toCurrency = function(number, options) {\n    options = this.prepareOptions(\n        options\n      , this.lookup(\"number.currency.format\")\n      , this.lookup(\"number.format\")\n      , CURRENCY_FORMAT\n    );\n\n    return this.toNumber(number, options);\n  };\n\n  // Localize several values.\n  // You can provide the following scopes: `currency`, `number`, or `percentage`.\n  // If you provide a scope that matches the `/^(date|time)/` regular expression\n  // then the `value` will be converted by using the `I18n.toTime` function.\n  //\n  // It will default to the value's `toString` function.\n  //\n  I18n.localize = function(scope, value, options) {\n    options || (options = {});\n\n    switch (scope) {\n      case \"currency\":\n        return this.toCurrency(value);\n      case \"number\":\n        scope = this.lookup(\"number.format\");\n        return this.toNumber(value, scope);\n      case \"percentage\":\n        return this.toPercentage(value);\n      default:\n        var localizedValue;\n\n        if (scope.match(/^(date|time)/)) {\n          localizedValue = this.toTime(scope, value);\n        } else {\n          localizedValue = value.toString();\n        }\n\n        return this.interpolate(localizedValue, options);\n    }\n  };\n\n  // Parse a given `date` string into a JavaScript Date object.\n  // This function is time zone aware.\n  //\n  // The following string formats are recognized:\n  //\n  //    yyyy-mm-dd\n  //    yyyy-mm-dd[ T]hh:mm::ss\n  //    yyyy-mm-dd[ T]hh:mm::ss\n  //    yyyy-mm-dd[ T]hh:mm::ssZ\n  //    yyyy-mm-dd[ T]hh:mm::ss+0000\n  //    yyyy-mm-dd[ T]hh:mm::ss+00:00\n  //    yyyy-mm-dd[ T]hh:mm::ss.123Z\n  //\n  I18n.parseDate = function(date) {\n    var matches, convertedDate, fraction;\n    // we have a date, so just return it.\n    if (typeof(date) == \"object\") {\n      return date;\n    };\n\n    matches = date.toString().match(/(\\d{4})-(\\d{2})-(\\d{2})(?:[ T](\\d{2}):(\\d{2}):(\\d{2})([\\.,]\\d{1,3})?)?(Z|\\+00:?00)?/);\n\n    if (matches) {\n      for (var i = 1; i <= 6; i++) {\n        matches[i] = parseInt(matches[i], 10) || 0;\n      }\n\n      // month starts on 0\n      matches[2] -= 1;\n\n      fraction = matches[7] ? 1000 * (\"0\" + matches[7]) : null;\n\n      if (matches[8]) {\n        convertedDate = new Date(Date.UTC(matches[1], matches[2], matches[3], matches[4], matches[5], matches[6], fraction));\n      } else {\n        convertedDate = new Date(matches[1], matches[2], matches[3], matches[4], matches[5], matches[6], fraction);\n      }\n    } else if (typeof(date) == \"number\") {\n      // UNIX timestamp\n      convertedDate = new Date();\n      convertedDate.setTime(date);\n    } else if (date.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\\d+) (\\d+:\\d+:\\d+) ([+-]\\d+) (\\d+)/)) {\n      // This format `Wed Jul 20 13:03:39 +0000 2011` is parsed by\n      // webkit/firefox, but not by IE, so we must parse it manually.\n      convertedDate = new Date();\n      convertedDate.setTime(Date.parse([\n        RegExp.$1, RegExp.$2, RegExp.$3, RegExp.$6, RegExp.$4, RegExp.$5\n      ].join(\" \")));\n    } else if (date.match(/\\d+ \\d+:\\d+:\\d+ [+-]\\d+ \\d+/)) {\n      // a valid javascript format with timezone info\n      convertedDate = new Date();\n      convertedDate.setTime(Date.parse(date));\n    } else {\n      // an arbitrary javascript string\n      convertedDate = new Date();\n      convertedDate.setTime(Date.parse(date));\n    }\n\n    return convertedDate;\n  };\n\n  // Formats time according to the directives in the given format string.\n  // The directives begins with a percent (%) character. Any text not listed as a\n  // directive will be passed through to the output string.\n  //\n  // The accepted formats are:\n  //\n  //     %a  - The abbreviated weekday name (Sun)\n  //     %A  - The full weekday name (Sunday)\n  //     %b  - The abbreviated month name (Jan)\n  //     %B  - The full month name (January)\n  //     %c  - The preferred local date and time representation\n  //     %d  - Day of the month (01..31)\n  //     %-d - Day of the month (1..31)\n  //     %H  - Hour of the day, 24-hour clock (00..23)\n  //     %-H - Hour of the day, 24-hour clock (0..23)\n  //     %I  - Hour of the day, 12-hour clock (01..12)\n  //     %-I - Hour of the day, 12-hour clock (1..12)\n  //     %m  - Month of the year (01..12)\n  //     %-m - Month of the year (1..12)\n  //     %M  - Minute of the hour (00..59)\n  //     %-M - Minute of the hour (0..59)\n  //     %p  - Meridian indicator (AM  or  PM)\n  //     %S  - Second of the minute (00..60)\n  //     %-S - Second of the minute (0..60)\n  //     %w  - Day of the week (Sunday is 0, 0..6)\n  //     %y  - Year without a century (00..99)\n  //     %-y - Year without a century (0..99)\n  //     %Y  - Year with century\n  //     %z  - Timezone offset (+0545)\n  //\n  I18n.strftime = function(date, format) {\n    var options = this.lookup(\"date\")\n      , meridianOptions = I18n.meridian()\n    ;\n\n    if (!options) {\n      options = {};\n    }\n\n    options = this.prepareOptions(options, DATE);\n\n    if (isNaN(date.getTime())) {\n      throw new Error('I18n.strftime() requires a valid date object, but received an invalid date.');\n    }\n\n    var weekDay = date.getDay()\n      , day = date.getDate()\n      , year = date.getFullYear()\n      , month = date.getMonth() + 1\n      , hour = date.getHours()\n      , hour12 = hour\n      , meridian = hour > 11 ? 1 : 0\n      , secs = date.getSeconds()\n      , mins = date.getMinutes()\n      , offset = date.getTimezoneOffset()\n      , absOffsetHours = Math.floor(Math.abs(offset / 60))\n      , absOffsetMinutes = Math.abs(offset) - (absOffsetHours * 60)\n      , timezoneoffset = (offset > 0 ? \"-\" : \"+\") +\n          (absOffsetHours.toString().length < 2 ? \"0\" + absOffsetHours : absOffsetHours) +\n          (absOffsetMinutes.toString().length < 2 ? \"0\" + absOffsetMinutes : absOffsetMinutes)\n    ;\n\n    if (hour12 > 12) {\n      hour12 = hour12 - 12;\n    } else if (hour12 === 0) {\n      hour12 = 12;\n    }\n\n    format = format.replace(\"%a\", options.abbr_day_names[weekDay]);\n    format = format.replace(\"%A\", options.day_names[weekDay]);\n    format = format.replace(\"%b\", options.abbr_month_names[month]);\n    format = format.replace(\"%B\", options.month_names[month]);\n    format = format.replace(\"%d\", padding(day));\n    format = format.replace(\"%e\", day);\n    format = format.replace(\"%-d\", day);\n    format = format.replace(\"%H\", padding(hour));\n    format = format.replace(\"%-H\", hour);\n    format = format.replace(\"%I\", padding(hour12));\n    format = format.replace(\"%-I\", hour12);\n    format = format.replace(\"%m\", padding(month));\n    format = format.replace(\"%-m\", month);\n    format = format.replace(\"%M\", padding(mins));\n    format = format.replace(\"%-M\", mins);\n    format = format.replace(\"%p\", meridianOptions[meridian]);\n    format = format.replace(\"%S\", padding(secs));\n    format = format.replace(\"%-S\", secs);\n    format = format.replace(\"%w\", weekDay);\n    format = format.replace(\"%y\", padding(year));\n    format = format.replace(\"%-y\", padding(year).replace(/^0+/, \"\"));\n    format = format.replace(\"%Y\", year);\n    format = format.replace(\"%z\", timezoneoffset);\n\n    return format;\n  };\n\n  // Convert the given dateString into a formatted date.\n  I18n.toTime = function(scope, dateString) {\n    var date = this.parseDate(dateString)\n      , format = this.lookup(scope)\n    ;\n\n    if (date.toString().match(/invalid/i)) {\n      return date.toString();\n    }\n\n    if (!format) {\n      return date.toString();\n    }\n\n    return this.strftime(date, format);\n  };\n\n  // Convert a number into a formatted percentage value.\n  I18n.toPercentage = function(number, options) {\n    options = this.prepareOptions(\n        options\n      , this.lookup(\"number.percentage.format\")\n      , this.lookup(\"number.format\")\n      , PERCENTAGE_FORMAT\n    );\n\n    return this.toNumber(number, options);\n  };\n\n  // Convert a number into a readable size representation.\n  I18n.toHumanSize = function(number, options) {\n    var kb = 1024\n      , size = number\n      , iterations = 0\n      , unit\n      , precision\n    ;\n\n    while (size >= kb && iterations < 4) {\n      size = size / kb;\n      iterations += 1;\n    }\n\n    if (iterations === 0) {\n      unit = this.t(\"number.human.storage_units.units.byte\", {count: size});\n      precision = 0;\n    } else {\n      unit = this.t(\"number.human.storage_units.units.\" + SIZE_UNITS[iterations]);\n      precision = (size - Math.floor(size) === 0) ? 0 : 1;\n    }\n\n    options = this.prepareOptions(\n        options\n      , {unit: unit, precision: precision, format: \"%n%u\", delimiter: \"\"}\n    );\n\n    return this.toNumber(size, options);\n  };\n\n  I18n.getFullScope = function(scope, options) {\n    options = options || {}\n\n    // Deal with the scope as an array.\n    if (isArray(scope)) {\n      scope = scope.join(this.defaultSeparator);\n    }\n\n    // Deal with the scope option provided through the second argument.\n    //\n    //    I18n.t('hello', {scope: 'greetings'});\n    //\n    if (options.scope) {\n      scope = [options.scope, scope].join(this.defaultSeparator);\n    }\n\n    return scope;\n  };\n  /**\n   * Merge obj1 with obj2 (shallow merge), without modifying inputs\n   * @param {Object} obj1\n   * @param {Object} obj2\n   * @returns {Object} Merged values of obj1 and obj2\n   *\n   * In order to support ES3, `Object.prototype.hasOwnProperty.call` is used\n   * Idea is from:\n   * https://stackoverflow.com/questions/8157700/object-has-no-hasownproperty-method-i-e-its-undefined-ie8\n   */\n  I18n.extend = function ( obj1, obj2 ) {\n    if (typeof(obj1) === \"undefined\" && typeof(obj2) === \"undefined\") {\n      return {};\n    }\n    return merge(obj1, obj2);\n  };\n\n  // Set aliases, so we can save some typing.\n  I18n.t = I18n.translate;\n  I18n.l = I18n.localize;\n  I18n.p = I18n.pluralize;\n\n  return I18n;\n}));\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Input} from \"@angular/core\";\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {CardViewOrientation} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {distinctUntilChanged, takeUntil} from \"rxjs/operators\";\nimport {HighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {WorkPackageCardDragAndDropService} from \"core-components/wp-card-view/services/wp-card-drag-and-drop.service\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {WorkPackageTableConfiguration} from \"core-components/wp-table/wp-table-configuration\";\n\n@Component({\n  selector: 'wp-grid',\n  template: `\n    <wp-card-view [dragOutOfHandler]=\"canDragOutOf\"\n                  [dragInto]=\"dragInto\"\n                  [cardsRemovable]=\"false\"\n                  [highlightingMode]=\"highlightingMode\"\n                  [showStatusButton]=\"true\"\n                  [orientation]=\"gridOrientation\"\n                  (onMoved)=\"switchToManualSorting()\"\n                  [showEmptyResultsBox]=\"true\"\n                  [showInfoButton]=\"true\"\n                  [shrinkOnMobile]=\"true\">\n    </wp-card-view>\n\n    <div *ngIf=\"showResizer\"\n         class=\"hidden-for-mobile hide-when-print\">\n      <wp-resizer [elementClass]=\"resizerClass\"\n                  [localStorageKey]=\"resizerStorageKey\"></wp-resizer>\n    </div>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    DragAndDropService,\n    WorkPackageCardDragAndDropService\n  ]\n})\nexport class WorkPackagesGridComponent {\n  @Input() public configuration:WorkPackageTableConfiguration;\n  @Input() public showResizer:boolean = false;\n  @Input() public resizerClass:string = '';\n  @Input() public resizerStorageKey:string = '';\n\n  public canDragOutOf:() => boolean;\n  public dragInto:boolean;\n  public gridOrientation:CardViewOrientation = 'horizontal';\n  public highlightingMode:HighlightingMode = 'none';\n\n  constructor(readonly wpTableHighlight:WorkPackageViewHighlightingService,\n              readonly wpTableSortBy:WorkPackageViewSortByService,\n              readonly wpList:WorkPackagesListService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly cdRef:ChangeDetectorRef) {\n  }\n\n  ngOnInit() {\n    this.dragInto = this.configuration.dragAndDropEnabled;\n    this.canDragOutOf = () => {\n      return this.configuration.dragAndDropEnabled;\n    };\n\n    this.wpTableHighlight\n      .updates$()\n      .pipe(\n        takeUntil(this.querySpace.stopAllSubscriptions),\n        distinctUntilChanged()\n      )\n      .subscribe(() => {\n        this.highlightingMode = this.wpTableHighlight.current.mode;\n        this.cdRef.detectChanges();\n      });\n\n  }\n\n  public switchToManualSorting() {\n    let query = this.querySpace.query.value;\n    if (query && this.wpTableSortBy.switchToManualSorting(query)) {\n      this.wpList.save(query);\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewEncapsulation\n} from '@angular/core';\nimport {WorkPackageViewFiltersService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service';\nimport {WorkPackageFiltersService} from 'core-components/filters/wp-filters/wp-filters.service';\nimport {DebouncedEventEmitter} from \"core-components/angular/debounced-event-emitter\";\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\nimport {Observable} from \"rxjs\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  templateUrl: './filter-container.directive.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'filter-container'\n})\nexport class WorkPackageFilterContainerComponent extends UntilDestroyedMixin implements OnInit, OnDestroy {\n  @Input('showFilterButton') showFilterButton:boolean = false;\n  @Input('filterButtonText') filterButtonText:string = I18n.t('js.button_filter');\n  @Output() public filtersChanged = new DebouncedEventEmitter<QueryFilterInstanceResource[]>(componentDestroyed(this));\n\n  public visible$:Observable<Boolean>;\n  public filters = this.wpTableFilters.current;\n  public loaded = false;\n\n  constructor(readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly wpFiltersService:WorkPackageFiltersService) {\n    super();\n    this.visible$ = this.wpFiltersService.observeUntil(componentDestroyed(this));\n  }\n\n  ngOnInit():void {\n    this.wpTableFilters\n      .pristine$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.filters = this.wpTableFilters.current;\n        this.loaded = true;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public replaceIfComplete(filters:QueryFilterInstanceResource[]) {\n    this.wpTableFilters.replaceIfComplete(filters);\n    this.filtersChanged.emit(this.filters);\n  }\n}\n","<button class=\"button -small advanced-filters--toggle\"\n        (click)=\"wpFiltersService.toggleVisibility()\"\n        [class.-active]=\"visible$ | async\"\n        *ngIf=\"showFilterButton\">\n  <i class=\"button--icon icon-filter\"></i>\n  <span class=\"button--text\" [textContent]=\"filterButtonText\"></span>\n</button>\n\n<div class=\"work-packages--filters-optional-container\"\n     [ngClass]=\"{ '-loaded': loaded }\">\n  <div id=\"query_form_content\" class=\"hide-when-print\" *ngIf=\"visible$ | async\">\n    <query-filters *ngIf=\"!!filters\"\n                   [filters]=\"filters\"\n                   [showCloseFilter]=\"true\"\n                   (filtersChanged)=\"replaceIfComplete($event)\"></query-filters>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, Component, ElementRef, EventEmitter, Input, OnDestroy, Output, ViewChild} from '@angular/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {DatePicker} from \"core-app/modules/common/op-date-picker/datepicker\";\nimport {DebouncedEventEmitter} from \"core-components/angular/debounced-event-emitter\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {keyCodes} from \"core-app/modules/common/keyCodes.enum\";\nimport {Instance} from \"flatpickr/dist/types/instance\";\n\n@Component({\n  selector: 'op-date-picker',\n  templateUrl: './op-date-picker.component.html'\n})\nexport class OpDatePickerComponent extends UntilDestroyedMixin implements OnDestroy, AfterViewInit {\n  @Output() public onChange = new DebouncedEventEmitter<string>(componentDestroyed(this));\n  @Output() public onCancel = new EventEmitter<string>();\n\n  @Input() public initialDate:string = '';\n  @Input() public appendTo?:HTMLElement = document.body;\n  @Input() public classes:string = '';\n  @Input() public id:string = '';\n  @Input() public name:string = '';\n  @Input() public required:boolean = false;\n  @Input() public size:number = 20;\n  @Input() public focus:boolean = false;\n  @Input() public disabled:boolean = false;\n\n  @ViewChild('dateInput') dateInput:ElementRef;\n\n  private datePickerInstance:DatePicker;\n\n  public constructor(private elementRef:ElementRef,\n                     private ConfigurationService:ConfigurationService,\n                     private timezoneService:TimezoneService) {\n    super();\n\n    if (!this.id) {\n      this.id = 'datepicker-input-' + Math.floor(Math.random() * 1000).toString(3);\n    }\n  }\n\n  ngAfterViewInit():void {\n    this.initializeDatepicker();\n  }\n\n  ngOnDestroy() {\n    this.datePickerInstance && this.datePickerInstance.destroy();\n  }\n\n  openOnClick() {\n    if (!this.disabled) {\n      this.datePickerInstance.show();\n    }\n  }\n\n  onInputChange(_event:KeyboardEvent) {\n    if (this.isEmpty()) {\n      this.datePickerInstance.clear();\n    } else if (this.inputIsValidDate()) {\n      this.onChange.emit(this.currentValue);\n    }\n  }\n\n  closeOnOutsideClick(event:any) {\n    if (!(event.relatedTarget &&\n      this.datePickerInstance.datepickerInstance.calendarContainer.contains(event.relatedTarget))) {\n      this.datePickerInstance.hide();\n    }\n  }\n\n  private isEmpty():boolean {\n    return this.currentValue.trim() === '';\n  }\n\n  private get currentValue():string {\n    return this.inputElement?.value || '';\n  }\n\n  private get inputElement():HTMLInputElement {\n    return this.dateInput.nativeElement;\n  }\n\n  private inputIsValidDate():boolean {\n    return this.currentValue.match(/\\d{4}-\\d{2}-\\d{2}/) !== null;\n  }\n\n  private initializeDatepicker() {\n    let options:any = {\n      allowInput: true,\n      appendTo: this.appendTo,\n      onChange:(selectedDates:Date[], dateStr:string) => {\n        let val:string = dateStr;\n\n        if (this.isEmpty()) {\n          return;\n        }\n\n        this.inputElement.value = val;\n        this.onChange.emit(val);\n      },\n      onKeyDown: (selectedDates:Date[], dateStr:string, instance:Instance, data:KeyboardEvent) => {\n        if (data.which == keyCodes.ESCAPE) {\n          this.onCancel.emit();\n        }\n      }\n    };\n\n    let initialValue;\n    if (this.isEmpty && this.initialDate) {\n      initialValue = this.timezoneService.parseISODate(this.initialDate).toDate();\n    } else {\n      initialValue = this.currentValue;\n    }\n\n    this.datePickerInstance = new DatePicker(\n      '#' + this.id,\n      initialValue,\n      options\n    );\n  }\n}\n","<input #dateInput\n       [id]=\"id\"\n       [name]=\"name\"\n       [value]=\"initialDate\"\n       [ngClass]=\"classes\"\n       [size]=\"size\"\n       [required]=\"required\"\n       [focus]=\"focus\"\n       [disabled]=\"disabled\"\n       (click)=\"openOnClick()\"\n       (blur)=\"closeOnOutsideClick($event)\"\n       (input)=\"onInputChange($event)\"\n       type=\"text\">\n","import {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {Injectable, OnDestroy} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {States} from 'core-components/states.service';\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {RenderedWorkPackage} from \"core-app/modules/work_packages/render-info/rendered-work-package.type\";\nimport {WorkPackageViewBaseService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-base.service\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\n\nexport interface WorkPackageViewSelectionState {\n  // Map of selected rows\n  selected:{ [workPackageId:string]:boolean };\n  // Index of current selection\n  // required for shift-offsets\n  activeRowIndex:number|null;\n}\n\n@Injectable()\nexport class WorkPackageViewSelectionService extends WorkPackageViewBaseService<WorkPackageViewSelectionState> implements OnDestroy {\n\n  public constructor(readonly querySpace:IsolatedQuerySpace,\n                     readonly states:States,\n                     readonly wpCacheService:WorkPackageCacheService,\n                     readonly opContextMenu:OPContextMenuService) {\n    super(querySpace);\n    this.reset();\n  }\n\n  ngOnDestroy():void {\n    Mousetrap.unbind(['command+d', 'ctrl+d']);\n    Mousetrap.unbind(['command+a', 'ctrl+a']);\n  }\n\n  public initializeSelection(selectedWorkPackageIds:string[]) {\n    let state:WorkPackageViewSelectionState = {\n      selected: {},\n      activeRowIndex: null\n    };\n\n    selectedWorkPackageIds.forEach(id => state.selected[id] = true);\n\n    this.updatesState.clear();\n    this.pristineState.putValue(state);\n  }\n\n  public isSelected(workPackageId:string):boolean {\n    return !!this.current?.selected[workPackageId];\n  }\n\n  /**\n   * Select all work packages\n   */\n  public selectAll(rows:RenderedWorkPackage[]) {\n    const state:WorkPackageViewSelectionState = this._emptyState;\n\n    rows.forEach((row) => {\n      if (row.workPackageId) {\n        state.selected[row.workPackageId] = true;\n      }\n    });\n\n    this.update(state);\n  }\n\n  /**\n   * Get the current work package resource form the selection state.\n   */\n  public getSelectedWorkPackages():WorkPackageResource[] {\n    let wpState = this.states.workPackages;\n    return this.getSelectedWorkPackageIds().map(id => wpState.get(id).value!);\n  }\n\n  public getSelectedWorkPackageIds():string[] {\n    let selected:string[] = [];\n\n    _.each(this.current?.selected, (isSelected:boolean, wpId:string) => {\n      if (isSelected) {\n        selected.push(wpId);\n      }\n    });\n\n    return selected;\n  }\n\n  /**\n   * Reset the selection state to an empty selection\n   */\n  public reset() {\n    this.update(this._emptyState);\n  }\n\n  public get isEmpty() {\n    return this.selectionCount === 0;\n  }\n\n  /**\n   * Return the number of selected rows.\n   */\n  public get selectionCount():number {\n    return _.size(this.current?.selected);\n  }\n\n  /**\n   * Toggle a single row selection state and update the state.\n   * @param workPackageId\n   */\n  public toggleRow(workPackageId:string) {\n    let isSelected = this.current?.selected[workPackageId];\n    this.setRowState(workPackageId, !isSelected);\n  }\n\n  /**\n   * Force the given work package's selection state. Does not modify other states.\n   * @param workPackageId\n   * @param newState\n   */\n  public setRowState(workPackageId:string, newState:boolean) {\n    let state = this.current || this._emptyState;\n    state.selected[workPackageId] = newState;\n    this.update(state);\n  }\n\n  /**\n   * Override current selection with the given work package id.\n   */\n  public setSelection(wpId:string, position:number) {\n    const current = this._emptyState;\n    current.selected[wpId] = true;\n    current.activeRowIndex = position;\n\n    this.update(current);\n  }\n\n  /**\n   * Select a number of rows from the current `activeRowIndex`\n   * to the selected target.\n   * (aka shift click expansion)\n   */\n  public setMultiSelectionFrom(rows:RenderedWorkPackage[], wpId:string, position:number) {\n    let state = this.current || this._emptyState;\n\n    // If there are no other selections, it does not matter what the index is\n    if (this.selectionCount === 0 || state.activeRowIndex === null) {\n      state.selected[wpId] = true;\n      state.activeRowIndex = position;\n    } else {\n      let start = Math.min(position, state.activeRowIndex);\n      let end = Math.max(position, state.activeRowIndex);\n\n      rows.forEach((row, i) => {\n        if (row.workPackageId) {\n          state.selected[row.workPackageId] = i >= start && i <= end;\n        }\n      });\n    }\n\n    this.update(state);\n  }\n\n  public registerSelectAllListener(renderedElements:() => RenderedWorkPackage[]) {\n    // Bind CTRL+A to select all work packages\n    Mousetrap.bind(['command+a', 'ctrl+a'], (e) => {\n      this.selectAll(renderedElements());\n      e.preventDefault();\n\n      this.opContextMenu.close();\n      return false;\n    });\n  }\n\n  public registerDeselectAllListener() {\n    // Bind CTRL+D to deselect all work packages\n    Mousetrap.bind(['command+d', 'ctrl+d'], (e) => {\n      this.reset();\n      e.preventDefault();\n\n      this.opContextMenu.close();\n      return false;\n    });\n  }\n\n  private get _emptyState():WorkPackageViewSelectionState {\n    return {\n      selected: {},\n      activeRowIndex: null\n    };\n  }\n\n  valueFromQuery(query:QueryResource, results:WorkPackageCollectionResource):WorkPackageViewSelectionState|undefined {\n    return undefined;\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {AfterViewInit, Component, ElementRef, Input, OnInit, ChangeDetectionStrategy} from '@angular/core';\nimport {debounceTime, distinctUntilChanged} from 'rxjs/operators';\nimport {TransitionService} from '@uirouter/core';\nimport {MainMenuToggleService} from \"core-components/main-menu/main-menu-toggle.service\";\nimport {BrowserDetector} from \"core-app/modules/common/browser/browser-detector.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {ResizeDelta} from \"core-app/modules/common/resizer/resizer.component\";\nimport {fromEvent} from \"rxjs\";\n\n@Component({\n  selector: 'wp-resizer',\n  template: `\n    <resizer [customHandler]=\"false\"\n             [resizerClass]=\"resizerClass\"\n             cursorClass=\"col-resize\"\n             (end)=\"resizeEnd()\"\n             (start)=\"resizeStart()\"\n             (move)=\"resizeMove($event)\">\n    </resizer>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\n\nexport class WpResizerDirective extends UntilDestroyedMixin implements OnInit, AfterViewInit {\n  @Input() elementClass:string;\n  @Input() resizeEvent:string;\n  @Input() localStorageKey:string;\n  @Input() resizeStyle:'flexBasis'|'width' = 'flexBasis';\n\n  private resizingElement:HTMLElement;\n  private elementWidth:number;\n  private element:HTMLElement;\n  private resizer:HTMLElement;\n  // Min-width this element is allowed to have\n  private elementMinWidth = 530;\n\n  public moving:boolean = false;\n  public resizerClass = 'work-packages--resizer icon-resizer-vertical-lines';\n\n  constructor(readonly toggleService:MainMenuToggleService,\n              private elementRef:ElementRef,\n              readonly $transitions:TransitionService,\n              readonly browserDetector:BrowserDetector) {\n    super();\n  }\n\n  ngOnInit() {\n    // Get element\n    this.resizingElement = <HTMLElement>document.getElementsByClassName(this.elementClass)[0];\n\n    // Get initial width from local storage and apply\n    let localStorageValue = this.parseLocalStorageValue();\n    this.elementWidth = localStorageValue ||\n                        (this.resizingElement.offsetWidth < this.elementMinWidth ?\n                          this.elementMinWidth :\n                          this.resizingElement.offsetWidth);\n\n    // This case only happens when the timeline is loaded but not displayed.\n    // Therefor the flexbasis will be set to 50%, just in px\n    if (this.elementWidth === 0 && this.resizingElement.parentElement) {\n      this.elementWidth = this.resizingElement.parentElement.offsetWidth / 2;\n    }\n\n    this.resizingElement.style[this.resizeStyle] = this.elementWidth + 'px';\n\n    // Add event listener\n    this.element = this.elementRef.nativeElement;\n\n    // Listen on sidebar changes and toggle column layout, if necessary\n    this.toggleService.changeData$\n      .pipe(\n        distinctUntilChanged(),\n        this.untilDestroyed()\n      )\n      .subscribe(changeData => {\n        this.toggleFullscreenColumns();\n      });\n\n    // Listen to event\n    fromEvent(window, 'resize', { passive: true })\n      .pipe(\n        this.untilDestroyed(),\n        debounceTime(250)\n      )\n      .subscribe(() => this.toggleFullscreenColumns());\n  }\n\n  ngAfterViewInit():void {\n    // Get the reziser\n    this.resizer = <HTMLElement>this.elementRef.nativeElement.getElementsByClassName(this.resizerClass)[0];\n\n    this.applyColumnLayout(this.resizingElement, this.elementWidth);\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n    // Reset the style when killing this directive, otherwise the style remains\n    this.resizingElement.style[this.resizeStyle] = '';\n  }\n\n  resizeStart() {\n    // In case we dragged the resizer farther than the element can actually grow,\n    // we reset it to the actual width at the start of the new resizing\n    let localStorageValue = this.parseLocalStorageValue();\n    let actualElementWidth = this.resizingElement.offsetWidth;\n    if (localStorageValue && localStorageValue > actualElementWidth) {\n      this.elementWidth = actualElementWidth;\n    }\n  }\n\n  resizeEnd() {\n    let localStorageValue = this.parseLocalStorageValue();\n    if (localStorageValue) {\n      this.elementWidth = localStorageValue;\n    }\n\n    // Send a event that we resized this element\n    const event = new Event(this.resizeEvent);\n    window.dispatchEvent(event);\n\n    this.manageErrorClass(false);\n  }\n\n  resizeMove(deltas:ResizeDelta) {\n    // Get new value depending on the delta\n    this.elementWidth = this.elementWidth - deltas.relative.x;\n    let newValue;\n\n    // The resizingElement is not allowed to be smaller than the elementMinWidth\n    if (this.elementWidth < this.elementMinWidth) {\n      newValue = this.elementMinWidth;\n\n      // Show the resizer red when it reaches its limit (min-width)\n      this.manageErrorClass(true);\n    } else {\n      newValue = this.elementWidth;\n\n      this.manageErrorClass(false);\n    }\n\n    // Store item in local storage\n    window.OpenProject.guardedLocalStorage(this.localStorageKey, `${newValue}`);\n\n    // Apply two column layout\n    this.applyColumnLayout(this.resizingElement, newValue);\n\n    // Set new width\n    this.resizingElement.style[this.resizeStyle] = newValue + 'px';\n  }\n\n  private parseLocalStorageValue():number|undefined {\n    let localStorageValue = window.OpenProject.guardedLocalStorage(this.localStorageKey);\n    let number = parseInt(localStorageValue || '', 10);\n\n    if (typeof number === 'number' && number !== NaN) {\n      return number;\n    }\n\n    return undefined;\n  }\n\n  private applyColumnLayout(element:HTMLElement, newWidth:number) {\n    // Apply two column layout in fullscreen view of a workpackage\n    if (element === jQuery('.work-packages-full-view--split-right')[0]) {\n      this.toggleFullscreenColumns();\n    }\n    // Apply two column layout when details view of wp is open\n    else {\n      this.toggleColumns(element, 700);\n    }\n  }\n\n  private toggleColumns(element:HTMLElement, checkWidth:number = 750) {\n    // Disable two column layout for MS Edge (#29941)\n    if (element && !this.browserDetector.isEdge) {\n      jQuery(element).toggleClass('-can-have-columns', element.offsetWidth > checkWidth);\n    }\n  }\n\n  private toggleFullscreenColumns() {\n    let fullScreenLeftView = jQuery('.work-packages-full-view--split-left')[0];\n    this.toggleColumns(fullScreenLeftView);\n  }\n\n  private manageErrorClass(shouldBePresent:boolean) {\n    if (shouldBePresent && !this.resizer.classList.contains('-error-font')) {\n       this.resizer.classList.add('-error-font');\n    }\n\n    if (!shouldBePresent && this.resizer.classList.contains('-error-font')) {\n      this.resizer.classList.remove('-error-font');\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WpRelationInlineCreateServiceInterface} from \"core-components/wp-relations/embedded/wp-relation-inline-create.service.interface\";\nimport {WpRelationInlineAddExistingComponent} from \"core-components/wp-relations/embedded/inline/add-existing/wp-relation-inline-add-existing.component\";\n\n@Injectable()\nexport class WpChildrenInlineCreateService extends WorkPackageInlineCreateService implements WpRelationInlineCreateServiceInterface {\n\n  constructor(readonly injector:Injector,\n              protected readonly wpRelationsHierarchyService:WorkPackageRelationsHierarchyService) {\n    super(injector);\n  }\n\n  /**\n   * A separate reference pane for the inline create component\n   */\n  public readonly referenceComponentClass = WpRelationInlineAddExistingComponent;\n\n  /**\n   * Define the reference type\n   */\n  public relationType:string = 'children';\n\n  /**\n   * Add a new relation of the above type\n   */\n  public add(from:WorkPackageResource, toId:string):Promise<unknown> {\n    return this.wpRelationsHierarchyService.addExistingChildWp(from, toId);\n  }\n\n  /**\n   * Remove a given relation\n   */\n  public remove(from:WorkPackageResource, to:WorkPackageResource):Promise<unknown> {\n    return this.wpRelationsHierarchyService.removeChild(to);\n  }\n\n  /**\n   * A related work package for the inline create context\n   */\n  public referenceTarget:WorkPackageResource|null = null;\n\n  public get canAdd() {\n    return !!(this.referenceTarget && this.canCreateWorkPackages && this.canAddChild);\n  }\n\n  public get canReference() {\n    return !!(this.referenceTarget && this.canAddChild);\n  }\n\n  public get canAddChild() {\n    const wp = this.referenceTarget;\n    return wp && !wp.isMilestone && wp.changeParent;\n  }\n\n  /**\n   * Reference button text\n   */\n  public readonly buttonTexts = {\n    reference: this.I18n.t('js.relation_buttons.add_existing_child'),\n    create: this.I18n.t('js.relation_buttons.add_new_child')\n  };\n}\n","import {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {CurrentUserService} from \"core-components/user/current-user.service\";\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {Injector} from '@angular/core';\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport compareByHrefOrString = AngularTrackingHelpers.compareByHrefOrString;\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageFilterValues {\n\n  @InjectField() currentUser:CurrentUserService;\n  @InjectField() halResourceService:HalResourceService;\n\n  constructor(public injector:Injector,\n              private change:WorkPackageChangeset,\n              private filters:QueryFilterInstanceResource[],\n              private excluded:string[] = []) {\n\n  }\n\n  public applyDefaultsFromFilters() {\n    _.each(this.filters, filter => {\n      // Ignore any filters except =\n      if (filter.operator.id !== '=') {\n        return;\n      }\n\n      // Exclude filters specified in constructor\n      if (this.excluded.indexOf(filter.id) !== -1) {\n        return;\n      }\n\n      // Avoid setting a value if current value is in filter list\n      // and more than one value selected\n      if (this.filterAlreadyApplied(filter)) {\n        return;\n      }\n\n      // Select the first value\n      let value = filter.values[0];\n\n      // Avoid empty values\n      if (value) {\n        this.setValueFor(filter.id, value);\n      }\n    });\n  }\n\n  private setValueFor(field:string, value:string|HalResource) {\n    let newValue = this.findSpecialValue(value, field) || value;\n\n    if (newValue) {\n      this.change.projectedResource[field] = newValue;\n    }\n  }\n\n  /**\n   * Returns special values for which no allowed values exist (e.g., parent ID in embedded queries)\n   * @param {string | HalResource} value\n   * @param {string} field\n   */\n  private findSpecialValue(value:string|HalResource, field:string):string|HalResource|undefined {\n    if (field === 'parent') {\n      return value;\n    }\n\n    if (value instanceof HalResource && value.$href === '/api/v3/users/me' && this.currentUser.isLoggedIn) {\n      return this.halResourceService.fromSelfLink(`/api/v3/users/${this.currentUser.userId}`);\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Avoid applying filter values when\n   *  - more than one filter value selected\n   *  - changeset already matches one of the selected values\n   * @param filter\n   */\n  private filterAlreadyApplied(filter:any):boolean {\n    // Only applicable if more than one selected\n    if (filter.values.length <= 1) {\n      return false;\n    }\n\n    const current = this.change.projectedResource[filter.id];\n\n    for (let i = 0; i < filter.values.length; i++) {\n      if (compareByHrefOrString(current, filter.values[i])) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Inject, Injectable} from '@angular/core';\nimport {DOCUMENT} from \"@angular/common\";\n\n@Injectable({ providedIn: 'root' })\nexport class BannersService {\n\n  private readonly _banners:boolean = true;\n\n  constructor(@Inject(DOCUMENT) protected documentElement:Document) {\n    this._banners = documentElement.body.classList.contains('ee-banners-visible');\n  }\n\n  public get eeShowBanners():boolean {\n    return this._banners;\n  }\n\n  public conditional(bannersVisible?:() => void, bannersNotVisible?:() => void) {\n    this._banners ? this.callMaybe(bannersVisible) : this.callMaybe(bannersNotVisible);\n  }\n\n  private callMaybe(func?:Function) {\n    func && func();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Injector, OnInit} from \"@angular/core\";\nimport {take} from \"rxjs/operators\";\nimport {CausedUpdatesService} from \"core-app/modules/boards/board/caused-updates/caused-updates.service\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {\n  WorkPackageViewDisplayRepresentationService,\n  wpDisplayCardRepresentation\n} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {WorkPackageTableConfigurationObject} from \"core-components/wp-table/wp-table-configuration\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {DeviceService} from \"core-app/modules/common/browser/device.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\n\n@Component({\n  selector: 'wp-list-view',\n  templateUrl: './wp-list-view.component.html',\n  styleUrls: ['./wp-list-view.component.sass'],\n  host: { 'class': 'work-packages-split-view--tabletimeline-side' },\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    { provide: HalResourceNotificationService, useClass: WorkPackageNotificationService },\n    DragAndDropService,\n    CausedUpdatesService\n  ]\n})\nexport class WorkPackageListViewComponent extends UntilDestroyedMixin implements OnInit {\n\n  text = {\n    'jump_to_pagination': this.I18n.t('js.work_packages.jump_marks.pagination'),\n    'text_jump_to_pagination': this.I18n.t('js.work_packages.jump_marks.label_pagination'),\n    'button_settings': this.I18n.t('js.button_settings')\n  };\n\n  /** Switch between list and card view */\n  showListView:boolean = true;\n\n  /** Determine when query is initially loaded */\n  tableInformationLoaded = false;\n\n  /** If loaded list of work packages is empty */\n  noResults:boolean = false;\n\n  /** Whether we should render a blocked view */\n  showResultOverlay$ = this.wpViewFilters.incomplete$;\n\n  /** */\n  readonly wpTableConfiguration:WorkPackageTableConfigurationObject = {\n    dragAndDropEnabled: true\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly injector:Injector,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly wpViewFilters:WorkPackageViewFiltersService,\n              readonly deviceService:DeviceService,\n              readonly CurrentProject:CurrentProjectService,\n              readonly wpDisplayRepresentation:WorkPackageViewDisplayRepresentationService,\n              readonly cdRef:ChangeDetectorRef) {\n    super();\n  }\n\n  ngOnInit() {\n    // Mark tableInformationLoaded when initially loading done\n    this.setupInformationLoadedListener();\n\n    this.querySpace.query.values$().pipe(\n      this.untilDestroyed()\n    ).subscribe((query) => {\n      // Update the visible representation\n      this.updateViewRepresentation(query);\n      this.noResults = query.results.total === 0;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  protected setupInformationLoadedListener() {\n    this\n      .querySpace\n      .initialized\n      .values$()\n      .pipe(take(1))\n      .subscribe(() => {\n        this.tableInformationLoaded = true;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  protected showResizerInCardView():boolean {\n    return false;\n  }\n\n  protected updateViewRepresentation(query:QueryResource) {\n    this.showListView = !(this.deviceService.isMobile ||\n      this.wpDisplayRepresentation.valueFromQuery(query) === wpDisplayCardRepresentation);\n  }\n}\n","<div class=\"result-overlay\"\n     *ngIf=\"(showResultOverlay$ | async) && showListView\"></div>\n\n<!-- TABLE + TIMELINE horizontal split -->\n<wp-table *ngIf=\"tableInformationLoaded && showListView\"\n          [projectIdentifier]=\"CurrentProject.identifier\"\n          [configuration]=\"wpTableConfiguration\"\n          class=\"work-packages-split-view--tabletimeline-content\"></wp-table>\n\n<!-- GRID representation of the WP -->\n<div *ngIf=\"!showListView\"\n     class=\"work-packages--card-view-container\"\n     [ngClass]=\"{ '-with-resizer': showResizerInCardView() }\" >\n  <wp-grid [configuration]=\"wpTableConfiguration\"\n           [showResizer]=\"showResizerInCardView()\"\n           resizerClass=\"work-packages-partitioned-page--content-right\"\n           resizerStorageKey=\"openProject-splitViewFlexBasis\">\n  </wp-grid>\n</div>\n\n<!-- Footer -->\n<div class=\"work-packages-split-view--tabletimeline-footer hide-when-print\"\n     *ngIf=\"tableInformationLoaded\">\n  <wp-table-pagination></wp-table-pagination>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit, ViewChild} from '@angular/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {States} from 'core-components/states.service';\nimport {filter, takeUntil} from 'rxjs/operators';\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ICKEditorContext, ICKEditorInstance} from \"core-app/modules/common/ckeditor/ckeditor-setup.service\";\nimport {OpCkeditorComponent} from \"core-app/modules/common/ckeditor/op-ckeditor.component\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n\nexport const ckeditorAugmentedTextareaSelector = 'ckeditor-augmented-textarea';\n\n@Component({\n  selector: ckeditorAugmentedTextareaSelector,\n  templateUrl: './ckeditor-augmented-textarea.html'\n})\nexport class CkeditorAugmentedTextareaComponent extends UntilDestroyedMixin implements OnInit {\n  public textareaSelector:string;\n  public previewContext:string;\n\n  // Which template to include\n  public $element:JQuery;\n  public formElement:JQuery;\n  public wrappedTextArea:JQuery;\n  public $attachmentsElement:JQuery;\n\n  // Remember if the user changed\n  public changed:boolean = false;\n  public inFlight:boolean = false;\n\n  public initialContent:string;\n  public resource?:HalResource;\n  public context:ICKEditorContext;\n  public macros:boolean;\n  public editorType:string;\n\n  // Reference to the actual ckeditor instance component\n  @ViewChild(OpCkeditorComponent, { static: true }) private ckEditorInstance:OpCkeditorComponent;\n\n  private attachments:HalResource[];\n  private isEditing = false;\n\n  constructor(protected elementRef:ElementRef,\n              protected pathHelper:PathHelperService,\n              protected halResourceService:HalResourceService,\n              protected Notifications:NotificationsService,\n              protected I18n:I18nService,\n              protected states:States,\n              protected ConfigurationService:ConfigurationService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    // Parse the attribute explicitly since this is likely a bootstrapped element\n    this.textareaSelector = this.$element.attr('textarea-selector')!;\n    this.previewContext = this.$element.attr('preview-context')!;\n    this.macros = this.$element.attr('macros') !== 'false';\n    this.editorType = this.$element.attr('editor-type') || 'full';\n\n    // Parse the resource if any exists\n    const source = this.$element.data('resource');\n    this.resource = source ? this.halResourceService.createHalResource(source, true) : undefined;\n\n    this.formElement = this.$element.closest('form');\n    this.wrappedTextArea = this.formElement.find(this.textareaSelector);\n    this.wrappedTextArea\n      .removeAttr('required')\n      .hide();\n    this.initialContent = this.wrappedTextArea.val() as string;\n\n    this.$attachmentsElement = this.formElement.find('#attachments_fields');\n    this.context = { resource: this.resource, previewContext: this.previewContext };\n    if (!this.macros) {\n      this.context['macros'] = 'none';\n    }\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n    this.formElement.off('submit.ckeditor');\n  }\n\n  public markEdited() {\n    window.OpenProject.pageWasEdited = true;\n  }\n\n  public setup(editor:ICKEditorInstance) {\n    // Have a hacky way to access the editor from outside of angular.\n    // This is e.g. employed to set the text from outside to reuse the same editor for different languages.\n    this.$element.data('editor', editor);\n\n    if (this.resource && this.resource.attachments) {\n      this.setupAttachmentAddedCallback(editor);\n      this.setupAttachmentRemovalSignal(editor);\n    }\n\n    // Listen for form submission to set textarea content\n    this.formElement.on('submit.ckeditor change.ckeditor', () => {\n      try {\n        this.wrappedTextArea.val(this.ckEditorInstance.getRawData());\n      } catch (e) {\n        console.error(`Failed to save CKEditor body to textarea: ${e}.`);\n        this.Notifications.addError(e || this.I18n.t('js.error.internal'));\n\n        // Avoid submission of the form\n        return false;\n      }\n\n      this.addUploadedAttachmentsToForm();\n\n      // Continue with submission\n      return true;\n    });\n\n    this.setLabel();\n\n    return editor;\n  }\n\n  private setupAttachmentAddedCallback(editor:ICKEditorInstance) {\n    editor.model.on('op:attachment-added', () => {\n      this.states.forResource(this.resource!)!.putValue(this.resource!);\n    });\n  }\n\n  private setupAttachmentRemovalSignal(editor:ICKEditorInstance) {\n    this.attachments = _.clone(this.resource!.attachments.elements);\n\n    this.states.forResource(this.resource!)!.changes$()\n      .pipe(\n        takeUntil(componentDestroyed(this)),\n        filter(resource => !!resource)\n      ).subscribe(resource => {\n      let missingAttachments = _.differenceBy(this.attachments,\n        resource!.attachments.elements,\n        (attachment:HalResource) => attachment.id);\n\n      let removedUrls = missingAttachments.map(attachment => attachment.downloadLocation.$href);\n\n      if (removedUrls.length) {\n        editor.model.fire('op:attachment-removed', removedUrls);\n      }\n\n      this.attachments = _.clone(resource!.attachments.elements);\n    });\n  }\n\n  private setLabel() {\n    let textareaId = this.textareaSelector.substring(1);\n    let label = jQuery(`label[for=${textareaId}]`);\n\n    let ckContent = this.$element.find('.ck-content');\n\n    ckContent.attr('aria-label', null);\n    ckContent.attr('aria-labelledby', textareaId);\n\n    label.click(() => {\n      ckContent.focus();\n    });\n  }\n\n  private addUploadedAttachmentsToForm() {\n    if (!this.resource || !this.resource.attachments || this.resource.id) {\n      return;\n    }\n\n    const takenIds = this.$attachmentsElement.find('input[type=\\'file\\']').map((index, input) => {\n      let match = (input.getAttribute('name') || '').match(/attachments\\[(\\d+)\\]\\[(?:file|id)\\]/);\n\n      if (match) {\n        return parseInt(match[1]);\n      } else {\n        return 0;\n      }\n    });\n\n    const maxValue:number = takenIds.toArray().sort().pop() || 0;\n\n    let addedAttachments = this.resource.attachments.elements || [];\n\n    jQuery.each(addedAttachments, (index:number, attachment:HalResource) => {\n      this.$attachmentsElement.append(`<input type=\"hidden\" name=\"attachments[${maxValue + index + 1}][id]\" value=\"${attachment.id}\">`);\n    });\n  }\n}\n","<ng-container>\n  <div class=\"op-ckeditor--wrapper\">\n    <op-ckeditor [context]=\"context\"\n                 [content]=\"initialContent\"\n                 [ckEditorType]=\"editorType\"\n                 (onInitialized)=\"setup($event)\"\n                 (onContentChange)=\"markEdited()\">\n    </op-ckeditor>\n  </div>\n\n  <ng-container *ngIf=\"resource && resource.attachments\">\n    <attachments [resource]=\"resource\"\n                 data-allow-uploading=\"true\"\n                 data-destroy-immediately=\"false\">\n    </attachments>\n  </ng-container>\n</ng-container>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from \"@angular/core\";\n\n@Injectable()\nexport class HookService {\n  private hooks:{[hook:string]:Function[]} = {};\n\n  public register(id:string, callback:Function) {\n    if (!callback) {\n      return;\n    }\n\n    if (!this.hooks[id]) {\n      this.hooks[id] = [];\n    }\n\n    this.hooks[id].push(callback);\n  }\n\n  public call(id:string, ...params:any[]):any[] {\n    let results = [];\n\n    if (this.hooks[id]) {\n      for (let x = 0; x < this.hooks[id].length; x++) {\n        let result = this.hooks[id][x](...params);\n\n        if (result) {\n          results.push(result);\n        }\n      }\n    }\n\n    return results;\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  AfterViewInit,\n  Component,\n} from '@angular/core';\nimport {CreateAutocompleterComponent} from \"core-app/modules/common/autocomplete/create-autocompleter.component\";\n\n@Component({\n  templateUrl: './create-autocompleter.component.html',\n  selector: 'wp-autocompleter'\n})\nexport class WorkPackageAutocompleterComponent extends CreateAutocompleterComponent implements AfterViewInit {\n}\n","<ng-select #ngSelectComponent\n           [(ngModel)]=\"model\"\n           [items]=\"availableValues\"\n           [ngClass]=\"classes\"\n           [addTag]=\"createAllowed\"\n           [virtualScroll]=\"true\"\n           [required]=\"required\"\n           [clearable]=\"!required\"\n           [disabled]=\"disabled\"\n           [typeahead]=\"typeahead\"\n           [clearOnBackspace]=\"false\"\n           [appendTo]=\"appendTo\"\n           [hideSelected]=\"hideSelected\"\n           [id]=\"id\"\n           (change)=\"changeModel($event)\"\n           (open)=\"opened()\"\n           (close)=\"closed()\"\n           (keydown)=\"keyPressed($event)\"\n           bindLabel=\"name\">\n  <ng-template ng-tag-tmp let-search=\"searchTerm\">\n    <b [textContent]=\"text.add_new_action\"></b>: {{search}}\n  </ng-template>\n  <ng-template ng-option-tmp let-item=\"item\" let-search=\"searchTerm\">\n    <div [ngOptionHighlight]=\"search\" class=\"ng-option-label ellipsis\">{{ item.name }}</div>\n  </ng-template>\n</ng-select>","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from '@angular/core';\nimport {StateService} from '@uirouter/core';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './overview-tab.html',\n  selector: 'wp-overview-tab',\n})\nexport class WorkPackageOverviewTabComponent extends UntilDestroyedMixin {\n  public workPackageId:string;\n  public workPackage:WorkPackageResource;\n  public tabName = this.I18n.t('js.label_latest_activity');\n\n  public constructor(readonly I18n:I18nService,\n                     readonly $state:StateService,\n                     readonly wpCacheService:WorkPackageCacheService) {\n    super();\n\n    this.workPackageId = this.$state.params.workPackageId;\n    wpCacheService.loadWorkPackage(this.workPackageId)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp) => this.workPackage = wp);\n  }\n}\n","<wp-single-view [workPackage]=\"workPackage\"\n                *ngIf=\"workPackage\"></wp-single-view>\n\n<div class=\"attributes-group\" *ngIf=\"workPackage\">\n  <div class=\"attributes-group--header\">\n    <div class=\"attributes-group--header-container\">\n      <h3 class=\"attributes-group--header-text\" [textContent]=\"tabName\"></h3>\n    </div>\n  </div>\n\n  <newest-activity-on-overview [workPackage]=\"workPackage\"></newest-activity-on-overview>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {input, InputState} from 'reactivestates';\nimport {take} from 'rxjs/operators';\n\nexport abstract class WorkPackageLinkedResourceCache<T> {\n\n  protected cacheDurationInSeconds = 120;\n\n  // Cache activities for the last work package\n  // to allow fast switching between work packages without refreshing.\n  protected cache:{ id:string|null, state:InputState<T> } = {\n    id: null,\n    state: input<T>()\n  };\n\n  /**\n   * Requires the linked resource for the given work package.\n   * Caches a single value for subsequent requests for +cacheDurationInSeconds+ seconds.\n   *\n   * Whenever another work package's linked resource is requested, the cache is replaced.\n   *\n   * @param {WorkPackageResource} workPackage\n   * @returns {Promise<T>}\n   */\n  public require(workPackage:WorkPackageResource, force:boolean = false):Promise<T> {\n    const id = workPackage.id!;\n    const state = this.cache.state;\n\n    // Clear cache if requesting different resource\n    if (force || this.cache.id !== id) {\n      state.clear();\n    }\n\n    // Return cached value if id matches and value is present\n    if (this.isCached(id)) {\n      return Promise.resolve(state.value!);\n    }\n\n    // Ensure value is loaded only once\n    this.cache.id = id;\n    this.cache.state.putFromPromiseIfPristine(() => this.load(workPackage));\n\n    return this.cache.state\n      .values$()\n      .pipe(take(1))\n      .toPromise();\n  }\n\n  public clear(workPackageId:string|null) {\n    if (this.cache.id === workPackageId) {\n      this.cache.state.clear();\n    }\n  }\n\n  /**\n   * Return whether the given work package is cached.\n   * @param {string} workPackageId\n   * @returns {boolean}\n   */\n  public isCached(workPackageId:string) {\n    const state = this.cache.state;\n    return this.cache.id === workPackageId && state.hasValue() && !state.isValueOlderThan(this.cacheDurationInSeconds * 1000);\n  }\n\n  /**\n   * Load the linked resource and return it as a promise\n   * @param {WorkPackageResource} workPackage\n   */\n  protected abstract load(workPackage:WorkPackageResource):Promise<T>;\n}\n","import {Component, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {WorkPackageViewTimelineService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service';\nimport {TimelineLabels, TimelineZoomLevel} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageViewColumnsService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service';\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {zoomLevelOrder} from \"core-components/wp-table/timeline/wp-timeline\";\n\n@Component({\n  templateUrl: './timelines-tab.component.html'\n})\nexport class WpTableConfigurationTimelinesTab implements TabComponent {\n\n  public timelineVisible:boolean = false;\n  public availableAttributes:{ id:string, name:string }[];\n\n  public labels:TimelineLabels;\n  public availableLabels:string[];\n\n  public zoomLevel:TimelineZoomLevel;\n\n  // Manualy build available zoom levels with zoom\n  // because it is not part of the order.\n  public availableZoomLevels:TimelineZoomLevel[] = ['auto', ...zoomLevelOrder];\n\n  public text = {\n    title: this.I18n.t('js.timelines.gantt_chart'),\n    display_timelines: this.I18n.t('js.timelines.button_activate'),\n    display_timelines_hint: this.I18n.t('js.work_packages.table_configuration.show_timeline_hint'),\n    zoom: {\n      level: this.I18n.t('js.tl_toolbar.zooms'),\n      description: this.I18n.t('js.timelines.zoom.description'),\n      days: this.I18n.t('js.timelines.zoom.days'),\n      weeks: this.I18n.t('js.timelines.zoom.weeks'),\n      months: this.I18n.t('js.timelines.zoom.months'),\n      quarters: this.I18n.t('js.timelines.zoom.quarters'),\n      years: this.I18n.t('js.timelines.zoom.years'),\n      auto: this.I18n.t('js.timelines.zoom.auto')\n    },\n    labels: {\n      title: this.I18n.t('js.timelines.labels.title'),\n      description: this.I18n.t('js.timelines.labels.description'),\n      bar: this.I18n.t('js.timelines.labels.bar'),\n      none: this.I18n.t('js.timelines.filter.noneSelection'),\n      left: this.I18n.t('js.timelines.labels.left'),\n      right: this.I18n.t('js.timelines.labels.right'),\n      farRight: this.I18n.t('js.timelines.labels.farRight')\n    }\n  };\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly wpTableTimeline:WorkPackageViewTimelineService,\n              readonly wpTableColumns:WorkPackageViewColumnsService) {\n  }\n\n  public onSave() {\n    this.wpTableTimeline.update({\n      ...this.wpTableTimeline.current,\n      visible: this.timelineVisible,\n      labels: this.labels,\n      zoomLevel: this.zoomLevel\n    });\n  }\n\n  public updateLabels(key:keyof TimelineLabels, value:string|null) {\n    if (value === '') {\n      value = null;\n    }\n\n    this.labels[key] = value;\n  }\n\n  ngOnInit() {\n    this.timelineVisible = this.wpTableTimeline.isVisible;\n\n    // Current zoom level\n    this.zoomLevel = this.wpTableTimeline.zoomLevel;\n\n    // Current label models\n    const labels = this.wpTableTimeline.labels;\n    this.labels = _.clone(labels);\n    this.availableLabels = Object.keys(this.labels);\n\n    // Available labels\n    const availableColumns = this.wpTableColumns\n      .allPropertyColumns\n      .sort((a:QueryColumn, b:QueryColumn) => a.name.localeCompare(b.name));\n\n    this.availableAttributes = [{ id: '', name: this.text.labels.none }].concat(availableColumns);\n  }\n}\n","<div>\n  <form class=\"form\">\n    <div class=\"form--field\">\n      <label class=\"form--label\"\n             [textContent]=\"text.display_timelines\"\n             for=\"display_timelines_switch\"></label>\n      <div class=\"form--field-container\">\n        <div class=\"form--check-box-container\">\n          <input type=\"checkbox\"\n                 (change)=\"timelineVisible = !timelineVisible\"\n                 [checked]=\"timelineVisible\"\n                 id=\"display_timelines_switch\"\n                 name=\"display_timelines_switch\">\n        </div>\n      </div>\n      <p class=\"form--field-instructions\" [textContent]=\"text.display_timelines_hint\"></p>\n    </div>\n    <ng-container *ngIf=\"timelineVisible\">\n      <fieldset class=\"form--fieldset\">\n        <legend class=\"form--fieldset-legend\"\n                [textContent]=\"text.zoom.level\">\n        </legend>\n        <p [textContent]=\"text.zoom.description\"></p>\n\n        <div class=\"form--field\">\n          <div class=\"form--field-container\">\n            <div class=\"form--text-select-container -slim\">\n\n              <select\n                  id=\"modal-timelines-zoomlevel\"\n                  [attr.disabled]=\"autoZoom === true ? 'disabled' : undefined\"\n                  (change)=\"zoomLevel = $event.target.value\"\n                  class=\"form--select\">\n                <option *ngFor=\"let level of availableZoomLevels\"\n                        [textContent]=\"text.zoom[level]\"\n                        [value]=\"level\"\n                        [selected]=\"zoomLevel === level\"></option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n\n      <fieldset class=\"form--fieldset\">\n        <legend class=\"form--fieldset-legend\"\n                [textContent]=\"text.labels.title\">\n        </legend>\n        <p [textContent]=\"text.labels.description\"></p>\n        <div class=\"form--row\" *ngFor=\"let key of availableLabels\">\n          <div class=\"form--field\">\n            <label\n              for=\"modal-timelines-label-{{key}}\"\n              class=\"form--label\">\n              {{ text.labels[key] }}\n            </label>\n            <div class=\"form--field-container\">\n              <div class=\"form--select-container\">\n                <select\n                  id=\"modal-timelines-label-{{key}}\"\n                  (change)=\"updateLabels(key, $event.target.value)\"\n                  class=\"form--select\">\n                  <option *ngFor=\"let column of availableAttributes\"\n                          [textContent]=\"column.name\"\n                          [value]=\"column.id\"\n                          [selected]=\"labels[key] === column.id\"></option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n    </ng-container>\n  </form>\n</div>\n","import {InjectionToken} from \"@angular/core\";\n\nexport const OpQueryConfigurationLocalsToken = new InjectionToken<any>('OpQueryConfigurationLocalsToken');\nexport const OpQueryConfigurationTriggerEvent = 'op:queryconfiguration:trigger';\n","<div #container\n     [ngClass]=\"classes()\">\n  <div *ngIf=\"inReference\"\n       class=\"wp-inline-create--reference-container\">\n    <ndc-dynamic [ndcDynamicComponent]=\"referenceClass\"\n                 [ndcDynamicInjector]=\"injector\"\n                 [ndcDynamicOutputs]=\"referenceOutputs\">\n    </ndc-dynamic>\n  </div>\n\n  <ng-container *ngFor=\"let wp of workPackages; trackBy:trackByHref\">\n    <wp-single-card [workPackage]=\"wp\"\n                    [attr.data-is-new]=\"wp.isNew || undefined\"\n                    [attr.data-work-package-id]=\"wp.id\"\n                    [attr.data-class-identifier]=\"cardView.classIdentifier(wp)\"\n                    [showInfoButton]=\"showInfoButton\"\n                    [showStatusButton]=\"showStatusButton\"\n                    [showRemoveButton]=\"cardsRemovable\"\n                    [highlightingMode]=\"highlightingMode\"\n                    [draggable]=\"this.canDragOutOf(wp)\"\n                    [orientation]=\"orientation\"\n                    [shrinkOnMobile]=\"shrinkOnMobile\"\n                    (onRemove)=\"removeCard(wp)\">\n    </wp-single-card>\n\n    <hr *ngIf=\"shrinkOnMobile\"\n        class=\"form--separator hidden-for-desktop\">\n  </ng-container>\n</div>\n\n<div *ngIf=\"showEmptyResultsBox && isResultEmpty\">\n  <no-results [title]=\"text.noResults.title\" [description]=\"text.noResults.description\"></no-results>\n</div>\n\n\n","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Injector,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from \"@angular/core\";\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {QueryColumn} from \"app/components/wp-query/query-column\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WorkPackageCreateService} from \"core-components/wp-new/wp-create.service\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {CardHighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {StateService} from \"@uirouter/core\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackageViewOrderService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-order.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {filter, map, withLatestFrom} from 'rxjs/operators';\nimport {CausedUpdatesService} from \"core-app/modules/boards/board/caused-updates/caused-updates.service\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {CardViewHandlerRegistry} from \"core-components/wp-card-view/event-handler/card-view-handler-registry\";\nimport {WorkPackageCardViewService} from \"core-components/wp-card-view/services/wp-card-view.service\";\nimport {WorkPackageCardDragAndDropService} from \"core-components/wp-card-view/services/wp-card-drag-and-drop.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {DeviceService} from \"core-app/modules/common/browser/device.service\";\nimport {WorkPackageViewHandlerToken} from \"core-app/modules/work_packages/routing/wp-view-base/event-handling/event-handler-registry\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\n\nexport type CardViewOrientation = 'horizontal'|'vertical';\n\n@Component({\n  selector: 'wp-card-view',\n  styleUrls: ['./styles/wp-card-view.component.sass', './styles/wp-card-view-horizontal.sass', './styles/wp-card-view-vertical.sass'],\n  templateUrl: './wp-card-view.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkPackageCardViewComponent extends UntilDestroyedMixin implements OnInit, AfterViewInit {\n  @Input('dragOutOfHandler') public canDragOutOf:(wp:WorkPackageResource) => boolean;\n  @Input() public dragInto:boolean;\n  @Input() public highlightingMode:CardHighlightingMode;\n  @Input() public workPackageAddedHandler:(wp:WorkPackageResource) => Promise<unknown>;\n  @Input() public showStatusButton:boolean = true;\n  @Input() public showInfoButton:boolean = false;\n  @Input() public orientation:CardViewOrientation = 'vertical';\n  /** Whether cards are removable */\n  @Input() public cardsRemovable:boolean = false;\n  /** Whether a notification box shall be shown when there are no WP to display */\n  @Input() public showEmptyResultsBox:boolean = false;\n  /** Whether on special mobile version of the cards shall be shown */\n  @Input() public shrinkOnMobile:boolean = false;\n\n  /** Container reference */\n  @ViewChild('container', { static: true }) public container:ElementRef;\n\n  @Output() public onMoved = new EventEmitter<void>();\n\n  public trackByHref = AngularTrackingHelpers.trackByHrefAndProperty('lockVersion');\n  public query:QueryResource;\n  public isResultEmpty:boolean = false;\n  public columns:QueryColumn[];\n  public text = {\n    removeCard: this.I18n.t('js.card.remove_from_list'),\n    addNewCard: this.I18n.t('js.card.add_new'),\n    noResults: {\n      title: this.I18n.t('js.work_packages.no_results.title'),\n      description: this.I18n.t('js.work_packages.no_results.description')\n    },\n  };\n\n  /** Inline create / reference properties */\n  public canAdd = false;\n  public canReference = false;\n  public inReference = false;\n  public referenceClass = this.wpInlineCreate.referenceComponentClass;\n  // We need to mount a dynamic component into the view\n  // but map the following output\n  public referenceOutputs = {\n    onCancel: () => this.setReferenceMode(false),\n    onReferenced: (wp:WorkPackageResource) => this.cardDragDrop.addWorkPackageToQuery(wp, 0)\n  };\n\n  constructor(readonly querySpace:IsolatedQuerySpace,\n              readonly states:States,\n              readonly injector:Injector,\n              readonly $state:StateService,\n              readonly I18n:I18nService,\n              readonly wpCreate:WorkPackageCreateService,\n              readonly wpInlineCreate:WorkPackageInlineCreateService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly halEvents:HalEventsService,\n              readonly authorisationService:AuthorisationService,\n              readonly causedUpdates:CausedUpdatesService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly pathHelper:PathHelperService,\n              readonly wpTableSelection:WorkPackageViewSelectionService,\n              readonly wpViewOrder:WorkPackageViewOrderService,\n              readonly cardView:WorkPackageCardViewService,\n              readonly cardDragDrop:WorkPackageCardDragAndDropService,\n              readonly deviceService:DeviceService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.registerCreationCallback();\n\n    // Update permission on model updates\n    this.authorisationService\n      .observeUntil(componentDestroyed(this))\n      .subscribe(() => {\n        this.canAdd = this.wpInlineCreate.canAdd;\n        this.canReference = this.wpInlineCreate.canReference;\n        this.cdRef.detectChanges();\n      });\n\n    // Observe changes to the work packages in this view\n    this.halEvents\n      .aggregated$('WorkPackage')\n      .pipe(\n        map(events => events.filter(event => event.eventType === 'updated')),\n        filter(events => {\n          const wpIds:string[] = this.workPackages.map(el => el.id!.toString());\n          return !!events.find(event => wpIds.indexOf(event.id) !== -1);\n        })\n      ).subscribe(() => {\n      this.workPackages = this.wpViewOrder.orderedWorkPackages();\n      this.cdRef.detectChanges();\n    });\n\n    this.querySpace.results\n      .values$()\n      .pipe(\n        withLatestFrom(this.querySpace.query.values$()),\n        this.untilDestroyed(),\n      ).subscribe(([results, query]) => {\n      this.query = query;\n      this.workPackages = this.wpViewOrder.orderedWorkPackages();\n      this.cardView.updateRenderedCardsValues(this.workPackages);\n      this.isResultEmpty = this.workPackages.length === 0;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  ngAfterViewInit() {\n    this.cardDragDrop.init(this);\n\n    // Register Drag & Drop only on desktop\n    if (!this.deviceService.isMobile) {\n      this.cardDragDrop.registerDragAndDrop();\n    }\n\n    // Register event handlers for the cards\n    let registry = this.injector.get<any>(WorkPackageViewHandlerToken, CardViewHandlerRegistry);\n    if (registry instanceof CardViewHandlerRegistry) {\n      registry.attachTo(this);\n    } else {\n      new registry(this.injector).attachTo(this);\n    }\n    this.wpTableSelection.registerSelectAllListener(() => {\n      return this.cardView.renderedCards;\n    });\n    this.wpTableSelection.registerDeselectAllListener();\n  }\n\n  ngOnDestroy():void {\n    super.ngOnDestroy();\n    this.cardDragDrop.destroy();\n  }\n\n  public get workPackages():WorkPackageResource[] {\n    return this.cardDragDrop.workPackages;\n  }\n\n  public set workPackages(workPackages:WorkPackageResource[]) {\n    this.cardDragDrop.workPackages = workPackages;\n  }\n\n  public setReferenceMode(mode:boolean) {\n    this.inReference = mode;\n    this.cdRef.detectChanges();\n  }\n\n  public addNewCard() {\n    this.cardDragDrop.addNewCard();\n  }\n\n  public removeCard(wp:WorkPackageResource) {\n    this.cardDragDrop.removeCard(wp);\n  }\n\n  async onCardSaved(wp:WorkPackageResource) {\n    await this.cardDragDrop.onCardSaved(wp);\n  }\n\n  public classes() {\n    let classes = 'wp-cards-container ';\n    classes += '-' + this.orientation;\n    classes += this.shrinkOnMobile ? ' -shrink' : '';\n\n    return classes;\n  }\n\n  /**\n   * Listen to newly created work packages to detect whether the WP is the one we created,\n   * and properly reset inline create in this case\n   */\n  private registerCreationCallback() {\n    this.wpCreate\n      .onNewWorkPackage()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(async (wp:WorkPackageResource) => {\n        this.onCardSaved(wp);\n      });\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport class CollectionResource<T = HalResource> extends HalResource {\n  public elements:T[];\n  public count:number;\n  public total:number;\n  public pageSize:number;\n  public offset:number;\n\n  /**\n   * Update the collection's elements and return them in a promise.\n   * This is useful, as angular does not recognize update made by $load.\n   */\n  public updateElements():Promise<unknown> {\n    if (this.$href) {\n      return this.$load().then((collection:this) => this.elements = collection.elements);\n    } else {\n      return Promise.resolve();\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, Component, OnInit} from \"@angular/core\";\nimport {take} from \"rxjs/operators\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {QueryParamListenerService} from \"core-components/wp-query/query-param-listener.service\";\nimport {\n  PartitionedQuerySpacePageComponent,\n  ToolbarButtonComponentDefinition\n} from \"core-app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component\";\nimport {WorkPackageCreateButtonComponent} from \"core-components/wp-buttons/wp-create-button/wp-create-button.component\";\nimport {WorkPackageFilterButtonComponent} from \"core-components/wp-buttons/wp-filter-button/wp-filter-button.component\";\nimport {WorkPackageViewToggleButton} from \"core-components/wp-buttons/wp-view-toggle-button/work-package-view-toggle-button.component\";\nimport {WorkPackageDetailsViewButtonComponent} from \"core-components/wp-buttons/wp-details-view-button/wp-details-view-button.component\";\nimport {WorkPackageTimelineButtonComponent} from \"core-components/wp-buttons/wp-timeline-toggle-button/wp-timeline-toggle-button.component\";\nimport {ZenModeButtonComponent} from \"core-components/wp-buttons/zen-mode-toggle-button/zen-mode-toggle-button.component\";\nimport {WorkPackageSettingsButtonComponent} from \"core-components/wp-buttons/wp-settings-button/wp-settings-button.component\";\nimport {of} from \"rxjs\";\n\n@Component({\n  selector: 'wp-view-page',\n  templateUrl: '/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.html',\n  styleUrls: [\n    // Absolute paths do not work for styleURLs :-(\n    '../partitioned-query-space-page/partitioned-query-space-page.component.sass'\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    /** We need to provide the wpNotification service here to get correct save notifications for WP resources */\n    { provide: HalResourceNotificationService, useClass: WorkPackageNotificationService },\n    QueryParamListenerService\n  ]\n})\nexport class WorkPackageViewPageComponent extends PartitionedQuerySpacePageComponent implements OnInit {\n  toolbarButtonComponents:ToolbarButtonComponentDefinition[] = [\n    {\n      component: WorkPackageCreateButtonComponent,\n      inputs: {\n        stateName$: of(\"work-packages.partitioned.list.new\"),\n        allowed: ['work_packages.createWorkPackage']\n      }\n    },\n    {\n      component: WorkPackageFilterButtonComponent\n    },\n    {\n      component: WorkPackageViewToggleButton,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: WorkPackageDetailsViewButtonComponent,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: WorkPackageTimelineButtonComponent,\n      containerClasses: 'hidden-for-mobile -no-spacing'\n    },\n    {\n      component: ZenModeButtonComponent,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: WorkPackageSettingsButtonComponent\n    }\n  ];\n\n  ngOnInit() {\n    super.ngOnInit();\n    this.text.button_settings = this.I18n.t('js.button_settings');\n  }\n\n  protected additionalLoadingTime():Promise<unknown> {\n    if (this.wpTableTimeline.isVisible) {\n      return this.querySpace.timelineRendered.pipe(take(1)).toPromise();\n    } else {\n      return this.querySpace.tableRendered.valuesPromise() as Promise<unknown>;\n    }\n  }\n\n  protected shouldUpdateHtmlTitle():boolean {\n    return this.$state.current.name === 'work-packages.partitioned.list';\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Inject} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WorkPackageInlineCreateComponent} from \"core-components/wp-inline-create/wp-inline-create.component\";\nimport {WorkPackageRelationsService} from \"core-components/wp-relations/wp-relations.service\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {WpRelationInlineCreateServiceInterface} from \"core-components/wp-relations/embedded/wp-relation-inline-create.service.interface\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {RelationResource} from \"core-app/modules/hal/resources/relation-resource\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  templateUrl: './wp-relation-inline-add-existing.component.html'\n})\nexport class WpRelationInlineAddExistingComponent {\n  public selectedWpId:string;\n  public isDisabled = false;\n\n  public queryFilters = this.buildQueryFilters();\n\n  public text = {\n    abort: this.I18n.t('js.relation_buttons.abort'),\n  };\n\n  constructor(protected readonly parent:WorkPackageInlineCreateComponent,\n              @Inject(WorkPackageInlineCreateService) protected readonly wpInlineCreate:WpRelationInlineCreateServiceInterface,\n              protected wpCacheService:WorkPackageCacheService,\n              protected wpRelations:WorkPackageRelationsService,\n              protected notificationService:WorkPackageNotificationService,\n              protected halEvents:HalEventsService,\n              protected urlParamsHelper:UrlParamsHelperService,\n              protected querySpace:IsolatedQuerySpace,\n              protected readonly I18n:I18nService) {\n  }\n\n  public addExisting() {\n    if (_.isNil(this.selectedWpId)) {\n      return;\n    }\n\n    const newRelationId = this.selectedWpId;\n    this.isDisabled = true;\n\n    this.wpInlineCreate.add(this.workPackage, newRelationId)\n      .then(() => {\n        this.wpCacheService.loadWorkPackage(this.workPackage.id!, true);\n\n        this.halEvents.push(this.workPackage, {\n          eventType: 'association',\n          relatedWorkPackage: newRelationId,\n          relationType: this.relationType,\n        });\n\n        this.isDisabled = false;\n        this.wpInlineCreate.newInlineWorkPackageReferenced.next(newRelationId);\n        this.cancel();\n      })\n      .catch((err:any) => {\n        this.notificationService.handleRawError(err, this.workPackage);\n        this.isDisabled = false;\n        this.cancel();\n      });\n  }\n\n  public onSelected(workPackage?:WorkPackageResource) {\n    if (workPackage) {\n      this.selectedWpId = workPackage.id!;\n      this.addExisting();\n    }\n  }\n\n  public get relationType() {\n    return this.wpInlineCreate.relationType;\n  }\n\n  public get workPackage() {\n    return this.wpInlineCreate.referenceTarget!;\n  }\n\n  public cancel() {\n    this.parent.resetRow();\n  }\n\n  private buildQueryFilters():ApiV3Filter[] {\n    const query = this.querySpace.query.value;\n\n    if (!query) {\n      return [];\n    }\n\n    const relationTypes = RelationResource.RELATION_TYPES(true);\n    let filters = query.filters.filter(filter => {\n      let id = this.urlParamsHelper.buildV3GetFilterIdFromFilter(filter);\n      return relationTypes.indexOf(id) === -1;\n    });\n\n    return this.urlParamsHelper.buildV3GetFilters(filters);\n  }\n}\n","<div class=\"loading-indicator--location\"\n     data-indicator-name=\"relationAddChild\">\n  <div class=\"wp-relations-create--form wp-relations--add-form\">\n    <div class=\"wp-relations-input-section\">\n      <wp-relations-autocomplete\n          [workPackage]=\"workPackage\"\n          (onSelected)=\"onSelected($event)\"\n          [additionalFilters]=\"queryFilters\"\n          [filterCandidatesFor]=\"relationType\"\n          hiddenOverflowContainer=\".work-packages-full-view--split-left\">\n      </wp-relations-autocomplete>\n    </div>\n    <div class=\"wp-relations-controls-section relation-row\">\n      <accessible-by-keyboard\n          linkClass=\"wp-create-relation--cancel\"\n          (execute)=\"cancel()\"\n          aria-hidden=\"false\">\n        <op-icon icon-classes=\"icon-remove\" [icon-title]=\"text.abort\"></op-icon>\n      </accessible-by-keyboard>\n    </div>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\n@Injectable({ providedIn: 'root' })\nexport class HalResourceSortingService {\n\n  /**\n   * List of sortable properties by HAL type\n   */\n  private config:{ [typeName:string]:string } = {\n    'user': 'name',\n    'project': 'name'\n  };\n\n  constructor() {\n  }\n\n  /**\n   * Sort the given HalResource based on its type.\n   * If the type is not given, guess from the first element.\n   *\n   * @param {T[]} elements A collection of HalResources of type T\n   * @param {string} type The HAL type of the collection\n   * @returns {T[]} The sorted collection of HalResources\n   */\n  public sort<T extends HalResource>(elements:T[], type?:string) {\n    if (elements.length === 0) {\n      return elements;\n    }\n\n    const halType = type || elements[0]._type;\n    if (!halType) {\n      return elements;\n    }\n\n    const property = this.sortingProperty(halType);\n    if (property) {\n      return _.sortBy<T>(elements, v => v[property].toLowerCase());\n    } else {\n      return elements;\n    }\n  }\n\n  /**\n   * Transform the HAL type into the sorting property map.\n   *\n   *  - Removes the leading multi identifier [] (e.g., from []User)\n   *  - Transforms to lowercase\n   *\n   * @param {string} type\n   * @returns {string | undefined}\n   */\n  public sortingProperty(type:string):string | undefined {\n    // Remove multi identifier and map to lowercase\n    type = type\n      .toLowerCase()\n      .replace(/^\\[\\]/, '');\n\n    return this.config[type];\n  }\n\n  public hasSortingProperty(type:string) {\n    return this.sortingProperty(type) !== undefined;\n  }\n\n}\n","import {ProjectResource} from 'core-app/modules/hal/resources/project-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {TypeResource} from 'core-app/modules/hal/resources/type-resource';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {input, InputState, multiInput, MultiInputState, StatesGroup} from 'reactivestates';\nimport {QueryColumn} from './wp-query/query-column';\nimport {PostResource} from 'core-app/modules/hal/resources/post-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {StatusResource} from \"core-app/modules/hal/resources/status-resource\";\nimport {QueryFilterInstanceSchemaResource} from \"core-app/modules/hal/resources/query-filter-instance-schema-resource\";\nimport {Subject} from \"rxjs\";\nimport {QuerySortByResource} from \"core-app/modules/hal/resources/query-sort-by-resource\";\nimport {QueryGroupByResource} from \"core-app/modules/hal/resources/query-group-by-resource\";\nimport {VersionResource} from \"core-app/modules/hal/resources/version-resource\";\nimport {WorkPackageDisplayRepresentationValue} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-display-representation.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\n\nexport class States extends StatesGroup {\n  name = 'MainStore';\n\n  /* /api/v3/projects */\n  projects:MultiInputState<ProjectResource> = multiInput<ProjectResource>();\n\n  /* /api/v3/work_packages */\n  workPackages = multiInput<WorkPackageResource>();\n\n  /* /api/v3/wiki_pages */\n  posts = multiInput<PostResource>();\n\n  /* /api/v3/schemas */\n  schemas = multiInput<SchemaResource>();\n\n  /* /api/v3/types */\n  types = multiInput<TypeResource>();\n\n  /* /api/v3/statuses */\n  statuses = multiInput<StatusResource>();\n\n  /* /api/v3/time_entries */\n  timeEntries:MultiInputState<TimeEntryResource> = multiInput<TimeEntryResource>();\n\n  /* /api/v3/versions */\n  versions = multiInput<VersionResource>();\n\n  /* /api/v3/users */\n  users = multiInput<UserResource>();\n\n  // Work Package query states\n  queries = new QueryAvailableDataStates();\n\n  // Global events to isolated changes\n  changes = new GlobalStateChanges();\n\n  // Additional state map that can be dynamically registered.\n  additional:{ [id:string]:MultiInputState<HalResource> } = {};\n\n  forResource(resource:HalResource):InputState<HalResource>|undefined {\n    const stateName = _.camelCase(resource._type) + 's';\n    let state = (this as any)[stateName] || this.additional[stateName];\n\n    if (!state) {\n      state = this.additional[stateName] = multiInput<HalResource>();\n    }\n\n    return state && state.get(resource.id!);\n  }\n\n  public add(name:string, state:MultiInputState<HalResource>) {\n    this.additional[name] = state;\n  }\n}\n\nexport class GlobalStateChanges {\n  // Global subject on changes to the given query ID\n  queries = new Subject();\n}\n\nexport class QueryAvailableDataStates {\n  // Available columns\n  columns = input<QueryColumn[]>();\n\n  // Available SortBy Columns\n  sortBy = input<QuerySortByResource[]>();\n\n  // Available GroupBy columns\n  groupBy = input<QueryGroupByResource[]>();\n\n  // Available filter schemas (derived from their schema)\n  filters = input<QueryFilterInstanceSchemaResource[]>();\n\n  // Display of the WP results\n  displayRepresentation = input<WorkPackageDisplayRepresentationValue|null>();\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {AttachmentCollectionResource} from 'core-app/modules/hal/resources/attachment-collection-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {TypeResource} from 'core-app/modules/hal/resources/type-resource';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {\n  OpenProjectFileUploadService,\n  UploadFile\n} from 'core-components/api/op-file-upload/op-file-upload.service';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {States} from 'core-components/states.service';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {SchemaCacheService} from 'core-components/schemas/schema-cache.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {Attachable} from 'core-app/modules/hal/resources/mixins/attachable-mixin';\nimport {WorkPackageDmService} from \"core-app/modules/hal/dm-services/work-package-dm.service\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {InputState} from \"reactivestates\";\nimport {WorkPackagesActivityService} from \"core-components/wp-single-view-tabs/activity-panel/wp-activity.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport interface WorkPackageResourceEmbedded {\n  activities:CollectionResource;\n  ancestors:WorkPackageResource[];\n  assignee:HalResource|any;\n  attachments:AttachmentCollectionResource;\n  author:HalResource|any;\n  availableWatchers:HalResource|any;\n  category:HalResource|any;\n  children:WorkPackageResource[];\n  parent:WorkPackageResource|null;\n  priority:HalResource|any;\n  project:HalResource|any;\n  relations:CollectionResource;\n  responsible:HalResource|any;\n  revisions:CollectionResource|any;\n  status:HalResource|any;\n  timeEntries:HalResource[]|any[];\n  type:TypeResource;\n  version:HalResource|any;\n  watchers:CollectionResource;\n  // For regular work packages\n  startDate:string;\n  dueDate:string;\n  // Only for milestones\n  date:string;\n  relatedBy:RelationResource|null;\n}\n\nexport interface WorkPackageResourceLinks extends WorkPackageResourceEmbedded {\n  addAttachment(attachment:HalResource):Promise<any>;\n\n  addChild(child:HalResource):Promise<any>;\n\n  addComment(comment:unknown, headers?:any):Promise<any>;\n\n  addRelation(relation:any):Promise<any>;\n\n  addWatcher(watcher:HalResource):Promise<any>;\n\n  changeParent(params:any):Promise<any>;\n\n  copy():Promise<WorkPackageResource>;\n\n  delete():Promise<any>;\n\n  logTime():Promise<any>;\n\n  move():Promise<any>;\n\n  removeWatcher():Promise<any>;\n\n  self():Promise<WorkPackageResource>;\n\n  update(payload:any):Promise<FormResource<WorkPackageResource>>;\n\n  updateImmediately(payload:any):Promise<WorkPackageResource>;\n\n  watch():Promise<any>;\n}\n\nexport interface WorkPackageLinksObject extends WorkPackageResourceLinks {\n  schema:HalResource;\n}\n\nexport class WorkPackageBaseResource extends HalResource {\n  public $embedded:WorkPackageResourceEmbedded;\n  public $links:WorkPackageLinksObject;\n  public subject:string;\n  public updatedAt:Date;\n  public lockVersion:number;\n  public description:any;\n  public activities:CollectionResource;\n  public attachments:AttachmentCollectionResource;\n\n  public overriddenSchema:SchemaResource|undefined = undefined;\n  @InjectField() I18n:I18nService;\n  @InjectField() tates:States;\n  @InjectField() wpActivity:WorkPackagesActivityService;\n  @InjectField() workPackageDmService:WorkPackageDmService;\n  @InjectField() wpCacheService:WorkPackageCacheService;\n  @InjectField() schemaCacheService:SchemaCacheService;\n  @InjectField() NotificationsService:NotificationsService;\n  @InjectField() workPackageNotificationService:WorkPackageNotificationService;\n  @InjectField() pathHelper:PathHelperService;\n  @InjectField() opFileUpload:OpenProjectFileUploadService;\n\n  readonly attachmentsBackend = true;\n\n  /**\n   * Return the ids of all its ancestors, if any\n   */\n  public get ancestorIds():string[] {\n    const ancestors = (this as any).ancestors;\n    return ancestors.map((el:WorkPackageResource) => el.id!);\n  }\n\n  public get isReadonly():boolean {\n    return this.status && this.status.isReadonly;\n  }\n\n  /**\n   * Return \"<type name>: <subject> (#<id>)\" if type and id are known.\n   */\n  public subjectWithType(truncateSubject:number = 40):string {\n    const type = this.type ? `${this.type.name}: ` : '';\n    const subject = this.subjectWithId(truncateSubject);\n\n    return `${type}${subject}`;\n  }\n\n  /**\n   * Return \"<subject> (#<id>)\" if the id is known.\n   */\n  public subjectWithId(truncateSubject:number = 40):string {\n    const id = this.isNew ? '' : ` (#${this.id})`;\n    const subject = _.truncate(this.subject, {length: truncateSubject});\n\n    return `${subject}${id}`;\n  }\n\n  public get isMilestone():boolean {\n    return this.schema.hasOwnProperty('date');\n  }\n\n  public get isLeaf():boolean {\n    var children = this.$links.children;\n    return !(children && children.length > 0);\n  }\n\n  /**\n   * Return whether the user in general has permission to edit the work package.\n   * This check is required, but not sufficient to check all attribute restrictions.\n   *\n   * Use +isAttributeEditable(property)+ for this case.\n   */\n  public get isEditable() {\n    return this.isNew || !!this.$links.update;\n  }\n\n  public previewPath() {\n    if (!this.isNew) {\n      return this.pathHelper.api.v3.work_packages.id(this.id!).path;\n    } else {\n      return super.previewPath();\n    }\n  }\n\n  public getEditorTypeFor(fieldName:string):\"full\"|\"constrained\" {\n    return fieldName === 'description' ? 'full' : 'constrained';\n  }\n\n  /**\n   * Return whether the work package is editable with the user's permission\n   * on the given work package attribute.\n   *\n   * @param property\n   */\n  public isAttributeEditable(property:string):boolean {\n    const fieldSchema = this.schema[property];\n\n    return this.isEditable &&\n      fieldSchema &&\n      fieldSchema.writable &&\n      (!this.isReadonly || property === 'status');\n  }\n\n  private performUpload(files:UploadFile[]) {\n    let href = '';\n\n    if (this.isNew) {\n      href = this.pathHelper.api.v3.attachments.path;\n    } else {\n      href = this.attachments.$href!;\n    }\n\n    return this.opFileUpload.uploadAndMapResponse(href, files);\n  }\n\n  public getSchemaName(name:string):string {\n    if (this.isMilestone && (name === 'startDate' || name === 'dueDate')) {\n      return 'date';\n    } else {\n      return name;\n    }\n  }\n\n  public isParentOf(otherWorkPackage:WorkPackageResource) {\n    return otherWorkPackage.parent?.$links.self.$link.href === this.$links.self.$link.href;\n  }\n\n  /**\n   * Invalidate a set of linked resources of this work package.\n   * And inform the cache service about the work package update.\n   *\n   * Return a promise that returns the linked resources as properties.\n   * Return a rejected promise, if the resource is not a property of the work package.\n   */\n  public updateLinkedResources(...resourceNames:string[]):Promise<any> {\n    const resources:{ [id:string]:Promise<HalResource> } = {};\n\n    resourceNames.forEach(name => {\n      const linked = this[name];\n      resources[name] = linked ? linked.$update() : Promise.reject(undefined);\n    });\n\n    const promise = Promise.all(_.values(resources));\n    promise.then(() => {\n      this.wpCacheService.touch(this.id!);\n    });\n\n    return promise;\n  }\n\n  /**\n   * Assign values from the form for a newly created work package resource.\n   * @param form\n   */\n  public initializeNewResource(form:FormResource) {\n    this.overriddenSchema = form.schema;\n    this.$source.id = 'new';\n\n    // Ensure type is set to identify the resource\n    this._type = 'WorkPackage';\n\n    // Since the ID will change upon saving, keep track of the WP\n    // with the actual creation date\n    this.__initialized_at = Date.now();\n\n    // Set update link to form\n    this['update'] = this.$links.update = form.$links.self;\n    // Use POST /work_packages for saving link\n    this['updateImmediately'] = this.$links.updateImmediately = (payload) => {\n      return this.workPackageDmService.createWorkPackage(payload);\n    };\n  }\n\n  public $initialize(source:any) {\n    super.$initialize(source);\n\n    let attachments:any = this.attachments || {$source: {}, elements: []};\n    this.attachments = new AttachmentCollectionResource(\n      this.injector,\n      // Attachments MAY be an array if we're building from a form\n      _.get(attachments, '$source', attachments),\n      false,\n      this.halInitializer,\n      'HalResource'\n    );\n  }\n\n  /**\n   * Exclude the schema _link from the linkable Resources.\n   */\n  public $linkableKeys():string[] {\n    return _.without(super.$linkableKeys(), 'schema');\n  }\n\n  /**\n   * Get the current schema, assuming it is either:\n   * 1. Overridden by the current loaded form\n   * 2. Available as a schema state\n   *\n   * If it is neither, an exception is raised.\n   */\n  public get schema():SchemaResource {\n    if (this.hasOverriddenSchema) {\n      return this.overriddenSchema!;\n    }\n\n    const state = this.schemaCacheService.state(this as any);\n\n    if (!state.hasValue()) {\n      throw `Accessing schema of ${this.id} without it being loaded.`;\n    }\n\n    return state.value!;\n  }\n\n  /**\n   * Return the associated state to this HAL resource, if any.\n   */\n  public get state():InputState<this> {\n    return this.states.workPackages.get(this.id!) as any;\n  }\n\n  /**\n   * Update the state\n   */\n  public push(newValue:this):Promise<unknown> {\n    this.wpActivity.clear(newValue.id!);\n\n    // If there is a parent, its view has to be updated as well\n    if (newValue.parent) {\n      this.wpCacheService.require(newValue.parent.id!, true);\n    }\n\n    return this.wpCacheService.updateWorkPackage(newValue as any);\n  }\n\n  public get hasOverriddenSchema():boolean {\n    return this.overriddenSchema != null;\n  }\n}\n\nexport const WorkPackageResource = Attachable(WorkPackageBaseResource);\n\nexport interface WorkPackageResource extends WorkPackageBaseResource, WorkPackageResourceLinks, WorkPackageResourceEmbedded {\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  AfterViewInit,\n  Component,\n ViewEncapsulation,\n Output,\n EventEmitter,\n ChangeDetectorRef,\n} from '@angular/core';\nimport {WorkPackageAutocompleterComponent} from \"core-app/modules/common/autocomplete/wp-autocompleter.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\n\nexport type TimeEntryWorkPackageAutocompleterMode = 'all'|'recent';\n\n@Component({\n  templateUrl: './te-work-package-autocompleter.component.html',\n  styleUrls: ['./te-work-package-autocompleter.component.sass'],\n  selector: 'te-work-package-autocompleter',\n  encapsulation: ViewEncapsulation.None\n})\nexport class TimeEntryWorkPackageAutocompleterComponent extends WorkPackageAutocompleterComponent implements AfterViewInit {\n  @Output() modeSwitch = new EventEmitter<TimeEntryWorkPackageAutocompleterMode>();\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly currentProject:CurrentProjectService,\n              readonly pathHelper:PathHelperService) {\n    super(I18n, cdRef, currentProject, pathHelper);\n\n    this.text['all'] = this.I18n.t('js.label_all');\n    this.text['recent'] = this.I18n.t('js.label_recent');\n  }\n\n  public loading:boolean = false;\n  public mode:TimeEntryWorkPackageAutocompleterMode = 'all';\n\n  public setMode(value:TimeEntryWorkPackageAutocompleterMode) {\n    if (value !== this.mode) {\n      this.modeSwitch.emit(value);\n    }\n    this.mode = value;\n  }\n}\n","<ng-select #ngSelectComponent\n           [(ngModel)]=\"model\"\n           [items]=\"availableValues\"\n           [ngClass]=\"classes\"\n           [addTag]=\"createAllowed\"\n           [virtualScroll]=\"true\"\n           [required]=\"required\"\n           [clearable]=\"!required\"\n           [disabled]=\"disabled\"\n           [typeahead]=\"typeahead\"\n           [clearOnBackspace]=\"false\"\n           [appendTo]=\"appendTo\"\n           [hideSelected]=\"hideSelected\"\n           [loading]=\"finishedLoading | async\"\n           [id]=\"id\"\n           (change)=\"changeModel($event)\"\n           (open)=\"opened()\"\n           (close)=\"closed()\"\n           (keydown)=\"keyPressed($event)\"\n           bindLabel=\"name\">\n  <ng-template ng-header-tmp>\n    <div class=\"scrollable-tabs -narrow\">\n      <ul class=\"tabrow\">\n        <li [ngClass]=\"{'selected': mode === 'all'}\"\n            (click)=\"setMode('all')\">\n          <a href=\"#\" [textContent]=\"text.all\">\n          </a>\n        </li>\n        <li [ngClass]=\"{'selected': mode === 'recent'}\"\n            (click)=\"setMode('recent')\">\n          <a href=\"#\" [textContent]=\"text.recent\">\n          </a>\n        </li>\n      </ul>\n    </div>\n  </ng-template>\n  <ng-template ng-tag-tmp let-search=\"searchTerm\">\n    <b [textContent]=\"text.add_new_action\"></b>: {{search}}\n  </ng-template>\n  <ng-template ng-option-tmp let-item=\"item\" let-search=\"searchTerm\">\n    <div [ngOptionHighlight]=\"search\" class=\"ng-option-label ellipsis\">{{ item.name }}</div>\n  </ng-template>\n</ng-select>\n","import {concat, Observable, of, Subject} from \"rxjs\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {\n  catchError,\n  debounceTime,\n  distinctUntilChanged,\n  switchMap,\n  takeUntil,\n  tap\n} from \"rxjs/operators\";\nimport {RequestSwitchmapHandler} from \"core-app/helpers/rxjs/request-switchmap\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\n\nexport type RequestErrorHandler = (error:unknown) => void;\n\nexport function errorNotificationHandler(service:HalResourceNotificationService):RequestErrorHandler {\n  return (error:unknown) => service.handleRawError(error);\n}\n\nexport class DebouncedRequestSwitchmap<T, R = HalResource> {\n\n  /** Input request state */\n  public input$ = new Subject<T>();\n\n  /** Output results observable */\n  public output$:Observable<R[]>;\n\n  /** Loading flag */\n  public loading$ = new Subject<boolean>();\n\n  /** Whether results were returned */\n  public lastResult:R[] = [];\n\n  /** Last requested value */\n  public lastRequestedValue:T|undefined;\n\n  /**\n   * @param handler switch map handler function to output a response observable\n   * @param debounceTime {number} Time to debounce in ms.\n   * @param emptyValue {R} The empty fall back value before first response or on errors\n   */\n  constructor(readonly requestHandler:RequestSwitchmapHandler<T, R[]>,\n              readonly errorHandler:RequestErrorHandler,\n              readonly debounceMs = 250) {\n\n    /** Output switchmap observable */\n    this.output$ = concat(\n      of([]),\n      this.input$.pipe(\n        distinctUntilChanged(),\n        debounceTime(debounceMs),\n        tap((val:T) => {\n          this.lastRequestedValue = val;\n          this.lastResult = [];\n          this.loading$.next(true);\n        }),\n        switchMap(term =>\n          this.requestHandler(term)\n            .pipe(\n              catchError((error) => {\n                this.errorHandler(error);\n                return of([]);\n              }),\n              tap((results) => {\n                this.loading$.next(false);\n                this.lastResult = results;\n              })\n            )\n        )\n      )\n    );\n  }\n\n  /**\n   * Append a new request for the given request value and pass\n   * that to the switchmap handler\n   * @param newValue\n   */\n  public request(newValue:T) {\n    this.input$.next(newValue);\n  }\n\n  /**\n   * Returns whether the last results returned anything\n   */\n  public get hasResults() {\n    return this.lastResult.length > 0;\n  }\n\n  /**\n   * Observe the switched response\n   */\n  public observe(until:Observable<unknown>) {\n    return this\n      .output$\n      .pipe(\n        takeUntil(until)\n      );\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {AbstractDmService} from \"core-app/modules/hal/dm-services/abstract-dm.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {PayloadDmService} from \"core-app/modules/hal/dm-services/payload-dm.service\";\n\n@Injectable()\nexport class TimeEntryDmService extends AbstractDmService<TimeEntryResource> {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService,\n              protected payloadDm:PayloadDmService) {\n    super(halResourceService, pathHelper);\n  }\n\n  protected listUrl() {\n    return this.pathHelper.api.v3.time_entries.toString();\n  }\n\n  protected oneUrl(id:number|string) {\n    return this.pathHelper.api.v3.time_entries.id(id).toString();\n  }\n\n  public update(resource:TimeEntryResource, schema:SchemaResource|null = null) {\n    let payload = this.extractPayload(resource, schema);\n\n    return this.halResourceService.patch<TimeEntryResource>(resource.updateImmediately.$link.href, payload).toPromise();\n  }\n\n  public updateForm(resource:TimeEntryResource, schema:SchemaResource|null = null) {\n    let payload = this.extractPayload(resource, schema);\n\n    return this.halResourceService.post<FormResource>(this.pathHelper.api.v3.time_entries.id(resource.idFromLink).form.toString(),\n      payload).toPromise();\n  }\n\n  public createForm(payload:{}) {\n    return this.halResourceService.post<FormResource>(this.pathHelper.api.v3.time_entries.form.toString(), payload).toPromise();\n  }\n\n  public create(payload:{}):Promise<TimeEntryResource> {\n    return this.halResourceService\n      .post<TimeEntryResource>(this.pathHelper.api.v3.time_entries.path, payload)\n      .toPromise();\n  }\n\n  public delete(resource:TimeEntryResource) {\n    return this.halResourceService\n      .delete<TimeEntryResource>(this.pathHelper.api.v3.time_entries.id(resource.idFromLink).toString())\n      .toPromise();\n  }\n\n  public extractPayload(resource:TimeEntryResource|null = null, schema:SchemaResource|null = null) {\n    if (resource && schema) {\n      return this.payloadDm.extract(resource, schema);\n    } else if (!(resource instanceof HalResource)) {\n      return resource;\n    } else {\n      return {};\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, ElementRef, Input, OnInit} from '@angular/core';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {States} from 'core-components/states.service';\nimport {filter} from 'rxjs/operators';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const attachmentsSelector = 'attachments';\n\n@Component({\n  selector: attachmentsSelector,\n  templateUrl: './attachments.html'\n})\nexport class AttachmentsComponent extends UntilDestroyedMixin implements OnInit {\n  @Input('resource') public resource:HalResource;\n\n  public $element:JQuery;\n  public allowUploading:boolean;\n  public destroyImmediately:boolean;\n  public text:any;\n\n  constructor(protected elementRef:ElementRef,\n              protected I18n:I18nService,\n              protected states:States,\n              protected halResourceService:HalResourceService) {\n    super();\n\n    this.text = {\n      attachments: this.I18n.t('js.label_attachments'),\n    };\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    if (!this.resource) {\n      // Parse the resource if any exists\n      const source = this.$element.data('resource');\n      this.resource = this.halResourceService.createHalResource(source, true);\n    }\n\n    this.allowUploading = this.$element.data('allow-uploading');\n\n    if (this.$element.data('destroy-immediately') !== undefined) {\n      this.destroyImmediately = this.$element.data('destroy-immediately');\n    } else {\n      this.destroyImmediately = true;\n    }\n\n    this.setupResourceUpdateListener();\n  }\n\n  public setupResourceUpdateListener() {\n    this.states.forResource(this.resource)!.changes$()\n      .pipe(\n        this.untilDestroyed(),\n        filter(newResource => !!newResource)\n      )\n      .subscribe((newResource:HalResource) => {\n        this.resource = newResource || this.resource;\n      });\n  }\n\n  // Only show attachment list when allow uploading is set\n  // or when at least one attachment exists\n  public showAttachments() {\n    return this.allowUploading || _.get(this.resource, 'attachments.count', 0) > 0;\n  }\n}\n","<fieldset class=\"form--fieldset\" *ngIf=\"showAttachments()\">\n  <legend class=\"form--fieldset-legend\">\n    {{ text.attachments }}\n  </legend>\n  <div id=\"attachments_fields\">\n    <attachment-list *ngIf=\"resource.attachments\"\n                     [resource]=\"resource\"\n                     [destroyImmediately]=\"destroyImmediately\">\n    </attachment-list>\n    <attachments-upload [resource]=\"resource\"\n                        class=\"hide-when-print\"\n                        *ngIf=\"allowUploading\">\n    </attachments-upload>\n  </div>\n</fieldset>\n\n","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output,\n  ViewChild\n} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {DragulaService, Group} from \"ng2-dragula\";\nimport {DomAutoscrollService} from \"core-app/modules/common/drag-and-drop/dom-autoscroll.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {merge} from \"rxjs\";\nimport {DomHelpers} from \"core-app/helpers/dom/set-window-cursor.helper\";\n\nexport interface DraggableOption {\n  name:string;\n  id:string;\n}\n\n@Component({\n  selector: 'draggable-autocompleter',\n  templateUrl: './draggable-autocomplete.component.html',\n  styleUrls: ['./draggable-autocomplete.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DraggableAutocompleteComponent extends UntilDestroyedMixin implements OnInit, AfterViewInit {\n  /** Options to show in the autocompleter */\n  @Input() options:DraggableOption[];\n\n  /** Should we focus the autocompleter ? */\n  @Input() autofocus:boolean = true;\n\n  /** Order list of selected items */\n  @Input('selected') _selected:DraggableOption[] = [];\n\n  /** Output when autocompleter changes values or items removed */\n  @Output() onChange = new EventEmitter<DraggableOption[]>();\n\n  /** List of items still available for selection */\n  availableOptions:DraggableOption[] = [];\n\n  private autoscroll:any;\n  private columnsGroup:Group;\n\n  @ViewChild('ngSelectComponent') public ngSelectComponent:NgSelectComponent;\n\n  text = {\n    placeholder: this.I18n.t('js.label_add_columns')\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly dragula:DragulaService) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.updateAvailableOptions();\n\n    // Setup groups\n    this.columnsGroup = this.dragula.createGroup('columns', {});\n\n    // Set cursor when dragging\n    this.dragula.drag('columns')\n      .pipe(this.untilDestroyed())\n      .subscribe(() => DomHelpers.setBodyCursor('move', 'important'));\n\n    // Reset cursor when cancel or dropped\n    merge(\n      this.dragula.drop(\"columns\"),\n      this.dragula.cancel(\"columns\")\n    )\n      .pipe(this.untilDestroyed())\n      .subscribe(() => DomHelpers.setBodyCursor('auto'));\n\n    // Setup autoscroll\n    const that = this;\n    this.autoscroll = new DomAutoscrollService(\n      [\n        document.getElementById('content-wrapper')!\n      ],\n      {\n        margin: 25,\n        maxSpeed: 10,\n        scrollWhenOutside: true,\n        autoScroll: function (this:any) {\n          return this.down && that.columnsGroup.drake.dragging;\n        }\n      });\n  }\n\n  ngAfterViewInit():void {\n    if (this.autofocus) {\n      this.ngSelectComponent.focus();\n    }\n  }\n\n  ngOnDestroy():void {\n    super.ngOnDestroy();\n\n    this.dragula.destroy('columns');\n  }\n\n  select(item:DraggableOption|undefined) {\n    if (!item) {\n      return;\n    }\n\n    this.selected = [...this.selected, item];\n\n    // Remove selection\n    this.ngSelectComponent.clearModel();\n  }\n\n  remove(item:DraggableOption) {\n    this.selected = this.selected.filter(selected => selected.id !== item.id);\n  }\n\n  get selected() {\n    return this._selected;\n  }\n\n  set selected(val:DraggableOption[]) {\n    this._selected = val;\n    this.updateAvailableOptions();\n\n    this.onChange.emit(this.selected);\n  }\n\n  opened() {\n    // Force reposition as a workaround for BUG\n    // https://github.com/ng-select/ng-select/issues/1259\n    setTimeout(() => {\n      const component = this.ngSelectComponent as any;\n      if (component && component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n    }, 25);\n  }\n\n  private updateAvailableOptions() {\n    this.availableOptions = this.options\n      .filter(item => !this.selected.find(selected => selected.id === item.id));\n  }\n}\n","<div class=\"draggable-autocomplete--container\">\n  <div class=\"draggable-autocomplete--selected\"\n       dragula=\"columns\"\n       [(dragulaModel)]=\"selected\">\n    <div class=\"draggable-autocomplete--item\" *ngFor=\"let item of selected\">\n      <span class=\"draggable-autocomplete--item-text\"\n            [textContent]=\"item.name\"></span>\n      <a (click)=\"remove(item)\"\n         class=\"draggable-autocomplete--remove-item icon-remove\"></a>\n    </div>\n  </div>\n\n  <ng-select #ngSelectComponent\n             [items]=\"availableOptions\"\n             ngClass=\"draggable-autocomplete--input\"\n             bindLabel=\"name\"\n             [multiple]=\"false\"\n             [virtualScroll]=\"true\"\n             appendTo=\"body\"\n             [placeholder]=\"text.placeholder\"\n             [clearSearchOnAdd]=\"true\"\n             [closeOnSelect]=\"true\"\n             (open)=\"opened()\"\n             (change)=\"select($event)\">\n  </ng-select>\n</div>\n","import {utils} from \"@xeokit/xeokit-sdk/src/viewer/scene/utils\";\n/**\n * Default server client which loads content via HTTP from the file system.\n */\nclass XeokitServer {\n\n  /**\n   *\n   * @param cfg\n   * @param.cfg.dataDir Base directory for content.\n   */\n  constructor(cfg = {}) {\n    this._dataDir = cfg.dataDir || \"\";\n  }\n\n  /**\n   * Gets the manifest of all projects.\n   * @param done\n   * @param error\n   */\n  getProjects(done, _error) {\n    done({ projects: window.gon.ifc_models.projects });\n  }\n\n  /**\n   * Gets a manifest for a project.\n   * @param projectId\n   * @param done\n   * @param error\n   */\n  getProject(projectData, done, _error) {\n    var manifestData = {\n      id: projectData[0].id,\n      name: projectData[0].name,\n      models: window.gon.ifc_models.models,\n      viewerContent: {\n        modelsLoaded: window.gon.ifc_models.shown_models\n      },\n      viewerConfigs: {\n        saoEnabled: true // Needs to be enabled by default if we want to use it selectively on the available models.\n      }\n    };\n\n    done(manifestData);\n  }\n\n  /**\n   * Gets metadata for a model within a project.\n   * @param projectId\n   * @param modelId\n   * @param done\n   * @param error\n   */\n  getMetadata(_projectId, modelId, done, error) {\n    const attachmentId = window.gon.ifc_models.metadata_attachment_ids[modelId];\n    console.log(`Loading model metadata for: ${attachmentId}`);\n    utils.loadJSON(this.attachmentUrl(attachmentId), done, error);\n  }\n\n  /**\n   * Gets geometry for a model within a project.\n   * @param projectId\n   * @param modelId\n   * @param done\n   * @param error\n   */\n  getGeometry(projectId, modelId, done, error) {\n    const attachmentId = window.gon.ifc_models.xkt_attachment_ids[modelId];\n    console.log(`Loading model geometry for: ${attachmentId}`);\n    utils.loadArraybuffer(this.attachmentUrl(attachmentId), done, error);\n  }\n\n  attachmentUrl(attachmentId) {\n    return \"/api/v3/attachments/\" + attachmentId + \"/content\";\n  }\n}\n\nexport {XeokitServer};","import {Injectable, Inject, Injector} from '@angular/core';\nimport {XeokitServer} from \"core-app/modules/bim/ifc_models/xeokit/xeokit-server\";\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\nimport {ViewerBridgeService} from \"core-app/modules/bim/bcf/bcf-viewer-bridge/viewer-bridge.service\";\nimport {Observable, Subject} from \"rxjs\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {BcfApiService} from \"core-app/modules/bim/bcf/api/bcf-api.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {ViewpointsService} from \"core-app/modules/bim/bcf/helper/viewpoints.service\";\nimport {of} from 'rxjs';\n\n\nexport interface XeokitElements {\n  canvasElement:HTMLElement;\n  explorerElement:HTMLElement;\n  toolbarElement:HTMLElement;\n  navCubeCanvasElement:HTMLElement;\n  busyModelBackdropElement:HTMLElement;\n}\n\nexport interface BCFCreationOptions {\n  spacesVisible?:boolean;\n  spaceBoundariesVisible?:boolean;\n  openingsVisible?:boolean;\n}\n\nexport interface BCFLoadOptions {\n  rayCast?:boolean;\n  immediate?:boolean;\n  duration?:number;\n}\n\n@Injectable()\nexport class IFCViewerService extends ViewerBridgeService {\n  @InjectField() pathHelper:PathHelperService;\n  @InjectField() bcfApi:BcfApiService;\n  @InjectField() viewpointsService:ViewpointsService;  \n\n  private _viewer:any;\n\n  // private _loaded:BehaviorSubject<boolean> = new BehaviorSubject(false);\n  // readonly loaded$:Observable<boolean> = this._loaded.asObservable().pipe(shareReplay({refCount: true, bufferSize: 1}));\n\n  private $loaded = new Subject<void>();\n\n  constructor(readonly injector:Injector){\n    super(injector);\n  }\n\n  public newViewer(elements:XeokitElements, projects:any[]) {\n    import('@xeokit/xeokit-bim-viewer/dist/main').then((XeokitViewerModule:any) => {\n      let server = new XeokitServer();\n      let viewerUI = new XeokitViewerModule.BIMViewer(server, elements);\n\n      viewerUI.on(\"queryPicked\", (event:any) => {\n        alert(`IFC Name = \"${event.objectName}\"\\nIFC class = \"${event.objectType}\"\\nIFC GUID = ${event.objectId}`);\n      });\n\n      viewerUI.on(\"modelLoaded\", () => this.$loaded.complete());\n\n      viewerUI.loadProject(projects[0][\"id\"]);\n\n      this.viewer = viewerUI;\n    });\n  }\n\n  public destroy() {\n    this.$loaded.complete();\n\n    if (!this.viewer) {\n      return;\n    }\n\n    this.viewer.destroy();\n    this.viewer = undefined;\n  }\n\n  public get viewer() {\n    return this._viewer;\n  }\n\n  public set viewer(viewer:any) {\n    this._viewer = viewer;\n  }\n\n  public setKeyboardEnabled(val:boolean) {\n    this.viewer.setKeyboardEnabled(val);\n  }\n\n  public getViewpoint$():Observable<BcfViewpointInterface> {\n    const viewpoint = this.viewer.saveBCFViewpoint({ spacesVisible: true });\n\n    // The backend rejects viewpoints with bitmaps\n    delete viewpoint.bitmaps;\n\n    return of(viewpoint);\n  }\n\n  public showViewpoint(workPackage:WorkPackageResource, index:number) {\n    // Avoid reload the app when there is a place to show the viewer\n    // ('bim.partitioned.split')\n    if (this.routeWithViewer) {\n      if (this.viewer) {\n        this.viewpointsService\n              .getViewPoint$(workPackage, index)\n              .subscribe(viewpoint => this.viewer.loadBCFViewpoint(viewpoint, {}));\n      }\n    } else {\n      // Reload the whole app to get the correct menus and GON data\n      // and redirect to a route with a place to show viewer\n      // ('bim.partitioned.split')\n      window.location.href = this.pathHelper.bimDetailsPath(\n        workPackage.project.idFromLink,\n        workPackage.id!,\n        index\n      );\n    }\n  }\n\n  public viewerVisible():boolean {\n    return !!this.viewer;\n  }\n\n  // TODO: Remove this?\n  public onLoad$():Observable<void> {\n    return this.$loaded;\n  }\n}","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport * as moment from 'moment-timezone';\nimport {Moment} from 'moment';\n\n@Injectable({ providedIn: 'root' })\nexport class TimezoneService {\n  constructor(readonly ConfigurationService:ConfigurationService,\n              readonly I18n:I18nService) {\n    this.setupLocale();\n  }\n\n  public setupLocale() {\n    moment.locale(I18n.locale);\n  }\n\n  /**\n   * Takes a utc date time string and turns it into\n   * a local date time moment object.\n   */\n  public parseDatetime(datetime:string, format?:string):Moment {\n    var d = moment.utc(datetime, format);\n\n    if (this.ConfigurationService.isTimezoneSet()) {\n      d.local();\n      d.tz(this.ConfigurationService.timezone());\n    }\n\n    return d;\n  }\n\n  public parseDate(date:Date|string, format?:string) {\n    return moment(date, format);\n  }\n\n  /**\n   * Parses a string that is considered to be a local date and\n   * turns it into a utc date time moment object.\n   * 'Local' might mean the browsers default time zone or the one configured\n   * in the Configuration Service.\n   *\n   * @param {String} date\n   * @param {String} format\n   * @returns {Moment}\n   */\n  public parseLocalDateTime(date:string, format?:string) {\n    var result;\n    format = format || this.getTimeFormat();\n\n    if (this.ConfigurationService.isTimezoneSet()) {\n      result = moment.tz(date, format!, this.ConfigurationService.timezone());\n    } else {\n      result = moment(date, format);\n    }\n    result.utc();\n\n    return result;\n  }\n\n  /**\n   * Parses the specified datetime and applies the user's configured timezone, if any.\n   *\n   * This will effectfully transform the [server] provided datetime object to the user's configured local timezone.\n   *\n   * @param {String} datetime in 'YYYY-MM-DDTHH:mm:ssZ' format\n   * @returns {Moment}\n   */\n  public parseISODatetime(datetime:string) {\n    return this.parseDatetime(datetime, 'YYYY-MM-DDTHH:mm:ssZ');\n  }\n\n  public parseISODate(date:string) {\n    return this.parseDate(date, 'YYYY-MM-DD');\n  }\n\n  public formattedDate(date:string) {\n    var d = this.parseDate(date);\n    return d.format(this.getDateFormat());\n  }\n\n  /**\n   * Return whether the date is in the past\n   * @param dateString\n   */\n  public inThePast(dateString:string):boolean {\n    return this.daysFromToday(dateString) <= -1;\n  }\n\n  /**\n   * Returns the number of days from today the given dateString is apart.\n   * Negative means the date lies in the past.\n   * @param dateString\n   */\n  public daysFromToday(dateString:string):number {\n    const date = this.parseDate(dateString);\n    const today = moment().startOf('day');\n\n    return date.diff(today, 'days');\n  }\n\n  public formattedTime(datetimeString:string) {\n    return this.parseDatetime(datetimeString).format(this.getTimeFormat());\n  }\n\n  public formattedDatetime(datetimeString:string) {\n    var c = this.formattedDatetimeComponents(datetimeString);\n    return c[0] + ' ' + c[1];\n  }\n\n  public formattedDatetimeComponents(datetimeString:string) {\n    var d = this.parseDatetime(datetimeString);\n    return [\n      d.format(this.getDateFormat()),\n      d.format(this.getTimeFormat())\n    ];\n  }\n\n  public toHours(durationString:string) {\n    return Number(moment.duration(durationString).asHours().toFixed(2));\n  }\n\n  public formattedDuration(durationString:string) {\n    return this.I18n.t('js.units.hour', { count: this.toHours(durationString) });\n  }\n\n  public formattedISODate(date:any) {\n    return this.parseDate(date).format('YYYY-MM-DD');\n  }\n\n  public formattedISODateTime(datetime:any) {\n    return datetime.format();\n  }\n\n  public isValidISODate(date:any) {\n    return this.isValid(date, 'YYYY-MM-DD');\n  }\n\n  public isValidISODateTime(dateTime:string) {\n    return this.isValid(dateTime, 'YYYY-MM-DDTHH:mm:ssZ');\n  }\n\n  public isValid(date:string, dateFormat:string) {\n    var format = dateFormat || this.getDateFormat();\n    return moment(date, [format], true).isValid();\n  }\n\n  public getDateFormat() {\n    return this.ConfigurationService.dateFormatPresent() ? this.ConfigurationService.dateFormat() : 'L';\n  }\n\n  public getTimeFormat() {\n    return this.ConfigurationService.timeFormatPresent() ? this.ConfigurationService.timeFormat() : 'LT';\n  }\n}\n","import {States} from '../../states.service';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {Component, EventEmitter, Input, Output} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\n\nexport interface QuerySharingChange {\n  isStarred:boolean;\n  isPublic:boolean;\n}\n\n@Component({\n  selector: 'query-sharing-form',\n  templateUrl: './query-sharing-form.html'\n})\nexport class QuerySharingForm {\n  @Input() public isSave:boolean;\n  @Input() public isStarred:boolean;\n  @Input() public isPublic:boolean;\n  @Output() public onChange = new EventEmitter<QuerySharingChange>();\n\n  public text = {\n    showInMenu: this.I18n.t('js.label_star_query'),\n    visibleForOthers: this.I18n.t('js.label_public_query'),\n\n    showInMenuText: this.I18n.t('js.work_packages.query.star_text'),\n    visibleForOthersText: this.I18n.t('js.work_packages.query.public_text')\n  };\n\n  constructor(readonly states:States,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly authorisationService:AuthorisationService,\n              readonly I18n:I18nService) {\n  }\n\n  public get canStar() {\n    return this.isSave ||\n      this.authorisationService.can('query', 'star') ||\n      this.authorisationService.can('query', 'unstar');\n  }\n\n  public get canPublish() {\n    const form = this.querySpace.queryForm.value!;\n\n    return this.authorisationService.can('query', 'updateImmediately')\n      && form.schema.public.writable;\n  }\n\n  public updateStarred(val:boolean) {\n    this.isStarred = val;\n    this.changed();\n  }\n\n  public updatePublic(val:boolean) {\n    this.isPublic = val;\n    this.changed();\n  }\n\n  public changed() {\n    this.onChange.emit({ isStarred: !!this.isStarred, isPublic: !!this.isPublic });\n  }\n}\n","<div class=\"form--field\">\n  <div class=\"form--field-container -vertical\">\n    <label class=\"form--label-with-check-box\">\n      <div class=\"form--check-box-container\">\n        <input type=\"checkbox\"\n               name=\"is_public\"\n               id=\"show-public\"\n               [ngModel]=\"isPublic\"\n               (ngModelChange)=\"updatePublic($event)\"\n               [disabled]=\"!canPublish\"\n               class=\"form--check-box\" />\n      </div>\n      {{ text.visibleForOthers }}\n    </label>\n    <div class=\"form--field-instructions -no-margin\" [textContent]=\"text.visibleForOthersText\"></div>\n  </div>\n</div>\n\n<div class=\"form--field\">\n  <div class=\"form--field-container -vertical\">\n    <label class=\"form--label-with-check-box\">\n      <div class=\"form--check-box-container\">\n        <input type=\"checkbox\"\n               name=\"show_in_menu\"\n               id=\"show-in-menu\"\n               [ngModel]=\"isStarred\"\n               (ngModelChange)=\"updateStarred($event)\"\n               [disabled]=\"!canStar\"\n               class=\"form--check-box\" />\n      </div>\n      {{ text.showInMenu }}\n    </label>\n    <div class=\"form--field-instructions -no-margin\" [textContent]=\"text.showInMenuText\"></div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild} from '@angular/core';\nimport {\n  CKEditorSetupService,\n  ICKEditorContext,\n  ICKEditorInstance\n} from \"core-app/modules/common/ckeditor/ckeditor-setup.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\n\ndeclare module 'codemirror';\n\nconst manualModeLocalStorageKey = 'op-ckeditor-uses-manual-mode';\n\n@Component({\n  selector: 'op-ckeditor',\n  templateUrl: './op-ckeditor.html',\n  styleUrls: ['./op-ckeditor.sass']\n})\nexport class OpCkeditorComponent implements OnInit {\n  @Input() ckEditorType:'full'|'constrained' = 'full';\n  @Input() context:ICKEditorContext;\n  @Input('content') _content:string;\n\n  // Output notification once ready\n  @Output() onInitialized = new EventEmitter<ICKEditorInstance>();\n\n  // Output notification at max once/s for data changes\n  @Output() onContentChange = new EventEmitter<string>();\n\n  // Output notification when editor cannot be initialized\n  @Output() onInitializationFailed = new EventEmitter<string>();\n\n  // View container of the replacement used to initialize CKEditor5\n  @ViewChild('opCkeditorReplacementContainer', { static: true }) opCkeditorReplacementContainer:ElementRef;\n  @ViewChild('codeMirrorPane') codeMirrorPane:ElementRef;\n\n  // CKEditor instance once initialized\n  public ckEditorInstance:ICKEditorInstance;\n  public error:string|null = null;\n  public allowManualMode = false;\n  public manualMode = false;\n\n  public text = {\n    errorTitle: this.I18n.t('js.editor.error_initialization_failed')\n  };\n\n  // Codemirror instance, initialized lazily when running source mode\n  public codeMirrorInstance:undefined|any;\n\n  // Debounce change listener for both CKE and codemirror\n  // to read back changes as they happen\n  private debouncedEmitter = _.debounce(\n    () => {\n      this.getTransformedContent(false)\n        .then(val => {\n          this.onContentChange.emit(val);\n        });\n    },\n    1000,\n    { leading: true }\n  );\n\n  private $element:JQuery;\n\n  constructor(private readonly elementRef:ElementRef,\n              private readonly Notifications:NotificationsService,\n              private readonly I18n:I18nService,\n              private readonly configurationService:ConfigurationService,\n              private readonly ckEditorSetup:CKEditorSetupService) {\n  }\n\n  /**\n   * Get the current live data from CKEditor. This may raise in cases\n   * the data cannot be loaded (MS Edge!)\n   */\n  public getRawData() {\n    if (this.manualMode) {\n      return this._content = this.codeMirrorInstance!.getValue();\n    } else {\n      return this._content = this.ckEditorInstance!.getData({ trim: false });\n    }\n  }\n\n  /**\n   * Get a promise with the transformed content, will wrap errors in the promise.\n   * @param notificationOnError\n   */\n  public getTransformedContent(notificationOnError = true):Promise<string> {\n    if (!this.initialized) {\n      throw \"Tried to access CKEditor instance before initialization.\";\n    }\n\n    return new Promise<string>((resolve, reject) => {\n      try {\n        resolve(this.getRawData());\n      } catch (e) {\n        console.error(`Failed to save CKEditor content: ${e}.`);\n        let error = this.I18n.t(\n          'js.editor.error_saving_failed',\n          { error: e || this.I18n.t('js.error.internal') }\n        );\n\n        if (notificationOnError) {\n          this.Notifications.addError(error);\n        }\n\n        reject(error);\n      }\n    });\n  }\n\n  public set content(newVal:string) {\n    if (!this.initialized) {\n      throw \"Tried to access CKEditor instance before initialization.\";\n    }\n\n    this._content = newVal;\n    this.ckEditorInstance!.setData(newVal);\n  }\n\n  /**\n   * Return the current content. This may be outdated a tiny bit.\n   */\n  public get content() {\n    return this._content;\n  }\n\n  public get initialized():boolean {\n    return this.ckEditorInstance !== undefined;\n  }\n\n  ngOnInit() {\n    try {\n      this.initializeEditor();\n    } catch (error) {\n      // We will run into this error if, among others, the browser does not fully support\n      // CKEditor's requirements on ES6.\n\n      console.error(`Failed to setup CKEditor instance: ${error}`);\n      this.error = error;\n      this.onInitializationFailed.emit(error);\n    }\n  }\n\n  private initializeEditor() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    const editorPromise = this.ckEditorSetup\n      .create(\n        this.ckEditorType,\n        this.opCkeditorReplacementContainer.nativeElement,\n        this.context,\n        this.content\n      )\n      .catch((error:string) => {\n        throw(error);\n      })\n      .then((editor:ICKEditorInstance) => {\n        this.ckEditorInstance = editor;\n\n        // Save changes while in wysiwyg mode\n        editor.model.document.on('change', this.debouncedEmitter);\n\n        // Switch mode\n        editor.on('op:source-code-enabled', () => this.enableManualMode());\n        editor.on('op:source-code-disabled', () => this.disableManualMode());\n\n        this.onInitialized.emit(editor);\n        return editor;\n      });\n\n    this.$element.data('editor', editorPromise);\n  }\n\n\n  /**\n   * Disable the manual mode, kill the codeMirror instance and switch back to CKEditor\n   */\n  private disableManualMode() {\n    const current = this.getRawData();\n\n    // Apply content to ckeditor\n    this.ckEditorInstance.setData(current);\n    this.codeMirrorInstance = null;\n    this.manualMode = false;\n  }\n\n  /**\n   * Enable manual mode, get data from WYSIWYG and show CodeMirror instance.\n   */\n  private enableManualMode() {\n    const current = this.getRawData();\n    const cmMode = 'gfm';\n\n    Promise\n      .all([\n        import('codemirror'),\n        import(/* webpackChunkName: \"codemirror-mode\" */ `codemirror/mode/${cmMode}/${cmMode}.js`)\n      ])\n      .then((imported:any[]) => {\n        const CodeMirror = imported[0].default;\n        this.codeMirrorInstance = CodeMirror(\n          this.$element.find('.ck-editor__source')[0],\n          {\n            lineNumbers: true,\n            smartIndent: true,\n            value: current,\n            mode: ''\n          }\n        );\n\n        this.codeMirrorInstance.on('change', this.debouncedEmitter);\n        setTimeout(() => this.codeMirrorInstance.refresh(), 100);\n        this.manualMode = true;\n      });\n  }\n}\n","<ng-container>\n  <div *ngIf=\"error\" class=\"notification-box -error\">\n    <div class=\"notification-box--content\">\n      <p>\n        <strong [textContent]=\"text.errorTitle\"></strong>\n        <br/>\n        <span [textContent]=\"error\"></span>\n      </p>\n    </div>\n  </div>\n\n  <div class=\"op-ckeditor-source-element document-editor\" #opCkeditorReplacementContainer>\n    <div class=\"document-editor__toolbar\"></div>\n    <div class=\"document-editor__editable-container\">\n      <div class=\"document-editor__editable\">\n      </div>\n    </div>\n  </div>\n</ng-container>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {IAutocompleteItem} from 'core-components/wp-query-select/wp-query-select-dropdown.component';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Injectable} from '@angular/core';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {StateService} from \"@uirouter/core\";\nimport {CurrentUserService} from \"core-components/user/current-user.service\";\n\n@Injectable()\nexport class WorkPackageStaticQueriesService {\n  constructor(private readonly I18n:I18nService,\n              private readonly $state:StateService,\n              private readonly CurrentProject:CurrentProjectService,\n              private readonly PathHelper:PathHelperService,\n              private readonly CurrentUserService:CurrentUserService) {\n  }\n\n  public text = {\n    assignee: this.I18n.t('js.work_packages.properties.assignee'),\n    author: this.I18n.t('js.work_packages.properties.author'),\n    created_at: this.I18n.t('js.work_packages.properties.createdAt'),\n    updated_at: this.I18n.t('js.work_packages.properties.updatedAt'),\n    status: this.I18n.t('js.work_packages.properties.status'),\n    work_packages: this.I18n.t('js.label_work_package_plural'),\n    gantt: this.I18n.t('js.timelines.gantt_chart'),\n    latest_activity: this.I18n.t('js.work_packages.default_queries.latest_activity'),\n    created_by_me: this.I18n.t('js.work_packages.default_queries.created_by_me'),\n    assigned_to_me: this.I18n.t('js.work_packages.default_queries.assigned_to_me'),\n    recently_created: this.I18n.t('js.work_packages.default_queries.recently_created'),\n    all_open: this.I18n.t('js.work_packages.default_queries.all_open'),\n    summary: this.I18n.t('js.work_packages.default_queries.summary'),\n  };\n\n  // Create all static queries manually\n  // The query_props configure default values of column names, sorting and applied filters\n  // All queries are sorted by their update or creation time (so the latest is always the first)\n  public get all():IAutocompleteItem[] {\n    let items = [\n      {\n        identifier: 'all_open',\n        label: this.text.all_open,\n        query_props: null\n      },\n      {\n        identifier: 'latest_activity',\n        label: this.text.latest_activity,\n        query_props: '{\"c\":[\"id\",\"subject\",\"type\",\"status\",\"assignee\",\"updatedAt\"],\"hi\":false,\"g\":\"\",\"t\":\"updatedAt:desc\",\"f\":[{\"n\":\"status\",\"o\":\"o\",\"v\":[]}]}'\n      },\n      {\n        identifier: 'gantt',\n        label: this.text.gantt,\n        query_props: '{\"c\":[\"id\",\"subject\",\"startDate\",\"dueDate\"],\"tv\":true,\"tzl\":\"years\",\"hi\":true,\"g\":\"\",\"t\":\"id:asc\",\"t\":\"startDate:asc\",\"f\":[{\"n\":\"status\",\"o\":\"o\",\"v\":[]}]}'\n      },\n      {\n        identifier: 'recently_created',\n        label: this.text.recently_created,\n        query_props: '{\"c\":[\"id\",\"subject\",\"type\",\"status\",\"assignee\",\"createdAt\"],\"hi\":false,\"g\":\"\",\"t\":\"createdAt:desc\",\"f\":[{\"n\":\"status\",\"o\":\"o\",\"v\":[]}]}'\n      }\n    ] as IAutocompleteItem[];\n\n    const projectIdentifier = this.CurrentProject.identifier;\n    if (projectIdentifier) {\n      items.push({\n        identifier: 'summary',\n        label: this.text.summary,\n        static_link: this.PathHelper.projectWorkPackagesPath(projectIdentifier) + '/report'\n      });\n    }\n\n    if (this.CurrentUserService.isLoggedIn) {\n      items = items.concat([\n        {\n          identifier: 'created_by_me',\n          label: this.text.created_by_me,\n          query_props: '{\"c\":[\"id\",\"subject\",\"type\",\"status\",\"assignee\",\"updatedAt\"],\"hi\":false,\"g\":\"\",\"t\":\"updatedAt:desc,id:asc\",\"f\":[{\"n\":\"status\",\"o\":\"o\",\"v\":[]},{\"n\":\"author\",\"o\":\"=\",\"v\":[\"me\"]}]}'\n        },\n        {\n          identifier: 'assigned_to_me',\n          label: this.text.assigned_to_me,\n          query_props: '{\"c\":[\"id\",\"subject\",\"type\",\"status\",\"author\",\"updatedAt\"],\"hi\":false,\"g\":\"\",\"t\":\"updatedAt:desc,id:asc\",\"f\":[{\"n\":\"status\",\"o\":\"o\",\"v\":[]},{\"n\":\"assigneeOrGroup\",\"o\":\"=\",\"v\":[\"me\"]}]}'\n        }\n      ]);\n    }\n\n    return items;\n  }\n\n  public getStaticName(query:QueryResource) {\n    if (this.$state.params.query_props) {\n      let queryProps = JSON.parse(this.$state.params.query_props);\n      delete queryProps.pp;\n      delete queryProps.pa;\n\n      const matched = _.find(this.all, item =>\n        item.query_props && item.query_props === JSON.stringify(queryProps)\n      );\n\n      if (matched) {\n        return matched.label;\n      }\n    }\n\n    // Try to detect the all open filter\n    if (query.filters.length === 1 && // Only one filter\n      query.filters[0].id === 'status' && // that is status\n      query.filters[0].operator.id === 'o') { // and is open\n      return this.text.all_open;\n    }\n\n    // Otherwise, fall back to work packages\n    return this.text.work_packages;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {HttpClient, HttpErrorResponse, HttpParams} from '@angular/common/http';\nimport {throwError} from 'rxjs/internal/observable/throwError';\nimport {catchError, map} from 'rxjs/operators';\nimport {Observable} from 'rxjs';\nimport {HalResource, HalResourceClass} from 'core-app/modules/hal/resources/hal-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {HalLink, HalLinkInterface} from 'core-app/modules/hal/hal-link/hal-link';\nimport {initializeHalProperties} from 'core-app/modules/hal/helpers/hal-resource-builder';\nimport {URLParamsEncoder} from 'core-app/modules/hal/services/url-params-encoder';\nimport {ErrorResource} from \"core-app/modules/hal/resources/error-resource\";\nimport * as Pako from 'pako';\nimport {\n  HTTPClientHeaders,\n  HTTPClientOptions,\n  HTTPClientParamMap,\n  HTTPSupportedMethods\n} from \"core-app/modules/hal/http/http.interfaces\";\nimport {whenDebugging} from \"core-app/helpers/debug_output\";\n\nexport interface HalResourceFactoryConfigInterface {\n  cls?:any;\n  attrTypes?:{ [attrName:string]:string };\n}\n\n\n@Injectable({ providedIn: 'root' })\nexport class HalResourceService {\n\n  /**\n   * List of all known hal resources, extendable.\n   */\n  private config:{ [typeName:string]:HalResourceFactoryConfigInterface } = {};\n\n  constructor(readonly injector:Injector,\n              readonly http:HttpClient) {\n  }\n\n  /**\n   * Perform a HTTP request and return a HalResource promise.\n   */\n  public request<T extends HalResource>(method:HTTPSupportedMethods, href:string, data?:any, headers:HTTPClientHeaders = {}):Observable<T> {\n\n    // HttpClient requires us to create HttpParams instead of passing data for get\n    // so forward to that method instead.\n    if (method === 'get') {\n      return this.get(href, data, headers);\n    }\n\n    const config:HTTPClientOptions = {\n      body: data || {},\n      headers: headers,\n      withCredentials: true,\n      responseType: 'json'\n    };\n\n    return this._request(method, href, config);\n  }\n\n  private _request<T>(method:HTTPSupportedMethods, href:string, config:HTTPClientOptions):Observable<T> {\n    return this.http.request<T>(method, href, config)\n      .pipe(\n        map((response:any) => this.createHalResource(response)),\n        catchError((error:HttpErrorResponse) => {\n          whenDebugging(() => console.error(`Failed to ${method} ${href}: ${error.name}`));\n          const resource = this.createHalResource<ErrorResource>(error.error);\n          resource.httpError = error;\n          return throwError(resource);\n        })\n      ) as any;\n  }\n\n  /**\n   * Perform a GET request and return a resource promise.\n   *\n   * @param href\n   * @param params\n   * @param headers\n   * @returns {Promise<HalResource>}\n   */\n  public get<T extends HalResource>(href:string, params?:HTTPClientParamMap, headers?:HTTPClientHeaders):Observable<T> {\n    const config:HTTPClientOptions = {\n      headers: headers,\n      params: new HttpParams({ encoder: new URLParamsEncoder(), fromObject: params }),\n      withCredentials: true,\n      responseType: 'json'\n    };\n\n    return this._request('get', href, config);\n  }\n\n  /**\n   * Return all potential pages to the request, when the elements returned from API is smaller\n   * than the expected.\n   *\n   * @param href\n   * @param expected The expected number of elements\n   * @param params\n   * @param headers\n   * @return {Promise<CollectionResource[]>}\n   */\n  public async getAllPaginated<T extends HalResource[]>(href:string, expected:number, params:any = {}, headers:HTTPClientHeaders = {}) {\n    // Total number retrieved\n    let retrieved = 0;\n    // Current offset page\n    let page = 1;\n    // Accumulated results\n    const allResults:CollectionResource[] = [];\n    // If possible, request all at once.\n    params.pageSize = expected;\n\n    while (retrieved < expected) {\n      params.offset = page;\n\n      const promise = this.request<CollectionResource>('get', href, this.toEprops(params), headers).toPromise();\n      const results = await promise;\n\n      if (results.count === 0) {\n        throw 'No more results for this query, but expected more.';\n      }\n\n      allResults.push(results);\n\n      retrieved += results.count;\n      page += 1;\n    }\n\n    return allResults;\n  }\n\n  /**\n   * Perform a PUT request and return a resource promise.\n   * @param href\n   * @param data\n   * @param headers\n   * @returns {Promise<HalResource>}\n   */\n  public put<T extends HalResource>(href:string, data?:any, headers?:HTTPClientHeaders):Observable<T> {\n    return this.request('put', href, data, headers);\n  }\n\n  /**\n   * Perform a POST request and return a resource promise.\n   *\n   * @param href\n   * @param data\n   * @param headers\n   * @returns {Promise<HalResource>}\n   */\n  public post<T extends HalResource>(href:string, data?:any, headers?:HTTPClientHeaders):Observable<T> {\n    return this.request('post', href, data, headers);\n  }\n\n  /**\n   * Perform a PATCH request and return a resource promise.\n   *\n   * @param href\n   * @param data\n   * @param headers\n   * @returns {Promise<HalResource>}\n   */\n  public patch<T extends HalResource>(href:string, data?:any, headers?:HTTPClientHeaders):Observable<T> {\n    return this.request('patch', href, data, headers);\n  }\n\n  /**\n   * Perform a DELETE request and return a resource promise\n   *\n   * @param href\n   * @param data\n   * @param headers\n   * @returns {Promise<HalResource>}\n   */\n  public delete<T extends HalResource>(href:string, data?:any, headers?:HTTPClientHeaders):Observable<T> {\n    return this.request('delete', href, data, headers);\n  }\n\n  /**\n   * Register a HalResource for use with the API.\n   * @param {HalResourceStatic} resource\n   */\n  public registerResource(key:string, entry:HalResourceFactoryConfigInterface) {\n    this.config[key] = entry;\n  }\n\n  /**\n   * Get the default class.\n   * Initially, it's HalResource.\n   *\n   * @returns {HalResource}\n   */\n  public get defaultClass():HalResourceClass<HalResource> {\n    let defaultCls:HalResourceClass = HalResource;\n    return defaultCls;\n  }\n\n  /**\n   * Create a HalResource from a source object.\n   * If the APIv3 _type attribute is defined and the type is configured,\n   * the respective class will be used for instantiation.\n   *\n   *\n   * @param source\n   * @returns {HalResource}\n   */\n  public createHalResource<T extends HalResource = HalResource>(source:any, loaded:boolean = true):T {\n    if (_.isNil(source)) {\n      source = HalResource.getEmptyResource();\n    }\n\n    const type = source._type || 'HalResource';\n    return this.createHalResourceOfType<T>(type, source, loaded);\n  }\n\n  public createHalResourceOfType<T extends HalResource = HalResource>(type:string, source:any, loaded:boolean = false) {\n    const resourceClass:HalResourceClass<T> = this.getResourceClassOfType(type);\n    const initializer = (halResource:T) => initializeHalProperties(this, halResource);\n    let resource = new resourceClass(this.injector, source, loaded, initializer, type);\n\n    return resource;\n  }\n\n  /**\n   * Create a resource class of the given class\n   * @param resourceClass\n   * @param source\n   * @param loaded\n   */\n  public createHalResourceOfClass<T extends HalResource>(resourceClass:HalResourceClass<T>, source:any, loaded:boolean = false) {\n    const initializer = (halResource:T) => initializeHalProperties(this, halResource);\n    const type = source._type || 'HalResource';\n    let resource = new resourceClass(this.injector, source, loaded, initializer, type);\n\n    return resource;\n  }\n\n  /**\n   * Create a linked HalResource from the given link.\n   *\n   * @param {HalLinkInterface} link\n   * @returns {HalResource}\n   */\n  public fromLink(link:HalLinkInterface) {\n    const resource = HalResource.getEmptyResource(HalLink.fromObject(this, link));\n    return this.createHalResource(resource, false);\n  }\n\n  /**\n   * Create an empty HAL resource with only the self link set.\n   * @param href Self link of the HAL resource\n   */\n  public fromSelfLink(href:string|null) {\n    const source = { _links: { self: { href: href } } };\n    return this.createHalResource(source);\n  }\n\n  /**\n   * Get a linked resource from its HalLink with the correct type.\n   */\n  public createLinkedResource<T extends HalResource = HalResource>(halResource:T, linkName:string, link:HalLinkInterface) {\n    const source = HalResource.getEmptyResource();\n    const fromType = halResource.$halType;\n    const toType = this.getResourceClassOfAttribute(fromType, linkName) || 'HalResource';\n\n    source._links.self = link;\n\n    return this.createHalResourceOfType(toType, source, false);\n  }\n\n  /**\n   * Get the configured resource class of a type.\n   *\n   * @param type\n   * @returns {HalResource}\n   */\n  protected getResourceClassOfType<T extends HalResource>(type:string):HalResourceClass<T> {\n    const config = this.config[type];\n    return (config && config.cls) ? config.cls : this.defaultClass;\n  }\n\n  /**\n   * Get the hal type for an attribute.\n   *\n   * @param type\n   * @param attribute\n   * @returns {any}\n   */\n  protected getResourceClassOfAttribute<T extends HalResource = HalResource>(type:string, attribute:string):string|null {\n    const typeConfig = this.config[type];\n    const types = (typeConfig && typeConfig.attrTypes) || {};\n    return types[attribute];\n  }\n\n  protected toEprops(params:{}):{} {\n    let deflated = Pako.deflate(JSON.stringify(params), { to: 'string' });\n    let compressed = btoa(deflated);\n\n    return { eprops: compressed };\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {Component, HostListener, Input} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {CustomActionResource} from 'core-app/modules/hal/resources/custom-action-resource';\nimport {WorkPackagesActivityService} from 'core-components/wp-single-view-tabs/activity-panel/wp-activity.service';\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  selector: 'wp-custom-action',\n  templateUrl: './wp-custom-action.component.html'\n})\nexport class WpCustomActionComponent {\n\n  @Input() workPackage:WorkPackageResource;\n  @Input() action:CustomActionResource;\n\n  constructor(private halResourceService:HalResourceService,\n              private wpCacheService:WorkPackageCacheService,\n              private wpSchemaCacheService:SchemaCacheService,\n              private wpActivity:WorkPackagesActivityService,\n              private notificationService:WorkPackageNotificationService,\n              private halEditing:HalResourceEditingService,\n              private halEvents:HalEventsService) {\n  }\n\n  private fetchAction() {\n    this.halResourceService.get<CustomActionResource>(this.action.href!)\n      .toPromise()\n      .then((action) => {\n        this.action = action;\n      });\n  }\n\n  public update() {\n    let payload = {\n      lockVersion: this.workPackage.lockVersion,\n      _links: {\n        workPackage: {\n          href: this.workPackage.href\n        }\n      }\n    };\n\n    this.halResourceService.post<WorkPackageResource>(this.action.href + '/execute', payload)\n      .toPromise()\n      .then((savedWp:WorkPackageResource) => {\n        this.notificationService.showSave(savedWp, false);\n        this.workPackage = savedWp;\n        this.wpActivity.clear(this.workPackage.id!);\n        // Loading the schema might be necessary in cases where the button switches\n        // project or type.\n        this.wpSchemaCacheService.ensureLoaded(savedWp).then(() => {\n          this.wpCacheService.updateWorkPackage(savedWp, true);\n          this.halEditing.stopEditing(savedWp);\n          this.halEvents.push(savedWp, { eventType: \"updated\" });\n        });\n      }).catch((errorResource:any) => {\n        this.notificationService.handleRawError(errorResource, this.workPackage);\n      });\n  }\n\n  @HostListener('mouseenter') onMouseEnter() {\n    this.fetchAction();\n  }\n}\n\n","<button\n    (click)=\"update()\"\n    class=\"custom-action--button button -narrow hide-when-print\"\n    title=\"{{action.description ? action.description : action.name}}\" >\n  {{action.name}}\n</button>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageCreateComponent} from 'core-components/wp-new/wp-create.component';\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\n\n@Component({\n  selector: 'wp-new-full-view',\n  host: { 'class': 'work-packages-page--ui-view' },\n  templateUrl: './wp-new-full-view.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkPackageNewFullViewComponent extends WorkPackageCreateComponent {\n  public successState:string = 'work-packages.show';\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Subject} from 'rxjs';\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport abstract class EditFieldHandler extends UntilDestroyedMixin {\n  /**\n   * Whether the handler belongs to a larger edit mode form\n   * e.g., WP-create\n   */\n  inEditMode:boolean;\n\n  /** Whether the field is currently active */\n  active:boolean;\n\n  /** Whether the field is being saved */\n  inFlight:boolean;\n\n  /**\n   * Return a unique ID for this edit field\n   */\n  htmlId:string;\n\n  /**\n   * The name of the attribute\n   */\n  fieldName:string;\n\n  /**\n   * Activation handler firing upon user requesting activation.\n   */\n  $onUserActivate:Subject<void>;\n\n  /**\n   * Accessibility label for the field\n   */\n  fieldLabel:string;\n\n  /**\n   * Error messages on the field, if any.\n   */\n  errorMessageOnLabel?:string;\n\n  /**\n   * On destroy observable\n   */\n  public onDestroy = new Subject<void>();\n\n  // OnSubmit callbacks that may register from fields\n  protected _onSubmitHandlers:Array<() => Promise<void>> = [];\n\n  /**\n   * Call field submission callback handlers\n   */\n  public onSubmit():Promise<any> {\n    return Promise.all(this._onSubmitHandlers.map((cb) => cb()));\n  }\n\n  public registerOnSubmit(callback:() => Promise<void>) {\n    this._onSubmitHandlers.push(callback);\n  }\n\n  /**\n   * Stop event propagation\n   */\n  public abstract stopPropagation(evt:JQuery.TriggeredEvent):boolean;\n\n  /**\n   * Focus on the active field.\n   * Optionally, try to set the click position to the given offset if the field is an input element.\n   */\n  public abstract focus(setClickOffset?:number):void;\n\n  /**\n   * Handle a user submitting the field (e.g, ng-change)\n   */\n  public abstract handleUserSubmit():Promise<any>;\n\n  /**\n   * Handle users pressing enter inside an edit mode.\n   * Outside an edit mode, the regular save event is captured by handleUserSubmit (submit event).\n   * In an edit mode, we can't derive from a submit event wheteher the user pressed enter\n   * (and on what field he did that).\n   */\n  public abstract handleUserKeydown(event:JQuery.TriggeredEvent, onlyCancel?:boolean):void;\n\n  /**\n   * Cancel edit\n   */\n  public abstract handleUserCancel():void;\n\n  /**\n   * Cancel any pending changes\n   */\n  public abstract reset():void;\n\n  /**\n   * Close the field, resetting it with its display value.\n   */\n  public abstract deactivate(focus:boolean):void;\n\n  /**\n   * Returns whether the field has been changed\n   */\n  public abstract isChanged():boolean;\n\n  /**\n   * Handle focus loss\n   */\n  public abstract onFocusOut():void;\n\n  public abstract setErrors(newErrors:string[]):void;\n\n  public previewContext(resource:HalResource):string|undefined {\n    return undefined;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Directive, EventEmitter, HostListener, Input, Output} from '@angular/core';\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\n\n@Directive({\n  selector: '[accessibleClick]',\n})\nexport class AccessibleClickDirective {\n  @Input('accessibleClickStopEvent') stopEventPropagation:boolean = true;\n  @Output('accessibleClick') onClick = new EventEmitter<JQuery.TriggeredEvent>();\n\n  @HostListener('click', ['$event'])\n  @HostListener('keydown', ['$event'])\n  public handleClick(event:JQuery.TriggeredEvent) {\n    if (event.type === 'click' || event.which === keyCodes.ENTER || event.which === keyCodes.SPACE) {\n\n      if (this.stopEventPropagation) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      this.onClick.emit(event);\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\n\nexport const DEFAULT_PAGINATION_OPTIONS = {\n  maxVisiblePageOptions: 6,\n  optionsTruncationSize: 1\n};\n\nexport interface IPaginationOptions {\n  perPage:number;\n  perPageOptions:number[];\n  maxVisiblePageOptions:number;\n  optionsTruncationSize:number;\n}\n\n@Injectable()\nexport class PaginationService {\n  private paginationOptions:IPaginationOptions;\n\n  constructor(private configuration:ConfigurationService) {\n    this.loadPaginationOptions();\n  }\n\n  public getCachedPerPage(initialPageOptions:number[]):number {\n    const value = this.localStoragePerPage;\n    const initialLength = initialPageOptions?.length || 0;\n\n    if (value !== null && value > 0 && (initialLength === 0 || initialPageOptions?.indexOf(value) !== -1)) {\n      return value;\n    }\n\n    if (initialLength > 0) {\n      return initialPageOptions[0];\n    }\n\n    return 20;\n  }\n\n  private get localStoragePerPage() {\n    const value = window.OpenProject.guardedLocalStorage('pagination.perPage') as string;\n\n    if (value !== undefined) {\n      return parseInt(value, 10);\n    } else {\n      return null;\n    }\n  }\n\n  public getPaginationOptions() {\n    return this.paginationOptions;\n  }\n\n  public get isPerPageKnown() {\n    return !!(this.localStoragePerPage || this.paginationOptions);\n  }\n\n  public getPerPage() {\n    return this.localStoragePerPage || this.paginationOptions.perPage;\n  }\n\n  public getMaxVisiblePageOptions() {\n    return _.get(this.paginationOptions, 'maxVisiblePageOptions', DEFAULT_PAGINATION_OPTIONS.maxVisiblePageOptions);\n  }\n\n  public getOptionsTruncationSize() {\n    return _.get(this.paginationOptions, 'optionsTruncationSize', DEFAULT_PAGINATION_OPTIONS.optionsTruncationSize);\n  }\n\n  public setPerPage(perPage:number) {\n    window.OpenProject.guardedLocalStorage('pagination.perPage', perPage.toString());\n    this.paginationOptions.perPage = perPage;\n  }\n\n  public getPerPageOptions() {\n    return this.paginationOptions.perPageOptions;\n  }\n\n  public setPerPageOptions(perPageOptions:number[]) {\n    this.paginationOptions.perPageOptions = perPageOptions;\n  }\n\n  public loadPaginationOptions() {\n    return this.configuration.initialized.then(() => {\n      this.paginationOptions = {\n        perPage: this.getCachedPerPage(this.configuration.perPageOptions),\n        perPageOptions: this.configuration.perPageOptions,\n        maxVisiblePageOptions: DEFAULT_PAGINATION_OPTIONS.maxVisiblePageOptions,\n        optionsTruncationSize: DEFAULT_PAGINATION_OPTIONS.optionsTruncationSize\n      };\n\n      return this.paginationOptions;\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\nimport {input} from \"reactivestates\";\nimport {Observable} from \"rxjs\";\nimport {takeUntil} from \"rxjs/operators\";\n\n@Injectable()\nexport class WorkPackageFiltersService {\n  private readonly state = input<boolean>(false);\n\n  public get visible() {\n    return this.state.getValueOr(false);\n  }\n\n  public set visible(val:boolean) {\n    this.state.putValue(val);\n  }\n\n  public observeUntil(unsubscribe:Observable<any>) {\n    return this.state.values$().pipe(takeUntil(unsubscribe));\n  }\n\n  public toggleVisibility() {\n    this.state.doModify((current) => !current);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {QuerySortByResource} from 'core-app/modules/hal/resources/query-sort-by-resource';\nimport {QueryGroupByResource} from 'core-app/modules/hal/resources/query-group-by-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {QueryFilterResource} from 'core-app/modules/hal/resources/query-filter-resource';\nimport {QueryFilterInstanceSchemaResource} from 'core-app/modules/hal/resources/query-filter-instance-schema-resource';\nimport {QueryColumn} from '../wp-query/query-column';\nimport {Injectable} from '@angular/core';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {QueryFormDmService} from \"core-app/modules/hal/dm-services/query-form-dm.service\";\n\n@Injectable()\nexport class WorkPackagesListInvalidQueryService {\n  constructor(protected halResourceService:HalResourceService,\n              protected queryFormDm:QueryFormDmService) {}\n\n  public restoreQuery(query:QueryResource, form:QueryFormResource) {\n    let payload = this.queryFormDm.buildQueryResource(form);\n\n    this.restoreFilters(query, payload, form.schema);\n    this.restoreColumns(query, payload, form.schema);\n    this.restoreSortBy(query, payload, form.schema);\n    this.restoreGroupBy(query, payload, form.schema);\n    this.restoreOtherProperties(query, payload);\n  }\n\n  private restoreFilters(query:QueryResource, payload:QueryResource, querySchema:SchemaResource) {\n    let filters = _.map((payload.filters), filter => {\n      let filterInstanceSchema = _.find(querySchema.filtersSchemas.elements, (schema:QueryFilterInstanceSchemaResource) => {\n        return (schema.filter.allowedValues as QueryFilterResource[])[0].$href === filter.filter.$href;\n      })\n\n      if (!filterInstanceSchema) {\n        return null;\n      }\n\n      let recreatedFilter = filterInstanceSchema.getFilter();\n\n      let operator = _.find(filterInstanceSchema.operator.allowedValues, operator => {\n        return operator.$href === filter.operator.$href;\n      });\n\n      if (operator) {\n        recreatedFilter.operator = operator;\n      }\n\n      recreatedFilter.values.length = 0\n      _.each(filter.values, value => recreatedFilter.values.push(value));\n\n      return recreatedFilter;\n    });\n\n    filters = _.compact(filters);\n\n    // clear filters while keeping reference\n    query.filters.length = 0;\n    _.each(filters, filter => query.filters.push(filter));\n  }\n\n  private restoreColumns(query:QueryResource, stubQuery:QueryResource, schema:SchemaResource) {\n    let columns = _.map(stubQuery.columns, column => {\n      return _.find((schema.columns.allowedValues as QueryColumn[]), candidate => {\n        return candidate.$href === column.$href;\n      });\n    });\n\n    columns = _.compact(columns);\n\n    query.columns.length = 0;\n    _.each(columns, column => query.columns.push(column!));\n  }\n\n  private restoreSortBy(query:QueryResource, stubQuery:QueryResource, schema:SchemaResource) {\n    let sortBys = _.map((stubQuery.sortBy), sortBy => {\n      return _.find((schema.sortBy.allowedValues as QuerySortByResource[]), candidate => {\n        return candidate.$href === sortBy.$href;\n      })!;\n    });\n\n    sortBys = _.compact(sortBys);\n\n    query.sortBy.length = 0;\n    _.each(sortBys, sortBy => query.sortBy.push(sortBy));\n  }\n\n  private restoreGroupBy(query:QueryResource, stubQuery:QueryResource, schema:SchemaResource) {\n    let groupBy = _.find((schema.groupBy.allowedValues as QueryGroupByResource[]), candidate => {\n      return stubQuery.groupBy && stubQuery.groupBy.$href === candidate.$href;\n    }) as any;\n\n    query.groupBy = groupBy;\n  }\n\n  private restoreOtherProperties(query:QueryResource, stubQuery:QueryResource) {\n    _.without(Object.keys(stubQuery.$source), '_links', 'filters').forEach((property:any) => {\n      query[property] = stubQuery[property];\n    });\n\n    _.without(Object.keys(stubQuery.$source._links), 'columns', 'groupBy', 'sortBy').forEach((property:any) => {\n      query[property] = stubQuery[property];\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Input} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\n@Component({\n  selector: 'wp-custom-actions',\n  templateUrl: './wp-custom-actions.component.html'\n})\nexport class WpCustomActionsComponent {\n\n  @Input() workPackage:WorkPackageResource;\n\n  public get actions() {\n    return this.workPackage.customActions;\n  }\n}\n","<wp-custom-action\n    *ngFor=\"let action of actions\"\n    [workPackage]=\"workPackage\"\n    [action]=\"action\"\n    class=\"custom-action\">\n</wp-custom-action>\n","/**\n * Return an <i> HTML element with the given icon classes\n * and aria-hidden=true set.\n */\nexport function opIconElement(...classes:string[]) {\n  let icon = document.createElement('i');\n  icon.setAttribute('aria-hidden', 'true');\n  icon.classList.add(...classes);\n\n  return icon;\n}\n","import {Component, Inject} from \"@angular/core\";\nimport {\n  OpContextMenuItem,\n  OpContextMenuLocalsMap, OpContextMenuLocalsToken\n} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\n\n@Component({\n  templateUrl: './op-context-menu.html'\n})\nexport class OPContextMenuComponent {\n  public items:OpContextMenuItem[];\n  public service:OPContextMenuService;\n\n  constructor(@Inject(OpContextMenuLocalsToken) public locals:OpContextMenuLocalsMap) {\n    this.items = this.locals.items;\n    this.service = this.locals.service;\n  }\n\n  public handleClick(item:OpContextMenuItem, $event:JQuery.TriggeredEvent) {\n    if (item.disabled || item.divider) {\n      return false;\n    }\n\n    if (item.onClick!($event)) {\n      this.locals.service.close();\n      $event.preventDefault();\n      $event.stopPropagation();\n      return false;\n    }\n\n    return true;\n  }\n}\n","<div [attr.id]=\"locals.contextMenuId\"\n     class=\"dropdown-relative dropdown -overflow-in-view\"\n     ng-class=\"{'dropdown-anchor-right': locals.showAnchorRight}\">\n  <ul class=\"dropdown-menu \"\n      role=\"menu\"\n      [ngClass]=\"{'-empty': items.length === 0 }\">\n    <ng-container *ngFor=\"let item of items\">\n      <li *ngIf=\"item.divider && !item.hidden\" class=\"dropdown-divider\"></li>\n      <li *ngIf=\"!item.divider && !item.hidden\">\n        <a class=\"menu-item {{ item.class }}\"\n           tabindex=\"0\"\n           [ngClass]=\"{ 'inactive': item.disabled }\"\n           [attr.href]=\"item.href || ''\"\n           [attr.aria-disabled]=\"item.disabled\"\n           [attr.aria-label]=\"item.ariaLabel || item.linkText\"\n           (accessibleClick)=\"handleClick(item, $event)\"\n           [accessibleClickStopEvent]=\"false\">\n          <op-icon *ngIf=\"item.icon\" icon-classes=\"icon-action-menu {{ item.icon }}\"> </op-icon>\n          <span [textContent]=\"item.linkText\"></span>\n          <op-icon *ngIf=\"item.postIcon\"\n                   [icon-title]=\"item.postIconTitle || ''\"\n                   icon-classes=\"icon-action-menu-post {{ item.postIcon }}\"> </op-icon>\n        </a>\n      </li>\n    </ng-container>\n  </ul>\n</div>\n","import {Injector, Injectable} from '@angular/core';\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\nimport {Observable} from \"rxjs\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {StateService} from \"@uirouter/core\";\n\n\n@Injectable()\nexport abstract class ViewerBridgeService {\n  @InjectField() state:StateService;\n  /**\n   * Check if we are on a router state where there is a place\n   * where the viewer could be shown\n   */\n  get routeWithViewer():boolean {\n    return this.state.includes('bim.partitioned.split');\n  }\n\n  constructor(readonly injector:Injector) {}\n  /**\n   * Get a viewpoint from the viewer\n   */\n  abstract getViewpoint$():Observable<BcfViewpointInterface>;\n\n  /**\n   * Show the given viewpoint JSON in the viewer\n   * @param viewpoint\n   */\n  abstract showViewpoint(workPackage:WorkPackageResource, index:number):void;\n\n  /**\n   * Determine whether a viewer is present to ensure we can show viewpoints\n   */\n  abstract viewerVisible():boolean;\n\n  /**\n   * Load event\n   */\n  abstract onLoad$():Observable<void>;\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {TablePaginationComponent} from 'core-components/table-pagination/table-pagination.component';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, OnDestroy, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {IPaginationOptions, PaginationService} from 'core-components/table-pagination/pagination-service';\nimport {WorkPackageViewPaginationService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-pagination.service\";\nimport {WorkPackageViewPagination} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-pagination\";\nimport {WorkPackageViewSortByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-sort-by.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {combineLatest} from 'rxjs';\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\n\n@Component({\n  templateUrl: '../../table-pagination/table-pagination.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-table-pagination'\n})\nexport class WorkPackageTablePaginationComponent extends TablePaginationComponent implements OnInit, OnDestroy {\n\n  constructor(protected paginationService:PaginationService,\n              protected cdRef:ChangeDetectorRef,\n              protected wpTablePagination:WorkPackageViewPaginationService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly wpTableSortBy:WorkPackageViewSortByService,\n              readonly I18n:I18nService) {\n    super(paginationService, cdRef, I18n);\n\n  }\n\n  ngOnInit() {\n    this.paginationService\n      .loadPaginationOptions()\n      .then((paginationOptions:IPaginationOptions) => {\n        this.perPageOptions = paginationOptions.perPageOptions;\n        this.cdRef.detectChanges();\n      });\n\n    this.wpTablePagination\n      .live$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wpPagination:WorkPackageViewPagination) => {\n        this.pagination = wpPagination.current;\n        this.update();\n      });\n\n    // hide/show pagination options depending on the sort mode\n    combineLatest([\n      this.querySpace.query.values$(),\n      this.wpTableSortBy.live$()\n    ]).pipe(\n      this.untilDestroyed()\n    ).subscribe(([query, sort]) => {\n      this.showPerPage = this.showPageSelections = !this.isManualSortingMode;\n      this.infoText = this.paginationInfoText(query.results);\n\n      this.update();\n    });\n  }\n\n  public selectPerPage(perPage:number) {\n    this.paginationService.setPerPage(perPage);\n    this.wpTablePagination.updateFromObject({ page: 1, perPage: perPage });\n  }\n\n  public showPage(pageNumber:number) {\n    this.wpTablePagination.updateFromObject({ page: pageNumber });\n  }\n\n  private get isManualSortingMode() {\n    return this.wpTableSortBy.isManualSortingMode;\n  }\n\n  public paginationInfoText(work_packages:WorkPackageCollectionResource) {\n    if (this.isManualSortingMode && (work_packages.count < work_packages.total)) {\n      return I18n.t('js.work_packages.limited_results',\n        { count: work_packages.count });\n    } else {\n      return undefined;\n    }\n  }\n}\n","<div class=\"pagination\" *ngIf=\"pagination && isVisible && pagination.total\">\n  <nav class=\"pagination--pages\">\n    <ul class=\"pagination--items\">\n\n      <li [hidden]=\"pagination.page == 1 || !showPageSelections\" class=\"pagination--item\">\n        <a (accessibleClick)=\"showPage(pagination.page - 1)\"\n           rel=\"prev start\"\n           [attr.aria-label]=\"text.label_previous\"\n           id= \"pagination--prev-link\"\n           role=\"link\"\n           href>&#60;</a>\n      </li>\n\n      <ng-container *ngIf=\"prePageNumbers.length > 0\">\n        <li *ngFor=\"let pageNumber of prePageNumbers\"\n          class=\"pagination--item\">\n          <a (accessibleClick)=\"showPage(pageNumber)\"\n             rel=\"next\"\n             role=\"link\"\n             [textContent]=\"pageNumber\"\n             href></a>\n        </li>\n        <li class=\"pagination--space\">…</li>\n      </ng-container>\n\n      <ng-container *ngIf=\"pageNumbers.length > 1\">\n        <li *ngFor=\"let pageNumber of pageNumbers\"\n            [ngClass]=\"{ '-current': pageNumber == pagination.page }\"\n            class=\"pagination--item pagination-number\">\n          <em *ngIf=\"pageNumber == pagination.page\">{{ pageNumber }}</em>\n          <a *ngIf=\"pageNumber != pagination.page\"\n            (accessibleClick)=\"showPage(pageNumber)\"\n            rel=\"next\"\n            role=\"link\"\n            [textContent]=\"pageNumber\"\n            href></a>\n        </li>\n\n        <li *ngIf=\"postPageNumbers.length\" class=\"pagination--space\">…</li>\n      </ng-container>\n\n      <ng-container *ngIf=\"postPageNumbers.length\">\n        <li *ngFor=\"let pageNumber of postPageNumbers\" class=\"pagination--item pagination-number\">\n          <a (accessibleClick)=\"showPage(pageNumber)\"\n             rel=\"next\"\n             role=\"link\"\n             [textContent]=\"pageNumber\"\n             href></a>\n        </li>\n      </ng-container>\n\n      <li [hidden]=\"!(pagination.total && pagination.page < pageNumbers[pageNumbers.length - 1])\"\n        class=\"pagination--item\">\n        <a (accessibleClick)=\"showPage(pagination.page + 1)\"\n           rel=\"next\"\n           class=\"pagination--next-link\"\n           [attr.aria-label]=\"text.label_next\"\n           id=\"pagination--next-link\"\n           role=\"link\"\n           href>&#62;</a>\n      </li>\n\n      <li class=\"pagination--range\">\n        <span [textContent]=\"currentRange\"></span>\n        <span *ngIf=\"pageNumbers.length === 1\"\n              id=\"pagination-empty-text\"\n              tabindex=\"0\"\n              class=\"hidden-for-sighted\"\n              [textContent]=\"text.no_other_page\"></span>\n      </li>\n\n      <li class=\"pagination--info\"\n          *ngIf=\"infoText\">\n        <op-icon icon-classes=\"icon-info1 icon-context\"></op-icon>\n        <span [textContent]=\"infoText\">\n\n        </span>\n      </li>\n    </ul>\n  </nav>\n\n  <div class=\"pagination--options\"\n       *ngIf=\"showPerPageOptions()\">\n    <ul class=\"pagination--items\">\n      <li class=\"pagination--label\" [textContent]=\"text.per_page\" title=\"{{ text.per_page }}\"></li>\n\n      <li *ngFor=\"let perPageOption of perPageOptions\"\n          [ngClass]=\"{ '-current': perPageOption == pagination.perPage }\"\n          class=\"pagination--item\">\n\n       <span *ngIf=\"perPageOption != pagination.perPage\">\n         <a (accessibleClick)=\"selectPerPage(perPageOption)\"\n            role=\"link\"\n            [textContent]=\"perPageOption\"\n            href></a>\n       </span>\n\n       <span *ngIf=\"perPageOption == pagination.perPage\">{{ perPageOption }}</span>\n      </li>\n    </ul>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';\nimport {UploadFile, UploadHttpEvent, UploadInProgress} from \"core-components/api/op-file-upload/op-file-upload.service\";\nimport {HttpErrorResponse, HttpEventType, HttpProgressEvent} from \"@angular/common/http\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: 'notifications-upload-progress',\n  template: `\n    <li>\n      <span class=\"filename\" [textContent]=\"fileName\"></span>\n      <progress [hidden]=\"completed\" max=\"100\" [value]=\"value\">{{value}}%</progress>\n      <span class=\"upload-completed\" *ngIf=\"completed || error\">\n      <op-icon icon-classes=\"icon-close\" *ngIf=\"error\"></op-icon>\n      <op-icon icon-classes=\"icon-checkmark\" *ngIf=\"completed\"></op-icon>\n    </span>\n    </li>\n  `\n})\nexport class UploadProgressComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public upload:UploadInProgress;\n  @Output() public onError = new EventEmitter<HttpErrorResponse>();\n  @Output() public onSuccess = new EventEmitter<undefined>();\n\n  public file:UploadFile;\n  public value:number = 0;\n  public error:boolean = false;\n  public completed = false;\n\n  constructor(protected readonly I18n:I18nService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.file = this.upload[0];\n    const observable = this.upload[1];\n\n    observable\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(\n        (evt:UploadHttpEvent) => {\n          switch (evt.type) {\n            case HttpEventType.Sent:\n              this.value = 5;\n              return debugLog(`Uploading file \"${this.file.name}\" of size ${this.file.size}.`);\n\n            case HttpEventType.UploadProgress:\n              return this.updateProgress(evt);\n\n            case HttpEventType.Response:\n              debugLog(`File ${this.fileName} was fully uploaded.`);\n              this.value = 100;\n              this.completed = true;\n              return this.onSuccess.emit();\n\n            default:\n              // Sent or unknown event\n              return;\n          }\n        },\n        (error:HttpErrorResponse) => this.handleError(error)\n      );\n  }\n\n  public get fileName():string|undefined {\n    return this.file && this.file.name;\n  }\n\n  private updateProgress(evt:HttpProgressEvent) {\n    if (evt.total) {\n      this.value = Math.round(evt.loaded / evt.total * 100);\n    } else {\n      this.value = 10;\n    }\n  }\n\n  private handleError(error:HttpErrorResponse) {\n    this.error = true;\n    this.onError.emit(error);\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\nimport {Observable, zip} from 'rxjs';\nimport {take, takeUntil} from 'rxjs/operators';\nimport {WorkPackageCacheService} from '../work-packages/work-package-cache.service';\nimport {RelatedWorkPackagesGroup} from './wp-relations.interfaces';\nimport {RelationsStateValue, WorkPackageRelationsService} from './wp-relations.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n\n@Component({\n  selector: 'wp-relations',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './wp-relations.template.html'\n})\nexport class WorkPackageRelationsComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  public relationGroups:RelatedWorkPackagesGroup = {};\n  public relationGroupKeys:string[] = [];\n  public relationsPresent:boolean = false;\n  public canAddRelation:boolean;\n\n  // By default, group by relation type\n  public groupByWorkPackageType = false;\n\n  public text = {\n    relations_header: this.I18n.t('js.work_packages.tabs.relations')\n  };\n  public currentRelations:WorkPackageResource[] = [];\n\n  constructor(private I18n:I18nService,\n              private wpRelations:WorkPackageRelationsService,\n              private cdRef:ChangeDetectorRef,\n              private wpCacheService:WorkPackageCacheService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.canAddRelation = !!this.workPackage.addRelation;\n\n    this.wpRelations.state(this.workPackage.id!).values$()\n      .pipe(\n        takeUntil(componentDestroyed(this))\n      )\n      .subscribe((relations:RelationsStateValue) => {\n        this.loadedRelations(relations);\n      });\n\n    this.wpRelations.require(this.workPackage.id!);\n\n    // Listen for changes to this WP.\n    this.wpCacheService.loadWorkPackage(this.workPackage.id!).values$()\n      .pipe(\n        takeUntil(componentDestroyed(this))\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.workPackage = wp;\n      });\n  }\n\n  private getRelatedWorkPackages(workPackageIds:string[]):Observable<WorkPackageResource[]> {\n    let observablesToGetZipped:Observable<WorkPackageResource>[] = workPackageIds.map(wpId => {\n      return this.wpCacheService.loadWorkPackage(wpId).values$();\n    });\n\n    return zip(...observablesToGetZipped);\n  }\n\n  protected getRelatedWorkPackageId(relation:RelationResource):string {\n    const involved = relation.ids;\n    return (relation.to.href === this.workPackage.href) ? involved.from : involved.to;\n  }\n\n  public toggleGroupBy() {\n    this.groupByWorkPackageType = !this.groupByWorkPackageType;\n    this.buildRelationGroups();\n  }\n\n  protected buildRelationGroups() {\n    if (_.isNil(this.currentRelations)) {\n      return;\n    }\n\n    this.relationGroups = <RelatedWorkPackagesGroup>_.groupBy(this.currentRelations,\n      (wp:WorkPackageResource) => {\n        if (this.groupByWorkPackageType) {\n          return wp.type.name;\n        } else {\n          var normalizedType = (wp.relatedBy as RelationResource).normalizedType(this.workPackage);\n          return this.I18n.t('js.relation_labels.' + normalizedType);\n        }\n      });\n    this.relationGroupKeys = _.keys(this.relationGroups);\n    this.relationsPresent = _.size(this.relationGroups) > 0;\n    this.cdRef.detectChanges();\n  }\n\n  protected loadedRelations(stateValues:RelationsStateValue):void {\n    var relatedWpIds:string[] = [];\n    var relations:{ [wpId:string]:any } = [];\n\n    if (_.size(stateValues) === 0) {\n      this.currentRelations = [];\n      return this.buildRelationGroups();\n    }\n\n    _.each(stateValues, (relation:RelationResource) => {\n      const relatedWpId = this.getRelatedWorkPackageId(relation);\n      relatedWpIds.push(relatedWpId);\n      relations[relatedWpId] = relation;\n    });\n\n    this.getRelatedWorkPackages(relatedWpIds)\n      .pipe(\n        take(1)\n      )\n      .subscribe((relatedWorkPackages:WorkPackageResource[]) => {\n        this.currentRelations = relatedWorkPackages.map((wp:WorkPackageResource) => {\n          wp.relatedBy = relations[wp.id!];\n          return wp;\n        });\n\n        this.buildRelationGroups();\n      });\n  }\n}\n","<div class=\"loading-indicator--location\"\n     data-indicator-name=\"relation-groups\">\n\n  <div class=\"wp-relations-hierarchy-section\"\n       *ngIf=\"!relationsPresent\">\n    <div class=\"attributes-group--header\">\n      <div class=\"attributes-group--header-container\">\n        <h3 class=\"attributes-group--header-text\"\n            [textContent]=\"text.relations_header\">\n        </h3>\n      </div>\n    </div>\n  </div>\n\n\n  <div *ngFor=\"let type of relationGroupKeys; let first = first\">\n    <wp-relations-group [header]=\"type\"\n                        [groupByWorkPackageType]=\"groupByWorkPackageType\"\n                        (onToggleGroupBy)=\"toggleGroupBy()\"\n                        [firstGroup]=\"first\"\n                        [relatedWorkPackages]=\"relationGroups[type]\"\n                        [workPackage]=\"workPackage\"></wp-relations-group>\n  </div>\n  <wp-relations-create *ngIf=\"canAddRelation\"\n                       [workPackage]=\"workPackage\">\n  </wp-relations-create>\n\n  <wp-relations-hierarchy [workPackage]=\"workPackage\"></wp-relations-hierarchy>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {Component, Input} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\n@Component({\n  selector: 'wp-details-toolbar',\n  templateUrl: './wp-details-toolbar.html'\n})\nexport class WorkPackageSplitViewToolbarComponent {\n  @Input('workPackage') workPackage:WorkPackageResource;\n\n  public text = {\n    button_more: this.I18n.t('js.button_more')\n  }\n\nconstructor(readonly I18n:I18nService,\n            readonly halEditing:HalResourceEditingService) {}\n}\n","<div class=\"work-packages--details-toolbar\">\n  <wp-watcher-button [workPackage]=\"workPackage\"\n                     [showText]=\"true\">\n  </wp-watcher-button>\n\n  <button class=\"button dropdown-relative\"\n          [attr.accesskey]=\"7\"\n\n          wpSingleContextMenu\n          [wpSingleContextMenu-workPackage]=\"workPackage\">\n    <span class=\"button--text\" [textContent]=\"text.button_more\"></span>\n    <op-icon icon-classes=\"button--dropdown-indicator\"></op-icon>\n  </button>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\n\nexport class ActivityEntryInfo {\n\n  constructor(public timezoneService:TimezoneService,\n              public isReversed:boolean,\n              public activities:any[],\n              public activity:any,\n              public index:number) {\n  }\n\n  public number(forceReverse:boolean = false) {\n    return this.orderedIndex(this.index, forceReverse);\n  }\n\n  public get date() {\n    return this.activityDate(this.activity);\n  }\n\n  public get dateOfPrevious():any {\n    if (this.index > 0) {\n      return this.activityDate(this.activities[this.index - 1]);\n    }\n  }\n\n  public get href() {\n    return this.activity.href;\n  }\n\n  public get version() {\n    return this.activity.version;\n  }\n\n  public get isNextDate() {\n    return this.date !== this.dateOfPrevious;\n  }\n\n  public isInitial(forceReverse:boolean = false) {\n    var activityNo = this.number(forceReverse);\n\n    if (this.activity._type.indexOf('Activity') !== 0) {\n      return false;\n    }\n\n    if (activityNo === 1) {\n      return true;\n    }\n\n    while (--activityNo > 0) {\n      var idx = this.orderedIndex(activityNo, forceReverse) - 1;\n      var activity = this.activities[idx];\n      if (!_.isNil(activity) && activity._type.indexOf('Activity') === 0) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  protected activityDate(activity:any) {\n    // Force long date regardless of current date settings for headers\n    return moment(activity.createdAt).format('LL');\n  }\n\n  protected orderedIndex(activityNo:number, forceReverse:boolean = false) {\n    if (forceReverse || this.isReversed) {\n      return this.activities.length - activityNo;\n    }\n\n    return activityNo + 1;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ActivityEntryInfo} from './activity-entry-info';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {Injectable} from '@angular/core';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {WorkPackageLinkedResourceCache} from 'core-components/wp-single-view-tabs/wp-linked-resource-cache.service';\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\n\n@Injectable()\nexport class WorkPackagesActivityService extends WorkPackageLinkedResourceCache<HalResource[]> {\n\n  constructor(public ConfigurationService:ConfigurationService,\n              readonly timezoneService:TimezoneService) {\n    super();\n  }\n\n  public get order() {\n    return this.isReversed ? 'desc' : 'asc';\n  }\n\n  public get isReversed() {\n    return this.ConfigurationService.commentsSortedInDescendingOrder();\n  }\n\n  /**\n   * Aggregate user and revision activities for the given work package resource.\n   * Resolves both promises and returns a sorted list of activities\n   * whose order depends on the 'commentsSortedInDescendingOrder' property.\n   */\n  protected load(workPackage:WorkPackageResource):Promise<HalResource[]> {\n    var aggregated:any[] = [], promises:Promise<any>[] = [];\n\n    var add = function (data:any) {\n      aggregated.push(data.elements);\n    };\n\n    promises.push(workPackage.activities.$update().then(add));\n\n    if (workPackage.revisions) {\n      promises.push(workPackage.revisions.$update().then(add));\n    }\n    return Promise.all(promises).then(() => {\n      return this.sortedActivityList(aggregated);\n    });\n  }\n\n  protected sortedActivityList(activities:HalResource[], attr:string = 'createdAt'):HalResource[] {\n    let sorted = _.sortBy(_.flatten(activities), attr);\n\n    if (this.isReversed) {\n      return sorted.reverse();\n    } else {\n      return sorted;\n    }\n  }\n\n  public info(activities:HalResource[], activity:HalResource, index:number) {\n    return new ActivityEntryInfo(this.timezoneService, this.isReversed, activities, activity, index);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {PaginationService} from 'core-components/table-pagination/pagination-service';\nimport {PaginationInstance} from 'core-components/table-pagination/pagination-instance';\nimport {IPaginationOptions} from './pagination-service';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  selector: '[tablePagination]',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './table-pagination.component.html'\n})\nexport class TablePaginationComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() totalEntries:string;\n  @Input() hideForSinglePageResults:boolean = false;\n  @Input() showPerPage:boolean = true;\n  @Input() showPageSelections:boolean = true;\n  @Input() infoText?:string;\n  @Output() updateResults = new EventEmitter<PaginationInstance>();\n\n  public pagination:PaginationInstance;\n  public text = {\n    label_previous: this.I18n.t('js.pagination.pages.previous'),\n    label_next: this.I18n.t('js.pagination.pages.next'),\n    per_page: this.I18n.t('js.label_per_page'),\n    no_other_page: this.I18n.t('js.pagination.no_other_page')\n  };\n\n  public currentRange:string = '';\n  public pageNumbers:number[] = [];\n  public postPageNumbers:number[] = [];\n  public prePageNumbers:number[] = [];\n  public perPageOptions:number[] = [];\n\n  constructor(protected paginationService:PaginationService,\n              protected cdRef:ChangeDetectorRef,\n              protected I18n:I18nService) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.paginationService\n      .loadPaginationOptions()\n      .then((paginationOptions:IPaginationOptions) => {\n        this.perPageOptions = paginationOptions.perPageOptions;\n        this.pagination = new PaginationInstance(1, parseInt(this.totalEntries), paginationOptions.perPage);\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public update() {\n    this.updateCurrentRangeLabel();\n    this.updatePageNumbers();\n    this.cdRef.detectChanges();\n  }\n\n  public selectPerPage(perPage:number) {\n    this.pagination.perPage = perPage;\n    this.paginationService.setPerPage(perPage);\n    this.showPage(1);\n  }\n\n  public showPage(page:number) {\n    this.pagination.page = page;\n\n    this.updateCurrentRangeLabel();\n    this.updatePageNumbers();\n\n    this.onUpdatedPage();\n    this.cdRef.detectChanges();\n  }\n\n  public onUpdatedPage() {\n    this.updateResults.emit(this.pagination);\n  }\n\n  public get isVisible() {\n    return !this.hideForSinglePageResults || (this.pagination.total > this.pagination.perPage);\n  }\n\n  /**\n   * @name updateCurrentRange\n   *\n   * @description Defines a string containing page bound information inside the directive scope\n   */\n  public updateCurrentRangeLabel() {\n    if (this.pagination.total) {\n      let totalItems = this.pagination.total;\n      let lowerBound = this.pagination.getLowerPageBound();\n      let upperBound = this.pagination.getUpperPageBound(this.pagination.total);\n\n      this.currentRange = '(' + lowerBound + ' - ' + upperBound + '/' + totalItems + ')';\n    } else {\n      this.currentRange = '(0 - 0/0)';\n    }\n  }\n\n  /**\n   * @name updatePageNumbers\n   *\n   * @description Defines a list of all pages in numerical order inside the scope\n   */\n  public updatePageNumbers() {\n    if (!this.showPageSelections) {\n      this.pageNumbers = [];\n      this.postPageNumbers = [];\n      return;\n    }\n\n    var maxVisible = this.paginationService.getMaxVisiblePageOptions();\n    var truncSize = this.paginationService.getOptionsTruncationSize();\n\n    var pageNumbers = [];\n\n    const perPage = this.pagination.perPage;\n    const currentPage = this.pagination.page;\n    if (perPage) {\n      for (var i = 1; i <= Math.ceil(this.pagination.total / perPage); i++) {\n        pageNumbers.push(i);\n      }\n\n      // This avoids a truncation when there are not enough elements to truncate for the first elements\n      var startingDiff = currentPage - 2 * truncSize;\n      if (0 <= startingDiff && startingDiff <= 1) {\n        this.postPageNumbers = this.truncatePageNums(pageNumbers, pageNumbers.length >= maxVisible + (truncSize * 2), maxVisible + truncSize, pageNumbers.length, 0);\n      } else {\n        this.prePageNumbers = this.truncatePageNums(pageNumbers, currentPage >= maxVisible, 0, Math.min(currentPage - Math.ceil(maxVisible / 2), pageNumbers.length - maxVisible), truncSize);\n        this.postPageNumbers = this.truncatePageNums(pageNumbers, pageNumbers.length >= maxVisible + (truncSize * 2), maxVisible, pageNumbers.length, 0);\n      }\n    }\n\n    this.pageNumbers = pageNumbers;\n  }\n\n  public showPerPageOptions() {\n    return this.showPerPage &&\n      this.perPageOptions.length > 0 &&\n      this.pagination.total > this.perPageOptions[0];\n  }\n\n  private truncatePageNums(pageNumbers:any, perform:any, disectFrom:any, disectLength:any, truncateFrom:any) {\n    if (perform) {\n      var truncationSize = this.paginationService.getOptionsTruncationSize();\n      var truncatedNums = pageNumbers.splice(disectFrom, disectLength);\n      if (truncatedNums.length >= truncationSize * 2) {\n        truncatedNums.splice(truncateFrom, truncatedNums.length - truncationSize);\n      }\n      return truncatedNums;\n    } else {\n      return [];\n    }\n  }\n}\n","import {Injectable, Injector} from '@angular/core';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {BcfApiService} from \"core-app/modules/bim/bcf/api/bcf-api.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {BcfViewpointPaths} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.paths\";\nimport {ViewerBridgeService} from \"core-app/modules/bim/bcf/bcf-viewer-bridge/viewer-bridge.service\";\nimport {switchMap, map, tap} from 'rxjs/operators';\nimport {of, forkJoin, Observable} from 'rxjs';\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\nimport {BcfTopicResource} from \"core-app/modules/bim/bcf/api/topics/bcf-topic.resource\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\n\n\n@Injectable()\nexport class ViewpointsService {\n  topicUUID:string|number;\n\n  @InjectField() bcfApi:BcfApiService;\n  @InjectField() viewerBridge:ViewerBridgeService;\n  @InjectField() wpCache:WorkPackageCacheService;\n\n  constructor(readonly injector:Injector) {}\n\n  public getViewPointResource(workPackage:WorkPackageResource, index:number):BcfViewpointPaths {\n    const viewpointHref = workPackage.bcfViewpoints[index].href;\n\n    return this.bcfApi.parse<BcfViewpointPaths>(viewpointHref);\n  }\n\n  public getViewPoint$(workPackage:WorkPackageResource, index:number):Observable<BcfViewpointInterface> {\n    const viewpointResource = this.getViewPointResource(workPackage, index);\n\n    return viewpointResource.get();\n  }\n\n  public deleteViewPoint$(workPackage:WorkPackageResource, index:number):Observable<BcfViewpointInterface> {\n    const viewpointResource = this.getViewPointResource(workPackage, index);\n\n    return viewpointResource\n            .delete()\n            .pipe(\n              // Update the work package to reload the viewpoints\n              tap(() => this.wpCache.require(workPackage.id!, true))\n            );\n  }\n\n  public saveViewpoint$(workPackage:WorkPackageResource, viewpoint?:BcfViewpointInterface): Observable<BcfViewpointInterface> {\n    const wpProjectId = workPackage.project.idFromLink;\n    const topicUUID$ = this.setBcfTopic$(workPackage);\n    // Default to the current viewer's viewpoint\n    const viewpoint$ = viewpoint ?\n                        of(viewpoint) :\n                        this.viewerBridge!.getViewpoint$();\n\n    return forkJoin({\n              topicUUID: topicUUID$,\n              viewpoint: viewpoint$,\n            })\n            .pipe(\n              switchMap(results => {\n                return this.bcfApi\n                              .projects.id(wpProjectId)\n                              .topics.id(results.topicUUID as (string | number))\n                              .viewpoints\n                              .post(results.viewpoint)\n               }\n              ),\n              // Update the work package to reload the viewpoints\n              tap((results) => this.wpCache.require(workPackage.id!, true))\n            );\n  }\n\n  public setBcfTopic$(workPackage:WorkPackageResource) {\n    if (this.topicUUID) {\n      return of(this.topicUUID);\n    } else {\n      const topicHref = workPackage.bcfTopic?.href;\n      const topicUUID$ = topicHref ?\n                          of(this.bcfApi.parse<BcfViewpointPaths>(topicHref)!.id) :\n                          this.createBcfTopic$(workPackage);\n  \n      return topicUUID$.pipe(map(topicUUID => this.topicUUID = topicUUID));\n    }\n  }\n\n  private createBcfTopic$(workPackage:WorkPackageResource):Observable<string> {\n    const wpProjectId = workPackage.project.idFromLink;\n    const wpPayload = workPackage.convertBCF.payload;\n\n    return this.bcfApi\n                  .projects.id(wpProjectId)\n                  .topics\n                  .post(wpPayload)\n                  .pipe(\n                    map((resource:BcfTopicResource) => {\n                      this.topicUUID = resource.guid;\n                      return this.topicUUID;\n                    })\n                  );\n  }\n}","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, ChangeDetectorRef, Component, EventEmitter, Input, Output} from '@angular/core';\nimport {VersionDmService} from \"core-app/modules/hal/dm-services/version-dm.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {VersionResource} from \"core-app/modules/hal/resources/version-resource\";\nimport {CreateAutocompleterComponent} from \"core-app/modules/common/autocomplete/create-autocompleter.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\n\n@Component({\n  templateUrl: './create-autocompleter.component.html',\n  selector: 'version-autocompleter'\n})\nexport class VersionAutocompleterComponent extends CreateAutocompleterComponent implements AfterViewInit {\n  @Input() public openDirectly:boolean = false;\n  @Output() public onCreate = new EventEmitter<VersionResource>();\n\n  constructor(readonly I18n:I18nService,\n              readonly currentProject:CurrentProjectService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly pathHelper:PathHelperService,\n              readonly versionDm:VersionDmService,\n              readonly halNotification:HalResourceNotificationService) {\n    super(I18n, cdRef, currentProject, pathHelper);\n  }\n\n  ngAfterViewInit() {\n    super.ngAfterViewInit();\n\n    this.canCreateNewActionElements().then((val) => {\n      if (val) {\n        this.createAllowed = (input:string) => this.createNewVersion(input);\n        this.cdRef.detectChanges();\n      }\n    });\n  }\n\n  /**\n   * Checks for correct permissions\n   * (whether the current project is in the list of allowed values in the version create form)\n   * @returns {Promise<boolean>}\n   */\n  public canCreateNewActionElements():Promise<boolean> {\n    if (!this.currentProject.id) {\n      return Promise.resolve(false);\n    }\n\n    return this.versionDm\n      .canCreateVersionInProject(this.currentProject.id!)\n      .catch(() => false);\n  }\n\n  protected createNewVersion(name:string) {\n    this.versionDm.createVersion(this.getVersionPayload(name))\n      .then((version) => {\n        this.onCreate.emit(version);\n      })\n      .catch(error => {\n        this.closeSelect();\n        this.halNotification.handleRawError(error);\n      });\n  }\n\n  private getVersionPayload(name:string) {\n    let payload:any = {};\n    payload['name'] = name;\n    payload['_links'] = {\n      definingProject: {\n        href: this.pathHelper.api.v3.projects.id(this.currentProject.id!).path\n      }\n    };\n\n    return payload;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {HalResourceService} from 'core-app/modules/hal/services/hal-resource.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {PayloadDmService} from \"core-app/modules/hal/dm-services/payload-dm.service\";\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {AbstractDmService} from \"core-app/modules/hal/dm-services/abstract-dm.service\";\n\n@Injectable()\nexport class GridDmService extends AbstractDmService<GridResource> {\n  constructor(protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService,\n              protected payloadDm:PayloadDmService) {\n    super(halResourceService,\n          pathHelper);\n  }\n\n  public createForm(resource:GridResource|null|any = null, schema:SchemaResource|null = null) {\n    let payload = this.extractPayload(resource, schema);\n\n    return this.halResourceService.post<FormResource>(this.pathHelper.api.v3.grids.form().toString(),\n                                                      payload).toPromise();\n  }\n\n  public create(resource:GridResource, schema:SchemaResource|null = null):Promise<GridResource> {\n    let payload = this.extractPayload(resource, schema);\n\n    return this.halResourceService.post<GridResource>(this.pathHelper.api.v3.grids.path,\n                                                      payload).toPromise();\n  }\n\n  public update(resource:GridResource, schema:SchemaResource|null = null):Promise<GridResource> {\n    let payload = this.extractPayload(resource, schema);\n\n    return this.halResourceService.patch<GridResource>(this.pathHelper.api.v3.grids.id(resource.id!).toString(),\n                                                       payload).toPromise();\n  }\n\n  public updateForm(resource:GridResource, schema:SchemaResource|null = null) {\n    let payload = this.extractPayload(resource, schema);\n\n    return this.halResourceService.post<FormResource>(this.pathHelper.api.v3.grids.id(resource.idFromLink).form.toString(),\n                                                      payload).toPromise();\n  }\n\n  public extractPayload(resource:GridResource|null = null, schema:SchemaResource|null = null) {\n    if (resource && schema) {\n      let payload = this.payloadDm.extract(resource, schema);\n\n      // The widget only states the type of the widget resource but does not explain\n      // the widget itself. We therefore have to do that by hand.\n      if (payload.widgets) {\n        payload.widgets = resource.widgets.map((widget) => {\n          return {\n            id: widget.id,\n            startRow: widget.startRow,\n            endRow: widget.endRow,\n            startColumn: widget.startColumn,\n            endColumn: widget.endColumn,\n            identifier: widget.identifier,\n            options: widget.options\n          };\n        });\n      }\n\n      return payload;\n    } else if (!(resource instanceof HalResource)) {\n      return resource;\n    } else {\n      return {};\n    }\n  }\n\n  protected listUrl() {\n    return this.pathHelper.api.v3.grids.toString();\n  }\n\n  protected oneUrl(id:number|string) {\n    return this.pathHelper.api.v3.grids.id(id).toString();\n  }\n}\n","// Separated from render passes to avoid cyclic dependencies\nexport const rowGroupClassName = 'wp-table--group-header';\nexport const collapsedRowClass = '-collapsed';\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport {MultiInputState} from \"reactivestates\";\nimport {Injectable} from '@angular/core';\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {StateCacheService} from 'core-components/states/state-cache.service';\nimport {UserDmService} from 'core-app/modules/hal/dm-services/user-dm.service';\nimport {States} from 'core-components/states.service';\n\n@Injectable({ providedIn: 'root' })\nexport class UserCacheService extends StateCacheService<UserResource>  {\n\n  constructor(readonly states:States,\n              readonly userDmService:UserDmService) {\n    super();\n  }\n\n  protected load(id:number|string):Promise<UserResource> {\n    return this.userDmService.load(id);\n  }\n\n  protected loadAll(ids:string[]):Promise<undefined> {\n    const promises = ids.map(id => this.load(id));\n    return Promise.all(promises).then(() => undefined);\n  }\n\n  protected get multiState():MultiInputState<UserResource> {\n    return this.states.users;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {input} from 'reactivestates';\nimport {HelpTextResource} from 'core-app/modules/hal/resources/help-text-resource';\nimport {HelpTextDmService} from 'core-app/modules/hal/dm-services/help-text-dm.service';\nimport {Injectable} from '@angular/core';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\n\n@Injectable({ providedIn: 'root' })\nexport class AttributeHelpTextsService {\n  private helpTexts = input<HelpTextResource[]>();\n\n  constructor(private helpTextDm:HelpTextDmService) {\n  }\n\n  /**\n   * Search for a given attribute help text\n   *\n   * @param attribute\n   * @param scope\n   */\n  public require(attribute:string, scope:string):Promise<HelpTextResource|undefined> {\n      this.helpTexts.putFromPromiseIfPristine(() =>\n        this.helpTextDm\n          .loadAll()\n          .then((resources:CollectionResource<HelpTextResource>) => resources.elements)\n      );\n\n      return new Promise<HelpTextResource|undefined>((resolve, reject) => {\n        this.helpTexts\n          .valuesPromise()\n          .then(() => resolve(this.find(attribute, scope)));\n       });\n  }\n\n  private find(attribute:string, scope:string):HelpTextResource|undefined {\n    const value = this.helpTexts.getValueOr([]);\n    return _.find(value, (element) => element.scope === scope && element.attribute === attribute);\n  }\n}\n","import {ApplicationRef, ComponentFactoryResolver, Injectable, Injector} from '@angular/core';\nimport {ComponentPortal, DomPortalOutlet, PortalInjector} from '@angular/cdk/portal';\nimport {TransitionService} from '@uirouter/core';\nimport {FocusHelperService} from 'core-app/modules/common/focus/focus-helper';\nimport {ExternalQueryConfigurationComponent} from \"core-components/wp-table/external-configuration/external-query-configuration.component\";\nimport {\n  OpQueryConfigurationLocalsToken,\n  OpQueryConfigurationTriggerEvent\n} from \"core-components/wp-table/external-configuration/external-query-configuration.constants\";\n\nexport type Class = { new(...args:any[]):any; };\n\n@Injectable()\nexport class ExternalQueryConfigurationService {\n\n  // Hold a reference to the DOM node we're using as a host\n  private _portalHostElement:HTMLElement;\n  // And a reference to the actual portal host interface on top of the element\n  private _bodyPortalHost:DomPortalOutlet;\n\n  constructor(private componentFactoryResolver:ComponentFactoryResolver,\n              readonly FocusHelper:FocusHelperService,\n              private appRef:ApplicationRef,\n              private $transitions:TransitionService,\n              private injector:Injector) {\n  }\n\n  public setupListener() {\n    // Listen to keyups on window to close context menus\n    jQuery(window)\n      .on(OpQueryConfigurationTriggerEvent,\n        (event:JQuery.TriggeredEvent, originator:JQuery, currentQuery:any) => {\n      this.show(originator, currentQuery);\n      return false;\n    });\n  }\n\n  /**\n   * Create a portal host element to contain the table configuration components.\n   */\n  private get bodyPortalHost() {\n    if (!this._portalHostElement) {\n      const hostElement = this._portalHostElement = document.createElement('div');\n      hostElement.classList.add('op-external-query-configuration--container');\n      document.body.appendChild(hostElement);\n\n      this._bodyPortalHost = new DomPortalOutlet(\n        hostElement,\n        this.componentFactoryResolver,\n        this.appRef,\n        this.injector\n      );\n    }\n\n    return this._bodyPortalHost;\n  }\n\n  /**\n   * Open a Modal reference and append it to the portal\n   */\n  public show(currentQuery:any,\n              callback:(newQuery:any) => void,\n              disabledTabs:{[key:string]:string} = {}) {\n    this.detach();\n\n    // Create a portal for the given component class and render it\n    const portal = new ComponentPortal(\n      this.externalQueryConfigurationComponent(),\n      null,\n      this.injectorFor({\n                        callback: callback,\n                        currentQuery: currentQuery,\n                        disabledTabs: disabledTabs\n                      })\n    );\n    this.bodyPortalHost.attach(portal);\n    this._portalHostElement.style.display = 'block';\n  }\n\n  /**\n   * Closes currently open modal window\n   */\n  public detach() {\n    // Detach any component currently in the portal\n    if (this.bodyPortalHost.hasAttached()) {\n      this.bodyPortalHost.detach();\n      this._portalHostElement.style.display = 'none';\n    }\n  }\n\n  /**\n   * Create an augmented injector that is equal to this service's injector + the additional data\n   * passed into +show+.\n   * This allows callers to pass data into the newly created modal.\n   *\n   */\n  private injectorFor(data:any) {\n    const injectorTokens = new WeakMap();\n    // Pass the service because otherwise we're getting a cyclic dependency between the portal\n    // host service and the bound portal\n    data.service = this;\n\n    injectorTokens.set(OpQueryConfigurationLocalsToken, data);\n\n    return new PortalInjector(this.injector, injectorTokens);\n  }\n\n  externalQueryConfigurationComponent():Class {\n    return ExternalQueryConfigurationComponent;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, OnInit} from \"@angular/core\";\n\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {UserCacheService} from \"core-components/user/user-cache.service\";\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  selector: 'revision-activity',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './revision-activity.component.html'\n})\nexport class RevisionActivityComponent implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public activity:any;\n  @Input() public activityNo:number;\n\n  public userId:string | number;\n  public userName:string;\n  public userActive:boolean;\n  public userPath:string | null;\n  public userLabel:string;\n  public userAvatar:string;\n\n  public project:ProjectResource;\n  public revision:string;\n  public message:string;\n\n  public revisionLink:string;\n\n  constructor(readonly I18n:I18nService,\n              readonly timezoneService:TimezoneService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly userCacheService:UserCacheService) {\n  }\n\n  ngOnInit() {\n    this.loadAuthor();\n\n    this.project = this.workPackage.project;\n    this.revision = this.activity.identifier;\n    this.message = this.activity.message.html;\n\n    const revisionPath = this.activity.showRevision.$link.href;\n    const formattedRevision = this.activity.formattedIdentifier;\n\n    const link = document.createElement('a');\n    link.href = revisionPath;\n    link.title = this.revision;\n    link.textContent = this.I18n.t(\n      \"js.label_committed_link\",\n      {revision_identifier: formattedRevision}\n    );\n\n    this.revisionLink = this.I18n.t(\"js.label_committed_at\",\n      {\n        committed_revision_link: link.outerHTML,\n        date: this.timezoneService.formattedDatetime(this.activity.createdAt)\n      });\n  }\n\n  private loadAuthor() {\n    if (this.activity.author === undefined) {\n      this.userName = this.activity.authorName;\n    } else {\n      this.userCacheService\n        .require(this.activity.author.idFromLink)\n        .then((user:UserResource) => {\n          this.userId = user.id!;\n          this.userName = user.name;\n          this.userActive = user.isActive;\n          this.userAvatar = user.avatar;\n          this.userPath = user.showUser.href;\n          this.userLabel = this.I18n.t('js.label_author', {user: this.userName});\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n}\n","<div class=\"work-package-details-activities-activity-contents\"\n     *ngIf=\"workPackage\">\n  <div class=\"comments-number\">\n    <activity-link [workPackage]=\"workPackage\"\n                   [activityNo]=\"activityNo\">\n    </activity-link>\n  </div>\n\n  <user-avatar *ngIf=\"activity.author && userName\"\n               [attr.data-user-name]=\"userName\"\n               [attr.data-user-id]=\"userId\"\n               data-class-list=\"avatar\">\n  </user-avatar>\n\n  <user-avatar *ngIf=\"!activity.author && userName\"\n               [attr.data-user-name]=\"userName\"\n               [attr.data-use-fallback]=\"true\"\n               data-class-list=\"avatar\">\n  </user-avatar>\n\n  <span class=\"user\" *ngIf=\"userActive\">\n    <a [attr.href]=\"userPath\"\n       [attr.aria-label]=\"userLabel\"\n       [textContent]=\"userName\"></a>\n  </span>\n  <span class=\"user\" *ngIf=\"!userActive\" [textContent]=\"userName\"></span>\n  <span class=\"revision-activity--revision-link date\" [innerHtml]=\"revisionLink\"></span>\n  <span class=\"user-comment wiki\">\n    <span class=\"message\" [innerHtml]=\"message\"></span>\n  </span>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\n@Component({\n  templateUrl: './text-edit-field.component.html'\n})\nexport class TextEditFieldComponent extends EditFieldComponent {\n  // ToDo: Work package specific\n  public shouldFocus = this.name === 'subject';\n}\n","<input type=\"text\"\n       class=\"inline-edit--field\"\n       [focus]=\"shouldFocus\"\n       [attr.aria-required]=\"required\"\n       [attr.required]=\"required\"\n       [disabled]=\"inFlight\"\n       [(ngModel)]=\"value\"\n       (keydown)=\"handler.handleUserKeydown($event)\"\n       (focusout)=\"handler.onFocusOut()\"\n       [id]=\"handler.htmlId\" />\n","// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\n@Component({\n  template: `\n    <input type=\"number\"\n           class=\"inline-edit--field\"\n           [attr.aria-required]=\"required\"\n           [attr.required]=\"required\"\n           [disabled]=\"inFlight\"\n           [attr.lang]=\"locale\"\n           [(ngModel)]=\"value\"\n           (keydown)=\"handler.handleUserKeydown($event)\"\n           (focusout)=\"handler.onFocusOut()\"\n           [id]=\"handler.htmlId\" />\n  `\n})\nexport class IntegerEditFieldComponent extends EditFieldComponent {\n  public locale = I18n.locale;\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport * as moment from 'moment';\nimport {Component} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Component({\n  template: `\n    <input type=\"number\"\n           step=\"0.01\"\n           class=\"inline-edit--field\"\n           [attr.aria-required]=\"required\"\n           [ngModel]=\"formatter(value)\"\n           (ngModelChange)=\"value = parser($event)\"\n           [attr.required]=\"required\"\n           (keydown)=\"handler.handleUserKeydown($event)\"\n           [disabled]=\"inFlight\"\n           [id]=\"handler.htmlId\" />\n  `\n})\nexport class DurationEditFieldComponent extends EditFieldComponent {\n  @InjectField() TimezoneService:TimezoneService;\n\n  public parser(value:any) {\n    if (!isNaN(value)) {\n      let floatValue = parseFloat(value);\n      return moment.duration(floatValue, 'hours');\n    }\n\n    return value;\n  }\n\n  public formatter(value:any) {\n    return Number(moment.duration(value).asHours().toFixed(2));\n  }\n\n  protected parseValue(val:moment.Moment | null) {\n    if (val === null) {\n      return val\n    }\n\n    let parsedValue;\n    if (val.isValid()) {\n      parsedValue = val.toISOString();\n    } else {\n      parsedValue = this.resource[this.name];\n    }\n\n    return parsedValue;\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\n\ninterface SelectAutocompleterAssignment {\n  attribute:string;\n  component:string;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class SelectAutocompleterRegisterService {\n  private _fields:SelectAutocompleterAssignment[] = [];\n\n  public register(component:any, attribute:string) {\n    this._fields.push({ attribute: attribute, component: component, });\n  }\n\n  public getAutocompleterOfAttribute(attribute:string) {\n    let assignment = _.find(this._fields, field => field.attribute === attribute);\n    return assignment ? assignment.component : undefined;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnInit} from \"@angular/core\";\nimport {HalResourceSortingService} from \"core-app/modules/hal/services/hal-resource-sorting.service\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {EditFieldComponent} from \"../edit-field.component\";\nimport {CreateAutocompleterComponent} from \"core-app/modules/common/autocomplete/create-autocompleter.component\";\nimport {SelectAutocompleterRegisterService} from \"app/modules/fields/edit/field-types/select-autocompleter-register.service\";\nimport {from} from 'rxjs';\nimport {map, tap} from 'rxjs/operators';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport interface ValueOption {\n  name:string;\n  $href:string|null;\n}\n\n@Component({\n  templateUrl: './select-edit-field.component.html'\n})\nexport class SelectEditFieldComponent extends EditFieldComponent implements OnInit {\n  @InjectField() selectAutocompleterRegister:SelectAutocompleterRegisterService;\n  @InjectField() halNotification:HalResourceNotificationService;\n  @InjectField() halSorting:HalResourceSortingService;\n\n  public availableOptions:any[];\n  public valueOptions:ValueOption[];\n  protected valuesLoaded = false;\n\n  public text:{ [key:string]:string };\n\n  public appendTo:any = null;\n  private hiddenOverflowContainer = '.__hidden_overflow_container';\n\n  /** Remember the values loading promise which changes as soon as the changeset is updated\n   * (e.g., project or type is changed).\n   */\n  private valuesLoadingPromise:Promise<unknown>;\n\n  protected _autocompleterComponent:CreateAutocompleterComponent;\n\n  public referenceOutputs:{ [key:string]:Function } = {\n    onCreate: (newElement:HalResource) => this.onCreate(newElement),\n    onChange: (value:HalResource) => this.onChange(value),\n    onKeydown: (event:JQuery.TriggeredEvent) => this.handler.handleUserKeydown(event, true),\n    onOpen: () => this.onOpen(),\n    onClose: () => this.onClose(),\n    onAfterViewInit: (component:CreateAutocompleterComponent) => this._autocompleterComponent = component\n  };\n\n  protected initialize() {\n    this.text = {\n      requiredPlaceholder: this.I18n.t('js.placeholders.selection'),\n      placeholder: this.I18n.t('js.placeholders.default')\n    };\n\n    this.valuesLoadingPromise = this.change.getForm().then(() => {\n      return this.initialValueLoading();\n    });\n  }\n\n  protected initialValueLoading() {\n    this.valuesLoaded = false;\n    return this.loadValues().toPromise();\n  }\n\n  public autocompleterComponent() {\n    let type = this.schema.type;\n    return this.selectAutocompleterRegister.getAutocompleterOfAttribute(type) || CreateAutocompleterComponent;\n  }\n\n  public ngOnInit() {\n    super.ngOnInit();\n    this.appendTo = this.overflowingSelector;\n\n    this.handler\n      .$onUserActivate\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.valuesLoadingPromise.then(() => {\n          this._autocompleterComponent.openDirectly = true;\n        });\n      });\n  }\n\n  public get selectedOption() {\n    const href = this.value ? this.value.$href : null;\n    return _.find(this.valueOptions, o => o.$href === href)!;\n  }\n\n  public set selectedOption(val:ValueOption) {\n    let option = _.find(this.availableOptions, o => o.$href === val.$href);\n\n    // Special case 'null' value, which angular\n    // only understands in ng-options as an empty string.\n    if (option && option.$href === '') {\n      option.$href = null;\n    }\n\n    this.value = option;\n  }\n\n  private setValues(availableValues:HalResource[]) {\n    this.availableOptions = this.sortValues(availableValues);\n    this.addEmptyOption();\n    this.valueOptions = this.availableOptions.map(el => this.mapAllowedValue(el));\n  }\n\n  protected loadValues(query?:string) {\n    let allowedValues = this.schema.allowedValues;\n\n    if (Array.isArray(allowedValues)) {\n      this.setValues(allowedValues);\n      this.valuesLoaded = true;\n    } else if (allowedValues && !this.valuesLoaded) {\n      return this.loadValuesFromBackend(query);\n    } else {\n      this.setValues([]);\n    }\n\n    return from(Promise.resolve(this.valueOptions));\n  }\n\n  protected loadValuesFromBackend(query?:string) {\n    return from(\n      this.loadAllowedValues(query)\n    ).pipe(\n      tap(collection => {\n        // if it is an unpaginated collection or if we get all possible entries when fetching with a blank\n        // query, we do not need to load the values again;\n        if (collection.count === undefined || collection.total === undefined || (!query && collection.total === collection.count)) {\n          this.valuesLoaded = true;\n        }\n      }),\n      map(collection => {\n        if (collection.count === undefined || collection.total === undefined || (!query && collection.total === collection.count) || !this.value) {\n          return collection.elements;\n        } else {\n          return collection.elements.concat([this.value]);\n        }\n      }),\n      tap(elements => this.setValues(elements)),\n      map(() => this.valueOptions)\n    );\n  }\n\n  protected loadAllowedValues(query?:string):Promise<CollectionResource> {\n    // Cache the search without any params\n    if (!query) {\n      const cacheKey = this.schema.allowedValues.$link.href;\n      return this.change.cacheValue(cacheKey, this.fetchAllowedValueQuery.bind(this));\n    }\n\n    return this.fetchAllowedValueQuery(query);\n  }\n\n  protected fetchAllowedValueQuery(query?:string) {\n    return this.schema.allowedValues.$link.$fetch(this.allowedValuesFilter(query)) as Promise<CollectionResource>;\n  }\n\n  private addValue(val:HalResource) {\n    this.availableOptions.push(val);\n    this.valueOptions.push({ name: val.name, $href: val.$href });\n  }\n\n  public get currentValueInvalid():boolean {\n    return !!(\n      (this.value && !_.some(this.availableOptions, (option:HalResource) => (option.$href === this.value.$href)))\n      ||\n      (!this.value && this.schema.required)\n    );\n  }\n\n  public onCreate(newElement:HalResource) {\n    this.addValue(newElement);\n    this.selectedOption = { name: newElement.name, $href: newElement.$href };\n    this.handler.handleUserSubmit();\n  }\n\n  public onOpen() {\n    jQuery(this.hiddenOverflowContainer).one('scroll', () => {\n      this._autocompleterComponent.closeSelect();\n    });\n  }\n\n  public onClose() {\n    // Nothing to do\n  }\n\n  public onChange(value:HalResource|undefined) {\n    if (value !== undefined) {\n      this.selectedOption = { name: value.name, $href: value.$href };\n      this.handler.handleUserSubmit();\n      return;\n    }\n\n    const emptyOption = this.getEmptyOption();\n\n    if (emptyOption) {\n      this.selectedOption = emptyOption;\n      this.handler.handleUserSubmit();\n    }\n  }\n\n  private addEmptyOption() {\n    // Empty options are not available for required fields\n    if (this.isRequired()) {\n      return;\n    }\n\n    // Since we use the original schema values, avoid adding\n    // the option if one is returned / exists already.\n    const emptyOption = this.getEmptyOption();\n    if (emptyOption === undefined) {\n      this.availableOptions.unshift({\n        name: this.text.placeholder,\n        $href: ''\n      });\n    }\n  }\n\n  protected isRequired() {\n    return this.schema.required;\n  }\n\n  protected sortValues(availableValues:HalResource[]) {\n    return this.halSorting.sort(availableValues);\n  }\n\n  protected mapAllowedValue(value:HalResource):ValueOption {\n    return { name: value.name, $href: value.$href };\n  }\n\n  // Subclasses shall be able to override the filters with which the\n  // allowed values are reduced in the backend.\n  protected allowedValuesFilter(query?:string) {\n    return {};\n  }\n\n  private getEmptyOption():ValueOption|undefined {\n    return _.find(this.availableOptions, el => el.name === this.text.placeholder);\n  }\n}\n","<ndc-dynamic [ndcDynamicComponent]=\"autocompleterComponent()\"\n             [ndcDynamicInputs]=\"{ availableValues: valueOptions,\n                                   appendTo: appendTo,\n                                   model: selectedOption ? selectedOption : '',\n                                   required: required,\n                                   disabled: inFlight,\n                                   id: handler.htmlId,\n                                   finishedLoading: true,\n                                   classes: 'inline-edit--field ' + handler.fieldName }\"\n             [ndcDynamicOutputs]=\"referenceOutputs\">\n</ndc-dynamic>\n","<div class=\"textarea-wrapper\">\n  <ng-select [(ngModel)]=\"selectedOption\"\n             [ngClass]=\"'inline-edit--field -multi-select'\"\n             [required]=\"required\"\n             [clearable]=\"!required\"\n             [disabled]=\"inFlight\"\n             [id]=\"handler.htmlId\"\n             [items]=\"valueOptions\"\n             bindLabel=\"name\"\n             [virtualScroll]=\"true\"\n             [clearSearchOnAdd]=\"true\"\n             (keydown)=\"handler.handleUserKeydown($event, true)\"\n             (open)=\"onOpen()\"\n             (close)=\"onClose()\"\n             (add)=\"repositionDropdown()\"\n             (remove)=\"repositionDropdown()\"\n             [multiple]=\"true\"\n             [closeOnSelect]=\"false\"\n             [appendTo]=\"appendTo\"\n             [dropdownPosition]=\"'top'\"\n             [hideSelected]=\"true\">\n  </ng-select>\n\n  <edit-field-controls [fieldController]=\"self\"\n                       *ngIf=\"!handler.inEditMode\"\n                       (onSave)=\"handler.handleUserSubmit()\"\n                       (onCancel)=\"handler.handleUserCancel()\"\n                       [saveTitle]=\"text.save\"\n                       [cancelTitle]=\"text.cancel\">\n  </edit-field-controls>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {Component, OnInit, ViewChild} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {ValueOption} from \"core-app/modules/fields/edit/field-types/select-edit-field.component\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Component({\n  templateUrl: './multi-select-edit-field.component.html'\n})\nexport class MultiSelectEditFieldComponent extends EditFieldComponent implements OnInit {\n  @ViewChild(NgSelectComponent, { static: true }) public ngSelectComponent:NgSelectComponent;\n  @InjectField() I18n:I18nService;\n\n  public availableOptions:any[] = [];\n  public valueOptions:ValueOption[];\n  public text = {\n    requiredPlaceholder: this.I18n.t('js.placeholders.selection'),\n    placeholder: this.I18n.t('js.placeholders.default'),\n    save: this.I18n.t('js.inplace.button_save', { attribute: this.schema.name }),\n    cancel: this.I18n.t('js.inplace.button_cancel', { attribute: this.schema.name }),\n  };\n\n  public appendTo:any = null;\n  private hiddenOverflowContainer = '.__hidden_overflow_container';\n\n  public currentValueInvalid:boolean = false;\n  private nullOption:ValueOption;\n  private _selectedOption:ValueOption[];\n\n  /** Since we need to wait for values to be loaded, remember if the user activated this field*/\n  private requestFocus = false;\n\n  ngOnInit() {\n    this.nullOption = { name: this.text.placeholder, $href: null };\n\n    this.handler\n      .$onUserActivate\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.requestFocus = this.availableOptions.length === 0;\n\n        // If we already have all values loaded, open now.\n        if (!this.requestFocus) {\n          this.openAutocompleteSelectField();\n        }\n      });\n\n    super.ngOnInit();\n    this.appendTo = this.overflowingSelector;\n  }\n\n  public get value() {\n    const val = this.resource[this.name];\n    return val ? val[0] : val;\n  }\n\n  /**\n   * Map the selected hal resource(s) to the value options so that ngOptions will track them.\n   * We cannot pass the HalResources themselves as angular will copy them on every digest due to trackBy\n   * @returns {any}\n   */\n  public buildSelectedOption() {\n    const value:HalResource[] = this.resource[this.name];\n    return value ? value.map(val => this.findValueOption(val)) : [];\n  }\n\n  public get selectedOption() {\n    return this._selectedOption;\n  }\n\n  /**\n   * Map the ValueOption to the actual HalResource option\n   * @param val\n   */\n  public set selectedOption(val:ValueOption[]) {\n    this._selectedOption = val;\n    let mapper = (val:ValueOption) => {\n      let option = _.find(this.availableOptions, o => o.$href === val.$href) || this.nullOption;\n\n      // Special case 'null' value, which angular\n      // only understands in ng-options as an empty string.\n      if (option && option.$href === '') {\n        option.$href = null;\n      }\n\n      return option;\n    };\n\n    this.resource[this.name] = _.castArray(val).map(el => mapper(el));\n  }\n\n  public onOpen() {\n    jQuery(this.hiddenOverflowContainer).one('scroll', () => {\n      this.ngSelectComponent.close();\n    });\n  }\n\n  public onClose() {\n    // Nothing to do\n  }\n\n  public repositionDropdown() {\n    if (this.ngSelectComponent && this.ngSelectComponent.dropdownPanel) {\n      setTimeout(() => this.ngSelectComponent.dropdownPanel.adjustPosition(), 0);\n    }\n  }\n\n  private openAutocompleteSelectField() {\n    // The timeout takes care that the opening is added to the end of the current call stack.\n    // Thus we can be sure that the autocompleter is rendered and ready to be opened.\n    let that = this;\n    window.setTimeout(function () {\n      that.ngSelectComponent.open();\n    }, 0);\n  }\n\n  private findValueOption(option?:HalResource):ValueOption {\n    let result;\n\n    if (option) {\n      result = _.find(this.valueOptions, (valueOption) => valueOption.$href === option.$href)!;\n    }\n\n    return result || this.nullOption;\n  }\n\n  private setValues(availableValues:any[], sortValuesByName:boolean = false) {\n    if (sortValuesByName) {\n      availableValues.sort(function (a:any, b:any) {\n        let nameA = a.name.toLowerCase();\n        let nameB = b.name.toLowerCase();\n        return nameA < nameB ? -1 : nameA > nameB ? 1 : 0;\n      });\n    }\n\n    this.availableOptions = availableValues || [];\n    this.valueOptions = this.availableOptions.map(el => {\n      return { name: el.name, $href: el.$href };\n    });\n    this._selectedOption = this.buildSelectedOption();\n    this.checkCurrentValueValidity();\n\n    if (this.availableOptions.length > 0 && this.requestFocus) {\n      this.openAutocompleteSelectField();\n      this.requestFocus = false;\n    }\n  }\n\n  protected initialize() {\n    super.initialize();\n    this.loadValues();\n  }\n\n  private loadValues() {\n    let allowedValues = this.schema.allowedValues;\n    if (Array.isArray(allowedValues)) {\n      this.setValues(allowedValues);\n    } else if (this.schema.allowedValues) {\n      return this.schema.allowedValues.$load().then((values:CollectionResource) => {\n        // The select options of the project shall be sorted\n        if (values.count > 0 && (values.elements[0] as any)._type === 'Project') {\n          this.setValues(values.elements, true);\n        } else {\n          this.setValues(values.elements);\n        }\n      });\n    } else {\n      this.setValues([]);\n    }\n    return Promise.resolve();\n  }\n\n  private checkCurrentValueValidity() {\n    if (this.value) {\n      this.currentValueInvalid = !!(\n        // (If value AND)\n        // MultiSelect AND there is no value which href is not in the options hrefs\n        (!_.some(this.value, (value:HalResource) => {\n          return _.some(this.availableOptions, (option) => (option.$href === value.$href))\n        }))\n      );\n    } else {\n      // If no value but required\n      this.currentValueInvalid = !!this.schema.required;\n    }\n  }\n}\n","// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\n@Component({\n  template: `\n    <input type=\"number\"\n           step=\"any\"\n           class=\"inline-edit--field\"\n           [attr.aria-required]=\"required\"\n           [attr.required]=\"required\"\n           [disabled]=\"inFlight\"\n           [(ngModel)]=\"value\"\n           (keydown)=\"handler.handleUserKeydown($event)\"\n           (focusout)=\"handler.onFocusOut()\"\n           [attr.lang]=\"locale\"\n           [id]=\"handler.htmlId\" />\n  `\n})\nexport class FloatEditFieldComponent extends EditFieldComponent {\n  public locale = I18n.locale;\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\n\n@Component({\n  template: `\n    <input type=\"checkbox\"\n           class=\"inline-edit--field inline-edit--boolean-field\"\n           [attr.aria-required]=\"required\"\n           [checked]=\"value\"\n           (change)=\"updateValue(!value)\"\n           (keydown)=\"handler.handleUserKeydown($event)\"\n           [disabled]=\"inFlight\"\n           [id]=\"handler.htmlId\" />\n  `\n})\nexport class BooleanEditFieldComponent extends EditFieldComponent {\n  public updateValue(newValue:boolean) {\n    this.value = newValue;\n    this.handler.handleUserSubmit();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {SelectEditFieldComponent, ValueOption} from './select-edit-field.component';\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {DebouncedRequestSwitchmap, errorNotificationHandler} from \"core-app/helpers/rxjs/debounced-input-switchmap\";\nimport { take } from 'rxjs/operators';\n\n@Component({\n  templateUrl: './work-package-edit-field.component.html'\n})\nexport class WorkPackageEditFieldComponent extends SelectEditFieldComponent {\n  /** Keep a switchmap for search term and loading state */\n  public requests = new DebouncedRequestSwitchmap<string, ValueOption>(\n    (searchTerm:string) => this.loadValues(searchTerm),\n    errorNotificationHandler(this.halNotification)\n  );\n\n  protected initialValueLoading() {\n    this.valuesLoaded = false;\n\n    // Using this hack with the empty value to have the values loaded initially\n    // while avoiding loading it multiple times.\n    return new Promise<ValueOption[]>((resolve) => {\n      this.requests.output$.pipe(take(1)).subscribe(options => {\n        resolve(options);\n      });\n\n      this.requests.input$.next('');\n    });\n  }\n\n  public get typeahead() {\n    if (this.valuesLoaded) {\n      return false;\n    } else {\n      return this.requests.input$;\n    }\n  }\n\n  protected allowedValuesFilter(query?:string):{} {\n    let filterParams = super.allowedValuesFilter(query);\n\n    if (query) {\n      let filters:ApiV3FilterBuilder = new ApiV3FilterBuilder();\n\n      filters.add('subjectOrId', '**', [query]);\n\n      filterParams = { filters: filters.toJson() };\n    }\n\n    return filterParams;\n  }\n\n  protected mapAllowedValue(value:WorkPackageResource|ValueOption):ValueOption {\n    if ((value as WorkPackageResource).id) {\n\n      let prefix = (value as WorkPackageResource).type ? `${(value as WorkPackageResource).type.name} ` : '';\n      let suffix = (value as WorkPackageResource).subject || value.name;\n\n      return {\n        name: `${prefix}#${ (value as WorkPackageResource).id } ${suffix}`,\n        $href: value.$href\n      };\n    } else {\n      return value;\n    }\n  }\n}\n","<ndc-dynamic [ndcDynamicComponent]=\"autocompleterComponent()\"\n             [ndcDynamicInputs]=\"{ availableValues: requests.output$ | async,\n                                   appendTo: appendTo,\n                                   model: selectedOption ? selectedOption : '',\n                                   required: required,\n                                   disabled: inFlight,\n                                   typeahead: typeahead,\n                                   id: handler.htmlId,\n                                   finishedLoading: requests.loading$,\n                                   hideSelected: true,\n                                   classes: 'inline-edit--field ' + handler.fieldName }\"\n             [ndcDynamicOutputs]=\"referenceOutputs\">\n</ndc-dynamic>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnInit} from \"@angular/core\";\nimport * as moment from \"moment\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\n\n@Component({\n  template: `\n    <op-date-picker\n        tabindex=\"-1\"\n        (onChange)=\"onValueSelected($event)\"\n        (onCancel)=\"onCancel()\"\n        [initialDate]=\"formatter(value)\"\n        [required]=\"required\"\n        [disabled]=\"inFlight\"\n        [id]=\"handler.htmlId\"\n        classes=\"inline-edit--field\">\n    </op-date-picker>\n  `\n})\nexport class DateEditFieldComponent extends EditFieldComponent implements OnInit {\n  @InjectField() readonly timezoneService:TimezoneService;\n  @InjectField() opModalService:OpModalService;\n\n  ngOnInit() {\n    super.ngOnInit();\n  }\n\n  public onValueSelected(data:string) {\n    this.value = this.parser(data);\n    this.handler.handleUserSubmit();\n  }\n\n  public onCancel() {\n    this.handler.handleUserCancel();\n  }\n\n  public parser(data:any) {\n    if (moment(data, 'YYYY-MM-DD', true).isValid()) {\n      return data;\n    } else {\n      return null;\n    }\n  }\n\n  public formatter(data:any) {\n    if (moment(data, 'YYYY-MM-DD', true).isValid()) {\n      var d = this.timezoneService.parseDate(data);\n      return this.timezoneService.formattedISODate(d);\n    } else {\n      return null;\n    }\n  }\n}\n","import {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport function projectStatusCodeCssClass(code:string|null|undefined):string {\n  code = ensureDefaultCode(code);\n\n  return '-' + code.replace(' ', '-');\n}\n\nexport function projectStatusI18n(code:string|null|undefined, I18n:I18nService):string {\n  code = ensureDefaultCode(code);\n\n  return I18n.t('js.grid.widgets.project_status.' + code.replace(' ', '_'));\n}\n\nfunction ensureDefaultCode(code:string|null|undefined):string {\n  return code ? code : 'not set';\n}","<ng-select [items]=\"availableStatuses\"\n           [(ngModel)]=\"currentStatusCode\"\n           bindLabel=\"name\"\n           bindValue=\"code\"\n           class=\"project-status\"\n           (open)=\"onOpen()\"\n           (close)=\"onClose()\"\n           (change)=\"onChange()\"\n           [appendTo]=\"appendToContainer\"\n           [hideSelected]=\"true\"\n           [disabled]=\"inFlight\">\n  <ng-template ng-label-tmp let-item=\"item\">\n    <span class=\"project-status--bulb\" [ngClass]=\"item.colorClass\"></span>\n    <span class=\"project-status--name\" [ngClass]=\"item.colorClass\">{{item.name}}</span>\n  </ng-template>\n  <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\" let-search=\"searchTerm\">\n    <span class=\"project-status--bulb\" [ngClass]=\"item.colorClass\"></span>\n    <span class=\"project-status--name\" [ngClass]=\"item.colorClass\">{{item.name}}</span>\n  </ng-template>\n</ng-select>","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {Component, OnInit, ViewChild} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {projectStatusCodeCssClass, projectStatusI18n} from \"core-app/modules/fields/helpers/project-status-helper\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n@Component({\n  templateUrl: './project-status-edit-field.component.html',\n  styleUrls: ['./project-status-edit-field.component.sass']\n})\nexport class ProjectStatusEditFieldComponent extends EditFieldComponent implements OnInit {\n  @ViewChild(NgSelectComponent, {static: true}) public ngSelectComponent:NgSelectComponent;\n  @InjectField() I18n:I18nService;\n\n  private _availableStatusCodes:string[] = ['not set', 'off track', 'at risk', 'on track'];\n  public currentStatusCode:string = 'not set';\n\n  public availableStatuses:any[] = this._availableStatusCodes.map((code:string):any => {\n    return {\n      code: code,\n      name: projectStatusI18n(code, this.I18n),\n      colorClass: projectStatusCodeCssClass(code)\n    };\n  });\n\n  public hiddenOverflowContainer = '#content-wrapper';\n  public appendToContainer = 'body';\n\n  ngOnInit() {\n    this.currentStatusCode = this.resource['status'] === null ? 'not set' : this.resource['status'];\n\n    // The timeout takes care that the opening is added to the end of the current call stack.\n    // Thus we can be sure that the select box is rendered and ready to be opened.\n    let that = this;\n    window.setTimeout(function () {\n      that.ngSelectComponent.open();\n    }, 0);\n  }\n\n  public onChange() {\n    this.resource['status'] = this.currentStatusCode === 'not set' ? null : this.currentStatusCode;\n    this.handler.handleUserSubmit();\n  }\n\n  public onOpen() {\n    // Force reposition as a workaround for BUG\n    // https://github.com/ng-select/ng-select/issues/1259\n    setTimeout(() => {\n      const component = (this.ngSelectComponent) as any;\n      if (component && component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n\n      jQuery(this.hiddenOverflowContainer).one('scroll.autocompleteContainer', () => {\n        this.ngSelectComponent.close();\n      });\n    }, 25);\n  }\n\n  public onClose() {\n    jQuery(this.hiddenOverflowContainer).off('scroll.autocompleteContainer');\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {EditFieldComponent} from \"core-app/modules/fields/edit/edit-field.component\";\n\n@Component({\n  templateUrl: './text-edit-field.component.html'\n})\nexport class PlainFormattableEditFieldComponent extends EditFieldComponent {\n  // only exists because the template is reused and the property is required there.\n  public shouldFocus = false;\n\n  public get value() {\n    if (!this.schema) {\n      return '';\n    }\n    const element = this.resource[this.name];\n\n    return element && element.raw || '';\n  }\n\n  public set value(newValue:string) {\n    this.resource[this.name] = { raw: newValue };\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\nimport {WorkPackageEditFieldComponent} from \"core-app/modules/fields/edit/field-types/work-package-edit-field.component\";\nimport {TimeEntryDmService} from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {\n  TimeEntryWorkPackageAutocompleterComponent,\n  TimeEntryWorkPackageAutocompleterMode\n} from \"core-app/modules/common/autocomplete/te-work-package-autocompleter.component\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nconst RECENT_TIME_ENTRIES_MAGIC_NUMBER = 30;\n\n@Component({\n  templateUrl: './work-package-edit-field.component.html'\n})\nexport class TimeEntryWorkPackageEditFieldComponent extends WorkPackageEditFieldComponent {\n  @InjectField() public timeEntryDm:TimeEntryDmService;\n\n  private recentWorkPackageIds:string[];\n\n  protected initialize() {\n    super.initialize();\n\n    // For reasons beyond me, the referenceOutputs variable is not defined at first when editing\n    // existing values.\n    if (this.referenceOutputs) {\n      this.referenceOutputs['modeSwitch'] = (mode:TimeEntryWorkPackageAutocompleterMode) => {\n        this.valuesLoaded = false;\n        let lastValue = this.requests.lastRequestedValue!;\n\n        // Hack to provide a new value to \"reset\" the input.\n        // Only the second input is actually processed as the input is debounced.\n        this.requests.input$.next('_/&\"()____');\n        this.requests.input$.next(lastValue);\n      };\n    }\n  }\n\n  public autocompleterComponent() {\n    return TimeEntryWorkPackageAutocompleterComponent;\n  }\n\n  // Although the schema states the work packages to not be required,\n  // as time entries can also be assigned to a project, we want to only assign\n  // time entries to work packages and thus require a value.\n  // The back end will have to be changed in due time but not as long as there is still a rails based\n  // time entry view in the application.\n  protected isRequired() {\n    return true;\n  }\n\n  // We fetch the last RECENT_TIME_ENTRIES_MAGIC_NUMBER time entries by that user. We then use it to fetch the work packages\n  // associated with the time entries so that we have the most recent work packages the user logged time on.\n  // As a worst case, the user logged RECENT_TIME_ENTRIES_MAGIC_NUMBER times on one work package so we can not guarantee to actually have\n  // a fixed number returned.\n  protected loadAllowedValues(query?:string) {\n    if (!this.recentWorkPackageIds) {\n      return this\n        .timeEntryDm\n        .list({ filters: [['user_id', '=', ['me']]], sortBy: [[\"updated_on\", \"desc\"]], pageSize: RECENT_TIME_ENTRIES_MAGIC_NUMBER })\n        .then(collection => {\n          this.recentWorkPackageIds = collection\n            .elements\n            .map((timeEntry) => timeEntry.workPackage.idFromLink)\n            .filter((v, i, a) => a.indexOf(v) === i);\n\n          return this.fetchAllowedValueQuery(query);\n        });\n    } else {\n      return this.fetchAllowedValueQuery(query);\n    }\n  }\n\n  protected allowedValuesFilter(query?:string):{} {\n    let filters:ApiV3FilterBuilder = new ApiV3FilterBuilder();\n\n    if ((this._autocompleterComponent as TimeEntryWorkPackageAutocompleterComponent).mode === 'recent') {\n      filters.add('id', '=', this.recentWorkPackageIds);\n    }\n\n    if (query) {\n      filters.add('subjectOrId', '**', [query]);\n    }\n\n    return { filters: filters.toJson() };\n  }\n\n  protected sortValues(availableValues:HalResource[]) {\n    if ((this._autocompleterComponent as TimeEntryWorkPackageAutocompleterComponent).mode === 'recent') {\n      return this.sortValuesByRecentIds(availableValues);\n    } else {\n      return super.sortValues(availableValues);\n    }\n  }\n\n  protected sortValuesByRecentIds(availableValues:HalResource[]) {\n    return availableValues\n      .sort((a, b) => {\n        return this.recentWorkPackageIds.indexOf(a.id!) - this.recentWorkPackageIds.indexOf(b.id!);\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnDestroy, OnInit} from \"@angular/core\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {DatePickerModal} from \"core-components/datepicker/datepicker.modal\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {take} from \"rxjs/operators\";\nimport {DateEditFieldComponent} from \"core-app/modules/fields/edit/field-types/date-edit-field.component\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\n\n@Component({\n  template: `\n    <input [value]=\"dates\"\n           (click)=\"handleClick()\"\n           type=\"text\" />\n  `\n})\nexport class CombinedDateEditFieldComponent extends DateEditFieldComponent implements OnInit, OnDestroy {\n  @InjectField() readonly timezoneService:TimezoneService;\n  @InjectField() opModalService:OpModalService;\n\n  dates:string = '';\n\n  private modal:OpModalComponent;\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.handler\n      .$onUserActivate\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.showDatePickerModal();\n      });\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n    this.modal?.closeMe();\n  }\n\n  public handleClick() {\n    this.showDatePickerModal();\n  }\n\n  private showDatePickerModal():void {\n    const modal = this.modal = this\n      .opModalService\n      .show(DatePickerModal, this.injector, { changeset: this.change, fieldName: this.name });\n\n    setTimeout(() => {\n      const modalElement = jQuery(modal.elementRef.nativeElement).find('.datepicker-modal');\n      const field = jQuery(this.elementRef.nativeElement);\n      modal.reposition(modalElement, field);\n    });\n\n    modal\n      .onDataUpdated\n      .subscribe((dates:string) => {\n        this.dates = dates;\n        this.cdRef.detectChanges();\n      });\n\n    modal\n      .closingEvent\n      .pipe(take(1))\n      .subscribe(() => {\n        this.handler.handleUserSubmit();\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class TextDisplayField extends DisplayField {\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class FloatDisplayField extends DisplayField {\n\n  public get valueString():string {\n    if (this.value == null) {\n      return '';\n    }\n\n    return this.value.toLocaleString(\n      this.I18n.locale,\n      { useGrouping: true, maximumFractionDigits: 20 }\n    );\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class IntegerDisplayField extends DisplayField {\n  public get value() {\n    return parseInt(this.resource[this.name]);\n  }\n\n  public isEmpty():boolean {\n    return isNaN(this.value);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class ResourceDisplayField extends DisplayField {\n  public get value() {\n    if (this.schema) {\n      return this.attribute && this.attribute.name;\n    }\n    else {\n      return null;\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {ExpressionService} from \"../../../../../../common/expression.service\";\nimport {ApplicationRef} from \"@angular/core\";\nimport {DynamicBootstrapper} from \"core-app/globals/dynamic-bootstrapper\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class FormattableDisplayField extends DisplayField {\n\n  @InjectField() readonly appRef:ApplicationRef;\n\n  public render(element:HTMLElement, displayText:string, options:any = {}):void {\n    let div = document.createElement('div');\n\n    div.classList.add('read-value--html', 'wiki', 'highlight', '-multiline');\n    if (options.rtl) {\n      div.classList.add('-rtl');\n    }\n\n    div.innerHTML = displayText;\n\n    element.innerHTML = '';\n    element.appendChild(div);\n\n    // Allow embeddable rendered content\n    DynamicBootstrapper.bootstrapOptionalEmbeddable(this.appRef, div);\n  }\n\n  public get isFormattable():boolean {\n    return true;\n  }\n\n  public get value() {\n    if (!this.schema) {\n      return null;\n    }\n    const element = this.resource[this.name];\n    if (!(element && element.html)) {\n      return '';\n    }\n\n    return this.unescape(element.html);\n  }\n\n  // Escape the given HTML string from the backend, which contains escaped Angular expressions.\n  // Since formattable fields are only binded to but never evaluated, we can safely remove these expressions.\n  protected unescape(html:string) {\n    if (html) {\n      return ExpressionService.unescape(html);\n    } else {\n      return '';\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nexport class ExpressionService {\n\n  // This is what returned by rails-angular-xss when it discovers double open curly braces\n  // See https://github.com/opf/rails-angular-xss for more information.\n  public static get UNESCAPED_EXPRESSION() {\n    return '{{';\n  }\n\n  public static get ESCAPED_EXPRESSION() {\n    return '{{ \\\\$root\\\\.DOUBLE_LEFT_CURLY_BRACE }}';\n  }\n\n  public static escape(input:string) {\n    return input.replace(new RegExp(this.UNESCAPED_EXPRESSION, 'g'), this.ESCAPED_EXPRESSION);\n  }\n\n  public static unescape(input:string) {\n    return input.replace(new RegExp(this.ESCAPED_EXPRESSION, 'g'), this.UNESCAPED_EXPRESSION);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class DurationDisplayField extends DisplayField {\n  @InjectField() timezoneService:TimezoneService;\n\n  private derivedText = this.I18n.t('js.label_value_derived_from_children');\n\n  public get valueString() {\n    return this.timezoneService.formattedDuration(this.value);\n  }\n\n  /**\n   * Duration fields may have an additional derived value\n   */\n  public get derivedPropertyName() {\n    return \"derived\" + this.name.charAt(0).toUpperCase() + this.name.slice(1);\n  }\n\n  public get derivedValue():string|null {\n    return this.resource[this.derivedPropertyName];\n  }\n\n  public get derivedValueString():string {\n    const value = this.derivedValue;\n\n    if (value) {\n      return this.timezoneService.formattedDuration(value);\n    } else {\n      return this.placeholder;\n    }\n  }\n\n  public render(element:HTMLElement, displayText:string):void {\n    if (this.isEmpty()) {\n      element.textContent = this.placeholder;\n      return;\n    }\n\n    element.classList.add('split-time-field');\n    let value = this.value;\n    let actual:number = (value && this.timezoneService.toHours(value)) || 0;\n\n    if (actual !== 0) {\n      this.renderActual(element, displayText);\n    }\n\n    let derived = this.derivedValue;\n    if (derived && this.timezoneService.toHours(derived) !== 0) {\n      this.renderDerived(element, this.derivedValueString, actual !== 0);\n    }\n  }\n\n  public renderActual(element:HTMLElement, displayText:string):void {\n    const span = document.createElement('span');\n\n    span.textContent = displayText;\n    span.title = this.valueString;\n    span.classList.add('-actual-value');\n\n    element.appendChild(span);\n  }\n\n  public renderDerived(element:HTMLElement, displayText:string, actualPresent:boolean):void {\n    const span = document.createElement('span');\n\n    span.setAttribute('title', this.texts.empty);\n    span.textContent = '(' + (actualPresent ? '+' : '') + displayText + ')';\n    span.title = `${this.derivedValueString} ${this.derivedText}`;\n    span.classList.add('-derived-value');\n\n    if (actualPresent) {\n      span.classList.add('-with-actual-value');\n    }\n\n    element.appendChild(span);\n  }\n\n  public get title():string|null {\n    return null; // we want to render separate titles ourselves\n  }\n\n  public isEmpty():boolean {\n    const value = this.value;\n    const derived = this.derivedValue;\n\n    const valueEmpty = !value || this.timezoneService.toHours(value) === 0;\n    const derivedEmpty = !derived || this.timezoneService.toHours(derived) === 0;\n\n\n    return valueEmpty && derivedEmpty;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {TimezoneService} from 'core-components/datetime/timezone.service';\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class DateTimeDisplayField extends DisplayField {\n  @InjectField() timezoneService:TimezoneService;\n\n  public get valueString() {\n    if (this.value) {\n      return this.timezoneService.formattedDatetime(this.value);\n    }\n\n    return '';\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class BooleanDisplayField extends DisplayField {\n\n  public get valueString() {\n    return this.translatedValue();\n  }\n\n  public get placeholder() {\n    return this.translatedValue();\n  }\n\n  public translatedValue() {\n    if (this.value) {\n      return this.I18n.t('js.general_text_yes');\n    } else {\n      return this.I18n.t('js.general_text_no');\n    }\n  }\n\n  public isEmpty():boolean {\n    // We treat an empty value the same as if the user had set\n    // the value to false;\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class WorkPackageDisplayField extends DisplayField {\n\n  public text = {\n    none: this.I18n.t('js.filter.noneElement')\n  };\n\n  public get value() {\n    return this.resource[this.name];\n  }\n\n  public get title() {\n    if (this.isEmpty()) {\n      return this.text.none;\n    } else {\n      return this.value.name;\n    }\n  }\n\n  public get wpId() {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.value.$loaded) {\n      return this.value.id;\n    }\n\n    // Read WP ID from href\n    return this.value.href.match(/(\\d+)$/)[0];\n  }\n\n  public get valueString() {\n    // cannot display the type name easily here as it may not be loaded\n    return `#${ this.wpId } ${ this.title }`;\n  }\n\n  public isEmpty():boolean {\n    return !this.value;\n  }\n\n  public get unknownAttribute():boolean {\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport { DurationDisplayField } from './duration-display-field.module';\nimport { PathHelperService } from 'core-app/modules/common/path-helper/path-helper.service';\nimport { ProjectCacheService } from \"core-components/projects/project-cache.service\";\nimport { ProjectResource } from \"core-app/modules/hal/resources/project-resource\";\nimport { InjectField } from \"core-app/helpers/angular/inject-field.decorator\";\nimport * as URI from 'urijs';\nimport { TimeEntryCreateService } from 'core-app/modules/time_entries/create/create.service';\nimport { WorkPackageResource } from \"core-app/modules/hal/resources/work-package-resource\";\n\nexport class WorkPackageSpentTimeDisplayField extends DurationDisplayField {\n  public text = {\n    linkTitle: this.I18n.t('js.work_packages.message_view_spent_time'),\n    logTime: this.I18n.t('js.button_log_time')\n  };\n\n  @InjectField() PathHelper:PathHelperService;\n  @InjectField() projectCacheService:ProjectCacheService;\n  @InjectField() timeEntryCreateService:TimeEntryCreateService;\n\n  public render(element:HTMLElement, displayText:string):void {\n    if (!this.value) {\n      return;\n    }\n\n    const link = document.createElement('a');\n    link.textContent = displayText;\n    link.setAttribute('title', this.text.linkTitle);\n    link.setAttribute('class', 'time-logging--value');\n\n    if (this.resource.project) {\n      const wpID = this.resource.id.toString();\n      this.projectCacheService\n        .require(this.resource.project.idFromLink)\n        .then((project:ProjectResource) => {\n          const href = URI(this.PathHelper.projectTimeEntriesPath(project.identifier))\n            .search({ work_package_id: wpID })\n            .toString();\n\n          link.href = href;\n        });\n    }\n\n    element.innerHTML = '';\n    element.appendChild(link);\n\n    this.appendTimelogLink(element);\n  }\n\n  private appendTimelogLink(element:HTMLElement) {\n    if (this.resource.logTime) {\n      const timelogElement = document.createElement('a');\n      timelogElement.setAttribute('class', 'icon icon-time');\n      timelogElement.setAttribute('href', '');\n      timelogElement.setAttribute('title', this.text.logTime);\n\n      element.appendChild(timelogElement);\n\n      timelogElement.addEventListener('click', this.showTimelogWidget.bind(this, this.resource));\n    }\n  }\n\n  private showTimelogWidget(wp:WorkPackageResource) {\n    this.timeEntryCreateService\n      .create(moment(new Date()), wp, false)\n      .catch(() => {\n        // do nothing, the user closed without changes\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class IdDisplayField extends DisplayField {\n  public text = {\n    linkTitle: this.I18n.t('js.work_packages.message_successful_show_in_fullscreen')\n  };\n\n  public get value() {\n    if (this.resource.isNew) {\n      return null;\n    }\n    else {\n      return this.resource[this.name];\n    }\n  }\n\n  public render(element:HTMLElement, displayText:string):void {\n    if (!this.value) {\n      return;\n    }\n    element.textContent = displayText;\n  }\n\n  public isEmpty():boolean {\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {HighlightableDisplayField} from \"core-app/modules/fields/display/field-types/highlightable-display-field.module\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\n\nexport class HighlightedResourceDisplayField extends HighlightableDisplayField {\n\n  public render(element:HTMLElement, displayText:string):void {\n    super.render(element, displayText);\n\n    if (this.shouldHighlight) {\n      this.addHighlight(element);\n    }\n  }\n\n  public get value() {\n    if (this.schema) {\n      return this.attribute && this.attribute.name;\n    }\n    else {\n      return null;\n    }\n  }\n\n  private addHighlight(element:HTMLElement):void {\n    if (this.attribute instanceof HalResource) {\n      const hlClass = Highlighting.inlineClass(this.name, this.attribute.id!);\n      element.classList.add(hlClass);\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {HighlightedResourceDisplayField} from \"core-app/modules/fields/display/field-types/highlighted-resource-display-field.module\";\n\nexport class TypeDisplayField extends HighlightedResourceDisplayField {\n  // Type will always be highlighted\n  public get shouldHighlight() {\n    return true;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UserAvatarRendererService} from \"core-components/user/user-avatar/user-avatar-renderer.service\";\n\nexport class UserDisplayField extends DisplayField {\n  @InjectField() avatarRenderer:UserAvatarRendererService;\n\n  public get value() {\n    if (this.schema) {\n      return this.attribute && this.attribute.name;\n    } else {\n      return null;\n    }\n  }\n\n  public render(element:HTMLElement, displayText:string):void {\n    if (this.placeholder === displayText) {\n      this.renderEmpty(element);\n    } else {\n      this.avatarRenderer.render(\n        element,\n        this.attribute,\n      );\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ResourcesDisplayField} from \"./resources-display-field.module\";\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UserAvatarRendererService} from \"core-components/user/user-avatar/user-avatar-renderer.service\";\n\nexport class MultipleUserFieldModule extends ResourcesDisplayField {\n  @InjectField() avatarRenderer:UserAvatarRendererService;\n\n  public render(element:HTMLElement, displayText:string):void {\n    const names = this.value;\n    element.innerHTML = '';\n    element.setAttribute('title', names.join(', '));\n\n    if (names.length === 0) {\n      this.renderEmpty(element);\n    } else {\n      this.renderValues(this.attribute, element);\n    }\n  }\n\n  /**\n   * Renders at most the first two values, followed by a badge indicating\n   * the total count.\n   */\n  protected renderValues(values:UserResource[], element:HTMLElement) {\n    const content = document.createDocumentFragment();\n\n    this.renderAbridgedValues(element, values);\n\n    if (values.length > 2) {\n      const dots = document.createElement('span');\n      dots.innerHTML = '... ';\n      content.appendChild(dots);\n\n      const badge = this.optionDiv(values.length.toString(), 'badge', '-secondary');\n      content.appendChild(badge);\n    }\n\n    element.appendChild(content);\n\n  }\n\n  public renderAbridgedValues(element:HTMLElement, values:UserResource[]) {\n    const valueForDisplay = _.take(values, 2);\n    this.avatarRenderer.renderMultiple(element, valueForDisplay);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {KeepTabService} from 'core-components/wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {StateService} from '@uirouter/core';\nimport {UiStateLinkBuilder} from \"core-components/wp-fast-table/builders/ui-state-link-builder\";\nimport {IdDisplayField} from \"core-app/modules/fields/display/field-types/id-display-field.module\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class WorkPackageIdDisplayField extends IdDisplayField {\n  @InjectField() $state:StateService;\n  @InjectField() keepTab:KeepTabService;\n  \n  private uiStateBuilder:UiStateLinkBuilder = new UiStateLinkBuilder(this.$state, this.keepTab);\n\n  public render(element:HTMLElement, displayText:string):void {\n    if (!this.value) {\n      return;\n    }\n    let link = this.uiStateBuilder.linkToShow(\n      this.value,\n      displayText,\n      this.value\n    );\n\n    element.appendChild(link);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {projectStatusCodeCssClass, projectStatusI18n} from \"core-app/modules/fields/helpers/project-status-helper\";\n\n\nexport class ProjectStatusDisplayField extends DisplayField {\n  public render(element:HTMLElement, displayText:string):void {\n    const code = this.value;\n\n    element.innerHTML = `\n      <span class=\"project-status--bulb ${projectStatusCodeCssClass(code)}\"></span>\n      <span class=\"project-status--name ${projectStatusCodeCssClass(code)}\">${projectStatusI18n(code, this.I18n)}</span>\n      <span class=\"project-status--pulldown-icon icon icon-pulldown\"></span>\n    `;\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class PlainFormattableDisplayField extends DisplayField {\n  public get value() {\n    if (!this.schema) {\n      return null;\n    }\n    const element = this.resource[this.name];\n\n    return element && element.raw || '';\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {StateService} from '@uirouter/core';\nimport {KeepTabService} from 'core-components/wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {UiStateLinkBuilder} from \"core-components/wp-fast-table/builders/ui-state-link-builder\";\nimport {WorkPackageDisplayField} from \"core-app/modules/fields/display/field-types/work-package-display-field.module\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class LinkedWorkPackageDisplayField extends WorkPackageDisplayField {\n\n  public text = {\n    linkTitle: this.I18n.t('js.work_packages.message_successful_show_in_fullscreen'),\n    none: this.I18n.t('js.filter.noneElement')\n  };\n\n  @InjectField() $state:StateService;\n  @InjectField() keepTab:KeepTabService;\n\n  private uiStateBuilder:UiStateLinkBuilder = new UiStateLinkBuilder(this.$state, this.keepTab);\n\n  public render(element:HTMLElement, displayText:string):void {\n    if (this.isEmpty()) {\n      element.innerText = this.placeholder;\n      return;\n    }\n\n    let link = this.uiStateBuilder.linkToShow(\n      this.wpId,\n      this.text.linkTitle,\n      this.valueString\n    );\n\n    element.innerHTML = '';\n    element.appendChild(link);\n  }\n\n  public get writable():boolean {\n    return false;\n  }\n\n  public get valueString() {\n    return '#' + this.wpId;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {APP_INITIALIZER, NgModule} from '@angular/core';\nimport {EditFieldService} from \"core-app/modules/fields/edit/edit-field.service\";\nimport {DisplayFieldService} from \"core-app/modules/fields/display/display-field.service\";\nimport {initializeCoreEditFields} from \"core-app/modules/fields/edit/edit-field.initializer\";\nimport {initializeCoreDisplayFields} from \"core-app/modules/fields/display/display-field.initializer\";\nimport {BooleanEditFieldComponent} from \"core-app/modules/fields/edit/field-types/boolean-edit-field.component\";\nimport {DateEditFieldComponent} from \"core-app/modules/fields/edit/field-types/date-edit-field.component\";\nimport {DurationEditFieldComponent} from \"core-app/modules/fields/edit/field-types/duration-edit-field.component\";\nimport {FloatEditFieldComponent} from \"core-app/modules/fields/edit/field-types/float-edit-field.component\";\nimport {IntegerEditFieldComponent} from \"core-app/modules/fields/edit/field-types/integer-edit-field.component\";\nimport {MultiSelectEditFieldComponent} from \"core-app/modules/fields/edit/field-types/multi-select-edit-field.component\";\nimport {SelectEditFieldComponent} from \"core-app/modules/fields/edit/field-types/select-edit-field.component\";\nimport {FormattableEditFieldComponent} from \"core-app/modules/fields/edit/field-types/formattable-edit-field.component\";\nimport {TextEditFieldComponent} from \"core-app/modules/fields/edit/field-types/text-edit-field.component\";\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {EditFormPortalComponent} from \"core-app/modules/fields/edit/editing-portal/edit-form-portal.component\";\nimport {EditFieldControlsComponent,} from \"core-app/modules/fields/edit/field-controls/edit-field-controls.component\";\nimport {OpenprojectAccessibilityModule} from \"core-app/modules/a11y/openproject-a11y.module\";\nimport {OpenprojectEditorModule} from 'core-app/modules/editor/openproject-editor.module';\nimport {SelectAutocompleterRegisterService} from \"core-app/modules/fields/edit/field-types/select-autocompleter-register.service\";\nimport {EditFormComponent} from \"core-app/modules/fields/edit/edit-form/edit-form.component\";\nimport {WorkPackageEditFieldComponent} from \"core-app/modules/fields/edit/field-types/work-package-edit-field.component\";\nimport {EditableAttributeFieldComponent} from \"core-app/modules/fields/edit/field/editable-attribute-field.component\";\nimport {ProjectStatusEditFieldComponent} from \"core-app/modules/fields/edit/field-types/project-status-edit-field.component\";\nimport {PlainFormattableEditFieldComponent} from \"core-app/modules/fields/edit/field-types/plain-formattable-edit-field.component\";\nimport {TimeEntryWorkPackageEditFieldComponent} from \"core-app/modules/fields/edit/field-types/te-work-package-edit-field.component\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    OpenprojectAccessibilityModule,\n    OpenprojectEditorModule,\n  ],\n  exports: [\n    EditFieldControlsComponent,\n    EditFormPortalComponent,\n    EditFormComponent,\n    EditableAttributeFieldComponent,\n  ],\n  providers: [\n    {\n      provide: APP_INITIALIZER,\n      useFactory: initializeCoreEditFields,\n      deps: [EditFieldService, SelectAutocompleterRegisterService],\n      multi: true\n    },\n    {\n      provide: APP_INITIALIZER,\n      useFactory: initializeCoreDisplayFields,\n      deps: [DisplayFieldService],\n      multi: true\n    },\n  ],\n  declarations: [\n    EditFormPortalComponent,\n    BooleanEditFieldComponent,\n    DateEditFieldComponent,\n    DurationEditFieldComponent,\n    FloatEditFieldComponent,\n    IntegerEditFieldComponent,\n    FormattableEditFieldComponent,\n    PlainFormattableEditFieldComponent,\n    MultiSelectEditFieldComponent,\n    SelectEditFieldComponent,\n    TextEditFieldComponent,\n    EditFieldControlsComponent,\n    WorkPackageEditFieldComponent,\n    TimeEntryWorkPackageEditFieldComponent,\n    EditFormComponent,\n    EditableAttributeFieldComponent,\n    ProjectStatusEditFieldComponent,\n  ]\n})\nexport class OpenprojectFieldsModule {\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {EditFieldService} from \"core-app/modules/fields/edit/edit-field.service\";\nimport {TextEditFieldComponent} from \"core-app/modules/fields/edit/field-types/text-edit-field.component\";\nimport {IntegerEditFieldComponent} from \"core-app/modules/fields/edit/field-types/integer-edit-field.component\";\nimport {DurationEditFieldComponent} from \"core-app/modules/fields/edit/field-types/duration-edit-field.component\";\nimport {SelectEditFieldComponent} from \"core-app/modules/fields/edit/field-types/select-edit-field.component\";\nimport {MultiSelectEditFieldComponent} from \"core-app/modules/fields/edit/field-types/multi-select-edit-field.component\";\nimport {FloatEditFieldComponent} from \"core-app/modules/fields/edit/field-types/float-edit-field.component\";\nimport {BooleanEditFieldComponent} from \"core-app/modules/fields/edit/field-types/boolean-edit-field.component\";\nimport {WorkPackageEditFieldComponent} from \"core-app/modules/fields/edit/field-types/work-package-edit-field.component\";\nimport {DateEditFieldComponent} from \"core-app/modules/fields/edit/field-types/date-edit-field.component\";\nimport {FormattableEditFieldComponent} from \"core-app/modules/fields/edit/field-types/formattable-edit-field.component\";\nimport {WorkPackageCommentFieldComponent} from \"core-components/work-packages/work-package-comment/wp-comment-field.component\";\nimport {SelectAutocompleterRegisterService} from \"core-app/modules/fields/edit/field-types/select-autocompleter-register.service\";\nimport {VersionAutocompleterComponent} from \"core-app/modules/common/autocomplete/version-autocompleter.component\";\nimport {ProjectStatusEditFieldComponent} from \"core-app/modules/fields/edit/field-types/project-status-edit-field.component\";\nimport {PlainFormattableEditFieldComponent} from \"core-app/modules/fields/edit/field-types/plain-formattable-edit-field.component\";\nimport {WorkPackageAutocompleterComponent} from \"core-app/modules/common/autocomplete/wp-autocompleter.component\";\nimport {TimeEntryWorkPackageEditFieldComponent} from \"core-app/modules/fields/edit/field-types/te-work-package-edit-field.component\";\nimport {CombinedDateEditFieldComponent} from \"core-app/modules/fields/edit/field-types/combined-date-edit-field.component\";\n\n\nexport function initializeCoreEditFields(editFieldService:EditFieldService, selectAutocompleterRegisterService:SelectAutocompleterRegisterService) {\n  return () => {\n    editFieldService.defaultFieldType = 'text';\n    editFieldService\n      .addFieldType(TextEditFieldComponent, 'text', ['String'])\n      .addFieldType(IntegerEditFieldComponent, 'integer', ['Integer'])\n      .addFieldType(DurationEditFieldComponent, 'duration', ['Duration'])\n      .addFieldType(SelectEditFieldComponent, 'select', ['Priority',\n        'Status',\n        'Type',\n        'User',\n        'Version',\n        'TimeEntriesActivity',\n        'Category',\n        'CustomOption',\n        'Project'])\n      .addFieldType(MultiSelectEditFieldComponent, 'multi-select', [\n        '[]CustomOption',\n        '[]User'\n      ])\n      .addFieldType(FloatEditFieldComponent, 'float', ['Float'])\n      .addFieldType(WorkPackageEditFieldComponent, 'workPackage', ['WorkPackage'])\n      .addFieldType(BooleanEditFieldComponent, 'boolean', ['Boolean'])\n      .addFieldType(DateEditFieldComponent, 'date', ['Date'])\n      .addFieldType(FormattableEditFieldComponent, 'wiki-textarea', ['Formattable'])\n      .addFieldType(ProjectStatusEditFieldComponent, 'project_status', ['ProjectStatus'])\n      .addFieldType(WorkPackageCommentFieldComponent, '_comment', ['comment']);\n\n    editFieldService\n      .addSpecificFieldType('WorkPackage', CombinedDateEditFieldComponent, 'date', ['startDate', 'dueDate', 'date'])\n      .addSpecificFieldType('TimeEntry', PlainFormattableEditFieldComponent, 'comment', ['comment'])\n      .addSpecificFieldType('TimeEntry', TimeEntryWorkPackageEditFieldComponent, 'workPackage', ['WorkPackage']);\n\n    selectAutocompleterRegisterService.register(VersionAutocompleterComponent, 'Version');\n    selectAutocompleterRegisterService.register(WorkPackageAutocompleterComponent, 'WorkPackage');\n  };\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayFieldService} from \"core-app/modules/fields/display/display-field.service\";\nimport {TextDisplayField} from \"core-app/modules/fields/display/field-types/text-display-field.module\";\nimport {FloatDisplayField} from \"core-app/modules/fields/display/field-types/float-display-field.module\";\nimport {IntegerDisplayField} from \"core-app/modules/fields/display/field-types/integer-display-field.module\";\nimport {ResourceDisplayField} from \"core-app/modules/fields/display/field-types/resource-display-field.module\";\nimport {ResourcesDisplayField} from \"core-app/modules/fields/display/field-types/resources-display-field.module\";\nimport {FormattableDisplayField} from \"core-app/modules/fields/display/field-types/formattable-display-field.module\";\nimport {DurationDisplayField} from \"core-app/modules/fields/display/field-types/duration-display-field.module\";\nimport {DateDisplayField} from \"core-app/modules/fields/display/field-types/date-display-field.module\";\nimport {DateTimeDisplayField} from \"core-app/modules/fields/display/field-types/datetime-display-field.module\";\nimport {BooleanDisplayField} from \"core-app/modules/fields/display/field-types/boolean-display-field.module\";\nimport {ProgressDisplayField} from \"core-app/modules/fields/display/field-types/progress-display-field.module\";\nimport {WorkPackageDisplayField} from \"core-app/modules/fields/display/field-types/work-package-display-field.module\";\nimport {WorkPackageSpentTimeDisplayField} from \"core-app/modules/fields/display/field-types/wp-spent-time-display-field.module\";\nimport {IdDisplayField} from \"core-app/modules/fields/display/field-types/id-display-field.module\";\nimport {HighlightedResourceDisplayField} from \"core-app/modules/fields/display/field-types/highlighted-resource-display-field.module\";\nimport {TypeDisplayField} from \"core-app/modules/fields/display/field-types/type-display-field.module\";\nimport {UserDisplayField} from \"core-app/modules/fields/display/field-types/user-display-field.module\";\nimport {MultipleUserFieldModule} from \"core-app/modules/fields/display/field-types/multiple-user-display-field.module\";\nimport {WorkPackageIdDisplayField} from \"core-app/modules/fields/display/field-types/wp-id-display-field.module\";\nimport {ProjectStatusDisplayField} from \"core-app/modules/fields/display/field-types/project-status-display-field.module\";\nimport {PlainFormattableDisplayField} from \"core-app/modules/fields/display/field-types/plain-formattable-display-field.module\";\nimport {LinkedWorkPackageDisplayField} from \"core-app/modules/fields/display/field-types/linked-work-package-display-field.module\";\n\nexport function initializeCoreDisplayFields(displayFieldService:DisplayFieldService) {\n  return () => {\n    displayFieldService.defaultFieldType = 'text';\n    displayFieldService\n      .addFieldType(TextDisplayField, 'text', ['String'])\n      .addFieldType(FloatDisplayField, 'float', ['Float'])\n      .addFieldType(IntegerDisplayField, 'integer', ['Integer'])\n      .addFieldType(HighlightedResourceDisplayField, 'highlight', [\n        'Status',\n        'Priority'\n      ])\n      .addFieldType(TypeDisplayField, 'type', ['Type'])\n      .addFieldType(ResourceDisplayField, 'resource', [\n        'Project',\n        'TimeEntriesActivity',\n        'Version',\n        'Category',\n        'CustomOption'])\n      .addFieldType(ResourcesDisplayField, 'resources', ['[]CustomOption'])\n      .addFieldType(MultipleUserFieldModule, 'users', ['[]User'])\n      .addFieldType(FormattableDisplayField, 'formattable', ['Formattable'])\n      .addFieldType(DurationDisplayField, 'duration', ['Duration'])\n      .addFieldType(DateDisplayField, 'date', ['Date'])\n      .addFieldType(DateTimeDisplayField, 'datetime', ['DateTime'])\n      .addFieldType(BooleanDisplayField, 'boolean', ['Boolean'])\n      .addFieldType(ProgressDisplayField, 'progress', ['percentageDone'])\n      .addFieldType(LinkedWorkPackageDisplayField, 'work_package', ['WorkPackage'])\n      .addFieldType(IdDisplayField, 'id', ['id'])\n      .addFieldType(ProjectStatusDisplayField, 'project_status', ['ProjectStatus'])\n      .addFieldType(UserDisplayField, 'user', ['User']);\n\n    displayFieldService\n        .addSpecificFieldType('WorkPackage', WorkPackageIdDisplayField, 'id', ['id'])\n        .addSpecificFieldType('WorkPackage', WorkPackageSpentTimeDisplayField, 'spentTime', ['spentTime'])\n        .addSpecificFieldType('TimeEntry', PlainFormattableDisplayField, 'comment', ['comment'])\n        .addSpecificFieldType('TimeEntry', WorkPackageDisplayField, 'work_package', ['workPackage']);\n  };\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {AfterViewInit, Directive, ElementRef, Input} from \"@angular/core\";\nimport {FocusHelperService} from \"core-app/modules/common/focus/focus-helper\";\n\n@Directive({\n  selector: '[focus]'\n})\nexport class FocusDirective implements AfterViewInit {\n  @Input('focus') condition:boolean;\n  @Input('focusPriority') priority?:number = 0;\n\n  constructor(readonly FocusHelper:FocusHelperService,\n              readonly elementRef:ElementRef) {\n  }\n\n  ngAfterViewInit() {\n    this.updateFocus();\n  }\n\n  private updateFocus() {\n    if (this.condition) {\n      const element = jQuery(this.elementRef.nativeElement);\n      this.FocusHelper.focusElement(element, this.priority);\n    }\n  }\n}\n","import {contextColumnIcon, OpTableAction} from 'core-components/wp-table/table-actions/table-action';\nimport {opIconElement} from 'core-app/helpers/op-icon-builder';\n\nimport {KeepTabService} from 'core-components/wp-single-view-tabs/keep-tab/keep-tab.service';\nimport {UiStateLinkBuilder} from 'core-components/wp-fast-table/builders/ui-state-link-builder';\nimport {StateService} from \"@uirouter/core\";\n\nexport const detailsLinkClassName = 'wp-table--details-link';\n\nexport class OpDetailsTableAction extends OpTableAction {\n\n  public readonly identifier = 'open-details-action';\n  private uiStatebuilder = new UiStateLinkBuilder(this.injector.get(StateService), this.injector.get(KeepTabService));\n  private text = {\n    button: this.I18n.t('js.button_open_details')\n  }\n\n  public buildElement() {\n    // Append details button\n    let detailsLink = this.uiStatebuilder.linkToDetails(\n      this.workPackage.id!,\n      this.text.button,\n      ''\n    );\n\n    detailsLink.classList.add(detailsLinkClassName, contextColumnIcon, 'hidden-for-mobile');\n    detailsLink.appendChild(opIconElement('icon', 'icon-info2'));\n\n    return detailsLink;\n  }\n}\n","import {\n  contextColumnIcon,\n  contextMenuLinkClassName,\n  OpTableAction\n} from 'core-components/wp-table/table-actions/table-action';\nimport {opIconElement} from 'core-app/helpers/op-icon-builder';\n\nexport class OpContextMenuTableAction extends OpTableAction {\n\n  public readonly identifier = 'open-context-menu-action';\n\n  private text = {\n    linkTitle: this.I18n.t('js.label_open_context_menu')\n  };\n\n  public buildElement() {\n    let contextMenu = document.createElement('a');\n    contextMenu.href = '#';\n    contextMenu.classList.add(contextMenuLinkClassName, contextColumnIcon);\n    contextMenu.title = this.text.linkTitle;\n    contextMenu.appendChild(opIconElement('icon', 'icon-show-more-horizontal'));\n\n    return contextMenu;\n  }\n}\n","import {Injectable, Injector} from '@angular/core';\nimport {\n  OpTableActionFactory,\n} from 'core-components/wp-table/table-actions/table-action';\nimport {OpDetailsTableAction} from 'core-components/wp-table/table-actions/actions/details-table-action';\nimport {OpContextMenuTableAction} from 'core-components/wp-table/table-actions/actions/context-menu-table-action';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\n@Injectable()\nexport class OpTableActionsService {\n\n  constructor(private readonly injector:Injector) {\n  }\n\n  /**\n   * Actions currently registered\n   */\n  private actions:OpTableActionFactory[] = [\n    (injector, workPackage) => new OpDetailsTableAction(injector, workPackage),\n    (injector, workPackage) => new OpContextMenuTableAction(injector, workPackage),\n  ];\n\n  /**\n   * Replace the actions with a different set\n   */\n  public setActions(...actions:OpTableActionFactory[]) {\n    this.actions = actions;\n  }\n\n  /**\n   * Render actions for the given work package.\n   * @param {WorkPackageResource} workPackage\n   */\n  public render(workPackage:WorkPackageResource):HTMLElement[] {\n    let built = this.actions.map((factory) => factory(this.injector, workPackage).buildElement());\n    return _.compact(built);\n  }\n}\n","\n// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\n\n@Injectable()\nexport class FirstRouteService {\n  public name:string;\n  public params:any;\n\n  constructor() {}\n\n  public get isEmpty() {\n    return !this.name;\n  }\n\n  public setIfFirst(stateName:string|undefined, params:any) {\n    if (!this.isEmpty || !stateName) {\n      return;\n    }\n\n    this.name = stateName;\n    this.params = params;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AbstractWorkPackageButtonComponent} from 'core-components/wp-buttons/wp-buttons.module';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit} from '@angular/core';\nimport {WorkPackageFiltersService} from 'core-components/filters/wp-filters/wp-filters.service';\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'wp-filter-button',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './wp-filter-button.html'\n})\nexport class WorkPackageFilterButtonComponent extends AbstractWorkPackageButtonComponent implements OnInit {\n  public count:number;\n  public initialized:boolean = false;\n\n  public buttonId:string = 'work-packages-filter-toggle-button';\n  public iconClass:string = 'icon-filter';\n\n  constructor(readonly I18n:I18nService,\n              protected cdRef:ChangeDetectorRef,\n              protected wpFiltersService:WorkPackageFiltersService,\n              protected wpTableFilters:WorkPackageViewFiltersService) {\n    super(I18n);\n  }\n\n  ngOnInit():void {\n    this.setupObserver();\n  }\n\n  public get labelKey():string {\n    return 'js.button_filter';\n  }\n\n  public get textKey():string {\n    return 'js.toolbar.filter';\n  }\n\n  public get label():string {\n    return this.prefix + this.text.label;\n  }\n\n  public get filterCount():number {\n    return this.count;\n  }\n\n  public performAction(event:Event) {\n    this.toggleVisibility();\n  }\n\n  public toggleVisibility() {\n    this.wpFiltersService.toggleVisibility();\n  }\n\n  private setupObserver() {\n    this.wpTableFilters\n      .live$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.count = this.wpTableFilters.currentlyVisibleFilters.length;\n        this.initialized = true;\n        this.cdRef.detectChanges();\n      });\n\n    this.wpFiltersService\n      .observeUntil(componentDestroyed(this))\n      .subscribe(() => {\n        this.isActive = this.wpFiltersService.visible;\n        this.cdRef.detectChanges();\n      });\n  }\n}\n","<button class=\"button\"\n        [attr.id]=\"buttonId\"\n        [attr.accesskey]=\"accessKey\"\n        [attr.title]=\"label\"\n        [attr.aria-label]=\"label\"\n        [disabled]=\"disabled\"\n        (click)=\"performAction($event)\"\n        [ngClass]=\"{ '-active': isActive }\">\n  <op-icon icon-classes=\"{{ iconClass }} button--icon\"></op-icon>\n  <span class=\"button--text\">\n    {{ buttonText }}\n    <span class=\"badge -secondary\" *ngIf=\"initialized\" [textContent]=\"filterCount\"></span>\n  </span>\n</button>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QuerySortByResource} from 'core-app/modules/hal/resources/query-sort-by-resource';\nimport {HalLink} from 'core-app/modules/hal/hal-link/hal-link';\nimport {Injectable} from '@angular/core';\nimport {PaginationService} from 'core-components/table-pagination/pagination-service';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {ApiV3Filter, FilterOperator} from \"core-components/api/api-v3/api-v3-filter-builder\";\n\n@Injectable({ providedIn: 'root' })\nexport class UrlParamsHelperService {\n\n  public constructor(public paginationService:PaginationService) {\n  }\n\n  // copied more or less from angular buildUrl\n  public buildQueryString(params:any) {\n    if (!params) {\n      return undefined;\n    }\n\n    let parts:string[] = [];\n    _.each(params, (value, key) => {\n      if (!value) return;\n      if (!Array.isArray(value)) value = [value];\n\n      _.each(value, (v) => {\n        if (v !== null && typeof v === 'object') {\n          v = JSON.stringify(v);\n        }\n        parts.push(encodeURIComponent(key) + '=' +\n          encodeURIComponent(v));\n      });\n    });\n\n    return parts.join('&');\n  }\n\n  public encodeQueryJsonParams(query:QueryResource, additional:any = {}) {\n    let paramsData:any = {};\n\n    paramsData = this.encodeColumns(paramsData, query);\n    paramsData = this.encodeSums(paramsData, query);\n    paramsData = this.encodeTimelineVisible(paramsData, query);\n    paramsData = this.encodeHighlightingMode(paramsData, query);\n    paramsData = this.encodeHighlightedAttributes(paramsData, query);\n    paramsData.hi = !!query.showHierarchies;\n    paramsData.g = _.get(query.groupBy, 'id', '');\n    paramsData = this.encodeSortBy(paramsData, query);\n    paramsData = this.encodeFilters(paramsData, query.filters);\n    paramsData.pa = additional.page;\n    paramsData.pp = additional.perPage;\n    paramsData.dr = query.displayRepresentation;\n\n    return JSON.stringify(paramsData);\n  }\n\n  private encodeColumns(paramsData:any, query:QueryResource) {\n    paramsData.c = query.columns.map(function (column) {\n      return column.id!;\n    });\n\n    return paramsData;\n  }\n\n  private encodeSums(paramsData:any, query:QueryResource) {\n    if (!!query.sums) {\n      paramsData.s = query.sums;\n    }\n    return paramsData;\n  }\n\n  private encodeHighlightingMode(paramsData:any, query:QueryResource) {\n    if (query.highlightingMode && (query.persisted || query.highlightingMode !== 'inline')) {\n      paramsData.hl = query.highlightingMode;\n    }\n    return paramsData;\n  }\n\n  private encodeHighlightedAttributes(paramsData:any, query:QueryResource) {\n    if (query.highlightingMode === 'inline') {\n      if (Array.isArray(query.highlightedAttributes) && query.highlightedAttributes.length > 0) {\n        paramsData.hla = query.highlightedAttributes.map(el => el.id);\n      }\n    }\n    return paramsData;\n  }\n\n  private encodeSortBy(paramsData:any, query:QueryResource) {\n    if (query.sortBy) {\n      paramsData.t = query\n        .sortBy\n        .map(function (sort:QuerySortByResource) {\n          return sort.id!.replace('-', ':')\n        })\n        .join();\n    }\n    return paramsData;\n  }\n\n  public encodeFilters(paramsData:any, filters:QueryFilterInstanceResource[]) {\n    if (filters && filters.length > 0) {\n      paramsData.f = filters\n        .map((filter:any) => {\n          var id = filter.id;\n\n          var operator = filter.operator.id;\n\n          return {\n            n: id,\n            o: operator,\n            v: _.map(filter.values, (v) => this.queryFilterValueToParam(v))\n          };\n        });\n    } else {\n      paramsData.f = [];\n    }\n    return paramsData;\n  }\n\n  private encodeTimelineVisible(paramsData:any, query:QueryResource) {\n    if (!!query.timelineVisible) {\n      paramsData.tv = query.timelineVisible;\n\n      if (!_.isEmpty(query.timelineLabels)) {\n        paramsData.tll = JSON.stringify(query.timelineLabels);\n      }\n\n      paramsData.tzl = query.timelineZoomLevel;\n    } else {\n      paramsData.tv = false;\n    }\n    return paramsData;\n  }\n\n\n  public buildV3GetQueryFromJsonParams(updateJson:string|null) {\n    var queryData:any = {\n      pageSize: this.paginationService.getPerPage()\n    }\n\n    if (!updateJson) {\n      return queryData;\n    }\n\n    var properties = JSON.parse(updateJson);\n\n    if (properties.c) {\n      queryData[\"columns[]\"] = properties.c.map((column:any) => column);\n    }\n    if (!!properties.s) {\n      queryData.showSums = properties.s;\n    }\n\n    queryData.timelineVisible = properties.tv;\n\n    if (!!properties.tv) {\n      if (!!properties.tll) {\n        queryData.timelineLabels = properties.tll;\n      }\n\n      if (properties.tzl) {\n        queryData.timelineZoomLevel = properties.tzl;\n      }\n    }\n\n    if (properties.dr) {\n      queryData.displayRepresentation = properties.dr;\n    }\n\n    if (properties.hl) {\n      queryData.highlightingMode = properties.hl;\n    }\n\n    if (properties.hla) {\n      queryData[\"highlightedAttributes[]\"] = properties.hla.map((column:any) => column);\n    }\n\n    if (properties.hi === false || properties.hi === true) {\n      queryData.showHierarchies = properties.hi;\n    }\n\n    queryData.groupBy = _.get(properties, 'g', '');\n\n    // Filters\n    if (properties.f) {\n      var filters = properties.f.map(function (urlFilter:any) {\n        var attributes = {\n          operator: decodeURIComponent(urlFilter.o)\n        }\n        if (urlFilter.v) {\n          // the array check is only there for backwards compatibility reasons.\n          // Nowadays, it will always be an array;\n          var vs = Array.isArray(urlFilter.v) ? urlFilter.v : [urlFilter.v];\n          _.extend(attributes, { values: vs });\n        }\n        const filterData:any = {};\n        filterData[urlFilter.n] = attributes;\n\n        return filterData;\n      });\n\n      queryData.filters = JSON.stringify(filters);\n    }\n\n    // Sortation\n    if (properties.t) {\n      queryData.sortBy = JSON.stringify(properties.t.split(',').map((sort:any) => sort.split(':')));\n    }\n\n    // Pagination\n    if (properties.pa) {\n      queryData.offset = properties.pa;\n    }\n    if (properties.pp) {\n      queryData.pageSize = properties.pp;\n    }\n\n    return queryData;\n  }\n\n  public buildV3GetQueryFromQueryResource(query:QueryResource, additionalParams:any = {}, contextual:any = {}) {\n    var queryData:any = {};\n\n    queryData[\"columns[]\"] = this.buildV3GetColumnsFromQueryResource(query);\n    queryData.showSums = query.sums;\n    queryData.timelineVisible = !!query.timelineVisible;\n\n    if (!!query.timelineVisible) {\n      queryData.timelineZoomLevel = query.timelineZoomLevel;\n      queryData.timelineLabels = JSON.stringify(query.timelineLabels);\n    }\n\n    if (query.highlightingMode) {\n      queryData.highlightingMode = query.highlightingMode;\n    }\n\n    if (query.highlightedAttributes && query.highlightingMode === 'inline') {\n      queryData['highlightedAttributes[]'] = query.highlightedAttributes.map(el => el.href);\n    }\n\n    if (query.displayRepresentation) {\n      queryData.displayRepresentation = query.displayRepresentation;\n    }\n\n    queryData.showHierarchies = !!query.showHierarchies;\n    queryData.groupBy = _.get(query.groupBy, 'id', '');\n\n    // Filters\n    queryData.filters = this.buildV3GetFiltersAsJson(query.filters, contextual);\n\n    // Sortation\n    queryData.sortBy = this.buildV3GetSortByFromQuery(query);\n\n    return _.extend(additionalParams, queryData);\n  }\n\n  public queryFilterValueToParam(value:any) {\n    if (typeof(value) === 'boolean') {\n      return value ? 't' : 'f';\n    }\n\n    if (!value) {\n      return '';\n    } else if (value.id) {\n      return value.id.toString();\n    } else if (value.$href && value.$href.match(/^\\/api\\/v3\\/string_objects/i)) {\n      return value.$href.match(/value=([^&]+)/)[1].toString();\n    } else if (value.$href) {\n      return value.$href.split('/').pop().toString();\n    } else {\n      return value.toString();\n    }\n  }\n\n  private buildV3GetColumnsFromQueryResource(query:QueryResource) {\n    if (query.columns) {\n      return query.columns.map((column:any) => column.id || column.idFromLink);\n    } else if (query._links.columns) {\n      return query._links.columns.map((column:HalLink) => {\n        let id = column.href!;\n\n        return this.idFromHref(id);\n      });\n    }\n  }\n\n  public buildV3GetFilters(filters:QueryFilterInstanceResource[], replacements = {}):ApiV3Filter[] {\n    let newFilters = filters.map((filter:QueryFilterInstanceResource) => {\n      let id = this.buildV3GetFilterIdFromFilter(filter);\n      let operator = this.buildV3GetOperatorIdFromFilter(filter);\n      let values = this.buildV3GetValuesFromFilter(filter).map(value => {\n        _.each(replacements, (val:string, key:string) => {\n          value = value.replace(`{${key}}`, val);\n        });\n\n        return value;\n      });\n\n      const filterHash:ApiV3Filter = {};\n      filterHash[id] = { operator: operator as FilterOperator, values: values };\n\n      return filterHash;\n    });\n\n    return newFilters;\n  }\n\n  public buildV3GetFiltersAsJson(filter:QueryFilterInstanceResource[], contextual = {}) {\n    return JSON.stringify(this.buildV3GetFilters(filter, contextual));\n  }\n\n  public buildV3GetFilterIdFromFilter(filter:QueryFilterInstanceResource) {\n    let href = filter.filter ? filter.filter.$href : filter._links.filter.href;\n\n    return this.idFromHref(href);\n  }\n\n  private buildV3GetOperatorIdFromFilter(filter:QueryFilterInstanceResource) {\n    if (filter.operator) {\n      return filter.operator.id || filter.operator.idFromLink;\n    } else {\n      let href = filter._links.operator.href;\n\n      return this.idFromHref(href);\n    }\n  }\n\n  private buildV3GetValuesFromFilter(filter:QueryFilterInstanceResource) {\n    if (filter.values) {\n      return _.map(filter.values, (v:any) => this.queryFilterValueToParam(v));\n    } else {\n      return _.map(filter._links.values, (v:any) => this.idFromHref(v.href));\n    }\n\n  }\n\n  private buildV3GetSortByFromQuery(query:QueryResource) {\n    let sortBys = query.sortBy ? query.sortBy : query._links.sortBy;\n    let sortByIds = sortBys.map((sort:QuerySortByResource) => {\n      if (sort.id) {\n        return sort.id;\n      } else {\n        let href = sort.href!;\n\n        let id = this.idFromHref(href);\n\n        return id;\n      }\n    });\n\n    return JSON.stringify(sortByIds.map((id:string) => id.split('-')));\n  }\n\n  private idFromHref(href:string) {\n    let id = href.substring(href.lastIndexOf('/') + 1, href.length);\n\n    return decodeURIComponent(id);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {StateService, Transition} from \"@uirouter/core\";\nimport {KeepTabService} from \"core-components/wp-single-view-tabs/keep-tab/keep-tab.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\ninterface BackRouteOptions {\n  name:string;\n  params:{};\n  parent:string;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class BackRoutingService {\n  @InjectField() private $state:StateService;\n  @InjectField() private keepTab:KeepTabService;\n\n  private _backRoute:BackRouteOptions;\n\n  constructor(readonly injector:Injector) {\n  }\n\n  public goBack(preferListOverSplit:boolean = false) {\n    // Default: back to list\n    // When coming from a deep link or a create form\n    const baseRoute = this.$state.current.data.baseRoute || 'work-packages.partitioned.list';\n\n    if (!this.backRoute || this.backRoute.name.includes('new')) {\n      this.$state.go(baseRoute, this.$state.params);\n    } else {\n      if (this.keepTab.isDetailsState(this.backRoute.parent)) {\n        if (preferListOverSplit) {\n          this.$state.go(baseRoute, this.$state.params);\n        } else {\n          this.$state.go(this.keepTab.currentDetailsState, this.$state.params);\n        }\n      } else {\n        this.$state.go(this.backRoute.name, this.backRoute.params);\n      }\n    }\n  }\n\n  public goToBaseState() {\n    const baseRoute = this.$state.current.data.baseRoute || 'work-packages.partitioned.list';\n    this.$state.go(baseRoute, this.$state.params);\n  }\n\n  public sync(transition:Transition) {\n    const fromState = transition.from();\n    const toState = transition.to();\n\n    // Set backRoute to know where we came from\n    if (fromState.name &&\n      fromState.data &&\n      toState.data &&\n      fromState.data.parent !== toState.data.parent) {\n      const paramsFromCopy = { ...transition.params('from') };\n      this.backRoute = { name: fromState.name, params: paramsFromCopy, parent: fromState.data.parent };\n    }\n  }\n\n  public set backRoute(route:BackRouteOptions) {\n    this._backRoute = route;\n  }\n\n  public get backRoute():BackRouteOptions {\n    return this._backRoute;\n  }\n}\n","import {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {Injector} from \"@angular/core\";\n\nexport class TableDragActionService {\n\n  /**\n   * Initialize an action service in the given isolated query space\n   * @param querySpace The isolated query space for this table\n   * @param injector The hierarchical injector for this table\n   */\n  constructor(readonly querySpace:IsolatedQuerySpace,\n              readonly injector:Injector) {\n  }\n\n  /**\n   * Determine whether the service applies for the given\n   * query spaces.\n   */\n  public get applies():boolean {\n    return true;\n  }\n\n  /**\n   * Perform a post-order update\n   */\n  public onNewOrder(newOrder:string[]):void {\n  }\n\n  /**\n   * Returns whether the given work package is movable\n   */\n  public canPickup(workPackage:WorkPackageResource):boolean {\n    return true;\n  }\n\n  /**\n   * Perform the respective action for the drop that just happened\n   *\n   * @param workPackage\n   * @param target\n   * @param source\n   * @param sibling\n   */\n  public handleDrop(workPackage:WorkPackageResource, el:HTMLElement):Promise<unknown> {\n    return Promise.resolve(undefined);\n  }\n\n  /**\n   * Manipulate the shadow element\n   * @param shadowElement\n   * @param backToDefault: Shall the modifications be made undone\n   */\n  public changeShadowElement(shadowElement:HTMLElement, backToDefault:boolean = false) {\n    if (backToDefault) {\n      shadowElement.classList.remove('-dragged');\n    } else {\n      shadowElement.classList.add('-dragged');\n    }\n    return true;\n  }\n}\n","import {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {TableDragActionService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-action.service\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {\n  hierarchyGroupClass,\n  hierarchyRootClass\n} from \"core-components/wp-fast-table/helpers/wp-table-hierarchy-helpers\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {relationRowClass} from \"core-components/wp-fast-table/helpers/wp-table-row-helpers\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class HierarchyDragActionService extends TableDragActionService {\n\n  @InjectField() private wpTableHierarchies:WorkPackageViewHierarchiesService;\n  @InjectField() private relationHierarchyService:WorkPackageRelationsHierarchyService;\n  @InjectField() private wpCacheService:WorkPackageCacheService;\n\n  public get applies() {\n    return this.wpTableHierarchies.isEnabled;\n  }\n\n  /**\n   * Returns whether the given work package is movable\n   */\n  public canPickup(workPackage:WorkPackageResource):boolean {\n    return !!workPackage.changeParent;\n  }\n\n  public handleDrop(workPackage:WorkPackageResource, el:HTMLElement):Promise<unknown> {\n    return this.determineParent(el).then((parentId:string|null) => {\n      return this.relationHierarchyService.changeParent(workPackage, parentId);\n    });\n  }\n\n  /**\n   * Find an applicable parent element from the hierarchy information in the table.\n   * @param el\n   */\n  private determineParent(el:HTMLElement):Promise<string|null> {\n    let previous = el.previousElementSibling;\n    var parent = null;\n\n    if (previous !== null && !this.isFlatList(previous)) {\n      // If the previous element is a relation row,\n      // skip it until we find the real previous sibling\n      const isRelationRow = previous.className.indexOf(relationRowClass()) >= 0;\n      if (isRelationRow) {\n        let relationRoot = this.findRelationRowRoot(previous);\n        if (relationRoot == null) {\n          return Promise.resolve(null);\n        }\n        previous = relationRoot;\n      }\n\n      let previousWpId = (previous as HTMLElement).dataset.workPackageId!;\n      if (this.isHiearchyRoot(previous, previousWpId)) {\n        // If the sibling is a hierarchy root, return that sibling as new parent.\n        parent = previousWpId;\n      } else {\n        // If the sibling is no hierarchy root, return it's parent.\n        // Thus, the dropped element will get the same hierarchy level as the sibling\n        parent = this.loadParentOfWP(previousWpId);\n      }\n    }\n\n    return Promise.resolve(parent);\n  }\n\n  private findRelationRowRoot(el:Element):Element|null {\n    let previous = el.previousElementSibling;\n    while (previous !== null) {\n      if (previous.className.indexOf(relationRowClass()) < 0) {\n        return previous;\n      }\n      previous = previous.previousElementSibling;\n    }\n\n    return null;\n  }\n\n  private isFlatList(previous:Element):boolean {\n    const inGroup = previous.className.indexOf(hierarchyGroupClass('')) >= 0;\n    const isRoot = previous.className.indexOf(hierarchyRootClass('')) >= 0;\n\n    return !(inGroup || isRoot);\n  }\n\n  private isHiearchyRoot(previous:Element, previousWpId:string):boolean {\n    return previous.classList.contains(hierarchyRootClass(previousWpId));\n  }\n\n  private loadParentOfWP(wpId:string):Promise<string|null> {\n    return this.wpCacheService.require(wpId)\n      .then((wp:WorkPackageResource) => {\n        return Promise.resolve(wp.parent?.id || null);\n      });\n  }\n}\n","import {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {TableDragActionService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-action.service\";\nimport {WorkPackageViewGroupByService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {rowGroupClassName} from \"core-components/wp-fast-table/builders/modes/grouped/grouped-classes.constants\";\nimport {locatePredecessorBySelector} from \"core-components/wp-fast-table/helpers/wp-table-row-helpers\";\nimport {groupIdentifier} from \"core-components/wp-fast-table/builders/modes/grouped/grouped-rows-helpers\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class GroupByDragActionService extends TableDragActionService {\n\n  @InjectField() wpTableGroupBy:WorkPackageViewGroupByService;\n  @InjectField() halEditing:HalResourceEditingService;\n  @InjectField() halEvents:HalEventsService;\n  @InjectField() halNotification:HalResourceNotificationService;\n\n  public get applies() {\n    return this.wpTableGroupBy.isEnabled;\n  }\n\n  /**\n   * Returns whether the given work package is movable\n   */\n  public canPickup(workPackage:WorkPackageResource):boolean {\n    const attribute = this.groupedAttribute;\n    return attribute !== null && workPackage.isAttributeEditable(attribute);\n  }\n\n  public handleDrop(workPackage:WorkPackageResource, el:HTMLElement):Promise<unknown> {\n    const changeset = this.halEditing.changeFor(workPackage);\n    const groupedValue = this.getValueForGroup(el);\n\n    changeset.projectedResource[this.groupedAttribute!] = groupedValue;\n    return this.halEditing\n      .save(changeset)\n      .then((saved) => this.halEvents.push(saved.resource, {eventType: 'updated'}))\n      .catch(e => this.halNotification.handleRawError(e, workPackage));\n  }\n\n  private getValueForGroup(el:HTMLElement):unknown|null {\n    const groupHeader = locatePredecessorBySelector(el, `.${rowGroupClassName}`)!;\n    const match = this.groups.find(group => groupIdentifier(group) === groupHeader.dataset.groupIdentifier);\n\n    if (!match) {\n      return null;\n    }\n\n    if (match._links && match._links.valueLink) {\n      const links = match._links.valueLink;\n\n      // Unwrap single links to properly use them\n      return links.length === 1 ? links[0] : links;\n    } else {\n      return match.value;\n    }\n  }\n\n  /**\n   * Get the attribute we're grouping by\n   */\n  private get groupedAttribute():string|null {\n    const current = this.wpTableGroupBy.current;\n    return current ? current.id : null;\n  }\n\n  /**\n   * Returns the reference to the last table.groups state value\n   */\n  public get groups() {\n    return this.querySpace.groups.value || [];\n  }\n}\n","import {Injectable, Injector} from \"@angular/core\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {TableDragActionService} from \"core-components/wp-table/drag-and-drop/actions/table-drag-action.service\";\nimport {HierarchyDragActionService} from \"core-components/wp-table/drag-and-drop/actions/hierarchy-drag-action.service\";\nimport {GroupByDragActionService} from \"core-components/wp-table/drag-and-drop/actions/group-by-drag-action.service\";\n\ninterface ITableDragActionService {\n  new(querySpace:IsolatedQuerySpace, injector:Injector):TableDragActionService;\n}\n\n@Injectable()\nexport class TableDragActionsRegistryService {\n\n  private register:ITableDragActionService[] = [\n    HierarchyDragActionService,\n    GroupByDragActionService,\n  ];\n\n  public add(service:ITableDragActionService) {\n    this.register.push(service);\n  }\n\n  public get(injector:Injector):TableDragActionService {\n    const querySpace = injector.get(IsolatedQuerySpace);\n\n    const match = this.register\n      .map(cls => new cls(querySpace, injector))\n      .find(instance => instance.applies);\n\n    return match || new TableDragActionService(querySpace, injector);\n  }\n}\n","import {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {\n  DisplayFieldRenderer,\n  editFieldContainerClass\n} from '../../wp-edit-form/display-field-renderer';\nimport {Injector} from '@angular/core';\nimport {QueryColumn} from \"core-components/wp-query/query-column\";\nexport const tdClassName = 'wp-table--cell-td';\nexport const editCellContainer = 'wp-table--cell-container';\n\nexport class CellBuilder {\n\n  public fieldRenderer = new DisplayFieldRenderer(this.injector, 'table');\n\n  constructor(public injector:Injector) {\n  }\n\n  public build(workPackage:WorkPackageResource, column:QueryColumn) {\n    const td = document.createElement('td');\n    const attribute = column.id;\n    td.classList.add(tdClassName, attribute);\n\n    if (attribute === 'subject') {\n      td.classList.add('-max');\n    }\n\n    const schema = workPackage.schema[attribute];\n    if (schema && schema.type === 'User') {\n      td.classList.add('-contains-avatar');\n    }\n\n    const container = document.createElement('span');\n    container.classList.add(editCellContainer, editFieldContainerClass, attribute);\n    const displayElement = this.fieldRenderer.render(workPackage, attribute, null);\n\n    container.appendChild(displayElement);\n    td.appendChild(container);\n\n    return td;\n  }\n\n  public refresh(container:HTMLElement, workPackage:WorkPackageResource, attribute:string) {\n    const displayElement = this.fieldRenderer.render(workPackage, attribute, null);\n\n    container.innerHTML = '';\n    container.appendChild(displayElement);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, Output} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {QueryFilterInstanceResource} from 'core-app/modules/hal/resources/query-filter-instance-resource';\nimport {DebouncedEventEmitter} from 'core-components/angular/debounced-event-emitter';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\n\n@Component({\n  selector: 'filter-string-value',\n  templateUrl: './filter-string-value.component.html'\n})\nexport class FilterStringValueComponent extends UntilDestroyedMixin {\n  @Input() public shouldFocus:boolean = false;\n  @Input() public filter:QueryFilterInstanceResource;\n  @Output() public filterChanged = new DebouncedEventEmitter<QueryFilterInstanceResource>(componentDestroyed(this));\n\n  readonly text = {\n    enter_text: this.I18n.t('js.work_packages.description_enter_text')\n  };\n\n  constructor(readonly I18n:I18nService) {\n    super();\n  }\n\n  public get value():HalResource|string {\n    return this.filter.values[0];\n  }\n\n  public set value(val) {\n    if (val.length) {\n      this.filter.values[0] = val;\n    } else {\n      this.filter.values.length = 0;\n    }\n    this.filterChanged.emit(this.filter);\n  }\n}\n","<div id=\"div-values-{{filter.name}}\">\n  <input [(ngModel)]=\"value\"\n         [focus]=\"shouldFocus\"\n         requried=\"true\"\n         class=\"advanced-filters--text-field\"\n         id=\"values-{{filter.name}}\"\n         name=\"v[{{filter.name}}]\"\n         type=\"text\" />\n  <label for=\"values-{{filter.name}}\"\n         [textContent]=\"text.enter_text\"\n         class=\"hidden-for-sighted\">\n  </label>\n</div>\n","import {environment} from '../../environments/environment';\n\n/**\n * Execute the callback when DEBUG is defined\n * through webpack.\n */\nexport function whenDebugging(cb:Function) {\n  if (!environment.production) {\n    cb();\n  }\n}\n\n/**\n * Log with console.log when DEBUG is defined\n * through webpack.\n */\nexport function debugLog(message:string, ...args:any[]) {\n  whenDebugging(() => console.log(`[DEBUG] ${message}`, ...args));\n}\n\nexport function timeOutput(msg:string, cb:() => void):any {\n  if (!environment.production) {\n    var t0 = performance.now();\n\n    var results = cb();\n\n    var t1 = performance.now();\n    console.log(`%c${msg} completed in ${(t1 - t0)} milliseconds.`, 'color:#00A093;');\n\n    return results;\n  } else {\n    return cb();\n  }\n}\n\nexport function asyncTimeOutput(msg:string, promise:Promise<any>):any {\n  if (!environment.production) {\n    var t0 = performance.now();\n\n    return promise.then(() => {\n      var t1 = performance.now();\n      console.log(`%c${msg} completed in ${(t1 - t0)} milliseconds.`, 'color:#00A093;');\n    });\n  } else {\n    return promise;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {INotification} from 'core-app/modules/common/notifications/notifications.service';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\n\n@Injectable()\nexport class WorkPackageNotificationService extends HalResourceNotificationService {\n\n  constructor(readonly injector:Injector,\n              protected wpCacheService:WorkPackageCacheService) {\n    super(injector);\n  }\n\n  public showSave(resource:WorkPackageResource, isCreate:boolean = false) {\n    let message:any = {\n      message: this.I18n.t('js.notice_successful_' + (isCreate ? 'create' : 'update')),\n    };\n\n    this.addWorkPackageFullscreenLink(message, resource as any);\n\n    this.NotificationsService.addSuccess(message);\n  }\n\n  protected showCustomError(errorResource:any, resource:WorkPackageResource):boolean {\n    if (errorResource.errorIdentifier === 'urn:openproject-org:api:v3:errors:UpdateConflict') {\n      this.NotificationsService.addError({\n        message: errorResource.message,\n        type: 'error',\n        link: {\n          text: this.I18n.t('js.hal.error.update_conflict_refresh'),\n          target: () => this.wpCacheService.require(resource.id!, true)\n        }\n      });\n\n      return true;\n    }\n\n    return super.showCustomError(errorResource, resource);\n  }\n\n  private addWorkPackageFullscreenLink(message:INotification, resource:WorkPackageResource) {\n    // Don't show the 'Show in full screen' link  if we're there already\n    if (!this.$state.includes('work-packages.show')) {\n      message.link = {\n        target: () => this.$state.go('work-packages.show.activity', {workPackageId: resource.id}),\n        text: this.I18n.t('js.work_packages.message_successful_show_in_fullscreen')\n      };\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\n\nexport const QUERY_SORT_BY_ASC = \"urn:openproject-org:api:v3:queries:directions:asc\"\nexport const QUERY_SORT_BY_DESC = \"urn:openproject-org:api:v3:queries:directions:desc\"\n\nexport interface QuerySortByResourceEmbedded {\n  column:QueryColumn;\n  direction:QuerySortByDirection;\n}\n\nexport class QuerySortByResource extends HalResource {\n  public $embedded:QuerySortByResourceEmbedded;\n  public column:QueryColumn;\n  public direction:QuerySortByDirection;\n}\n\n/**\n * A direction for sorting\n */\nexport class QuerySortByDirection extends HalResource {\n  public get id():string {\n    return this.$href!.split('/').pop()!;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Transition} from '@uirouter/core';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './relations-tab.html',\n  selector: 'wp-relations-tab',\n})\nexport class WorkPackageRelationsTabComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public workPackageId?:string;\n  public workPackage:WorkPackageResource;\n\n  public constructor(readonly I18n:I18nService,\n                     readonly $transition:Transition,\n                     readonly wpCacheService:WorkPackageCacheService) {\n    super();\n  }\n\n  ngOnInit() {\n    const wpId = this.workPackageId || this.$transition.params('to').workPackageId;\n    this.wpCacheService.loadWorkPackage(wpId)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp) => {\n        this.workPackageId = wp.id!;\n        this.workPackage = wp;\n      });\n  }\n\n}\n","<div class=\"detail-panel-description detail-panel--relations detail-panel--autocomplete-target\"\n     *ngIf=\"workPackage\">\n  <div class=\"detail-panel-description-content\">\n    <wp-relations [workPackage]=\"workPackage\"></wp-relations>\n  </div>\n</div>\n","import {Injector} from \"@angular/core\";\nimport {\n  WorkPackageAction,\n  WorkPackageContextMenuHelperService\n} from \"core-components/wp-table/context-menu-helper/wp-context-menu-helper.service\";\nimport {States} from \"core-components/states.service\";\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {LinkHandling} from \"core-app/modules/common/link-handling/link-handling\";\nimport {OpContextMenuHandler} from \"core-components/op-context-menu/op-context-menu-handler\";\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {OpContextMenuItem, OpContextMenuLocalsMap} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {PERMITTED_CONTEXT_MENU_ACTIONS} from \"core-components/op-context-menu/wp-context-menu/wp-static-context-menu-actions\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {WpDestroyModal} from \"core-components/modals/wp-destroy-modal/wp-destroy.modal\";\nimport {StateService} from \"@uirouter/core\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {TimeEntryCreateService} from \"core-app/modules/time_entries/create/create.service\";\nimport {splitViewRoute} from \"core-app/modules/work_packages/routing/split-view-routes.helper\";\n\nexport class WorkPackageViewContextMenu extends OpContextMenuHandler {\n\n  @InjectField() protected states:States;\n  @InjectField() protected wpRelationsHierarchyService:WorkPackageRelationsHierarchyService;\n  @InjectField() protected opModalService:OpModalService;\n  @InjectField() protected $state:StateService;\n  @InjectField() protected wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() protected WorkPackageContextMenuHelper:WorkPackageContextMenuHelperService;\n  @InjectField() protected timeEntryCreateService:TimeEntryCreateService;\n\n  protected workPackage = this.states.workPackages.get(this.workPackageId).value!;\n  protected selectedWorkPackages = this.getSelectedWorkPackages();\n  protected permittedActions = this.WorkPackageContextMenuHelper.getPermittedActions(\n    this.selectedWorkPackages,\n    PERMITTED_CONTEXT_MENU_ACTIONS,\n    this.allowSplitScreenActions\n  );\n\n  // Get the base route for the current route to ensure we always link correctly\n  protected baseRoute = this.$state.current.data.baseRoute || this.$state.current.name;\n\n  protected items = this.buildItems();\n\n  constructor(public injector:Injector,\n              protected workPackageId:string,\n              protected $element:JQuery,\n              protected additionalPositionArgs:any = {},\n              protected allowSplitScreenActions:boolean = true) {\n    super(injector.get(OPContextMenuService));\n  }\n\n  public get locals():OpContextMenuLocalsMap {\n    return { contextMenuId: 'work-package-context-menu', items: this.items };\n  }\n\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let position = super.positionArgs(evt);\n    _.assign(position, this.additionalPositionArgs);\n\n    return position;\n  }\n\n  public triggerContextMenuAction(action:WorkPackageAction) {\n    const link = action.link;\n\n    switch (action.key) {\n      case 'delete':\n        this.deleteSelectedWorkPackages();\n        break;\n\n      case 'edit':\n        this.editSelectedWorkPackages(link!);\n        break;\n\n      case 'copy':\n        this.copySelectedWorkPackages(link!);\n        break;\n\n      case 'relation-new-child':\n        this.wpRelationsHierarchyService.addNewChildWp(this.baseRoute, this.workPackage);\n        break;\n\n      case 'log_time':\n        this.logTimeForSelectedWorkPackage();\n        break;\n\n      default:\n        window.location.href = link!;\n        break;\n    }\n  }\n\n  private deleteSelectedWorkPackages() {\n    let selected = this.getSelectedWorkPackages();\n    this.opModalService.show(WpDestroyModal, this.injector, { workPackages: selected });\n  }\n\n  private editSelectedWorkPackages(link:any) {\n    let selected = this.getSelectedWorkPackages();\n\n    if (selected.length > 1) {\n      window.location.href = link;\n      return;\n    }\n  }\n\n  private copySelectedWorkPackages(link:any) {\n    let selected = this.getSelectedWorkPackages();\n\n    if (selected.length > 1) {\n      window.location.href = link;\n      return;\n    }\n\n    let params = {\n      copiedFromWorkPackageId: selected[0].id\n    };\n\n    this.$state.go(this.baseRoute + '.copy', params);\n  }\n\n  private logTimeForSelectedWorkPackage() {\n    this.timeEntryCreateService\n      .create(moment(new Date()), this.workPackage)\n      .catch(() => {\n        // do nothing, the user closed without changes\n      });\n  }\n\n  private getSelectedWorkPackages() {\n    let selectedWorkPackages = this.wpTableSelection.getSelectedWorkPackages();\n\n    if (selectedWorkPackages.length === 0) {\n      return [this.workPackage];\n    }\n\n    if (selectedWorkPackages.indexOf(this.workPackage) === -1) {\n      selectedWorkPackages.push(this.workPackage);\n    }\n\n    return selectedWorkPackages;\n  }\n\n  protected buildItems():OpContextMenuItem[] {\n    let items = this.permittedActions.map((action:WorkPackageAction) => {\n      return {\n        class: undefined as string|undefined,\n        disabled: false,\n        linkText: action.text,\n        href: action.href,\n        icon: action.icon != null ? action.icon : `icon-${action.key}`,\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (action.href && LinkHandling.isClickedWithModifier($event)) {\n            return false;\n          }\n\n          this.triggerContextMenuAction(action);\n          return true;\n        }\n      };\n    });\n\n\n    if (!this.workPackage.isNew) {\n      items.unshift({\n        disabled: false,\n        icon: 'icon-view-fullscreen',\n        class: 'openFullScreenView',\n        href: this.$state.href('work-packages.show', { workPackageId: this.workPackageId }),\n        linkText: I18n.t('js.button_open_fullscreen'),\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (LinkHandling.isClickedWithModifier($event)) {\n            return false;\n          }\n\n          this.$state.go(\n            'work-packages.show',\n            { workPackageId: this.workPackageId }\n          );\n          return true;\n        }\n      });\n\n      if (this.allowSplitScreenActions) {\n        items.unshift({\n          disabled: false,\n          icon: 'icon-view-split',\n          class: 'detailsViewMenuItem',\n          href: this.$state.href(\n            splitViewRoute(this.$state) + '.overview',\n            { workPackageId: this.workPackageId }),\n          linkText: I18n.t('js.button_open_details'),\n          onClick: ($event:JQuery.TriggeredEvent) => {\n            if (LinkHandling.isClickedWithModifier($event)) {\n              return false;\n            }\n\n            this.$state.go(\n              splitViewRoute(this.$state) + '.overview',\n              { workPackageId: this.workPackageId }\n            );\n            return true;\n          }\n        });\n      }\n    }\n\n    return items;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AbstractWorkPackageButtonComponent} from '../wp-buttons.module';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\n\nconst screenfull:any = require('screenfull/dist/screenfull.js');\n\nexport const zenModeComponentSelector = 'zen-mode-toggle-button';\n\n@Component({\n  templateUrl: '../wp-button.template.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: zenModeComponentSelector,\n})\nexport class ZenModeButtonComponent extends AbstractWorkPackageButtonComponent {\n  public buttonId:string = 'work-packages-zen-mode-toggle-button';\n  public buttonClass:string = 'toolbar-icon';\n  public iconClass:string = 'icon-zen-mode';\n\n  static inZenMode:boolean = false;\n\n  private activateLabel:string;\n  private deactivateLabel:string;\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef) {\n    super(I18n);\n\n    this.activateLabel = I18n.t('js.zen_mode.button_activate');\n    this.deactivateLabel = I18n.t('js.zen_mode.button_deactivate');\n    let self = this;\n\n    if (screenfull.enabled) {\n      screenfull.onchange(function() {\n        // This event might get triggered several times for once leaving\n        // fullscreen mode.\n        if (!screenfull.isFullscreen) {\n          self.deactivateZenMode();\n        }\n      });\n    }\n  }\n\n  public get label():string {\n    if (this.isActive) {\n      return this.deactivateLabel;\n    } else {\n      return this.activateLabel;\n    }\n  }\n\n  public isToggle():boolean {\n    return true;\n  }\n\n  private deactivateZenMode():void {\n    this.isActive = ZenModeButtonComponent.inZenMode = false;\n    jQuery('body').removeClass('zen-mode');\n    this.disabled = false;\n    if (screenfull.enabled && screenfull.isFullscreen) {\n      screenfull.exit();\n    }\n    this.cdRef.detectChanges();\n  }\n\n  private activateZenMode() {\n    this.isActive = ZenModeButtonComponent.inZenMode = true;\n    jQuery('body').addClass('zen-mode');\n    if (screenfull.enabled) {\n      screenfull.request();\n    }\n    this.cdRef.detectChanges();\n  }\n\n  public performAction(evt:Event):false {\n    if (ZenModeButtonComponent.inZenMode) {\n      this.deactivateZenMode();\n    } else {\n      this.activateZenMode();\n    }\n\n    evt.preventDefault();\n    return false;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class TimeEntryResource extends HalResource {\n  // TODO: extract the whole overridden Schema stuff into halresource or use the schemaCacheService\n  // to place it there\n  @InjectField() schemaCacheService:SchemaCacheService;\n\n  public overriddenSchema:SchemaResource|undefined = undefined;\n\n  /**\n   * Get the current schema, assuming it is either:\n   * 1. Overridden by the current loaded form\n   * 2. Available as a schema state\n   *\n   * If it is neither, an exception is raised.\n   */\n  public get schema():SchemaResource {\n    if (this.hasOverriddenSchema) {\n      return this.overriddenSchema!;\n    }\n\n    const state = this.schemaCacheService.state(this as any);\n\n    if (!state.hasValue()) {\n      throw `Accessing schema of ${this.id} without it being loaded.`;\n    }\n\n    return state.value!;\n  }\n\n  public get hasOverriddenSchema():boolean {\n    return this.overriddenSchema != null;\n  }\n\n  public get state() {\n    return this.states.timeEntries.get(this.id!) as any;\n  }\n\n  /**\n   * Exclude the schema _link from the linkable Resources.\n   */\n  public $linkableKeys():string[] {\n    return _.without(super.$linkableKeys(), 'schema');\n  }\n}\n","import \"reflect-metadata\";\nimport {Injector} from \"@angular/core\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\n\nexport interface InjectableClass {\n  injector:Injector;\n}\n\nexport function InjectField(token?:any, defaultValue:any = null) {\n  return (target:InjectableClass, property:string) => {\n    if (delete (target as any)[property]) {\n      Object.defineProperty(target, property, {\n        get: function(this:InjectableClass) {\n          if (token) {\n            return this.injector.get<any>(token, defaultValue);\n          } else {\n            const type = Reflect.getMetadata('design:type', target, property);\n            return this.injector.get<any>(type);\n          }\n        },\n        set: function(this:InjectableClass, _val:any) {\n          debugLog(\"Trying to set InjectField property \" + property);\n        }\n      });\n    }\n  };\n};","import {Component, Injector, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {QueryColumn} from 'core-components/wp-query/query-column';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {WorkPackageViewColumnsService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {DraggableOption} from \"core-app/modules/common/draggable-autocomplete/draggable-autocomplete.component\";\n\n@Component({\n  templateUrl: './columns-tab.component.html'\n})\nexport class WpTableConfigurationColumnsTab implements TabComponent, OnInit {\n  public availableColumnsOptions = this.wpTableColumns.all.map(c => this.column2Like(c));\n\n  public availableColumns = this.wpTableColumns.all;\n  public availableColumnsMap:{ [id:string]:QueryColumn } = _.keyBy(this.availableColumns, c => c.id);\n  public selectedColumns:DraggableOption[] = this.wpTableColumns.getColumns().map(c => this.column2Like(c));\n\n  public selectedColumnMap:{ [id:string]:boolean } = {};\n  public eeShowBanners:boolean = false;\n  public text = {\n\n    columnsHelp: this.I18n.t('js.work_packages.table_configuration.columns_help_text'),\n    columnsLabel: this.I18n.t('js.label_columns'),\n    selectedColumns: this.I18n.t('js.description_selected_columns'),\n    multiSelectLabel: this.I18n.t('js.work_packages.label_column_multiselect'),\n\n    upsaleRelationColumns: this.I18n.t('js.work_packages.table_configuration.upsale.relation_columns'),\n    upsaleCheckOutLink: this.I18n.t('js.work_packages.table_configuration.upsale.check_out_link')\n  };\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly ConfigurationService:ConfigurationService,\n              readonly bannerService:BannersService) {\n  }\n\n  public onSave() {\n    this.wpTableColumns.setColumnsById(this.selectedColumns.map(c => c.id));\n  }\n\n  ngOnInit() {\n    this.eeShowBanners = this.bannerService.eeShowBanners;\n    this.selectedColumns.forEach((c:DraggableOption) => {\n      this.selectedColumnMap[c.id] = true;\n    });\n  }\n\n  private column2Like(c:QueryColumn):DraggableOption {\n    return { id: c.id, name: c.name };\n  }\n\n  updateSelected(selected:DraggableOption[]) {\n    this.selectedColumns = selected;\n  }\n}\n","<div class=\"columns-modal--content\">\n  <label\n    [textContent]=\"text.selectedColumns\"\n    class=\"hidden-for-sighted\">\n  </label>\n\n  <draggable-autocompleter [options]=\"availableColumnsOptions\"\n                           [selected]=\"selectedColumns\"\n                           (onChange)=\"updateSelected($event)\">\n  </draggable-autocompleter>\n\n  <p class=\"form--inline-instructions\" [textContent]=\"text.columnsHelp\"></p>\n</div>\n\n<enterprise-banner class=\"ee-relation-columns-upsale\"\n                   *ngIf=\"eeShowBanners\"\n                   [linkMessage]=\"text.upsaleCheckOutLink\"\n                   [textMessage]=\"text.upsaleRelationColumns\"\n                   opReferrer=\"wp-list-columns#relations\">\n</enterprise-banner>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {StateService} from '@uirouter/core';\nimport {Component, Injector, OnInit} from '@angular/core';\nimport {WorkPackageViewSelectionService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service';\nimport {WorkPackageSingleViewBase} from \"core-app/modules/work_packages/routing/wp-view-base/work-package-single-view.base\";\nimport {of} from \"rxjs\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  templateUrl: './wp-full-view.html',\n  selector: 'wp-full-view-entry',\n  // Required class to support inner scrolling on page\n  host: { 'class': 'work-packages-page--ui-view' },\n  providers: [\n    { provide: HalResourceNotificationService, useExisting: WorkPackageNotificationService }\n  ]\n})\nexport class WorkPackagesFullViewComponent extends WorkPackageSingleViewBase implements OnInit {\n  // Watcher properties\n  public isWatched:boolean;\n  public displayWatchButton:boolean;\n  public watchers:any;\n\n  stateName$ = of('work-packages.new');\n\n  constructor(public injector:Injector,\n              public wpTableSelection:WorkPackageViewSelectionService,\n              readonly $state:StateService) {\n    super(injector, $state.params['workPackageId']);\n  }\n\n  ngOnInit():void {\n    this.observeWorkPackage();\n  }\n\n  protected initializeTexts() {\n    super.initializeTexts();\n\n    this.text.full_view = {\n      button_more: this.I18n.t('js.button_more')\n    };\n  }\n\n  protected init() {\n    super.init();\n\n    // Set Focused WP\n    this.wpTableFocus.updateFocus(this.workPackage.id!);\n\n    this.setWorkPackageScopeProperties(this.workPackage);\n  }\n\n  private setWorkPackageScopeProperties(wp:WorkPackageResource) {\n    this.isWatched = wp.hasOwnProperty('unwatch');\n    this.displayWatchButton = wp.hasOwnProperty('unwatch') || wp.hasOwnProperty('watch');\n\n    // watchers\n    if (wp.watchers) {\n      this.watchers = (wp.watchers as any).elements;\n    }\n  }\n}\n","<div edit-form\n     [resource]=\"workPackage\"\n     *ngIf=\"workPackage\"\n     class=\"work-packages--show-view\">\n\n    <wp-breadcrumb [workPackage]=\"workPackage\"></wp-breadcrumb>\n\n    <div class=\"toolbar-container\">\n      <div id=\"toolbar\">\n        <div class=\"wp-show--header-container\">\n\n          <back-button linkClass=\"work-packages-back-button\"></back-button>\n\n          <div class=\"subject-header\">\n            <wp-subject></wp-subject>\n          </div>\n        </div>\n        <ul id=\"toolbar-items\" class=\"toolbar-items hide-when-print\">\n          <li class=\"toolbar-item hidden-for-mobile\">\n            <wp-create-button\n              [allowed]=\"['work_package.addChild', 'work_package.copy']\"\n              [stateName$]=\"stateName$\">\n            </wp-create-button>\n          </li>\n          <li class=\"toolbar-item\" *ngIf=\"displayWatchButton\">\n            <wp-watcher-button [workPackage]=\"workPackage\"\n                               [showText]=\"false\">\n            </wp-watcher-button>\n          </li>\n          <li class=\"toolbar-item hidden-for-mobile\">\n            <zen-mode-toggle-button>\n            </zen-mode-toggle-button>\n          </li>\n          <li class=\"toolbar-item action_menu_main\" id=\"action-show-more-dropdown-menu\">\n            <button class=\"button dropdown-relative toolbar-icon\"\n                    [attr.title]=\"text.full_view.button_more\"\n                    wpSingleContextMenu\n                    [wpSingleContextMenu-workPackage]=\"workPackage\">\n              <op-icon icon-classes=\"button--icon icon-show-more\"></op-icon>\n            </button>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <div class=\"work-packages-full-view--split-container\">\n      <div class=\"work-packages-full-view--split-left\">\n        <div class=\"work-packages--panel-inner\">\n          <wp-single-view [workPackage]=\"workPackage\"></wp-single-view>\n        </div>\n      </div>\n      <div class=\"work-packages-full-view--split-right work-packages-tab-view--overflow\">\n        <div class=\"work-packages--panel-inner\">\n          <span class=\"hidden-for-sighted\" tabindex=\"-1\" focus [textContent]=\"focusAnchorLabel\"></span>\n          <div id=\"tabs\">\n            <ul class=\"tabrow\">\n              <!-- The hrefs with empty URLs are necessary for IE10 to focus these links\n              properly. Thus, don't remove the hrefs or the empty URLs! -->\n              <li uiSref=\"work-packages.show.activity\"\n                  [uiParams]=\"{workPackageId: workPackage.id}\"\n                  uiSrefActive=\"selected\">\n                <a href=\"\" [textContent]=\"text.tabs.activity\"></a>\n              </li>\n              <li uiSref=\"work-packages.show.relations\"\n                  [uiParams]=\"{workPackageId: workPackage.id}\"\n                  uiSrefActive=\"selected\">\n                <a href=\"\" [textContent]=\"text.tabs.relations\"></a>\n                <wp-relations-count [wpId]=\"workPackage.id\"></wp-relations-count>\n              </li>\n              <li *ngIf=\"canViewWorkPackageWatchers()\"\n                  uiSref=\"work-packages.show.watchers\"\n                  [uiParams]=\"{workPackageId: workPackage.id}\"\n                  uiSrefActive=\"selected\">\n                <a href=\"\" [textContent]=\"text.tabs.watchers\"></a>\n                <wp-watchers-count [wpId]=\"workPackage.id\"></wp-watchers-count>\n              </li>\n            </ul>\n          </div>\n          <div class=\"tabcontent\" ui-view>\n          </div>\n        </div>\n\n        <div class=\"work-packages-full-view--resizer hidden-for-mobile hide-when-print\">\n          <wp-resizer [elementClass]=\"'work-packages-full-view--split-right'\"\n                      [localStorageKey]=\"'openProject-fullViewFlexBasis'\"></wp-resizer>\n        </div>\n      </div>\n    </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectorRef, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {WorkPackageViewFocusService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {ProjectCacheService} from 'core-components/projects/project-cache.service';\nimport {OpTitleService} from 'core-components/html/op-title.service';\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {States} from \"core-components/states.service\";\nimport {KeepTabService} from \"core-components/wp-single-view-tabs/keep-tab/keep-tab.service\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport class WorkPackageSingleViewBase extends UntilDestroyedMixin {\n\n  @InjectField() wpCacheService:WorkPackageCacheService;\n  @InjectField() states:States;\n  @InjectField() I18n:I18nService;\n  @InjectField() keepTab:KeepTabService;\n  @InjectField() PathHelper:PathHelperService;\n  @InjectField() halEditing:HalResourceEditingService;\n  @InjectField() wpTableFocus:WorkPackageViewFocusService;\n  @InjectField() notificationService:WorkPackageNotificationService;\n  @InjectField() projectCacheService:ProjectCacheService;\n  @InjectField() authorisationService:AuthorisationService;\n  @InjectField() cdRef:ChangeDetectorRef;\n\n  // Static texts\n  public text:any = {};\n\n  // Work package resource to be loaded from the cache\n  public workPackage:WorkPackageResource;\n  public projectIdentifier:string;\n\n  public focusAnchorLabel:string;\n  public showStaticPagePath:string;\n\n  @InjectField() readonly titleService:OpTitleService;\n\n  constructor(public injector:Injector, protected workPackageId:string) {\n    super();\n    this.initializeTexts();\n  }\n\n  /**\n   * Observe changes of work package and re-run initialization.\n   * Needs to be run explicitly by descendants.\n   */\n  protected observeWorkPackage() {\n    /** Require the work package once to ensure we're displaying errors */\n    this.wpCacheService.require(this.workPackageId)\n      .catch((error) => this.notificationService.handleRawError(error));\n\n    /** Stream updates of the work package */\n    this.wpCacheService.state(this.workPackageId)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.workPackage = wp;\n        this.init();\n        this.cdRef.detectChanges();\n      });\n  }\n\n  /**\n   * Provide static translations\n   */\n  protected initializeTexts() {\n    this.text.tabs = {};\n    ['overview', 'activity', 'relations', 'watchers'].forEach(tab => {\n      this.text.tabs[tab] = this.I18n.t('js.work_packages.tabs.' + tab);\n    });\n  }\n\n  /**\n   * Initialize controller after workPackage resource has been loaded.\n   */\n  protected init() {\n    // Set elements\n    this.projectCacheService\n      .require(this.workPackage.project.idFromLink)\n      .then(() => {\n        this.projectIdentifier = this.workPackage.project.identifier;\n      });\n\n    // Set authorisation data\n    this.authorisationService.initModelAuth('work_package', this.workPackage.$links);\n\n    // Push the current title\n    this.titleService.setFirstPart(this.workPackage.subjectWithType(20));\n\n    // Preselect this work package for future list operations\n    this.showStaticPagePath = this.PathHelper.workPackagePath(this.workPackageId);\n\n    // Listen to tab changes to update the tab label\n    this.keepTab.observable\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((tabs:any) => {\n        this.updateFocusAnchorLabel(tabs.active);\n      });\n  }\n\n  /**\n   * Recompute the current tab focus label\n   */\n  public updateFocusAnchorLabel(tabName:string):string {\n    const tabLabel = this.I18n.t('js.label_work_package_details_you_are_here', {\n      tab: this.I18n.t('js.work_packages.tabs.' + tabName),\n      type: this.workPackage.type.name,\n      subject: this.workPackage.subject\n    });\n\n    return this.focusAnchorLabel = tabLabel;\n  }\n\n  public canViewWorkPackageWatchers() {\n    return !!(this.workPackage && this.workPackage.watchers);\n  }\n\n  public get isEditable() {\n    return this.workPackage.isEditable;\n  }\n}\n","import {WorkPackageCacheService} from '../../work-packages/work-package-cache.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageRelationsService} from '../wp-relations.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {ChangeDetectorRef, Component, ElementRef, Input, OnInit, ViewChild} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n\n@Component({\n  selector: 'wp-relation-row',\n  templateUrl: './wp-relation-row.template.html'\n})\nexport class WorkPackageRelationRowComponent extends UntilDestroyedMixin implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public relatedWorkPackage:WorkPackageResource;\n  @Input() public groupByWorkPackageType:boolean;\n\n  @ViewChild('relationDescriptionTextarea') readonly relationDescriptionTextarea:ElementRef;\n\n  public relationType:string;\n  public showRelationInfo:boolean = false;\n  public showEditForm:boolean = false;\n  public availableRelationTypes:{ label:string, name:string }[];\n  public selectedRelationType:{ name:string };\n\n  public userInputs = {\n    newRelationText: '',\n    showDescriptionEditForm: false,\n    showRelationTypesForm: false,\n    showRelationInfo: false,\n  };\n\n  // Create a quasi-field object\n  public fieldController = {\n    handler: {\n      active: true,\n    },\n    required: false\n  };\n\n  public relation:RelationResource;\n  public text = {\n    cancel: this.I18n.t('js.button_cancel'),\n    save: this.I18n.t('js.button_save'),\n    removeButton: this.I18n.t('js.relation_buttons.remove'),\n    description_label: this.I18n.t('js.relation_buttons.update_description'),\n    toggleDescription: this.I18n.t('js.relation_buttons.toggle_description'),\n    updateRelation: this.I18n.t('js.relation_buttons.update_relation'),\n    placeholder: {\n      description: this.I18n.t('js.placeholders.relation_description')\n    }\n  };\n\n  constructor(protected wpCacheService:WorkPackageCacheService,\n              protected notificationService:WorkPackageNotificationService,\n              protected wpRelations:WorkPackageRelationsService,\n              protected halEvents:HalEventsService,\n              protected I18n:I18nService,\n              protected cdRef:ChangeDetectorRef,\n              protected PathHelper:PathHelperService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.relation = this.relatedWorkPackage.relatedBy as RelationResource;\n\n    this.userInputs.newRelationText = this.relation.description || '';\n    this.availableRelationTypes = RelationResource.LOCALIZED_RELATION_TYPES(false);\n    this.selectedRelationType = _.find(this.availableRelationTypes,\n      { 'name': this.relation.normalizedType(this.workPackage) })!;\n\n    this.wpCacheService\n      .observe(this.relatedWorkPackage.id!)\n      .pipe(\n        this.untilDestroyed()\n      ).subscribe((wp) => {\n      this.relatedWorkPackage = wp;\n    });\n  }\n\n  /**\n   * Return the normalized relation type for the work package we're viewing.\n   * That is, normalize `precedes` where the work package is the `to` link.\n   */\n  public get normalizedRelationType() {\n    var type = this.relation.normalizedType(this.workPackage);\n    return this.I18n.t('js.relation_labels.' + type);\n  }\n\n  public get relationReady() {\n    return this.relatedWorkPackage && this.relatedWorkPackage.$loaded;\n  }\n\n  public startDescriptionEdit() {\n    this.userInputs.showDescriptionEditForm = true;\n    setTimeout(() => {\n      const textarea = jQuery(this.relationDescriptionTextarea.nativeElement);\n      const textlen = (textarea.val() as string).length;\n      // Focus and set cursor to end\n      textarea.focus();\n\n      textarea.prop('selectionStart', textlen);\n      textarea.prop('selectionEnd', textlen);\n    });\n  }\n\n  public handleDescriptionKey($event:JQuery.TriggeredEvent) {\n    if ($event.which === 27) {\n      this.cancelDescriptionEdit();\n    }\n  }\n\n  public cancelDescriptionEdit() {\n    this.userInputs.showDescriptionEditForm = false;\n    this.userInputs.newRelationText = this.relation.description || '';\n  }\n\n  public saveDescription() {\n    this.wpRelations.updateRelation(\n      this.relation,\n      { description: this.userInputs.newRelationText })\n      .then((savedRelation:RelationResource) => {\n        this.relation = savedRelation;\n        this.relatedWorkPackage.relatedBy = savedRelation;\n        this.userInputs.showDescriptionEditForm = false;\n        this.notificationService.showSave(this.relatedWorkPackage);\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public get showDescriptionInfo() {\n    return this.userInputs.showRelationInfo || this.relation.description;\n  }\n\n  public activateRelationTypeEdit() {\n    if (this.groupByWorkPackageType) {\n      this.userInputs.showRelationTypesForm = true;\n    }\n  }\n\n  public cancelRelationTypeEditOnEscape(evt:JQuery.TriggeredEvent) {\n    this.userInputs.showRelationTypesForm = false;\n  }\n\n  public saveRelationType() {\n    this.wpRelations.updateRelationType(\n      this.workPackage,\n      this.relatedWorkPackage,\n      this.relation,\n      this.selectedRelationType.name)\n      .then((savedRelation:RelationResource) => {\n        this.notificationService.showSave(this.relatedWorkPackage);\n        this.relatedWorkPackage.relatedBy = savedRelation;\n        this.relation = savedRelation;\n\n        this.userInputs.showRelationTypesForm = false;\n        this.cdRef.detectChanges();\n      })\n      .catch((error:any) => this.notificationService.handleRawError(error, this.workPackage));\n  }\n\n  public toggleUserDescriptionForm() {\n    this.userInputs.showDescriptionEditForm = !this.userInputs.showDescriptionEditForm;\n  }\n\n  public removeRelation() {\n    this.wpRelations.removeRelation(this.relation)\n      .then(() => {\n        this.halEvents.push(this.workPackage, {\n          eventType: 'association',\n          relatedWorkPackage: null,\n          relationType: this.relation.normalizedType(this.workPackage)\n        });\n\n        this.wpCacheService.updateWorkPackage(this.relatedWorkPackage);\n        this.notificationService.showSave(this.relatedWorkPackage);\n      })\n      .catch((err:any) => this.notificationService.handleRawError(err,\n        this.relatedWorkPackage));\n  }\n}\n","<div *ngIf=\"workPackage && relatedWorkPackage\"\n     class=\"relation-row relation-row-{{ relatedWorkPackage.id }}\"\n     focus-within=\"'.wp-relations-controls-section accessible-by-keyboard'\">\n  <div class=\"grid-block hierarchy-item\">\n\n    <div class=\"grid-content medium-2 collapse\">\n            <span class=\"relation-row--type\"\n                  (accessibleClick)=\"activateRelationTypeEdit()\"\n                  tabindex=\"0\"\n                  *ngIf=\"!userInputs.showRelationTypesForm\">\n\n\n              <span *ngIf=\"groupByWorkPackageType\"\n                    [textContent]=\"normalizedRelationType\"></span>\n              <span *ngIf=\"!groupByWorkPackageType\"\n                    [textContent]=\"relatedWorkPackage.type.name\"></span>\n              <span class=\"hidden-for-sighted\" [textContent]=\"text.updateRelation\"></span>\n            </span>\n      <div class=\"inline-edit--container inplace-edit\"\n           *ngIf=\"userInputs.showRelationTypesForm\">\n        <select class=\"inline-edit--field form--select\"\n                [(ngModel)]=\"selectedRelationType\"\n                (change)=\"saveRelationType()\"\n                role=\"listbox\"\n                focus\n                (keydown.escape)=\"cancelRelationTypeEditOnEscape($event)\">\n          <option *ngFor=\"let relationType of availableRelationTypes\"\n                  [textContent]=\"relationType.label\"\n                  [ngValue]=\"relationType\"></option>\n        </select>\n      </div>\n    </div>\n\n    <div class=\"grid-content medium-5 collapse\"\n         *ngIf=\"relatedWorkPackage\">\n      <a uiSref=\"work-packages.show.relations\"\n         [uiParams]=\"{ workPackageId: relatedWorkPackage.id }\"\n         class=\"wp-relations--subject-field\"\n         [textContent]=\"relatedWorkPackage.subjectWithId()\"\n         [attr.aria-label]=\"normalizedRelationType + ' ' + relatedWorkPackage.subjectWithId()\">\n      </a>\n    </div>\n\n    <div class=\"grid-content medium-3 collapse wp-relations-status-field\">\n      <edit-form *ngIf=\"relatedWorkPackage\" [resource]=\"relatedWorkPackage\">\n        <editable-attribute-field [resource]=\"relatedWorkPackage\" fieldName=\"status\"></editable-attribute-field>\n      </edit-form>\n    </div>\n\n    <div class=\"grid-content medium-2 collapse wp-relations-controls-section\"\n         ng-class=\"{'-expanded': userInputs.showRelationInfo }\">\n      <accessible-by-keyboard [linkAriaLabel]=\"text.description_label\"\n                              [linkTitle]=\"text.description_label\"\n                              linkClass=\"wp-relations--description-btn\"\n                              [ngClass]=\"{'-visible': showDescriptionInfo }\"\n                              (execute)=\"userInputs.showRelationInfo = !userInputs.showRelationInfo\">\n        <op-icon icon-classes=\"icon-info1 -padded wp-relations--icon wp-relations--description-icon\"\n                 icon-title=\"text.toggleDescription\"></op-icon>\n      </accessible-by-keyboard>\n      <accessible-by-keyboard *ngIf=\"relation.delete\"\n                              (execute)=\"removeRelation(relation)\"\n                              aria-hidden=\"false\"\n                              [linkAriaLabel]=\"text.removeButton\"\n                              [linkTitle]=\"text.removeButton\"\n                              linkClass=\"relation-row--remove-btn\">\n        <op-icon icon-classes=\"icon-remove -padded wp-relations--icon\" [icon-title]=\"text.removeButton\"></op-icon>\n      </accessible-by-keyboard>\n    </div>\n  </div>\n\n  <div class=\"grid-block hierarchy-item description-container\"\n       *ngIf=\"userInputs.showRelationInfo\">\n    <div class=\"wp-relation--description-read-value\"\n         [ngClass]=\"{'-placeholder': !relation.description }\"\n         (accessibleClick)=\"startDescriptionEdit()\"\n         *ngIf=\"!userInputs.showDescriptionEditForm\"\n         [textContent]=\"relation.description || text.placeholder.description\">\n    </div>\n    <div class=\"wp-relation--description-wrapper textarea-wrapper\"\n         *ngIf=\"userInputs.showDescriptionEditForm\">\n          <textarea\n              #relationDescriptionTextarea\n              autofocus\n              class=\"wp-relation--description-textarea\"\n              name=\"description\"\n              (keyup)=\"handleDescriptionKey($event)\"\n              [(ngModel)]=\"userInputs.newRelationText\"></textarea>\n      <edit-field-controls [fieldController]=\"fieldController\"\n                           (onSave)=\"saveDescription()\"\n                           (onCancel)=\"cancelDescriptionEdit()\"\n                           [saveTitle]=\"text.save\"\n                           [cancelTitle]=\"text.cancel\">\n      </edit-field-controls>\n    </div>\n  </div>\n</div>\n","import {Injectable} from \"@angular/core\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {QueryFormDmService} from \"core-app/modules/hal/dm-services/query-form-dm.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {QueryDmService} from \"core-app/modules/hal/dm-services/query-dm.service\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class BoardListsService {\n\n  private readonly v3 = this.pathHelper.api.v3;\n\n  constructor(private readonly CurrentProject:CurrentProjectService,\n              private readonly pathHelper:PathHelperService,\n              private readonly QueryDm:QueryDmService,\n              private readonly halResourceService:HalResourceService,\n              private readonly QueryFormDm:QueryFormDmService,\n              private readonly notifications:NotificationsService,\n              private readonly I18n:I18nService) {\n\n  }\n\n  private create(params:Object, filters:ApiV3Filter[]):Promise<QueryResource> {\n    let filterJson = JSON.stringify(filters);\n\n    return this.QueryFormDm\n      .loadWithParams(\n        {\n          pageSize: 0,\n          filters: filterJson\n        },\n        undefined,\n        this.CurrentProject.identifier,\n        this.buildQueryRequest(params),\n      )\n      .then(form => {\n        // When the permission to create public queries is missing, throw an error.\n        // Otherwise private queries would be created.\n        if (form.schema['public'].writable) {\n          const query = this.QueryFormDm.buildQueryResource(form);\n          return this.QueryDm.create(query, form);\n        } else {\n          throw new Error(this.I18n.t('js.boards.error_permission_missing'));\n        }\n      });\n  }\n\n  /**\n   * Add a free query to the board\n   */\n  public addFreeQuery(board:Board, queryParams:Object) {\n    const filter = this.freeBoardQueryFilter();\n    return this.addQuery(board, queryParams, [filter]);\n  }\n\n  /**\n   * Add an empty query to the board\n   * @param board\n   * @param query\n   */\n  public async addQuery(board:Board, queryParams:Object, filters:ApiV3Filter[]):Promise<Board> {\n    const count = board.queries.length;\n    try {\n      const query = await this.create(queryParams, filters);\n\n      let source = {\n        _type: 'GridWidget',\n        identifier: 'work_package_query',\n        startRow: 1,\n        endRow: 2,\n        startColumn: count + 1,\n        endColumn: count + 2,\n        options: {\n          queryId: query.id,\n          filters: filters,\n        }\n      };\n\n      let resource = this.halResourceService.createHalResourceOfClass(GridWidgetResource, source);\n      board.addQuery(resource);\n    } catch (e) {\n      this.notifications.addError(e);\n      console.error(e);\n    }\n    return board;\n  }\n\n  private buildQueryRequest(params:Object) {\n    return {\n      hidden: true,\n      public: true,\n      \"_links\": {\n        \"sortBy\": [\n          { \"href\": this.v3.resource(\"/queries/sort_bys/manualSorting-asc\") },\n          { \"href\": this.v3.resource(\"/queries/sort_bys/id-asc\") },\n        ]\n      },\n      ...params\n    };\n  }\n\n  private freeBoardQueryFilter():ApiV3Filter {\n    return { manualSort: { operator: 'ow', values: [] } };\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++    Ng1FieldControlsWrapper,\n\nimport {Component, ElementRef} from \"@angular/core\";\nimport {WorkPackageTableConfigurationObject} from \"core-components/wp-table/wp-table-configuration\";\n\nexport const wpEmbeddedTableMacroSelector = 'macro.embedded-table';\n\n@Component({\n  selector: wpEmbeddedTableMacroSelector,\n  template: `\n    <wp-embedded-table-entry [queryProps]=\"queryProps\"\n                             [configuration]=\"configuration\">\n    </wp-embedded-table-entry>\n  `\n})\nexport class EmbeddedTablesMacroComponent {\n  // noinspection JSUnusedGlobalSymbols\n  public queryProps:any;\n  public configuration:WorkPackageTableConfigurationObject = {\n    actionsColumnEnabled: false,\n    columnMenuEnabled: false,\n    contextMenuEnabled: false\n  };\n\n  constructor(readonly elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    const element = this.elementRef.nativeElement;\n    this.queryProps = JSON.parse(element.dataset.queryProps);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class CurrentProjectService {\n  private current:{ id:string, identifier:string, name:string };\n\n  constructor(private PathHelper:PathHelperService) {\n    this.detect();\n  }\n\n  public get inProjectContext():boolean {\n    return this.current !== undefined;\n  }\n\n  public get path():string|null {\n    if (this.current) {\n      return this.PathHelper.projectPath(this.current.identifier);\n    }\n\n    return null;\n  }\n\n  public get apiv3Path():string|null {\n    if (this.current) {\n      return this.PathHelper.api.v3.projects.id(this.current.id).toString();\n    }\n\n    return null;\n  }\n\n  public get id():string|null {\n    return this.getCurrent('id');\n  }\n\n  public get name():string|null {\n    return this.getCurrent('name');\n  }\n\n  public get identifier():string|null {\n    return this.getCurrent('identifier');\n  }\n\n  private getCurrent(key:'id'|'identifier'|'name') {\n    if (this.current && this.current[key]) {\n      return this.current[key].toString();\n    }\n\n    return null;\n  }\n\n  /**\n   * Detect the current project from its meta tag.\n   */\n  public detect() {\n    const element:HTMLMetaElement|null = document.querySelector('meta[name=current_project]');\n    if (element) {\n      this.current = {\n        id: element.dataset.projectId!,\n        name: element.dataset.projectName!,\n        identifier: element.dataset.projectIdentifier!\n      };\n    }\n  }\n}\n","import {\n  contextColumnIcon,\n  OpTableAction,\n  OpTableActionFactory,\n} from 'core-components/wp-table/table-actions/table-action';\nimport {opIconElement} from 'core-app/helpers/op-icon-builder';\nimport {Injector} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\n\nexport class OpUnlinkTableAction extends OpTableAction {\n\n  constructor(public injector:Injector,\n              public workPackage:WorkPackageResource,\n              public readonly identifier:string,\n              private title:string,\n              readonly applicable:(workPackage:WorkPackageResource) => boolean,\n              readonly onClick:(workPackage:WorkPackageResource) => void) {\n    super(injector, workPackage);\n\n  }\n\n  /**\n   *  Returns a factory for this action with the given title and identifier for reusing\n   *  remove actions.\n   *\n   * @param {string} identifier\n   * @param {string} title\n   */\n  public static factoryFor(identifier:string,\n                           title:string,\n                           onClick:(workPackage:WorkPackageResource) => void,\n                           applicable:(workPackage:WorkPackageResource) => boolean = () => true):OpTableActionFactory {\n    return (injector:Injector, workPackage:WorkPackageResource) => {\n      return new OpUnlinkTableAction(injector,\n        workPackage,\n        identifier,\n        title,\n        applicable,\n        onClick) as OpTableAction;\n    };\n  }\n\n  public buildElement() {\n    if (!this.applicable(this.workPackage)) {\n      return null;\n    }\n\n    let element = document.createElement('a');\n    element.title = this.title;\n    element.href = '#';\n    element.classList.add(contextColumnIcon, 'wp-table-action--unlink');\n    element.dataset.workPackageId = this.workPackage.id!;\n    element.appendChild(opIconElement('icon', 'icon-close'));\n    jQuery(element).click((event) => {\n      event.preventDefault();\n      this.onClick(this.workPackage);\n    });\n\n    return element;\n  }\n}\n","import {\n  ApplicationRef,\n  ChangeDetectorRef,\n  Component,\n  ComponentFactoryResolver,\n  ElementRef,\n  EventEmitter,\n  Inject,\n  InjectionToken,\n  Injector,\n  OnDestroy,\n  OnInit,\n  Optional,\n  ViewChild\n} from '@angular/core';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {WorkPackageViewColumnsService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-columns.service';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {WpTableConfigurationService} from 'core-components/wp-table/configuration-modal/wp-table-configuration.service';\nimport {\n  ActiveTabInterface,\n  TabComponent,\n  TabInterface,\n  TabPortalOutlet\n} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {QueryFormDmService} from 'core-app/modules/hal/dm-services/query-form-dm.service';\nimport {WorkPackageStatesInitializationService} from 'core-components/wp-list/wp-states-initialization.service';\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {QueryFormResource} from 'core-app/modules/hal/resources/query-form-resource';\nimport {LoadingIndicatorService} from 'core-app/modules/common/loading-indicator/loading-indicator.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\nexport const WpTableConfigurationModalPrependToken = new InjectionToken<ComponentType<any>>('WpTableConfigurationModalPrependComponent');\n\n@Component({\n  templateUrl: './wp-table-configuration.modal.html'\n})\nexport class WpTableConfigurationModalComponent extends OpModalComponent implements OnInit, OnDestroy  {\n\n  /* Close on escape? */\n  public closeOnEscape = false;\n\n  /* Close on outside click */\n  public closeOnOutsideClick = false;\n\n  public $element:JQuery;\n\n  public text = {\n    title: this.I18n.t('js.work_packages.table_configuration.modal_title'),\n    closePopup: this.I18n.t('js.close_popup_title'),\n\n    columnsLabel: this.I18n.t('js.label_columns'),\n    selectedColumns: this.I18n.t('js.description_selected_columns'),\n    multiSelectLabel: this.I18n.t('js.work_packages.label_column_multiselect'),\n    applyButton: this.I18n.t('js.modals.button_apply'),\n    cancelButton: this.I18n.t('js.modals.button_cancel'),\n\n    upsaleRelationColumns: this.I18n.t('js.modals.upsale_relation_columns'),\n    upsaleRelationColumnsLink: this.I18n.t('js.modals.upsale_relation_columns_link')\n  };\n\n  public onDataUpdated = new EventEmitter<void>();\n  public selectedColumnMap:{ [id:string]:boolean } = {};\n\n  // Get the view child we'll use as the portal host\n  @ViewChild('tabContentOutlet', { static: true }) tabContentOutlet:ElementRef;\n  // And a reference to the actual portal host interface\n  public tabPortalHost:TabPortalOutlet;\n\n  // Try to load an optional provided configuration service, and fall back to the default one\n  private wpTableConfigurationService:WpTableConfigurationService =\n    this.injector.get(WpTableConfigurationService, new WpTableConfigurationService(this.I18n));\n\n  constructor(@Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              @Optional() @Inject(WpTableConfigurationModalPrependToken) public prependModalComponent:ComponentType<any>|null,\n              readonly I18n:I18nService,\n              readonly injector:Injector,\n              readonly appRef:ApplicationRef,\n              readonly componentFactoryResolver:ComponentFactoryResolver,\n              readonly loadingIndicator:LoadingIndicatorService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly queryFormDm:QueryFormDmService,\n              readonly wpStatesInitialization:WorkPackageStatesInitializationService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly wpTableColumns:WorkPackageViewColumnsService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly ConfigurationService:ConfigurationService,\n              readonly elementRef:ElementRef) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.tabPortalHost = new TabPortalOutlet(\n      this.wpTableConfigurationService.tabs,\n      this.tabContentOutlet.nativeElement,\n      this.componentFactoryResolver,\n      this.appRef,\n      this.injector\n    );\n\n    this.loadingIndicator.indicator('modal').promise = this.loadForm()\n      .then(() => {\n        const initialTab = this.locals['initialTab'] || this.availableTabs[0].name;\n        this.switchTo(initialTab);\n      });\n  }\n\n  ngOnDestroy() {\n    this.onDataUpdated.complete();\n    this.tabPortalHost.dispose();\n  }\n\n  public get availableTabs():TabInterface[] {\n    return this.tabPortalHost.availableTabs;\n  }\n\n  public get currentTab():ActiveTabInterface|null {\n    return this.tabPortalHost.currentTab;\n  }\n\n  public switchTo(name:string) {\n    this.tabPortalHost.switchTo(name);\n  }\n\n  public saveChanges():void {\n    this.tabPortalHost.activeComponents.forEach((component:TabComponent) => {\n      component.onSave();\n    });\n\n    this.onDataUpdated.emit();\n    this.service.close();\n  }\n\n  /**\n   * Called when the user attempts to close the modal window.\n   * The service will close this modal if this method returns true\n   * @returns {boolean}\n   */\n  public onClose():boolean {\n    this.afterFocusOn.focus();\n    return true;\n  }\n\n  protected get afterFocusOn():JQuery {\n    return this.$element;\n  }\n\n  protected loadForm() {\n    const query = this.querySpace.query.value!;\n    return this.queryFormDm\n      .load(query)\n      .then((form:QueryFormResource) => {\n          this.wpStatesInitialization.updateStatesFromForm(query, form);\n\n          return form;\n        })\n      .catch((error) => this.notificationService.handleRawError(error));\n  }\n}\n","<div class=\"op-modal--portal \">\n  <div class=\"op-modal--modal-container -wide wp-table--configuration-modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 [textContent]=\"text.title\"></h3>\n\n      <a class=\"op-modal--modal-close-button\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.closePopup\">\n        </i>\n      </a>\n    </div>\n\n    <ng-container *ngIf=\"!!prependModalComponent\">\n      <ng-container *ngComponentOutlet=\"prependModalComponent; injector: injector\"></ng-container>\n    </ng-container>\n\n    <div *ngIf=\"!!tabPortalHost\"\n         class=\"content--tabs scrollable-tabs\">\n      <ul class=\"tabrow\">\n        <li *ngFor=\"let tab of availableTabs\"\n            [ngClass]=\"{ 'selected': currentTab && tab.name === currentTab.name, '-disabled': tab.disableBecause != null }\">\n          <a class=\"tab-show\"\n             role=\"button\"\n             [ngClass]=\"{ 'selected': currentTab && tab.name === currentTab.name }\"\n             [attr.title]=\"tab.disableBecause || tab.title\"\n             [textContent]=\"tab.title\"\n             (click)=\"switchTo(tab.name)\"\n             href>\n          </a>\n      </ul>\n    </div>\n\n    <div class=\"tab-content\" #tabContentOutlet></div>\n    <div class=\"modal--form-actions\">\n      <button class=\"button -highlight\"\n              [textContent]=\"text.applyButton\"\n              (click)=\"saveChanges()\">\n      </button>\n      <button class=\"button\"\n              [textContent]=\"text.cancelButton\"\n              (click)=\"closeMe($event)\">\n      </button>\n    </div>\n  </div>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Input, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {UrlParamsHelperService} from 'core-components/wp-query/url-params-helper';\nimport {WorkPackageRelationsHierarchyService} from 'core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service';\nimport {OpUnlinkTableAction} from 'core-components/wp-table/table-actions/actions/unlink-table-action';\nimport {OpTableActionFactory} from 'core-components/wp-table/table-actions/table-action';\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {WorkPackageRelationQueryBase} from \"core-components/wp-relations/embedded/wp-relation-query.base\";\nimport {WpChildrenInlineCreateService} from \"core-components/wp-relations/embedded/children/wp-children-inline-create.service\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {filter} from \"rxjs/operators\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {GroupDescriptor} from \"core-components/work-packages/wp-single-view/wp-single-view.component\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\n\n@Component({\n  selector: 'wp-children-query',\n  templateUrl: '../wp-relation-query.html',\n  providers: [\n    { provide: WorkPackageInlineCreateService, useClass: WpChildrenInlineCreateService }\n  ]\n})\nexport class WorkPackageChildrenQueryComponent extends WorkPackageRelationQueryBase implements OnInit {\n  @Input() public workPackage:WorkPackageResource;\n  @Input() public query:QueryResource;\n\n  /** An optional group descriptor if we're rendering on the single view */\n  @Input() public group?:GroupDescriptor;\n  @Input() public addExistingChildEnabled:boolean = false;\n\n  public tableActions:OpTableActionFactory[] = [\n    OpUnlinkTableAction.factoryFor(\n      'remove-child-action',\n      this.I18n.t('js.relation_buttons.remove_child'),\n      (child:WorkPackageResource) => {\n        this.embeddedTable.loadingIndicator = this.wpRelationsHierarchyService.removeChild(child);\n      },\n      (child:WorkPackageResource) => !!child.changeParent\n    )\n  ];\n\n  constructor(protected wpRelationsHierarchyService:WorkPackageRelationsHierarchyService,\n              protected PathHelper:PathHelperService,\n              protected wpInlineCreate:WorkPackageInlineCreateService,\n              protected halEvents:HalEventsService,\n              protected wpCacheService:WorkPackageCacheService,\n              protected queryUrlParamsHelper:UrlParamsHelperService,\n              readonly I18n:I18nService) {\n    super(queryUrlParamsHelper);\n  }\n\n  ngOnInit() {\n    // Set reference target and reference class\n    this.wpInlineCreate.referenceTarget = this.workPackage;\n\n    // Set up the query props\n    this.queryProps = this.buildQueryProps();\n\n    // Fire event that children were added\n    this.wpInlineCreate.newInlineWorkPackageCreated\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((toId:string) => {\n        this.halEvents.push(this.workPackage, {\n          eventType: 'association',\n          relatedWorkPackage: toId,\n          relationType: 'child'\n        });\n      });\n\n    // Refresh table when work package is refreshed\n    this.wpCacheService\n      .observe(this.workPackage.id!)\n      .pipe(\n        filter(() => this.embeddedTable && this.embeddedTable.isInitialized),\n        this.untilDestroyed()\n      )\n      .subscribe(() => this.refreshTable());\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {StateService} from '@uirouter/core';\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {Directive, ElementRef, Input} from \"@angular/core\";\nimport {OpContextMenuTrigger} from \"core-components/op-context-menu/handlers/op-context-menu-trigger.directive\";\n\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Directive({\n  selector: '[wpStatusDropdown]'\n})\nexport class WorkPackageStatusDropdownDirective extends OpContextMenuTrigger {\n  @Input('wpStatusDropdown-workPackage') public workPackage:WorkPackageResource;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly $state:StateService,\n              protected workPackageNotificationService:WorkPackageNotificationService,\n              protected halEditing:HalResourceEditingService,\n              protected notificationService:NotificationsService,\n              protected I18n:I18nService,\n              protected halEvents:HalEventsService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    const change = this.halEditing.changeFor(this.workPackage);\n\n    change.getForm().then((form:any) => {\n      const statuses = form.schema.status.allowedValues;\n      this.buildItems(statuses);\n\n      const writable = change.schema.status.writable;\n      if (!writable) {\n        this.notificationService.addError(this.I18n.t('js.work_packages.message_work_package_status_blocked'));\n      } else {\n        this.opContextMenu.show(this, evt);\n      }\n    });\n  }\n\n  public get locals() {\n    return {\n      items: this.items,\n      contextMenuId: 'wp-status-context-menu'\n    };\n  }\n\n  private updateStatus(status:HalResource) {\n    const change = this.halEditing.changeFor(this.workPackage);\n    change.projectedResource.status = status;\n\n    if (!this.workPackage.isNew) {\n      this.halEditing\n        .save(change)\n        .then(() => {\n          this.workPackageNotificationService.showSave(this.workPackage);\n        });\n    }\n  }\n\n  private buildItems(statuses:CollectionResource<HalResource>) {\n    this.items = statuses.map((status:HalResource) => {\n      return {\n        disabled: false,\n        linkText: status.name,\n        postIcon: status.isReadonly ? 'icon-locked' : null,\n        postIconTitle: this.I18n.t('js.work_packages.message_work_package_read_only'),\n        class: Highlighting.inlineClass('status', status.id!),\n        onClick: () => {\n          this.updateStatus(status);\n          return true;\n        }\n      };\n    });\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, ChangeDetectorRef, Component, EventEmitter, Input, Output, ViewChild} from '@angular/core';\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {AddTagFn} from \"@ng-select/ng-select/lib/ng-select.component\";\nimport {Subject} from 'rxjs';\n\nexport interface CreateAutocompleterValueOption {\n  name:string;\n  $href:string|null;\n}\n\n@Component({\n  templateUrl: './create-autocompleter.component.html',\n  selector: 'create-autocompleter'\n})\nexport class CreateAutocompleterComponent implements AfterViewInit {\n  @Input() public availableValues:CreateAutocompleterValueOption[];\n  @Input() public appendTo:string;\n  @Input() public model:any;\n  @Input() public required:boolean = false;\n  @Input() public disabled:boolean = false;\n  @Input() public finishedLoading:boolean = false;\n  @Input() public id:string = '';\n  @Input() public classes:string = '';\n  @Input() public typeahead?:Subject<string>;\n  @Input() public hideSelected:boolean = false;\n\n  @Output() public onChange = new EventEmitter<HalResource>();\n  @Output() public onKeydown = new EventEmitter<JQuery.TriggeredEvent>();\n  @Output() public onOpen = new EventEmitter<void>();\n  @Output() public onClose = new EventEmitter<void>();\n  @Output() public onAfterViewInit = new EventEmitter<this>();\n\n\n  @ViewChild('ngSelectComponent') public ngSelectComponent:NgSelectComponent;\n\n  public text:{ [key:string]:string } = {\n    add_new_action: this.I18n.t('js.label_create'),\n  };\n\n  public createAllowed:boolean|AddTagFn = false;\n\n  private _openDirectly:boolean = false;\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly currentProject:CurrentProjectService,\n              readonly pathHelper:PathHelperService) {\n  }\n\n  ngAfterViewInit() {\n    this.onAfterViewInit.emit(this);\n  }\n\n  public openSelect() {\n    if (this.ngSelectComponent) {\n      this.ngSelectComponent.open();\n    } else {\n      // In case the autocompleter was not loaded,\n      // do not reset the variable\n      return;\n    }\n\n    this.openDirectly = false;\n  }\n\n  public closeSelect() {\n    this.ngSelectComponent && this.ngSelectComponent.close();\n  }\n\n  public changeModel(element:HalResource) {\n    this.onChange.emit(element);\n  }\n\n  public opened() {\n    // Force reposition as a workaround for BUG\n    // https://github.com/ng-select/ng-select/issues/1259\n    setTimeout(() => {\n      const component = this.ngSelectComponent as any;\n      if (component && component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n    }, 25);\n\n    this.onOpen.emit();\n  }\n\n  public closed() {\n    this.openDirectly = false;\n    this.onClose.emit();\n  }\n\n  public keyPressed(event:JQuery.TriggeredEvent) {\n    this.onKeydown.emit(event);\n  }\n\n  public get openDirectly() {\n    return this._openDirectly;\n  }\n\n  public set openDirectly(val:boolean) {\n    this._openDirectly = val;\n    if (val) {\n      this.openSelect();\n    }\n  }\n\n  public focusInputField() {\n    this.ngSelectComponent && this.ngSelectComponent.focus();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {Inject, Injectable, Injector} from \"@angular/core\";\nimport {DOCUMENT} from \"@angular/common\";\nimport {DynamicContentModal} from \"core-components/modals/modal-wrapper/dynamic-content.modal\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\n\nconst iframeSelector = '.iframe-target-wrapper';\n\n@Injectable({ providedIn: 'root' })\nexport class ModalWrapperAugmentService {\n\n  constructor(@Inject(DOCUMENT) protected documentElement:Document,\n              protected injector:Injector,\n              protected opModalService:OpModalService) {\n  }\n\n  /**\n   * Create initial listeners for Rails-rendered modals\n   */\n  public setupListener() {\n    const matches = this.documentElement.querySelectorAll('section[data-augmented-model-wrapper]');\n    for (let i = 0; i < matches.length; ++i) {\n      this.wrapElement(jQuery(matches[i]) as JQuery);\n    }\n  }\n\n  /**\n   * Wrap a section[data-augmented-modal-wrapper] element\n   */\n  public wrapElement(element:JQuery) {\n    // Find activation link\n    let activationLink = element.find('.modal-wrapper--activation-link');\n    let activationSelector = element.data('activationSelector');\n\n    if (activationSelector) {\n      activationLink = jQuery(activationSelector);\n    }\n\n    const initializeNow = element.data('modalInitializeNow');\n\n    if (initializeNow) {\n      this.show(element);\n    } else {\n      activationLink.click((evt:JQuery.TriggeredEvent) => {\n        this.show(element);\n        evt.preventDefault();\n      });\n    }\n  }\n\n  private show(element:JQuery) {\n    // Set modal class name\n    const modalClassName = element.data('modalClassName');\n    // Append CSP-whitelisted IFrame for onboarding\n    const iframeUrl = element.data('modalIframeUrl');\n\n    // Set template from wrapped element\n    const wrappedElement = element.find('.modal-wrapper--content');\n    let modalBody = wrappedElement.html();\n\n    if (iframeUrl) {\n      modalBody = this.appendIframe(modalBody, iframeUrl);\n    }\n\n    this.opModalService.show(\n      DynamicContentModal,\n      this.injector,\n      {\n        modalBody: modalBody,\n        modalClassName: modalClassName\n      }\n    );\n  }\n\n  private appendIframe(body:string, url:string) {\n    let subdom = jQuery(body);\n    let iframe = jQuery('<iframe frameborder=\"0\" height=\"400\" allowfullscreen>></iframe>');\n    iframe.attr('src', url);\n\n    subdom.find(iframeSelector).append(iframe);\n\n    return subdom.html();\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WpTableConfigurationDisplaySettingsTab} from 'core-components/wp-table/configuration-modal/tabs/display-settings-tab.component';\nimport {TabInterface} from \"core-components/wp-table/configuration-modal/tab-portal-outlet\";\nimport {WpTableConfigurationColumnsTab} from \"core-components/wp-table/configuration-modal/tabs/columns-tab.component\";\nimport {WpTableConfigurationFiltersTab} from \"core-components/wp-table/configuration-modal/tabs/filters-tab.component\";\nimport {WpTableConfigurationSortByTab} from \"core-components/wp-table/configuration-modal/tabs/sort-by-tab.component\";\nimport {WpTableConfigurationTimelinesTab} from \"core-components/wp-table/configuration-modal/tabs/timelines-tab.component\";\nimport {WpTableConfigurationHighlightingTab} from \"core-components/wp-table/configuration-modal/tabs/highlighting-tab.component\";\n\n@Injectable()\nexport class WpTableConfigurationService {\n\n  protected _tabs:TabInterface[] = [\n    {\n      name: 'columns',\n      title: this.I18n.t('js.label_columns'),\n      componentClass: WpTableConfigurationColumnsTab,\n    },\n    {\n      name: 'filters',\n      title: this.I18n.t('js.work_packages.query.filters'),\n      componentClass: WpTableConfigurationFiltersTab,\n    },\n    {\n      name: 'sort-by',\n      title: this.I18n.t('js.label_sort_by'),\n      componentClass: WpTableConfigurationSortByTab,\n    },\n    {\n      name: 'display-settings',\n      title: this.I18n.t('js.work_packages.table_configuration.display_settings'),\n      componentClass: WpTableConfigurationDisplaySettingsTab,\n    },\n    {\n      name: 'highlighting',\n      title: this.I18n.t('js.work_packages.table_configuration.highlighting'),\n      componentClass: WpTableConfigurationHighlightingTab,\n    },\n    {\n      name: 'timelines',\n      title: this.I18n.t('js.timelines.gantt_chart'),\n      componentClass: WpTableConfigurationTimelinesTab\n    }\n  ];\n\n  constructor(readonly I18n:I18nService) {\n  }\n\n  public get tabs() {\n    return this._tabs;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {BehaviorSubject} from 'rxjs';\nimport {auditTime} from 'rxjs/operators';\nimport {Directive, ElementRef, Input, OnInit} from \"@angular/core\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n// with courtesy of http://stackoverflow.com/a/29722694/3206935\n\n@Directive({\n  selector: '[focus-within]'\n})\nexport class FocusWithinDirective extends UntilDestroyedMixin implements OnInit {\n  @Input() public selector:string;\n\n  constructor(readonly elementRef:ElementRef) {\n    super();\n  }\n\n\n  ngOnInit() {\n    let element = jQuery(this.elementRef.nativeElement);\n    let focusedObservable = new BehaviorSubject(false);\n\n    focusedObservable\n      .pipe(\n        this.untilDestroyed(),\n        auditTime(50)\n      )\n      .subscribe(focused => {\n        element.toggleClass('-focus', focused);\n      });\n\n\n    let focusListener = function () {\n      focusedObservable.next(true);\n    };\n    element[0].addEventListener('focus', focusListener, true);\n\n    let blurListener = function () {\n      focusedObservable.next(false);\n    };\n    element[0].addEventListener('blur', blurListener, true);\n\n    setTimeout(() => {\n      element.addClass('focus-within--trigger');\n      element.find(this.selector).addClass('focus-within--depending');\n    }, 0);\n  }\n}\n","import {Inject, Injectable, Injector, OnDestroy} from \"@angular/core\";\nimport {DOCUMENT} from \"@angular/common\";\nimport {DomAutoscrollService} from \"core-app/modules/common/drag-and-drop/dom-autoscroll.service\";\nimport {DragAndDropHelpers} from \"core-app/modules/common/drag-and-drop/drag-and-drop.helpers\";\n\nexport interface DragMember {\n  dragContainer:HTMLElement;\n  scrollContainers:HTMLElement[];\n  /** Whether this element moves */\n  moves:(element:HTMLElement, fromContainer:HTMLElement, handle:HTMLElement, sibling?:HTMLElement|null) => boolean;\n  /** Move element in container */\n  onMoved:(element:HTMLElement, target:any, source:HTMLElement, sibling:HTMLElement|null) => void;\n  /** Add element to this container */\n  onAdded:(element:HTMLElement, target:any, source:HTMLElement, sibling:HTMLElement|null) => Promise<boolean>;\n  /** Remove element from this container */\n  onRemoved:(element:HTMLElement, target:any, source:HTMLElement, sibling:HTMLElement|null) => void;\n\n  /** Move this container accepts elements */\n  accepts?:(row:HTMLElement, container:any) => boolean;\n\n  /** Callback when the element got cloned */\n  onCloned?:(clone:HTMLElement, original:HTMLElement) => void;\n\n  /** Callback when the shadow element got inserted into a container */\n  onShadowInserted?:(row:HTMLElement) => void;\n\n  /** Callback when the shadow element got inserted into a container */\n  onCancel?:(element:HTMLElement) => void;\n}\n\n@Injectable()\nexport class DragAndDropService implements OnDestroy {\n\n  public drake:dragula.Drake|null = null;\n\n  public members:DragMember[] = [];\n\n  private autoscroll:any;\n\n  private escapeListener = (evt:KeyboardEvent) => {\n    if (this.drake && evt.key === 'Escape') {\n      this.drake.cancel(true);\n    }\n  };\n\n  constructor(@Inject(DOCUMENT) private document:Document,\n              readonly injector:Injector) {\n    this.document.documentElement.addEventListener('keydown', this.escapeListener);\n  }\n\n  ngOnDestroy():void {\n    this.document.documentElement.removeEventListener('keydown', this.escapeListener);\n    this.autoscroll && this.autoscroll.destroy();\n    this.drake && this.drake.destroy();\n  }\n\n  public remove(container:HTMLElement) {\n    if (this.initialized) {\n      _.remove(this.drake!.containers, (el) => el === container);\n      _.remove(this.members, (el) => el.dragContainer === container);\n    }\n  }\n\n  public member(container:HTMLElement):DragMember|undefined {\n    return _.find(this.members, el => el.dragContainer === container);\n  }\n\n  public get initialized() {\n    return this.drake !== null;\n  }\n\n  public register(member:DragMember) {\n    this.members.push(member);\n    const dragContainer = member.dragContainer;\n\n    if (this.autoscroll) {\n      this.autoscroll.add(dragContainer);\n    } else {\n      this.setupAutoscroll([dragContainer]);\n    }\n\n    if (this.drake === null) {\n      this.initializeDrake([dragContainer]);\n    } else {\n      this.drake.containers.push(dragContainer);\n    }\n  }\n\n  public addScrollContainer(el:Element) {\n    if (this.autoscroll) {\n      this.autoscroll.add(el);\n    } else {\n      this.setupAutoscroll([el]);\n    }\n    this.autoscroll.setOuterScrollContainer(el);\n  }\n\n  protected setupAutoscroll(containers:Element[]) {\n    // Setup autoscroll\n    this.autoscroll = new DomAutoscrollService(\n      containers,\n      {\n        margin: 100,\n        maxSpeed: 10,\n        scrollWhenOutside: true,\n        autoScroll: () => this.drake && this.drake.dragging\n      });\n  }\n\n  /**\n   * Retrieve a member from the container, if one exists.\n   * @param container\n   */\n  protected getMember(container:Element):DragMember|undefined {\n    return this.members.find(member => member.dragContainer === container);\n  }\n\n  protected initializeDrake(containers:Element[]) {\n    this.drake = dragula(containers, {\n      moves: (el:any, container:any, handle:any, sibling:any) => {\n        const member = this.getMember(container);\n        return member ? member.moves(el, container, handle, sibling) : false;\n      },\n      accepts: (el:any, container:any) => {\n        const member = this.getMember(container);\n        return (member && member.accepts) ? member.accepts(el, container) : true;\n      },\n      invalid: () => false,\n      direction: 'vertical',             // Y axis is considered when determining where an element would be dropped\n      copy: false,                       // elements are moved by default, not copied\n      revertOnSpill: true,               // spilling will put the element back where it was dragged from, if this is true\n      removeOnSpill: false,              // spilling will `.remove` the element, if this is true\n      mirrorContainer: document.body,    // set the element that gets mirror elements appended\n      ignoreInputTextSelection: true     // allows users to select input text, see details below\n    });\n\n    this.drake.on('drag', (el:HTMLElement, source:HTMLElement) => {\n      el.dataset.sourceIndex = DragAndDropHelpers.findIndex(el).toString();\n    });\n\n    this.drake.on('over', (el:HTMLElement, container:HTMLElement) => {\n      const zone = container.closest('.drop-zone');\n      if (zone) {\n        zone.classList.add('-dragged-over');\n      }\n    });\n\n    this.drake.on('out', (el:HTMLElement, container:HTMLElement) => {\n      const zone = container.closest('.drop-zone');\n      if (zone) {\n        zone.classList.remove('-dragged-over');\n      }\n    });\n\n    this.drake.on('cloned', (clone:HTMLElement, original:HTMLElement) => {\n      const member = this.member(original.parentElement!);\n      if (member && member.onCloned) {\n        member.onCloned(clone, original);\n      }\n    });\n\n    this.drake.on('drop', async (el:HTMLElement, target:HTMLElement, source:HTMLElement, sibling:HTMLElement) => {\n      try {\n        await this.handleDrop(el, target, source, sibling);\n      } catch (e) {\n        console.error(\"Failed to handle drop of %O, %O\", el, e);\n      }\n    });\n\n    this.drake.on('shadow', (shadowElement:HTMLElement, container:HTMLElement) => {\n      const member = this.member(container);\n      if (member && member.onShadowInserted) {\n        member.onShadowInserted(shadowElement);\n      }\n    });\n\n    this.drake.on('cancel', (el:HTMLElement, container:HTMLElement, source:HTMLElement) => {\n      const member = this.member(container);\n      if (member && member.onCancel) {\n        member.onCancel(el);\n      }\n    });\n  }\n\n  private async handleDrop(el:HTMLElement, target:HTMLElement, source:HTMLElement, sibling:HTMLElement|null) {\n    const to = this.member(target);\n    const from = this.member(source);\n\n    if (!(to && from)) {\n      return;\n    }\n\n    if (to === from) {\n      return to.onMoved(el, target, source, sibling);\n    }\n\n    const result = await to.onAdded(el, target, source, sibling);\n\n    if (result) {\n      from.onRemoved(el, target, source, sibling);\n    } else {\n      // Restore element in from container\n      DragAndDropHelpers.reinsert(el, el.dataset.sourceIndex || -1, source);\n    }\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {WorkPackagesListService} from '../../wp-list/wp-list.service';\nimport {States} from '../../states.service';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {ChangeDetectorRef, Component, ElementRef, Inject, OnInit} from \"@angular/core\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {QuerySharingChange} from \"core-components/modals/share-modal/query-sharing-form.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\n\n@Component({\n  templateUrl: './query-sharing.modal.html'\n})\nexport class QuerySharingModal extends OpModalComponent implements OnInit {\n  public query:QueryResource;\n  public isStarred = false;\n  public isPublic = false;\n  public isBusy = false;\n\n  public text = {\n    title: this.I18n.t('js.modals.form_submit.title'),\n    text: this.I18n.t('js.modals.form_submit.text'),\n    save_as: this.I18n.t('js.label_save_as'),\n    label_name: this.I18n.t('js.modals.label_name'),\n    label_visibility_settings: this.I18n.t('js.label_visibility_settings'),\n    button_save: this.I18n.t('js.modals.button_save'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly states:States,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly cdRef:ChangeDetectorRef,\n              readonly wpListService:WorkPackagesListService,\n              readonly halNotification:HalResourceNotificationService,\n              readonly notificationsService:NotificationsService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.query = this.querySpace.query.value!;\n\n    this.isStarred = this.query.starred;\n    this.isPublic = this.query.public;\n  }\n\n\n  public setValues(change:QuerySharingChange) {\n    this.isStarred = change.isStarred;\n    this.isPublic = change.isPublic;\n  }\n\n  public get afterFocusOn() {\n    return jQuery('#work-packages-settings-button');\n  }\n\n  public saveQuery($event:JQuery.TriggeredEvent) {\n    if (this.isBusy) {\n      return;\n    }\n\n    this.isBusy = true;\n    let promises = [];\n\n    if (this.query.public !== this.isPublic) {\n      this.query.public = this.isPublic;\n\n      promises.push(this.wpListService.save(this.query));\n    }\n\n    if (this.query.starred !== this.isStarred) {\n      promises.push(this.wpListService.toggleStarred(this.query));\n    }\n\n    Promise\n      .all(promises)\n      .then(() => {\n        this.closeMe($event);\n        this.isBusy = false;\n      })\n      .catch(() => {\n        this.notificationsService.addError(this.I18n.t('js.errors.query_saving'));\n        this.isBusy = false;\n      });\n  }\n}\n","<div class=\"op-modal--portal \">\n  <div class=\"op-modal--modal-container wp-table--configuration-modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 [textContent]=\"text.label_visibility_settings\"></h3>\n\n      <a class=\"op-modal--modal-close-button\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n    </div>\n\n    <query-sharing-form\n        [isSave]=\"false\"\n        (onChange)=\"setValues($event)\"\n        [isStarred]=\"isStarred\"\n        [isPublic]=\"isPublic\">\n    </query-sharing-form>\n\n    <div class=\"form--space\">\n      <button class=\"button -highlight -with-icon icon-checkmark\"\n              (click)=\"saveQuery($event)\"\n              [textContent]=\"text.button_save\">\n      </button>\n      <button class=\"button -with-icon icon-cancel\"\n              [textContent]=\"text.button_cancel\"\n              [disabled]=\"isBusy\"\n              (click)=\"closeMe($event)\">\n      </button>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {FormsModule} from \"@angular/forms\";\nimport {Injector, NgModule} from \"@angular/core\";\n\nimport {AuthoringComponent} from 'core-app/modules/common/authoring/authoring.component';\nimport {OpDateTimeComponent} from 'core-app/modules/common/date/op-date-time.component';\nimport {AttributeHelpTextComponent} from 'core-app/modules/common/help-texts/attribute-help-text.component';\nimport {AttributeHelpTextModal} from 'core-app/modules/common/help-texts/attribute-help-text.modal';\nimport {OpIcon} from 'core-app/modules/common/icon/op-icon';\nimport {NotificationComponent} from 'core-app/modules/common/notifications/notification.component';\nimport {NotificationsContainerComponent} from 'core-app/modules/common/notifications/notifications-container.component';\nimport {UploadProgressComponent} from 'core-app/modules/common/notifications/upload-progress.component';\nimport {OpDatePickerComponent} from \"core-app/modules/common/op-date-picker/op-date-picker.component\";\nimport {FocusWithinDirective} from \"core-app/modules/common/focus/focus-within.directive\";\nimport {OpenprojectAccessibilityModule} from \"core-app/modules/a11y/openproject-a11y.module\";\nimport {FocusDirective} from \"core-app/modules/common/focus/focus.directive\";\nimport {HighlightColDirective} from \"core-app/modules/common/highlight-col/highlight-col.directive\";\nimport {CopyToClipboardDirective} from \"core-app/modules/common/copy-to-clipboard/copy-to-clipboard.directive\";\nimport {highlightColBootstrap} from \"./highlight-col/highlight-col.directive\";\nimport {HookService} from \"../plugins/hook-service\";\nimport {ColorsAutocompleter} from \"core-app/modules/common/colors/colors-autocompleter.component\";\nimport {ResizerComponent} from \"core-app/modules/common/resizer/resizer.component\";\nimport {TablePaginationComponent} from 'core-components/table-pagination/table-pagination.component';\nimport {SortHeaderDirective} from 'core-components/wp-table/sort-header/sort-header.directive';\nimport {ZenModeButtonComponent} from 'core-components/wp-buttons/zen-mode-toggle-button/zen-mode-toggle-button.component';\nimport {OPContextMenuComponent} from 'core-components/op-context-menu/op-context-menu.component';\nimport {StateService, UIRouterModule} from \"@uirouter/angular\";\nimport {PortalModule} from \"@angular/cdk/portal\";\nimport {CommonModule} from \"@angular/common\";\nimport {CollapsibleSectionComponent} from \"core-app/modules/common/collapsible-section/collapsible-section.component\";\nimport {NoResultsComponent} from \"core-app/modules/common/no-results/no-results.component\";\nimport {DragDropModule} from \"@angular/cdk/drag-drop\";\nimport {UserAutocompleterComponent} from \"app/modules/common/autocomplete/user-autocompleter.component\";\nimport {ScrollableTabsComponent} from \"core-app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component\";\nimport {ContentTabsComponent} from \"core-app/modules/common/tabs/content-tabs/content-tabs.component\";\nimport {EditableToolbarTitleComponent} from \"core-app/modules/common/editable-toolbar-title/editable-toolbar-title.component\";\nimport {UserAvatarComponent} from \"core-components/user/user-avatar/user-avatar.component\";\nimport {EnterpriseBannerComponent} from \"core-components/enterprise-banner/enterprise-banner.component\";\nimport {EnterpriseBannerBootstrapComponent} from \"core-components/enterprise-banner/enterprise-banner-bootstrap.component\";\nimport {DynamicModule} from \"ng-dynamic-component\";\nimport {VersionAutocompleterComponent} from \"core-app/modules/common/autocomplete/version-autocompleter.component\";\nimport {CreateAutocompleterComponent} from \"core-app/modules/common/autocomplete/create-autocompleter.component\";\nimport {HomescreenNewFeaturesBlockComponent} from \"core-components/homescreen/blocks/new-features.component\";\nimport {BoardVideoTeaserModalComponent} from \"core-app/modules/boards/board/board-video-teaser-modal/board-video-teaser-modal.component\";\nimport {PersistentToggleComponent} from \"core-app/modules/common/persistent-toggle/persistent-toggle.component\";\nimport {AutocompleteSelectDecorationComponent} from \"core-app/modules/common/autocomplete/autocomplete-select-decoration.component\";\nimport {AddSectionDropdownComponent} from \"core-app/modules/common/hide-section/add-section-dropdown/add-section-dropdown.component\";\nimport {HideSectionLinkComponent} from \"core-app/modules/common/hide-section/hide-section-link/hide-section-link.component\";\nimport {RemoteFieldUpdaterComponent} from 'core-app/modules/common/remote-field-updater/remote-field-updater.component';\nimport {AutofocusDirective} from \"core-app/modules/common/autofocus/autofocus.directive\";\nimport {ShowSectionDropdownComponent} from \"core-app/modules/common/hide-section/show-section-dropdown.component\";\nimport {IconTriggeredContextMenuComponent} from \"core-components/op-context-menu/icon-triggered-context-menu/icon-triggered-context-menu.component\";\nimport {NgSelectModule} from \"@ng-select/ng-select\";\nimport {NgOptionHighlightModule} from \"@ng-select/ng-option-highlight\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {CurrentUserService} from \"core-components/user/current-user.service\";\nimport {WorkPackageAutocompleterComponent} from \"core-app/modules/common/autocomplete/wp-autocompleter.component\";\nimport {TimeEntryWorkPackageAutocompleterComponent} from \"core-app/modules/common/autocomplete/te-work-package-autocompleter.component\";\nimport {DraggableAutocompleteComponent} from \"core-app/modules/common/draggable-autocomplete/draggable-autocomplete.component\";\nimport {DragulaModule} from \"ng2-dragula\";\n\nexport function bootstrapModule(injector:Injector) {\n  // Ensure error reporter is run\n  const currentProject = injector.get(CurrentProjectService);\n  const currentUser = injector.get(CurrentUserService);\n  const routerState = injector.get(StateService);\n\n  window.ErrorReporter.addContext((scope) => {\n    if (currentUser.isLoggedIn) {\n      scope.setUser({ name: currentUser.name, id: currentUser.userId, email: currentUser.mail });\n    }\n\n    if (currentProject.inProjectContext) {\n      scope.setTag('project', currentProject.identifier!);\n    }\n\n    scope.setExtra('router state', routerState.current.name);\n  });\n\n  const hookService = injector.get(HookService);\n  hookService.register('openProjectAngularBootstrap', () => {\n    return [\n      highlightColBootstrap\n    ];\n  });\n}\n\n@NgModule({\n  imports: [\n    // UI router components (NOT routes!)\n    UIRouterModule,\n    // Angular browser + common module\n    CommonModule,\n    // Angular Forms\n    FormsModule,\n    // Angular CDK\n    PortalModule,\n    DragDropModule,\n    DragulaModule,\n    // Our own A11y module\n    OpenprojectAccessibilityModule,\n    NgSelectModule,\n    NgOptionHighlightModule,\n\n    DynamicModule.withComponents([\n      VersionAutocompleterComponent,\n      WorkPackageAutocompleterComponent,\n      TimeEntryWorkPackageAutocompleterComponent,\n      CreateAutocompleterComponent]),\n  ],\n  exports: [\n    // Re-export all commonly used\n    // modules to DRY\n    UIRouterModule,\n    CommonModule,\n    FormsModule,\n    PortalModule,\n    DragDropModule,\n    OpenprojectAccessibilityModule,\n    NgSelectModule,\n    NgOptionHighlightModule,\n\n    OpDatePickerComponent,\n    OpDateTimeComponent,\n    OpIcon,\n    AutofocusDirective,\n\n    AttributeHelpTextComponent,\n    AttributeHelpTextModal,\n    FocusWithinDirective,\n    FocusDirective,\n    AuthoringComponent,\n\n    // Notifications\n    NotificationsContainerComponent,\n    NotificationComponent,\n    UploadProgressComponent,\n    OpDateTimeComponent,\n\n    // Entries for ng1 downgraded components\n    AttributeHelpTextComponent,\n\n    // Table highlight\n    HighlightColDirective,\n\n    ResizerComponent,\n\n    TablePaginationComponent,\n    SortHeaderDirective,\n\n    ZenModeButtonComponent,\n\n    OPContextMenuComponent,\n    IconTriggeredContextMenuComponent,\n\n    NoResultsComponent,\n\n    UserAutocompleterComponent,\n\n    ScrollableTabsComponent,\n\n    EditableToolbarTitleComponent,\n\n    // User Avatar\n    UserAvatarComponent,\n\n    // Enterprise Edition\n    EnterpriseBannerComponent,\n\n    DynamicModule,\n\n    WorkPackageAutocompleterComponent,\n\n    DraggableAutocompleteComponent,\n  ],\n  declarations: [\n    OpDatePickerComponent,\n    OpDateTimeComponent,\n    OpIcon,\n    AutofocusDirective,\n\n    AttributeHelpTextComponent,\n    AttributeHelpTextModal,\n    FocusWithinDirective,\n    FocusDirective,\n    AuthoringComponent,\n\n    // Notifications\n    NotificationsContainerComponent,\n    NotificationComponent,\n    UploadProgressComponent,\n    OpDateTimeComponent,\n\n    OPContextMenuComponent,\n    IconTriggeredContextMenuComponent,\n\n    // Entries for ng1 downgraded components\n    AttributeHelpTextComponent,\n\n    // Table highlight\n    HighlightColDirective,\n\n    // Add functionality to rails rendered templates\n    CopyToClipboardDirective,\n    CollapsibleSectionComponent,\n\n    CopyToClipboardDirective,\n    ColorsAutocompleter,\n\n    ResizerComponent,\n\n    TablePaginationComponent,\n    SortHeaderDirective,\n\n    // Zen mode button\n    ZenModeButtonComponent,\n\n    NoResultsComponent,\n\n    UserAutocompleterComponent,\n\n    ScrollableTabsComponent,\n    ContentTabsComponent,\n\n    EditableToolbarTitleComponent,\n\n    // User Avatar\n    UserAvatarComponent,\n\n    PersistentToggleComponent,\n    AutocompleteSelectDecorationComponent,\n    HideSectionLinkComponent,\n    ShowSectionDropdownComponent,\n    AddSectionDropdownComponent,\n    RemoteFieldUpdaterComponent,\n\n    // Enterprise Edition\n    EnterpriseBannerComponent,\n    EnterpriseBannerBootstrapComponent,\n\n    // Autocompleter\n    CreateAutocompleterComponent,\n    VersionAutocompleterComponent,\n    WorkPackageAutocompleterComponent,\n    TimeEntryWorkPackageAutocompleterComponent,\n    DraggableAutocompleteComponent,\n\n    HomescreenNewFeaturesBlockComponent,\n    BoardVideoTeaserModalComponent\n  ]\n})\nexport class OpenprojectCommonModule {\n  constructor(injector:Injector) {\n    bootstrapModule(injector);\n\n\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {AfterViewInit, ChangeDetectionStrategy, Component, ElementRef, Input} from \"@angular/core\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {UserAvatarRendererService} from \"core-components/user/user-avatar/user-avatar-renderer.service\";\n\nexport const userAvatarSelector = 'user-avatar';\n\n@Component({\n  selector: userAvatarSelector,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  template: ''\n})\nexport class UserAvatarComponent implements AfterViewInit {\n  /** If coming from angular, pass a user resource if available */\n  @Input() public user?:UserResource;\n\n  constructor(protected elementRef:ElementRef,\n              protected avatarRenderer:UserAvatarRendererService,\n              protected pathHelper:PathHelperService) {\n  }\n\n  public ngAfterViewInit() {\n    const element = this.elementRef.nativeElement;\n    let user = this.user || { name: element.dataset.userName!, id: element.dataset.userId };\n    this.avatarRenderer.render(element, user, false, element.dataset.classList);\n  }\n}\n\n","import {RelationsDmService} from 'core-app/modules/hal/dm-services/relations-dm.service';\nimport {RelationResource} from 'core-app/modules/hal/resources/relation-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {multiInput, MultiInputState, StatesGroup} from 'reactivestates';\nimport {StateCacheService} from '../states/state-cache.service';\nimport {Injectable} from \"@angular/core\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\n\nexport type RelationsStateValue = { [relationId:string]:RelationResource };\n\nexport class RelationStateGroup extends StatesGroup {\n  name = 'WP-Relations';\n\n  relations:MultiInputState<RelationsStateValue> = multiInput<RelationsStateValue>();\n\n  constructor() {\n    super();\n    this.initializeMembers();\n  }\n}\n\n@Injectable()\nexport class WorkPackageRelationsService extends StateCacheService<RelationsStateValue> {\n\n  private relationStates:RelationStateGroup;\n\n  /*@ngInject*/\n  constructor(private relationsDm:RelationsDmService,\n              private PathHelper:PathHelperService,\n              private halResource:HalResourceService) {\n    super();\n    this.relationStates = new RelationStateGroup();\n  }\n\n  protected get multiState() {\n    return this.relationStates.relations;\n  }\n\n  /**\n   * Load a set of work package ids into the states, regardless of them being loaded\n   * @param workPackageIds\n   */\n  protected load(id:string):Promise<RelationsStateValue> {\n    return new Promise<RelationsStateValue>((resolve, reject) => {\n      this.relationsDm\n        .load(id)\n        .then(elements => {\n          this.updateRelationsStateTo(id, elements);\n          resolve(this.state(id).value!);\n        })\n        .catch(reject);\n    });\n  }\n\n  protected loadAll(ids:string[]) {\n    return new Promise<undefined>((resolve, reject) => {\n      this.relationsDm\n        .loadInvolved(ids)\n        .then((elements:RelationResource[]) => {\n          this.clearSome(...ids);\n          this.accumulateRelationsFromInvolved(ids, elements);\n          resolve();\n        })\n        .catch(reject);\n    });\n  }\n\n  /**\n   * Find a given relation by from, to and relation Type\n   */\n  public find(from:WorkPackageResource, to:WorkPackageResource, type:string):RelationResource|undefined {\n    const relations:RelationsStateValue|undefined = this.state(from.id!).value;\n\n    if (!relations) {\n      return;\n    }\n\n    return _.find(relations, (relation:RelationResource) => {\n      const denormalized = relation.denormalized(from);\n      // Check that\n      // 1. the denormalized relation points at \"to\"\n      // 2. that the denormalized relation type matches.\n      return denormalized.target.id === to.id &&\n        denormalized.relationType === type;\n    });\n  }\n\n  /**\n   * Remove the given relation.\n   */\n  public removeRelation(relation:RelationResource) {\n    return relation.delete().then(() => {\n      this.removeFromStates(relation);\n    });\n  }\n\n  /**\n   * Update the given relation type, setting new values for from and to\n   */\n  public updateRelationType(from:WorkPackageResource, to:WorkPackageResource, relation:RelationResource, type:string) {\n    const params = {\n      _links: {\n        from: {href: from.href},\n        to: {href: to.href}\n      },\n      type: type\n    };\n\n    return this.updateRelation(relation, params);\n  }\n\n  public updateRelation(relation:RelationResource, params:{[key:string]:any}) {\n    return relation.updateImmediately(params)\n      .then((savedRelation:RelationResource) => {\n        this.insertIntoStates(savedRelation);\n        return savedRelation;\n      });\n  }\n\n  public addCommonRelation(fromId:string,\n                           relationType:string,\n                           relatedWpId:string) {\n    const params = {\n      _links: {\n        from: {href: this.PathHelper.api.v3.work_packages.id(fromId).toString() },\n        to: {href: this.PathHelper.api.v3.work_packages.id(relatedWpId).toString() }\n      },\n      type: relationType\n    };\n\n    const path = this.PathHelper.api.v3.work_packages.id(fromId).relations.toString();\n    return this.halResource\n      .post<RelationResource>(path, params)\n      .toPromise()\n      .then((relation:RelationResource) => {\n      this.insertIntoStates(relation);\n      return relation;\n    });\n  }\n\n  /**\n   * Merges a single relation\n   * @param relation\n   */\n  private insertIntoStates(relation:RelationResource) {\n    _.values(relation.ids).forEach(wpId => {\n      this.multiState.get(wpId).doModify((value:RelationsStateValue) => {\n        value[relation.id!] = relation;\n        return value;\n      }, () => {\n        let value:RelationsStateValue = {};\n        value[relation.id!] = relation;\n        return value;\n      });\n    });\n  }\n\n  /**\n   * Remove the given relation from the from/to states\n   * @param relation\n   */\n  private removeFromStates(relation:RelationResource) {\n    _.values(relation.ids).forEach(wpId => {\n      this.multiState.get(wpId).doModify((value:RelationsStateValue) => {\n        delete value[relation.id!];\n        return value;\n      }, () => {\n        return {};\n      });\n    });\n  }\n\n  /**\n   * Given a set of complete relations for this work packge, fill\n   * the associated relations state\n   *\n   * @param wpId The wpId the relations belong to\n   * @param relations The relation resource array.\n   */\n  private updateRelationsStateTo(wpId:string, relations:RelationResource[]) {\n    const state = this.multiState.get(wpId);\n    const relationsToInsert = _.keyBy(relations, r => r.id!);\n\n    state.putValue(relationsToInsert, 'Overriding relations state.');\n  }\n\n  /**\n   *\n   * We don't know how many values we're getting for a single work package\n   * when we use the involved filter.\n   *\n   * We need to group relevant relations for work packages based on their to/from filter.\n   */\n  private accumulateRelationsFromInvolved(involved:string[], relations:RelationResource[]) {\n    involved.forEach(id => {\n      const relevant = relations.filter(r => r.isInvolved(id));\n      this.updateRelationsStateTo(id, relevant);\n    });\n\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {MultiInputState, State} from 'reactivestates';\nimport {States} from '../states.service';\nimport {StateCacheService} from '../states/state-cache.service';\nimport {SchemaCacheService} from './../schemas/schema-cache.service';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {SchemaResource} from 'core-app/modules/hal/resources/schema-resource';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Injectable} from '@angular/core';\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {WorkPackageDmService} from \"core-app/modules/hal/dm-services/work-package-dm.service\";\n\nfunction getWorkPackageId(id:string|null):string {\n  return (id || 'new').toString();\n}\n\n@Injectable()\nexport class WorkPackageCacheService extends StateCacheService<WorkPackageResource> {\n\n  /*@ngInject*/\n  constructor(private states:States,\n              private schemaCacheService:SchemaCacheService,\n              private workPackageDmService:WorkPackageDmService) {\n    super();\n  }\n\n  public updateValue(id:string, val:WorkPackageResource) {\n    this.updateWorkPackageList([val], false);\n  }\n\n  updateWorkPackage(wp:WorkPackageResource, immediate:boolean = false):Promise<void> {\n    const wpId = getWorkPackageId(wp.id!);\n\n    if (immediate || wp.isNew) {\n      this.multiState.get(wpId).putValue(wp);\n      return Promise.resolve();\n    } else {\n      return this.schemaCacheService.ensureLoaded(wp).then(() => {\n        this.multiState.get(wpId).putValue(wp);\n      });\n    }\n  }\n\n  updateWorkPackageList(list:WorkPackageResource[], skipOnIdentical = true) {\n    for (var i of list) {\n      const wp = i;\n      const workPackageId = getWorkPackageId(wp.id!);\n      const state = this.multiState.get(workPackageId);\n\n      // If the work package is new, ignore the schema\n      if (wp.isNew) {\n        state.putValue(wp);\n        continue;\n      }\n\n      // Ensure the schema is loaded\n      // so that no consumer needs to call schema#$load manually\n      this.schemaCacheService.ensureLoaded(wp).then(() => {\n        // Check if the work package has changed\n        if (skipOnIdentical && state.hasValue() && _.isEqual(state.value!.$source, wp.$source)) {\n          debugLog('Skipping identical work package from updating');\n          return;\n        }\n\n        this.multiState.get(workPackageId).putValue(wp);\n      });\n    }\n  }\n\n  /**\n   * Wrapper around `require(id)`.\n   *\n   * @deprecated\n   */\n  loadWorkPackage(workPackageId:string, forceUpdate = false):State<WorkPackageResource> {\n    const state = this.state(workPackageId);\n\n    // Several services involved in the creation of work packages\n    // use this method to resolve the latest created work package,\n    // so let them just subscribe.\n    if (workPackageId === 'new') {\n      return state;\n    }\n\n    this.require(workPackageId, forceUpdate);\n    return state;\n  }\n\n  protected loadAll(ids:string[]) {\n    return new Promise<undefined>((resolve, reject) => {\n      this.workPackageDmService\n        .loadWorkPackagesCollectionsFor(_.uniq(ids))\n        .then((pagedResults:WorkPackageCollectionResource[]) => {\n          _.each(pagedResults, (results) => {\n            if (results.schemas) {\n              _.each(results.schemas.elements, (schema:SchemaResource) => {\n                this.states.schemas.get(schema.href as string).putValue(schema);\n              });\n            }\n\n            if (results.elements) {\n              this.updateWorkPackageList(results.elements);\n            }\n\n            resolve(undefined);\n          });\n        }, reject);\n    });\n  }\n\n  protected load(id:string) {\n    return new Promise<WorkPackageResource>((resolve, reject) => {\n\n      const errorAndReject = (error:any) => {\n        reject(error);\n      };\n\n      this.workPackageDmService.loadWorkPackageById(id, true)\n        .then((workPackage:WorkPackageResource) => {\n          this.schemaCacheService.ensureLoaded(workPackage).then(() => {\n            this.multiState.get(id).putValue(workPackage);\n            resolve(workPackage);\n          }, errorAndReject);\n        }, errorAndReject);\n    });\n  }\n\n  protected get multiState():MultiInputState<WorkPackageResource> {\n    return this.states.workPackages;\n  }\n\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {Attachable} from \"core-app/modules/hal/resources/mixins/attachable-mixin\";\n\nexport interface GridResourceLinks {\n  update(payload:unknown):Promise<unknown>;\n  updateImmediately(payload:unknown):Promise<unknown>;\n  delete():Promise<unknown>;\n}\n\nexport class GridBaseResource extends HalResource {\n  public widgets:GridWidgetResource[];\n  public name:string;\n  public options:{[key:string]:unknown};\n  public rowCount:number;\n  public columnCount:number;\n\n  public $initialize(source:any) {\n    super.$initialize(source);\n\n    this.widgets = this\n      .widgets\n      .map((widget:Object) => {\n        let widgetResource = new GridWidgetResource( this.injector,\n                                                     widget,\n                                                     true,\n                                                     this.halInitializer,\n                                                     'GridWidget'\n                                                   );\n\n        widgetResource.grid = this;\n\n        return widgetResource;\n      });\n  }\n\n  readonly attachmentsBackend = true;\n\n  public async updateAttachments():Promise<HalResource> {\n    return this.attachments.$update().then(() => {\n      this.states.forResource(this)!.putValue(this);\n      return this.attachments;\n    });\n  }\n}\n\n\nexport const GridResource = Attachable(GridBaseResource);\n\nexport interface GridResource extends Partial<GridResourceLinks>, GridBaseResource {\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AbstractWorkPackageButtonComponent, ButtonControllerText} from '../wp-buttons.module';\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TimelineZoomLevel} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageViewTimelineService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-timeline.service\";\n\nexport interface TimelineButtonText extends ButtonControllerText {\n  zoomOut:string;\n  zoomIn:string;\n  zoomAuto:string;\n}\n\n@Component({\n  templateUrl: './wp-timeline-toggle-button.html',\n  styleUrls: ['./wp-timeline-toggle-button.sass'],\n  selector: 'wp-timeline-toggle-button',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkPackageTimelineButtonComponent extends AbstractWorkPackageButtonComponent implements OnInit {\n  public buttonId:string = 'work-packages-timeline-toggle-button';\n  public iconClass:string = 'icon-view-timeline';\n\n  private activateLabel:string;\n  private deactivateLabel:string;\n\n  public text:TimelineButtonText;\n\n  public minZoomLevel:TimelineZoomLevel = 'days';\n  public maxZoomLevel:TimelineZoomLevel = 'years';\n\n  public isAutoZoom = false;\n\n  public isMaxLevel:boolean = false;\n  public isMinLevel:boolean = false;\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              public wpTableTimeline:WorkPackageViewTimelineService) {\n    super(I18n);\n\n    this.activateLabel = I18n.t('js.timelines.button_activate');\n    this.deactivateLabel = I18n.t('js.timelines.button_deactivate');\n\n    this.text.zoomIn = I18n.t('js.timelines.zoom.in');\n    this.text.zoomOut = I18n.t('js.timelines.zoom.out');\n    this.text.zoomAuto = I18n.t('js.timelines.zoom.auto');\n  }\n\n  ngOnInit():void {\n    this.wpTableTimeline\n      .live$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => {\n        this.isAutoZoom = this.wpTableTimeline.isAutoZoom();\n        this.isActive = this.wpTableTimeline.isVisible;\n        this.cdRef.detectChanges();\n      });\n\n    this.wpTableTimeline\n      .appliedZoomLevel$\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((current) => {\n        this.isMaxLevel = current === this.maxZoomLevel;\n        this.isMinLevel = current === this.minZoomLevel;\n        this.cdRef.detectChanges();\n      });\n  }\n\n  public get label():string {\n    if (this.isActive) {\n      return this.deactivateLabel;\n    } else {\n      return this.activateLabel;\n    }\n  }\n\n  public isToggle():boolean {\n    return true;\n  }\n\n  public updateZoomWithDelta(delta:number) {\n    this.wpTableTimeline.updateZoomWithDelta(delta);\n  }\n\n  public performAction(event:Event) {\n    this.toggleTimeline();\n  }\n\n  public toggleTimeline() {\n    this.wpTableTimeline.toggle();\n  }\n\n  public enableAutoZoom() {\n    this.wpTableTimeline.enableAutozoom();\n  }\n\n  public getAutoZoomToggleClass():string {\n    return this.isAutoZoom ? '-disabled' : '';\n  }\n}\n","<ul id=\"work-packages-timeline-mode-selection\"\n    class=\"toolbar-button-group\">\n\n  <li *ngIf=\"isActive\">\n    <button id=\"work-packages-timeline-zoom-auto-button\"\n            class=\"button timeline-toolbar--button toolbar-icon\"\n            [ngClass]=\"getAutoZoomToggleClass()\"\n            [attr.title]=\"text.zoomAuto\"\n            (click)=\"enableAutoZoom()\">\n      <op-icon icon-classes=\"icon-zoom-auto button--icon\"></op-icon>\n    </button>\n  </li>\n\n  <li *ngIf=\"isActive\">\n    <button id=\"work-packages-timeline-zoom-out-button\"\n            class=\"button timeline-toolbar--button toolbar-icon\"\n            [attr.title]=\"text.zoomOut\"\n            [disabled]=\"isMaxLevel\"\n            (click)=\"updateZoomWithDelta(1)\">\n      <op-icon icon-classes=\"icon-zoom-out button--icon\"></op-icon>\n    </button>\n  </li>\n\n  <li *ngIf=\"isActive\">\n    <button id=\"work-packages-timeline-zoom-in-button\"\n            class=\"button timeline-toolbar--button toolbar-icon\"\n            [attr.title]=\"text.zoomIn\"\n            [disabled]=\"isMinLevel\"\n            (click)=\"updateZoomWithDelta(-1)\">\n      <op-icon icon-classes=\"icon-zoom-in button--icon\"></op-icon>\n    </button>\n  </li>\n</ul>\n","import {AfterViewInit, Component, ElementRef, ViewChild} from \"@angular/core\";\n\nexport interface Tab {\n  id:string;\n  name:string;\n  path?:string;\n}\n\n@Component({\n  templateUrl: 'scrollable-tabs.component.html'\n})\n\nexport class ScrollableTabsComponent implements AfterViewInit {\n  @ViewChild('scrollContainer', { static: true }) scrollContainer:ElementRef;\n  @ViewChild('scrollPane', { static: true }) scrollPane:ElementRef;\n  @ViewChild('scrollRightBtn', { static: true }) scrollRightBtn:ElementRef;\n  @ViewChild('scrollLeftBtn', { static: true }) scrollLeftBtn:ElementRef;\n\n  public currentTabId:string = '';\n  public tabs:Tab[] = [];\n  public classes:string[] = ['scrollable-tabs'];\n  public hideLeftButton:boolean = true;\n  public hideRightButton:boolean = true;\n\n  private container:Element;\n  private pane:Element;\n\n  ngAfterViewInit() {\n    this.container = this.scrollContainer.nativeElement;\n    this.pane = this.scrollPane.nativeElement;\n\n    this.determineScrollButtonVisibility();\n    this.scrollIntoVisibleArea(this.currentTabId);\n  }\n\n  public clickTab(tab:string) {\n    this.currentTabId = tab;\n  }\n\n  public onScroll(event:any) {\n    this.determineScrollButtonVisibility();\n  }\n\n  private determineScrollButtonVisibility() {\n    this.hideLeftButton = (this.pane.scrollLeft <= 0);\n    this.hideRightButton = (this.pane.scrollWidth - this.pane.scrollLeft <= this.container.clientWidth);\n  }\n\n  public scrollRight() {\n    this.pane.scrollLeft += this.container.clientWidth;\n  }\n\n  public scrollLeft() {\n    this.pane.scrollLeft -= this.container.clientWidth;\n  }\n\n  private scrollIntoVisibleArea(tabId:string) {\n    const tab:JQuery<Element> = jQuery(this.pane).find(`[tab-id=${tabId}]`);\n    const position:JQueryCoordinates = tab.position();\n\n    const tabRightBorderAt:number = position.left + Number(tab.outerWidth());\n\n    if (this.pane.scrollLeft + this.container.clientWidth < tabRightBorderAt) {\n      this.pane.scrollLeft = tabRightBorderAt - this.container.clientWidth + 40; // 40px to not overlap by buttons\n    }\n  }\n}\n","<div #scrollContainer [ngClass]=\"classes\">\n  <ul #scrollPane class=\"tabrow\" (scroll)=\"onScroll($event)\">\n    <li *ngFor=\"let tab of tabs\"\n        [class.selected]=\"tab.id === currentTabId\"\n        [attr.tab-id]=\"tab.id\">\n      <a [href]=\"tab.path\" (click)=\"clickTab(tab.id)\" [textContent]=\"tab.name\"></a>\n    </li>\n  </ul>\n  <div #scrollLeftBtn [hidden]=\"hideLeftButton\"\n                      class=\"scrollable-tabs--button -left\"\n                      (click)=\"scrollLeft()\">\n    <span class=\"icon-arrow-left2\"></span>\n  </div>\n  <div #scrollRightBtn [hidden]=\"hideRightButton\"\n                       class=\"scrollable-tabs--button -right\"\n                       (click)=\"scrollRight()\">\n    <span class=\"icon-arrow-right2\"></span>\n  </div>\n</div>\n","import {Component, EventEmitter, HostListener, Input, OnDestroy, Output} from \"@angular/core\";\nimport {DomHelpers} from \"core-app/helpers/dom/set-window-cursor.helper\";\n\n\nexport interface ResizeDelta {\n  origin:any;\n\n  // Absolute difference from start\n  absolute:{\n    x:number;\n    y:number;\n  };\n\n  // Relative difference from last position\n  relative:{\n    x:number;\n    y:number;\n  };\n}\n\n@Component({\n  selector: 'resizer',\n  templateUrl: './resizer.component.html'\n})\nexport class ResizerComponent implements OnDestroy {\n  private startX:number;\n  private startY:number;\n  private oldX:number;\n  private oldY:number;\n  private newX:number;\n  private newY:number;\n  private mouseMoveHandler:EventListener;\n  private mouseUpHandler:EventListener;\n  private resizing = false;\n\n  @Output() end:EventEmitter<ResizeDelta> = new EventEmitter();\n  @Output() start:EventEmitter<ResizeDelta> = new EventEmitter();\n  @Output() move:EventEmitter<ResizeDelta> = new EventEmitter();\n\n  @Input() customHandler = false;\n  @Input() cursorClass = 'nwse-resize';\n  @Input() resizerClass = 'resizer';\n\n  ngOnDestroy() {\n    this.removeEventListener();\n  }\n\n  @HostListener('mousedown', ['$event'])\n  @HostListener('touchstart', ['$event'])\n  public startResize(event:any) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Only on left mouse click the resizing is started\n    if (event.buttons === 1 || event.which === 1 || event.which === 0) {\n      // Getting starting position\n      this.oldX = this.startX = event.clientX || event.pageX || event.touches[0].clientX;\n      this.oldY = this.startY = event.clientY || event.pageY || event.touches[0].clientY;\n\n      this.newX = event.clientX || event.pageX || event.touches[0].clientX;\n      this.newY = event.clientY || event.pageY || event.touches[0].clientY;\n\n      this.resizing = true;\n\n      this.setResizeCursor();\n      this.bindEventListener(event);\n\n      this.start.emit(this.buildDelta(event));\n    }\n  }\n\n  private onMouseUp(event:any) {\n    this.setAutoCursor();\n    this.removeEventListener();\n\n    this.end.emit(this.buildDelta(event));\n  }\n\n  private onMouseMove(event:any) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.oldX = this.newX;\n    this.oldY = this.newY;\n\n    this.newX = event.clientX || event.pageX || event.touches[0].clientX;\n    this.newY = event.clientY || event.pageY || event.touches[0].clientX;\n\n    this.move.emit(this.buildDelta(event));\n  }\n\n  // Necessary to encapsulate this to be able to remove the event listener later\n  private bindEventListener(event:any) {\n    this.mouseMoveHandler = this.onMouseMove.bind(this);\n    this.mouseUpHandler = this.onMouseUp.bind(this);\n\n    window.addEventListener('mousemove', this.mouseMoveHandler);\n    window.addEventListener('touchmove', this.mouseMoveHandler);\n    window.addEventListener('mouseup', this.mouseUpHandler);\n    window.addEventListener('touchend', this.mouseUpHandler);\n  }\n\n  private removeEventListener() {\n    window.removeEventListener('touchmove', this.mouseMoveHandler);\n    window.removeEventListener('mousemove', this.mouseMoveHandler);\n    window.removeEventListener('mouseup', this.mouseUpHandler);\n    window.removeEventListener('touchend', this.mouseUpHandler);\n  }\n\n  private setResizeCursor() {\n    DomHelpers.setBodyCursor(this.cursorClass, 'important');\n  }\n\n  private setAutoCursor() {\n    DomHelpers.setBodyCursor('auto');\n  }\n\n  private buildDelta(event:any):ResizeDelta {\n    return {\n      origin: event,\n      absolute: {\n        x: this.newX - this.startX,\n        y: this.newY - this.startY,\n      },\n      relative: {\n        x: this.newX - this.oldX,\n        y: this.newY - this.oldX,\n      }\n    };\n  }\n}\n","<div [ngClass]=\"resizerClass\"\n     *ngIf=\"!customHandler\">\n</div>\n<ng-content></ng-content>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\n\n@Injectable({ providedIn: 'root' })\nexport class CurrentUserService {\n  public get isLoggedIn() {\n    return this.userMeta.length > 0;\n  }\n\n  public get userId() {\n    return this.userMeta.data('id');\n  }\n\n  public get name() {\n    return this.userMeta.data('name');\n  }\n\n  public get mail() {\n    return this.userMeta.data('mail');\n  }\n\n  public get language() {\n    return I18n.locale || 'en';\n  }\n\n  private get userMeta():JQuery {\n    return jQuery('meta[name=current_user]');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {PasswordConfirmationModal} from \"core-components/modals/request-for-confirmation/password-confirmation.modal\";\n\nfunction registerListener(\n  form:JQuery,\n  $event:JQuery.TriggeredEvent,\n  opModalService:OpModalService,\n  modal:typeof PasswordConfirmationModal) {\n  const passwordConfirm = form.find('_password_confirmation');\n\n  if (passwordConfirm.length > 0) {\n    return true;\n  }\n\n  $event.preventDefault();\n  const confirmModal = opModalService.show(modal, 'global');\n  confirmModal.closingEvent.subscribe((modal:any) => {\n    if (modal.confirmed) {\n      jQuery('<input>')\n        .attr({\n          type: 'hidden',\n          name: '_password_confirmation',\n          value: modal.password_confirmation\n        })\n        .appendTo(form);\n\n      form.trigger('submit');\n    }\n  });\n\n  return false;\n}\n\nexport function registerRequestForConfirmation($:JQueryStatic) {\n  window.OpenProject\n    .getPluginContext()\n    .then((context) => {\n      const opModalService = context.services.opModalService;\n      const passwordConfirmationModal = context.classes.modals.passwordConfirmation;\n\n      $(document).on(\n        'submit',\n        'form[data-request-for-confirmation]',\n        function(this:any, $event:JQuery.TriggeredEvent) {\n          const form = jQuery(this);\n\n          if (form.find('input[name=\"_password_confirmation\"]').length) {\n              return true;\n          }\n\n          return registerListener(form, $event, opModalService, passwordConfirmationModal);\n        });\n    });\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {performAnchorHijacking} from \"./global-listeners/link-hijacking\";\nimport {augmentedDatePicker} from \"./global-listeners/augmented-date-picker\";\nimport {refreshOnFormChanges} from 'core-app/globals/global-listeners/refresh-on-form-changes';\nimport {registerRequestForConfirmation} from \"core-app/globals/global-listeners/request-for-confirmation\";\nimport {DeviceService} from \"core-app/modules/common/browser/device.service\";\nimport {scrollHeaderOnMobile} from \"core-app/globals/global-listeners/top-menu-scroll\";\n\n/**\n * A set of listeners that are relevant on every page to set sensible defaults\n */\n(function($:JQueryStatic) {\n\n  $(function() {\n    $(document.documentElement!)\n      .on('click', (evt:any) => {\n        const target = jQuery(evt.target) as JQuery;\n\n        // Create datepickers dynamically for Rails-based views\n        augmentedDatePicker(evt, target);\n\n        // Prevent angular handling clicks on href=\"#...\" links from other libraries\n        // (especially jquery-ui and its datepicker) from routing to <base url>/#\n        performAnchorHijacking(evt, target);\n\n        return true;\n      });\n\n    // Jump to the element given by location.hash, if present\n    const hash = window.location.hash;\n    if (hash && hash.startsWith('#')) {\n      try {\n        const el = document.querySelector(hash);\n        el && el.scrollIntoView();\n      } catch (e) {\n        // This is very likely an invalid selector such as a Google Analytics tag.\n        // We can safely ignore this and just not scroll in this case.\n        // Still log the error so one can confirm the reason there is no scrolling.\n        console.log(\"Could not scroll to given location hash: \" + hash + \" ( \" + e.message + \")\");\n      }\n    }\n\n    // Global submitting hook,\n    // necessary to avoid a data loss warning on beforeunload\n    $(document).on('submit','form',function(){\n      window.OpenProject.pageIsSubmitted = true;\n    });\n\n    // Add to content if warnings displayed\n    if (document.querySelector('.warning-bar--item')) {\n      let content = document.querySelector('#content') as HTMLElement;\n      if (content) {\n        content.style.marginBottom = '100px';\n      }\n    }\n\n    // Global beforeunload hook\n    $(window).on('beforeunload', (e:JQuery.TriggeredEvent) => {\n      const event = e.originalEvent as BeforeUnloadEvent;\n      if (window.OpenProject.pageWasEdited && !window.OpenProject.pageIsSubmitted) {\n        // Cancel the event\n        event.preventDefault();\n        // Chrome requires returnValue to be set\n        event.returnValue = '';\n      }\n    });\n\n    // Disable global drag & drop handling, which results in the browser loading the image and losing the page\n    $(document.documentElement!)\n      .on('dragover drop', (evt:any) => {\n        evt.preventDefault();\n        return false;\n      });\n\n    refreshOnFormChanges();\n\n    // Allow forms with [request-for-confirmation]\n    // to show the password confirmation dialog\n    registerRequestForConfirmation($);\n\n    const deviceService:DeviceService = new DeviceService();\n    // Register scroll handler on mobile header\n    if (deviceService.isMobile) {\n      scrollHeaderOnMobile();\n    }\n  });\n\n}(jQuery));\n","import {DatePicker} from \"core-app/modules/common/op-date-picker/datepicker\";\n\n/**\n * Our application is still a hybrid one, meaning most routes are still\n * handled by Rails. As such, we disable the default link-hijacking that\n * Angular's HTML5-mode with <base href=\"/\"> results in\n * @param evt\n * @param target\n */\nexport function augmentedDatePicker(evt:JQuery.TriggeredEvent, target:JQuery) {\n  if (target.hasClass('-augmented-datepicker')) {\n    target\n      .attr('autocomplete', 'off'); // Disable autocomplete for those fields\n\n    var datePicker = new DatePicker(\n      '.-augmented-datepicker',\n      target.val(),\n      {\n        weekNumbers: true,\n        allowInput: true\n      },\n      target[0]\n    );\n    datePicker.show();\n  }\n}\n","/**\n * Our application is still a hybrid one, meaning most routes are still\n * handled by Rails. As such, we disable the default link-hijacking that\n * Angular's HTML5-mode with <base href=\"/\"> results in\n * @param evt\n * @param target\n */\nexport function performAnchorHijacking(evt:JQuery.TriggeredEvent, target:JQuery):void {\n  // Avoid defaulting clicks on elements already removed from DOM\n  if (!document.contains(evt.target as Element)) {\n    evt.preventDefault();\n  }\n\n  // Avoid handling clicks on anything other than a\n  const linkElement = target.closest('a');\n  if (linkElement.length === 0) {\n    return;\n  }\n\n  const link = linkElement.attr('href') || '';\n  const hashPos = link.indexOf('#');\n\n  // If link is neither empty nor starts with hash, ignore it\n  if (link !== '' && hashPos !== 0) {\n    return;\n  }\n\n  // Set the location to the hash if there is any\n  // Since with the base tag, links like href=\"#whatever\" otherwise target to <base>/#whatever\n  if (hashPos !== -1 && link !== '#') {\n    window.location.hash = link;\n  }\n\n  evt.preventDefault();\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nexport function refreshOnFormChanges() {\n  const matches = document.querySelectorAll('.augment--refresh-on-form-changes');\n\n  for (let i = 0; i < matches.length; i++) {\n    let element = matches[i];\n    const form = jQuery(element);\n    const url = form.data('refreshUrl');\n    const inputId = form.data('inputSelector');\n\n    form\n      .find(inputId)\n      .on('change', () => {\n        window.location.href = url + '?' + form.serialize();\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\n// Scroll header on mobile in and out when user scrolls the container\nexport function scrollHeaderOnMobile() {\n  const headerHeight = 55;\n  let prevScrollPos = window.scrollY;\n\n  window.addEventListener('scroll', function() {\n    // Condition needed for safari browser to avoid negative positions\n    let currentScrollPos = window.scrollY < 0 ? 0 :  window.scrollY;\n    // Only if sidebar is not opened or search bar is opened\n    if (!(jQuery('#main').hasClass('hidden-navigation')) ||\n        jQuery('#top-menu').hasClass('-global-search-expanded') ||\n        Math.abs(currentScrollPos - prevScrollPos) <= headerHeight) { // to avoid flickering at the end of the page\n      return;\n    }\n\n    if (prevScrollPos !== undefined && currentScrollPos !== undefined && (prevScrollPos > currentScrollPos)) {\n      // Slide top menu in or out of viewport and change viewport height\n      jQuery('#wrapper').removeClass('-header-scrolled');\n    } else {\n      jQuery('#wrapper').addClass('-header-scrolled');\n    }\n    prevScrollPos = currentScrollPos;\n  });\n}\n","<div id=\"work-package-activites-container\">\n  <div id=\"work-package-comment-container\">\n\n    <ng-container *ngIf=\"!showAbove\" [ngTemplateOutlet]=\"template\"></ng-container>\n\n    <div class=\"work-package--details--long-field work-packages--activity--add-comment hide-when-print\"\n         #commentContainer\n         *ngIf=\"canAddComment\">\n      <div class=\"inline-edit--container inplace-edit\">\n        <edit-form-portal *ngIf=\"active\"\n                          [schemaInput]=\"schema\"\n                          [changeInput]=\"change\"\n                          [editFieldHandler]=\"handler\">\n        </edit-form-portal>\n        <div *ngIf=\"!active\"\n             (dragover)=\"startDragOverActivation($event)\"\n             class=\"inplace-edit--read\">\n          <accessible-by-keyboard\n            class=\"inplace-editing--trigger-container\"\n            spanClass=\"inplace-editing--container inline-edit--display-field\"\n            linkClass=\"inplace-editing--trigger-link\"\n            [linkAriaLabel]=\"text.editTitle\"\n            (execute)=\"activate()\">\n\n            <span class=\"inplace-editing--trigger-text inline-edit--formattable-display-text -default\">\n              <span [textContent]=\"text.placeholder\"></span>\n            </span>\n\n            <span class=\"inplace-editing--trigger-icon\">\n              <op-icon icon-classes=\"icon-edit\" [icon-title]=\"text.editTitle\"></op-icon>\n            </span>\n          </accessible-by-keyboard>\n        </div>\n      </div>\n  </div>\n\n    <ng-container *ngIf=\"showAbove\" [ngTemplateOutlet]=\"template\"></ng-container>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {ErrorResource} from 'core-app/modules/hal/resources/error-resource';\nimport {WorkPackageCacheService} from '../work-package-cache.service';\nimport {WorkPackagesActivityService} from 'core-components/wp-single-view-tabs/activity-panel/wp-activity.service';\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {CommentService} from \"core-components/wp-activity/comment-service\";\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ContentChild,\n  ElementRef,\n  Injector,\n  Input,\n  OnDestroy,\n  OnInit,\n  TemplateRef,\n  ViewChild\n} from \"@angular/core\";\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\n\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageCommentFieldHandler} from \"core-components/work-packages/work-package-comment/work-package-comment-field-handler\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  selector: 'work-package-comment',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './work-package-comment.component.html'\n})\nexport class WorkPackageCommentComponent extends WorkPackageCommentFieldHandler implements OnInit, OnDestroy {\n  @Input() public workPackage:WorkPackageResource;\n\n  @ContentChild(TemplateRef) template:TemplateRef<any>;\n  @ViewChild('commentContainer') public commentContainer:ElementRef;\n\n  public text = {\n    editTitle: this.I18n.t('js.label_add_comment_title'),\n    addComment: this.I18n.t('js.label_add_comment'),\n    cancelTitle: this.I18n.t('js.label_cancel_comment'),\n    placeholder: this.I18n.t('js.label_add_comment_title')\n  };\n  public fieldLabel:string = this.text.editTitle;\n\n  public inFlight = false;\n  public canAddComment:boolean;\n  public showAbove:boolean;\n\n  constructor(protected elementRef:ElementRef,\n              protected injector:Injector,\n              protected commentService:CommentService,\n              protected wpLinkedActivities:WorkPackagesActivityService,\n              protected ConfigurationService:ConfigurationService,\n              protected loadingIndicator:LoadingIndicatorService,\n              protected wpCacheService:WorkPackageCacheService,\n              protected workPackageNotificationService:WorkPackageNotificationService,\n              protected NotificationsService:NotificationsService,\n              protected cdRef:ChangeDetectorRef,\n              protected I18n:I18nService) {\n    super(elementRef, injector);\n  }\n\n  public ngOnInit() {\n    super.ngOnInit();\n\n    this.canAddComment = !!this.workPackage.addComment;\n    this.showAbove = this.ConfigurationService.commentsSortedInDescendingOrder();\n\n    this.commentService.quoteEvents\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((quote:string) => {\n        this.activate(quote);\n        this.commentContainer.nativeElement.scrollIntoView();\n      });\n  }\n\n  // Open the field when its closed and relay drag & drop events to it.\n  public startDragOverActivation(event:JQuery.TriggeredEvent) {\n    if (this.active) {\n      return true;\n    }\n\n    this.activate();\n\n    event.preventDefault();\n    return false;\n  }\n\n  public get htmlId() {\n    return 'wp-comment-field';\n  }\n\n  public activate(withText?:string) {\n    super.activate(withText);\n\n    if (!this.showAbove) {\n      this.scrollToBottom();\n    }\n\n    this.cdRef.detectChanges();\n  }\n\n  public deactivate(focus:boolean) {\n    focus && this.focus();\n    this.active = false;\n    this.cdRef.detectChanges();\n  }\n\n  public async handleUserSubmit() {\n    if (this.inFlight || !this.rawComment) {\n      return Promise.resolve();\n    }\n\n    this.inFlight = true;\n    await this.onSubmit();\n    let indicator = this.loadingIndicator.wpDetails;\n    return indicator.promise = this.commentService.createComment(this.workPackage, this.commentValue)\n      .then(() => {\n        this.active = false;\n        this.NotificationsService.addSuccess(this.I18n.t('js.work_packages.comment_added'));\n\n        this.wpLinkedActivities.require(this.workPackage, true);\n        this.wpCacheService.updateWorkPackage(this.workPackage);\n        this.inFlight = false;\n        this.deactivate(true);\n      })\n      .catch((error:any) => {\n        this.inFlight = false;\n        if (error instanceof ErrorResource) {\n          this.workPackageNotificationService.showError(error, this.workPackage);\n        } else {\n          this.NotificationsService.addError(this.I18n.t('js.work_packages.comment_send_failed'));\n        }\n      });\n  }\n\n  scrollToBottom():void {\n    const scrollableContainer = jQuery(this.elementRef.nativeElement).scrollParent()[0];\n    if (scrollableContainer) {\n      setTimeout(() => {\n        scrollableContainer.scrollTop = scrollableContainer.scrollHeight;\n      }, 400);\n    }\n  }\n\n  setErrors(newErrors:string[]):void {\n    // interface\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {OpenProjectPluginContext} from 'core-app/modules/plugins/plugin-context';\nimport {input, InputState} from 'reactivestates';\nimport {take} from 'rxjs/operators';\n\n/**\n * OpenProject instance methods\n */\nexport class OpenProject {\n\n  public pluginContext:InputState<OpenProjectPluginContext> = input<OpenProjectPluginContext>();\n\n  /** Globally setable variable whether the page was edited */\n  public pageWasEdited:boolean = false;\n  /** Globally setable variable whether the page form is submitted.\n   * Necessary to avoid a data loss warning on beforeunload */\n  public pageIsSubmitted:boolean = false;\n\n  public getPluginContext():Promise<OpenProjectPluginContext> {\n    return this.pluginContext\n      .values$()\n      .pipe(take(1))\n      .toPromise();\n  }\n\n  public get urlRoot():string {\n    return jQuery('meta[name=app_base_path]').attr('content') || '';\n  }\n\n  public get environment():string {\n    return jQuery('meta[name=openproject_initializer]').data('environment');\n  }\n\n  public get edition():string {\n    return jQuery('meta[name=openproject_initializer]').data('edition');\n  }\n\n  public get isStandardEdition():boolean {\n    return this.edition === \"standard\";\n  }\n\n  public get isBimEdition():boolean {\n    return this.edition === \"bim\";\n  }\n\n  /**\n   * Guard access to reads and writes to the localstorage due to corrupted local databases\n   * in Firefox happening in one larger client.\n   *\n   * NS_ERROR_FILE_CORRUPTED\n   *\n   * @param {string} key\n   * @param {string} newValue\n   * @returns {string | undefined}\n   */\n  public guardedLocalStorage(key:string, newValue?:string):string | void {\n    try {\n      if (newValue !== undefined) {\n        window.localStorage.setItem(key, newValue);\n      } else {\n        const value = window.localStorage.getItem(key);\n        return value === null ? undefined : value;\n      }\n    } catch (e) {\n      console.error('Failed to access your browsers local storage. Is your local database corrupted?');\n    }\n  }\n}\n\nwindow.OpenProject = new OpenProject();\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {BcfPathHelperService} from \"core-app/modules/bim/bcf/helper/bcf-path-helper.service\";\n\nexport class BcfThumbnailDisplayField extends DisplayField {\n  @InjectField() bcfPathHelper:BcfPathHelperService;\n\n  public render(element:HTMLElement, displayText:string):void {\n    const viewpoints = this.resource.bcfViewpoints;\n    if (viewpoints && viewpoints.length > 0) {\n      const viewpoint = viewpoints[0];\n      element.innerHTML = `\n        <img src=\"${this.bcfPathHelper.snapshotPath(viewpoint)}\" class=\"thumbnail\">\n      `;\n    } else {\n      element.innerHTML = '';\n    }\n  }\n}\n","import {Inject, Injectable} from '@angular/core';\nimport {DOCUMENT} from \"@angular/common\";\n\n@Injectable()\nexport class BcfDetectorService {\n  constructor (@Inject(DOCUMENT) private documentElement:Document) {\n  }\n\n  /**\n   * Detect whether the BCF module was activated,\n   * resulting in a body class.\n   */\n  public get isBcfActivated() {\n    return this.hasBodyClass('bcf-activated');\n  }\n\n  private hasBodyClass(name:string):boolean {\n    return this.documentElement.body.classList.contains(name);\n  }\n}\n","import {Injectable, Injector} from '@angular/core';\nimport {Observable, Subject} from \"rxjs\";\nimport {distinctUntilChanged, filter, first, mapTo} from \"rxjs/operators\";\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\nimport {ViewerBridgeService} from \"core-app/modules/bim/bcf/bcf-viewer-bridge/viewer-bridge.service\";\nimport {input} from \"reactivestates\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {ViewpointsService} from \"core-app/modules/bim/bcf/helper/viewpoints.service\";\nimport {map} from \"rxjs/operators\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n\ndeclare global {\n  interface Window {\n    RevitBridge:any;\n  }\n}\n\n@Injectable()\nexport class RevitBridgeService extends ViewerBridgeService {\n  private revitMessageReceivedSource = new Subject<{ messageType:string, trackingId:string, messagePayload:string }>();\n  private _trackingIdNumber = 0;\n  private _ready$ = input<boolean>(false);\n\n  @InjectField() viewpointsService:ViewpointsService;\n\n  revitMessageReceived$ = this.revitMessageReceivedSource.asObservable();\n\n  constructor(readonly injector:Injector) {\n    super(injector);\n\n    if (window.RevitBridge) {\n      console.log(\"window.RevitBridge is already there, so let's hook up the Revit Listener\");\n      this.hookUpRevitListener();\n    } else {\n      console.log('Waiting for Revit Plugin to become ready.');\n      window.addEventListener('revit.plugin.ready', () => {\n        console.log('CAPTURED EVENT \"revit.plugin.ready\"');\n        this.hookUpRevitListener();\n      });\n    }\n  }\n\n  public viewerVisible() {\n    return this._ready$.getValueOr(false);\n  }\n\n  public getViewpoint$():Observable<BcfViewpointInterface> {\n    const trackingId = this.newTrackingId();\n\n    this.sendMessageToRevit('ViewpointGenerationRequest', trackingId, '');\n\n    return this.revitMessageReceived$\n      .pipe(\n        distinctUntilChanged(),\n        filter(message => message.messageType === 'ViewpointData' && message.trackingId === trackingId),\n        first()\n      )\n      .pipe(\n        map((message) => {\n          let viewpointJson = JSON.parse(message.messagePayload);\n\n          viewpointJson.snapshot = {\n            snapshot_type: 'png',\n            snapshot_data: viewpointJson.snapshot\n          };\n          return viewpointJson;\n        })\n      )\n  }\n\n  public showViewpoint(workPackage:WorkPackageResource, index:number) {\n     this.viewpointsService\n              .getViewPoint$(workPackage, index)\n              .subscribe((viewpoint: BcfViewpointInterface) =>  this.sendMessageToRevit('ShowViewpoint', this.newTrackingId(), JSON.stringify(viewpoint)));\n  }\n\n  sendMessageToRevit(messageType:string, trackingId:string, messagePayload?:any) {\n    if (!this.viewerVisible()) {\n      console.log('The Revit bridge is not ready yet.');\n      return;\n    }\n\n    const jsonPayload = messagePayload != null ? JSON.stringify(messagePayload) : null;\n    window.RevitBridge.sendMessageToRevit(messageType, trackingId, jsonPayload);\n  }\n\n  private hookUpRevitListener() {\n    window.RevitBridge.sendMessageToOpenProject = (messageString:string) => {\n      const message = JSON.parse(messageString);\n      const messageType = message.messageType;\n      const trackingId = message.trackingId;\n      const messagePayload = JSON.parse(message.messagePayload);\n\n      this.revitMessageReceivedSource.next({\n        messageType: messageType,\n        trackingId: trackingId,\n        messagePayload: messagePayload\n      });\n    };\n    this._ready$.putValue(true);\n  }\n\n  newTrackingId():string {\n    this._trackingIdNumber = this._trackingIdNumber + 1;\n    return String(this._trackingIdNumber);\n  }\n\n  onLoad$():Observable<void> {\n    return this\n      ._ready$\n      .values$()\n      .pipe(mapTo(undefined));\n  }\n}\n","import {multiInput} from \"reactivestates\";\nimport {BcfExtensionResource} from \"core-app/modules/bim/bcf/api/extensions/bcf-extension.resource\";\nimport {BcfApiService} from \"core-app/modules/bim/bcf/api/bcf-api.service\";\nimport {Observable} from \"rxjs\";\nimport {map, take} from \"rxjs/operators\";\nimport {Injectable} from \"@angular/core\";\n\nexport type AllowedExtensionKey = keyof BcfExtensionResource;\n\n@Injectable({ providedIn: 'root' })\nexport class BcfAuthorizationService {\n\n  // Poor mans caching to avoid repeatedly fetching from the backend.\n  protected authorizationMap = multiInput<BcfExtensionResource>();\n\n  constructor(readonly bcfApi:BcfApiService) {\n  }\n\n  /**\n   * Returns an observable boolean whether the given action\n   * is authorized in the project by using the project extensions.\n   *\n   * Ensures the extension is loaded only once per project\n   *\n   * @param projectIdentifier Project identifier to check permission in\n   * @param extension The extension key to check for\n   * @param action The desired action\n   */\n  public authorized$(projectIdentifier:string, extension:AllowedExtensionKey, action:string):Observable<boolean> {\n    const state = this.authorizationMap.get(projectIdentifier);\n\n    state.putFromPromiseIfPristine(() =>\n      this.bcfApi\n        .projects.id(projectIdentifier)\n        .extensions\n        .get()\n        .toPromise()\n    );\n\n    return state\n      .values$()\n      .pipe(\n        map(\n          resource => resource[extension] && resource[extension].includes(action)\n        )\n      );\n  }\n\n  /**\n   * One-time check to determine current allowed state.\n   *\n   * @param projectIdentifier Project identifier to check permission in\n   * @param extension The extension key to check for\n   * @param action The desired action\n   */\n  public isAllowedTo(projectIdentifier:string, extension:AllowedExtensionKey, action:string):Promise<boolean> {\n    return this\n      .authorized$(projectIdentifier, extension, action)\n      .pipe(\n        take(1)\n      )\n      .toPromise()\n      .catch(() => false);\n  }\n}\n\n","<ng-container *ngIf=\"shouldShowGroup()\">\n  <div class=\"attributes-group description-group\">\n    <div class=\"attributes-group--header\">\n      <div class=\"attributes-group--header-container\">\n        <h3 class=\"attributes-group--header-text\"\n            [textContent]=\"text.bcf\"></h3>\n      </div>\n    </div>\n\n    <div class=\"bcf--viewpoints\" *ngIf=\"galleryImages.length > 0\">\n      <ngx-gallery [options]=\"galleryOptions\"\n                   [images]=\"galleryImages\"\n                   (change)=\"onGalleryChanged($event)\"\n                   (imagesReady)=\"selectViewpointInGallery()\"\n                   (previewOpen)=\"galleryPreviewOpen()\"\n                   (previewClose)=\"galleryPreviewClose()\">\n      </ngx-gallery>\n    </div>\n\n    <a *ngIf=\"viewerVisible && createAllowed\"\n       [title]=\"text.add_viewpoint\"\n       class=\"button\"\n       (click)=\"saveViewpoint(workPackage)\">\n      <op-icon icon-classes=\"button--icon icon-add\"></op-icon>\n      <span class=\"button--text\"> {{text.viewpoint}} </span>\n    </a>\n  </div>\n</ng-container>","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  ViewChild\n} from \"@angular/core\";\nimport {StateService} from \"@uirouter/core\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {NgxGalleryComponent, NgxGalleryOptions} from '@kolkov/ngx-gallery';\nimport {HalLink} from \"core-app/modules/hal/hal-link/hal-link\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ViewerBridgeService} from \"core-app/modules/bim/bcf/bcf-viewer-bridge/viewer-bridge.service\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {WorkPackageCreateService} from \"core-components/wp-new/wp-create.service\";\nimport {BcfAuthorizationService} from \"core-app/modules/bim/bcf/api/bcf-authorization.service\";\nimport {ViewpointsService} from \"core-app/modules/bim/bcf/helper/viewpoints.service\";\nimport {BcfViewpointItem} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint-item.interface\";\n\n\n\n@Component({\n  templateUrl: './bcf-wp-attribute-group.component.html',\n  styleUrls: ['./bcf-wp-attribute-group.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [ViewpointsService]\n})\nexport class BcfWpAttributeGroupComponent extends UntilDestroyedMixin implements AfterViewInit, OnDestroy {\n  @Input() workPackage:WorkPackageResource;\n  @ViewChild(NgxGalleryComponent) gallery:NgxGalleryComponent;\n\n  text = {\n    bcf: this.I18n.t('js.bcf.label_bcf'),\n    viewpoint: this.I18n.t('js.bcf.viewpoint'),\n    add_viewpoint: this.I18n.t('js.bcf.add_viewpoint'),\n    show_viewpoint: this.I18n.t('js.bcf.show_viewpoint'),\n    delete_viewpoint: this.I18n.t('js.bcf.delete_viewpoint'),\n    text_are_you_sure: this.I18n.t('js.text_are_you_sure'),\n    notice_successful_create: this.I18n.t('js.notice_successful_create'),\n    notice_successful_delete: this.I18n.t('js.notice_successful_delete'),\n  };\n\n  galleryOptions:NgxGalleryOptions[] = [\n    {\n      width: '100%',\n      height: '400px',\n\n      // Show first thumbnail by default\n      startIndex: 0,\n\n      // Show only one image (\"thumbnail\")\n      // and disable the large image slideshow\n      image: false,\n      thumbnailsColumns: 1,\n      // Ensure thumbnails are ALWAYS shown\n      thumbnailsAutoHide: false,\n      // For BCFs all information shall be visible\n      thumbnailSize: 'contain',\n      imageAnimation: '',\n      previewAnimation: false,\n      previewCloseOnEsc: true,\n      previewKeyboardNavigation: true,\n      imageSize: 'contain',\n      imageArrowsAutoHide: true,\n      // thumbnailsArrowsAutoHide: true,\n      thumbnailsMargin: 5,\n      thumbnailMargin: 5,\n      previewDownload: true,\n      previewCloseOnClick: true,\n      arrowPrevIcon: 'icon-arrow-left2',\n      arrowNextIcon: 'icon-arrow-right2',\n      closeIcon: 'icon-close',\n      downloadIcon: 'icon-download',\n      thumbnailActions: this.actions(),\n      actions: this.actions(),\n    },\n    // max-width 800\n    {\n      breakpoint: 800,\n      width: '100%',\n      height: '400px',\n      imagePercent: 80,\n      thumbnailsPercent: 20,\n      thumbnailsMargin: 5,\n      thumbnailMargin: 5\n    },\n    // max-width 680\n    {\n      breakpoint: 680,\n      height: '200px',\n      thumbnailsColumns: 3,\n      thumbnailsMargin: 5,\n      thumbnailMargin: 5,\n    }\n  ];\n\n  viewpoints:BcfViewpointItem[] = [];\n\n  galleryImages:any[] = [];\n\n  // Store whether viewing is allowed\n  viewAllowed:boolean = false;\n  // Store whether viewpoint creation is allowed\n  createAllowed:boolean = false;\n  // Currently, this is static. Need observable if this changes over time\n  viewerVisible = this.viewerBridge.viewerVisible();\n  projectId: string;\n\n  constructor(readonly state:StateService,\n              readonly bcfAuthorization:BcfAuthorizationService,\n              readonly viewerBridge:ViewerBridgeService,\n              readonly wpCache:WorkPackageCacheService,\n              readonly wpCreate:WorkPackageCreateService,\n              readonly notifications:NotificationsService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService,\n              readonly viewpointsService:ViewpointsService) {\n    super();\n  }\n\n  ngAfterViewInit():void {\n    // Observe changes on the work package to update the viewpoints\n    this.observeChanges();\n  }\n\n  protected observeChanges() {\n    this.wpCache\n          .observe(this.workPackage.id!)\n          .pipe(this.untilDestroyed())\n          .subscribe(async wp => {\n            this.workPackage = wp;\n\n            if (!this.projectId) {\n              await this.initialize(this.workPackage);\n            }\n\n            if (wp.bcfViewpoints) {\n              this.refreshViewpoints(wp.bcfViewpoints);\n            }\n          });\n  }\n\n  async initialize(workPackage:WorkPackageResource) {\n    this.projectId = workPackage.project.idFromLink;\n    this.viewAllowed = await this.bcfAuthorization.isAllowedTo(this.projectId, 'project_actions', 'viewTopic');\n    this.createAllowed = await this.bcfAuthorization.isAllowedTo(this.projectId, 'topic_actions', 'createViewpoint'); \n\n    this.loadViewpointFromRoute(workPackage);\n    this.cdRef.detectChanges();\n  }\n\n  refreshViewpoints(viewpoints:HalLink[]) {\n    this.viewpoints = viewpoints.map((el:HalLink) => ({ href: el.href, snapshotURL: `${el.href}/snapshot` }));\n\n    this.setViewpointsOnGallery(this.viewpoints);\n  }\n\n  protected showViewpoint(workPackage:WorkPackageResource, index:number) {\n    this.viewerBridge.showViewpoint(workPackage, index);\n  }\n\n  protected deleteViewpoint(workPackage:WorkPackageResource, index:number) {\n    if (!window.confirm(this.text.text_are_you_sure)) {\n      return;\n    }\n\n    this.viewpointsService\n          .deleteViewPoint$(workPackage, index) \n          .subscribe(data => {\n            this.notifications.addSuccess(this.text.notice_successful_delete);\n            this.gallery.preview.close();\n          });\n  }\n\n  public saveViewpoint(workPackage:WorkPackageResource) {\n    this.viewpointsService\n          .saveViewpoint$(workPackage) \n          .subscribe(viewpoint => {\n            this.notifications.addSuccess(this.text.notice_successful_create);\n            this.showIndex = this.viewpoints.length;\n          });\n  }\n\n  protected loadViewpointFromRoute(workPackage:WorkPackageResource) {\n    if (typeof (this.state.params.viewpoint) === 'number') {\n      const index = this.state.params.viewpoint;\n      this.showViewpoint(workPackage, index);\n      this.showIndex = index;\n      this.selectViewpointInGallery();\n      this.state.go('.', { ...this.state.params, viewpoint: undefined }, { reload: false });\n    }\n  }\n\n  public shouldShowGroup() {\n    return this.viewAllowed &&\n      (this.viewpoints.length > 0 ||\n        (this.createAllowed && this.viewerVisible));\n  }\n\n  // Gallery functionality\n  protected actions() {\n    return [\n      {\n        icon: 'icon-view-model',\n        onClick: (evt: any, index: number) => this.showViewpoint(this.workPackage, index),\n        titleText: this.text.show_viewpoint\n      },\n      {\n        icon: 'icon-delete',\n        onClick: (evt:any, index:number) => this.deleteViewpoint(this.workPackage, index),\n        titleText: this.text.delete_viewpoint\n      }\n    ];\n  }\n\n  public galleryPreviewOpen():void {\n    jQuery('#top-menu').addClass('-no-z-index');\n  }\n\n  public galleryPreviewClose():void {\n    jQuery('#top-menu').removeClass('-no-z-index');\n  }\n\n  public selectViewpointInGallery() {\n    setTimeout(() => this.gallery?.show(this.showIndex), 250);\n  }\n\n  public onGalleryChanged(event:{ index:number }) {\n    this.showIndex = event.index;\n  }\n\n  protected set showIndex(value:number) {\n    const options = [...this.galleryOptions];\n    options[0].startIndex = value;\n    this.galleryOptions = options;\n  }\n\n  protected get showIndex():number {\n    return this.galleryOptions[0].startIndex!;\n  }\n\n  protected setViewpointsOnGallery(viewpoints:BcfViewpointItem[]) {\n    const length = viewpoints.length;\n\n    this.setThumbnailProperties(length);\n\n    if (this.showIndex < 0 || length < 1) {\n      this.showIndex = 0;\n    } else if (this.showIndex >= length) {\n      this.showIndex = length - 1;\n    }\n\n    this.galleryImages = viewpoints.map(viewpoint => {\n      return {\n        small: viewpoint.snapshotURL,\n        medium: viewpoint.snapshotURL,\n        big: viewpoint.snapshotURL\n      };\n    });\n    this.cdRef.detectChanges();\n  }\n\n  protected setThumbnailProperties(viewpointCount:number) {\n    const options = [...this.galleryOptions];\n\n    options[0].thumbnailsColumns = viewpointCount < 5 ? viewpointCount : 4;\n    options[1].thumbnailsColumns = viewpointCount < 5 ? viewpointCount : 4;\n    options[2].thumbnailsColumns = viewpointCount < 4 ? viewpointCount : 3;\n\n    options[0].height = `${this.dynamicThumbnailHeight(viewpointCount)}px`;\n    options[1].height = `${this.dynamicThumbnailHeight(viewpointCount)}px`;\n    options[2].height = `${this.dynamicThumbnailHeight(viewpointCount)}px`;\n\n    this.galleryOptions = options;\n  }\n\n  protected dynamicThumbnailHeight(viewpointCount:number):number {\n    return Math.max(Math.round(300 / viewpointCount), 120);\n  }\n}\n","import {ChangeDetectionStrategy, Component} from \"@angular/core\";\nimport {BcfWpAttributeGroupComponent} from \"core-app/modules/bim/bcf/bcf-wp-attribute-group/bcf-wp-attribute-group.component\";\nimport {take, switchMap} from \"rxjs/operators\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {forkJoin} from \"rxjs\";\nimport {BcfViewpointInterface} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint.interface\";\nimport {BcfViewpointItem} from \"core-app/modules/bim/bcf/api/viewpoints/bcf-viewpoint-item.interface\";\n\n\n@Component({\n  templateUrl: './bcf-wp-attribute-group.component.html',\n  styleUrls: ['./bcf-wp-attribute-group.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class BcfNewWpAttributeGroupComponent extends BcfWpAttributeGroupComponent {\n  galleryViewpoints:BcfViewpointItem[] = [];\n\n  ngAfterViewInit():void {\n    if (this.viewerVisible) {\n      super.ngAfterViewInit();\n\n      // Save any leftover viewpoints when saving the work package\n      if (this.workPackage.isNew) {\n        this.observeCreation();\n      }\n    }\n  }\n\n  // Because this is a new WorkPackage, in order to save the\n  // viewpoints on it we need to:\n  // - Wait until the WorkPackage is created\n  // - Create the BCFTopic on it to save the viewpoints\n  private observeCreation() {\n    this.wpCreate\n          .onNewWorkPackage()\n          .pipe(\n            this.untilDestroyed(),\n            take(1),\n            switchMap((wp:WorkPackageResource) => this.viewpointsService.setBcfTopic$(wp), (wp) => wp),\n            switchMap((wp:WorkPackageResource) => {\n              this.workPackage = wp;\n              const observables = this.galleryViewpoints\n                                        .filter(viewPointItem => !viewPointItem.href && viewPointItem.viewpoint)\n                                        .map(viewPointItem => this.viewpointsService.saveViewpoint$(this.workPackage, viewPointItem.viewpoint));             \n\n              return forkJoin(observables);\n            })\n          )\n          .subscribe((viewpoints: BcfViewpointInterface[]) => {\n            this.showIndex = this.galleryViewpoints.length - 1;\n          });\n  }\n\n  // Disable show viewpoint functionality\n  showViewpoint(workPackage:WorkPackageResource, index:number) {\n    return;\n  }\n\n  deleteViewpoint(workPackage:WorkPackageResource, index:number) {\n    this.galleryViewpoints = this.galleryViewpoints.filter((_, i) => i !== index);\n\n    this.setViewpointsOnGallery(this.galleryViewpoints);\n    \n    return;\n  }\n\n  saveViewpoint() {\n    this.viewerBridge\n          .getViewpoint$() \n          .subscribe(viewpoint => {            \n            const newViewpoint = {\n                snapshotURL: viewpoint.snapshot.snapshot_data,\n                viewpoint: viewpoint\n            };\n\n            this.galleryViewpoints = [\n              ...this.galleryViewpoints,\n              newViewpoint\n            ];\n\n            this.setViewpointsOnGallery(this.galleryViewpoints);\n\n            // Select the last created viewpoint and show it\n            this.showIndex = this.galleryViewpoints.length - 1;\n            this.selectViewpointInGallery();\n          });\n  }\n\n  shouldShowGroup() {\n    return this.createAllowed && this.viewerVisible;\n  }\n  protected actions() {\n    // Show only delete button\n    return super\n      .actions()\n      .filter(el => el.icon === 'icon-delete');\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector, NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {NgxGalleryModule} from \"@kolkov/ngx-gallery\";\nimport {DisplayFieldService} from \"core-app/modules/fields/display/display-field.service\";\nimport {BcfThumbnailDisplayField} from \"core-app/modules/bim/bcf/fields/display/bcf-thumbnail-field.module\";\nimport {HTTP_INTERCEPTORS} from \"@angular/common/http\";\nimport {OpenProjectHeaderInterceptor} from \"core-app/modules/hal/http/openproject-header-interceptor\";\nimport {BcfDetectorService} from \"core-app/modules/bim/bcf/helper/bcf-detector.service\";\nimport {BcfPathHelperService} from \"core-app/modules/bim/bcf/helper/bcf-path-helper.service\";\nimport {ViewpointsService} from \"core-app/modules/bim/bcf/helper/viewpoints.service\";\nimport {BcfImportButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/import-export-bcf/bcf-import-button.component\";\nimport {BcfExportButtonComponent} from \"core-app/modules/bim/ifc_models/toolbar/import-export-bcf/bcf-export-button.component\";\nimport {RevitBridgeService} from \"core-app/modules/bim/bcf/bcf-viewer-bridge/revit-bridge.service\";\nimport {IFCViewerService} from \"core-app/modules/bim/ifc_models/ifc-viewer/ifc-viewer.service\";\nimport {ViewerBridgeService} from \"core-app/modules/bim/bcf/bcf-viewer-bridge/viewer-bridge.service\";\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {BcfWpAttributeGroupComponent} from \"core-app/modules/bim/bcf/bcf-wp-attribute-group/bcf-wp-attribute-group.component\";\nimport {BcfNewWpAttributeGroupComponent} from \"core-app/modules/bim/bcf/bcf-wp-attribute-group/bcf-new-wp-attribute-group.component\";\n\n/**\n * Determines based on the current user agent whether\n * we're running in Revit or not.\n *\n * Depending on that, we use the IFC viewer service for showing/saving viewpoints.\n */\nexport const viewerBridgeServiceFactory = (injector:Injector) => {\n  if (window.navigator.userAgent.search('Revit') > -1) {\n    return new RevitBridgeService(injector);\n  } else {\n    return injector.get(IFCViewerService, new IFCViewerService(injector));\n  }\n};\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    NgxGalleryModule,\n  ],\n  providers: [\n    { provide: HTTP_INTERCEPTORS, useClass: OpenProjectHeaderInterceptor, multi: true },\n    {\n      provide: ViewerBridgeService,\n      useFactory: viewerBridgeServiceFactory,\n      deps: [Injector]\n    },\n    BcfDetectorService,\n    BcfPathHelperService,\n    ViewpointsService,\n  ],\n  declarations: [\n    BcfWpAttributeGroupComponent,\n    BcfNewWpAttributeGroupComponent,\n    BcfImportButtonComponent,\n    BcfExportButtonComponent,\n  ],\n  exports: [\n    BcfImportButtonComponent,\n    BcfExportButtonComponent,\n  ]\n})\nexport class OpenprojectBcfModule {\n  static bootstrapCalled = false;\n\n  constructor(injector:Injector) {\n    OpenprojectBcfModule.bootstrap(injector);\n  }\n\n  // The static property prevents running the function\n  // multiple times. This happens e.g. when the module is included\n  // into a plugin's module.\n  public static bootstrap(injector:Injector) {\n    if (this.bootstrapCalled) {\n      return;\n    }\n\n    this.bootstrapCalled = true;\n\n    const displayFieldService = injector.get(DisplayFieldService);\n    displayFieldService\n      .addFieldType(BcfThumbnailDisplayField, 'bcfThumbnail', [\n        'BCF Thumbnail'\n      ]);\n\n\n    const hookService = injector.get(HookService);\n    hookService.register('prependedAttributeGroups', (workPackage:WorkPackageResource) => {\n      if (!window.OpenProject.isBimEdition) {\n        return;\n      }\n\n      if (workPackage.isNew) {\n        return BcfNewWpAttributeGroupComponent;\n      } else {\n        return BcfWpAttributeGroupComponent;\n      }\n    });\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\njQuery(function($) {\n  var regions = $.datepicker.regional;\n  var regional = regions[I18n.locale] || regions[''];\n\n  // see ./app/helpers/application_helper.rb:508\n  if (typeof I18n.firstDayOfWeek === 'number') {\n    regional.firstDay = I18n.firstDayOfWeek;\n  }\n\n  $.datepicker.setDefaults(regional);\n\n  var gotoToday = $.datepicker._gotoToday;\n\n  $.datepicker._gotoToday = function (id) {\n    gotoToday.call(this, id);\n    var target = $(id),\n      inst = this._getInst(target[0]),\n      dateStr = $.datepicker._formatDate(inst);\n    target.val(dateStr);\n    target.blur();\n    $.datepicker._hideDatepicker();\n  };\n\n  var defaults = {\n    showWeek: true,\n    changeMonth: true,\n    changeYear: true,\n    yearRange: 'c-100:c+10',\n    dateFormat: 'yy-mm-dd',\n    showButtonPanel: true,\n    calculateWeek: function (day) {\n      var dayOfWeek = new Date(+day);\n\n      if (day.getDay() != 1) {\n        dayOfWeek.setDate(day.getDate() - day.getDay() + 1);\n      }\n\n      return $.datepicker.iso8601Week(dayOfWeek);\n    }\n  };\n\n  $.datepicker.setDefaults(defaults);\n\n  $.extend($.datepicker, {\n\n    _originalGotoToday: $.datepicker._gotoToday,\n    _gotoToday: function(id) {\n      var target = $(id),\n          inst = this._getInst(target[0]),\n          today = new Date(),\n          date = this._formatDate(inst, today.getDate(), today.getMonth(), today.getFullYear());\n      this._originalGotoToday(id);\n      this._selectDate(id, date);\n    },\n\n    // Reference the orignal function so we can override it and call it later\n    _inlineDatepicker2: $.datepicker._inlineDatepicker,\n\n    // Override the _inlineDatepicker method\n    _inlineDatepicker: function (target, inst) {\n\n      // Call the original\n      this._inlineDatepicker2(target, inst);\n\n      var beforeShow = $.datepicker._get(inst, 'beforeShow');\n\n      if (beforeShow) {\n        beforeShow.apply(target, [target, inst]);\n      }\n    },\n    _checkOffsetOriginal: $.datepicker._checkOffset,\n\n    _checkOffset: function(inst, offset, isFixed) {\n      var _offset = $.datepicker._checkOffsetOriginal(inst, offset, isFixed);\n      var alterOffset = this._get(inst, 'alterOffset');\n      if (alterOffset) {\n        var inp = inst.input ? inst.input[0] : null;\n        // trigger custom callback\n        return alterOffset.apply(inp, [_offset]);\n      }\n      return _offset;\n    }\n  });\n});\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ApplicationRef, ChangeDetectorRef, Component, ElementRef, OnInit} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\n\n\nexport const customDateActionAdminSelector = 'custom-date-action-admin';\n\n@Component({\n  selector: customDateActionAdminSelector,\n  templateUrl: './custom-date-action-admin.html'\n})\nexport class CustomDateActionAdminComponent implements OnInit {\n  public valueVisible = false;\n  public fieldName:string;\n  public fieldValue:string;\n  public visibleValue:string;\n  public selectedOperator:any;\n\n  private onKey = 'on';\n  private currentKey = 'current';\n  private currentFieldValue = '%CURRENT_DATE%';\n\n  public operators = [\n    {key: this.onKey, label: this.I18n.t('js.custom_actions.date.specific')},\n    {key: this.currentKey, label: this.I18n.t('js.custom_actions.date.current_date')}\n  ];\n\n  constructor(private elementRef:ElementRef,\n              private cdRef:ChangeDetectorRef,\n              public appRef:ApplicationRef,\n              private I18n:I18nService) {\n  }\n\n  // cannot use $onInit as it would be called before the operators gets filled\n  public ngOnInit() {\n    const element = this.elementRef.nativeElement as HTMLElement;\n    this.fieldName = element.dataset.fieldName!;\n    this.fieldValue = element.dataset.fieldValue!;\n\n    if (this.fieldValue === this.currentFieldValue) {\n      this.selectedOperator = this.operators[1];\n    } else {\n      this.selectedOperator = this.operators[0];\n      this.visibleValue = this.fieldValue;\n    }\n\n    this.toggleValueVisibility();\n  }\n\n  public toggleValueVisibility() {\n    this.valueVisible = this.selectedOperator.key === this.onKey;\n    if (this.fieldValue === this.currentFieldValue) {\n      this.fieldValue = '';\n    }\n\n    this.updateDbValue();\n  }\n\n  private updateDbValue() {\n    if (this.selectedOperator.key === this.currentKey) {\n      this.fieldValue = this.currentFieldValue;\n    }\n  }\n\n  public get fieldId() {\n    // replace all square brackets by underscore\n    // to match the label's for value\n    return this.fieldName\n               .replace(/\\[|\\]/g, '_')\n               .replace('__', '_')\n               .replace(/_$/, '');\n  }\n\n  updateField(val:string) {\n    this.fieldValue = val;\n    this.cdRef.detectChanges();\n  }\n}\n\n\n","<div class=\"form--field-container\">\n  <span class=\"form--select-container\">\n      <select class=\"form--select\"\n              [attr.id]=\"fieldId\"\n              [(ngModel)]=\"selectedOperator\"\n              (change)=\"toggleValueVisibility()\">\n             <option *ngFor=\"let operator of operators\"\n                     [textContent]=\"operator.label\"\n                     [ngValue]=\"operator\">\n             </option>\n      </select>\n  </span>\n  <span class=\"form--text-field-container -slim\" *ngIf=\"valueVisible\">\n    <op-date-picker (onChange)=\"updateField($event)\"\n                    [id]=\"fieldId + '_visible'\"\n                    [name]=\"fieldId + '_input'\"\n                    [initialDate]=\"fieldValue\"\n                    classes=\"form--text-field\">\n    </op-date-picker>\n  </span>\n  <input type=\"hidden\"\n         [name]=\"fieldName\"\n         [value]=\"fieldValue\" />\n</div>\n","import {Injectable} from \"@angular/core\";\n\n/**\n * General components\n */\nexport interface GlobalI18n {\n  t(translateId:string, parameters?:any):string;\n\n  lookup(translateId:string):boolean|undefined;\n\n  toNumber(num:number, options?:ToNumberOptions):string;\n\n  toPercentage(num:number, options?:ToPercentageOptions):string;\n\n  toCurrency(num:number, options?:ToCurrencyOptions):string;\n\n  strftime(date:Date, format:string):string;\n\n  toHumanSize(num:number, options?:ToHumanSizeOptions):string;\n\n  locale:string;\n  firstDayOfWeek:number;\n\n}\n\ninterface ToNumberOptions {\n  precision?:number;\n  separator?:string;\n  delimiter?:string;\n  strip_insignificant_zeros?:boolean;\n}\n\ntype ToPercentageOptions = ToNumberOptions;\n\ninterface ToCurrencyOptions extends ToNumberOptions {\n  format?:string;\n  unit?:string;\n  sign_first?:boolean;\n}\n\ninterface ToHumanSizeOptions extends ToNumberOptions {\n  format?:string;\n}\n\n\n@Injectable({ providedIn: 'root' })\nexport class I18nService {\n  private _i18n:GlobalI18n = (window as any).I18n;\n\n  public get locale():string {\n    return this._i18n.locale;\n  }\n\n  public t(translateId:string, parameters?:{ [key:string]:any }):string {\n    return this._i18n.t(translateId, parameters);\n  }\n\n  public lookup(translateId:string):boolean|undefined {\n    return this._i18n.lookup(translateId);\n  }\n\n  public toNumber = this._i18n.toNumber.bind(this._i18n);\n  public toPercentage = this._i18n.toPercentage.bind(this._i18n);\n  public toCurrency = this._i18n.toCurrency.bind(this._i18n);\n  public strftime = this._i18n.strftime.bind(this._i18n);\n  public toHumanSize = this._i18n.toHumanSize.bind(this._i18n);\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nexport class WorkPackageViewHierarchies {\n  public isVisible:boolean = false;\n  public last:string|null = null;\n  public collapsed:{[workPackageId:string]:boolean} = {};\n\n  constructor(visible:boolean) {\n    this.isVisible = visible;\n  }\n}\n","import {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {WorkPackageQueryStateService} from './wp-view-base.service';\nimport {Injectable} from '@angular/core';\nimport {WorkPackageViewHierarchies} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-table-hierarchies\";\n\n@Injectable()\nexport class WorkPackageViewHierarchiesService extends WorkPackageQueryStateService<WorkPackageViewHierarchies> {\n\n  public valueFromQuery(query:QueryResource):WorkPackageViewHierarchies {\n    const value =  new WorkPackageViewHierarchies(query.showHierarchies);\n    const current = this.current;\n\n    // Take over current collapsed values\n    // which are not yet saved\n    if (current) {\n      value.collapsed = current.collapsed;\n    }\n\n    return value;\n  }\n\n  public hasChanged(query:QueryResource) {\n    return query.showHierarchies !== this.isEnabled;\n  }\n\n  public applyToQuery(query:QueryResource) {\n    query.showHierarchies = this.isEnabled;\n\n    // We need to visibly load the ancestors when the mode is activated.\n    return this.isEnabled;\n  }\n\n  /**\n   * Return whether the current hierarchy mode is active\n   */\n  public get isEnabled():boolean {\n    return !!(this.current && this.current.isVisible);\n  }\n\n  public setEnabled(active:boolean = true) {\n    const state = { collapsed: {}, ...this.current, isVisible: active, last: null };\n    this.update(state);\n  }\n\n  /**\n   * Toggle the hierarchy state\n   */\n  public toggleState():boolean {\n    this.setEnabled(!this.isEnabled);\n    return this.isEnabled;\n  }\n\n  /**\n   * Return whether the given wp ID is collapsed.\n   */\n  public collapsed(wpId:string):boolean {\n    return this.current.collapsed[wpId];\n  }\n\n  /**\n   * Collapse the hierarchy for this work package\n   */\n  public collapse(wpId:string):void {\n    this.setState(wpId, true);\n  }\n\n  /**\n   * Expand the hierarchy for this work package\n   */\n  public expand(wpId:string):void {\n    this.setState(wpId, false);\n  }\n\n  /**\n   * Toggle the hierarchy state\n   */\n  public toggle(wpId:string):void {\n    this.setState(wpId, !this.collapsed(wpId));\n  }\n\n  /**\n   * Set the collapse/expand state of the given work package id.\n   */\n  private setState(wpId:string, isCollapsed:boolean):void {\n    const state = { ...this.current, last: wpId };\n    state.collapsed[wpId] = isCollapsed;\n    this.update(state);\n  }\n\n  /**\n   * Get current selection state.\n   */\n  public get current():WorkPackageViewHierarchies {\n    const state = this.lastUpdatedState.value;\n\n    if (state === undefined) {\n      return this.initialState;\n    }\n\n    if (!state.collapsed) {\n      state.collapsed = {};\n    }\n\n    return state;\n  }\n\n  private get initialState():WorkPackageViewHierarchies {\n    return new WorkPackageViewHierarchies(false);\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\n\n/**\n * The service is intended to store all the updates caused to a query by a user.\n * It is e.g. used to not update the board list when the current user moved a card within a list/query.\n  */\n\n\n@Injectable()\nexport class CausedUpdatesService {\n  /** contains all the updates to the query caused by modifications of the user */\n  private causedUpdates:string[] = [];\n\n  public includes(query:QueryResource) {\n    return this.causedUpdates.includes(this.cacheValue(query));\n  }\n\n  public add(query:QueryResource) {\n    if (this.causedUpdates.length > 100) {\n      this.causedUpdates.splice(0, 90);\n    }\n\n    this.causedUpdates.push(this.cacheValue(query));\n  }\n\n  private cacheValue(query:QueryResource) {\n    return query.updatedAt + query.$href;\n  }\n}\n","import {Component, Input} from \"@angular/core\";\nimport {enterpriseEditionUrl} from \"core-app/globals/constants.const\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  selector: 'enterprise-banner',\n  styleUrls: ['./enterprise-banner.component.sass'],\n  template: `\n      <div class=\"notification-box -ee-upsale\"\n           [ngClass]=\"{'-left-margin': leftMargin }\">\n        <div class=\"notification-box--content\">\n          <p class=\"-bold\" [textContent]=\"text.enterpriseFeature\"></p>\n          <p [textContent]=\"textMessage\"></p>\n          <a [href]=\"eeLink()\"\n             target='blank'\n             [textContent]=\"linkMessage\"></a>\n        </div>\n      </div>\n  `\n})\nexport class EnterpriseBannerComponent {\n  @Input() public leftMargin:boolean = false;\n  @Input() public textMessage:string;\n  @Input() public linkMessage:string;\n  @Input() public opReferrer:string;\n\n  public text:any = {\n    enterpriseFeature: this.I18n.t('js.upsale.ee_only'),\n  };\n\n  constructor(protected I18n:I18nService) {\n  }\n\n  public eeLink() {\n    if (this.opReferrer) {\n      return enterpriseEditionUrl + '&op_referrer=' + this.opReferrer;\n    } else {\n      return enterpriseEditionUrl;\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport interface ButtonControllerText {\n  activate:string;\n  deactivate:string;\n  label:string;\n  buttonText:string;\n}\n\nexport abstract class AbstractWorkPackageButtonComponent extends UntilDestroyedMixin {\n  public disabled:boolean;\n  public buttonId:string;\n  public iconClass:string;\n\n  public accessKey:number;\n  public isActive:boolean = false;\n\n  protected text:ButtonControllerText;\n\n  constructor(public I18n:I18nService) {\n    super();\n\n    this.text = {\n      activate: this.I18n.t('js.label_activate'),\n      deactivate: this.I18n.t('js.label_deactivate'),\n      label: this.labelKey ? this.I18n.t(this.labelKey) : '',\n      buttonText: this.textKey ? this.I18n.t(this.textKey) : ''\n    };\n  }\n\n  public get label():string {\n    return this.text.label;\n  }\n\n  public get buttonText():string {\n    return this.text.buttonText;\n  }\n\n  public get labelKey():string {\n    return '';\n  }\n\n  public get textKey():string {\n    return '';\n  }\n\n  protected get activationPrefix():string {\n    return !this.isActive ? this.text.activate + ' ' : '';\n  }\n\n  protected get deactivationPrefix():string {\n    return this.isActive ? this.text.deactivate + ' ' : '';\n  }\n\n  protected get prefix():string {\n    return this.activationPrefix || this.deactivationPrefix;\n  }\n\n  public isToggle():boolean {\n    return false;\n  }\n\n  public abstract performAction(event:Event):void;\n}\n","<div class=\"op-modal--portal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container confirm-dialog--modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\">\n        <i\n          class=\"icon-close\"\n          (click)=\"closeMe($event)\"\n          [attr.title]=\"text.close\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-log_time\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <te-form #editForm\n               [entry]=\"entry\"\n               [showWorkPackageField]=\"showWorkPackageField\"\n               (modifiedEntry)=\"setModifiedEntry($event)\">\n      </te-form>\n    </div>\n\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"button -highlight\"\n              *ngIf=\"saveAllowed\"\n              (click)=\"saveEntry()\"\n              [attr.title]=\"saveText\">\n        <op-icon icon-classes=\"button--icon icon-checkmark\"></op-icon>\n        <span class=\"button--text\"\n              [textContent]=\"saveText\"\n              aria-hidden=\"true\"></span>\n      </button>\n\n      <button class=\"button\"\n              *ngIf=\"saveAllowed\"\n              (click)=\"closeMe($event)\"\n              [attr.title]=\"text.cancel\">\n        <op-icon icon-classes=\"button--icon icon-close\"></op-icon>\n        <span class=\"button--text\"\n              [textContent]=\"text.cancel\"\n              aria-hidden=\"true\"></span>\n      </button>\n\n      <button class=\"button\"\n              *ngIf=\"deleteAllowed\"\n              (click)=\"destroy()\"\n              [attr.title]=\"text.delete\">\n        <op-icon icon-classes=\"button--icon icon-delete\"></op-icon>\n        <span class=\"button--text\"\n              [textContent]=\"text.delete\"\n              aria-hidden=\"true\"></span>\n      </button>\n    </div>\n  </div>\n</div>\n","import {Component, ChangeDetectionStrategy} from \"@angular/core\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport { TimeEntryBaseModal } from '../shared/modal/base.modal';\n\n@Component({\n  templateUrl: '../shared/modal/base.modal.html',\n  styleUrls: ['../shared/modal/base.modal.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    HalResourceEditingService\n  ]\n})\nexport class TimeEntryCreateModal extends TimeEntryBaseModal {\n  public createdEntry:TimeEntryResource;\n\n  public get deleteAllowed() {\n    return false;\n  }\n\n  public setModifiedEntry($event:{savedResource:HalResource, isInital:boolean}) {\n    this.createdEntry = $event.savedResource as TimeEntryResource;\n  }\n\n  public get saveText() {\n    return this.i18n.t('js.label_create');\n  }\n}\n","import { Injectable, Injector } from \"@angular/core\";\nimport { OpModalService } from \"app/components/op-modals/op-modal.service\";\nimport { HalResourceService } from \"app/modules/hal/services/hal-resource.service\";\nimport { I18nService } from \"core-app/modules/common/i18n/i18n.service\";\nimport { TimeEntryResource } from 'core-app/modules/hal/resources/time-entry-resource';\nimport { take } from 'rxjs/operators';\nimport { FormResource } from \"core-app/modules/hal/resources/form-resource\";\nimport { TimeEntryDmService } from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\nimport { ResourceChangeset } from \"core-app/modules/fields/changeset/resource-changeset\";\nimport { HalResourceEditingService } from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport { Moment } from 'moment';\nimport { TimeEntryCreateModal } from \"core-app/modules/time_entries/create/create.modal\";\nimport { WorkPackageResource } from 'core-app/modules/hal/resources/work-package-resource';\n\n@Injectable()\nexport class TimeEntryCreateService {\n\n  constructor(readonly opModalService:OpModalService,\n    readonly injector:Injector,\n    readonly halResource:HalResourceService,\n    readonly timeEntryDm:TimeEntryDmService,\n    protected halEditing:HalResourceEditingService,\n    readonly i18n:I18nService) {\n  }\n\n  public create(date:Moment, wp?:WorkPackageResource, showWorkPackageField:boolean = true) {\n    return new Promise<{ entry:TimeEntryResource, action:'create' }>((resolve, reject) => {\n      this\n        .createNewTimeEntry(date, wp)\n        .then(changeset => {\n          const modal = this.opModalService.show(TimeEntryCreateModal, this.injector, { entry: changeset.pristineResource, showWorkPackageField: showWorkPackageField });\n\n          modal\n            .closingEvent\n            .pipe(take(1))\n            .subscribe(() => {\n              if (modal.createdEntry) {\n                resolve({ entry: modal.createdEntry, action: 'create' });\n              } else {\n                reject();\n              }\n            });\n\n        });\n    });\n  }\n\n  public createNewTimeEntry(date:Moment, wp?:WorkPackageResource) {\n    let payload:any = {\n      spentOn: date.format('YYYY-MM-DD')\n    };\n\n    if (wp) {\n      payload['_links'] = {\n        workPackage: {\n          href: wp.href\n        }\n      };\n    }\n\n    return this.timeEntryDm.createForm(payload).then(form => {\n      return this.fromCreateForm(form);\n    });\n  }\n\n  public fromCreateForm(form:FormResource):ResourceChangeset {\n    let entry = this.initializeNewResource(form);\n\n    return this.halEditing.edit<TimeEntryResource, ResourceChangeset<TimeEntryResource>>(entry, form);\n  }\n\n  private initializeNewResource(form:FormResource) {\n    let entry = this.halResource.createHalResourceOfType<TimeEntryResource>('TimeEntry', form.payload.$plain());\n\n    entry.$links['schema'] = form.schema;\n    entry.overriddenSchema = form.schema;\n\n    entry['_type'] = 'TimeEntry';\n    entry['id'] = 'new';\n    entry['hours'] = 'PT1H';\n\n    // Set update link to form\n    entry['update'] = entry.$links['update'] = form.$links.self;\n    // Use POST /work_packages for saving link\n    entry['updateImmediately'] = entry.$links['updateImmediately'] = (payload:{}) => {\n      return this.timeEntryDm.create(payload);\n    };\n\n    entry.state.putValue(entry);\n\n    return entry;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\n\nimport {OpenprojectCommonModule} from 'core-app/modules/common/openproject-common.module';\nimport {AttachmentsComponent} from \"core-app/modules/attachments/attachments.component\";\nimport {AttachmentListComponent} from \"core-app/modules/attachments/attachment-list/attachment-list.component\";\nimport {AttachmentListItemComponent} from \"core-app/modules/attachments/attachment-list/attachment-list-item.component\";\nimport {AttachmentsUploadComponent} from \"core-app/modules/attachments/attachments-upload/attachments-upload.component\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n  ],\n  declarations: [\n    AttachmentsComponent,\n    AttachmentListComponent,\n    AttachmentListItemComponent,\n    AttachmentsUploadComponent,\n  ],\n  exports: [\n    AttachmentsUploadComponent,\n    AttachmentListComponent,\n    AttachmentsComponent,\n  ]\n})\nexport class OpenprojectAttachmentsModule {\n}\n\n","import {Injector} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {SingleRowBuilder} from \"core-components/wp-fast-table/builders/rows/single-row-builder\";\nimport {WorkPackageTable} from \"core-components/wp-fast-table/wp-fast-table\";\nimport {States} from \"core-components/states.service\";\nimport {\n  collapsedGroupClass,\n  hierarchyGroupClass,\n  hierarchyRootClass\n} from \"core-components/wp-fast-table/helpers/wp-table-hierarchy-helpers\";\nimport {WorkPackageViewHierarchiesService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-hierarchy.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport const indicatorCollapsedClass = '-hierarchy-collapsed';\nexport const hierarchyCellClassName = 'wp-table--hierarchy-span';\nexport const additionalHierarchyRowClassName = 'wp-table--hierarchy-aditional-row';\nexport const hierarchyIndentation = 20;\nexport const hierarchyBaseIndentation = 25;\n\nexport class SingleHierarchyRowBuilder extends SingleRowBuilder {\n  // Injected\n  @InjectField() public wpTableHierarchies:WorkPackageViewHierarchiesService;\n  @InjectField() public states:States;\n\n  // Retain a map of hierarchy elements present in the table\n  // with at least a visible child\n  public parentsWithVisibleChildren:{ [id:string]:boolean };\n\n  public text:{\n    leaf:(level:number) => string;\n    expanded:(level:number) => string;\n    collapsed:(level:number) => string;\n  };\n\n  constructor(public readonly injector:Injector,\n              protected workPackageTable:WorkPackageTable) {\n\n    super(injector, workPackageTable);\n\n    this.text = {\n      leaf: (level:number) => this.I18n.t('js.work_packages.hierarchy.leaf', {level: level}),\n      expanded: (level:number) => this.I18n.t('js.work_packages.hierarchy.children_expanded',\n        {level: level}),\n      collapsed: (level:number) => this.I18n.t('js.work_packages.hierarchy.children_collapsed',\n        {level: level}),\n    };\n  }\n\n  /**\n   * Refresh a single row after structural changes.\n   * Remembers and re-adds the hierarchy indicator if neccessary.\n   */\n  public refreshRow(workPackage:WorkPackageResource, jRow:JQuery):JQuery {\n    // Remove any old hierarchy\n    const newRow = super.refreshRow(workPackage, jRow);\n    newRow.find(`.wp-table--hierarchy-span`).remove();\n    this.appendHierarchyIndicator(workPackage, newRow);\n\n    return newRow;\n  }\n\n  /**\n   * Build the columns on the given empty row\n   */\n  public buildEmpty(workPackage:WorkPackageResource):[HTMLTableRowElement, boolean] {\n    let [element, _] = super.buildEmpty(workPackage);\n    let [classes, hidden] = this.ancestorRowData(workPackage);\n    element.classList.add(...classes);\n\n    this.appendHierarchyIndicator(workPackage, jQuery(element));\n    return [element, hidden];\n  }\n\n  /**\n   * Returns a set of\n   * @param workPackage\n   */\n  public ancestorRowData(workPackage:WorkPackageResource):[string[], boolean] {\n    const state = this.wpTableHierarchies.current;\n    const rowClasses:string[] = [];\n    let hidden = false;\n\n    if (this.parentsWithVisibleChildren[workPackage.id!]) {\n      rowClasses.push(hierarchyRootClass(workPackage.id!));\n    }\n\n    if (_.isArray(workPackage.ancestors)) {\n      workPackage.ancestors.forEach((ancestor) => {\n        rowClasses.push(hierarchyGroupClass(ancestor.id!));\n\n        if (state.collapsed[ancestor.id!]) {\n          hidden = true;\n          rowClasses.push(collapsedGroupClass(ancestor.id!));\n        }\n\n      });\n    }\n\n    return [rowClasses, hidden];\n  }\n\n  /**\n   * Append an additional ancestor row that is not yet loaded\n   */\n  public buildAncestorRow(ancestor:WorkPackageResource,\n                          ancestorGroups:string[],\n                          index:number):[HTMLTableRowElement, boolean] {\n\n    const workPackage = this.states.workPackages.get(ancestor.id!).value!;\n    const [tr, hidden] = this.buildEmpty(workPackage);\n    tr.classList.add(additionalHierarchyRowClassName);\n    return [tr, hidden];\n  }\n\n  /**\n   * Append to the row of hierarchy level <level> a hierarchy indicator.\n   * @param workPackage\n   * @param jRow jQuery row element\n   * @param level Indentation level\n   */\n  private appendHierarchyIndicator(workPackage:WorkPackageResource, jRow:JQuery, level?:number):void {\n    const hierarchyLevel = level === undefined || null ? workPackage.ancestors.length : level;\n    const hierarchyElement = this.buildHierarchyIndicator(workPackage, jRow, hierarchyLevel);\n\n    jRow.find('td.subject')\n      .addClass('-with-hierarchy')\n      .prepend(hierarchyElement);\n\n    // Assure that the content is still visble when the hierarchy indentation is very large\n    jRow.find('td.subject').css('minWidth', 125 + (hierarchyIndentation * hierarchyLevel) + 'px');\n    jRow.find('td.subject .wp-table--cell-container')\n      .css('width', 'calc(100% - ' + hierarchyBaseIndentation + 'px - ' + (hierarchyIndentation * hierarchyLevel) + 'px)');\n  }\n\n  /**\n   * Build the hierarchy indicator at the given indentation level.\n   */\n  private buildHierarchyIndicator(workPackage:WorkPackageResource, jRow:JQuery|null, level:number):HTMLElement {\n    const hierarchyIndicator = document.createElement('span');\n    const collapsed = this.wpTableHierarchies.collapsed(workPackage.id!);\n    const indicatorWidth = hierarchyBaseIndentation + (hierarchyIndentation * level) + 'px';\n    hierarchyIndicator.classList.add(hierarchyCellClassName);\n    hierarchyIndicator.style.width = indicatorWidth;\n    hierarchyIndicator.dataset.indentation = indicatorWidth;\n\n    if (this.parentsWithVisibleChildren[workPackage.id!]) {\n      const className = collapsed ? indicatorCollapsedClass : '';\n      hierarchyIndicator.innerHTML = `\n            <a href tabindex=\"0\" role=\"button\" class=\"wp-table--hierarchy-indicator ${className}\">\n              <span class=\"wp-table--hierarchy-indicator-icon\" aria-hidden=\"true\"></span>\n              <span class=\"wp-table--hierarchy-indicator-expanded hidden-for-sighted\">${this.text.expanded(\n        level)}</span>\n              <span class=\"wp-table--hierarchy-indicator-collapsed hidden-for-sighted\">${this.text.collapsed(\n        level)}</span>\n            </a>\n        `;\n    } else {\n      hierarchyIndicator.innerHTML = `\n            <span tabindex=\"0\" class=\"wp-table--leaf-indicator\">\n              <span class=\"hidden-for-sighted\">${this.text.leaf(level)}</span>\n            </span>\n        `;\n    }\n\n    return hierarchyIndicator;\n  }\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {BcfPathHelperService} from \"core-app/modules/bim/bcf/helper/bcf-path-helper.service\";\n\n@Component({\n  template: `\n    <a [title]=\"text.import\" class=\"button import-bcf-button\" (click)=\"handleClick()\">\n      <op-icon icon-classes=\"button--icon icon-import\"></op-icon>\n      <span class=\"button--text\"> {{text.import}} </span>\n    </a>\n  `,\n  selector: 'bcf-import-button',\n})\nexport class BcfImportButtonComponent {\n  public text = {\n    import: this.I18n.t('js.bcf.import')\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly currentProject:CurrentProjectService,\n              readonly bcfPathHelper:BcfPathHelperService) {\n  }\n\n  public handleClick() {\n    var projectIdentifier = this.currentProject.identifier;\n    if (projectIdentifier) {\n      var url = this.bcfPathHelper.projectImportIssuePath(projectIdentifier);\n      window.location.href = url;\n    }\n  }\n}\n","import { ElementRef, Inject, ChangeDetectorRef, ViewChild, Directive, Injector } from \"@angular/core\";\nimport {OpModalComponent} from \"app/components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"app/components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"app/components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {TimeEntryFormComponent} from \"core-app/modules/time_entries/form/form.component\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport { InjectField } from 'core-app/helpers/angular/inject-field.decorator';\nimport { WorkPackageCacheService } from 'core-app/components/work-packages/work-package-cache.service';\n\n@Directive()\nexport abstract class TimeEntryBaseModal extends OpModalComponent {\n  @ViewChild('editForm', { static: true }) editForm:TimeEntryFormComponent;\n\n  public text:{ [key:string]:string } = {\n    title: this.i18n.t('js.time_entry.title'),\n    cancel: this.i18n.t('js.button_cancel'),\n    close: this.i18n.t('js.button_close'),\n    delete: this.i18n.t('js.button_delete'),\n    areYouSure: this.i18n.t('js.text_are_you_sure'),\n  };\n\n  public closeOnEscape = false;\n  public closeOnOutsideClick = false;\n\n  @InjectField() workPackageCacheService:WorkPackageCacheService;\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) readonly locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly i18n:I18nService,\n              readonly injector:Injector) {\n    super(locals, cdRef, elementRef);\n  }\n\n  public abstract setModifiedEntry($event:{savedResource:HalResource, isInital:boolean}):void;\n\n  public get entry() {\n    return this.locals.entry;\n  }\n\n  public get showWorkPackageField() {\n    return this.locals.showWorkPackageField !== undefined ? this.locals.showWorkPackageField : true;\n  }\n\n  public saveEntry() {\n    this.editForm.save()\n      .then(() => {\n        // reload workPackage\n        if (this.entry.workPackage) {\n          this.workPackageCacheService.require(this.entry.workPackage.id, true);\n        }\n        this.service.close();\n      });\n  }\n\n  public get saveText() {\n    return this.i18n.t('js.button_save');\n  }\n\n  public get saveAllowed() {\n    return true;\n  }\n\n  public get deleteAllowed() {\n    return true;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {InputState} from 'reactivestates';\n\nexport class UserResource extends HalResource {\n\n  // Properties\n  public login:string;\n  public firstName:string;\n  public lastName:string;\n  public name:string;\n  public email:string;\n  public avatar:string;\n  public status:string;\n\n  // Links\n  public lock:HalResource;\n  public unlock:HalResource;\n  public delete:HalResource;\n  public showUser:HalResource;\n\n  public static get active_user_statuses() {\n    return ['active', 'registered'];\n  }\n\n  public get state():InputState<this> {\n    return this.states.users.get(this.href as string) as any;\n  }\n\n  public get showUserPath() {\n    return this.showUser ? this.showUser.$link.href : null;\n  }\n\n  public get isActive() {\n    return UserResource.active_user_statuses.indexOf(this.status) >= 0;\n  }\n}\n","import {Component, OnInit} from \"@angular/core\";\nimport {Observable} from \"rxjs\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {BoardCacheService} from \"core-app/modules/boards/board/board-cache.service\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {MainMenuNavigationService} from \"core-components/main-menu/main-menu-navigation.service\";\nimport {map} from \"rxjs/operators\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const boardsMenuSelector = 'boards-menu';\n\n@Component({\n  selector: boardsMenuSelector,\n  templateUrl: './boards-menu.component.html'\n})\n\nexport class BoardsMenuComponent extends UntilDestroyedMixin implements OnInit {\n  trackById = AngularTrackingHelpers.compareByAttribute('id');\n\n  currentProjectIdentifier = this.currentProject.identifier;\n\n  selectedBoardId:string;\n\n  public boards$:Observable<Board[]> = this.boardCache.observeAll().pipe(\n    map((boards:Board[]) => {\n      return boards.sort(function (a, b) {\n        if (a.name < b.name) {\n          return -1;\n        }\n        if (a.name > b.name) {\n          return 1;\n        }\n        return 0;\n      });\n    })\n  );\n\n  constructor(private readonly boardService:BoardService,\n              private readonly boardCache:BoardCacheService,\n              private readonly currentProject:CurrentProjectService,\n              private readonly mainMenuService:MainMenuNavigationService) {\n    super();\n  }\n\n  ngOnInit() {\n    // When activating the boards submenu,\n    // either initially or through click on the toggle, load the results\n    this.mainMenuService\n      .onActivate('board_view')\n      .subscribe(() => {\n        this.focusBackArrow();\n        this.boardService.loadAllBoards();\n      });\n\n    this\n      .boardService\n      .currentBoard$\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((id:string|null) => {\n        this.selectedBoardId = id ? id : '';\n      });\n  }\n\n  private focusBackArrow() {\n    let buttonArrowLeft = jQuery('*[data-name=\"board_view\"] .main-menu--arrow-left-to-project');\n    buttonArrowLeft.focus();\n  }\n}\n","<div *ngIf=\"(boards$ | async) as boards\">\n  <ul class=\"main-menu--children boards--menu-items\">\n    <li *ngFor=\"let board of boards;trackBy:trackById\">\n      <a [textContent]=\"board.name\"\n         uiSref=\"boards.partitioned.show\"\n         [uiOptions]=\"{ reload: true }\"\n         [uiParams]=\"{ board_id: board.id, query_props: '', projects: 'projects', projectPath: currentProjectIdentifier }\"\n         class=\"main-menu--children-sub-item ellipsis\"\n         [ngClass]=\" {'selected': selectedBoardId === board.id }\">\n      </a>\n    </li>\n  </ul>\n</div>\n","import {Injector} from '@angular/core';\nimport {CardEventHandler} from \"core-components/wp-card-view/event-handler/card-view-handler-registry\";\nimport {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {uiStateLinkClass} from \"core-components/wp-fast-table/builders/ui-state-link-builder\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {WorkPackageCardViewService} from \"core-components/wp-card-view/services/wp-card-view.service\";\nimport {OPContextMenuService} from \"core-components/op-context-menu/op-context-menu.service\";\nimport {WorkPackageViewContextMenu} from \"core-components/op-context-menu/wp-context-menu/wp-view-context-menu.directive\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\nexport class CardRightClickHandler implements CardEventHandler {\n\n  // Injections\n  @InjectField() wpTableSelection:WorkPackageViewSelectionService;\n  @InjectField() wpCardView:WorkPackageCardViewService;\n  @InjectField() opContextMenu:OPContextMenuService;\n\n  constructor(public readonly injector:Injector,\n              card:WorkPackageCardViewComponent) {\n  }\n\n  public get EVENT() {\n    return 'contextmenu.cardView.rightclick';\n  }\n\n  public get SELECTOR() {\n    return `.wp-card`;\n  }\n\n  public eventScope(card:WorkPackageCardViewComponent) {\n    return jQuery(card.container.nativeElement);\n  }\n\n  public handleEvent(card:WorkPackageCardViewComponent, evt:JQuery.TriggeredEvent) {\n    let target = jQuery(evt.target);\n\n    // We want to keep the original context menu on hrefs\n    // (currently, this is only the id)\n    if (target.closest(`.${uiStateLinkClass}`).length) {\n      debugLog('Allowing original context menu on state link');\n      return true;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    // Locate the card from event\n    const element = target.closest('wp-single-card');\n    const wpId = element.data('workPackageId');\n\n    if (!wpId) {\n      return true;\n    } else {\n      let classIdentifier = element.data('classIdentifier');\n      let index = this.wpCardView.findRenderedCard(classIdentifier);\n\n      if (!this.wpTableSelection.isSelected(wpId)) {\n        this.wpTableSelection.setSelection(wpId, index);\n      }\n\n      const handler = new WorkPackageViewContextMenu(this.injector, wpId, jQuery(evt.target) as JQuery, {}, card.showInfoButton);\n      this.opContextMenu.show(handler, evt);\n    }\n\n    return false;\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from '@angular/core';\nimport {DateKeys} from \"core-components/datepicker/datepicker.modal\";\nimport {DatePicker} from \"core-app/modules/common/op-date-picker/datepicker\";\n\n@Injectable({ providedIn: 'root' })\nexport class DatepickerHelper {\n  public currentlyActivatedDateField:DateKeys;\n\n  /**\n   * Map the date to the internal format,\n   * setting to null if it's empty.\n   * @param key\n   */\n  public mappedDate(date:string):string|null {\n    return date === '' ? null : date;\n  }\n\n  public parseDate(date:Date|string):Date|'' {\n    if (date instanceof Date) {\n      return date;\n    } else if (date === '') {\n      return '';\n    } else {\n      return new Date(date);\n    }\n  }\n\n  public validDate(date:Date|string) {\n    return (date instanceof Date) ||\n      (date === '') ||\n      !!new Date(date).valueOf();\n  }\n\n  public setCurrentActivatedField(val:DateKeys) {\n    this.currentlyActivatedDateField = val;\n  }\n\n  public toggleCurrentActivatedField(dates:{ [key in DateKeys]:string }, datePicker:DatePicker) {\n    this.currentlyActivatedDateField = this.currentlyActivatedDateField === 'start' ? 'end' : 'start';\n    this.setDatepickerRestrictions(dates, datePicker);\n  }\n\n  public isStateOfCurrentActivatedField(val:DateKeys):boolean {\n    return this.currentlyActivatedDateField === val;\n  }\n\n  public setDatepickerRestrictions(dates:{ [key in DateKeys]:string }, datePicker:DatePicker) {\n    if (this.isStateOfCurrentActivatedField('start')) {\n      datePicker.datepickerInstance.set('minDate', null);\n      datePicker.datepickerInstance.set('maxDate', dates.end);\n    } else {\n      datePicker.datepickerInstance.set('minDate', dates.start);\n      datePicker.datepickerInstance.set('maxDate', null);\n    }\n  }\n\n  public setRangeClasses(dates:{ [key in DateKeys]:string }, datePickerInstance:DatePicker) {\n    if (!dates.start || !dates.end) {\n      return;\n    }\n\n    var selectedElements = document.getElementsByClassName('flatpickr-day selected');\n    if (selectedElements.length === 2) {\n      selectedElements[0].classList.add('startRange');\n      selectedElements[1].classList.add('endRange');\n\n      this.selectRangeFromUntil(selectedElements[0], selectedElements[1]);\n    } else if (selectedElements.length === 1) {\n      // Date range needs to be shown over multiple months\n      if (this.datepickerShowsDate(dates.start, datePickerInstance)) {\n        selectedElements[0].classList.add('startRange');\n        this.selectRangeFromUntil(selectedElements[0], '');\n      } else if (this.datepickerShowsDate(dates.end, datePickerInstance)) {\n        selectedElements[0].classList.add('endRange');\n\n        let firstDay = jQuery('.flatpickr-days .flatpickr-day')[0];\n        firstDay.classList.add('inRange');\n        this.selectRangeFromUntil(firstDay, selectedElements[0]);\n      }\n    } else if (this.datepickerIsInDateRange(dates, datePickerInstance)) {\n      jQuery('.dayContainer .flatpickr-day').addClass('inRange');\n    }\n  }\n\n  private datepickerShowsDate(date:string, datePickerInstance:DatePicker):boolean {\n    return datePickerInstance.datepickerInstance.currentMonth === new Date(date).getMonth() &&\n      datePickerInstance.datepickerInstance.currentYear === new Date(date).getFullYear();\n  }\n\n  private datepickerIsInDateRange(dates:{ [key in DateKeys]:string }, datePickerInstance:DatePicker):boolean {\n    return datePickerInstance.datepickerInstance.currentYear <= new Date(dates.end).getFullYear() &&\n           datePickerInstance.datepickerInstance.currentMonth < new Date(dates.end).getMonth() &&\n           datePickerInstance.datepickerInstance.currentYear >= new Date(dates.start).getFullYear() &&\n           datePickerInstance.datepickerInstance.currentMonth > new Date(dates.start).getMonth();\n  }\n\n  private selectRangeFromUntil(from:Element, until:string|Element) {\n    jQuery(from).nextUntil(until).addClass('inRange');\n  }\n}\n","<div class=\"op-modal--portal -transparent\">\n  <div class=\"op-modal--modal-container datepicker-modal loading-indicator--location\"\n       [attr.id]=\"htmlId\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-body\">\n      <form class=\"form -vertical\">\n        <div class=\"grid-block\">\n          <ng-container *ngIf=\"singleDate\">\n            <div class=\"form--field\">\n              <label class=\"form--label\"\n                     [textContent]=\"text.date\">\n              </label>\n              <div class=\"form--field-container\">\n                <div class=\"form--text-field-container -xslim\">\n                  <input type=\"text\"\n                         name=\"date\"\n                         class=\"form--date-field\"\n                         [ngClass]=\"{'-current' : datepickerHelper.isStateOfCurrentActivatedField('date')}\"\n                         [ngModel]=\"dates.date\"\n                         (ngModelChange)=\"updateDate('date', $event)\"\n                         (click)=\"datepickerHelper.setCurrentActivatedField('date')\">\n                </div>\n              </div>\n            </div>\n          </ng-container>\n\n          <ng-container *ngIf=\"!singleDate\">\n            <div class=\"form--field\">\n              <label class=\"form--label\"\n                     [textContent]=\"text.startDate\">\n              </label>\n              <div class=\"form--field-container\">\n                <div class=\"form--text-field-container -xslim\">\n                  <input type=\"text\"\n                         name=\"startDate\"\n                         class=\"form--date-field\"\n                         [ngClass]=\"{'-current' : datepickerHelper.isStateOfCurrentActivatedField('start')}\"\n                         [ngModel]=\"dates.start\"\n                         (ngModelChange)=\"updateDate('start', $event)\"\n                         (click)=\"datepickerHelper.setCurrentActivatedField('start')\">\n                </div>\n              </div>\n            </div>\n            <div class=\"form--field\">\n              <label class=\"form--label\"\n                     [textContent]=\"text.endDate\">\n              </label>\n              <div class=\"form--field-container\">\n                <div class=\"form--text-field-container -xslim\">\n                  <input type=\"text\"\n                         name=\"endDate\"\n                         class=\"form--date-field\"\n                         [ngClass]=\"{'-current' : datepickerHelper.isStateOfCurrentActivatedField('end')}\"\n                         [ngModel]=\"dates.end\"\n                         (ngModelChange)=\"updateDate('end', $event)\"\n                         (click)=\"datepickerHelper.setCurrentActivatedField('end')\">\n                </div>\n              </div>\n            </div>\n          </ng-container>\n\n          <a (click)=\"clear()\"\n             class=\"datepicker-modal--action\"\n             [textContent]=\"text.clear\">\n          </a>\n        </div>\n        <div class=\"form--field\">\n          <label class=\"form--label-with-check-box\">\n            <div class=\"form--check-box-container\">\n              <input type=\"checkbox\"\n                     name=\"scheduling\"\n                     class=\"form--check-box datepicker-modal--scheduling-action\"\n                     [ngModel]=\"scheduleManually\"\n                     (ngModelChange)=\"changeSchedulingMode()\">\n            </div>\n            {{ text.manualScheduling }}\n          </label>\n        </div>\n      </form>\n\n      <input id=\"flatpickr-input\"\n             hidden>\n\n      <div class=\"datepicker-modal--actions-container\">\n        <a (click)=\"cancel()\"\n           class=\"datepicker-modal--action\"\n           [textContent]=\"text.cancel\">\n        </a>\n        <a (click)=\"save()\"\n           class=\"datepicker-modal--action\"\n           [textContent]=\"text.save\">\n        </a>\n      </div>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Inject,\n  Injector,\n  ViewEncapsulation\n} from \"@angular/core\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {DatePicker} from \"core-app/modules/common/op-date-picker/datepicker\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\nimport {DatepickerHelper} from \"core-components/datepicker/datepicker.helper\";\n\nexport type DateKeys = 'date'|'start'|'end';\n\n@Component({\n  templateUrl: './datepicker.modal.html',\n  styleUrls: ['./datepicker.modal.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class DatePickerModal extends OpModalComponent implements AfterViewInit {\n  @InjectField() I18n:I18nService;\n  @InjectField() timezoneService:TimezoneService;\n  @InjectField() halEditing:HalResourceEditingService;\n  @InjectField() datepickerHelper:DatepickerHelper;\n\n  text = {\n    save: this.I18n.t('js.button_save'),\n    cancel: this.I18n.t('js.button_cancel'),\n    clear: this.I18n.t('js.modals.button_clear_all'),\n    manualScheduling: this.I18n.t('js.scheduling.manual'),\n    date: this.I18n.t('js.work_packages.properties.date'),\n    startDate: this.I18n.t('js.work_packages.properties.startDate'),\n    endDate: this.I18n.t('js.work_packages.properties.dueDate'),\n    placeholder: this.I18n.t('js.placeholders.default')\n  };\n  public onDataUpdated = new EventEmitter<string>();\n\n  public singleDate = false;\n\n  public scheduleManually = false;\n\n  public htmlId:string = '';\n\n  public dates:{ [key in DateKeys]:string } = {\n    date: '',\n    start: '',\n    end: ''\n  };\n\n  private changeset:ResourceChangeset;\n\n  private datePickerInstance:DatePicker;\n\n  constructor(readonly injector:Injector,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly elementRef:ElementRef) {\n    super(locals, cdRef, elementRef);\n    this.changeset = locals.changeset;\n    this.htmlId = `wp-datepicker-${locals.fieldName}`;\n\n    this.singleDate = this.changeset.isWritable('date');\n    this.scheduleManually = this.changeset.value('scheduleManually');\n\n    if (this.singleDate) {\n      this.dates.date = this.changeset.value('date');\n      this.datepickerHelper.setCurrentActivatedField('date');\n    } else {\n      this.dates.start = this.changeset.value('startDate');\n      this.dates.end = this.changeset.value('dueDate');\n      this.datepickerHelper.setCurrentActivatedField(this.locals.fieldName === 'dueDate' ? 'end' : 'start');\n    }\n  }\n\n  ngAfterViewInit():void {\n    this.initializeDatepicker();\n    this.datepickerHelper.setDatepickerRestrictions(this.dates, this.datePickerInstance);\n    this.datepickerHelper.setRangeClasses(this.dates, this.datePickerInstance);\n\n    this.onDataChange();\n  }\n\n  changeSchedulingMode() {\n    this.scheduleManually = !this.scheduleManually;\n    this.cdRef.detectChanges();\n  }\n\n  save():void {\n    if (this.singleDate) {\n      this.changeset.setValue('date', this.datepickerHelper.mappedDate(this.dates.date));\n    } else {\n      this.changeset.setValue('startDate', this.datepickerHelper.mappedDate(this.dates.start));\n      this.changeset.setValue('dueDate', this.datepickerHelper.mappedDate(this.dates.end));\n    }\n\n    this.changeset.setValue('scheduleManually', this.scheduleManually);\n    this.closeMe();\n  }\n\n  cancel():void {\n    this.closeMe();\n  }\n\n  clear():void {\n    this.dates = {\n      date: '',\n      start: '',\n      end: ''\n    };\n\n    this.datePickerInstance.clear();\n  }\n\n  updateDate(key:DateKeys, val:string) {\n    this.dates[key] = val;\n    if (this.datepickerHelper.validDate(val) && this.datePickerInstance) {\n      this.setDatesToDatepicker();\n    }\n  }\n\n  reposition(element:JQuery<HTMLElement>, target:JQuery<HTMLElement>) {\n    element.position({\n      my: 'left top',\n      at: 'left bottom',\n      of: target,\n      collision: 'flipfit'\n    });\n  }\n\n  private initializeDatepicker() {\n    this.datePickerInstance = new DatePicker(\n      '#flatpickr-input',\n      this.singleDate ? this.dates.date : [this.dates.start, this.dates.end],\n      {\n        mode: this.singleDate ? 'single' : 'multiple',\n        inline: true,\n        onChange: (dates:Date[]) => {\n          this.onDatePickerChange(dates);\n\n          this.onDataChange();\n        },\n        onMonthChange: () => { this.datepickerHelper.setRangeClasses(this.dates, this.datePickerInstance); },\n        onYearChange: () => { this.datepickerHelper.setRangeClasses(this.dates, this.datePickerInstance); },\n      }\n    );\n  }\n\n  private setDatesToDatepicker() {\n    if (this.singleDate) {\n      let date = this.datepickerHelper.parseDate(this.dates.date);\n      this.datePickerInstance.setDates(date);\n    } else {\n      let dates = [this.datepickerHelper.parseDate(this.dates.start), this.datepickerHelper.parseDate(this.dates.end)];\n      this.datePickerInstance.setDates(dates);\n    }\n  }\n\n  private onDatePickerChange(dates:Date[]) {\n    switch (dates.length) {\n      case 0: {\n        break;\n      }\n      case 1: {\n        if (this.singleDate) {\n          this.dates.date = this.timezoneService.formattedISODate(dates[0]);\n        } else {\n          if (this.dates.start && this.dates.end) {\n            // In case we remove a value by clicking on the selected date within the datepicker\n            this.dates[this.datepickerHelper.currentlyActivatedDateField] = '';\n          } else {\n            this.dates[this.datepickerHelper.currentlyActivatedDateField] = this.timezoneService.formattedISODate(dates[0]);\n            this.datepickerHelper.toggleCurrentActivatedField(this.dates, this.datePickerInstance);\n          }\n        }\n\n        break;\n      }\n      case 2: {\n        if ((!this.dates.end && this.datepickerHelper.isStateOfCurrentActivatedField('start')) ||\n            (!this.dates.start && this.datepickerHelper.isStateOfCurrentActivatedField('end'))) {\n          // If we change a start date when no end date is set, we keep only the newly clicked value and not both\n          this.datePickerInstance.setDates([dates[1]]);\n          this.onDatePickerChange([dates[1]]);\n        } else {\n          // Sort dates so that the start date is always first\n          if (dates[0] > dates[1]) {\n            dates.sort(function(a:Date, b:Date) {\n              return a.getTime() - b.getTime();\n            });\n            this.datePickerInstance.setDates([dates[0], dates[1]]);\n          }\n\n          let index = this.datepickerHelper.isStateOfCurrentActivatedField('start') ? 0 : 1;\n          this.dates[this.datepickerHelper.currentlyActivatedDateField] = this.timezoneService.formattedISODate(dates[index]);\n\n          this.datepickerHelper.toggleCurrentActivatedField(this.dates, this.datePickerInstance);\n          this.datepickerHelper.setRangeClasses(this.dates, this.datePickerInstance);\n        }\n\n        break;\n      }\n      default: {\n        // Reset the date picker with the two new values\n        if (this.datepickerHelper.isStateOfCurrentActivatedField('start')) {\n          this.datePickerInstance.setDates([dates[2], dates[1]]);\n          this.onDatePickerChange([dates[2], dates[1]]);\n        } else {\n          this.datePickerInstance.setDates([dates[0], dates[2]]);\n          this.onDatePickerChange([dates[0], dates[2]]);\n        }\n\n        break;\n      }\n    }\n\n    this.cdRef.detectChanges();\n  }\n\n  private onDataChange() {\n    let date = this.dates.date || '';\n    let start = this.dates.start || '';\n    let end = this.dates.end || '';\n\n    let output = this.singleDate ? date : start + ' - ' + end;\n    this.onDataUpdated.emit(output);\n  }\n}\n","import {Component, Injector, ViewChild} from '@angular/core';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {WorkPackageViewHighlightingService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {States} from \"core-app/components/states.service\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\n\n@Component({\n  templateUrl: './highlighting-tab.component.html'\n})\nexport class WpTableConfigurationHighlightingTab implements TabComponent {\n\n  // Display mode\n  public highlightingMode:HighlightingMode = 'inline';\n  public entireRowMode:boolean = false;\n  public lastEntireRowAttribute:HighlightingMode = 'status';\n  public eeShowBanners:boolean = false;\n\n  public availableInlineHighlightedAttributes:HalResource[] = [];\n  public selectedAttributes:any[] = [];\n\n  public availableRowHighlightedAttributes:{name:string; value:HighlightingMode}[] = [];\n\n  @ViewChild('highlightedAttributesNgSelect') public highlightedAttributesNgSelect:NgSelectComponent;\n  @ViewChild('rowHighlightNgSelect') public rowHighlightNgSelect:NgSelectComponent;\n\n  public text = {\n    title: this.I18n.t('js.work_packages.table_configuration.highlighting'),\n    highlighting_mode: {\n      description: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.description'),\n      none: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.none'),\n      inline: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.inline'),\n      inline_all_attributes: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.inline_all'),\n      status: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.status'),\n      type: this.I18n.t('js.work_packages.properties.type'),\n      priority: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.priority'),\n      entire_row_by: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.entire_row_by'),\n    },\n    upsaleAttributeHighlighting: this.I18n.t('js.work_packages.table_configuration.upsale.attribute_highlighting'),\n    upsaleCheckOutLink: this.I18n.t('js.work_packages.table_configuration.upsale.check_out_link')\n  };\n\n  constructor(readonly injector:Injector,\n              readonly I18n:I18nService,\n              readonly states:States,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly Banners:BannersService,\n              readonly wpTableHighlight:WorkPackageViewHighlightingService) {\n  }\n\n  ngOnInit() {\n    this.availableInlineHighlightedAttributes = this.availableHighlightedAttributes;\n    this.availableRowHighlightedAttributes = [\n      {name: this.text.highlighting_mode.status, value: 'status'},\n      {name: this.text.highlighting_mode.priority, value: 'priority'},\n    ];\n\n    this.setSelectedValues();\n\n    this.eeShowBanners = this.Banners.eeShowBanners;\n    this.updateMode(this.wpTableHighlight.current.mode);\n\n    if (this.eeShowBanners) {\n      this.updateMode('none');\n    }\n  }\n\n  public onSave() {\n    let mode = this.highlightingMode;\n    this.wpTableHighlight.update({ mode: mode, selectedAttributes: this.selectedAttributes });\n  }\n\n  public updateMode(mode:HighlightingMode | 'entire-row') {\n    if (mode === 'entire-row') {\n      this.highlightingMode = this.lastEntireRowAttribute;\n    } else {\n      this.highlightingMode = mode;\n    }\n\n    if (['status', 'priority'].indexOf(this.highlightingMode) !== -1) {\n      this.lastEntireRowAttribute = this.highlightingMode;\n      this.entireRowMode = true;\n    } else {\n      this.entireRowMode = false;\n    }\n  }\n\n  public updateHighlightingAttributes(model:HalResource[]) {\n    this.selectedAttributes = model;\n  }\n\n  public disabledValue(value:boolean):string | null {\n    return value ? 'disabled' : null;\n  }\n\n  public get availableHighlightedAttributes():HalResource[] {\n    const schema = this.querySpace.queryForm.value!.schema;\n    return schema.highlightedAttributes.allowedValues;\n  }\n\n  public onOpen(component:any) {\n    setTimeout(() => {\n      if (component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n    }, 25);\n  }\n\n  private setSelectedValues() {\n    const currentValues = this.wpTableHighlight.current.selectedAttributes;\n    if (currentValues === undefined) {\n      this.selectedAttributes = this.availableInlineHighlightedAttributes;\n    } else {\n      this.selectedAttributes = currentValues;\n    }\n  }\n}\n","<div>\n  <enterprise-banner class=\"ee-attribute-highlighting-upsale\"\n                     *ngIf=\"eeShowBanners\"\n                     [linkMessage]=\"text.upsaleCheckOutLink\"\n                     [textMessage]=\"text.upsaleAttributeHighlighting\"\n                     opReferrer=\"wp-attribute-highlighting#attribute-highlighting\">\n  </enterprise-banner>\n  <form>\n    <p [textContent]=\"text.highlighting_mode.description\"></p>\n    <div class=\"form--field\">\n      <label class=\"form--label\">\n        <input type=\"radio\"\n               [attr.disabled]=\"disabledValue(eeShowBanners)\"\n               [(ngModel)]=\"highlightingMode\"\n               (change)=\"updateMode($event.target.value)\"\n               value=\"inline\"\n               name=\"highlighting_mode_switch\">\n        <span [textContent]=\"text.highlighting_mode.inline\"></span>&nbsp;\n      </label>\n      \n      <div class=\"form--field-container\">\n        <div class=\"form--select-container\">\n          <ng-select #highlightedAttributesNgSelect\n                     [items]=\"availableInlineHighlightedAttributes\"\n                     [(ngModel)]=\"selectedAttributes\"\n                     [multiple]=\"true\"\n                     [disabled]=\"highlightingMode !== 'inline'\"\n                     [clearable]=\"false\"\n                     [closeOnSelect]=\"false\"\n                     (open)=\"onOpen(highlightedAttributesNgSelect)\"\n                     (change)=\"updateHighlightingAttributes($event)\"\n                     class=\"form--select-field -multi-select\"\n                     bindLabel=\"name\"\n                     name=\"highlighting_attributes\"\n                     appendTo=\"body\">\n          </ng-select>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"form--field\">\n      <label class=\"form--label\">\n        <input type=\"radio\"\n               [attr.disabled]=\"disabledValue(eeShowBanners)\"\n               [(ngModel)]=\"entireRowMode\"\n               (change)=\"updateMode('entire-row')\"\n               [value]=\"true\"\n               name=\"entire_row_switch\">\n        <span [textContent]=\"text.highlighting_mode.entire_row_by\"></span>\n      </label>\n\n      <div class=\"form--field-container\">\n        <div class=\"form--select-container\">\n          <ng-select #rowHighlightNgSelect\n                     [items]=\"availableRowHighlightedAttributes\"\n                     [(ngModel)]=\"lastEntireRowAttribute\"\n                     [disabled]=\"disabledValue(eeShowBanners)\"\n                     [clearable]=\"false\"\n                     (open)=\"onOpen(rowHighlightNgSelect)\"\n                     (change)=\"updateMode($event.value)\"\n                     bindLabel=\"name\"\n                     bindValue=\"value\"\n                     name=\"selected_attribute\"\n                     appendTo=\"body\"\n                     id=\"selected_attribute\"\n                     class=\"form--select-field\">\n          </ng-select>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"form--field\">\n      <label class=\"form--label\">\n        <input type=\"radio\"\n               [attr.disabled]=\"disabledValue(eeShowBanners)\"\n               [(ngModel)]=\"highlightingMode\"\n               (change)=\"updateMode($event.target.value)\"\n               value=\"none\"\n               name=\"highlighting_mode_switch\">\n        <span [textContent]=\"text.highlighting_mode.none\"></span>\n      </label>\n    </div>\n  </form>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, OnInit} from '@angular/core';\nimport {Transition} from '@uirouter/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {LoadingIndicatorService} from 'core-app/modules/common/loading-indicator/loading-indicator.service';\nimport {WorkPackageCacheService} from 'core-components/work-packages/work-package-cache.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageWatchersService} from 'core-components/wp-single-view-tabs/watchers-tab/wp-watchers.service';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\n@Component({\n  templateUrl: './watchers-tab.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'wp-watchers-tab',\n})\nexport class WorkPackageWatchersTabComponent extends UntilDestroyedMixin implements OnInit {\n  public workPackageId:string;\n  public workPackage:WorkPackageResource;\n  public trackByHref = AngularTrackingHelpers.trackByHref;\n\n  public error = false;\n  public noResults:boolean = false;\n  public allowedToView = false;\n  public allowedToAdd = false;\n  public allowedToRemove = false;\n  public availableWatchersPath:string;\n  private $element:JQuery;\n\n  public watching:any[] = [];\n  public text = {\n    loading: this.I18n.t('js.watchers.label_loading'),\n    loadingError: this.I18n.t('js.watchers.label_error_loading'),\n    autocomplete: {\n      placeholder: this.I18n.t('js.watchers.typeahead_placeholder')\n    }\n  };\n\n  public constructor(readonly I18n:I18nService,\n                     readonly elementRef:ElementRef,\n                     readonly wpWatchersService:WorkPackageWatchersService,\n                     readonly $transition:Transition,\n                     readonly notificationService:WorkPackageNotificationService,\n                     readonly loadingIndicator:LoadingIndicatorService,\n                     readonly wpCacheService:WorkPackageCacheService,\n                     readonly cdRef:ChangeDetectorRef,\n                     readonly pathHelper:PathHelperService) {\n    super();\n  }\n\n  public ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.workPackageId = this.$transition.params('to').workPackageId;\n    this.wpCacheService.loadWorkPackage(this.workPackageId)\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.workPackage = wp;\n        this.loadCurrentWatchers();\n      });\n\n    this.availableWatchersPath = this.pathHelper.api.v3.work_packages.id(this.workPackageId).available_watchers;\n  }\n\n  public loadCurrentWatchers() {\n    this.error = false;\n    this.allowedToView = !!this.workPackage.watchers;\n    this.allowedToAdd = !!this.workPackage.addWatcher;\n    this.allowedToRemove = !!this.workPackage.removeWatcher;\n\n    if (!this.allowedToView) {\n      this.error = true;\n      return;\n    }\n\n    this.wpWatchersService.require(this.workPackage)\n      .then((watchers:HalResource[]) => {\n        this.watching = watchers;\n        this.cdRef.detectChanges();\n      })\n      .catch((error:any) => {\n        this.notificationService.showError(error, this.workPackage);\n      });\n  }\n\n  public set loadingPromise(promise:Promise<any>) {\n    this.loadingIndicator.wpDetails.promise = promise;\n  }\n\n\n  public addWatcher(user:any) {\n    this.loadingPromise = this.workPackage.addWatcher.$link.$fetch({ user: { href: user.href } })\n      .then(() => {\n        // Forcefully reload the resource to update the watch/unwatch links\n        // should the current user have been added\n        this.wpWatchersService.require(this.workPackage, true);\n        this.wpCacheService.loadWorkPackage(this.workPackage.id!, true);\n        this.cdRef.detectChanges();\n      })\n      .catch((error:any) => this.notificationService.showError(error, this.workPackage));\n  }\n\n  public removeWatcher(watcher:any) {\n    this.workPackage.removeWatcher.$link.$prepare({ user_id: watcher.id })()\n      .then(() => {\n        _.remove(this.watching, (other:HalResource) => {\n          return other.href === watcher.href;\n        });\n\n        // Forcefully reload the resource to update the watch/unwatch links\n        // should the current user have been removed\n        this.wpWatchersService.require(this.workPackage, true);\n        this.wpCacheService.loadWorkPackage(this.workPackage.id!, true);\n        this.cdRef.detectChanges();\n      })\n      .catch((error:any) => this.notificationService.showError(error, this.workPackage));\n  }\n}\n","<div id=\"detail-panel-watchers\">\n  <div class=\"notification-box -error\"\n       *ngIf=\"error\">\n    <div class=\"notification-box--content\">\n      <p [textContent]=\"text.loadingError\"></p>\n    </div>\n  </div>\n  <div [hidden]=\"error\">\n    <div class=\"work-package--watchers form--selected-value--list\"\n         [ngClass]=\"{'-read-only': !allowedToRemove}\">\n\n      <wp-watcher-entry\n                  *ngFor=\"let watcher of watching; trackBy:trackByHref\"\n                  [watcher]=\"watcher\">\n      </wp-watcher-entry>\n    </div>\n    <div class=\"work-package--watchers-lookup hide-when-print\"\n         [hidden]=\"!allowedToAdd\">\n      <form name=\"watcherForm\" novalidate>\n        <user-autocompleter [clearAfterSelection]=\"true\"\n                            (onChange)=\"addWatcher($event)\"\n                            [url]=\"availableWatchersPath\"\n                            class=\"wp-watcher--autocomplete\">\n        </user-autocompleter>\n      </form>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectorRef, Directive, Injector, OnInit, ViewChild} from '@angular/core';\nimport {StateService, Transition} from '@uirouter/core';\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {States} from '../states.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {RootResource} from 'core-app/modules/hal/resources/root-resource';\nimport {WorkPackageCacheService} from '../work-packages/work-package-cache.service';\nimport {WorkPackageCreateService} from './wp-create.service';\nimport {takeWhile} from 'rxjs/operators';\nimport {RootDmService} from 'core-app/modules/hal/dm-services/root-dm.service';\nimport {OpTitleService} from 'core-components/html/op-title.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {WorkPackageViewFocusService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service\";\nimport {EditFormComponent} from \"core-app/modules/fields/edit/edit-form/edit-form.component\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport * as URI from 'urijs';\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {splitViewRoute} from \"core-app/modules/work_packages/routing/split-view-routes.helper\";\n\n@Directive()\nexport class WorkPackageCreateComponent extends UntilDestroyedMixin implements OnInit {\n  public successState:string = splitViewRoute(this.$state);\n  public cancelState:string = this.$state.current.data.baseRoute;\n  public newWorkPackage:WorkPackageResource;\n  public parentWorkPackage:WorkPackageResource;\n  public change:WorkPackageChangeset;\n\n  /** Are we in the copying substates ? */\n  public copying = false;\n\n  public stateParams = this.$transition.params('to');\n  public text = {\n    button_settings: this.I18n.t('js.button_settings')\n  };\n\n  @ViewChild(EditFormComponent, { static: false }) protected editForm:EditFormComponent;\n\n  /** Explicitly remember destroy state in this abstract base */\n  protected destroyed = false;\n\n  constructor(public readonly injector:Injector,\n              protected readonly $transition:Transition,\n              protected readonly $state:StateService,\n              protected readonly I18n:I18nService,\n              protected readonly titleService:OpTitleService,\n              protected readonly notificationService:WorkPackageNotificationService,\n              protected readonly states:States,\n              protected readonly wpCreate:WorkPackageCreateService,\n              protected readonly wpViewFocus:WorkPackageViewFocusService,\n              protected readonly wpTableFilters:WorkPackageViewFiltersService,\n              protected readonly wpCacheService:WorkPackageCacheService,\n              protected readonly pathHelper:PathHelperService,\n              protected readonly cdRef:ChangeDetectorRef,\n              protected readonly RootDm:RootDmService) {\n    super();\n  }\n\n  public ngOnInit() {\n    this.closeEditFormWhenNewWorkPackageSaved();\n\n    this.showForm();\n  }\n\n  public ngOnDestroy() {\n    super.ngOnDestroy();\n  }\n\n  public switchToFullscreen() {\n    this.$state.go('work-packages.new', this.$state.params);\n  }\n\n  public onSaved(params:{ savedResource:WorkPackageResource, isInitial:boolean }) {\n    let { savedResource, isInitial } = params;\n\n    this.editForm?.cancel(false);\n\n    if (this.successState) {\n      this.$state.go(this.successState, { workPackageId: savedResource.id })\n        .then(() => {\n          this.wpViewFocus.updateFocus(savedResource.id!);\n          this.notificationService.showSave(savedResource, isInitial);\n        });\n    }\n  }\n\n  protected showForm() {\n    this\n      .createdWorkPackage()\n      .then((changeset:WorkPackageChangeset) => {\n        this.change = changeset;\n        this.newWorkPackage = changeset.pristineResource;\n        this.cdRef.detectChanges();\n\n        this.setTitle();\n\n        if (this.stateParams['parent_id']) {\n          changeset.setValue(\n            'parent',\n            { href: this.pathHelper.api.v3.work_packages.id(this.stateParams['parent_id']).path }\n          );\n        }\n\n        // Load the parent simply to display the type name :-/\n        if (this.stateParams['parent_id']) {\n          this.wpCacheService.loadWorkPackage(this.stateParams['parent_id'])\n            .values$()\n            .pipe(\n              this.untilDestroyed()\n            )\n            .subscribe(parent => {\n              this.parentWorkPackage = parent;\n              this.cdRef.detectChanges();\n            });\n        }\n      })\n      .catch((error:any) => {\n        if (error.errorIdentifier === 'urn:openproject-org:api:v3:errors:MissingPermission') {\n          this.RootDm.load().then((root:RootResource) => {\n            if (!root.user) {\n              // Not logged in\n              let url = URI(this.pathHelper.loginPath());\n              url.search({ back_url: url });\n              window.location.href = url.toString();\n            }\n          });\n          this.notificationService.handleRawError(error);\n        }\n      });\n  }\n\n  protected setTitle() {\n    this.titleService.setFirstPart(this.I18n.t('js.work_packages.create.title'));\n  }\n\n  public cancelAndBackToList() {\n    this.wpCreate.cancelCreation();\n    this.$state.go(this.cancelState, this.$state.params);\n  }\n\n  protected createdWorkPackage() {\n    const type = this.stateParams.type ? parseInt(this.stateParams.type) : undefined;\n    const project = this.stateParams.projectPath;\n\n    return this.wpCreate.createOrContinueWorkPackage(project, type);\n  }\n\n  private closeEditFormWhenNewWorkPackageSaved() {\n    this.wpCreate\n      .onNewWorkPackage()\n      .pipe(\n        takeWhile(() => !this.componentDestroyed)\n      )\n      .subscribe((wp:WorkPackageResource) => {\n        this.onSaved({ savedResource: wp, isInitial: true });\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnDestroy, OnInit, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {BcfPathHelperService} from \"core-app/modules/bim/bcf/helper/bcf-path-helper.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {StateService} from \"@uirouter/core\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {WpTableExportModal} from \"core-components/modals/export-modal/wp-table-export.modal\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\n\n@Component({\n  template: `\n    <a [title]=\"text.export\"\n       class=\"button export-bcf-button\"\n       [attr.href]=\"exportLink\"\n       (click)=\"showDelayedExport($event)\">\n      <op-icon icon-classes=\"button--icon icon-export\"></op-icon>\n      <span class=\"button--text\"> {{text.export}} </span>\n    </a>\n  `,\n  selector: 'bcf-export-button',\n})\nexport class BcfExportButtonComponent extends UntilDestroyedMixin implements OnInit, OnDestroy {\n  public text = {\n    export: this.I18n.t('js.bcf.export')\n  };\n  public query:QueryResource;\n  public exportLink:string;\n\n  constructor(readonly I18n:I18nService,\n              readonly currentProject:CurrentProjectService,\n              readonly bcfPathHelper:BcfPathHelperService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly queryUrlParamsHelper:UrlParamsHelperService,\n              readonly opModalService:OpModalService,\n              readonly injector:Injector,\n              readonly state:StateService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.querySpace.query\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((query) => {\n        this.query = query;\n\n        let projectIdentifier = this.currentProject.identifier;\n        let filters = this.queryUrlParamsHelper.buildV3GetFilters(this.query.filters);\n        this.exportLink = this.bcfPathHelper.projectExportIssuesPath(\n          projectIdentifier!,\n          JSON.stringify(filters)\n        );\n      });\n  }\n\n  public showDelayedExport(event:any) {\n    this.opModalService.show(WpTableExportModal, this.injector, { link: this.exportLink });\n    event.preventDefault();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ConfirmDialogModal} from \"core-components/modals/confirm-dialog/confirm-dialog.modal\";\nimport {Component, ElementRef, OnInit, ViewChild} from \"@angular/core\";\n\n@Component({\n  templateUrl: './password-confirmation.modal.html'\n})\nexport class PasswordConfirmationModal extends ConfirmDialogModal implements OnInit {\n\n  public password_confirmation:string|null = null;\n\n  @ViewChild('passwordConfirmationField', { static: true }) passwordConfirmationField:ElementRef;\n\n  public ngOnInit() {\n    super.ngOnInit();\n\n    this.text.title = I18n.t('js.password_confirmation.title');\n    this.text.field_description = I18n.t('js.password_confirmation.field_description');\n    this.text.confirm_button = I18n.t('js.button_confirm');\n    this.text.password = I18n.t('js.label_password');\n\n    this.closeOnEscape = false;\n    this.closeOnOutsideClick = false;\n    this.showClose = false;\n  }\n\n  public confirmAndClose(evt:JQuery.TriggeredEvent) {\n    if (this.passwordValuePresent()) {\n      super.confirmAndClose(evt);\n    }\n  }\n\n  public onOpen(modalElement:JQuery) {\n    super.onOpen(modalElement);\n    this.passwordConfirmationField.nativeElement.focus();\n  }\n\n  public passwordValuePresent() {\n    return this.password_confirmation !== null && this.password_confirmation.length > 0;\n  }\n}\n","<div class=\"op-modal--portal confirm-form-submit--modal  ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container password-confirm-dialog--modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 class=\"icon-context icon-locked\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"op-modal--modal-body\">\n      <form class=\"request-for-confirmation--form form -vertical\" (submit)=\"confirmAndClose($event)\">\n        <div class=\"form--field -required\">\n          <label class=\"form--label\"\n                 for=\"request_for_confirmation_password\"\n                 [attr.aria-label]=\"text.field_description\"\n                 [textContent]=\"text.password\">\n          </label>\n          <div class=\"form--field-container\">\n            <div class=\"form--text-field-container\">\n              <input type=\"password\"\n                     #passwordConfirmationField\n                     [(ngModel)]=\"password_confirmation\"\n                     id=\"request_for_confirmation_password\"\n                     name=\"request_for_confirmation_password\"\n                     class=\"form--text-field\">\n            </div>\n          </div>\n          <div class=\"form--field-instructions\" [textContent]=\"text.field_description\"></div>\n        </div>\n      </form>\n    </div>\n\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"confirm-form-submit--continue button\"\n              (click)=\"confirmAndClose($event)\"\n              [attr.title]=\"text.confirm_button\"\n              [textContent]=\"text.confirm_button\"\n              [disabled]=\"!passwordValuePresent()\">\n              [attr.title]=\"text.button_cancel\">\n      </button>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, SecurityContext} from \"@angular/core\";\nimport {DomSanitizer, SafeHtml} from \"@angular/platform-browser\";\n\n@Injectable({ providedIn: 'root' })\nexport class HTMLSanitizeService {\n  public constructor(readonly sanitizer:DomSanitizer) { }\n\n  public sanitize(string:string):SafeHtml {\n    return this.sanitizer.sanitize(SecurityContext.HTML, string) || '';\n  }\n}\n","import {ApplicationRef, Injector, NgZone} from \"@angular/core\";\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {ConfirmDialogService} from \"core-components/modals/confirm-dialog/confirm-dialog.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ExternalQueryConfigurationService} from \"core-components/wp-table/external-configuration/external-query-configuration.service\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PasswordConfirmationModal} from \"../../components/modals/request-for-confirmation/password-confirmation.modal\";\nimport {OpModalService} from \"../../components/op-modals/op-modal.service\";\nimport {HelpTextDmService} from \"../hal/dm-services/help-text-dm.service\";\nimport {AttributeHelpTextsService} from \"../common/help-texts/attribute-help-text.service\";\nimport {AttributeHelpTextModal} from \"../common/help-texts/attribute-help-text.modal\";\nimport {DynamicContentModal} from \"../../components/modals/modal-wrapper/dynamic-content.modal\";\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {DisplayFieldService} from \"core-app/modules/fields/display/display-field.service\";\nimport {EditFieldService} from \"core-app/modules/fields/edit/edit-field.service\";\nimport {OpenProjectFileUploadService} from \"core-components/api/op-file-upload/op-file-upload.service\";\nimport {EditorMacrosService} from \"core-components/modals/editor/editor-macros.service\";\nimport {HTMLSanitizeService} from \"../common/html-sanitize/html-sanitize.service\";\nimport {PathHelperService} from \"../common/path-helper/path-helper.service\";\nimport {DynamicBootstrapper} from \"core-app/globals/dynamic-bootstrapper\";\nimport {States} from 'core-components/states.service';\nimport {CKEditorPreviewService} from \"core-app/modules/common/ckeditor/ckeditor-preview.service\";\nimport {ExternalRelationQueryConfigurationService} from \"core-components/wp-table/external-configuration/external-relation-query-configuration.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\n\n/**\n * Plugin context bridge for plugins outside the CLI compiler context\n * in order to access services and parts of the core application\n */\nexport class OpenProjectPluginContext {\n\n  private _knownHookNames = [\n    'workPackageTableContextMenu',\n    'workPackageSingleContextMenu',\n    'workPackageNewInitialization'\n  ];\n\n  // Common services referencable by index\n  public readonly services = {\n    confirmDialog: this.injector.get<ConfirmDialogService>(ConfirmDialogService),\n    externalQueryConfiguration: this.injector.get<ExternalQueryConfigurationService>(ExternalQueryConfigurationService),\n    externalRelationQueryConfiguration: this.injector.get<ExternalRelationQueryConfigurationService>(ExternalRelationQueryConfigurationService),\n    halResource: this.injector.get<HalResourceService>(HalResourceService),\n    hooks: this.injector.get<HookService>(HookService),\n    i18n: this.injector.get<I18nService>(I18nService),\n    notifications: this.injector.get<NotificationsService>(NotificationsService),\n    opModalService: this.injector.get<OpModalService>(OpModalService),\n    opFileUpload: this.injector.get<OpenProjectFileUploadService>(OpenProjectFileUploadService),\n    helpTextDm: this.injector.get<HelpTextDmService>(HelpTextDmService),\n    attributeHelpTexts: this.injector.get<AttributeHelpTextsService>(AttributeHelpTextsService),\n    displayField: this.injector.get<DisplayFieldService>(DisplayFieldService),\n    editField: this.injector.get<EditFieldService>(EditFieldService),\n    wpCache: this.injector.get<WorkPackageCacheService>(WorkPackageCacheService),\n    macros: this.injector.get<EditorMacrosService>(EditorMacrosService),\n    htmlSanitizeService: this.injector.get<HTMLSanitizeService>(HTMLSanitizeService),\n    ckEditorPreview: this.injector.get<CKEditorPreviewService>(CKEditorPreviewService),\n    pathHelperService: this.injector.get<PathHelperService>(PathHelperService),\n    states: this.injector.get<States>(States),\n  };\n\n  // Random collection of classes needed outside of angular\n  public readonly classes = {\n    modals: {\n      passwordConfirmation: PasswordConfirmationModal,\n      attributeHelpTexts: AttributeHelpTextModal,\n      dynamicContent: DynamicContentModal,\n    },\n    HalResource: HalResource,\n    DisplayField: DisplayField\n  };\n\n  // Hooks\n  public readonly hooks:{ [hook:string]:(callback:Function) => void } = {};\n\n  // Angular zone reference\n  @InjectField() public readonly zone:NgZone;\n\n  // Angular2 global injector reference\n  constructor(public readonly injector:Injector) {\n    this\n      ._knownHookNames\n      .forEach((hook:string) => {\n        this.hooks[hook] = (callback:Function) => this.services.hooks.register(hook, callback);\n      });\n  }\n\n  /**\n   * Run the given callback in the angular zone,\n   * resulting in triggered change detection that would otherwise not occur.\n   *\n   * @param cb\n   */\n  public runInZone(cb:() => void) {\n    this.zone.run(cb);\n  }\n\n  /**\n   * Bootstrap a dynamically embeddable component\n   * @param element\n   */\n  public bootstrap(element:HTMLElement) {\n    DynamicBootstrapper.bootstrapOptionalEmbeddable(\n      this.injector.get(ApplicationRef),\n      element\n    );\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++    Ng1FieldControlsWrapper,\n\n\nimport {Injector, NgModule} from \"@angular/core\";\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {OpenProjectPluginContext} from \"core-app/modules/plugins/plugin-context\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\n\n\n@NgModule({\n  providers: [\n    HookService,\n  ],\n})\nexport class OpenprojectPluginsModule {\n  constructor(injector:Injector) {\n    debugLog(\"Registering OpenProject plugin context\");\n    const pluginContext = new OpenProjectPluginContext(injector);\n    window.OpenProject.pluginContext.putValue(pluginContext);\n  }\n}\n\n\n","import {UploadBlob} from \"core-components/api/op-file-upload/op-file-upload.service\";\n\nexport namespace ImageHelpers {\n\n  /**\n   * Resize a file input to the given max dimension, returning the data URL and a blob\n   *\n   * @param {maxSize} Max width or height\n   * @param {File} Input file\n   */\n  export function resizeFile(maxSize:number, file:File):Promise<[string, UploadBlob]> {\n    return new Promise((resolve, _) => {\n      const reader = new FileReader();\n      reader.onload = (readerEvent: any) => {\n        const image = new Image();\n        image.onload = () => resolve(resizeImage(maxSize, image));\n        image.src = readerEvent.target.result;\n      };\n      reader.readAsDataURL(file);\n    });\n  }\n\n  /**\n   * Resize an image to the given max dimension, returning the data URL and a blob\n   * Based on https://stackoverflow.com/a/39235724/420614\n   *\n   * @param {maxSize} Max width or height\n   * @param {HTMLImageElement} Input image\n   */\n  export function resizeImage(maxSize:number, image:HTMLImageElement):[string, UploadBlob] {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d')!;\n\n    let width = image.width;\n    let height = image.height;\n\n    if (width > height) {\n      if (width > maxSize) {\n        height *= maxSize / width;\n        width = maxSize;\n      }\n    } else {\n      if (height > maxSize) {\n        width *= maxSize / height;\n        height = maxSize;\n      }\n    }\n\n    canvas.width = width;\n    canvas.height = height;\n    ctx.drawImage(image, 0, 0, width, height);\n    let dataUrl = canvas.toDataURL('image/jpeg');\n    return [dataUrl, dataURItoBlob(dataUrl)];\n  }\n\n  function dataURItoBlob(dataURI:string) {\n    const bytes = dataURI.split(',')[0].indexOf('base64') >= 0 ?\n      atob(dataURI.split(',')[1]) :\n      unescape(dataURI.split(',')[1]);\n    const mime = dataURI.split(',')[0].split(':')[1].split(';')[0];\n    const max = bytes.length;\n    const ia = new Uint8Array(max);\n    for (var i = 0; i < max; i++) ia[i] = bytes.charCodeAt(i);\n    return new Blob([ia], {type: mime});\n  }\n}\n","<div class=\"form--field\">\n    <label class=\"form--label\"\n           [ngClass]=\"{ '-error':  fileInvalid }\"\n           [textContent]=\"text.label_choose_avatar\"\n           for=\"avatar_file_input\">\n    </label>\n    <div class=\"form--field-container\">\n        <input #avatarFilePicker\n               type=\"file\"\n               accept=\"image/jpeg,image/png,image/gif\"\n               id=\"avatar_file_input\"\n               name=\"avatar_file_input\"\n               (change)=\"onFilePickerChanged($event)\" />\n    </div>\n    <div class=\"form--field-instructions\">\n        <span [textContent]=\"text.upload_instructions\"></span>\n          <div class=\"avatars--error-pane\">\n            <span *ngIf=\"fileInvalid\" [textContent]=\"text.wrong_file_format\"></span>\n          </div>\n    </div>\n</div>\n<fieldset class=\"preview\" *ngIf=\"avatarPreviewUrl\">\n    <legend class=\"preview--legend\" [textContent]=\"text.preview\"></legend>\n    <img [src]=\"avatarPreviewUrl\" class=\"avatars--local-avatar-preview\" />\n</fieldset>\n\n<button type=\"submit\"\n        (click)=\"uploadAvatar($event)\"\n        [attr.disabled]=\"!avatarFile || busy || undefined\"\n        [textContent]=\"text.button_update\"\n        class=\"button -highlight -with-icon icon-checkmark\">\n</button>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\nimport {Component, ElementRef, OnInit, ViewChild} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpenProjectFileUploadService} from \"core-components/api/op-file-upload/op-file-upload.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {UploadFile} from \"core-components/api/op-file-upload/op-file-upload.service\";\nimport {ImageHelpers} from \"core-app/helpers/images/resizer\";\n\n@Component({\n  selector: 'avatar-upload-form',\n  templateUrl: './avatar-upload-form.html'\n})\nexport class AvatarUploadFormComponent implements OnInit {\n  // Form targets\n  public form:any;\n  public target:string;\n  public method:string;\n\n  // File\n  public avatarFile:any;\n  public avatarPreviewUrl:any;\n  public busy:boolean = false;\n  public fileInvalid = false;\n\n  @ViewChild('avatarFilePicker', { static: true }) public avatarFilePicker:ElementRef;\n\n  // Text\n  public text = {\n    label_choose_avatar: this.I18n.t('js.avatars.label_choose_avatar'),\n    upload_instructions: this.I18n.t('js.avatars.text_upload_instructions'),\n    error_too_large: this.I18n.t('js.avatars.error_image_too_large'),\n    wrong_file_format: this.I18n.t('js.avatars.wrong_file_format'),\n    button_update: this.I18n.t('js.button_update'),\n    uploading: this.I18n.t('js.avatars.uploading_avatar'),\n    preview: this.I18n.t('js.label_preview')\n  };\n\n  public constructor(protected I18n:I18nService,\n                     protected elementRef:ElementRef,\n                     protected notificationsService:NotificationsService,\n                     protected opFileUpload:OpenProjectFileUploadService) {\n  }\n\n  public ngOnInit() {\n    const element = this.elementRef.nativeElement;\n    this.target = element.getAttribute('target');\n    this.method = element.getAttribute('method');\n  }\n\n  public onFilePickerChanged(_evt:Event) {\n    const files:UploadFile[] = Array.from(this.avatarFilePicker.nativeElement.files);\n    if (files.length === 0) {\n      return;\n    }\n\n    const file = files[0];\n    if (['image/jpeg', 'image/png', 'image/gif'].indexOf(file.type) === -1) {\n      this.fileInvalid = true;\n      return;\n    }\n\n    ImageHelpers.resizeFile(128, file).then(([dataURL, blob]) => {\n      // Create resized file\n      blob.name = file.name;\n      this.avatarFile = blob;\n      this.avatarPreviewUrl = dataURL;\n    });\n  }\n\n  public uploadAvatar(evt:Event) {\n    evt.preventDefault();\n    this.busy = true;\n    const upload = this.opFileUpload.uploadSingle(this.target, this.avatarFile, this.method, 'text');\n    this.notificationsService.addAttachmentUpload(this.text.uploading, [upload]);\n\n    upload[1].subscribe(\n      (evt:any) => {\n        switch (evt.type) {\n          case 0: // Sent\n            return;\n\n          case 4:\n            this.avatarFile.progress = 100;\n            this.busy = false;\n            window.location.reload();\n            return;\n\n          default:\n            // Sent or unknown event\n            return;\n        }\n      },\n      (error:any) => {\n        this.notificationsService.addError(error.error);\n        this.busy = false;\n      }\n    );\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n\nimport {Injector, NgModule} from '@angular/core';\nimport {CommonModule} from \"@angular/common\";\nimport {AvatarUploadFormComponent} from \"./avatar-upload-form/avatar-upload-form.component\";\nimport {HookService} from \"../../hook-service\";\n\n@NgModule({\n    imports: [\n      CommonModule,\n    ],\n    declarations: [\n        AvatarUploadFormComponent\n    ]\n})\nexport class PluginModule {\n  constructor(injector:Injector) {\n    const hookService = injector.get(HookService);\n    hookService.register('openProjectAngularBootstrap', () => {\n      return [\n        { selector: 'avatar-upload-form', cls: AvatarUploadFormComponent }\n      ];\n    });\n  }\n}\n\n\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\n\ninterface ICostsByType {\n    costObjectId:string;\n    costType:{\n        name:string;\n    };\n    staticPath:{\n        href:string;\n    };\n    spentUnits:number;\n}\n\nexport class CostsByTypeDisplayField extends DisplayField {\n\n    public wpCacheService:any;\n\n    public apply(resource:any, schema:IFieldSchema) {\n        super.apply(resource, schema);\n        this.wpCacheService = this.injector.get(WorkPackageCacheService);\n        this.loadIfNecessary();\n    }\n\n    protected loadIfNecessary() {\n        if (this.value && this.value.$loaded === false) {\n            this.value.$load().then(() => {\n\n                if (this.resource.$source._type === 'WorkPackage') {\n                    this.wpCacheService.touch(this.resource.id!);\n                }\n            });\n        }\n    }\n\n    public get title() {\n        return '';\n    }\n\n    public render(element:HTMLElement, displayText:string):void {\n        if (this.isEmpty()) {\n            element.textContent = this.placeholder;\n            return;\n        }\n\n        this.value.elements.forEach((val:ICostsByType, i:number) => {\n          if (this.resource.showCosts) {\n            this.renderCostAsLink(val, element, i);\n          } else {\n            this.renderCostAsText(val, element, i);\n          }\n        });\n    }\n\n    public isEmpty():boolean {\n        return !this.value ||\n            !this.value.elements ||\n            this.value.elements.length === 0;\n    }\n\n\n  /**\n   * Render link to reporting\n   */\n  private renderCostAsLink(val:ICostsByType, element:HTMLElement, i:number) {\n    const showCosts = this.resource.showCosts;\n    const link = document.createElement('a') as HTMLAnchorElement;\n\n    link.href = showCosts.href + '?cost_type_id=' + val.costObjectId;\n    link.setAttribute('target', '_blank');\n    link.textContent = val.spentUnits + ' ' + val.costType.name;\n    element.appendChild(link);\n\n    this.addSeparator(element, i);\n  }\n\n  /**\n   * Render text\n   */\n  private renderCostAsText(val:ICostsByType, element:HTMLElement, i:number) {\n    const span = document.createElement('span');\n    span.textContent = val.spentUnits + ' ' + val.costType.name;\n\n    this.addSeparator(element, i);\n  }\n\n  private addSeparator(element:HTMLElement, i:Number) {\n    if (i < this.value.elements.length - 1) {\n      const sep = document.createElement('span');\n      sep.textContent = ', ';\n\n      element.appendChild(sep);\n    }\n  }\n}\n\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {DisplayField} from \"core-app/modules/fields/display/display-field.module\";\n\nexport class CurrencyDisplayField extends DisplayField {\n\n    public isEmpty():boolean {\n        return !this.value ||\n            !parseFloat(this.value.match(/\\d+/g)[0]);\n    }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {Attachable} from 'core-app/modules/hal/resources/mixins/attachable-mixin';\n\nexport interface BudgetResourceLinks {\n    addAttachment(attachment:HalResource):Promise<any>;\n}\n\nclass BudgetBaseResource extends HalResource {\n    public $links:BudgetResourceLinks;\n}\n\nexport const BudgetResource = Attachable(BudgetBaseResource);\n\nexport interface BudgetResource extends BudgetBaseResource, BudgetResourceLinks {\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\n\n@Injectable()\nexport class CostSubformAugmentService {\n\n  constructor() {\n    jQuery('costs-subform').each((i, match) => {\n      let el = jQuery(match);\n\n      const container = el.find('.subform-container');\n\n      const templateEl = el.find('.subform-row-template');\n      templateEl.detach();\n      const template = templateEl[0].outerHTML;\n      let rowIndex = parseInt(el.attr('item-count')!);\n\n      el.on('click', '.delete-row-button,.delete-budget-item', (evt:any) => {\n        jQuery(evt.target).closest('.subform-row').remove();\n        return false;\n      });\n\n      // Add new row handler\n      el.find('.add-row-button,.wp-inline-create--add-link').click((evt:any) => {\n        evt.preventDefault();\n        let row = jQuery(template.replace(/INDEX/g, rowIndex.toString()));\n        row.show();\n        row.removeClass('subform-row-template');\n        container.append(row);\n        rowIndex += 1;\n\n        container.find('.subform-row:last-child input:first').focus();\n\n        return false;\n      });\n    });\n  }\n}\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nexport class PlannedCostsFormAugment {\n\n  public obj:JQuery;\n  public objId:string;\n  public objName:string;\n\n  static listen() {\n    jQuery(document).on('click', '.costs--edit-planned-costs-btn', (evt) => {\n      const form = jQuery(evt.target as any).closest('cost-unit-subform') as JQuery;\n      new PlannedCostsFormAugment(form);\n    });\n  }\n\n  constructor(public $element:JQuery) {\n    this.objId = this.$element.attr('obj-id')!;\n    this.objName = this.$element.attr('obj-name')!;\n    this.obj = jQuery(`#${this.objId}_costs`) as any;\n\n    this.makeEditable();\n  }\n\n  public makeEditable() {\n    this.edit_and_focus();\n  }\n\n  private edit_and_focus() {\n    this.edit();\n\n    jQuery('#' + this.objId + '_costs_edit').trigger('focus');\n    jQuery('#' + this.objId + '_costs_edit').trigger('select');\n  }\n\n  private getCurrency() {\n    return jQuery('#' + this.objId + '_currency').val();\n  }\n\n  private getValue() {\n    return jQuery('#' + this.objId + '_cost_value').val();\n  }\n\n  private edit() {\n    this.obj.hide();\n\n    let id = this.obj[0].id;\n    let currency = this.getCurrency();\n    let value = this.getValue();\n    let name = this.objName;\n\n    let template = `\n      <section class=\"form--section\" id=\"${id}_section\">\n        <div class=\"form--field\">\n          <div class=\"form--field-container\">\n            <div id=\"${id}_cancel\" class=\"form--field-affix -transparent icon icon-close\"></div>\n            <div id=\"${id}_editor\" class=\"form--text-field-container\">\n                <input id=\"${id}_edit\" class=\"form--text-field\" name=\"${name}\" value=\"${value}\" class=\"currency\" type=\"text\" />\n            </div>\n            <div class=\"form--field-affix\" id=\"${id}_affix\">${currency}</div>\n          </div>\n        </div>\n      </section>\n    `;\n\n    jQuery(template).insertAfter(this.obj);\n\n    let that = this;\n    jQuery('#' + id + '_cancel').on('click', function () {\n      jQuery('#' + id + '_section').remove();\n      that.obj.show();\n      return false;\n    });\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from \"@angular/core\";\nimport {HttpClient} from '@angular/common/http';\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\n\n@Injectable()\nexport class CostBudgetSubformAugmentService {\n\n  constructor(private halNotification:HalResourceNotificationService,\n              private http:HttpClient) {\n  }\n\n  listen() {\n    jQuery('costs-budget-subform').each((i, match) => {\n      let el = jQuery(match);\n\n      const container = el.find('.budget-item-container');\n      const templateEl = el.find('.budget-row-template');\n      templateEl.detach();\n      const template = templateEl[0].outerHTML;\n      let rowIndex = parseInt(el.attr('item-count') as string);\n\n      // Refresh row on changes\n      el.on('change', '.budget-item-value', (evt) => {\n        let row = jQuery(evt.target).closest('.cost_entry');\n        this.refreshRow(el, row.attr('id') as string);\n      });\n\n      el.on('click', '.delete-budget-item', (evt) => {\n        evt.preventDefault();\n        jQuery(evt.target).closest('.cost_entry').remove();\n        return false;\n      });\n\n      // Add new row handler\n      el.find('.budget-add-row').click((evt) => {\n        evt.preventDefault();\n        let row = jQuery(template.replace(/INDEX/g, rowIndex.toString()));\n        row.show();\n        row.removeClass('budget-row-template');\n        container.append(row);\n        rowIndex += 1;\n        return false;\n      });\n    });\n  }\n\n  /**\n   * Refreshes the given row after updating values\n   */\n  public refreshRow(el:JQuery, row_identifier:string) {\n    let row = el.find('#' + row_identifier);\n    let request = this.buildRefreshRequest(row, row_identifier);\n\n    this.http\n      .post(\n        el.attr('update-url')!,\n        request,\n        {\n          headers: { 'Accept': 'application/json' },\n          withCredentials: true\n        })\n      .subscribe(\n        (data:any) => {\n          _.each(data, (val:string, selector:string) => {\n            let element = document.getElementById(selector) as HTMLElement|HTMLInputElement|undefined;\n            if (element instanceof HTMLInputElement) {\n              element.value = val;\n            } else if (element) {\n              element.textContent = val;\n            }\n          });\n        },\n        (error:any) => this.halNotification.handleRawError(error)\n      );\n  }\n\n  /**\n   * Returns the params for the update request\n   */\n  private buildRefreshRequest(row:JQuery, row_identifier:string) {\n    let request:any = {\n      element_id: row_identifier,\n      fixed_date: jQuery('#cost_object_fixed_date').val()\n    };\n\n    // Augment common values with specific values for this type\n    row.find('.budget-item-value').each((_i:number, el:any) => {\n      let field = jQuery(el);\n      request[field.data('requestKey')] = field.val() || '0';\n    });\n\n    return request;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n\nimport {Injector, NgModule} from '@angular/core';\nimport {OpenProjectPluginContext} from 'core-app/modules/plugins/plugin-context';\nimport {CostsByTypeDisplayField} from './wp-display/costs-by-type-display-field.module';\nimport {CurrencyDisplayField} from './wp-display/currency-display-field.module';\nimport {BudgetResource} from './hal/resources/budget-resource';\nimport {multiInput} from 'reactivestates';\nimport {CostSubformAugmentService} from \"./augment/cost-subform.augment.service\";\nimport {PlannedCostsFormAugment} from \"core-app/modules/plugins/linked/openproject-costs/augment/planned-costs-form\";\nimport {CostBudgetSubformAugmentService} from \"core-app/modules/plugins/linked/openproject-costs/augment/cost-budget-subform.augment.service\";\n\nexport function initializeCostsPlugin(injector:Injector) {\n  window.OpenProject.getPluginContext().then((pluginContext:OpenProjectPluginContext) => {\n    pluginContext.services.editField.extendFieldType('select', ['Budget']);\n\n    let displayFieldService = pluginContext.services.displayField;\n    displayFieldService.extendFieldType('resource', ['Budget']);\n    displayFieldService.addFieldType(CostsByTypeDisplayField, 'costs', ['costsByType']);\n    displayFieldService.addFieldType(CurrencyDisplayField, 'currency', ['laborCosts', 'materialCosts', 'overallCosts']);\n\n    let halResourceService = pluginContext.services.halResource;\n    halResourceService.registerResource('Budget', {cls: BudgetResource});\n\n    pluginContext.hooks.workPackageSingleContextMenu(function (params:any) {\n      return {\n        key: 'log_costs',\n        icon: 'icon-projects',\n        indexBy: function (actions:any) {\n          var index = _.findIndex(actions, {key: 'log_time'});\n          return index !== -1 ? index + 1 : actions.length;\n        },\n        resource: 'workPackage',\n        link: 'logCosts'\n      };\n    });\n\n    pluginContext.hooks.workPackageTableContextMenu(function (params:any) {\n      return {\n        key: 'log_costs',\n        icon: 'icon-projects',\n        link: 'logCosts',\n        indexBy: function (actions:any) {\n          var index = _.findIndex(actions, {link: 'logTime'});\n          return index !== -1 ? index + 1 : actions.length;\n        },\n        text: I18n.t('js.button_log_costs'),\n      };\n    });\n\n    let states = pluginContext.services.states;\n    states.add('budgets', multiInput<BudgetResource>());\n\n    // Augment previous cost-subforms\n    new CostSubformAugmentService();\n    PlannedCostsFormAugment.listen();\n\n    const budgetSubform = injector.get(CostBudgetSubformAugmentService);\n    budgetSubform.listen();\n  });\n}\n\n\n@NgModule({\n  providers: [\n    CostBudgetSubformAugmentService,\n  ],\n})\nexport class PluginModule {\n  constructor(injector:Injector) {\n    initializeCostsPlugin(injector);\n  }\n}\n\n\n\n","// -- copyright\n// OpenProject Documents Plugin\n//\n// Former OpenProject Core functionality extracted into a plugin.\n//\n// Copyright (C) 2009-2014 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n//   # Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n// This resource exists solely for the purpose of uploading attachments via the\n// WYSIWYIG editor.\nimport {HalResource} from 'core-app/modules/hal/resources/hal-resource';\nimport {Attachable} from 'core-app/modules/hal/resources/mixins/attachable-mixin';\n\nexport interface DocumentResourceLinks {\n    addAttachment(attachment:HalResource):Promise<any>;\n}\n\nclass DocumentBaseResource extends HalResource {\n    public $links:DocumentResourceLinks;\n\n    private attachmentsBackend = false;\n}\n\nexport const DocumentResource = Attachable(DocumentBaseResource);\n\nexport interface DocumentResource extends DocumentBaseResource {\n}\n","// -- copyright\n// OpenProject Documents Plugin\n//\n// Former OpenProject Core functionality extracted into a plugin.\n//\n// Copyright (C) 2009-2014 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n//   # Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenProjectPluginContext} from \"core-app/modules/plugins/plugin-context\";\nimport {DocumentResource} from './hal/resources/document-resource';\nimport {multiInput} from 'reactivestates';\n\nexport function initializeDocumentPlugin() {\n  window.OpenProject.getPluginContext()\n    .then((pluginContext:OpenProjectPluginContext) => {\n      let halResourceService = pluginContext.services.halResource;\n      halResourceService.registerResource('Document', {cls: DocumentResource});\n\n      let states = pluginContext.services.states;\n      states.add('documents', multiInput<DocumentResource>());\n    });\n}\n\n\n@NgModule()\nexport class PluginModule {\n  constructor() {\n    initializeDocumentPlugin();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n// This file is generated by Rails using the rake task\n// rake openproject:plugins:register_frontend\n\nimport {NgModule} from \"@angular/core\";\nimport {PluginModule as OpenprojectAvatars} from './linked/openproject-avatars/main';\nimport {PluginModule as OpenprojectCosts} from './linked/openproject-costs/main';\nimport {PluginModule as OpenprojectDocuments} from './linked/openproject-documents/main';\n\n@NgModule({\n    imports: [\n        OpenprojectAvatars,\n        OpenprojectCosts,\n        OpenprojectDocuments,\n    ],\n})\nexport class LinkedPluginsModule { }\n\n\n\n","export class GridArea {\n  private storedGuid:string;\n  public startRow:number;\n  public endRow:number;\n  public startColumn:number;\n  public endColumn:number;\n\n  constructor(startRow:number, endRow:number, startColumn:number, endColumn:number) {\n    this.startRow = startRow;\n    this.endRow = endRow;\n    this.startColumn = startColumn;\n    this.endColumn = endColumn;\n  }\n\n  public get gridStartRow() {\n    return this.startRow * 2;\n  }\n\n  public get gridEndRow() {\n    return this.endRow * 2 - 1;\n  }\n\n  public get gridStartColumn() {\n    return this.startColumn * 2;\n  }\n\n  public get gridEndColumn() {\n    return this.endColumn * 2 - 1;\n  }\n\n  public get guid():string {\n    if (!this.storedGuid) {\n      this.storedGuid = this.newGuid();\n    }\n\n    return this.storedGuid;\n  }\n\n  private newGuid() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n  }\n}\n\n","import {GridWidgetResource} from \"app/modules/hal/resources/grid-widget-resource\";\nimport {GridArea} from \"app/modules/grids/areas/grid-area\";\n\nexport class GridWidgetArea extends GridArea {\n  public widget:GridWidgetResource;\n\n  constructor(widget:GridWidgetResource) {\n    super(widget.startRow,\n      widget.endRow,\n      widget.startColumn,\n      widget.endColumn);\n\n    this.widget = widget;\n  }\n\n  public reset() {\n    this.startRow = this.widget.startRow;\n    this.endRow = this.widget.endRow;\n    this.startColumn = this.widget.startColumn;\n    this.endColumn = this.widget.endColumn;\n  }\n\n  public moveRight() {\n    this.startColumn++;\n    this.endColumn++;\n  }\n\n  public moveLeft() {\n    this.startColumn--;\n    this.endColumn--;\n  }\n\n  public growColumn() {\n    this.endColumn++;\n  }\n\n  public overlaps(otherArea:GridWidgetArea) {\n    return this.rowOverlaps(otherArea) &&\n           this.columnOverlaps(otherArea);\n  }\n\n  public rowOverlaps(otherArea:GridWidgetArea) {\n    return this.startRow < otherArea.endRow &&\n           this.endRow >= otherArea.endRow ||\n           this.startRow <= otherArea.startRow &&\n           this.endRow > otherArea.startRow ||\n           this.startRow > otherArea.startRow &&\n           this.endRow < otherArea.endRow;\n  }\n\n  public columnOverlaps(otherArea:GridWidgetArea) {\n    return this.startColumn < otherArea.endColumn &&\n           this.endColumn >= otherArea.endColumn ||\n           this.startColumn <= otherArea.startColumn &&\n           this.endColumn > otherArea.startColumn ||\n           this.startColumn > otherArea.startColumn &&\n           this.endColumn < otherArea.endColumn;\n  }\n\n  public startColumnOverlaps(otherArea:GridWidgetArea) {\n    return this.startColumn < otherArea.startColumn &&\n           this.endColumn > otherArea.startColumn &&\n           this.rowOverlaps(otherArea);\n  }\n\n  public get unchangedSize() {\n    return this.startColumn === this.widget.startColumn &&\n           this.endColumn === this.widget.endColumn &&\n           this.startRow === this.widget.startRow &&\n           this.endRow === this.widget.endRow;\n  }\n\n  public writeAreaChangeToWidget() {\n    this.widget.startRow = this.startRow;\n    this.widget.endRow = this.endRow;\n    this.widget.startColumn = this.startColumn;\n    this.widget.endColumn = this.endColumn;\n  }\n\n  public copyDimensionsTo(sink:GridWidgetArea) {\n    sink.startRow = this.startRow;\n    sink.startColumn = this.startColumn;\n    sink.endRow = this.endRow;\n    sink.endColumn = this.endColumn;\n  }\n}\n","import {GridArea} from \"core-app/modules/grids/areas/grid-area\";\n\nexport class GridGap extends GridArea {\n  private type:'row'|'column';\n\n  constructor(startRow:number, endRow:number, startColumn:number, endColumn:number, type:'row'|'column') {\n    super(startRow, endRow, startColumn, endColumn);\n\n    this.type = type;\n  }\n\n  public get gridStartRow() {\n    if (this.isRow) {\n      return this.startRow * 2 - 1;\n    } else {\n      return this.startRow * 2;\n    }\n  }\n\n  public get gridEndRow() {\n    if (this.isRow) {\n      return this.endRow * 2 - 2;\n    } else {\n      return this.endRow * 2 - 1;\n    }\n  }\n\n  public get gridStartColumn() {\n    if (this.isRow) {\n      return this.startColumn * 2;\n    } else {\n      return this.startColumn * 2 - 1;\n    }\n  }\n\n  public get gridEndColumn() {\n    if (this.isRow) {\n      return this.endColumn * 2 - 1;\n    } else {\n      return this.endColumn * 2 - 2;\n    }\n  }\n\n  public get isRow() {\n    return this.type === 'row';\n  }\n\n  public get isColumn() {\n    return this.type === 'column';\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {GridWidgetArea} from \"app/modules/grids/areas/grid-widget-area\";\nimport {GridArea} from \"core-app/modules/grids/areas/grid-area\";\nimport {GridGap} from \"core-app/modules/grids/areas/grid-gap\";\nimport {GridDmService} from \"core-app/modules/hal/dm-services/grid-dm.service\";\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {WidgetChangeset} from \"core-app/modules/grids/widgets/widget-changeset\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable()\nexport class GridAreaService {\n\n  private resource:GridResource;\n  public schema:SchemaResource;\n\n  public numColumns:number = 0;\n  public numRows:number = 0;\n  public gridAreas:GridArea[];\n  public gridGaps:GridArea[];\n  public widgetAreas:GridWidgetArea[];\n  public gridAreaIds:string[];\n  public mousedOverArea:GridArea|null = null;\n  public $mousedOverArea = new BehaviorSubject(this.mousedOverArea);\n  public helpMode = false;\n\n  constructor (private gridDm:GridDmService,\n               private notification:NotificationsService,\n               private i18n:I18nService) { }\n\n  public set gridResource(value:GridResource) {\n    this.resource = value;\n    this.fetchSchema();\n\n    this.numRows = this.resource.rowCount;\n    this.numColumns = this.resource.columnCount;\n\n    this.buildAreas(true);\n  }\n\n  public get gridResource() {\n    return this.resource;\n  }\n\n  public setMousedOverArea(area:GridArea|null) {\n    this.mousedOverArea = area;\n\n    this.$mousedOverArea.next(area);\n  }\n\n  public cleanupUnusedAreas() {\n    // array containing Numbers from this.numRows to 1\n    let unusedRows = _.range(this.numRows, 0, -1);\n\n    this.widgetAreas.forEach(widget => {\n      unusedRows = unusedRows.filter(item => item !== widget.startRow);\n    });\n\n    unusedRows.forEach(number => {\n      if (this.numRows > 1) {\n        this.removeRow(number);\n      }\n    });\n\n    let unusedColumns = _.range(this.numColumns, 0, -1);\n\n    this.widgetAreas.forEach(widget => {\n      unusedColumns = unusedColumns.filter(item => item !== widget.startColumn);\n    });\n\n    unusedColumns.forEach(number => {\n      if (this.numColumns > 1) {\n        this.removeColumn(number);\n      }\n    });\n  }\n\n  public buildAreas(widgets = false) {\n    this.gridAreas = this.buildGridAreas();\n    this.gridGaps = this.buildGridGaps();\n    this.gridAreaIds = this.buildGridAreaIds();\n    if (widgets) {\n      this.widgetAreas = this.buildGridWidgetAreas();\n    }\n  }\n\n  public rebuildAndPersist() {\n    this.persist();\n    this.buildAreas(false);\n  }\n\n  public persist() {\n    this.resource.rowCount = this.numRows = (this.widgetAreas.map(area => area.endRow).sort().pop() || 2) - 1;\n    this.resource.columnCount = this.numColumns;\n\n    this.writeAreaChangesToWidgets();\n\n    this.saveGrid(this.resource, this.schema);\n  }\n\n  public saveWidgetChangeset(changeset:WidgetChangeset) {\n    let payload = this.gridDm.extractPayload(this.resource, this.schema);\n\n    let payloadWidget = payload.widgets.find((w:any) => w.id === changeset.pristineResource.id);\n    Object.assign(payloadWidget, changeset.changes);\n\n    // Adding the id so that the url can be deduced\n    payload['id'] = this.resource.id;\n\n    this.saveGrid(payload);\n  }\n\n  public isGap(area:GridArea) {\n    return area instanceof GridGap;\n  }\n\n  public get isSingleCell() {\n    return this.numRows === 1 && this.numColumns === 1 && this.widgetResources.length === 0;\n  }\n\n  public get inHelpMode() {\n    return this.helpMode || this.isSingleCell;\n  }\n\n  public toggleHelpMode() {\n    this.helpMode = !this.helpMode;\n  }\n\n  // This is a hacky way to have the placeholder in the viewport.\n  // It is a noop for firefox and edge as both do not support scrollIntoViewIfNeeded.\n  // But as scrollIntoView will always readjust the viewport, the result would be an unbearable flicker\n  // which causes e.g. dragging to be impossible.\n  public scrollPlaceholderIntoView() {\n    let placeholder = jQuery('.grid--area.-placeholder');\n\n    if ((placeholder[0] as any).scrollIntoViewIfNeeded) {\n      setTimeout(() => (placeholder[0] as any).scrollIntoViewIfNeeded());\n    }\n  }\n\n  private saveGrid(resource:GridWidgetResource|any, schema?:SchemaResource) {\n    this\n      .gridDm\n      .update(resource, schema)\n      .then(updatedGrid => {\n        this.assignAreasWidget(updatedGrid);\n        this.notification.addSuccess(this.i18n.t('js.notice_successful_update'));\n      });\n  }\n\n  private assignAreasWidget(newGrid:GridResource) {\n    this.resource.widgets = newGrid.widgets;\n\n    let takenIds = this.widgetAreas.map(a => a.widget.id);\n    this.widgetAreas.forEach(area => {\n      let newWidget:GridWidgetResource;\n\n      // identify the right resource for the area. Typically that means fetching them by id.\n      // But new areas have unpersisted resources at first. Unpersisted resources have no id.\n      // In those cases, we find the one resource which is not claimed by any other area.\n      if (area.widget.id) {\n        newWidget = newGrid.widgets.find(widget => widget.id === area.widget.id)!;\n      } else {\n        newWidget = newGrid.widgets.find(widget => !takenIds.includes(widget.id) && widget.identifier === area.widget.identifier && widget.startRow === area.widget.startRow && widget.startColumn === area.widget.startColumn)!;\n      }\n\n      area.widget = newWidget!;\n    });\n  }\n\n  private buildGridAreas() {\n    let cells:GridArea[] = [];\n\n    // the one extra row is added in case the user wants to drag a widget to the very bottom\n    for (let row = 1; row <= this.numRows + 1; row++) {\n      cells.push(...this.buildGridAreasRow(row));\n    }\n\n    return cells;\n  }\n\n  private buildGridGaps() {\n    let cells:GridArea[] = [];\n\n    // special case where we want no gaps\n    if (this.isSingleCell) {\n      return cells;\n    }\n\n    for (let row = 1; row <= this.numRows + 1; row++) {\n      cells.push(...this.buildGridGapRow(row));\n    }\n\n    return cells;\n  }\n\n  private buildGridAreasRow(row:number) {\n    let cells:GridArea[] = [];\n\n    for (let column = 1; column <= this.numColumns; column++) {\n      let cell = new GridArea(row,\n        row + 1,\n        column,\n        column + 1);\n\n      cells.push(cell);\n    }\n\n    return cells;\n  }\n\n  private buildGridGapRow(row:number) {\n    let cells:GridGap[] = [];\n\n    for (let column = 1; column <= this.numColumns; column++) {\n      cells.push(new GridGap(row,\n                                  row + 1,\n                             column,\n                                  column + 1,\n                                  'row'));\n    }\n\n    if (row <= this.numRows) {\n      for (let column = 1; column <= this.numColumns + 1; column++) {\n        cells.push(new GridGap(row,\n          row + 1,\n          column,\n          column + 1,\n          'column'));\n      }\n    }\n\n    return cells;\n  }\n\n  private buildGridWidgetAreas() {\n    return this.widgetResources.map((widget) => {\n      return new GridWidgetArea(widget);\n    });\n  }\n\n  // persist all changes to the areas caused by dragging/resizing\n  // to the widget\n  public writeAreaChangesToWidgets() {\n    this.widgetAreas.forEach((area) => {\n      area.writeAreaChangeToWidget();\n    });\n  }\n\n  public addColumn(column:number, excludeRow:number) {\n    this.numColumns++;\n\n    let movedWidgets:GridWidgetArea[] = [];\n\n    for (let row = 1; row <= this.numRows; row++) {\n      if (row === excludeRow) {\n        continue;\n      }\n\n      let widget = this\n                   .rowWidgets(row)\n                   .sort((a, b) => a.startColumn - b.startColumn)\n                   .find(widget => !(widget.startRow < excludeRow && widget.endRow > excludeRow) &&\n                     (widget.startColumn === column + 1 ||\n                      widget.endColumn === column + 1 ||\n                      widget.startColumn <= column && widget.endColumn > column));\n\n      if (widget) {\n        movedWidgets.push(widget);\n        widget.endColumn++;\n      }\n    }\n\n    this.moveSubsequentRowWidgets(this.widgetAreas.filter(widget => !movedWidgets.includes(widget)),\n                                  column);\n  }\n\n  public addRow(row:number, excludeColumn:number) {\n    this.numRows++;\n\n    let movedWidgets:GridWidgetArea[] = [];\n\n    for (let column = 1; column <= this.numColumns; column++) {\n      if (column === excludeColumn) {\n        continue;\n      }\n\n      let widget = this\n                   .columnWidgets(column)\n                   .sort((a, b) => a.startRow - b.startRow)\n                   .find(widget => !(widget.startColumn < excludeColumn && widget.endColumn > excludeColumn) &&\n                     (widget.startRow === row + 1 ||\n                       widget.endRow === row + 1 ||\n                       widget.startRow <= row && widget.endRow > row));\n\n      if (widget) {\n        movedWidgets.push(widget);\n        widget.endRow++;\n      }\n    }\n\n    this.moveSubsequentColumnWidgets(this.widgetAreas.filter(widget => !movedWidgets.includes(widget)),\n                                     row);\n  }\n\n  public removeColumn(column:number) {\n    this.numColumns--;\n\n    //shrink widgets that span more than the removed column\n    this.widgetAreas.forEach((widget) => {\n      if (widget.startColumn <= column && widget.endColumn >= column + 1) {\n        //shrink widgets that span more than the removed column\n        widget.endColumn--;\n      }\n    });\n\n    // move all widgets that are after the removed column\n    // so that they appear to keep their place.\n    this.widgetAreas.filter((widget) => {\n      return widget.startColumn > column;\n    }).forEach((widget) => {\n      widget.startColumn--;\n      widget.endColumn--;\n    });\n  }\n\n  public removeRow(row:number) {\n    this.numRows--;\n\n    //shrink widgets that span more than the removed row\n    this.widgetAreas.forEach((widget) => {\n      if (widget.startRow <= row && widget.endRow >= row + 1) {\n        //shrink widgets that span more than the removed row\n        widget.endRow--;\n      }\n    });\n\n    // move all widgets that are after the removed row\n    // so that they appear to keep their place.\n    this.widgetAreas.filter((widget) => {\n      return widget.startRow > row;\n    }).forEach((widget) => {\n      widget.startRow--;\n      widget.endRow--;\n    });\n  }\n\n  public resetAreas(ignoredArea:GridWidgetArea|null = null) {\n    this.widgetAreas.filter((area) => {\n      return !ignoredArea || area.guid !== ignoredArea.guid;\n    }).forEach(area => area.reset());\n\n    this.numRows = this.resource.rowCount;\n    this.numColumns = this.resource.columnCount;\n  }\n\n  public get isEditable() {\n    return this.gridResource.updateImmediately !== undefined;\n  }\n\n  private buildGridAreaIds() {\n    return this\n      .gridAreas\n      .filter(area => !this.isGap(area))\n      .map((area) => area.guid);\n  }\n\n  private fetchSchema() {\n    this.gridDm.updateForm(this.resource)\n      .then((form) => {\n        this.schema = form.schema;\n      });\n  }\n\n  public removeWidget(removedWidget:GridWidgetResource) {\n    let index = this.resource.widgets.findIndex((widget) => widget.id === removedWidget.id );\n    this.resource.widgets.splice(index, 1);\n\n    index = this.widgetAreas.findIndex((area) => area.widget.id === removedWidget.id);\n    this.widgetAreas.splice(index, 1);\n    this.cleanupUnusedAreas();\n\n    this.rebuildAndPersist();\n  }\n\n  public get widgetResources() {\n    return (this.resource && this.resource.widgets) || [];\n  }\n\n  private rowWidgets(row:number) {\n    return this.widgetAreas.filter(widget => widget.startRow === row);\n  }\n\n  private moveSubsequentRowWidgets(rowWidgets:GridWidgetArea[], column:number) {\n    rowWidgets.forEach(subsequentWidget => {\n      if (subsequentWidget.startColumn > column) {\n        subsequentWidget.startColumn++;\n        subsequentWidget.endColumn++;\n      }\n    });\n  }\n\n  private columnWidgets(column:number) {\n    return this.widgetAreas.filter(widget => widget.startColumn === column);\n  }\n\n  private moveSubsequentColumnWidgets(columnWidgets:GridWidgetArea[], row:number) {\n    columnWidgets.forEach(subsequentWidget => {\n      if (subsequentWidget.startRow > row) {\n        subsequentWidget.startRow++;\n        subsequentWidget.endRow++;\n      }\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ChangeDetectionStrategy, Input, EventEmitter, Output} from '@angular/core';\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\n\n@Component({\n  selector: 'widget-header',\n  templateUrl: './header.component.html',\n  styleUrls: ['./header.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetHeaderComponent {\n  @Input() name:string;\n  @Input() editable:boolean = true;\n  @Output() onRenamed = new EventEmitter<string>();\n\n  constructor(readonly layout:GridAreaService) {\n\n  }\n\n  public renamed(name:string) {\n    this.onRenamed.emit(name);\n  }\n\n  public get isRenameable() {\n    return this.editable && this.layout.isEditable;\n  }\n}\n","<h3 class=\"widget-box--header\"\n    [ngClass]=\"{ '-editable': isRenameable }\">\n\n  <editable-toolbar-title [title]=\"name\"\n                          (onSave)=\"renamed($event)\"\n                          [editable]=\"isRenameable\"\n                          class=\"widget-box--header-title\">\n  </editable-toolbar-title>\n\n  <ng-content></ng-content>\n</h3>\n","import {Injectable} from \"@angular/core\";\nimport {GridWidgetArea} from \"core-app/modules/grids/areas/grid-widget-area\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\n\n@Injectable()\nexport class GridRemoveWidgetService {\n\n  constructor(readonly layout:GridAreaService) {\n  }\n\n  public area(area:GridWidgetArea) {\n    this.widget(area.widget);\n  }\n\n  public widget(widget:GridWidgetResource) {\n    this.layout.removeWidget(widget);\n  }\n\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport { Input, Directive } from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {OpContextMenuItem} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {GridRemoveWidgetService} from \"core-app/modules/grids/grid/remove-widget.service\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\n\n@Directive()\nexport abstract class WidgetAbstractMenuComponent {\n  @Input() resource:GridWidgetResource;\n\n  protected menuItemList:OpContextMenuItem[] = [this.removeItem];\n\n  constructor(readonly i18n:I18nService,\n              protected readonly remove:GridRemoveWidgetService,\n              protected readonly layout:GridAreaService) {\n  }\n\n  public get menuItems() {\n    return async () => {\n      return this.menuItemList;\n    };\n  }\n\n  protected get removeItem() {\n    return {\n      linkText: this.i18n.t('js.grid.remove'),\n      onClick: () => {\n        this.remove.widget(this.resource);\n        return true;\n      }\n    };\n  }\n\n  public get hasMenu() {\n    return this.layout.isEditable;\n  }\n}\n","<icon-triggered-context-menu\n    *ngIf=\"hasMenu\"\n    [menu-items]=\"menuItems\">\n</icon-triggered-context-menu>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component} from '@angular/core';\nimport {WidgetAbstractMenuComponent} from \"core-app/modules/grids/widgets/menu/widget-abstract-menu.component\";\n\n@Component({\n  selector: 'widget-menu',\n  templateUrl: './widget-menu.component.html',\n  styleUrls: ['./widget-menu.component.css']\n})\nexport class WidgetMenuComponent extends WidgetAbstractMenuComponent {\n}\n","<!-- position: relative added in order for the loading indicator to be positioned correctly -->\n<div class=\"wp-calendar--container loading-indicator--location\"\n     [attr.data-indicator-name]=\"'table'\"\n     style=\"position: relative\">\n    <full-calendar #ucCalendar\n                   [editable]=\"calendarEditable\"\n                   [eventLimit]=\"calendarEventLimit\"\n                   [locale]=\"calendarLocale\"\n                   [fixedWeekCount]=\"calendarFixedWeekCount\"\n                   [height]=\"calendarHeight\"\n                   [header]=\"calendarHeader\"\n                   [defaultView]=\"calendarDefaultView\"\n                   [firstDay]=\"calendarFirstDay\"\n                   [events]=\"calendarEvents\"\n                   [plugins]=\"calendarPlugins\">\n    </full-calendar>\n    <div\n        *ngIf=\"static\"\n        [textContent]=\"tooManyResultsText\"\n        class=\"wp-calendar--notification\"></div>\n</div>\n","import {AfterViewInit, Component, ElementRef, Input, OnInit, SecurityContext, ViewChild} from \"@angular/core\";\nimport {FullCalendarComponent} from '@fullcalendar/angular';\nimport {States} from \"core-components/states.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport * as moment from \"moment\";\nimport {WorkPackagesListService} from \"core-components/wp-list/wp-list.service\";\nimport {StateService} from \"@uirouter/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {WorkPackagesListChecksumService} from \"core-components/wp-list/wp-list-checksum.service\";\nimport {OpTitleService} from \"core-components/html/op-title.service\";\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport {EventApi, EventInput} from '@fullcalendar/core';\nimport {EventSourceError} from '@fullcalendar/core/structs/event-source';\nimport {take} from 'rxjs/operators';\nimport {ToolbarInput} from '@fullcalendar/core/types/input-types';\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\ninterface CalendarViewEvent {\n  el:HTMLElement;\n  event:EventApi;\n  jsEvent:MouseEvent;\n}\n\n@Component({\n  templateUrl: './wp-calendar.template.html',\n  styleUrls: ['./wp-calendar.sass'],\n  selector: 'wp-calendar',\n})\nexport class WorkPackagesCalendarController extends UntilDestroyedMixin implements OnInit, AfterViewInit {\n  @ViewChild(FullCalendarComponent) ucCalendar:FullCalendarComponent;\n  @Input() projectIdentifier:string;\n  @Input() static:boolean = false;\n  static MAX_DISPLAYED = 100;\n\n  public tooManyResultsText:string|null;\n\n  public calendarPlugins = [dayGridPlugin];\n  public calendarHeight:Function;\n  public calendarEvents:Function;\n  public calendarHeader:ToolbarInput|boolean;\n\n  private alreadyLoaded = false;\n\n  constructor(readonly states:States,\n              readonly $state:StateService,\n              readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly wpListService:WorkPackagesListService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly wpListChecksumService:WorkPackagesListChecksumService,\n              readonly titleService:OpTitleService,\n              private element:ElementRef,\n              readonly i18n:I18nService,\n              readonly notificationsService:NotificationsService,\n              private sanitizer:DomSanitizer,\n              private configuration:ConfigurationService) {\n    super();\n  }\n\n  ngOnInit() {\n    // Clear any old subscribers\n    this.querySpace.stopAllSubscriptions.next();\n\n    this.setupWorkPackagesListener();\n\n    this.initializeCalendar();\n  }\n\n  ngAfterViewInit() {\n    // The full-calendar component's outputs do not seem to work\n    // see: https://github.com/fullcalendar/fullcalendar-angular/issues/228#issuecomment-523505044\n    // Therefore, setting the outputs via the underlying API\n    this.ucCalendar.getApi().setOption('eventRender', (event:CalendarViewEvent) => {\n      this.addTooltip(event);\n    });\n    this.ucCalendar.getApi().setOption('eventClick', (event:CalendarViewEvent) => {\n      this.toWPFullView(event);\n    });\n  }\n\n  public calendarEventsFunction(fetchInfo:{ start:Date, end:Date, timeZone:string },\n                                successCallback:(events:EventInput[]) => void,\n                                failureCallback:(error:EventSourceError) => void):void|PromiseLike<EventInput[]> {\n    if (this.alreadyLoaded) {\n      this.alreadyLoaded = false;\n      let events = this.updateResults(this.querySpace.results.value!);\n      successCallback(events);\n    } else {\n      this.querySpace.results.values$().pipe(\n        take(1)\n      ).subscribe((collection:WorkPackageCollectionResource) => {\n        let events = this.updateResults((collection));\n        successCallback(events);\n      });\n    }\n\n\n    this.updateTimeframe(fetchInfo);\n  }\n\n  private initializeCalendar() {\n    this.calendarEvents = this.calendarEventsFunction.bind(this);\n    this.setCalendarHeight();\n    this.setCalendarHeader();\n  }\n\n  public updateTimeframe(fetchInfo:{ start:Date, end:Date, timeZone:string }) {\n    let filtersEmpty = this.wpTableFilters.isEmpty;\n\n    if (filtersEmpty && this.querySpace.query.value) {\n      // nothing to do\n      return;\n    }\n\n    let startDate = moment(fetchInfo.start).format('YYYY-MM-DD');\n    let endDate = moment(fetchInfo.end).format('YYYY-MM-DD');\n\n    if (filtersEmpty) {\n      let queryProps = this.defaultQueryProps(startDate, endDate);\n\n      if (this.$state.params.query_props) {\n        queryProps = decodeURIComponent(this.$state.params.query_props || '');\n      }\n\n      this.wpListService.fromQueryParams({ query_props: queryProps }, this.projectIdentifier).toPromise();\n    } else {\n      let params = this.$state.params;\n\n      this.wpTableFilters.modify('datesInterval', (datesIntervalFilter) => {\n        datesIntervalFilter.values[0] = startDate;\n        datesIntervalFilter.values[1] = endDate;\n      });\n    }\n  }\n\n  public addTooltip(event:CalendarViewEvent) {\n    jQuery(event.el).tooltip({\n      content: this.tooltipContentString(event.event.extendedProps.workPackage),\n      items: '.fc-event',\n      close: function () {\n        jQuery(\".ui-helper-hidden-accessible\").remove();\n      },\n      track: true\n    });\n  }\n\n  public toWPFullView(event:CalendarViewEvent) {\n    let workPackage = event.event.extendedProps.workPackage;\n\n    if (event.el) {\n      // do not display the tooltip on the wp show page\n      this.removeTooltip(event.el);\n    }\n\n    // Ensure checksum is removed to allow queries to load\n    this.wpListChecksumService.clear();\n\n    // Ensure current calendar URL is pushed to history\n    window.history.pushState({}, this.titleService.current, window.location.href);\n\n    this.$state.go(\n      'work-packages.show',\n      { workPackageId: workPackage.id },\n      { inherit: false });\n  }\n\n  public get calendarEditable() {\n    return false;\n  }\n\n  public get calendarEventLimit() {\n    return false;\n  }\n\n  public get calendarLocale() {\n    return this.i18n.locale;\n  }\n\n  public get calendarFixedWeekCount() {\n    return false;\n  }\n\n  public get calendarDefaultView() {\n    if (this.static) {\n      return 'dayGridWeek';\n    } else {\n      return null;\n    }\n  }\n\n  public get calendarFirstDay() {\n    return this.configuration.startOfWeek();\n  }\n\n  private get calendarElement() {\n    return jQuery(this.element.nativeElement).find('.fc-view-container');\n  }\n\n  private setCalendarHeight() {\n    if (this.static) {\n      this.calendarHeight = () => {\n        let heightElement = jQuery(this.element.nativeElement);\n\n        while (!heightElement.height() && heightElement.parent()) {\n          heightElement = heightElement.parent();\n        }\n\n        let topOfCalendar = jQuery(this.element.nativeElement).position().top;\n        let topOfHeightElement = heightElement.position().top;\n\n        return heightElement.height()! - (topOfCalendar - topOfHeightElement);\n      };\n    } else {\n      this.calendarHeight = () => {\n        // -12 for the bottom padding\n        return jQuery(window).height()! - this.calendarElement.offset()!.top - 12;\n      };\n    }\n  }\n\n  public setCalendarHeader() {\n    if (this.static) {\n      this.calendarHeader = false;\n    } else {\n      this.calendarHeader = {\n        right: 'dayGridMonth,dayGridWeek',\n        center: 'title',\n        left: 'prev,next today'\n      };\n    }\n  }\n\n  private setCalendarsDate() {\n    const query = this.querySpace.query.value;\n    if (!query) {\n      return;\n    }\n\n    let datesIntervalFilter = _.find(query.filters || [], { 'id': 'datesInterval' }) as any;\n\n    let calendarDate:any = null;\n    let calendarUnit = 'dayGridMonth';\n\n    if (datesIntervalFilter) {\n      let lower = moment(datesIntervalFilter.values[0] as string);\n      let upper = moment(datesIntervalFilter.values[1] as string);\n      let diff = upper.diff(lower, 'days');\n\n      calendarDate = lower.add(diff / 2, 'days');\n\n      if (diff === 7) {\n        calendarUnit = 'dayGridWeek';\n      }\n    }\n\n    if (calendarDate) {\n      this.ucCalendar.getApi().changeView(calendarUnit, calendarDate.toDate());\n    } else {\n      this.ucCalendar.getApi().changeView(calendarUnit);\n    }\n  }\n\n  private setupWorkPackagesListener() {\n    this.querySpace.results.values$().pipe(\n      this.untilDestroyed()\n    ).subscribe((collection:WorkPackageCollectionResource) => {\n      this.alreadyLoaded = true;\n      this.setCalendarsDate();\n\n      this.ucCalendar.getApi().refetchEvents();\n    });\n  }\n\n  private updateResults(collection:WorkPackageCollectionResource) {\n    this.warnOnTooManyResults(collection);\n\n    return this.mapToCalendarEvents(collection.elements);\n  }\n\n  private mapToCalendarEvents(workPackages:WorkPackageResource[]) {\n    let events = workPackages.map((workPackage:WorkPackageResource) => {\n      let startDate = this.eventDate(workPackage, 'start');\n      let endDate = this.eventDate(workPackage, 'due');\n\n      let exclusiveEnd = moment(endDate).add(1, 'days').format('YYYY-MM-DD');\n\n      return {\n        title: workPackage.subject,\n        start: startDate,\n        end: exclusiveEnd,\n        allDay: true,\n        className: `__hl_background_type_${workPackage.type.id}`,\n        workPackage: workPackage\n      };\n    });\n\n    return events;\n  }\n\n  private warnOnTooManyResults(collection:WorkPackageCollectionResource) {\n    if (collection.count < collection.total) {\n      this.tooManyResultsText = this.i18n.t('js.calendar.too_many',\n        {\n          count: collection.total,\n          max: WorkPackagesCalendarController.MAX_DISPLAYED\n        });\n    } else {\n      this.tooManyResultsText = null;\n    }\n\n    if (this.tooManyResultsText && !this.static) {\n      this.notificationsService.addNotice(this.tooManyResultsText);\n    }\n  }\n\n  private defaultQueryProps(startDate:string, endDate:string) {\n    let props = {\n      \"c\": [\"id\"],\n      \"t\":\n        \"id:asc\",\n      \"f\": [{ \"n\": \"status\", \"o\": \"o\", \"v\": [] },\n        { \"n\": \"datesInterval\", \"o\": \"<>d\", \"v\": [startDate, endDate] }],\n      \"pp\": WorkPackagesCalendarController.MAX_DISPLAYED\n    };\n\n    return JSON.stringify(props);\n  }\n\n  private eventDate(workPackage:WorkPackageResource, type:'start'|'due') {\n    if (workPackage.isMilestone) {\n      return workPackage.date;\n    } else {\n      return workPackage[`${type}Date`];\n    }\n  }\n\n  private tooltipContentString(workPackage:WorkPackageResource) {\n    return `\n        ${this.sanitizedValue(workPackage, 'type')} #${workPackage.id}: ${this.sanitizedValue(workPackage, 'subject', null)}\n        <ul class=\"tooltip--map\">\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.work_packages.properties.projectName')}:</span>\n            <span class=\"tooltip--map--value\">${this.sanitizedValue(workPackage, 'project')}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.work_packages.properties.status')}:</span>\n            <span class=\"tooltip--map--value\">${this.sanitizedValue(workPackage, 'status')}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.work_packages.properties.startDate')}:</span>\n            <span class=\"tooltip--map--value\">${this.eventDate(workPackage, 'start')}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.work_packages.properties.dueDate')}:</span>\n            <span class=\"tooltip--map--value\">${this.eventDate(workPackage, 'due')}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.work_packages.properties.assignee')}:</span>\n            <span class=\"tooltip--map--value\">${this.sanitizedValue(workPackage, 'assignee')}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.work_packages.properties.priority')}:</span>\n            <span class=\"tooltip--map--value\">${this.sanitizedValue(workPackage, 'priority')}</span>\n          </li>\n        </ul>\n        `;\n  }\n\n  private sanitizedValue(workPackage:WorkPackageResource, attribute:string, toStringMethod:string|null = 'name') {\n    let value = workPackage[attribute];\n    value = toStringMethod && value ? value[toStringMethod] : value;\n    value = value || this.i18n.t('js.placeholders.default');\n\n    return this.sanitizer.sanitize(SecurityContext.HTML, value);\n  }\n\n  private removeTooltip(element:HTMLElement) {\n    // deactivate tooltip so that it is not displayed on the wp show page\n    jQuery(element).tooltip({\n      close: function () {\n        jQuery(\".ui-helper-hidden-accessible\").remove();\n      },\n      disabled: true\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Injector} from '@angular/core';\nimport {AbstractWidgetComponent} from \"app/modules/grids/widgets/abstract-widget.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\n\n@Component({\n  templateUrl: './wp-calendar.component.html',\n})\nexport class WidgetWpCalendarComponent extends AbstractWidgetComponent {\n  constructor(protected readonly i18n:I18nService,\n              protected readonly injector:Injector,\n              protected readonly currentProject:CurrentProjectService) {\n    super(i18n, injector);\n  }\n\n  public get projectIdentifier() {\n    return this.currentProject.identifier;\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    (onRenamed)=\"renameWidget($event)\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<ng-container wp-isolated-query-space>\n  <wp-calendar\n      [static]=\"true\"\n      [projectIdentifier]=\"projectIdentifier\"></wp-calendar>\n</ng-container>\n","<div class=\"op-modal--portal \">\n  <div class=\"op-modal--modal-container\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\">\n        <i\n          class=\"icon-close\"\n          (click)=\"closeMe($event)\"\n          [attr.title]=\"text.closePopup\">\n        </i>\n      </a>\n    </div>\n\n    <h3 [textContent]=\"text.displayedDays\"></h3>\n\n    <div class=\"form--field -trailing-label\" *ngFor=\"let day of text.weekdays; let index = index\">\n      <label class=\"form--label\" [textContent]=\"day\" [htmlFor]=\"'day_' + index\"></label>\n      <span class=\"form--field-container\">\n        <span class=\"form--check-box-container\">\n          <input type=\"checkbox\" [id]=\"'day_' + index\" name=\"days\" class=\"form--check-box\" [(ngModel)]=\"days[index]\">\n        </span>\n      </span>\n    </div>\n\n    <div class=\"tab-content\"></div>\n    <div class=\"modal--form-actions\">\n      <button class=\"button -highlight\"\n              [textContent]=\"text.applyButton\"\n              (click)=\"saveChanges()\">\n      </button>\n      <button class=\"button\"\n              [textContent]=\"text.cancelButton\"\n              (click)=\"closeMe($event)\">\n      </button>\n    </div>\n  </div>\n</div>\n","import {\n  ApplicationRef,\n  ChangeDetectorRef,\n  Component,\n  ComponentFactoryResolver,\n  ElementRef,\n  Inject,\n  InjectionToken,\n  Injector,\n  OnDestroy,\n  OnInit,\n  Optional,\n  ViewChild\n} from '@angular/core';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {\n  ActiveTabInterface,\n  TabComponent,\n  TabInterface,\n  TabPortalOutlet\n} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {LoadingIndicatorService} from 'core-app/modules/common/loading-indicator/loading-indicator.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\nimport {WpGraphConfiguration} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Component({\n  templateUrl: './time-entries-current-user-configuration.modal.html',\n})\nexport class TimeEntriesCurrentUserConfigurationModalComponent extends OpModalComponent implements OnInit  {\n\n  /* Close on escape? */\n  public closeOnEscape = true;\n\n  /* Close on outside click */\n  public closeOnOutsideClick = true;\n\n  public $element:JQuery;\n\n  public text = {\n    displayedDays: this.I18n.t('js.grid.widgets.time_entries_current_user.displayed_days'),\n    closePopup: this.I18n.t('js.close_popup_title'),\n\n    applyButton: this.I18n.t('js.modals.button_apply'),\n    cancelButton: this.I18n.t('js.modals.button_cancel'),\n\n    weekdays: moment.weekdays()\n  };\n\n  public firstDayOfWeek:number;\n  public firstDayOffset = this.configuration.startOfWeek();\n\n  // All days of the week, zero based on Monday.\n  public options:{ days:boolean[] };\n  public days:boolean[];\n\n  constructor(@Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly injector:Injector,\n              readonly appRef:ApplicationRef,\n              readonly loadingIndicator:LoadingIndicatorService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly configuration:ConfigurationService,\n              readonly elementRef:ElementRef) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    this.days = this.locals.options.days || Array.from({ length: 7 }, () => true );\n\n    let momentFirstDayOffset = 1 + moment.localeData().firstDayOfWeek() % 7;\n    this.text.weekdays = moment.localeData().weekdays().slice(momentFirstDayOffset).concat(moment.localeData().weekdays().slice(0, momentFirstDayOffset));\n  }\n\n  public saveChanges():void {\n    this.options = { days: this.days };\n    this.service.close();\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Output, EventEmitter, Injector} from '@angular/core';\nimport {WpGraphConfigurationModalComponent} from \"core-app/modules/work-package-graphs/configuration-modal/wp-graph-configuration.modal\";\nimport {WidgetWpSetMenuComponent} from \"core-app/modules/grids/widgets/menu/wp-set-menu.component\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {GridRemoveWidgetService} from \"core-app/modules/grids/grid/remove-widget.service\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {WidgetAbstractMenuComponent} from \"core-app/modules/grids/widgets/menu/widget-abstract-menu.component\";\nimport {TimeEntriesCurrentUserConfigurationModalComponent} from \"core-app/modules/grids/widgets/time-entries/current-user/time-entries-current-user-configuration.modal\";\n\n@Component({\n  selector: 'widget-time-entries-current-user-menu',\n  templateUrl: '../../menu/widget-menu.component.html'\n})\nexport class WidgetTimeEntriesCurrentUserMenuComponent extends WidgetAbstractMenuComponent {\n  @Output()\n  onConfigured:EventEmitter<any> = new EventEmitter();\n\n  protected menuItemList = [\n    this.removeItem,\n    this.configureItem\n  ];\n\n  constructor(private readonly injector:Injector,\n              private readonly opModalService:OpModalService,\n              readonly i18n:I18nService,\n              protected readonly remove:GridRemoveWidgetService,\n              readonly layout:GridAreaService) {\n    super(i18n,\n      remove,\n      layout);\n  }\n\n  protected get configureItem() {\n    return {\n      linkText: this.i18n.t('js.grid.configure'),\n      onClick: () => {\n        this.opModalService.show(TimeEntriesCurrentUserConfigurationModalComponent, this.injector, this.locals)\n          .closingEvent.subscribe((modal:TimeEntriesCurrentUserConfigurationModalComponent) => {\n            if (modal.options) {\n              this.onConfigured.emit(modal.options);\n            }\n        });\n        return true;\n      }\n    };\n  }\n\n  protected get locals() {\n    return { options: this.resource.options };\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {MultiInputState} from 'reactivestates';\nimport {States} from '../states.service';\nimport {StateCacheService} from '../states/state-cache.service';\nimport {Injectable} from '@angular/core';\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {TimeEntryDmService} from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\n\n@Injectable({ providedIn: 'root' })\nexport class TimeEntryCacheService extends StateCacheService<TimeEntryResource> {\n\n  constructor(readonly states:States,\n              readonly schemaCacheService:SchemaCacheService,\n              readonly timeEntryDm:TimeEntryDmService) {\n    super();\n  }\n\n  protected loadAll(ids:string[]):Promise<undefined> {\n    return Promise\n      .all(ids.map(id => this.load(id)))\n      .then(_ => undefined);\n  }\n\n  updateValue(id:string, val:TimeEntryResource) {\n    this.schemaCacheService.ensureLoaded(val).then(() => {\n      super.updateValue(id, val);\n    });\n  }\n\n  protected load(id:string):Promise<TimeEntryResource> {\n    return this\n      .timeEntryDm\n      .one(parseInt(id))\n      .then((timeEntry) => {\n        return this.schemaCacheService.ensureLoaded(timeEntry).then(() => timeEntry);\n      });\n  }\n\n  protected get multiState():MultiInputState<TimeEntryResource> {\n    return this.states.timeEntries;\n  }\n\n}\n","import {Component, ChangeDetectionStrategy} from \"@angular/core\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {TimeEntryBaseModal} from \"core-app/modules/time_entries/shared/modal/base.modal\";\n\n@Component({\n  templateUrl: '../shared/modal/base.modal.html',\n  styleUrls: ['../shared/modal/base.modal.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    HalResourceEditingService\n  ]\n})\nexport class TimeEntryEditModal extends TimeEntryBaseModal {\n  public modifiedEntry:TimeEntryResource;\n  public destroyedEntry:TimeEntryResource;\n\n  public setModifiedEntry($event:{savedResource:HalResource, isInital:boolean}) {\n    this.modifiedEntry = $event.savedResource as TimeEntryResource;\n  }\n\n  public get saveAllowed() {\n    return !!this.entry.update;\n  }\n\n  public get deleteAllowed() {\n    return !!this.entry.delete;\n  }\n\n  public destroy() {\n    if (!window.confirm(this.text.areYouSure)) {\n      return;\n    }\n\n    this.destroyedEntry = this.entry;\n    this.service.close();\n  }\n}\n","import {Injectable, Injector} from \"@angular/core\";\nimport {OpModalService} from \"app/components/op-modals/op-modal.service\";\nimport {HalResourceService} from \"app/modules/hal/services/hal-resource.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport { TimeEntryResource } from 'core-app/modules/hal/resources/time-entry-resource';\nimport { TimeEntryEditModal } from './edit.modal';\nimport { take } from 'rxjs/operators';\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\n\n@Injectable()\nexport class TimeEntryEditService {\n\n  constructor(readonly opModalService:OpModalService,\n              readonly injector:Injector,\n              readonly halResource:HalResourceService,\n              readonly i18n:I18nService) {\n  }\n\n  public edit(entry:TimeEntryResource) {\n    return new Promise<{entry:TimeEntryResource, action:'update'|'destroy'}>((resolve, reject) => {\n      const modal = this.opModalService.show(TimeEntryEditModal, this.injector, { entry: entry });\n\n      modal\n        .closingEvent\n        .pipe(take(1))\n        .subscribe(() => {\n          if (modal.destroyedEntry) {\n            modal.destroyedEntry.delete().then(() => {\n              resolve({entry: modal.destroyedEntry, action: 'destroy'});\n            });\n          } else if (modal.modifiedEntry) {\n            resolve({ entry: modal.modifiedEntry, action: 'update' });\n          } else {\n            reject();\n          }\n        });\n    });\n  }\n}\n","<!-- position: relative added in order for the loading indicator to be positioned correctly -->\n<div class=\"te-calendar--container loading-indicator--location\"\n     [attr.data-indicator-name]=\"'table'\"\n     style=\"position: relative\">\n\n  <button *ngIf=\"memoizedCreateAllowed\"\n          class=\"button te-calendar--create-button\"\n          [attr.aria-label]=\"text.logTime\"\n          (click)=\"addEventToday()\">\n    <op-icon icon-classes=\"button--icon icon-log_time\"></op-icon>\n    <span class=\"button--text\"\n          [textContent]=\"text.logTime\"\n          aria-hidden=\"true\"></span>\n  </button>\n\n  <full-calendar #ucCalendar\n                 [editable]=\"calendarEditable\"\n                 [eventLimit]=\"calendarEventLimit\"\n                 [locale]=\"calendarLocale\"\n                 [fixedWeekCount]=\"calendarFixedWeekCount\"\n                 [header]=\"calendarHeader\"\n                 [defaultView]=\"calendarDefaultView\"\n                 [firstDay]=\"calendarFirstDay\"\n                 [hiddenDays]=\"hiddenDays\"\n                 [contentHeight]=\"calendarContentHeight\"\n                 [slotEventOverlap]=\"calendarSlotEventOverlap\"\n                 [slotLabelInterval]=\"calendarSlotLabelInterval\"\n                 [slotLabelFormat]=\"calendarSlotLabelFormat\"\n                 [allDaySlot]=\"calendarAllDaySlot\"\n                 [displayEventTime]=\"calendarDisplayEventTime\"\n                 [minTime]=\"calendarMinTime\"\n                 [maxTime]=\"calendarMaxTime\"\n                 [events]=\"calendarEvents\"\n                 [eventOverlap]=\"calendarEventOverlap\"\n                 [plugins]=\"calendarPlugins\">\n  </full-calendar>\n</div>\n","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Injector,\n  Input,\n  OnInit,\n  Output,\n  SecurityContext,\n  ViewChild,\n  ViewEncapsulation\n} from \"@angular/core\";\nimport {FullCalendarComponent} from '@fullcalendar/angular';\nimport {States} from \"core-components/states.service\";\nimport * as moment from \"moment\";\nimport {Moment} from \"moment\";\nimport {StateService} from \"@uirouter/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport timeGrid from '@fullcalendar/timegrid';\nimport {Duration, EventApi, EventInput, View} from '@fullcalendar/core';\nimport {EventSourceError} from '@fullcalendar/core/structs/event-source';\nimport {ToolbarInput} from '@fullcalendar/core/types/input-types';\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\nimport {TimeEntryDmService} from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\nimport {FilterOperator} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {TimeEntryCacheService} from \"core-components/time-entries/time-entry-cache.service\";\nimport interactionPlugin from '@fullcalendar/interaction';\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {TimeEntryEditService} from \"core-app/modules/time_entries/edit/edit.service\";\nimport {TimeEntryCreateService} from \"core-app/modules/time_entries/create/create.service\";\nimport {ColorsService} from \"core-app/modules/common/colors/colors.service\";\nimport {BrowserDetector} from \"core-app/modules/common/browser/browser-detector.service\";\nimport {HalResourceNotificationService} from 'core-app/modules/hal/services/hal-resource-notification.service';\n\ninterface CalendarViewEvent {\n  el:HTMLElement;\n  event:EventApi;\n  jsEvent:MouseEvent;\n}\n\ninterface CalendarMoveEvent {\n  el:HTMLElement;\n  event:EventApi;\n  oldEvent:EventApi;\n  delta:Duration;\n  revert:() => void;\n  jsEvent:Event;\n  view:View;\n}\n\n// An array of all the days that are displayed. The zero index represents Monday.\nexport type DisplayedDays = [boolean, boolean, boolean, boolean, boolean, boolean, boolean];\n\nconst TIME_ENTRY_CLASS_NAME = 'te-calendar--time-entry';\nconst DAY_SUM_CLASS_NAME = 'te-calendar--day-sum';\nconst ADD_ENTRY_CLASS_NAME = 'te-calendar--add-entry';\nconst ADD_ICON_CLASS_NAME = 'te-calendar--add-icon';\nconst ADD_ENTRY_PROHIBITED_CLASS_NAME = '-prohibited';\n\n@Component({\n  templateUrl: './te-calendar.template.html',\n  styleUrls: ['./te-calendar.component.sass'],\n  selector: 'te-calendar',\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    TimeEntryEditService,\n    TimeEntryCreateService,\n    HalResourceEditingService\n  ]\n})\nexport class TimeEntryCalendarComponent implements OnInit, AfterViewInit {\n  @ViewChild(FullCalendarComponent) ucCalendar:FullCalendarComponent;\n  @Input() projectIdentifier:string;\n  @Input() static:boolean = false;\n  @Input() set displayedDays(days:DisplayedDays) {\n    this.setHiddenDays(days);\n  }\n  @Output() entries = new EventEmitter<CollectionResource<TimeEntryResource>>();\n\n  // Not used by the calendar but rather is the maximum/minimum of the graph.\n  public minHour = 1;\n  public maxHour = 12;\n  public labelIntervalHours = 2;\n  public scaleRatio = 1;\n\n  public calendarPlugins = [timeGrid, interactionPlugin];\n  public calendarEvents:Function;\n  public calendarHeader:ToolbarInput|boolean = {\n    right: '',\n    center: 'title',\n    left: 'prev,next today'\n  };\n  public calendarSlotLabelFormat = (info:any) => (this.maxHour - info.date.hour) / this.scaleRatio;\n  public calendarSlotLabelInterval = `${this.labelIntervalHours}:00:00`;\n  public calendarContentHeight = 605;\n  public calendarAllDaySlot = false;\n  public calendarDisplayEventTime = false;\n  public calendarSlotEventOverlap = false;\n  public calendarEditable = false;\n  public calendarMinTime = `${this.minHour - 1}:00:00`;\n  public calendarMaxTime = `${this.maxHour}:00:00`;\n  public calendarEventOverlap = (stillEvent:any) => !stillEvent.classNames.includes(TIME_ENTRY_CLASS_NAME);\n\n  protected memoizedTimeEntries:{ start:Date, end:Date, entries:Promise<CollectionResource<TimeEntryResource>> };\n  public memoizedCreateAllowed:boolean = false;\n  public hiddenDays:number[] = [];\n\n  public text = {\n    logTime: this.i18n.t('js.button_log_time')\n  };\n\n  constructor(readonly states:States,\n              readonly timeEntryDm:TimeEntryDmService,\n              readonly $state:StateService,\n              private element:ElementRef,\n              readonly i18n:I18nService,\n              readonly injector:Injector,\n              readonly notifications:HalResourceNotificationService,\n              private sanitizer:DomSanitizer,\n              private configuration:ConfigurationService,\n              private timezone:TimezoneService,\n              private timeEntryEdit:TimeEntryEditService,\n              private timeEntryCreate:TimeEntryCreateService,\n              private timeEntryCache:TimeEntryCacheService,\n              private colors:ColorsService,\n              private browserDetector:BrowserDetector) {\n  }\n\n  ngOnInit() {\n    this.initializeCalendar();\n  }\n\n  ngAfterViewInit() {\n    // The full-calendar component's outputs do not seem to work\n    // see: https://github.com/fullcalendar/fullcalendar-angular/issues/228#issuecomment-523505044\n    // Therefore, setting the outputs via the underlying API\n    this.ucCalendar.getApi().setOption('eventRender', (event:CalendarViewEvent) => {\n      this.alterEventEntry(event);\n    });\n    this.ucCalendar.getApi().setOption('eventDestroy', (event:CalendarViewEvent) => {\n      this.beforeEventRemove(event);\n    });\n    this.ucCalendar.getApi().setOption('eventClick', (event:CalendarViewEvent) => {\n      this.dispatchEventClick(event);\n    });\n    this.ucCalendar.getApi().setOption('eventDrop', (event:CalendarMoveEvent) => {\n      this.moveEvent(event);\n    });\n  }\n\n  public calendarEventsFunction(fetchInfo:{ start:Date, end:Date },\n                                successCallback:(events:EventInput[]) => void,\n                                failureCallback:(error:EventSourceError) => void):void|PromiseLike<EventInput[]> {\n\n    this.fetchTimeEntries(fetchInfo.start, fetchInfo.end)\n      .then((collection) => {\n        this.entries.emit(collection);\n\n        successCallback(this.buildEntries(collection.elements, fetchInfo));\n      });\n  }\n\n  protected fetchTimeEntries(start:Date, end:Date) {\n    if (!this.memoizedTimeEntries ||\n      this.memoizedTimeEntries.start.getTime() !== start.getTime() ||\n      this.memoizedTimeEntries.end.getTime() !== end.getTime()) {\n      let promise = this\n        .timeEntryDm\n        .list({ filters: this.dmFilters(start, end), pageSize: 500 })\n        .then(collection => {\n          this.memoizedCreateAllowed = !!collection.createTimeEntry;\n\n          collection.elements.forEach(timeEntry => this.timeEntryCache.updateValue(timeEntry.id!, timeEntry));\n\n          return collection;\n        });\n\n      this.memoizedTimeEntries = { start: start, end: end, entries: promise };\n    }\n\n    return this.memoizedTimeEntries.entries;\n  }\n\n  private buildEntries(entries:TimeEntryResource[], fetchInfo:{ start:Date, end:Date }) {\n    this.setRatio(entries);\n\n    return this.buildTimeEntryEntries(entries)\n      .concat(this.buildAuxEntries(entries, fetchInfo));\n  }\n\n  private setRatio(entries:TimeEntryResource[]) {\n    let dateSums = this.calculateDateSums(entries);\n\n    let maxHours = Math.max(...Object.values(dateSums), 0);\n\n    let oldRatio = this.scaleRatio;\n\n    if (maxHours > this.maxHour - this.minHour) {\n      this.scaleRatio = this.smallerSuitableRatio((this.maxHour - this.minHour) / maxHours);\n    } else {\n      this.scaleRatio = 1;\n    }\n\n    if (oldRatio !== this.scaleRatio) {\n      // This is a hack.\n      // We already set the same function (different object) via angular.\n      // But it will trigger repainting the calendar.\n      // Weirdly, this.ucCalendar.getApi().rerender() does not.\n      this.ucCalendar.getApi().setOption('slotLabelFormat', (info:any) => {\n        return (this.maxHour - info.date.hour) / this.scaleRatio;\n      });\n    }\n  }\n\n  private buildTimeEntryEntries(entries:TimeEntryResource[]) {\n    let hoursDistribution:{ [key:string]:Moment } = {};\n\n    return entries.map((entry) => {\n      let start:Moment;\n      let end:Moment;\n      let hours = this.timezone.toHours(entry.hours) * this.scaleRatio;\n\n      if (hoursDistribution[entry.spentOn]) {\n        start = hoursDistribution[entry.spentOn].clone().subtract(hours, 'h');\n        end = hoursDistribution[entry.spentOn].clone();\n      } else {\n        start = moment(entry.spentOn).add(this.maxHour - hours, 'h');\n        end = moment(entry.spentOn).add(this.maxHour, 'h');\n      }\n\n      hoursDistribution[entry.spentOn] = start;\n\n      const color = this.colors.toHsl(this.entryName(entry));\n\n      return this.timeEntry(entry, hours, start, end);\n    }) as EventInput[];\n  }\n\n  private buildAuxEntries(entries:TimeEntryResource[], fetchInfo:{ start:Date, end:Date }) {\n    let dateSums = this.calculateDateSums(entries);\n\n    let calendarEntries:EventInput[] = [];\n\n    for (let m = moment(fetchInfo.start); m.diff(fetchInfo.end, 'days') <= 0; m.add(1, 'days')) {\n      let duration = dateSums[m.format('YYYY-MM-DD')] || 0;\n\n      calendarEntries.push(this.sumEntry(m, duration));\n\n      if (this.memoizedCreateAllowed) {\n        calendarEntries.push(this.addEntry(m, duration));\n      }\n    }\n\n    return calendarEntries;\n  }\n\n  private calculateDateSums(entries:TimeEntryResource[]) {\n    let dateSums:{ [key:string]:number } = {};\n\n    entries.forEach((entry) => {\n      let hours = this.timezone.toHours(entry.hours);\n\n      if (dateSums[entry.spentOn]) {\n        dateSums[entry.spentOn] += hours;\n      } else {\n        dateSums[entry.spentOn] = hours;\n      }\n    });\n\n    return dateSums;\n  }\n\n  protected timeEntry(entry:TimeEntryResource, hours:number, start:Moment, end:Moment) {\n    const color = this.colors.toHsl(this.entryName(entry));\n\n    let classNames = [TIME_ENTRY_CLASS_NAME];\n\n    let span = end.diff(start, 'm');\n\n    if (span < 40) {\n      classNames.push('-no-fadeout');\n    }\n\n    return {\n      title: span < 20 ? '' : this.entryName(entry),\n      startEditable: !!entry.update,\n      start: start.format(),\n      end: end.format(),\n      backgroundColor: color,\n      borderColor: color,\n      classNames: classNames,\n      entry: entry\n    };\n  }\n\n  protected sumEntry(date:Moment, duration:number) {\n    return {\n      start: date.clone().add(this.maxHour - Math.min(duration * this.scaleRatio, this.maxHour - 0.5) - 0.5, 'h').format(),\n      end: date.clone().add(this.maxHour - Math.min(((duration + 0.05) * this.scaleRatio), this.maxHour - 0.5), 'h').format(),\n      classNames: DAY_SUM_CLASS_NAME,\n      rendering: 'background' as 'background',\n      sum: this.i18n.t('js.units.hour', { count: this.formatNumber(duration) })\n    };\n  }\n\n  protected addEntry(date:Moment, duration:number) {\n    let classNames = [ADD_ENTRY_CLASS_NAME];\n\n    if (duration >= 24) {\n      classNames.push(ADD_ENTRY_PROHIBITED_CLASS_NAME);\n    }\n\n    return {\n      start: date.clone().format(),\n      end: date.clone().add(this.maxHour - Math.min(duration * this.scaleRatio, this.maxHour - 1) - 0.5, 'h').format(),\n      rendering: \"background\" as 'background',\n      classNames: classNames\n    };\n  }\n\n  protected dmFilters(start:Date, end:Date):Array<[string, FilterOperator, string[]]> {\n    let startDate = moment(start).format('YYYY-MM-DD');\n    let endDate = moment(end).subtract(1, 'd').format('YYYY-MM-DD');\n    return [['spentOn', '<>d', [startDate, endDate]] as [string, FilterOperator, string[]],\n      ['user_id', '=', ['me']] as [string, FilterOperator, [string]]];\n  }\n\n  private initializeCalendar() {\n    this.calendarEvents = this.calendarEventsFunction.bind(this);\n  }\n\n  public get calendarEventLimit() {\n    return false;\n  }\n\n  public get calendarLocale() {\n    return this.i18n.locale;\n  }\n\n  public get calendarFixedWeekCount() {\n    return false;\n  }\n\n  public get calendarDefaultView() {\n    return 'timeGridWeek';\n  }\n\n  public get calendarFirstDay() {\n    return this.configuration.startOfWeek();\n  }\n\n  private get calendarElement() {\n    return jQuery(this.element.nativeElement).find('.fc-view-container');\n  }\n\n  private dispatchEventClick(event:CalendarViewEvent) {\n    if (event.event.extendedProps.entry) {\n      this.editEvent(event.event.extendedProps.entry);\n    } else if (event.el.classList.contains(ADD_ENTRY_CLASS_NAME) && !event.el.classList.contains(ADD_ENTRY_PROHIBITED_CLASS_NAME)) {\n      this.addEvent(moment(event.event.start!));\n    }\n  }\n\n  private editEvent(entry:TimeEntryResource) {\n    this\n      .timeEntryEdit\n      .edit(entry)\n      .then(modificationAction => {\n        this.updateEventSet(modificationAction.entry, modificationAction.action);\n      })\n      .catch(() => {\n        // do nothing, the user closed without changes\n      });\n  }\n\n  private moveEvent(event:CalendarMoveEvent) {\n    let entry = event.event.extendedProps.entry;\n\n    // Use end instead of start as when dragging, the event might be too long and would thus be start\n    // on the day before by fullcalendar.\n    entry.spentOn = moment(event.event.end!).format('YYYY-MM-DD');\n\n    this\n      .timeEntryDm\n      .update(entry, entry.schema)\n      .then(event => {\n        this.updateEventSet(event, 'update');\n      })\n      .catch((e) => {\n        this.notifications.handleRawError(e);\n        event.revert();\n      });\n  }\n\n  public addEventToday() {\n    this.addEvent(moment(new Date()));\n  }\n\n  private addEvent(date:Moment) {\n    if (!this.memoizedCreateAllowed) {\n      return;\n    }\n\n    this\n      .timeEntryCreate\n      .create(date)\n      .then(modificationAction => {\n        this.updateEventSet(modificationAction.entry, modificationAction.action);\n      })\n      .catch(() => {\n        // do nothing, the user closed without changes\n      });\n  }\n\n  private updateEventSet(event:TimeEntryResource, action:'update'|'destroy'|'create') {\n    this.memoizedTimeEntries.entries.then(collection => {\n      let foundIndex = collection.elements.findIndex(x => x.id === event.id);\n\n      switch (action) {\n        case 'update':\n          collection.elements[foundIndex] = event;\n          break;\n        case 'destroy':\n          collection.elements.splice(foundIndex, 1);\n          break;\n        case 'create':\n          this.timeEntryCache.updateValue(event.id!, event);\n          collection.elements.push(event);\n          break;\n      }\n\n      this.ucCalendar.getApi().refetchEvents();\n    });\n  }\n\n  private alterEventEntry(event:CalendarViewEvent) {\n    this.appendAddIcon(event);\n    this.appendSum(event);\n\n    if (!event.event.extendedProps.entry) {\n      return;\n    }\n\n    this.addTooltip(event);\n    this.prependDuration(event);\n    this.appendFadeout(event);\n  }\n\n  private appendAddIcon(event:CalendarViewEvent) {\n    if (!event.el.classList.contains(ADD_ENTRY_CLASS_NAME)) {\n      return;\n    }\n\n    let addIcon = document.createElement('div');\n    addIcon.classList.add(ADD_ICON_CLASS_NAME);\n    addIcon.innerText = '+';\n    event.el.append(addIcon);\n  }\n\n  private appendSum(event:CalendarViewEvent) {\n    if (event.event.extendedProps.sum) {\n      event.el.append(event.event.extendedProps.sum);\n    }\n  }\n\n  private addTooltip(event:CalendarViewEvent) {\n    if (this.browserDetector.isMobile) {\n      return;\n    }\n\n    jQuery(event.el).tooltip({\n      content: this.tooltipContentString(event.event.extendedProps.entry),\n      items: '.fc-event',\n      close: function () {\n        jQuery(\".ui-helper-hidden-accessible\").remove();\n      },\n      track: true\n    });\n  }\n\n  private removeTooltip(event:CalendarViewEvent) {\n    jQuery(event.el).tooltip('disable');\n  }\n\n  private prependDuration(event:CalendarViewEvent) {\n    let formattedDuration = this.timezone.formattedDuration(event.event.extendedProps.entry.hours);\n\n    jQuery(event.el)\n      .find('.fc-title')\n      .prepend(`<div class=\"fc-duration\">${formattedDuration}</div>`);\n  }\n\n  /* Fade out event text to the bottom to avoid it being cut of weirdly.\n  * Multiline ellipsis with an unknown height is not possible, hence we blur the text.\n  * The gradient needs to take the background color of the element into account (hashed over the event\n  * title) which is why the style is set in code.\n  *\n  * We do not print anything on short entries (< 0.5 hours),\n  * which leads to the fc-short class not being applied by full calendar. For other short events, the css rules\n  * need to deactivate the fc-fadeout.\n   */\n  private appendFadeout(event:CalendarViewEvent) {\n    let timeEntry = event.event.extendedProps.entry;\n\n    if (this.timezone.toHours(timeEntry.hours) < 0.5) {\n      return;\n    }\n\n    let $element = jQuery(event.el);\n    let fadeout = jQuery(`<div class=\"fc-fadeout\"></div>`);\n\n    let hslaStart = this.colors.toHsla(this.entryName(timeEntry), 0);\n    let hslaEnd = this.colors.toHsla(this.entryName(timeEntry), 100);\n\n    fadeout.css('background', `-webkit-linear-gradient(${hslaStart} 0%, ${hslaEnd} 100%`);\n\n    ['-moz-linear-gradient', '-o-linear-gradient', 'linear-gradient', '-ms-linear-gradient'].forEach((style => {\n      fadeout.css('background-image', `${style}(${hslaStart} 0%, ${hslaEnd} 100%`);\n    }));\n\n    $element\n      .append(fadeout);\n  }\n\n  private beforeEventRemove(event:CalendarViewEvent) {\n    if (!event.event.extendedProps.entry) {\n      return;\n    }\n\n    this.removeTooltip(event);\n  }\n\n  private entryName(entry:TimeEntryResource) {\n    let name = entry.project.name;\n    if (entry.workPackage) {\n      name += ` - ${this.workPackageName(entry)}`;\n    }\n\n    return name || '-';\n  }\n\n  private workPackageName(entry:TimeEntryResource) {\n    return `#${entry.workPackage.idFromLink}: ${entry.workPackage.name}`;\n  }\n\n  private tooltipContentString(entry:TimeEntryResource) {\n    return `\n        <ul class=\"tooltip--map\">\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.time_entry.project')}:</span>\n            <span class=\"tooltip--map--value\">${this.sanitizedValue(entry.project.name)}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.time_entry.work_package')}:</span>\n            <span class=\"tooltip--map--value\">${entry.workPackage ? this.sanitizedValue(this.workPackageName(entry)) : this.i18n.t('js.placeholders.default')}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.time_entry.activity')}:</span>\n            <span class=\"tooltip--map--value\">${this.sanitizedValue(entry.activity.name)}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.time_entry.hours')}:</span>\n            <span class=\"tooltip--map--value\">${this.timezone.formattedDuration(entry.hours)}</span>\n          </li>\n          <li class=\"tooltip--map--item\">\n            <span class=\"tooltip--map--key\">${this.i18n.t('js.time_entry.comment')}:</span>\n            <span class=\"tooltip--map--value\">${entry.comment.raw || this.i18n.t('js.placeholders.default')}</span>\n          </li>\n        `;\n  }\n\n  private sanitizedValue(value:string) {\n    return this.sanitizer.sanitize(SecurityContext.HTML, value);\n  }\n\n  protected formatNumber(value:number):string {\n    return this.i18n.toNumber(value, { precision: 2 });\n  }\n\n  private smallerSuitableRatio(value:number):number {\n    for (let divisor = this.labelIntervalHours + 1; divisor < 100; divisor++) {\n      let candidate = this.labelIntervalHours / divisor;\n\n      if (value >= candidate) {\n        return candidate;\n      }\n    }\n\n    return 1;\n  }\n\n  protected setHiddenDays(displayedDays:DisplayedDays) {\n    this.hiddenDays = Array.from(displayedDays, (value, index) => {\n      if (!value) {\n        return (index + 1) % 7;\n      } else {\n        return null;\n      }\n    }).filter((value) => value !== null) as number[];\n  }\n}\n","import {Component, Injector, ChangeDetectionStrategy, ChangeDetectorRef} from \"@angular/core\";\nimport { TimeEntryResource } from 'core-app/modules/hal/resources/time-entry-resource';\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {DisplayedDays} from \"core-app/modules/calendar/te-calendar/te-calendar.component\";\n\n@Component({\n  templateUrl: './time-entries-current-user.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WidgetTimeEntriesCurrentUserComponent extends AbstractWidgetComponent {\n  public entries:TimeEntryResource[] = [];\n  public displayedDays:DisplayedDays;\n\n  constructor(protected readonly injector:Injector,\n              readonly timezone:TimezoneService,\n              readonly i18n:I18nService,\n              readonly pathHelper:PathHelperService,\n              protected readonly cdr:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  public ngOnInit() {\n    this.displayedDays = this.resource.options.days as DisplayedDays;\n  }\n\n  public updateEntries(entries:CollectionResource<TimeEntryResource>) {\n    this.entries = entries.elements;\n\n    this.cdr.detectChanges();\n  }\n\n  public get total() {\n    let duration = this.entries.reduce((current, entry) => {\n      return current + this.timezone.toHours(entry.hours);\n    }, 0);\n\n    if (duration > 0) {\n      return this.i18n.t('js.units.hour', { count: this.formatNumber(duration) });\n    } else {\n      return this.i18n.t('js.placeholders.default');\n    }\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  public updateConfiguration(options:{ days:DisplayedDays }) {\n    this.resourceChanged.emit(this.setChangesetOptions(options));\n    // Need to copy to trigger change detection\n    this.displayedDays = [...options.days] as DisplayedDays;\n  }\n\n  protected formatNumber(value:number):string {\n    return this.i18n.toNumber(value, { precision: 2 });\n  }\n}\n","<widget-header\n  [name]=\"widgetName\"\n  [editable]=\"isEditable\">\n\n  <widget-time-entries-current-user-menu\n    [resource]=\"resource\"\n    (onConfigured)=\"updateConfiguration($event)\">\n  </widget-time-entries-current-user-menu>\n</widget-header>\n\n<te-calendar\n  (entries)=\"updateEntries($event)\"\n  [displayedDays]=\"displayedDays\"\n></te-calendar>\n\n<ng-container>\n  <div class=\"total-hours\">\n    <p>Total: <span [textContent]=\"total\"></span></p>\n  </div>\n</ng-container>\n","import {Injectable} from \"@angular/core\";\nimport {WidgetRegistration} from \"app/modules/grids/grid/grid.component\";\nimport {HookService} from \"app/modules/plugins/hook-service\";\n\n@Injectable()\nexport class GridWidgetsService {\n  constructor(private Hook:HookService) {}\n\n  public get registered() {\n    let registeredWidgets:WidgetRegistration[] = [];\n\n    _.each(this.Hook.call('gridWidgets'), (registration:WidgetRegistration[]) => {\n      registeredWidgets = registeredWidgets.concat(registration);\n    });\n\n    return registeredWidgets;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ViewChild} from '@angular/core';\nimport {WorkPackagesViewBase} from \"core-app/modules/work_packages/routing/wp-view-base/work-packages-view.base\";\nimport {WorkPackagesCalendarController} from \"core-app/modules/calendar/wp-calendar/wp-calendar.component\";\n\n@Component({\n  templateUrl: './wp-calendar-entry.component.html'\n})\n\nexport class WorkPackagesCalendarEntryComponent extends WorkPackagesViewBase {\n  @ViewChild(WorkPackagesCalendarController, { static: true }) calendarElement:WorkPackagesCalendarController;\n\n  protected set loadingIndicator(promise:Promise<unknown>) {\n    this.loadingIndicatorService.indicator('calendar-entry').promise = promise;\n  }\n\n  public refresh(visibly:boolean, firstPage:boolean):Promise<unknown> {\n    return this.loadingIndicator =\n      this.wpListService.loadCurrentQueryFromParams(this.projectIdentifier!);\n  }\n}\n","<div class=\"work-packages-calendar-view--container loading-indicator--location\"\n     data-indicator-name=\"calendar-entry\">\n    <div class=\"toolbar-container -editable\">\n        <div class=\"toolbar\">\n            <div class=\"title-container\">\n                <h2>\n                   {{ I18n.t('js.calendar.title') }}\n                </h2>\n            </div>\n\n            <ul class=\"toolbar-items hide-when-print\">\n                <li class=\"toolbar-item hidden-for-mobile\">\n                    <wp-filter-button>\n                    </wp-filter-button>\n                </li>\n                <li class=\"toolbar-item hidden-for-mobile\">\n                    <zen-mode-toggle-button>\n                    </zen-mode-toggle-button>\n                </li>\n            </ul>\n        </div>\n    </div>\n\n    <filter-container></filter-container>\n\n    <wp-calendar [projectIdentifier]=\"projectIdentifier\"></wp-calendar>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpenprojectCommonModule} from 'core-app/modules/common/openproject-common.module';\nimport {NgModule} from '@angular/core';\nimport {OpenprojectFieldsModule} from \"core-app/modules/fields/openproject-fields.module\";\nimport {TimeEntryCreateModal} from \"core-app/modules/time_entries/create/create.modal\";\nimport {TimeEntryEditModal} from \"core-app/modules/time_entries/edit/edit.modal\";\nimport {TimeEntryFormComponent} from \"core-app/modules/time_entries/form/form.component\";\nimport {TimeEntryEditService} from \"core-app/modules/time_entries/edit/edit.service\";\nimport {TriggerActionsEntryComponent} from \"core-app/modules/time_entries/edit/trigger-actions-entry.component\";\n\n@NgModule({\n  imports: [\n    // Commons\n    OpenprojectCommonModule,\n\n    // Editable fields e.g. for modals\n    OpenprojectFieldsModule,\n  ],\n  providers: [\n    TimeEntryEditService,\n  ],\n  declarations: [\n    TimeEntryEditModal,\n    TimeEntryCreateModal,\n    TimeEntryFormComponent,\n    TriggerActionsEntryComponent\n  ]\n})\nexport class OpenprojectTimeEntriesModule {\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpenprojectCommonModule} from 'core-app/modules/common/openproject-common.module';\nimport {NgModule} from '@angular/core';\nimport {FullCalendarModule} from '@fullcalendar/angular';\nimport {WorkPackagesCalendarEntryComponent} from \"core-app/modules/calendar/wp-calendar-entry/wp-calendar-entry.component\";\nimport {WorkPackagesCalendarController} from \"core-app/modules/calendar/wp-calendar/wp-calendar.component\";\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\nimport {Ng2StateDeclaration, UIRouterModule} from \"@uirouter/angular\";\nimport {TimeEntryCalendarComponent} from \"core-app/modules/calendar/te-calendar/te-calendar.component\";\nimport {OpenprojectFieldsModule} from \"core-app/modules/fields/openproject-fields.module\";\nimport {OpenprojectTimeEntriesModule} from \"core-app/modules/time_entries/openproject-time-entries.module\";\n\nconst menuItemClass = 'calendar-menu-item';\n\nexport const CALENDAR_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'work-packages.calendar',\n    url: '/calendar',\n    component: WorkPackagesCalendarEntryComponent,\n    reloadOnSearch: false,\n    data: {\n      bodyClasses: 'router--work-packages-calendar',\n      menuItem: menuItemClass,\n      parent: 'work-packages'\n    }\n  }\n];\n\n@NgModule({\n  imports: [\n    // Commons\n    OpenprojectCommonModule,\n\n    // Routes for /work_packages/calendar\n    UIRouterModule.forChild({ states: CALENDAR_ROUTES }),\n\n    // Work Package module\n    OpenprojectWorkPackagesModule,\n\n    // Time entry module\n    OpenprojectTimeEntriesModule,\n\n    // Editable fields e.g. for modals\n    OpenprojectFieldsModule,\n\n    // Calendar component\n    FullCalendarModule,\n  ],\n  declarations: [\n    // Work package calendars\n    WorkPackagesCalendarEntryComponent,\n    WorkPackagesCalendarController,\n    TimeEntryCalendarComponent,\n  ],\n  exports: [\n    WorkPackagesCalendarController,\n    TimeEntryCalendarComponent,\n  ]\n})\nexport class OpenprojectCalendarModule {\n}\n","<widget-header\n    [name]=\"widgetName\"\n    [editable]=\"isEditable\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<div class=\"grid--widget-content\">\n  <no-results *ngIf=\"noEntries\"\n              [title]=\"text.noResults\">\n  </no-results>\n  <ng-container *ngFor=\"let document of entries\">\n    <h4 class=\"document-category-elements--header\">\n      <a [href]=\"documentPath(document)\"\n         [textContent]=\"document.title\">\n      </a>\n    </h4>\n    <p class=\"document-category-elements--date\">\n      <em [textContent]=\"documentCreated(document)\"></em>\n    </p>\n\n    <div class=\"wiki grid--widget-limited-text\"\n         [innerHtml]=\"documentDescription(document)\">\n    </div>\n  </ng-container>\n</div>\n","import {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {Component, OnInit, SecurityContext, ChangeDetectionStrategy, ChangeDetectorRef, Injector} from '@angular/core';\nimport {DocumentResource} from \"../../../../../../../modules/documents/frontend/module/hal/resources/document-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {DomSanitizer} from '@angular/platform-browser';\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\n\n@Component({\n  templateUrl: './documents.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetDocumentsComponent extends AbstractWidgetComponent implements OnInit {\n  public text = {\n    noResults: this.i18n.t('js.grid.widgets.documents.no_results'),\n  };\n\n  public entries:DocumentResource[] = [];\n  private entriesLoaded = false;\n\n  constructor(readonly halResource:HalResourceService,\n              readonly pathHelper:PathHelperService,\n              readonly i18n:I18nService,\n              readonly timezone:TimezoneService,\n              readonly domSanitizer:DomSanitizer,\n              protected readonly injector:Injector,\n              readonly currentProject:CurrentProjectService,\n              readonly cdr:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.halResource\n      .get<CollectionResource>(this.documentsUrl)\n      .toPromise()\n      .then((collection) => {\n        this.entries = collection.elements as DocumentResource[];\n        this.entriesLoaded = true;\n\n        this.cdr.detectChanges();\n      });\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  public documentPath(document:DocumentResource) {\n    return `${this.pathHelper.appBasePath}/documents/${document.id}`;\n  }\n\n  public documentCreated(document:DocumentResource) {\n    return this.timezone.formattedDatetime(document.createdAt);\n  }\n\n  public documentDescription(document:DocumentResource) {\n    return this.domSanitizer.sanitize(SecurityContext.HTML, document.description.html);\n  }\n\n  public get noEntries() {\n    return !this.entries.length && this.entriesLoaded;\n  }\n\n  public get documentsUrl() {\n    let orders = JSON.stringify([['updated_at', 'desc']]);\n\n    let url = `${this.pathHelper.api.v3.apiV3Base}/documents?sortBy=${orders}&pageSize=10`;\n\n    if (this.currentProject.id) {\n      let filters = JSON.stringify([{project_id: { operator: '=', values: [this.currentProject.id.toString()]}}]);\n\n      url = url + `&filters=${filters}`;\n    }\n\n    return url;\n  }\n}\n","<widget-header [name]=\"widgetName\"\n               [editable]=\"isEditable\">\n\n  <widget-menu [resource]=\"resource\">\n  </widget-menu>\n\n</widget-header>\n<div class=\"grid--widget-content\">\n  <no-results *ngIf=\"noEntries\" \n              [title]=\"text.noResults\">\n  </no-results>\n  <ul class=\"widget-box--arrow-links\">\n    <li class=\"-widget-box--arrow-multiline\" \n        *ngFor=\"let news of entries\">\n      <div class=\"news-project\">\n        <user-avatar *ngIf=\"news.author\"\n                     [user]=\"news.author\"\n                     data-class-list=\"avatar news-author-avatar hidden-for-mobile\">\n        </user-avatar>\n        <div>\n          <a [href]=\"newsProjectPath(news)\"\n             [textContent]=\"newsProjectName(news)\">\n          </a>:\n          <a [href]=\"newsPath(news)\"\n             [textContent]=\"news.title\">\n          </a>\n        </div>\n        <div *ngIf=\"news.author\" \n             class=\"news-author\">\n          <span [innerHTML]=\"text.addedBy(news)\"></span>\n        </div>\n        <div>\n          <p *ngIf=\"news.summary\" \n             [textContent]=\"news.summary\"\n             class=\"widget-box--additional-info\"></p>\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>","import { AbstractWidgetComponent } from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport { ChangeDetectionStrategy, Component, Injector, OnInit, ChangeDetectorRef } from '@angular/core';\nimport { I18nService } from \"core-app/modules/common/i18n/i18n.service\";\nimport { PathHelperService } from \"core-app/modules/common/path-helper/path-helper.service\";\nimport { TimezoneService } from \"core-components/datetime/timezone.service\";\nimport { NewsResource } from \"core-app/modules/hal/resources/news-resource\";\nimport { NewsDmService } from \"core-app/modules/hal/dm-services/news-dm.service\";\nimport { CurrentProjectService } from \"core-components/projects/current-project.service\";\nimport { DmListParameter } from \"core-app/modules/hal/dm-services/dm.service.interface\";\n\n@Component({\n  templateUrl: './news.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WidgetNewsComponent extends AbstractWidgetComponent implements OnInit {\n  public text = {\n    at: this.i18n.t('js.grid.widgets.news.at'),\n    noResults: this.i18n.t('js.grid.widgets.news.no_results'),\n    addedBy: (news:NewsResource) => this.i18n.t('js.label_added_time_by',\n      { author: this.newsAuthorName(news), age: this.newsCreated(news), authorLink: this.newsAuthorPath(news)})\n  };\n\n  public entries:NewsResource[] = [];\n  private entriesLoaded = false;\n\n  constructor(\n\n    readonly pathHelper:PathHelperService,\n    readonly i18n:I18nService,\n    protected readonly injector:Injector,\n    readonly timezone:TimezoneService,\n    readonly newsDm:NewsDmService,\n    readonly currentProject:CurrentProjectService,\n    readonly cdr:ChangeDetectorRef\n  ) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.newsDm\n      .list(this.newsDmParams)\n      .then(collection => this.setupNews(collection.elements));\n  }\n\n  public setupNews(news:any[]) {\n\n    this.entries = news;\n    this.entriesLoaded = true;\n    this.cdr.detectChanges();\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  public newsPath(news:NewsResource) {\n\n    return this.pathHelper.newsPath(news.id!);\n  }\n\n  public newsProjectPath(news:NewsResource) {\n    return this.pathHelper.projectPath(news.project?.idFromLink);\n  }\n\n  public newsProjectName(news:NewsResource) {\n    return news.project?.name;\n  }\n\n  public newsAuthorName(news:NewsResource) {\n    return news.author?.name;\n  }\n\n  public newsAuthorPath(news:NewsResource) {\n    return this.pathHelper.userPath(news.author?.id);\n\n  }\n\n  public newsCreated(news:NewsResource) {\n    return this.timezone.formattedDatetime(news.createdAt);\n  }\n\n  public get noEntries() {\n    return !this.entries.length && this.entriesLoaded;\n  }\n\n  private get newsDmParams() {\n    let params:DmListParameter = {\n      sortBy: [['created_at', 'desc']],\n      pageSize: 3\n    };\n\n    if (this.currentProject.id) {\n      params['filters'] = [['project_id', '=', [this.currentProject.id]]];\n    }\n\n    return params;\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {GridDmService} from \"core-app/modules/hal/dm-services/grid-dm.service\";\n\n@Injectable()\nexport class GridInitializationService {\n  constructor(readonly gridDm:GridDmService,\n              readonly halResourceService:HalResourceService) {}\n\n  // If a page with the current page exists (scoped to the current user by the backend)\n  // that page will be used to initialized the grid.\n  // If it does not exist, fetch the form and then create a new resource.\n  // The created resource is then used to initialize the grid.\n  public initialize(path:string) {\n    return this\n      .gridDm\n      .list({ filters: [['scope', '=', [path]]] })\n      .then(collection => {\n        if (collection.total === 0) {\n          return this.myPageForm(path);\n        } else {\n          return (collection.elements[0] as GridResource);\n        }\n      });\n  }\n\n  private myPageForm(path:string):Promise<GridResource> {\n    return new Promise<GridResource>((resolve, reject) => {\n      let payload = {\n        '_links': {\n          'scope': {\n            'href': path\n          }\n        }\n      };\n\n      this\n        .gridDm\n        .createForm(payload)\n        .then((form) => {\n          let source = form.payload.$source;\n\n          let resource = this.halResourceService.createHalResource(source) as GridResource;\n\n          if (resource.widgets.length === 0) {\n            resource.rowCount = 1;\n            resource.columnCount = 1;\n          }\n\n          this.gridDm.create(resource, form.schema)\n            .then((resource) => {\n              resolve(resource);\n            })\n            .catch(() => {\n              reject();\n            });\n        });\n    });\n  }\n}\n","import {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {Component, ViewChild} from \"@angular/core\";\n\n@Component({\n  templateUrl: './settings-tab.component.html'\n})\nexport class WpGraphConfigurationSettingsTab implements TabComponent {\n  @ViewChild('tabInner', { static: true })\n  tabInner:TabComponent;\n\n  public onSave() {\n    this.tabInner.onSave();\n  }\n}\n","<ng-container wp-isolated-query-space>\n  <settings-tab-inner #tabInner></settings-tab-inner>\n</ng-container>\n\n","import {Component, ViewChild} from '@angular/core';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\n\n@Component({\n  templateUrl: './filters-tab.component.html'\n})\nexport class WpGraphConfigurationFiltersTab implements TabComponent {\n  @ViewChild('tabInner', { static: true })\n  tabInner:TabComponent;\n\n  public onSave() {\n    this.tabInner.onSave();\n  }\n}\n","<ng-container wp-isolated-query-space>\n  <filters-tab-inner #tabInner></filters-tab-inner>\n</ng-container>\n","import {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {ChartType, ChartOptions} from 'chart.js';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport interface WpGraphQueryParams {\n  id?:string;\n  props?:any;\n  name?:string;\n}\n\nexport interface WpGraphConfiguration {\n  queries:QueryResource[];\n  queryParams:WpGraphQueryParams[];\n  chartType:ChartType;\n  chartOptions:ChartOptions;\n}\n\nexport class WpGraphConfiguration implements WpGraphConfiguration {\n  public queries:QueryResource[] = [];\n\n  constructor(public queryParams:WpGraphQueryParams[],\n              public chartOptions:ChartOptions,\n              public chartType:ChartType) {\n    this.chartType = this.chartType || 'horizontalBar';\n  }\n\n  public static queryCreationParams(i18n:I18nService, is_public:boolean) {\n    return {\n      hidden: true,\n      public: is_public,\n      name: i18n.t('js.grid.widgets.work_packages_graph.title'),\n      showHierarchies: false,\n      _links: {\n        groupBy: {\n          href: \"/api/v3/queries/group_bys/status\"\n        }\n      }\n    };\n  }\n}\n","import {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WpGraphConfigurationSettingsTab} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/settings-tab.component\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {TabInterface} from \"core-components/wp-table/configuration-modal/tab-portal-outlet\";\nimport {Injectable} from '@angular/core';\nimport {WpGraphConfigurationFiltersTab} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/filters-tab.component\";\nimport {ChartType} from 'chart.js';\nimport {QueryFormDmService} from \"core-app/modules/hal/dm-services/query-form-dm.service\";\nimport {QueryFormResource} from \"core-app/modules/hal/resources/query-form-resource\";\nimport {QueryDmService} from \"core-app/modules/hal/dm-services/query-dm.service\";\nimport {\n  WpGraphConfiguration,\n  WpGraphQueryParams\n} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\n@Injectable()\nexport class WpGraphConfigurationService {\n\n  private _configuration:WpGraphConfiguration;\n  private _forms:{[id:string]:QueryFormResource} = {};\n  private _formsPromise:Promise<void[]>|null;\n\n  constructor(readonly I18n:I18nService,\n              readonly queryFormDm:QueryFormDmService,\n              protected readonly queryDm:QueryDmService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly currentProject:CurrentProjectService) {\n  }\n\n  public persistAndReload() {\n    return new Promise((resolve, reject) => {\n      this.persistChanges().then(() => {\n        this.reloadQueries().then(() => resolve());\n      });\n    });\n  }\n\n  public persistChanges() {\n    let promises = this.queries.map(query => {\n      return this.saveQuery(query);\n    });\n\n    return Promise.all(promises);\n  }\n\n  public get datasets() {\n    return this.queries.map(query => {\n      return {\n        groups: query.results.groups,\n        queryProps: '',\n        label: query.name\n      };\n    });\n  }\n\n  public reloadQueries() {\n    this.configuration.queries.length = 0;\n\n    return this.loadQueries();\n  }\n\n  public ensureQueryAndLoad() {\n    if (this.queryParams.length === 0) {\n      return this.createInitial()\n        .then((query) => {\n          this.queryParams.push({id: query.id!});\n\n          return this.loadQueries();\n        });\n    } else {\n      return this.loadQueries();\n    }\n  }\n\n  private createInitial():Promise<QueryResource> {\n    return this.queryFormDm\n      .loadWithParams(\n        {pageSize: 0},\n        undefined,\n        this.currentProject.identifier,\n        WpGraphConfiguration.queryCreationParams(this.I18n, !!this.currentProject.identifier)\n      )\n      .then(form => {\n        const query = this.queryFormDm.buildQueryResource(form);\n\n        return this.queryDm.create(query, form);\n      });\n  }\n\n  private loadQueries() {\n    let queryPromises = this.queryParams.map(queryParam => {\n      return this.loadQuery(queryParam);\n    });\n\n    return Promise.all(queryPromises);\n  }\n\n  private loadQuery(params:WpGraphQueryParams) {\n    return this.queryDm\n      .find(\n        Object.assign({pageSize: 0}, params.props),\n        params.id,\n        this.currentProject.identifier,\n      )\n      .then(query => {\n        if (params.name) {\n          query.name = params.name;\n        }\n        this.configuration.queries.push(query);\n      });\n  }\n\n  private async saveQuery(query:QueryResource) {\n    return this.formFor(query)\n      .then(form => {\n        return this\n          .queryDm\n          .update(query, form)\n          .toPromise();\n      });\n  }\n\n  public get configuration() {\n    return this._configuration;\n  }\n\n  public set configuration(config:WpGraphConfiguration) {\n    this._configuration = config;\n    this._formsPromise = null;\n  }\n\n  public async formFor(query:QueryResource) {\n    return this\n      .loadForms()\n      .then(() => {\n        return this._forms[query.id!];\n      });\n  }\n\n  public get tabs() {\n    let tabs:TabInterface[] = [\n      {\n        name: 'graph-settings',\n        title: this.I18n.t('js.chart.tabs.graph_settings'),\n        componentClass: WpGraphConfigurationSettingsTab,\n      }\n    ];\n\n    let queryTabs = this.configuration.queries.map((query) => {\n      return {\n        name: query.id as string,\n        title: this.I18n.t('js.work_packages.query.filters'),\n        componentClass: WpGraphConfigurationFiltersTab\n      };\n    });\n\n    return tabs.concat(queryTabs);\n  }\n\n  public loadForms() {\n    if (!this._formsPromise) {\n      let formPromises = this.configuration.queries.map((query) => {\n        return this.queryFormDm\n          .load(query)\n          .then((form:QueryFormResource) => {\n            this._forms[query.id as string] = form;\n          })\n          .catch((error) => this.notificationService.handleRawError(error));\n      });\n\n      this._formsPromise = Promise.all(formPromises);\n    }\n\n    return this._formsPromise;\n  }\n\n  public get chartType() {\n    return this._configuration.chartType;\n  }\n\n  public set chartType(type:ChartType) {\n    this._configuration.chartType = type;\n  }\n\n  public get queries() {\n    return this._configuration.queries;\n  }\n\n  public get chartOptions() {\n    return this._configuration.chartOptions;\n  }\n\n  public get queryParams() {\n    return this._configuration.queryParams;\n  }\n}\n","import {\n  ApplicationRef,\n  ChangeDetectorRef,\n  Component,\n  ComponentFactoryResolver,\n  ElementRef,\n  Inject,\n  InjectionToken,\n  Injector,\n  OnDestroy,\n  OnInit,\n  Optional,\n  ViewChild\n} from '@angular/core';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {ConfigurationService} from 'core-app/modules/common/config/configuration.service';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {\n  ActiveTabInterface,\n  TabComponent,\n  TabInterface,\n  TabPortalOutlet\n} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {LoadingIndicatorService} from 'core-app/modules/common/loading-indicator/loading-indicator.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\nimport {WpGraphConfiguration} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\n\nexport const WpTableConfigurationModalPrependToken = new InjectionToken<ComponentType<any>>('WpTableConfigurationModalPrependComponent');\n\n@Component({\n  templateUrl: '../../../components/wp-table/configuration-modal/wp-table-configuration.modal.html',\n})\nexport class WpGraphConfigurationModalComponent extends OpModalComponent implements OnInit, OnDestroy  {\n\n  /* Close on escape? */\n  public closeOnEscape = false;\n\n  /* Close on outside click */\n  public closeOnOutsideClick = false;\n\n  public $element:JQuery;\n\n  public text = {\n    title: this.I18n.t('js.chart.modal_title'),\n    closePopup: this.I18n.t('js.close_popup_title'),\n\n    applyButton: this.I18n.t('js.modals.button_apply'),\n    cancelButton: this.I18n.t('js.modals.button_cancel'),\n  };\n\n  public configuration:WpGraphConfiguration;\n\n  // Get the view child we'll use as the portal host\n  @ViewChild('tabContentOutlet', { static: true }) tabContentOutlet:ElementRef;\n  // And a reference to the actual portal host interface\n  public tabPortalHost:TabPortalOutlet;\n\n  constructor(@Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              @Optional() @Inject(WpTableConfigurationModalPrependToken) public prependModalComponent:ComponentType<any>|null,\n              readonly I18n:I18nService,\n              readonly injector:Injector,\n              readonly appRef:ApplicationRef,\n              readonly componentFactoryResolver:ComponentFactoryResolver,\n              readonly loadingIndicator:LoadingIndicatorService,\n              readonly notificationService:WorkPackageNotificationService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly ConfigurationService:ConfigurationService,\n              readonly elementRef:ElementRef,\n              readonly graphConfiguration:WpGraphConfigurationService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.loadingIndicator.indicator('modal').promise = this.graphConfiguration.loadForms()\n      .then(() => {\n        this.tabPortalHost = new TabPortalOutlet(\n          this.graphConfiguration.tabs,\n          this.tabContentOutlet.nativeElement,\n          this.componentFactoryResolver,\n          this.appRef,\n          this.injector\n        );\n\n        const initialTab = this.locals['initialTab'] || this.availableTabs[0].name;\n        this.switchTo(initialTab);\n      });\n  }\n\n  ngOnDestroy() {\n    this.tabPortalHost.dispose();\n  }\n\n  public get availableTabs():TabInterface[] {\n    return this.tabPortalHost.availableTabs;\n  }\n\n  public get currentTab():ActiveTabInterface|null {\n    return this.tabPortalHost.currentTab;\n  }\n\n  public switchTo(name:string) {\n    this.tabPortalHost.switchTo(name);\n  }\n\n  public saveChanges():void {\n    this.tabPortalHost.activeComponents.forEach((component:TabComponent) => {\n      component.onSave();\n    });\n\n    this.configuration = this.graphConfiguration.configuration;\n\n    this.service.close();\n  }\n\n  /**\n   * Called when the user attempts to close the modal window.\n   * The service will close this modal if this method returns true\n   * @returns {boolean}\n   */\n  public onClose():boolean {\n    this.afterFocusOn.focus();\n    return true;\n  }\n\n  protected get afterFocusOn():JQuery {\n    return this.$element;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport { Injector, EventEmitter, Output, Directive } from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {GridRemoveWidgetService} from \"core-app/modules/grids/grid/remove-widget.service\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {ComponentType} from '@angular/cdk/portal';\nimport {WidgetAbstractMenuComponent} from \"core-app/modules/grids/widgets/menu/widget-abstract-menu.component\";\nimport {WpGraphConfigurationModalComponent} from \"core-app/modules/work-package-graphs/configuration-modal/wp-graph-configuration.modal\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\n\n@Directive()\nexport abstract class WidgetWpSetMenuComponent extends WidgetAbstractMenuComponent {\n  protected configurationComponent:ComponentType<OpModalComponent>;\n\n  @Output()\n  onConfigured:EventEmitter<any> = new EventEmitter();\n\n  protected menuItemList = [\n    this.removeItem,\n    this.configureItem\n  ];\n\n  constructor(private readonly injector:Injector,\n              private readonly opModalService:OpModalService,\n              readonly i18n:I18nService,\n              protected readonly remove:GridRemoveWidgetService,\n              readonly layout:GridAreaService) {\n  super(i18n,\n        remove,\n        layout);\n  }\n\n  protected get configureItem() {\n    return {\n      linkText: this.i18n.t('js.toolbar.settings.configure_view'),\n      onClick: () => {\n        this.opModalService.show(this.configurationComponent, this.injector, this.locals)\n          .closingEvent.subscribe((modal:WpGraphConfigurationModalComponent) => {\n            this.onConfigured.emit(modal.configuration);\n        });\n        return true;\n      }\n    };\n  }\n\n  protected get locals() {\n    return {};\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component} from '@angular/core';\nimport {WpGraphConfigurationModalComponent} from \"core-app/modules/work-package-graphs/configuration-modal/wp-graph-configuration.modal\";\nimport {WidgetWpSetMenuComponent} from \"core-app/modules/grids/widgets/menu/wp-set-menu.component\";\n\n@Component({\n  selector: 'widget-wp-graph-menu',\n  templateUrl: '../menu/widget-menu.component.html'\n})\nexport class WidgetWpGraphMenuComponent extends WidgetWpSetMenuComponent {\n  protected configurationComponent = WpGraphConfigurationModalComponent;\n}\n","<div class=\"work-packages-embedded-view--container loading-indicator--location\" #graphContainer [ngStyle]=\"{height: chartHeight}\">\n  <canvas baseChart\n          [datasets]=\"chartData\"\n          [labels]=\"chartLabels\"\n          [chartType]=\"chartType\"\n          [options]=\"chartOptions\"\n          *ngIf=\"hasDataToDisplay\">\n  </canvas>\n  <no-results *ngIf=\"!hasDataToDisplay && initialized\"\n              [title]=\"text.noResults\">\n  </no-results>\n</div>\n\n","import {Component, Input, SimpleChanges} from '@angular/core';\nimport {WorkPackageTableConfiguration} from 'core-components/wp-table/wp-table-configuration';\nimport {GroupObject} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {ChartOptions, ChartType} from 'chart.js';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport interface WorkPackageEmbeddedGraphDataset {\n  label:string;\n  queryProps:any;\n  queryId?:number|string;\n  groups?:GroupObject[];\n}\ninterface ChartDataSet {\n  label:string;\n  data:number[];\n}\n\n@Component({\n  selector: 'wp-embedded-graph',\n  templateUrl: './wp-embedded-graph.html',\n  styleUrls: ['./wp-embedded-graph.component.sass'],\n})\nexport class WorkPackageEmbeddedGraphComponent {\n  @Input() public datasets:WorkPackageEmbeddedGraphDataset[];\n  @Input('chartOptions') public inputChartOptions:ChartOptions;\n  @Input('chartType') chartType:ChartType = 'horizontalBar';\n\n  public configuration:WorkPackageTableConfiguration;\n  public error:string|null = null;\n\n  public chartHeight = '100%';\n  public chartLabels:string[] = [];\n  public chartData:ChartDataSet[] = [];\n  public chartOptions:ChartOptions;\n  public initialized = false;\n\n  public text = {\n    noResults: this.i18n.t('js.work_packages.no_results.title'),\n  };\n\n  constructor(readonly i18n:I18nService) {}\n\n  ngOnChanges(changes:SimpleChanges) {\n    if (changes.datasets) {\n      this.setChartOptions();\n      this.updateChartData();\n\n\n      if (!changes.datasets.firstChange) {\n        this.initialized = true;\n      }\n    } else if (changes.chartType) {\n      this.setChartOptions();\n    }\n  }\n\n  private updateChartData() {\n    let uniqLabels = _.uniq(this.datasets.reduce((array, dataset) => {\n      let groups = (dataset.groups || []).map((group) => group.value) as any;\n      return array.concat(groups);\n    }, [])) as string[];\n\n    let labelCountMaps = this.datasets.map((dataset) => {\n      let countMap = (dataset.groups || []).reduce((hash, group) => {\n        hash[group.value] = group.count;\n        return hash;\n      }, {} as any);\n\n      return {\n        label: dataset.label,\n        data: uniqLabels.map((label) => { return countMap[label] || 0; })\n      };\n    });\n\n    uniqLabels = uniqLabels.map((label) => {\n      if (!label) {\n        return this.i18n.t('js.placeholders.default');\n      } else {\n        return label;\n      }\n    });\n\n    this.setHeight();\n\n    // keep the array in order to update the labels\n    this.chartLabels.length = 0;\n    this.chartLabels.push(...uniqLabels);\n    this.chartData.length = 0;\n    this.chartData.push(...labelCountMaps);\n  }\n\n  protected setChartOptions() {\n    let defaults = {\n      responsive: true,\n      maintainAspectRatio: false,\n      legend: {\n        // Only display legends if more than one dataset is provided.\n        display: this.datasets.length > 1\n      },\n      plugins: {\n        datalabels: {\n          align: this.chartType === 'bar' ? 'top' : 'center',\n        }\n      }\n    };\n\n    let chartTypeDefaults:ChartOptions = {scales:{}};\n    if (this.chartType === 'horizontalBar' || this.chartType === 'bar' ) {\n     this.setChartAxesValues(chartTypeDefaults);\n    }\n\n    this.chartOptions = Object.assign({}, defaults, chartTypeDefaults, this.inputChartOptions);\n  }\n\n  public get hasDataToDisplay() {\n    return this.chartData.length > 0 && this.chartData.some(set => set.data.length > 0);\n  }\n\n  private setHeight() {\n    if (this.chartType === 'horizontalBar' && this.datasets && this.datasets[0]) {\n      let labels:string[] = [];\n      this.datasets.forEach(d => d.groups!.forEach(g => {\n        if (!labels.includes(g.value)) {\n          labels.push(g.value);\n        }\n      }));\n      let height = labels.length * 40;\n\n      if (this.datasets.length > 1) {\n        // make some more room for the legend\n        height += 40;\n      }\n\n      // some minimum height e.g. for the labels\n      height += 40;\n\n      this.chartHeight = `${height}px`;\n    } else {\n      this.chartHeight = '100%';\n    }\n  }\n\n  // function to set ticks of axis\n  private setChartAxesValues(chartOptions:ChartOptions) {\n\n    let changeableValuesAxis = [{\n      stacked: true,\n      ticks: {\n        callback: (value:number) => {\n          if (Math.floor(value) === value) {\n            return value;\n          } else {\n            return null;\n          }\n        }\n      }\n    }];\n\n    let constantValuesAxis = [{\n      stacked: true\n    }];\n\n    if (chartOptions.scales) {\n      if (this.chartType === 'bar') {\n        chartOptions.scales.yAxes = changeableValuesAxis;\n        chartOptions.scales.xAxes = constantValuesAxis;\n       } else if (this.chartType === 'horizontalBar') {\n        chartOptions.scales.xAxes = changeableValuesAxis;\n        chartOptions.scales.yAxes = constantValuesAxis;\n      }\n    }\n  }\n}\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, Injector, OnDestroy, OnInit} from '@angular/core';\nimport {WorkPackageEmbeddedGraphDataset} from \"core-app/modules/work-package-graphs/embedded/wp-embedded-graph.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {ChartOptions, ChartType} from 'chart.js';\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\nimport {WpGraphConfiguration} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration\";\n\n@Component({\n  selector: 'widget-wp-graph',\n  templateUrl: './wp-graph.component.html',\n  styleUrls: ['../wp-table/wp-table.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [WpGraphConfigurationService]\n})\nexport class WidgetWpGraphComponent extends AbstractWidgetComponent implements OnInit, OnDestroy {\n  public datasets:WorkPackageEmbeddedGraphDataset[] = [];\n\n  constructor(protected i18n:I18nService,\n              protected injector:Injector,\n              protected cdr:ChangeDetectorRef,\n              protected readonly graphConfiguration:WpGraphConfigurationService) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.initializeConfiguration();\n    this.loadQueriesInitially();\n  }\n\n  public set chartType(type:ChartType) {\n    this.resource.options.chartType = type;\n  }\n\n  public updateGraph(config:any) {\n    this.graphConfiguration.persistAndReload()\n      .then(() => {\n        this.repaint();\n\n        if (this.resource.options.chartType !== this.graphConfiguration.chartType) {\n          let changeset = this.setChangesetOptions({ chartType: this.graphConfiguration.chartType });\n\n          this.resourceChanged.emit(changeset);\n        }\n      });\n  }\n\n  protected repaint() {\n    this.datasets = this.graphConfiguration.datasets;\n    this.cdr.detectChanges();\n  }\n\n  protected initializeConfiguration() {\n    let ids = [];\n    if (this.resource.options.queryId) {\n      ids.push({ id: this.resource.options.queryId as string });\n    }\n\n    this.graphConfiguration.configuration = new WpGraphConfiguration(ids,\n      this.resource.options.chartOptions as ChartOptions,\n      this.resource.options.chartType as ChartType);\n  }\n\n  protected loadQueriesInitially() {\n    this.graphConfiguration.ensureQueryAndLoad()\n      .then(() => {\n        if (!this.resource.options.queryId) {\n          let changeset = this.setChangesetOptions({ queryId: this.graphConfiguration.queryParams[0].id });\n\n          this.resourceChanged.emit(changeset);\n        }\n        this.repaint();\n      });\n  }\n\n  public get chartOptions() {\n    return this.graphConfiguration.chartOptions;\n  }\n\n  public get chartType() {\n    return this.graphConfiguration.chartType;\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    (onRenamed)=\"renameWidget($event)\">\n\n  <widget-wp-graph-menu\n      [resource]=\"resource\"\n      (onConfigured)=\"updateGraph($event)\">\n  </widget-wp-graph-menu>\n</widget-header>\n\n<wp-embedded-graph class='grid--widget-content'\n                   [datasets]=\"datasets\"\n                   [chartType]=\"chartType\">\n</wp-embedded-graph>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component} from '@angular/core';\nimport {WpTableConfigurationModalComponent} from \"core-components/wp-table/configuration-modal/wp-table-configuration.modal\";\nimport {WidgetWpSetMenuComponent} from \"core-app/modules/grids/widgets/menu/wp-set-menu.component\";\n\n@Component({\n  selector: 'widget-wp-table-menu',\n  templateUrl: '../menu/widget-menu.component.html',\n})\nexport class WidgetWpTableMenuComponent extends WidgetWpSetMenuComponent {\n  protected configurationComponent = WpTableConfigurationModalComponent;\n}\n","<widget-header\n  [name]=\"widgetName\"\n  (onRenamed)=\"renameWidget($event)\">\n  <widget-wp-table-menu\n    [resource]=\"resource\">\n  </widget-wp-table-menu>\n</widget-header>\n\n<wp-embedded-table [queryId]=\"queryId\"\n                   [configuration]=\"configuration\"\n                   *ngIf=\"queryId\">\n</wp-embedded-table>\n","import {ChangeDetectionStrategy, Component, Injector} from '@angular/core';\nimport {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {QueryFormResource} from \"core-app/modules/hal/resources/query-form-resource\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {WorkPackageTableConfiguration} from \"core-components/wp-table/wp-table-configuration\";\nimport {Observable} from 'rxjs';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {QueryFormDmService} from \"core-app/modules/hal/dm-services/query-form-dm.service\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {QueryDmService} from \"core-app/modules/hal/dm-services/query-dm.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {StateService} from '@uirouter/core';\nimport {skip} from 'rxjs/operators';\n\n@Component({\n  selector: 'widget-wp-table',\n  templateUrl: './wp-table.component.html',\n  styleUrls: ['./wp-table.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WidgetWpTableComponent extends AbstractWidgetComponent {\n  public queryId:string|null;\n  private queryForm:QueryFormResource;\n  public inFlight = false;\n  public query$:Observable<QueryResource>;\n\n  public configuration:Partial<WorkPackageTableConfiguration> = {\n    actionsColumnEnabled: false,\n    columnMenuEnabled: false,\n    hierarchyToggleEnabled: true,\n    contextMenuEnabled: false\n  };\n\n  constructor(protected i18n:I18nService,\n              protected readonly injector:Injector,\n              protected urlParamsHelper:UrlParamsHelperService,\n              protected readonly state:StateService,\n              protected readonly queryDm:QueryDmService,\n              protected readonly querySpace:IsolatedQuerySpace,\n              protected readonly queryFormDm:QueryFormDmService) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    if (!this.resource.options.queryId) {\n      this.createInitial()\n        .then((query) => {\n          let changeset = this.setChangesetOptions({ queryId: query.id });\n\n          this.resourceChanged.emit(changeset);\n\n          this.queryId = query.id;\n        });\n    } else {\n      this.queryId = this.resource.options.queryId as string;\n    }\n\n    this.query$ = this\n      .querySpace\n      .query\n      .values$();\n\n    this.query$\n      .pipe(\n        // 2 because ... well it is a magic number and works\n        skip(2),\n        this.untilDestroyed()\n      ).subscribe((query) => {\n      this.ensureFormAndSaveQuery(query);\n    });\n  }\n\n  public get widgetName() {\n    return this.resource.options.name as string;\n  }\n\n  public static get identifier():string {\n    return 'work_packages_table';\n  }\n\n  private ensureFormAndSaveQuery(query:QueryResource) {\n    if (this.queryForm) {\n      this.saveQuery(query);\n    } else {\n      this.queryFormDm.load(query).then((form) => {\n        this.queryForm = form;\n        this.saveQuery(query);\n      });\n    }\n  }\n\n  private saveQuery(query:QueryResource) {\n    this.inFlight = true;\n\n    this\n      .queryDm\n      .update(query, this.queryForm)\n      .toPromise()\n      .then((query) => {\n        this.inFlight = false;\n        return query;\n      })\n      .catch(() => this.inFlight = false);\n  }\n\n  private createInitial():Promise<QueryResource> {\n    const projectIdentifier = this.state.params['projectPath'];\n    let initializationProps = this.resource.options.queryProps;\n    let queryProps = Object.assign({ pageSize: 0 }, initializationProps);\n\n    return this.queryFormDm\n      .loadWithParams(\n        queryProps,\n        undefined,\n        projectIdentifier,\n        this.queryCreationParams()\n      )\n      .then(form => {\n        const query = this.queryFormDm.buildQueryResource(form);\n\n        return this.queryDm.create(query, form).then((query) => {\n          delete this.resource.options.queryProps;\n\n          return query;\n        });\n      });\n  }\n\n  protected queryCreationParams() {\n    // On the MyPage, the queries should be non public, on a project dashboard, they should be public.\n    // This will not longer work, when global dashboards are implemented as the tables then need to\n    // be public as well.\n    const projectIdentifier = this.state.params['projectPath'];\n\n    return {\n      hidden: true,\n      public: !!projectIdentifier\n    };\n  }\n}\n","import {Component} from '@angular/core';\nimport {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {WidgetChangeset} from \"core-app/modules/grids/widgets/widget-changeset\";\n\n@Component({\n  templateUrl: './wp-table-qs.component.html',\n  styleUrls: ['./wp-table-qs.component.sass'],\n})\nexport class WidgetWpTableQuerySpaceComponent extends AbstractWidgetComponent {\n  public onResourceChanged(changeset:WidgetChangeset) {\n    this.resourceChanged.emit(changeset);\n  }\n}\n","<ng-container wp-isolated-query-space>\n  <widget-wp-table [resource]=\"resource\"\n                   (resourceChanged)=\"onResourceChanged($event)\"> </widget-wp-table>\n</ng-container>\n","import {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\n\nexport abstract class QuerySpacedTabComponent {\n  constructor(readonly I18n:I18nService,\n              readonly wpStatesInitialization:WorkPackageStatesInitializationService,\n              readonly wpGraphConfiguration:WpGraphConfigurationService) {\n  }\n\n  protected initializeQuerySpace() {\n    return this\n             .wpGraphConfiguration\n             .formFor(this.query)\n             .then(form => {\n               this.wpStatesInitialization.initialize(this.query, this.query.results);\n               this.wpStatesInitialization.updateStatesFromForm(this.query, form);\n             });\n  }\n\n  protected abstract get query():QueryResource;\n}\n","<query-filters *ngIf=\"!!filters\"\n               (filtersChanged)=\"filters = $event\"\n               [filters]=\"filters\"></query-filters>\n","import {Component} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {WorkPackageFiltersService} from 'core-components/filters/wp-filters/wp-filters.service';\nimport {WorkPackageViewFiltersService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service';\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {QuerySpacedTabComponent} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/abstract-query-spaced-tab.component\";\n\n@Component({\n  selector: 'filters-tab-inner',\n  templateUrl: './filters-tab-inner.component.html',\n})\nexport class WpGraphConfigurationFiltersTabInner extends QuerySpacedTabComponent implements TabComponent {\n  public filters:QueryFilterInstanceResource[] = [];\n\n  public text = {\n    multiSelectLabel: this.I18n.t('js.work_packages.label_column_multiselect'),\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly wpFiltersService:WorkPackageFiltersService,\n              readonly wpStatesInitialization:WorkPackageStatesInitializationService,\n              readonly wpGraphConfiguration:WpGraphConfigurationService) {\n    super(I18n, wpStatesInitialization, wpGraphConfiguration);\n  }\n\n  ngOnInit() {\n    this.initializeQuerySpace()\n      .then(() => {\n        this.wpTableFilters\n          .onReady()\n          .then(() => {\n            this.filters = this.wpTableFilters.current;\n          });\n      });\n  }\n\n  public onSave() {\n    if (this.filters) {\n      this.wpTableFilters.replaceIfComplete(this.filters);\n      this.wpTableFilters.applyToQuery(this.wpGraphConfiguration.queries[0]);\n    }\n  }\n\n  protected get query() {\n    return this.wpGraphConfiguration.queries[0];\n  }\n}\n","<div>\n  <form class=\"form\">\n    <div class=\"form--field\">\n      <label class=\"form--label\" [textContent]=\"text.group_by\" for=\"selected_grouping\"></label>\n      <div class=\"form--field-container\">\n        <div class=\"form--select-container -middle\">\n          <select [(ngModel)]=\"currentGroup\"\n                  [ngModelOptions]=\"{standalone: true}\"\n                  id=\"selected_grouping\"\n                  class=\"form--select\">\n            <option *ngFor=\"let group of availableGroups\"\n                    [ngValue]=\"group\"\n                    [textContent]=\"group.name\"></option>\n          </select>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"form--field\">\n      <label class=\"form--label\" [textContent]=\"text.chart_type\" for=\"selected_chart_type\"></label>\n      <div class=\"form--field-container\">\n        <div class=\"form--select-container -middle\">\n          <select [(ngModel)]=\"currentChartType\"\n                  [ngModelOptions]=\"{standalone: true}\"\n                  id=\"selected_chart_type\">\n            <option *ngFor=\"let type of availableChartTypes\"\n                    [ngValue]=\"type\"\n                    [textContent]=\"type.label\"></option>\n          </select>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n","\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageViewGroupByService} from 'core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-group-by.service';\nimport {QueryGroupByResource} from 'core-app/modules/hal/resources/query-group-by-resource';\nimport {Component} from \"@angular/core\";\nimport {ChartType} from 'chart.js';\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {TabComponent} from \"core-components/wp-table/configuration-modal/tab-portal-outlet\";\nimport {QuerySpacedTabComponent} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/abstract-query-spaced-tab.component\";\n\ninterface OpChartType {\n  identifier:ChartType;\n  label:string;\n}\n\n@Component({\n  selector: 'settings-tab-inner',\n  templateUrl: './settings-tab-inner.component.html'\n})\nexport class WpGraphConfigurationSettingsTabInner extends QuerySpacedTabComponent implements TabComponent {\n  // Grouping\n  public availableGroups:QueryGroupByResource[] = [];\n  public availableChartTypes:OpChartType[];\n  public currentChartType:OpChartType;\n\n  public text = {\n    group_by: this.I18n.t('js.chart.axis_criteria'),\n    chart_type: this.I18n.t('js.chart.type')\n  };\n\n  constructor(readonly I18n:I18nService,\n              readonly wpTableGroupBy:WorkPackageViewGroupByService,\n              readonly wpStatesInitialization:WorkPackageStatesInitializationService,\n              readonly wpGraphConfiguration:WpGraphConfigurationService) {\n    super(I18n, wpStatesInitialization, wpGraphConfiguration);\n  }\n\n  public onSave() {\n    this.wpGraphConfiguration.chartType = this.currentChartType.identifier;\n    this.wpGraphConfiguration.queries.forEach((query) => {\n      this.wpTableGroupBy.applyToQuery(query);\n    });\n  }\n\n  public get currentGroup() {\n    return this.wpTableGroupBy.current!;\n  }\n\n  public set currentGroup(value:QueryGroupByResource) {\n    this.wpTableGroupBy.update(value);\n  }\n\n  ngOnInit() {\n    this\n      .initializeQuerySpace()\n      .then(() => {\n        this.wpTableGroupBy\n          .onReady()\n          .then(() => {\n            this.initializeAvailableGroups();\n            this.initializeAvailableChartType();\n          });\n      });\n  }\n\n  private initializeAvailableGroups() {\n    let available = this.wpTableGroupBy.available;\n    // the object in current is not identical to one in available. We therefore\n    // have to do this by hand to be able to just use ngModel later.\n    let current = this.wpTableGroupBy.current;\n\n    if (current) {\n      available = available.filter(group => group.id !== current!.id);\n      available = available.concat(current);\n    }\n\n    this.availableGroups = _.sortBy(available, 'name');\n  }\n\n  private initializeAvailableChartType() {\n    this.availableChartTypes = _.sortBy([\n      {identifier: 'horizontalBar' as ChartType, label: this.I18n.t('js.chart.types.horizontal_bar')},\n      {identifier: 'bar' as ChartType, label: this.I18n.t('js.chart.types.bar')},\n      {identifier: 'line' as ChartType, label: this.I18n.t('js.chart.types.line')},\n      {identifier: 'pie' as ChartType, label: this.I18n.t('js.chart.types.pie')},\n      {identifier: 'doughnut' as ChartType, label: this.I18n.t('js.chart.types.doughnut')},\n      {identifier: 'radar' as ChartType, label: this.I18n.t('js.chart.types.radar')},\n      {identifier: 'polarArea' as ChartType, label: this.I18n.t('js.chart.types.polar_area')}\n    ], 'label');\n\n    this.currentChartType = this.availableChartTypes.find(type => type.identifier === this.wpGraphConfiguration.configuration.chartType) || this.availableChartTypes[0];\n  }\n\n  protected get query() {\n    return this.wpGraphConfiguration.queries[0];\n  }\n}\n","<select [(ngModel)]=\"groupBy\"\n        (ngModelChange)=\"setQueryProps()\">\n    <option [ngValue]=\"option.key\" *ngFor=\"let option of availableGroupBy\">{{option.label}}</option>\n</select>\n\n<div *ngIf=\"error\"\n    class=\"notification-box -error\">\n    <div class=\"notification-box--content\"\n         [textContent]=\"error\">\n    </div>\n</div>\n\n<wp-embedded-graph #wpEmbeddedGraphMulti\n                 [datasets]=\"datasets\"\n                 [chartOptions]=\"chartOptions\"\n                 *ngIf=\"displayMulti\">\n</wp-embedded-graph>\n\n<wp-embedded-graph #wpEmbeddedGraphSingle\n                 [datasets]=\"datasets\"\n                 [chartOptions]=\"chartOptions\"\n                 *ngIf=\"displaySingle\">\n</wp-embedded-graph>\n","import {Component, ElementRef, Input, OnInit, ViewChild, ChangeDetectorRef, ChangeDetectionStrategy} from '@angular/core';\nimport {\n  WorkPackageEmbeddedGraphComponent,\n  WorkPackageEmbeddedGraphDataset\n} from \"core-app/modules/work-package-graphs/embedded/wp-embedded-graph.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ChartOptions} from 'chart.js';\nimport {WpGraphConfigurationService} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration.service\";\nimport {\n  WpGraphConfiguration,\n  WpGraphQueryParams\n} from \"core-app/modules/work-package-graphs/configuration/wp-graph-configuration\";\n\nexport const wpOverviewGraphSelector = 'wp-overview-graph';\n\n@Component({\n  selector: wpOverviewGraphSelector,\n  templateUrl: './wp-overview-graph.template.html',\n  styleUrls: ['./wp-overview-graph.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    WpGraphConfigurationService\n  ]\n})\n\nexport class WorkPackageOverviewGraphComponent implements OnInit {\n  @Input() additionalFilter:any;\n  @ViewChild('wpEmbeddedGraphMulti') private embeddedGraphMulti:WorkPackageEmbeddedGraphComponent;\n  @ViewChild('wpEmbeddedGraphSingle') private embeddedGraphSingle:WorkPackageEmbeddedGraphComponent;\n  @Input() groupBy:string = 'status';\n  @Input() chartOptions:ChartOptions = { maintainAspectRatio: false };\n  public datasets:WorkPackageEmbeddedGraphDataset[] = [];\n  public displayModeSingle = true;\n  public availableGroupBy:{label:string, key:string}[];\n  public error:string|null = null;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly I18n:I18nService,\n              readonly graphConfigurationService:WpGraphConfigurationService,\n              protected readonly cdr:ChangeDetectorRef) {\n\n    this.availableGroupBy = [{label: I18n.t('js.work_packages.properties.category'), key: 'category'},\n                             {label: I18n.t('js.work_packages.properties.type'), key: 'type'},\n                             {label: I18n.t('js.work_packages.properties.status'), key: 'status'},\n                             {label: I18n.t('js.work_packages.properties.priority'), key: 'priority'},\n                             {label: I18n.t('js.work_packages.properties.author'), key: 'author'},\n                             {label: I18n.t('js.work_packages.properties.assignee'), key: 'assignee'}];\n  }\n\n  ngOnInit() {\n    const element = this.elementRef.nativeElement;\n    this.additionalFilter = JSON.parse(element.getAttribute('additional-filter'));\n\n    this.setQueryProps();\n  }\n\n  public setQueryProps() {\n    this.datasets = [];\n\n    let params = this.graphParams;\n\n    this.graphConfigurationService.configuration = new WpGraphConfiguration(params, {}, 'horizontalBar');\n\n    // 'finally' was not available yet so the code for the change detection is duplicated\n    this\n      .graphConfigurationService\n      .reloadQueries()\n      .then(() => {\n        this.datasets = this.sortedDatasets(this.graphConfigurationService.datasets, params);\n\n        this.cdr.detectChanges();\n      })\n      .catch(() => {\n        this.error = this.I18n.t('js.chart.errors.could_not_load');\n\n        this.cdr.detectChanges();\n      });\n  }\n\n  public get graphParams() {\n    let params = [];\n\n    if (this.groupBy === 'status') {\n      this.displayModeSingle = true;\n\n      params.push({ name: this.I18n.t('js.label_all'), props: this.propsBoth });\n    } else {\n      this.displayModeSingle = false;\n\n      params.push({ name: this.I18n.t('js.label_open_work_packages'), props: this.propsOpen });\n      params.push({ name: this.I18n.t('js.label_closed_work_packages'), props: this.propsClosed });\n    }\n\n    return params;\n  }\n\n  public sortedDatasets(datasets:WorkPackageEmbeddedGraphDataset[], params:WpGraphQueryParams[]) {\n    let sortingArray = params.map((x) => x.name );\n\n    return datasets.slice().sort((a, b) => {\n      return sortingArray.indexOf(a.label) - sortingArray.indexOf(b.label);\n    });\n\n  }\n\n  public get propsBoth() {\n    return this.baseProps();\n  }\n\n  public get propsOpen() {\n    return this.baseProps({status: { operator: 'o', values: []}});\n  }\n\n  public get propsClosed() {\n    return this.baseProps({status: { operator: 'c', values: []}});\n  }\n\n  private baseProps(filter?:any) {\n    let filters = [{subprojectId: {operator: '*', values: []}}];\n\n    if (filter) {\n      filters.push(filter);\n    }\n\n    if (this.additionalFilter) {\n      filters.push(this.additionalFilter);\n    }\n\n    return {\n      'columns[]': [],\n      filters: JSON.stringify(filters),\n      group_by: this.groupBy,\n      pageSize: 0\n    };\n  }\n\n  public get displaySingle() {\n    return this.displayModeSingle;\n  }\n\n  public get displayMulti() {\n    return !this.displayModeSingle;\n  }\n\n  private get currentGraph() {\n    if (this.displaySingle) {\n      return this.embeddedGraphSingle;\n    } else {\n      return this.embeddedGraphMulti;\n    }\n\n  }\n}\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpenprojectCommonModule} from 'core-app/modules/common/openproject-common.module';\nimport {NgModule} from '@angular/core';\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\nimport {WpGraphConfigurationModalComponent} from \"core-app/modules/work-package-graphs/configuration-modal/wp-graph-configuration.modal\";\nimport {WpGraphConfigurationFiltersTab} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/filters-tab.component\";\nimport {WpGraphConfigurationSettingsTab} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/settings-tab.component\";\nimport {WpGraphConfigurationFiltersTabInner} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/filters-tab-inner.component\";\nimport {WpGraphConfigurationSettingsTabInner} from \"core-app/modules/work-package-graphs/configuration-modal/tabs/settings-tab-inner.component\";\nimport {WorkPackageEmbeddedGraphComponent} from \"core-app/modules/work-package-graphs/embedded/wp-embedded-graph.component\";\nimport {WorkPackageOverviewGraphComponent} from \"core-app/modules/work-package-graphs/overview/wp-overview-graph.component\";\nimport {ChartsModule} from 'ng2-charts';\nimport * as ChartDataLabels from 'chartjs-plugin-datalabels';\n\n@NgModule({\n  imports: [\n    // Commons\n    OpenprojectCommonModule,\n\n    OpenprojectWorkPackagesModule,\n\n    ChartsModule,\n  ],\n  declarations: [\n    // Modals\n    WpGraphConfigurationModalComponent,\n    WpGraphConfigurationFiltersTab,\n    WpGraphConfigurationFiltersTabInner,\n    WpGraphConfigurationSettingsTab,\n    WpGraphConfigurationSettingsTabInner,\n\n    // Embedded graphs\n    WorkPackageEmbeddedGraphComponent,\n    // Work package graphs on version page\n    WorkPackageOverviewGraphComponent,\n\n  ],\n  exports: [\n    // Modals\n    WpGraphConfigurationModalComponent,\n\n    // Embedded graphs\n    WorkPackageEmbeddedGraphComponent,\n    WorkPackageOverviewGraphComponent\n  ]\n})\nexport class OpenprojectWorkPackageGraphsModule {\n  constructor() {\n    // By this seemingly useless statement, the plugin is registered with Chart.\n    // Simply importing it will have it removed probably by angular tree shaking\n    // so it will not be active. The current default of the plugin is to be enabled\n    // by default. This will be changed in the future:\n    // https://github.com/chartjs/chartjs-plugin-datalabels/issues/42\n    ChartDataLabels;\n  }\n}\n","<widget-header\n  [name]=\"widgetName\"\n  [editable]=\"isEditable\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<div class=\"grid--widget-content -allow-inner-overflow\">\n  <edit-form *ngIf=\"(project$ | async) as project\"\n             [resource]=\"project\">\n    <editable-attribute-field [resource]=\"project\"\n                              [fieldName]=\"'description'\">\n    </editable-attribute-field>\n  </edit-form>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnInit, ChangeDetectionStrategy, ChangeDetectorRef, Injector} from '@angular/core';\nimport {AbstractWidgetComponent} from \"app/modules/grids/widgets/abstract-widget.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {ProjectCacheService} from \"core-components/projects/project-cache.service\";\nimport {Observable} from \"rxjs\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\n\n@Component({\n  templateUrl: './project-description.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    HalResourceEditingService\n  ]\n})\nexport class WidgetProjectDescriptionComponent extends AbstractWidgetComponent implements OnInit {\n  public project$:Observable<ProjectResource>;\n\n  constructor(protected readonly i18n:I18nService,\n              protected readonly injector:Injector,\n              protected readonly projectCache:ProjectCacheService,\n              protected readonly currentProject:CurrentProjectService,\n              protected readonly cdRef:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.project$ = this.projectCache.requireAndStream(this.currentProject.id!);\n    this.cdRef.detectChanges();\n  }\n\n  public get isEditable() {\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ChangeDetectionStrategy} from '@angular/core';\nimport {AbstractWidgetComponent} from \"app/modules/grids/widgets/abstract-widget.component\";\n\n@Component({\n  templateUrl: './wp-overview.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WidgetWpOverviewComponent extends AbstractWidgetComponent {\n}\n","<widget-header\n    [name]=\"widgetName\"\n    (onRenamed)=\"renameWidget($event)\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<wp-overview-graph\n    class='grid--widget-content'\n    [groupBy]=\"'type'\">\n</wp-overview-graph>\n","import {ResourceChangeset} from \"core-app/modules/fields/changeset/resource-changeset\";\n\nexport class CustomTextChangeset extends ResourceChangeset<{ [key:string]:unknown; }> {\n\n}\n","import {EditFieldHandler} from \"core-app/modules/fields/edit/editing-portal/edit-field-handler\";\nimport {ElementRef, Injector, Injectable} from \"@angular/core\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {BehaviorSubject} from \"rxjs\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {CustomTextChangeset} from \"core-app/modules/grids/widgets/custom-text/custom-text-changeset\";\nimport {UploadFile} from \"core-components/api/op-file-upload/op-file-upload.service\";\n\n@Injectable()\nexport class CustomTextEditFieldService extends EditFieldHandler {\n  public fieldName = 'text';\n  public inEdit = false;\n  public inEditMode = false;\n  public inFlight = false;\n\n  public valueChanged$:BehaviorSubject<string>;\n\n  public changeset:CustomTextChangeset;\n\n  constructor(protected elementRef:ElementRef,\n              protected injector:Injector) {\n    super();\n  }\n\n  errorMessageOnLabel:string;\n\n  onFocusOut():void {\n    // interface\n  }\n\n  public initialize(value:GridWidgetResource) {\n    this.changeset = new CustomTextChangeset(this.newEditResource(value));\n    this.valueChanged$ = new BehaviorSubject(value.options['text'] as string);\n  }\n\n  public reinitialize(value:GridWidgetResource) {\n    this.changeset = new CustomTextChangeset(this.newEditResource(value));\n  }\n\n  /**\n   * Handle saving the text\n   */\n  public handleUserSubmit():Promise<any> {\n    return this.update();\n  }\n\n  public reset(withText:string = '') {\n    if (withText.length > 0) {\n      withText += '\\n';\n    }\n\n    this.changeset.setValue('text', { raw: withText });\n  }\n\n  public get schema():IFieldSchema {\n    return {\n      name: I18n.t('js.grid.widgets.custom_text.title'),\n      writable: true,\n      required: false,\n      type: 'Formattable',\n      hasDefault: false\n    };\n  }\n\n  private async update() {\n    return this\n      .onSubmit()\n      .then(() => {\n        this.valueChanged$.next(this.rawText);\n        this.deactivate();\n      });\n  }\n\n  public get rawText() {\n    return _.get(this.textValue, 'raw', '');\n  }\n\n  public get htmlText() {\n    return _.get(this.textValue, 'html', '');\n  }\n\n  public get textValue() {\n    return this.changeset.value('text');\n  }\n\n  public handleUserCancel() {\n    this.deactivate();\n  }\n\n  public get active() {\n    return this.inEdit;\n  }\n\n  public activate(withText?:string) {\n    this.inEdit = true;\n  }\n\n  deactivate():void {\n    this.changeset.clear();\n    this.inEdit = false;\n  }\n\n  focus():void {\n    const trigger = this.elementRef.nativeElement.querySelector('.inplace-editing--trigger-container');\n    trigger && trigger.focus();\n  }\n\n  setErrors(newErrors:string[]):void {\n    // interface\n  }\n\n  handleUserKeydown(event:JQuery.TriggeredEvent, onlyCancel?:boolean):void {\n    // interface\n  }\n\n  isChanged():boolean {\n    return !this.changeset.isEmpty();\n  }\n\n  stopPropagation(evt:JQuery.TriggeredEvent):boolean {\n    return false;\n  }\n\n  private newEditResource(value:GridWidgetResource) {\n    return { text: value.options.text,\n             getEditorTypeFor: () => 'full',\n             canAddAttachments: value.grid.canAddAttachments,\n             uploadAttachments: (files:UploadFile[]) => value.grid.uploadAttachments(files) };\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    (onRenamed)=\"renameWidget($event)\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<ng-template #text>\n  <span #displayContainer\n        class=\"inline-edit--formattable-display-text -default\">\n    <span\n        *ngIf=\"!textEmpty\"\n        [innerHTML]=\"customText\"></span>\n    <span\n        *ngIf=\"textEmpty\"\n        [innerHTML]=\"placeholderText\"></span>\n  </span>\n</ng-template>\n\n<div class=\"grid--widget-content -custom-text -allow-inner-overflow\">\n  <div class=\"inline-edit--container inplace-edit\">\n    <edit-form-portal *ngIf=\"active\"\n                      [schemaInput]=\"schema\"\n                      [changeInput]=\"changeset\"\n                      [editFieldHandler]=\"handler\">\n    </edit-form-portal>\n    <attachments *ngIf=\"active\"\n                 [resource]=\"resource.grid\"\n                 data-allow-uploading=\"true\">\n    </attachments>\n\n    <div *ngIf=\"!active\"\n         class=\"inplace-edit--read wiki -no-label\"\n         [ngClass]=\"{'inline-edit--container': isTextEditable}\">\n      <div *ngIf=\"isTextEditable\"\n           (accessibleClick)=\"activate($event)\"\n           [accessibleClickStopEvent]=\"false\"\n           [ngClass]=\"inplaceEditClasses\">\n\n        <ng-container *ngTemplateOutlet=\"text\"></ng-container>\n      </div>\n\n      <ng-container *ngIf=\"!isTextEditable\">\n        <ng-container *ngTemplateOutlet=\"text\"></ng-container>\n      </ng-container>\n    </div>\n  </div>\n</div>\n","import {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  SimpleChanges,\n  ViewChild\n} from '@angular/core';\nimport {CustomTextEditFieldService} from \"core-app/modules/grids/widgets/custom-text/custom-text-edit-field.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {filter} from 'rxjs/operators';\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {DomSanitizer, SafeHtml} from '@angular/platform-browser';\n\n@Component({\n  templateUrl: './custom-text.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    CustomTextEditFieldService\n  ]\n})\nexport class WidgetCustomTextComponent extends AbstractWidgetComponent implements OnInit, OnChanges, OnDestroy {\n  protected currentRawText:string;\n  public customText:SafeHtml;\n\n  @ViewChild('displayContainer') readonly displayContainer:ElementRef;\n\n  constructor(protected i18n:I18nService,\n              protected injector:Injector,\n              public handler:CustomTextEditFieldService,\n              protected cdr:ChangeDetectorRef,\n              readonly sanitization:DomSanitizer,\n              protected layout:GridAreaService) {\n    super(i18n, injector);\n  }\n\n  ngOnInit():void {\n    this.setupVariables(true);\n\n    this\n      .handler\n      .valueChanged$\n      .pipe(\n        this.untilDestroyed(),\n        filter(value => value !== this.resource.options['text'])\n      ).subscribe(newText => {\n      let changeset = this.setChangesetOptions({ text: { raw: newText } });\n      this.resourceChanged.emit(changeset);\n    });\n  }\n\n  ngOnChanges(changes:SimpleChanges):void {\n    if (changes.resource.currentValue.options.text.raw !== this.currentRawText) {\n      this.setupVariables();\n\n      this.cdr.detectChanges();\n    }\n  }\n\n  public activate(event:MouseEvent) {\n    // Prevent opening the edit mode if a link was clicked\n    if (this.clickedElementIsLinkWithinDisplayContainer(event)) {\n      return;\n    }\n\n    // Load the attachments so that they are displayed in the list.\n    // Once that is done, we can show the edit form.\n    this.resource.grid.updateAttachments().then(() => {\n      this.handler.activate();\n    });\n  }\n\n  public get placeholderText() {\n    return this.i18n.t('js.grid.widgets.work_packages_overview.placeholder');\n  }\n\n  public get inplaceEditClasses() {\n    let classes = 'inplace-editing--container inline-edit--display-field -editable';\n\n    if (this.textEmpty) {\n      classes += ' -placeholder';\n    }\n\n    return classes;\n  }\n\n  public get schema() {\n    return this.handler.schema;\n  }\n\n  public get changeset() {\n    return this.handler.changeset;\n  }\n\n  public get active() {\n    return this.handler.active;\n  }\n\n  public get textEmpty() {\n    return !this.currentRawText.length;\n  }\n\n  public get isTextEditable() {\n    return this.layout.isEditable;\n  }\n\n  private setupVariables(initial = false) {\n    this.memorizeRawText();\n    if (initial) {\n      this.handler.initialize(this.resource);\n    } else {\n      this.handler.reinitialize(this.resource);\n    }\n    this.memorizeCustomText();\n  }\n\n  private memorizeRawText() {\n    this.currentRawText = (this.resource.options.text as HalResource).raw;\n  }\n\n  private memorizeCustomText() {\n    this.customText = this.sanitization.bypassSecurityTrustHtml(this.handler.htmlText);\n  }\n\n  private clickedElementIsLinkWithinDisplayContainer(event:any) {\n    return this.displayContainer.nativeElement.contains(event.target.closest('a,macro'));\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    [editable]=\"isEditable\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<div class=\"grid--widget-content\">\n  <edit-form *ngIf=\"(project$ | async) as project\"\n             [resource]=\"project\">\n    <div class=\"attributes-map\">\n      <ng-container *ngFor=\"let cf of customFields\">\n        <div class=\"attributes-map--key\">\n          {{ cf.label }}\n        </div>\n        <div class=\"attributes-map--value\">\n          <editable-attribute-field [resource]=\"project\"\n                                    [fieldName]=\"cf.key\">\n          </editable-attribute-field>\n        </div>\n      </ng-container>\n    </div>\n  </edit-form>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {AbstractWidgetComponent} from \"app/modules/grids/widgets/abstract-widget.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ProjectDmService} from \"core-app/modules/hal/dm-services/project-dm.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {SchemaResource} from \"core-app/modules/hal/resources/schema-resource\";\nimport {ProjectCacheService} from \"core-components/projects/project-cache.service\";\nimport {Observable} from \"rxjs\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\n\n@Component({\n  templateUrl: './project-details.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    HalResourceEditingService\n  ]\n})\nexport class WidgetProjectDetailsComponent extends AbstractWidgetComponent implements OnInit {\n  @ViewChild('contentContainer', { static: true }) readonly contentContainer:ElementRef;\n\n  public customFields:{key:string, label:string}[] = [];\n  public project$:Observable<ProjectResource>;\n\n  constructor(protected readonly i18n:I18nService,\n              protected readonly injector:Injector,\n              protected readonly projectDm:ProjectDmService,\n              protected readonly projectCache:ProjectCacheService,\n              protected readonly currentProject:CurrentProjectService,\n              protected readonly cdRef:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.loadAndRender();\n    this.project$ = this.projectCache.requireAndStream(this.currentProject.id!);\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  private loadAndRender() {\n    Promise.all([\n        this.loadProjectSchema()\n      ])\n      .then(([schema]) => {\n        this.setCustomFields(schema);\n      });\n  }\n\n  private loadProjectSchema() {\n    return this.projectDm.schema();\n  }\n\n  private setCustomFields(schema:SchemaResource) {\n    Object.entries(schema).forEach(([key, keySchema]) => {\n      if (key.match(/customField\\d+/)) {\n        this.customFields.push({key: key, label: keySchema.name });\n      }\n    });\n\n    this.cdRef.detectChanges();\n  }\n}\n","import {ChangeDetectorRef, Injector, OnInit} from \"@angular/core\";\nimport {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {TimeEntryDmService} from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\nimport {TimeEntryResource} from \"core-app/modules/hal/resources/time-entry-resource\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {ConfirmDialogService} from \"core-components/modals/confirm-dialog/confirm-dialog.service\";\nimport {FilterOperator} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {TimeEntryEditService} from \"core-app/modules/time_entries/edit/edit.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {TimeEntryCacheService} from \"core-components/time-entries/time-entry-cache.service\";\n\nexport abstract class WidgetTimeEntriesListComponent extends AbstractWidgetComponent implements OnInit {\n  public text = {\n    activity: this.i18n.t('js.time_entry.activity'),\n    comment: this.i18n.t('js.time_entry.comment'),\n    hour: this.i18n.t('js.time_entry.hours'),\n    workPackage: this.i18n.t('js.label_work_package'),\n    edit: this.i18n.t('js.button_edit'),\n    delete: this.i18n.t('js.button_delete'),\n    confirmDelete: {\n      text: this.i18n.t('js.modals.destroy_time_entry.text'),\n      title: this.i18n.t('js.modals.destroy_time_entry.title')\n    },\n    noResults: this.i18n.t('js.grid.widgets.time_entries_list.no_results'),\n  };\n  public entries:TimeEntryResource[] = [];\n  private entriesLoaded = false;\n  public rows:{ date:string, sum?:string, entry?:TimeEntryResource}[] = [];\n\n  @InjectField() public readonly timeEntryEditService:TimeEntryEditService;\n  @InjectField() public readonly timeEntryCache:TimeEntryCacheService;\n\n  constructor(readonly timeEntryDm:TimeEntryDmService,\n              readonly injector:Injector,\n              readonly timezone:TimezoneService,\n              readonly i18n:I18nService,\n              readonly pathHelper:PathHelperService,\n              readonly confirmDialog:ConfirmDialogService,\n              protected readonly cdr:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.timeEntryDm.list({ filters: this.dmFilters(), pageSize: 500 })\n      .then((collection) => {\n        this.buildEntries(collection.elements);\n        this.entriesLoaded = true;\n\n        this.cdr.detectChanges();\n      });\n  }\n\n  public get total() {\n    let duration = this.entries.reduce((current, entry) => {\n      return current + this.timezone.toHours(entry.hours);\n    }, 0);\n\n    return this.i18n.t('js.units.hour', { count: this.formatNumber(duration) });\n  }\n\n  public get anyEntries() {\n    return !!this.entries.length;\n  }\n\n  public activityName(entry:TimeEntryResource) {\n    return entry.activity.name;\n  }\n\n  public projectName(entry:TimeEntryResource) {\n    return entry.project.name;\n  }\n\n  public workPackageName(entry:TimeEntryResource) {\n    return `#${entry.workPackage.id}: ${entry.workPackage.name}`;\n  }\n\n  public workPackageId(entry:TimeEntryResource) {\n    return entry.workPackage.id!;\n  }\n\n  public comment(entry:TimeEntryResource) {\n    return entry.comment && entry.comment.raw;\n  }\n\n  public hours(entry:TimeEntryResource) {\n    return this.formatNumber(this.timezone.toHours(entry.hours));\n  }\n\n  public workPackagePath(entry:TimeEntryResource) {\n    return this.pathHelper.workPackagePath(entry.workPackage.idFromLink);\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  public editTimeEntry(entry:TimeEntryResource) {\n    this.timeEntryCache.require(entry.id!).then((loadedEntry) => {\n      this.timeEntryEditService\n        .edit(loadedEntry)\n        .then((changedEntry) => {\n          let oldEntryIndex:number = this.entries.findIndex(el => el.id === changedEntry.entry.id);\n          let newEntries = this.entries;\n          newEntries[oldEntryIndex] = changedEntry.entry;\n\n          this.buildEntries(newEntries);\n        })\n        .catch(() => {\n          // User canceled the modal\n        });\n    });\n  }\n\n  public deleteIfConfirmed(event:Event, entry:TimeEntryResource) {\n    event.preventDefault();\n    this.confirmDialog.confirm({\n      text: this.text.confirmDelete,\n      closeByEscape: true,\n      showClose: true,\n      closeByDocument: true,\n      passedData:[\n        '#' + entry.workPackage?.idFromLink + ' ' + entry.workPackage?.name,\n        this.i18n.t(\n          'js.units.hour',\n          { count: this.timezone.toHours(entry.hours) }) + ' (' + entry.activity?.name + ')'\n      ],\n      dangerHighlighting: true\n    }).then(() => {\n      entry.delete().then(() => {\n        let newEntries = this.entries.filter((anEntry) => {\n          return entry.id !== anEntry.id;\n        });\n\n        this.buildEntries(newEntries);\n      });\n    })\n      .catch(() => {\n        // nothing\n      });\n  }\n\n  protected abstract dmFilters():Array<[string, FilterOperator, [string]]>;\n\n  private buildEntries(entries:TimeEntryResource[]) {\n    this.entries = entries;\n    let sumsByDateSpent:{[key:string]:number} = {};\n\n    entries.forEach((entry) => {\n      let date = entry.spentOn;\n\n      if (!sumsByDateSpent[date]) {\n        sumsByDateSpent[date] = 0;\n      }\n\n      sumsByDateSpent[date] = sumsByDateSpent[date] + this.timezone.toHours(entry.hours);\n    });\n\n    let sortedEntries = entries.sort((a, b) => {\n      return b.spentOn.localeCompare(a.spentOn);\n    });\n\n    this.rows = [];\n    let currentDate:string|null = null;\n    sortedEntries.forEach((entry) => {\n      if (entry.spentOn !== currentDate) {\n        currentDate = entry.spentOn;\n        this.rows.push({date: this.timezone.formattedDate(currentDate!), sum: this.formatNumber(sumsByDateSpent[currentDate!])});\n      }\n\n      this.rows.push({date: currentDate!, entry: entry});\n    });\n    //entries\n  }\n\n  protected formatNumber(value:number):string {\n    return this.i18n.toNumber(value, { precision: 2 });\n  }\n\n  public get noEntries() {\n    return !this.entries.length && this.entriesLoaded;\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    [editable]=\"isEditable\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<no-results *ngIf=\"noEntries\"\n            [title]=\"text.noResults\">\n</no-results>\n\n<ng-container *ngIf=\"!noEntries\">\n  <div class=\"total-hours\">\n    <p>Total: <span [textContent]=\"total\"></span></p>\n  </div>\n\n  <div class=\"generic-table--results-container\" *ngIf=\"anyEntries\">\n    <table class=\"generic-table time-entries\">\n      <colgroup>\n        <col highlight-col>\n        <col highlight-col>\n        <col highlight-col>\n        <col highlight-col>\n        <col>\n      </colgroup>\n      <thead class=\"-sticky\">\n        <tr>\n          <th>\n            <div class=\"generic-table--sort-header-outer\">\n              <div class=\"generic-table--sort-header\">\n                <span [textContent]=\"text.activity\"></span>\n              </div>\n            </div>\n          </th>\n          <th>\n            <div class=\"generic-table--sort-header-outer\">\n              <div class=\"generic-table--sort-header\">\n                <span [textContent]=\"text.workPackage\"></span>\n              </div>\n            </div>\n          </th>\n          <th>\n            <div class=\"generic-table--sort-header-outer\">\n              <div class=\"generic-table--sort-header\">\n                <span [textContent]=\"text.comment\"></span>\n              </div>\n            </div>\n          </th>\n          <th>\n            <div class=\"generic-table--sort-header-outer\">\n              <div class=\"generic-table--sort-header\">\n                <span [textContent]=\"text.hour\"></span>\n              </div>\n            </div>\n          </th>\n          <th><div class=\"generic-table--empty-header\"></div></th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr class=\"time-entry\" *ngFor=\"let item of rows\">\n          <td class=\"activity\"\n              *ngIf=\"item.entry\"\n              [textContent]=\"activityName(item.entry)\">\n          </td>\n          <td colspan=\"3\"\n              *ngIf=\"item.sum\">\n            <strong [textContent]=\"item.date\"></strong>\n          </td>\n          <td class=\"subject\"\n              *ngIf=\"item.entry && item.entry.workPackage\">\n              {{projectName(item.entry)}} - <a [href]=\"workPackagePath(item.entry)\" [textContent]=\"workPackageName(item.entry)\"></a>\n          </td>\n          <td class=\"subject\"\n              *ngIf=\"item.entry && !item.entry.workPackage\"\n              [textContent]=\"projectName(item.entry)\">\n          </td>\n          <td class=\"comments\"\n              *ngIf=\"item.entry\"\n              [textContent]=\"comment(item.entry)\">\n          </td>\n          <td class=\"hours\"\n              *ngIf=\"item.entry\"\n              [textContent]=\"hours(item.entry)\">\n          </td>\n          <td class=\"hours\"\n              *ngIf=\"item.sum\">\n            <em [textContent]=\"item.sum\"></em>\n          </td>\n          <td class=\"buttons\">\n            <a *ngIf=\"item.entry && item.entry.updateImmediately\"\n               (click)=\"editTimeEntry(item.entry)\"\n               [title]=\"text.edit\">\n              <op-icon icon-classes=\"icon-context icon-edit\"></op-icon>\n            </a>\n            <a *ngIf=\"item.entry && item.entry.delete\"\n               (click)=\"deleteIfConfirmed($event, item.entry)\"\n               [title]=\"text.delete\" >\n              <op-icon icon-classes=\"icon-context icon-delete\"></op-icon>\n            </a>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</ng-container>\n","import {Component, OnInit, Injector, ChangeDetectorRef} from \"@angular/core\";\nimport {FilterOperator} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {WidgetTimeEntriesListComponent} from \"core-app/modules/grids/widgets/time-entries/list/time-entries-list.component\";\nimport {TimeEntryDmService} from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {ConfirmDialogService} from \"core-components/modals/confirm-dialog/confirm-dialog.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\n\n@Component({\n  templateUrl: '../list/time-entries-list.component.html',\n})\nexport class WidgetTimeEntriesProjectComponent extends WidgetTimeEntriesListComponent implements OnInit {\n  constructor(readonly timeEntryDm:TimeEntryDmService,\n              readonly injector:Injector,\n              readonly timezone:TimezoneService,\n              readonly i18n:I18nService,\n              readonly pathHelper:PathHelperService,\n              readonly confirmDialog:ConfirmDialogService,\n              protected readonly cdr:ChangeDetectorRef,\n              protected readonly currentProject:CurrentProjectService) {\n    super(timeEntryDm, injector, timezone, i18n, pathHelper, confirmDialog, cdr);\n  }\n  protected dmFilters():Array<[string, FilterOperator, [string]]> {\n    return [['spentOn', '>t-', ['7']] as [string, FilterOperator, [string]],\n            ['project_id', '=', [this.currentProject.id]] as [string, FilterOperator, [string]]];\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    [editable]=\"isEditable\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<div class=\"grid--widget-content\">\n  <no-results *ngIf=\"noEntries\"\n              [title]=\"text.noResults\">\n  </no-results>\n  <span *ngFor=\"let project of projects; let last = last\">\n    <a [href]=\"projectPath(project)\"\n       [textContent]=\"projectName(project)\">\n    </a>\n    <span *ngIf=\"!last\">, </span>\n  </span>\n</div>\n","import {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {Component, OnInit, ChangeDetectorRef, Injector, ChangeDetectionStrategy} from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {DmListParameter} from \"core-app/modules/hal/dm-services/dm.service.interface\";\nimport {ProjectDmService} from \"core-app/modules/hal/dm-services/project-dm.service\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\n\n@Component({\n  templateUrl: './subprojects.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WidgetSubprojectsComponent extends AbstractWidgetComponent implements OnInit {\n  public text = {\n    noResults: this.i18n.t('js.grid.widgets.subprojects.no_results'),\n  };\n\n  public projects:ProjectResource[];\n\n  constructor(readonly halResource:HalResourceService,\n              readonly pathHelper:PathHelperService,\n              readonly i18n:I18nService,\n              protected readonly injector:Injector,\n              readonly timezone:TimezoneService,\n              readonly projectDm:ProjectDmService,\n              readonly currentProject:CurrentProjectService,\n              readonly cdr:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this\n      .projectDm\n      .list(this.projectDmParams)\n      .then((collection) => {\n        this.projects = collection.elements as ProjectResource[];\n\n        this.cdr.detectChanges();\n      });\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  public projectPath(project:ProjectResource) {\n    return this.pathHelper.projectPath(project.identifier);\n  }\n\n  public projectName(project:ProjectResource) {\n    return project.name;\n  }\n\n  public get noEntries() {\n    return this.projects && !this.projects.length;\n  }\n\n  private get projectDmParams():DmListParameter {\n    return { sortBy: [['name', 'asc']],\n             filters: [['parent_id', '=', [this.currentProject.id!]]] };\n  }\n}\n","<widget-header\n    [name]=\"widgetName\"\n    [editable]=\"isEditable\">\n\n  <widget-menu\n      [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<div class=\"grid--widget-content\">\n  <no-results *ngIf=\"noMembers\"\n              [title]=\"text.noResults\">\n  </no-results>\n  <div class=\"attributes-map -minimal-keys\">\n    <ng-container *ngFor=\"let usersByRole of usersByRole\">\n      <div class=\"attributes-map--key\">\n        {{usersByRole.role.name}}\n      </div>\n\n      <div class=\"attributes-map--value\">\n          <span *ngFor=\"let principal of usersByRole.users; let last = last\">\n\n            <ng-container *ngIf=\"isGroup(principal)\">\n              <span [textContent]=\"userName(principal)\"></span>\n            </ng-container>\n            <ng-container *ngIf=\"!isGroup(principal)\">\n              <user-avatar [user]=\"principal\"\n                           data-class-list=\"avatar avatar-mini -spaced\">\n              </user-avatar>\n              <a [href]=\"userPath(principal)\"\n                 [textContent]=\"userName(principal)\">\n              </a>\n            </ng-container>\n\n            <ng-container *ngIf=\"!last\">, </ng-container>\n          </span>\n      </div>\n    </ng-container>\n  </div>\n  <div *ngIf=\"moreMembers\"\n       class=\"members-widget--notification\">\n    {{moreMembersText}}\n  </div>\n</div>\n\n<div class=\"grid--widget-footer\">\n  <a *ngIf=\"membersAddable\"\n     [href]=\"projectMembershipsPath + '?show_add_members=true'\"\n     class=\"button -alt-highlight\">\n    <i class=\"button--icon icon-add\" aria-hidden=\"true\"></i>\n    <span class=\"button--text\"\n          [textContent]=\"text.add\">\n    </span>\n  </a>\n\n  <a *ngIf=\"!noMembers\"\n     [href]=\"projectMembershipsPath\"\n     class=\"button -highlight-inverted\">\n    <i class=\"button--icon icon-group\" aria-hidden=\"true\"></i>\n    <span class=\"button--text\"\n          [textContent]=\"text.viewAll\">\n    </span>\n  </a>\n</div>\n","import {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {Component, OnInit, ChangeDetectorRef, Injector, ChangeDetectionStrategy} from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {DmListParameter} from \"core-app/modules/hal/dm-services/dm.service.interface\";\nimport {MembershipResource} from \"core-app/modules/hal/resources/membership-resource\";\nimport {MembershipDmService} from \"core-app/modules/hal/dm-services/membership-dm.service\";\nimport {RoleResource} from \"core-app/modules/hal/resources/role-resource\";\n\nconst DISPLAYED_MEMBERS_LIMIT = 100;\n\n@Component({\n  templateUrl: './members.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styleUrls: ['./members.component.sass']\n})\nexport class WidgetMembersComponent extends AbstractWidgetComponent implements OnInit {\n  public text = {\n    add: this.i18n.t('js.grid.widgets.members.add'),\n    noResults: this.i18n.t('js.grid.widgets.members.no_results'),\n    viewAll: this.i18n.t('js.grid.widgets.members.view_all_members'),\n  };\n\n  public totalMembers:number;\n  public entriesByRoles:{[roleId:string]:{role:RoleResource, users:UserResource[]}} = {};\n  private entriesLoaded = false;\n  public membersAddable:boolean = false;\n\n  constructor(readonly pathHelper:PathHelperService,\n              readonly i18n:I18nService,\n              protected readonly injector:Injector,\n              readonly membershipDm:MembershipDmService,\n              readonly currentProject:CurrentProjectService,\n              readonly cdr:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.membershipDm\n      .list(this.listMembersParams)\n      .then(collection => {\n        this.partitionEntriesByRole(collection.elements);\n        this.sortUsersByName();\n        this.totalMembers = collection.total;\n\n        this.entriesLoaded = true;\n        this.cdr.detectChanges();\n      });\n\n    this.membershipDm\n      .listAvailableProjects(this.listAvailableProjectsParams)\n      .then(collection => {\n        this.membersAddable = collection.total > 0;\n      })\n      .catch(() => {\n        // nothing bad, the user is just not allowed to add members to the project\n\n      });\n  }\n\n  public get isEditable() {\n    return false;\n  }\n\n  public userPath(user:UserResource) {\n    return this.pathHelper.userPath(user.id!);\n  }\n\n  public userName(user:UserResource) {\n    return user.name;\n  }\n\n  public get noMembers() {\n    return this.entriesLoaded && !Object.keys(this.entriesByRoles).length;\n  }\n\n  public get moreMembers() {\n    return this.entriesLoaded && this.totalMembers > DISPLAYED_MEMBERS_LIMIT;\n  }\n\n  public get moreMembersText() {\n    return I18n.t(\n        'js.grid.widgets.members.too_many',\n        { count: DISPLAYED_MEMBERS_LIMIT, total: this.totalMembers }\n      );\n  }\n\n  public get projectMembershipsPath() {\n    return this.pathHelper.projectMembershipsPath(this.currentProject.identifier!);\n  }\n\n  public get usersByRole() {\n    return Object.values(this.entriesByRoles);\n  }\n\n  public isGroup(principal:UserResource) {\n    return this.pathHelper.api.v3.groups.id(principal.id!).toString() === principal.href;\n  }\n\n  private partitionEntriesByRole(memberships:MembershipResource[]) {\n    memberships.forEach(membership => {\n      membership.roles.forEach((role) => {\n        if (!this.entriesByRoles[role.id!]) {\n          this.entriesByRoles[role.id!] = { role: role, users: [] };\n        }\n\n        this.entriesByRoles[role.id!].users.push(membership.principal);\n      });\n    });\n  }\n\n  private sortUsersByName() {\n    Object.values(this.entriesByRoles).forEach(entry => {\n      entry.users.sort((a, b) => {\n        return this.userName(a).localeCompare(this.userName(b));\n      });\n    });\n  }\n\n  private get listMembersParams() {\n    let params:DmListParameter = { sortBy: [['created_on', 'desc']], pageSize: DISPLAYED_MEMBERS_LIMIT };\n\n    if (this.currentProject.id) {\n      params['filters'] = [['project_id', '=', [this.currentProject.id]]];\n    }\n\n    return params;\n  }\n\n  private get listAvailableProjectsParams() {\n    // It would make sense to set the pageSize but the backend for projects\n    // returns an upaginated list which does not support that.\n    let params:DmListParameter = {};\n\n    if (this.currentProject.id) {\n      params['filters'] = [['id', '=', [this.currentProject.id]]];\n    }\n\n    return params;\n  }\n}\n","<widget-header\n  [name]=\"widgetName\"\n  [editable]=\"isEditable\">\n\n  <widget-menu\n    [resource]=\"resource\">\n  </widget-menu>\n</widget-header>\n\n<div class=\"grid--widget-content -allow-inner-overflow\">\n  <edit-form *ngIf=\"(project$ | async) as project\" [resource]=\"project\">\n    <div class=\"project-status--container\">\n      <editable-attribute-field [resource]=\"project\"\n                                fieldName=\"status\"\n                                wrapperClasses=\"project-status--display-field\">\n      </editable-attribute-field>\n    </div>\n    <div class=\"project-status-explanation--container\">\n      <editable-attribute-field [resource]=\"project\"\n                                fieldName=\"statusExplanation\">\n      </editable-attribute-field>\n    </div>\n  </edit-form>\n</div>\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Injector,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {AbstractWidgetComponent} from \"app/modules/grids/widgets/abstract-widget.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ProjectDmService} from \"core-app/modules/hal/dm-services/project-dm.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {WorkPackageViewHighlightingService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-highlighting.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {ProjectCacheService} from \"core-components/projects/project-cache.service\";\nimport {Observable} from \"rxjs\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\n\n@Component({\n  templateUrl: './project-status.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    WorkPackageViewHighlightingService,\n    IsolatedQuerySpace,\n    HalResourceEditingService\n  ]\n})\nexport class WidgetProjectStatusComponent extends AbstractWidgetComponent implements OnInit {\n\n  @ViewChild('contentContainer', { static: true }) readonly contentContainer:ElementRef;\n\n  public currentStatusCode:string = 'not set';\n  public explanation:String = '';\n  public project$:Observable<ProjectResource>;\n\n  constructor(protected readonly i18n:I18nService,\n              protected readonly injector:Injector,\n              protected readonly projectDm:ProjectDmService,\n              protected readonly projectCache:ProjectCacheService,\n              protected readonly currentProject:CurrentProjectService,\n              protected readonly cdRef:ChangeDetectorRef) {\n    super(i18n, injector);\n  }\n\n  ngOnInit() {\n    this.project$ = this.projectCache.requireAndStream(this.currentProject.id!);\n    this.cdRef.detectChanges();\n  }\n\n  public get isEditable() {\n    return false;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector, NgModule} from '@angular/core';\nimport {DynamicModule} from 'ng-dynamic-component';\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {BrowserModule} from '@angular/platform-browser';\nimport {FormsModule} from '@angular/forms';\nimport {DragDropModule} from '@angular/cdk/drag-drop';\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\nimport {WidgetWpCalendarComponent} from \"core-app/modules/grids/widgets/wp-calendar/wp-calendar.component.ts\";\nimport {WidgetTimeEntriesCurrentUserComponent} from \"core-app/modules/grids/widgets/time-entries/current-user/time-entries-current-user.component\";\nimport {GridWidgetsService} from \"core-app/modules/grids/widgets/widgets.service\";\nimport {GridComponent} from \"core-app/modules/grids/grid/grid.component\";\nimport {AddGridWidgetModal} from \"core-app/modules/grids/widgets/add/add.modal\";\nimport {OpenprojectCalendarModule} from \"core-app/modules/calendar/openproject-calendar.module\";\nimport {WidgetDocumentsComponent} from \"core-app/modules/grids/widgets/documents/documents.component\";\nimport {WidgetNewsComponent} from \"core-app/modules/grids/widgets/news/news.component\";\nimport {WidgetWpTableComponent} from \"core-app/modules/grids/widgets/wp-table/wp-table.component\";\nimport {WidgetMenuComponent} from \"core-app/modules/grids/widgets/menu/widget-menu.component\";\nimport {WidgetWpTableMenuComponent} from \"core-app/modules/grids/widgets/wp-table/wp-table-menu.component\";\nimport {GridInitializationService} from \"core-app/modules/grids/grid/initialization.service\";\nimport {WidgetWpGraphComponent} from \"core-app/modules/grids/widgets/wp-graph/wp-graph.component\";\nimport {WidgetWpGraphMenuComponent} from \"core-app/modules/grids/widgets/wp-graph/wp-graph-menu.component\";\nimport {WidgetWpTableQuerySpaceComponent} from \"core-app/modules/grids/widgets/wp-table/wp-table-qs.component\";\nimport {OpenprojectWorkPackageGraphsModule} from \"core-app/modules/work-package-graphs/openproject-work-package-graphs.module\";\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WidgetProjectDescriptionComponent} from \"core-app/modules/grids/widgets/project-description/project-description.component\";\nimport {WidgetHeaderComponent} from \"core-app/modules/grids/widgets/header/header.component\";\nimport {WidgetWpOverviewComponent} from \"core-app/modules/grids/widgets/wp-overview/wp-overview.component\";\nimport {WidgetCustomTextComponent} from \"core-app/modules/grids/widgets/custom-text/custom-text.component\";\nimport {OpenprojectFieldsModule} from \"core-app/modules/fields/openproject-fields.module\";\nimport {WidgetProjectDetailsComponent} from \"core-app/modules/grids/widgets/project-details/project-details.component\";\nimport {WidgetTimeEntriesProjectComponent} from \"core-app/modules/grids/widgets/time-entries/project/time-entries-project.component\";\nimport {WidgetSubprojectsComponent} from \"core-app/modules/grids/widgets/subprojects/subprojects.component\";\nimport {OpenprojectAttachmentsModule} from \"core-app/modules/attachments/openproject-attachments.module\";\nimport {WidgetMembersComponent} from \"core-app/modules/grids/widgets/members/members.component\";\nimport {WidgetProjectStatusComponent} from \"core-app/modules/grids/widgets/project-status/project-status.component\";\nimport {OpenprojectTimeEntriesModule} from \"core-app/modules/time_entries/openproject-time-entries.module\";\nimport {WidgetTimeEntriesCurrentUserMenuComponent} from \"core-app/modules/grids/widgets/time-entries/current-user/time-entries-current-user-menu.component\";\nimport { TimeEntriesCurrentUserConfigurationModalComponent } from './widgets/time-entries/current-user/time-entries-current-user-configuration.modal';\n\n@NgModule({\n  imports: [\n    BrowserModule,\n    FormsModule,\n    DragDropModule,\n\n    OpenprojectCommonModule,\n    OpenprojectWorkPackagesModule,\n    OpenprojectWorkPackageGraphsModule,\n    OpenprojectCalendarModule,\n    OpenprojectTimeEntriesModule,\n\n    OpenprojectAttachmentsModule,\n\n    DynamicModule.withComponents([\n      WidgetCustomTextComponent,\n      WidgetDocumentsComponent,\n      WidgetMembersComponent,\n      WidgetNewsComponent,\n      WidgetWpTableQuerySpaceComponent,\n      WidgetWpGraphComponent,\n      WidgetWpCalendarComponent,\n      WidgetWpOverviewComponent,\n      WidgetProjectDescriptionComponent,\n      WidgetProjectDetailsComponent,\n      WidgetProjectStatusComponent,\n      WidgetSubprojectsComponent,\n      WidgetTimeEntriesCurrentUserComponent,\n      WidgetTimeEntriesProjectComponent]),\n\n    // Support for inline editig fields\n    OpenprojectFieldsModule,\n\n  ],\n  providers: [\n    GridWidgetsService,\n    GridInitializationService,\n  ],\n  declarations: [\n    GridComponent,\n\n    // Widgets\n    WidgetCustomTextComponent,\n    WidgetDocumentsComponent,\n    WidgetMembersComponent,\n    WidgetNewsComponent,\n    WidgetWpCalendarComponent,\n    WidgetWpOverviewComponent,\n    WidgetWpTableComponent,\n    WidgetWpTableQuerySpaceComponent,\n    WidgetWpGraphComponent,\n    WidgetProjectDescriptionComponent,\n    WidgetProjectDetailsComponent,\n    WidgetProjectStatusComponent,\n    WidgetSubprojectsComponent,\n    WidgetTimeEntriesCurrentUserComponent,\n    WidgetTimeEntriesProjectComponent,\n\n    // Widget menus\n    WidgetMenuComponent,\n    WidgetWpTableMenuComponent,\n    WidgetWpGraphMenuComponent,\n    WidgetTimeEntriesCurrentUserMenuComponent,\n    TimeEntriesCurrentUserConfigurationModalComponent,\n\n    AddGridWidgetModal,\n\n    WidgetHeaderComponent,\n  ],\n  exports: [\n    GridComponent\n  ]\n})\nexport class OpenprojectGridsModule {\n  constructor(injector:Injector) {\n    registerWidgets(injector);\n  }\n}\n\nexport function registerWidgets(injector:Injector) {\n  const hookService = injector.get(HookService);\n  const i18n = injector.get(I18nService);\n\n  hookService.register('gridWidgets', () => {\n\n    let defaultColumns = [\"id\", \"project\", \"type\", \"subject\"];\n\n    let assignedFilters = new ApiV3FilterBuilder();\n    assignedFilters.add('assignee', '=', [\"me\"]);\n    assignedFilters.add('status', 'o', []);\n\n    let assignedProps = {\n      \"columns[]\": defaultColumns,\n      \"filters\": assignedFilters.toJson()\n    };\n\n    let accountableFilters = new ApiV3FilterBuilder();\n    accountableFilters.add('responsible', '=', [\"me\"]);\n    accountableFilters.add('status', 'o', []);\n\n    let accountableProps = {\n      \"columns[]\": defaultColumns,\n      \"filters\": accountableFilters.toJson()\n    };\n\n    let createdFilters = new ApiV3FilterBuilder();\n    createdFilters.add('author', '=', [\"me\"]);\n    createdFilters.add('status', 'o', []);\n\n    let createdProps = {\n      \"columns[]\": defaultColumns,\n      \"filters\": createdFilters.toJson()\n    };\n\n    let watchedFilters = new ApiV3FilterBuilder();\n    watchedFilters.add('watcher', '=', [\"me\"]);\n    watchedFilters.add('status', 'o', []);\n\n    let watchedProps = {\n      \"columns[]\": defaultColumns,\n      \"filters\": watchedFilters.toJson()\n    };\n\n    return [\n      {\n        identifier: 'work_packages_assigned',\n        component: WidgetWpTableQuerySpaceComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_assigned.title`),\n        properties: {\n          queryProps: assignedProps,\n          name: i18n.t('js.grid.widgets.work_packages_assigned.title')\n        }\n      },\n      {\n        identifier: 'work_packages_accountable',\n        component: WidgetWpTableQuerySpaceComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_accountable.title`),\n        properties: {\n          queryProps: accountableProps,\n          name: i18n.t('js.grid.widgets.work_packages_accountable.title')\n        }\n      },\n      {\n        identifier: 'work_packages_created',\n        component: WidgetWpTableQuerySpaceComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_created.title`),\n        properties: {\n          queryProps: createdProps,\n          name: i18n.t('js.grid.widgets.work_packages_created.title')\n        }\n      },\n      {\n        identifier: 'work_packages_watched',\n        component: WidgetWpTableQuerySpaceComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_watched.title`),\n        properties: {\n          queryProps: watchedProps,\n          name: i18n.t('js.grid.widgets.work_packages_watched.title')\n        }\n      },\n      {\n        identifier: 'work_packages_table',\n        component: WidgetWpTableQuerySpaceComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_table.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.work_packages_table.title')\n        }\n      },\n      {\n        identifier: 'work_packages_graph',\n        component: WidgetWpGraphComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_graph.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.work_packages_graph.title')\n        }\n      },\n      {\n        identifier: 'work_packages_calendar',\n        component: WidgetWpCalendarComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_calendar.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.work_packages_calendar.title')\n        }\n      },\n      {\n        identifier: 'work_packages_overview',\n        component: WidgetWpOverviewComponent,\n        title: i18n.t(`js.grid.widgets.work_packages_overview.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.work_packages_overview.title')\n        }\n      },\n      {\n        identifier: 'time_entries_current_user',\n        component: WidgetTimeEntriesCurrentUserComponent,\n        title: i18n.t(`js.grid.widgets.time_entries_current_user.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.time_entries_current_user.title'),\n          days: [true, true, true, true, true, true, true]\n        }\n      },\n      {\n        identifier: 'time_entries_project',\n        component: WidgetTimeEntriesProjectComponent,\n        title: i18n.t(`js.grid.widgets.time_entries_list.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.time_entries_list.title'),\n        }\n      },\n      {\n        identifier: 'documents',\n        component: WidgetDocumentsComponent,\n        title: i18n.t(`js.grid.widgets.documents.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.documents.title')\n        }\n      },\n      {\n        identifier: 'members',\n        component: WidgetMembersComponent,\n        title: i18n.t(`js.grid.widgets.members.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.members.title')\n        }\n      },\n      {\n        identifier: 'news',\n        component: WidgetNewsComponent,\n        title: i18n.t(`js.grid.widgets.news.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.news.title')\n        }\n      },\n      {\n        identifier: 'project_description',\n        component: WidgetProjectDescriptionComponent,\n        title: i18n.t(`js.grid.widgets.project_description.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.project_description.title')\n        }\n      },\n      {\n        identifier: 'custom_text',\n        component: WidgetCustomTextComponent,\n        title: i18n.t(`js.grid.widgets.custom_text.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.custom_text.title'),\n          text: {\n            raw: ''\n          }\n        }\n      },\n      {\n        identifier: 'project_details',\n        component: WidgetProjectDetailsComponent,\n        title: i18n.t(`js.grid.widgets.project_details.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.project_details.title')\n        }\n      },\n      {\n        identifier: 'project_status',\n        component: WidgetProjectStatusComponent,\n        title: i18n.t(`js.grid.widgets.project_status.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.project_status.title')\n        }\n      },\n      {\n        identifier: 'subprojects',\n        component: WidgetSubprojectsComponent,\n        title: i18n.t(`js.grid.widgets.subprojects.title`),\n        properties: {\n          name: i18n.t('js.grid.widgets.subprojects.title')\n        }\n      }\n    ];\n  });\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from \"@angular/core\";\n\nexport const appBaseSelector = 'openproject-base';\n\n@Component({\n  selector: appBaseSelector,\n  template: `\n    <div class=\"openproject-base--ui-view\">\n      <ui-view></ui-view>\n    </div>\n  `\n})\nexport class ApplicationBaseComponent {\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {StateDeclaration, StateService, Transition, TransitionService, UIRouter} from '@uirouter/core';\nimport {INotification, NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {Injector} from \"@angular/core\";\nimport {FirstRouteService} from \"core-app/modules/router/first-route-service\";\nimport {Ng2StateDeclaration, StatesModule} from \"@uirouter/angular\";\nimport {appBaseSelector, ApplicationBaseComponent} from \"core-app/modules/router/base/application-base.component\";\nimport {BackRoutingService} from \"core-app/modules/common/back-routing/back-routing.service\";\n\nexport const OPENPROJECT_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'root',\n    url: '/{projects}/{projectPath}',\n    component: ApplicationBaseComponent,\n    abstract: true,\n    params: {\n      // value: null makes the parameter optional\n      // squash: true avoids duplicate slashes when the parameter is not provided\n      projectPath: { type: 'path', value: null, squash: true },\n      projects: { type: 'path', value: null, squash: true },\n\n      // Allow passing of flash messages after routes load\n      flash_message: { dynamic: true, value: null, inherit: false }\n    }\n  },\n  {\n    name: 'boards.**',\n    parent: 'root',\n    url: '/boards',\n    loadChildren: () => import('../boards/openproject-boards.module').then(m => m.OpenprojectBoardsModule)\n  },\n  {\n    name: 'bim.**',\n    parent: 'root',\n    url: '/bcf',\n    loadChildren: () => import('../bim/ifc_models/openproject-ifc-models.module').then(m => m.OpenprojectIFCModelsModule)\n  },\n];\n\n/**\n * Add or remove a body class. Helper for ui-router body classes functionality\n *\n * @param className\n * @param action\n */\nexport function bodyClass(className:string[]|string|null|undefined, action:'add'|'remove' = 'add') {\n  if (className) {\n    if (Array.isArray(className)) {\n      className.forEach((cssClass:string) => {\n        document.body.classList[action](cssClass);\n      });\n    } else {\n      document.body.classList[action](className);\n    }\n  }\n}\n\nexport function updateMenuItem(menuItemClass:string|undefined, action:'add'|'remove' = 'add') {\n  if (!menuItemClass) {\n    return;\n  }\n\n  let menuItem = jQuery('#main-menu .' + menuItemClass)[0];\n\n  if (!menuItem) {\n    return;\n  }\n\n  // Update Class\n  menuItem.classList[action]('selected');\n\n  // Update accessibility label\n  let menuItemTitle = (menuItem.getAttribute('title') || '').split(':').slice(-1)[0];\n  if (action === 'add') {\n    menuItemTitle = I18n.t('js.description_current_position') + menuItemTitle;\n  }\n\n  menuItem.setAttribute('title', menuItemTitle);\n}\n\nexport function uiRouterConfiguration(uiRouter:UIRouter, injector:Injector, module:StatesModule) {\n  // Allow optional trailing slashes\n  uiRouter.urlService.config.strictMode(false);\n\n  // Register custom URL params type\n  // to ensure query props are correctly set\n  uiRouter.urlService.config.type(\n    'opQueryString',\n    {\n      encode: encodeURIComponent,\n      decode: decodeURIComponent,\n      raw: true,\n      dynamic: true,\n      is: (val:unknown) => typeof (val) === 'string',\n      equals: (a:any, b:any) => _.isEqual(a, b),\n    }\n  );\n}\n\nexport function initializeUiRouterListeners(injector:Injector) {\n  const $transitions:TransitionService = injector.get(TransitionService);\n  const stateService = injector.get(StateService);\n  const notificationsService:NotificationsService = injector.get(NotificationsService);\n  const currentProject:CurrentProjectService = injector.get(CurrentProjectService);\n  const firstRoute:FirstRouteService = injector.get(FirstRouteService);\n  const backRoutingService:BackRoutingService = injector.get(BackRoutingService);\n\n  // Check whether we are running within our complete app, or only within some other bootstrapped\n  // component\n  let wpBase = document.querySelector(appBaseSelector);\n\n  // Uncomment to trace route changes\n  // const uiRouter = injector.get(UIRouter);\n  // uiRouter.trace.enable();\n\n  // Apply classes from bodyClasses in each state definition\n  // This was defined as onEnter, onExit functions in each state before\n  // but since AOT doesn't allow anonymous functions, we can't re-use them now.\n  // The transition will only return the target state on `transition.to()`,\n  // however the second parameter has the currently (e.g., parent) entering state chain.\n  $transitions.onEnter({}, function (transition:Transition, state:StateDeclaration) {\n    // Add body class when entering this state\n    bodyClass(_.get(state, 'data.bodyClasses'), 'add');\n    if (transition.from().data && _.get(state, 'data.menuItem') !== transition.from().data.menuItem) {\n      updateMenuItem(_.get(state, 'data.menuItem'), 'add');\n    }\n\n    // Reset scroll position, mostly relevant for mobile\n    window.scrollTo(0, 0);\n  });\n\n  $transitions.onExit({}, function (transition:Transition, state:StateDeclaration) {\n    // Remove body class when leaving this state\n    bodyClass(_.get(state, 'data.bodyClasses'), 'remove');\n    if (transition.to().data && _.get(state, 'data.menuItem') !== transition.to().data.menuItem) {\n      updateMenuItem(_.get(state, 'data.menuItem'), 'remove');\n    }\n  });\n\n  $transitions.onStart({}, function (transition:Transition) {\n    const $state = transition.router.stateService;\n    const toParams = transition.params('to');\n    const fromState = transition.from();\n    const toState = transition.to();\n\n    // Remove start_onboarding_tour param if set\n    if (toParams.start_onboarding_tour && toState.name !== 'work-packages.partitioned.list') {\n      const paramsCopy = Object.assign({}, transition.params());\n      paramsCopy.start_onboarding_tour = undefined;\n      return $state.target(transition.to(), paramsCopy);\n    }\n\n    // Set backRoute to know where we came from\n    backRoutingService.sync(transition);\n\n    // Reset profiler, if we're actually profiling\n    const profiler:any = (window as any).MiniProfiler;\n    profiler && profiler.pageTransition();\n\n    const projectIdentifier = toParams.projectPath || currentProject.identifier;\n    if (!toParams.projects && projectIdentifier) {\n      const newParams = _.clone(toParams);\n      _.assign(newParams, { projectPath: projectIdentifier, projects: 'projects' });\n      return $state.target(toState, newParams, { location: 'replace' });\n    }\n\n    // Abort the transition and move to the url instead\n    if (wpBase === null) {\n\n      // Only move to the URL if we're not coming from an initial URL load\n      // (cases like /work_packages/invalid/activity which render a 403 without frontend,\n      // but trigger the ui-router state)\n      const source = transition.options().source;\n\n      // Get the current path and compare\n      const path = window.location.pathname;\n      const target = stateService.href(toState, toParams);\n\n      if (target && path !== target) {\n        window.location.href = target;\n        return false;\n      }\n    }\n\n    // Remove and add any body class definitions for entering\n    // and exiting states.\n    bodyClass(_.get(toState, 'data.bodyClasses'), 'add');\n\n    // We need to distinguish between actions that should run on the initial page load\n    // (ie. openining a new tab in the details view should focus on the element in the table)\n    // so we need to know which route we visited initially\n    firstRoute.setIfFirst(toState.name, toParams);\n\n    // Clear all notifications when actually moving between states.\n    if (transition.to().name !== transition.from().name) {\n      notificationsService.clear();\n    }\n\n    // Add new notifications if passed to params\n    if (toParams.flash_message) {\n      notificationsService.add(toParams.flash_message as INotification);\n    }\n\n    return true;\n  });\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injector, NgModule} from '@angular/core';\nimport {FirstRouteService} from \"core-app/modules/router/first-route-service\";\nimport {UIRouterModule} from \"@uirouter/angular\";\nimport {ApplicationBaseComponent} from \"core-app/modules/router/base/application-base.component\";\nimport {\n  initializeUiRouterListeners,\n  OPENPROJECT_ROUTES,\n  uiRouterConfiguration\n} from \"core-app/modules/router/openproject.routes\";\n\n@NgModule({\n  imports: [\n    UIRouterModule.forRoot({\n      states: OPENPROJECT_ROUTES,\n      useHash: false,\n      config: uiRouterConfiguration,\n    } as any),\n  ],\n  providers: [\n    FirstRouteService\n  ],\n  declarations: [\n    ApplicationBaseComponent\n  ]\n})\nexport class OpenprojectRouterModule {\n  constructor(injector:Injector) {\n    initializeUiRouterListeners(injector);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {WorkPackageActivityTabComponent} from 'core-components/wp-single-view-tabs/activity-panel/activity-tab.component';\nimport {WorkPackageRelationsTabComponent} from 'core-components/wp-single-view-tabs/relations-tab/relations-tab.component';\nimport {WorkPackageWatchersTabComponent} from 'core-components/wp-single-view-tabs/watchers-tab/watchers-tab.component';\nimport {WorkPackageNewFullViewComponent} from 'core-components/wp-new/wp-new-full-view.component';\nimport {WorkPackageCopyFullViewComponent} from 'core-components/wp-copy/wp-copy-full-view.component';\nimport {WorkPackagesFullViewComponent} from \"core-app/modules/work_packages/routing/wp-full-view/wp-full-view.component\";\nimport {WorkPackageSplitViewComponent} from \"core-app/modules/work_packages/routing/wp-split-view/wp-split-view.component\";\nimport {Ng2StateDeclaration} from \"@uirouter/angular\";\nimport {WorkPackagesBaseComponent} from \"core-app/modules/work_packages/routing/wp-base/wp--base.component\";\nimport {WorkPackageListViewComponent} from \"core-app/modules/work_packages/routing/wp-list-view/wp-list-view.component\";\nimport {WorkPackageViewPageComponent} from \"core-app/modules/work_packages/routing/wp-view-page/wp-view-page.component\";\nimport {makeSplitViewRoutes} from \"core-app/modules/work_packages/routing/split-view-routes.template\";\n\nexport const menuItemClass = 'work-packages-menu-item';\n\nexport const WORK_PACKAGES_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'work-packages',\n    parent: 'root',\n    component: WorkPackagesBaseComponent,\n    url: '/work_packages?query_id&query_props&start_onboarding_tour',\n    redirectTo: 'work-packages.partitioned.list',\n    data: {\n      bodyClasses: 'router--work-packages-base',\n      menuItem: menuItemClass\n    },\n    params: {\n      query_id: { type: 'query', dynamic: true },\n      // Use custom encoder/decoder that ensures validity of URL string\n      query_props: { type: 'opQueryString' },\n      // Optional initial tour param\n      start_onboarding_tour: { type: 'query', squash: true, value: undefined },\n    }\n  },\n  {\n    name: 'work-packages.new',\n    url: '/new?type&parent_id',\n    component: WorkPackageNewFullViewComponent,\n    reloadOnSearch: false,\n    data: {\n      baseRoute: 'work-packages',\n      allowMovingInEditMode: true,\n      bodyClasses: 'router--work-packages-full-create',\n      menuItem: menuItemClass\n    },\n  },\n  {\n    name: 'work-packages.copy',\n    url: '/{copiedFromWorkPackageId:[0-9]+}/copy',\n    component: WorkPackageCopyFullViewComponent,\n    reloadOnSearch: false,\n    data: {\n      baseRoute: 'work-packages',\n      allowMovingInEditMode: true,\n      bodyClasses: 'router--work-packages-full-create',\n      menuItem: menuItemClass\n    },\n  },\n  {\n    name: 'work-packages.show',\n    url: '/{workPackageId:[0-9]+}',\n    // Redirect to 'activity' by default.\n    redirectTo: 'work-packages.show.activity',\n    component: WorkPackagesFullViewComponent,\n    data: {\n      baseRoute: 'work-packages',\n      bodyClasses: 'router--work-packages-full-view',\n      newRoute: 'work-packages.new',\n      menuItem: menuItemClass\n    }\n  },\n  {\n    name: 'work-packages.show.activity',\n    url: '/activity',\n    component: WorkPackageActivityTabComponent,\n    data: {\n      parent: 'work-packages.show',\n      menuItem: menuItemClass\n    }\n  },\n  {\n    name: 'work-packages.show.activity.details',\n    url: '/activity/details/#{activity_no:\\d+}',\n    component: WorkPackageActivityTabComponent,\n    data: {\n      parent: 'work-packages.show',\n      menuItem: menuItemClass\n    }\n  },\n  {\n    name: 'work-packages.show.relations',\n    url: '/relations',\n    component: WorkPackageRelationsTabComponent,\n    data: {\n      parent: 'work-packages.show',\n      menuItem: menuItemClass\n    }\n  },\n  {\n    name: 'work-packages.show.watchers',\n    url: '/watchers',\n    component: WorkPackageWatchersTabComponent,\n    data: {\n      parent: 'work-packages.show',\n      menuItem: menuItemClass\n    }\n  },\n  {\n    name: 'work-packages.partitioned',\n    component: WorkPackageViewPageComponent,\n    url: '',\n    data: {\n      // This has to be empty to avoid inheriting the parent bodyClasses\n      bodyClasses: ''\n    }\n  },\n  {\n    name: 'work-packages.partitioned.list',\n    url: '',\n    reloadOnSearch: false,\n    views: {\n      'content-left': { component: WorkPackageListViewComponent }\n    },\n    data: {\n      bodyClasses: 'router--work-packages-partitioned-split-view',\n      menuItem: menuItemClass,\n      partition: '-left-only'\n    }\n  },\n  ...makeSplitViewRoutes(\n    'work-packages.partitioned.list',\n    menuItemClass,\n    WorkPackageSplitViewComponent\n  )\n  // Avoid lazy-loading the routes for now\n  // {\n  //   name: 'work-packages.calendar.**',\n  //   url: '/calendar',\n  //   loadChildren: '../calendar/openproject-calendar.module#OpenprojectCalendarModule'\n  // },\n];\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {UIRouterModule} from \"@uirouter/angular\";\nimport {WORK_PACKAGES_ROUTES} from \"core-app/modules/work_packages/routing/work-packages-routes\";\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\n\n/**\n * Separate module for work package routes because WP modules\n * are required by other lazy-loaded modules such as calendar.\n *\n * And we must not re-import a module with route definitions.\n */\n\n@NgModule({\n  imports: [\n    // Import the actual WP modules\n    OpenprojectWorkPackagesModule,\n\n    // Routes for /work_packages\n    UIRouterModule.forChild({ states: WORK_PACKAGES_ROUTES }),\n  ]\n})\nexport class OpenprojectWorkPackageRoutesModule {\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable} from '@angular/core';\nimport {BehaviorSubject} from 'rxjs';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {Injector} from \"@angular/core\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\n\n@Injectable()\nexport class GlobalSearchService {\n  private _searchTerm = new BehaviorSubject<string>('');\n  public searchTerm$ = this._searchTerm.asObservable();\n\n  // Default selected tab is Work Packages\n  private _currentTab = new BehaviorSubject<any>('work_packages');\n  public currentTab$ = this._currentTab.asObservable();\n\n  // Default project scope is \"this project and all subprojets\"\n  private _projectScope = new BehaviorSubject<any>('');\n  public projectScope$ = this._projectScope.asObservable();\n\n  private _tabs = new BehaviorSubject<any>([]);\n  public tabs$ = this._tabs.asObservable();\n\n  // Sometimes we need to be able to hide the search results altogether, i.e. while expecting a full page reload.\n  private _resultsHidden = new BehaviorSubject<any>(false);\n  public resultsHidden$ = this._resultsHidden.asObservable();\n\n  constructor(protected I18n:I18nService,\n              protected injector:Injector,\n              protected PathHelper:PathHelperService,\n              protected currentProjectService:CurrentProjectService) {\n    this.initialize();\n  }\n\n  private initialize():void {\n    let initialData = this.loadGonData();\n    if (initialData) {\n      if (initialData.available_search_types) {\n        this._tabs.next(initialData.available_search_types);\n      }\n      if (initialData.search_term) {\n        this._searchTerm.next(initialData.search_term);\n      }\n      if (initialData.current_tab) {\n        this._currentTab.next(initialData.current_tab);\n      }\n\n      if (initialData.project_scope) {\n        this._projectScope.next(initialData.project_scope);\n      } else if (!this.currentProjectService.path) {\n        this._projectScope.next('all');\n      }\n    }\n  }\n\n  private loadGonData():{available_search_types:string[],\n                         search_term:string,\n                         project_scope:string,\n                         current_tab:string}|null {\n    try {\n      return (window as any).gon.global_search;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  public submitSearch():void {\n    window.location.href = this.searchPath();\n  }\n\n  public searchPath() {\n    let searchPath:string = this.PathHelper.staticBase;\n    if (this.currentProjectService.path && this.projectScope !== 'all') {\n      searchPath = this.currentProjectService.path;\n    }\n    searchPath = searchPath + `/search?${this.searchQueryParams()}`;\n    return searchPath;\n  }\n\n  public set searchTerm(searchTerm:string) {\n    this._searchTerm.next(searchTerm);\n  }\n\n  public get searchTerm():string {\n    return this._searchTerm.value;\n  }\n\n  public get tabs():string {\n    return this._tabs.value;\n  }\n\n  public get currentTab():string {\n    return this._currentTab.value;\n  }\n\n  public set currentTab(tab:string) {\n    this._currentTab.next(tab);\n  }\n\n  public get projectScope():string {\n    return this._projectScope.value;\n  }\n\n  public set projectScope(value:string) {\n    this._projectScope.next(value);\n  }\n\n  public get resultsHidden():boolean {\n    return this._resultsHidden.value;\n  }\n\n  public set resultsHidden(value:boolean) {\n    this._resultsHidden.next(value);\n  }\n\n  private searchQueryParams():string {\n    let params:string;\n\n    params = `q=${encodeURIComponent(this.searchTerm)}`;\n\n    if (this.currentTab.length > 0 && this.currentTab !== 'all') {\n      params = `${params}&${this.currentTab}=1`;\n    }\n    if (this.projectScope.length > 0) {\n      params = `${params}&scope=${this.projectScope}`;\n    }\n\n    return params;\n  }\n\n  public isAfterSearch():boolean {\n    return (jQuery('body.controller-search').length > 0);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\nimport {GlobalSearchInputComponent} from \"core-app/modules/global_search/input/global-search-input.component\";\nimport {GlobalSearchWorkPackagesComponent} from \"core-app/modules/global_search/global-search-work-packages.component\";\nimport {GlobalSearchTabsComponent} from \"core-app/modules/global_search/tabs/global-search-tabs.component\";\nimport {GlobalSearchTitleComponent} from \"core-app/modules/global_search/title/global-search-title.component\";\nimport {GlobalSearchService} from \"core-app/modules/global_search/services/global-search.service\";\nimport {GlobalSearchWorkPackagesEntryComponent} from \"core-app/modules/global_search/global-search-work-packages-entry.component\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    OpenprojectWorkPackagesModule\n  ],\n  providers: [\n    GlobalSearchService,\n  ],\n  declarations: [\n    GlobalSearchInputComponent,\n    GlobalSearchWorkPackagesEntryComponent,\n    GlobalSearchWorkPackagesComponent,\n    GlobalSearchTabsComponent,\n    GlobalSearchTitleComponent,\n  ]\n})\nexport class OpenprojectGlobalSearchModule { }\n\n","import {ConfirmDialogService} from 'core-components/modals/confirm-dialog/confirm-dialog.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {BannersService} from 'core-app/modules/common/enterprise/banners.service';\nimport { Inject, Injectable } from '@angular/core';\nimport {DOCUMENT} from '@angular/common';\n\n@Injectable()\nexport class TypeBannerService extends BannersService {\n\n  constructor(@Inject(DOCUMENT) protected documentElement:Document,\n              private confirmDialog:ConfirmDialogService,\n              private I18n:I18nService) {\n    super(documentElement);\n  }\n\n  showEEOnlyHint():void {\n    this.confirmDialog.confirm({\n      text: {\n        title: this.I18n.t('js.types.attribute_groups.upgrade_to_ee'),\n        text: this.I18n.t('js.types.attribute_groups.upgrade_to_ee_text'),\n        button_continue: this.I18n.t('js.types.attribute_groups.more_information'),\n        button_cancel: this.I18n.t('js.types.attribute_groups.nevermind')\n      }\n    }).then(() => {\n      window.location.href = 'https://www.openproject.org/enterprise-edition/?utm_source=unknown&utm_medium=community-edition&utm_campaign=form-configuration';\n    });\n  }\n}\n\n","<div class=\"toolbar-container -with-dropdown\">\n  <div class=\"toolbar\">\n    <ul class=\"toolbar-items\">\n      <li class=\"toolbar-item\">\n        <button type=\"button -alt-highlight\"\n                class=\"form-configuration--reset button\"\n                (click)=\"resetToDefault($event)\">\n          <op-icon icon-classes=\"button--icon icon-undo\"></op-icon>\n          <span class=\"button--text\" [textContent]=\"text.reset\"></span>\n        </button>\n      </li>\n      <li class=\"toolbar-item drop-down\">\n        <a ng-click=\"showGroupsContextMenu($event)\"\n           class=\"form-configuration--add-group button -alt-highlight\" aria-haspopup=\"true\">\n          <op-icon icon-classes=\"button--icon icon-add\"></op-icon>\n          <span class=\"button--text\" [textContent]=\"text.label_group\"></span>\n          <op-icon icon-classes=\"button--dropdown-indicator\"></op-icon>\n        </a>\n        <ul class=\"menu-drop-down-container\">\n          <li>\n            <a class=\"form-configuration--add-group\"\n               [textContent]=\"text.add_group\"\n               (accessibleClick)=\"createGroup('attribute', '')\">\n            </a>\n          </li>\n          <li>\n            <a class=\"form-configuration--add-group\"\n               [textContent]=\"text.add_table\"\n               (accessibleClick)=\"addGroupAndOpenQuery()\">\n            </a>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n</div>\n\n<div class=\"grid-block wrap\">\n  <div class=\"grid-content small-12 medium-6\">\n    <div id=\"draggable-groups\" dragula=\"groups\" [(dragulaModel)]=\"groups\">\n      <ng-container *ngFor=\"let group of groups\">\n        <type-form-attribute-group *ngIf=\"group.type === 'attribute'\"\n                                   (removeAttribute)=\"deactivateAttribute($event)\"\n                                   (deleteGroup)=\"deleteGroup(group)\"\n                                   [group]=\"group\">\n        </type-form-attribute-group>\n        <type-form-query-group *ngIf=\"group.type === 'query'\"\n                               (editQuery)=\"editQuery(group)\"\n                               (deleteGroup)=\"deleteGroup(group)\"\n                               [group]=\"group\">\n        </type-form-query-group>\n      </ng-container>\n    </div>\n  </div>\n  <div class=\"grid-content small-12 medium-6\">\n    <div id=\"type-form-conf-inactive-group\">\n      <div class=\"group-head\">\n        <span class=\"group-name\" [textContent]=\"text.label_inactive\"></span>\n        &ngsp;\n        <span class=\"advice\" [textContent]=\"text.drag_to_activate\"></span>\n      </div>\n      <div class=\"attributes\" dragula=\"attributes\" [(dragulaModel)]=\"inactives\">\n        <div *ngFor=\"let inactive_attribute of inactives\"\n             class=\"type-form-conf-attribute\"\n             [attr.data-key]=\"inactive_attribute.key\">\n          <span class=\"attribute-handle icon-drag-handle\"></span>\n          <span class=\"attribute-name\">\n              {{ inactive_attribute.translation }}\n            <span *ngIf=\"inactive_attribute.is_cf\"\n                  class=\"attribute-cf-label\"\n                  [textContent]=\"text.custom_field\">\n              </span>\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div><!-- END type form configurator -->\n","import {Component, ElementRef, OnInit} from '@angular/core';\nimport {TypeBannerService} from 'core-app/modules/admin/types/type-banner.service';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {NotificationsService} from 'core-app/modules/common/notifications/notifications.service';\nimport {ExternalRelationQueryConfigurationService} from 'core-components/wp-table/external-configuration/external-relation-query-configuration.service';\nimport {DomAutoscrollService} from 'core-app/modules/common/drag-and-drop/dom-autoscroll.service';\nimport {DragulaService} from 'ng2-dragula';\nimport {ConfirmDialogService} from 'core-components/modals/confirm-dialog/confirm-dialog.service';\nimport {Drake} from 'dragula';\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport type TypeGroupType = 'attribute'|'query';\n\nexport interface TypeFormAttribute {\n  key:string;\n  translation:string;\n  is_cf:boolean;\n}\n\nexport interface TypeGroup {\n  /** original internal key, if any */\n  key:string|null|undefined;\n  /** Localized / given name */\n  name:string;\n  attributes:TypeFormAttribute[];\n  query?:any;\n  type:TypeGroupType;\n}\n\nexport const adminTypeFormConfigurationSelector = 'admin-type-form-configuration';\n\n@Component({\n  selector: adminTypeFormConfigurationSelector,\n  templateUrl: './type-form-configuration.html',\n  providers: [\n    TypeBannerService,\n  ]\n})\nexport class TypeFormConfigurationComponent extends UntilDestroyedMixin implements OnInit {\n\n  public text = {\n    drag_to_activate: this.I18n.t('js.admin.type_form.drag_to_activate'),\n    reset: this.I18n.t('js.admin.type_form.reset_to_defaults'),\n    label_group: this.I18n.t('js.label_group'),\n    new_group: this.I18n.t('js.admin.type_form.new_group'),\n    label_inactive: this.I18n.t('js.admin.type_form.inactive'),\n    custom_field: this.I18n.t('js.admin.type_form.custom_field'),\n    add_group: this.I18n.t('js.admin.type_form.add_group'),\n    add_table: this.I18n.t('js.admin.type_form.add_table'),\n  };\n\n  private autoscroll:any;\n  private element:HTMLElement;\n  private form:JQuery;\n  private submit:JQuery;\n\n  public groups:TypeGroup[] = [];\n  public inactives:TypeFormAttribute[] = [];\n\n  private attributeDrake:Drake;\n  private groupsDrake:Drake;\n\n  private no_filter_query:string;\n\n  constructor(private elementRef:ElementRef,\n              private I18n:I18nService,\n              private Gon:GonService,\n              private dragula:DragulaService,\n              private confirmDialog:ConfirmDialogService,\n              private notificationsService:NotificationsService,\n              private externalRelationQuery:ExternalRelationQueryConfigurationService) {\n    super();\n  }\n\n  ngOnInit():void {\n    // Hook on form submit\n    this.element = this.elementRef.nativeElement;\n    this.no_filter_query = this.element.dataset.noFilterQuery!;\n    this.form = jQuery(this.element).closest('form');\n    this.submit = this.form.find('.form-configuration--save');\n\n    // In the following we are triggering the form submit ourselves to work around\n    // a firefox shortcoming. But to avoid double submits which are sometimes not canceled fast\n    // enough, we need to memoize whether we have already submitted.\n    let submitted = false;\n\n    this.form.on('submit', (event) => {\n      submitted = true;\n    });\n\n    // Capture mousedown on button because firefox breaks blur on click\n    this.submit.on('mousedown', (event) => {\n      setTimeout(() => {\n        if (!submitted) {\n          this.form.trigger('submit');\n        }\n      }, 50);\n      return true;\n    });\n\n    // Capture regular form submit\n    this.form.on('submit.typeformupdater', () => {\n      this.updateHiddenFields();\n      return true;\n    });\n\n    // Setup groups\n    this.dragula.createGroup('groups', {\n      moves: (el, source, handle:HTMLElement) => handle.classList.contains('group-handle')\n    });\n\n    // Setup attributes\n    this.dragula.createGroup('attributes', {\n      moves: (el, source, handle:HTMLElement) => handle.classList.contains('attribute-handle')\n    });\n\n    this.dragula.dropModel(\"attributes\")\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((event) => {\n        console.log(event);\n      });\n\n    // Get attribute id\n    this.groups = JSON.parse(this.element.dataset.activeGroups!);\n    this.inactives = JSON.parse(this.element.dataset.inactiveAttributes!);\n\n    // Setup autoscroll\n    const that = this;\n    this.autoscroll = new DomAutoscrollService(\n      [\n        document.getElementById('content-wrapper')!\n      ],\n      {\n        margin: 25,\n        maxSpeed: 10,\n        scrollWhenOutside: true,\n        autoScroll: function (this:any) {\n          const groups = that.groupsDrake && that.groupsDrake.dragging;\n          const attributes = that.attributeDrake && that.attributeDrake.dragging;\n          return this.down && (groups || attributes);\n        }\n      });\n  }\n\n  public deactivateAttribute(attribute:TypeFormAttribute) {\n    this.updateInactives(this.inactives.concat(attribute));\n  }\n\n  public addGroupAndOpenQuery():void {\n    let newGroup = this.createGroup('query');\n    this.editQuery(newGroup);\n  }\n\n  public editQuery(group:TypeGroup) {\n    // Disable display mode and timeline for now since we don't want users to enable it\n    const disabledTabs = {\n      'display-settings': I18n.t('js.work_packages.table_configuration.embedded_tab_disabled'),\n      'timelines': I18n.t('js.work_packages.table_configuration.embedded_tab_disabled')\n    };\n\n    this.externalRelationQuery.show(\n      JSON.parse(group.query),\n      (queryProps:any) => group.query = JSON.stringify(queryProps),\n      disabledTabs\n    );\n  }\n\n  public deleteGroup(group:TypeGroup) {\n    if (group.type === 'attribute') {\n      this.updateInactives(this.inactives.concat(group.attributes));\n    }\n\n    this.groups = this.groups.filter(el => el !== group);\n\n    return group;\n  }\n\n  public createGroup(type:TypeGroupType, groupName:string = '') {\n    let group:TypeGroup = {\n      type: type,\n      name: '',\n      key: null,\n      query: this.no_filter_query,\n      attributes: [],\n    };\n\n    this.groups.unshift(group);\n    return group;\n  }\n\n  public resetToDefault($event:Event):boolean {\n    this.confirmDialog\n      .confirm({\n        text: {\n          title: this.I18n.t('js.types.attribute_groups.reset_title'),\n          text: this.I18n.t('js.types.attribute_groups.confirm_reset'),\n          button_continue: this.I18n.t('js.label_reset')\n        }\n      })\n      .then(() => {\n        this.form.find('input#type_attribute_groups').val(JSON.stringify([]));\n\n        // Disable our form handler that updates the attribute groups\n        this.form.off('submit.typeformupdater');\n        this.form.trigger('submit');\n      });\n\n    $event.preventDefault();\n    return false;\n  }\n\n  private updateInactives(newValue:TypeFormAttribute[]) {\n    this.inactives = [...newValue].sort((a, b) => a.translation.localeCompare(b.translation));\n  }\n\n  private updateHiddenFields() {\n    const hiddenField = this.form.find('.admin-type-form--hidden-field');\n    hiddenField.val(JSON.stringify(this.groups));\n  }\n}\n\n","<div *ngIf=\"!editing\"\n      (click)=\"startEditing()\"\n      [textContent]=\"name\"\n      class=\"group-edit-handler\">\n</div>\n<input\n    #nameInput\n    *ngIf=\"editing\"\n    class=\"group-edit-in-place--input\"\n    type=\"text\"\n    autoFocus\n    [(ngModel)]=\"editedName\"\n    [attr.placeholder]=\"placeholder\"\n    (blur)=\"saveEdition($event)\"\n    (keydown.escape)=\"reset()\"\n    (keydown.enter)=\"saveEdition($event)\">\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnInit,\n  Output\n} from '@angular/core';\nimport {TypeBannerService} from 'core-app/modules/admin/types/type-banner.service';\n\n@Component({\n  selector: 'group-edit-in-place',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './group-edit-in-place.html'\n})\nexport class GroupEditInPlaceComponent implements OnInit {\n  @Input() public placeholder:string = '';\n  @Input() public name:string;\n\n  @Output() public onValueChange = new EventEmitter<string>();\n\n  public editing = false;\n\n  public editedName:string;\n\n  constructor(private bannerService:TypeBannerService,\n              protected readonly cdRef:ChangeDetectorRef) {\n  }\n\n  ngOnInit():void {\n    this.editedName = this.name;\n\n    if (!this.name || this.name.length === 0) {\n      // Group name is empty so open in editing mode straight away.\n      this.startEditing();\n    }\n  }\n\n  startEditing() {\n    this.bannerService.conditional(\n      () => this.bannerService.showEEOnlyHint(),\n      () => {\n        this.editing = true;\n      }\n    );\n  }\n\n  saveEdition(event:FocusEvent) {\n    this.leaveEditingMode();\n    this.name = this.editedName.trim();\n\n    this.cdRef.detectChanges();\n\n    if (this.name !== '') {\n      this.onValueChange.emit(this.name);\n    }\n\n    // Ensure form is not submitted.\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n  }\n\n  reset() {\n    this.editing = false;\n    this.editedName = this.name;\n  }\n\n  leaveEditingMode() {\n    // Only leave Editing mode if name not empty.\n    if (this.editedName != null && this.editedName.trim().length > 0) {\n      this.editing = false;\n    }\n  }\n}\n","<div class=\"type-form-conf-group\">\n  <div class=\"group-head\">\n    <span class=\"group-handle icon-drag-handle\"></span>\n    <group-edit-in-place\n        [name]=\"group.name\"\n        (onValueChange)=\"rename($event)\"\n        class=\"group-name\">\n    </group-edit-in-place>\n    <span class=\"delete-group icon-small icon-close\" (click)=\"deleteGroup.emit()\"></span>\n  </div>\n  <div class=\"attributes\" dragula=\"attributes\" [(dragulaModel)]=\"group.attributes\">\n    <div *ngFor=\"let attribute of group.attributes\"\n         class=\"type-form-conf-attribute\"\n         [attr.data-key]=\"attribute.key\">\n      <span class=\"attribute-handle icon-drag-handle\"></span>\n      <span class=\"attribute-name\">\n        {{ attribute.translation }}\n        <span class=\"attribute-cf-label\"\n              *ngIf=\"attribute.is_cf\"\n              [textContent]=\"text.custom_field\">\n          </span>\n      </span>\n      <span class=\"delete-attribute icon-small icon-close\" (click)=\"removeFromGroup(attribute)\"></span>\n    </div>\n  </div>\n</div> <!-- END attribute group -->\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output} from '@angular/core';\nimport {TypeFormAttribute, TypeGroup} from \"core-app/modules/admin/types/type-form-configuration.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  selector: 'type-form-attribute-group',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './attribute-group.component.html'\n})\nexport class TypeFormAttributeGroupComponent {\n  @Input() public group:TypeGroup;\n\n  @Output() public deleteGroup = new EventEmitter<void>();\n  @Output() public removeAttribute = new EventEmitter<TypeFormAttribute>();\n\n  text = {\n    custom_field: this.I18n.t('js.admin.type_form.custom_field')\n  };\n\n  constructor(private I18n:I18nService,\n              private cdRef:ChangeDetectorRef) {\n  }\n\n  rename(newValue:string) {\n    this.group.name = newValue;\n    delete this.group.key;\n    this.cdRef.detectChanges();\n  }\n\n  removeFromGroup(attribute:TypeFormAttribute) {\n    this.group.attributes = this.group.attributes.filter(a => a !== attribute);\n    this.removeAttribute.emit(attribute);\n  }\n}\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output} from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Component({\n  selector: 'type-form-query-group',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './query-group.component.html'\n})\nexport class TypeFormQueryGroupComponent {\n\n  text = {\n    edit_query: this.I18n.t('js.admin.type_form.edit_query')\n  };\n\n  @Input() public group:any;\n  @Output() public editQuery = new EventEmitter<void>();\n  @Output() public deleteGroup = new EventEmitter<void>();\n\n  constructor(private I18n:I18nService,\n              private cdRef:ChangeDetectorRef) {\n  }\n\n  rename(newValue:string) {\n    this.group.name = newValue;\n    this.cdRef.detectChanges();\n  }\n}\n","<div class=\"type-form-conf-group type-form-query-group\">\n    <div class=\"group-head\">\n        <span class=\"group-handle icon-drag-handle\"></span>\n        <group-edit-in-place\n                [name]=\"group.name\"\n                (onValueChange)=\"rename($event)\"\n                class=\"group-name\">\n        </group-edit-in-place>\n        <span class=\"delete-group icon-small icon-close\" (click)=\"deleteGroup.emit()\"></span>\n    </div>\n    <div class=\"type-form-query\">\n        <span class=\"type-form-query-group--edit-button\" (click)=\"editQuery.emit()\">\n          <op-icon icon-classes=\"button--icon icon-edit\"></op-icon>\n            {{ text.edit_query }}\n        </span>\n    </div>\n</div> <!-- END query group -->\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {TypeFormConfigurationComponent} from 'core-app/modules/admin/types/type-form-configuration.component';\nimport {GroupEditInPlaceComponent} from 'core-app/modules/admin/types/group-edit-in-place.component';\nimport {TypeFormAttributeGroupComponent} from 'core-app/modules/admin/types/attribute-group.component';\nimport {DragulaModule} from 'ng2-dragula';\nimport {TypeFormQueryGroupComponent} from \"core-app/modules/admin/types/query-group.component\";\n\n@NgModule({\n  imports: [\n    DragulaModule.forRoot(),\n    OpenprojectCommonModule\n  ],\n  providers: [\n  ],\n  declarations: [\n    TypeFormAttributeGroupComponent,\n    TypeFormQueryGroupComponent,\n    TypeFormConfigurationComponent,\n    GroupEditInPlaceComponent\n  ]\n})\nexport class OpenprojectAdminModule { }\n","<div class=\"op-modal--portal ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container confirm-dialog--modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-attention\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <div *ngFor=\"let widget of selectable;trackBy: trackWidgetBy\"\n           (click)=\"select($event, widget)\"\n           [id]=\"widget.identifier\"\n           [textContent]=\"widget.title\"\n           class=\"grid--addable-widget\" >\n      </div>\n\n      <enterprise-banner *ngIf=\"eeShowBanners\"\n                         [linkMessage]=\"text.upsale_link\"\n                         [textMessage]=\"text.upsale_text\"\n                         class=\"grid--add-widget-ee\"\n                         opReferrer=\"grids#add-widget\">\n      </enterprise-banner>\n    </div>\n  </div>\n</div>\n","import {Component, ElementRef, Inject, ChangeDetectorRef} from \"@angular/core\";\nimport {OpModalComponent} from \"app/components/op-modals/op-modal.component\";\nimport {WidgetRegistration} from \"app/modules/grids/grid/grid.component\";\nimport {OpModalLocalsToken} from \"app/components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"app/components/op-modals/op-modal.types\";\nimport {GridWidgetsService} from \"app/modules/grids/widgets/widgets.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\n\n@Component({\n  templateUrl: './add.modal.html'\n})\nexport class AddGridWidgetModal extends OpModalComponent {\n\n  text = {\n    title: this.i18n.t('js.grid.add_widget'),\n    close_popup: this.i18n.t('js.button_close'),\n    upsale_link: this.i18n.t('js.grid.upsale.link'),\n    upsale_text: this.i18n.t('js.grid.upsale.text')\n  };\n\n  public chosenWidget:WidgetRegistration;\n  public eeShowBanners = false;\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) readonly locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly widgetsService:GridWidgetsService,\n              readonly i18n:I18nService,\n              readonly bannerService:BannersService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n    this.eeShowBanners = this.bannerService.eeShowBanners;\n  }\n\n  public get selectable() {\n    return this.eligibleWidgets.sort((a, b) => {\n      return a.title.localeCompare(b.title);\n    });\n  }\n\n  public select($event:any, widget:WidgetRegistration) {\n    this.chosenWidget = widget;\n    this.closeMe($event);\n  }\n\n  public trackWidgetBy(widget:WidgetRegistration) {\n    return widget.identifier;\n  }\n\n  private get eligibleWidgets() {\n    let schemaWidgetIdentifiers = this.locals.schema.widgets.allowedValues.map((widget:any) => {\n      return widget.identifier;\n    });\n\n    return this.widgetsService.registered.filter((widget) => {\n      return schemaWidgetIdentifiers.includes(widget.identifier);\n    });\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {GridWidgetArea} from \"app/modules/grids/areas/grid-widget-area\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\n\n\n@Injectable()\nexport class GridMoveService {\n  constructor(private layout:GridAreaService) {}\n\n  public down(movedArea:GridWidgetArea|null, ignoreArea:GridWidgetArea) {\n    let movedAreas:GridWidgetArea[] = [];\n    let remainingAreas:GridWidgetArea[] = this.layout.widgetAreas.slice(0);\n\n    if (ignoreArea) {\n      remainingAreas = remainingAreas.filter((area) => {\n        return area.guid !== ignoreArea.guid;\n      });\n    }\n\n    remainingAreas.sort((a, b) => {\n      return b.startRow - a.startRow;\n    });\n\n    while (movedArea !== null) {\n      movedAreas.push(movedArea!);\n\n      remainingAreas = remainingAreas.filter((area) => {\n        return area.guid !== movedArea!.guid;\n      });\n\n      movedArea = this.moveOneDown(movedAreas, remainingAreas);\n    }\n  }\n\n  private moveOneDown(anchorAreas:GridWidgetArea[], movableAreas:GridWidgetArea[]) {\n    let moveSpecification = this.firstAreaToMove(anchorAreas, movableAreas);\n\n    if (moveSpecification) {\n      let toMoveArea = moveSpecification[0] as GridWidgetArea;\n      let anchorArea = moveSpecification[1] as GridWidgetArea;\n\n      let areaHeight = toMoveArea.widget.height;\n\n      toMoveArea.startRow = anchorArea.endRow;\n      toMoveArea.endRow = toMoveArea.startRow + areaHeight;\n\n      if (this.layout.numRows < toMoveArea.endRow - 1) {\n        this.layout.numRows = toMoveArea.endRow - 1;\n      }\n\n      return toMoveArea;\n    } else {\n      return null;\n    }\n  }\n\n  // Return first area that needs to move as it overlaps another area.\n  // There are two groups of areas here. The first (anchorAreas) is considered stable\n  // and as such not fit for being moved. This happens e.g. when the user explicitly\n  // moved a widget or if the area has already been moved in a previous run of this method.\n  // The second group (movableAreas) consists of all areas that are movable.\n  // Once an area out of the second group has been identified that overlaps an area of the first\n  // group, the appropriate reference area for later moving is selected out of the group of all\n  // unmovable areas. The reference area is the bottommost area within the unmovable areas which's\n  // column values (start/end) include the to move area's start column value and which's end row is larger\n  // than the area overlapping the area to move. Unmovable areas which's column values do not include the\n  // start column are to the left or right of the area to move and can thus be ignored.\n  private firstAreaToMove(anchorAreas:GridWidgetArea[], movableAreas:GridWidgetArea[]) {\n    let overlappingArea:GridWidgetArea|null = null;\n    let toMoveArea:GridWidgetArea|null = null;\n\n    movableAreas.forEach((movableArea) => {\n      anchorAreas.forEach((anchorArea) => {\n        if (anchorArea.overlaps(movableArea)) {\n          overlappingArea = anchorArea;\n          toMoveArea = movableArea;\n          return;\n        }\n      });\n\n      if (toMoveArea) {\n        return;\n      }\n    });\n\n    if (toMoveArea !== null) {\n      let referenceArea = overlappingArea!;\n\n      anchorAreas.forEach((anchorArea) => {\n        if (anchorArea.endRow > referenceArea.endRow && toMoveArea!.columnOverlaps(anchorArea)) {\n          referenceArea = anchorArea;\n        }\n      });\n\n      return [toMoveArea, referenceArea];\n    } else {\n      return null;\n    }\n  }\n}\n","import {Injectable, OnDestroy} from '@angular/core';\nimport {GridWidgetArea} from \"core-app/modules/grids/areas/grid-widget-area\";\nimport {GridArea} from \"core-app/modules/grids/areas/grid-area\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {GridMoveService} from \"core-app/modules/grids/grid/move.service\";\nimport { Subscription } from 'rxjs';\nimport { filter, distinctUntilChanged, throttleTime } from 'rxjs/operators';\n\n@Injectable()\nexport class GridDragAndDropService implements OnDestroy {\n  public draggedArea:GridWidgetArea|null;\n  public placeholderArea:GridWidgetArea|null;\n  public draggedHeight:number|null;\n  private mousedOverAreaObserver:Subscription;\n\n  constructor(readonly layout:GridAreaService,\n              readonly move:GridMoveService) {\n    // ngOnInit is not called on services\n    this.setupMousedOverAreaSubscription();\n  }\n\n  ngOnDestroy():void {\n    this.mousedOverAreaObserver.unsubscribe();\n  }\n\n  private setupMousedOverAreaSubscription() {\n    this.mousedOverAreaObserver = this\n      .layout\n      .$mousedOverArea\n      .pipe(\n        // avoid flickering of widgets as the grid gets resized by the placeholder movement\n        throttleTime(10),\n        distinctUntilChanged(),\n        filter((area) => this.currentlyDragging && !!area && !this.layout.isGap(area) && (this.placeholderArea!.startRow !== area.startRow || this.placeholderArea!.startColumn !== area.startColumn)),\n      ).subscribe(area => {\n        this.updateArea(area!);\n\n        this.layout.scrollPlaceholderIntoView();\n      });\n  }\n\n  private updateArea(area:GridArea) {\n    this.layout.resetAreas(this.draggedArea);\n    this.moveAreasOnDragging(area);\n  }\n\n  private moveAreasOnDragging(dropArea:GridArea) {\n    if (!this.placeholderArea) {\n      return;\n    }\n    let widgetArea = this.draggedArea!;\n\n    // Set the draggedArea's startRow/startColumn properties\n    // to the drop zone ones.\n    // The dragged Area should keep it's height and width normally but will\n    // shrink if the area would otherwise end outside the grid.\n    // we cannot use the widget's original area as moving it while dragging confuses cdkDrag\n    this.copyPositionButRestrict(dropArea, this.placeholderArea);\n\n    this.move.down(this.placeholderArea, widgetArea);\n  }\n\n  public get currentlyDragging() {\n    return !!this.draggedArea;\n  }\n\n  public isDropOnlyArea(area:GridArea) {\n    return !this.currentlyDragging && area.endRow === this.layout.numRows + 2;\n  }\n\n  public isDragged(area:GridWidgetArea) {\n    return this.currentlyDragging && this.draggedArea!.guid === area.guid;\n  }\n\n  public isPassive(area:GridWidgetArea) {\n    return this.currentlyDragging && !this.isDragged(area);\n  }\n\n  public get isDraggable() {\n    return this.layout.isEditable;\n  }\n\n  public start(area:GridWidgetArea) {\n    this.placeholderArea = new GridWidgetArea(area.widget);\n    // TODO find an angular way to do this that ideally does not require passing the element from the grid component\n    this.draggedHeight = (document as any).getElementById(area.guid).offsetHeight - 2; // border width * 2\n    this.draggedArea = area;\n  }\n\n  public abort() {\n    document.dispatchEvent(new Event('mouseup'));\n    this.draggedArea = null;\n    this.placeholderArea = null;\n    this.layout.resetAreas();\n  }\n\n  public drop() {\n    if (!this.draggedArea) {\n      return;\n    }\n\n    this.placeholderArea!.copyDimensionsTo(this.draggedArea!)\n\n    if (!this.draggedArea!.unchangedSize) {\n      this.layout.writeAreaChangesToWidgets();\n      this.layout.cleanupUnusedAreas();\n      this.layout.rebuildAndPersist();\n    }\n\n    this.draggedArea = null;\n    this.placeholderArea = null;\n  }\n\n  private copyPositionButRestrict(source:GridArea, sink:GridWidgetArea) {\n    sink.startRow = source.startRow;\n\n    // The first condition is aimed at the case when the user drags an element to the very last row\n    // which is not reflected by the numRows.\n    if (source.startRow === this.layout.numRows + 1) {\n      sink.endRow = this.layout.numRows + 2;\n    } else if (source.startRow + sink.widget.height > this.layout.numRows + 1) {\n      sink.endRow = this.layout.numRows + 1;\n    } else {\n      sink.endRow = source.startRow + sink.widget.height;\n    }\n\n    sink.startColumn = source.startColumn;\n    if (source.startColumn + sink.widget.width > this.layout.numColumns + 1) {\n      sink.endColumn = this.layout.numColumns + 1;\n    } else {\n      sink.endColumn = source.startColumn + sink.widget.width;\n    }\n  }\n\n}\n","import {Injectable} from '@angular/core';\nimport {GridWidgetArea} from \"core-app/modules/grids/areas/grid-widget-area\";\nimport {GridArea} from \"core-app/modules/grids/areas/grid-area\";\nimport {ResizeDelta} from \"core-app/modules/common/resizer/resizer.component\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {GridMoveService} from \"core-app/modules/grids/grid/move.service\";\nimport {GridDragAndDropService} from \"core-app/modules/grids/grid/drag-and-drop.service\";\n\n@Injectable()\nexport class GridResizeService {\n  private resizedArea:GridWidgetArea|null;\n  private targetIds:string[];\n\n  constructor(readonly layout:GridAreaService,\n              readonly move:GridMoveService,\n              readonly drag:GridDragAndDropService) { }\n\n  public end(area:GridWidgetArea) {\n    if (!this.resizedArea) {\n      return;\n    }\n\n    this.resizedArea = null;\n\n    // user aborted resizing\n    if (area.unchangedSize) {\n      return;\n    }\n\n    this.layout.writeAreaChangesToWidgets();\n    this.layout.cleanupUnusedAreas();\n\n    this.layout.rebuildAndPersist();\n  }\n\n  public abort() {\n    if (this.resizedArea) {\n      this.layout.resetAreas();\n      this.resizedArea = null;\n    }\n  }\n\n  public start(resizedArea:GridWidgetArea) {\n    this.resizedArea = resizedArea;\n\n    let resizeTargets = this.layout.gridAreas.filter((area) => {\n      // All areas on the same row which are after the current column are valid targets.\n      let sameRow = area.startRow === this.resizedArea!.startRow &&\n                     area.startColumn >= this.resizedArea!.startColumn;\n\n      // Areas that are on higher (number, they are printed below) rows\n      // are allowed as long as there is guaranteed to always be one widget\n      // before or after the resized to area.\n      let higherRow = area.startRow > this.resizedArea!.startRow &&\n                      area.startColumn >= this.resizedArea!.startColumn &&\n                      this.layout.widgetAreas.some((fixedArea) => {\n                        return fixedArea.startRow === area.startRow &&\n                        // before\n                        (fixedArea.endColumn <= this.resizedArea!.startColumn ||\n                          // after\n                          fixedArea.startColumn >= area.endColumn);\n                      });\n       return sameRow || higherRow;\n    });\n\n    this.targetIds = resizeTargets\n                     .map(area => area.guid);\n  }\n\n  public moving(deltas:ResizeDelta) {\n    if (!this.resizedArea ||\n      !this.layout.mousedOverArea ||\n      !this.targetIds.includes(this.layout.mousedOverArea.guid)) {\n      return;\n    }\n\n    this.layout.resetAreas();\n\n    this.resizedArea.endRow = this.layout.mousedOverArea.endRow;\n    this.resizedArea.endColumn = this.layout.mousedOverArea.endColumn;\n\n    this.move.down(this.resizedArea, this.resizedArea);\n  }\n\n  public isTarget(area:GridArea) {\n    let areaId = area.guid;\n\n    return this.resizedArea && this.targetIds.includes(areaId);\n  }\n\n  public isResized(area:GridWidgetArea) {\n    return this.resizedArea && this.resizedArea.guid === area.guid;\n  }\n\n  public isPassive(area:GridWidgetArea) {\n    return this.currentlyResizing && !this.isResized(area);\n  }\n\n  public get currentlyResizing() {\n    return !!this.resizedArea;\n  }\n\n  public get isResizable() {\n    return !this.drag.currentlyDragging && this.isAllowed;\n  }\n\n  private get isAllowed() {\n    return this.layout.gridResource.updateImmediately;\n  }\n}\n","import {Injectable, Injector} from \"@angular/core\";\nimport {OpModalService} from \"app/components/op-modals/op-modal.service\";\nimport {AddGridWidgetModal} from \"app/modules/grids/widgets/add/add.modal\";\nimport {GridWidgetResource} from \"app/modules/hal/resources/grid-widget-resource\";\nimport {GridArea} from \"app/modules/grids/areas/grid-area\";\nimport {HalResourceService} from \"app/modules/hal/services/hal-resource.service\";\nimport {GridWidgetArea} from \"core-app/modules/grids/areas/grid-widget-area\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {GridDragAndDropService} from \"core-app/modules/grids/grid/drag-and-drop.service\";\nimport {GridResizeService} from \"core-app/modules/grids/grid/resize.service\";\nimport {GridMoveService} from \"core-app/modules/grids/grid/move.service\";\nimport {GridGap} from \"core-app/modules/grids/areas/grid-gap\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n@Injectable()\nexport class GridAddWidgetService {\n\n  text = { add: this.i18n.t('js.grid.add_widget') };\n\n  constructor(readonly opModalService:OpModalService,\n              readonly injector:Injector,\n              readonly halResource:HalResourceService,\n              readonly layout:GridAreaService,\n              readonly drag:GridDragAndDropService,\n              readonly move:GridMoveService,\n              readonly resize:GridResizeService,\n              readonly i18n:I18nService) {\n  }\n\n  public isAddable(area:GridArea) {\n    return !this.drag.currentlyDragging &&\n      !this.resize.currentlyResizing &&\n      (this.layout.mousedOverArea === area || this.layout.isSingleCell || this.layout.inHelpMode) &&\n      this.isAllowed;\n  }\n\n  public widget(area:GridArea) {\n    this\n      .select(area)\n      .then((widgetResource) => {\n\n        if (this.layout.isGap(area)) {\n          this.addLine(area as GridGap);\n        }\n\n        let newArea = new GridWidgetArea(widgetResource);\n\n        this.setMaxWidth(newArea);\n\n        this.persist(newArea);\n      })\n      .catch(() => {\n        // user didn't select a widget\n      });\n  }\n\n  public get addText() {\n    return this.text.add;\n  }\n\n  private select(area:GridArea) {\n    return new Promise<GridWidgetResource>((resolve, reject) => {\n      const modal = this.opModalService.show(AddGridWidgetModal, this.injector, { schema: this.layout.schema });\n      modal.closingEvent.subscribe((modal:AddGridWidgetModal) => {\n        let registered = modal.chosenWidget;\n\n        if (!registered) {\n          reject();\n          return;\n        }\n\n        let source = {\n          _type: 'GridWidget',\n          identifier: registered.identifier,\n          startRow: area.startRow,\n          endRow: area.endRow,\n          startColumn: area.startColumn,\n          endColumn: area.endColumn,\n          options: registered.properties || {}\n        };\n\n        let resource = this.halResource.createHalResource(source) as GridWidgetResource;\n\n        resource.grid = this.layout.gridResource;\n\n        resolve(resource);\n      });\n    });\n  }\n\n  private addLine(area:GridGap) {\n    if (area.isRow) {\n      // - 1 to have it added before\n      this.layout.addRow(area.startRow - 1, area.startColumn);\n    } else if (area.isColumn) {\n      // - 1 to have it added before\n      this.layout.addColumn(area.startColumn - 1, area.startRow);\n    }\n  }\n\n  // try to set it to a layout with a height of 1 and as wide as possible\n  // but shrink if that is outside the grid or overlaps any other widget\n  private setMaxWidth(area:GridWidgetArea) {\n    area.endColumn = this.layout.numColumns + 1;\n\n    this.layout.widgetAreas.forEach((existingArea) => {\n      if (area.startColumnOverlaps(existingArea)) {\n        area.endColumn = existingArea.startColumn;\n      }\n    });\n  }\n\n  private persist(area:GridWidgetArea) {\n    area.writeAreaChangeToWidget();\n    this.layout.widgetAreas.push(area);\n    this.layout.widgetResources.push(area.widget);\n    this.layout.rebuildAndPersist();\n  }\n\n  public get isAllowed() {\n    return this.layout.gridResource && this.layout.gridResource.updateImmediately;\n  }\n}\n","import { ChangeDetectorRef, OnDestroy, OnInit, Renderer2, Directive } from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Title} from '@angular/platform-browser';\nimport {GridInitializationService} from \"core-app/modules/grids/grid/initialization.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {GridResource} from \"core-app/modules/hal/resources/grid-resource\";\nimport {GridAddWidgetService} from \"core-app/modules/grids/grid/add-widget.service\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\n\n@Directive()\nexport abstract class GridPageComponent implements OnInit, OnDestroy {\n  public text = { title: this.i18n.t(`js.${this.i18nNamespace()}.label`),\n                  html_title: this.i18n.t(`js.${this.i18nNamespace()}.label`) };\n\n  constructor(readonly gridInitialization:GridInitializationService,\n              // not used in the base class but will be used throughout the subclasses\n              readonly pathHelper:PathHelperService,\n              readonly currentProject:CurrentProjectService,\n              readonly i18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly title:Title,\n              readonly addWidget:GridAddWidgetService,\n              readonly renderer:Renderer2,\n              readonly areas:GridAreaService) {}\n\n  public grid:GridResource;\n\n  ngOnInit() {\n    this.renderer.addClass(document.body, 'widget-grid-layout');\n    this\n      .gridInitialization\n      .initialize(this.gridScopePath())\n      .then((grid) => {\n        this.grid = grid;\n        this.cdRef.detectChanges();\n      });\n\n    this.setHtmlTitle();\n  }\n\n  ngOnDestroy():void {\n    this.renderer.removeClass(document.body, 'widget-grid-layout');\n  }\n\n  private setHtmlTitle() {\n    this.title.setTitle(this.text.html_title);\n  }\n\n  protected abstract i18nNamespace():string;\n\n  protected abstract gridScopePath():string;\n}\n","<div class=\"grid--container\"\n     [style.grid-template-columns]=\"gridColumnStyle\"\n     [style.grid-template-rows]=\"gridRowStyle\">\n\n  <!-- Grid areas that have a widget in them -->\n  <div *ngFor=\"let area of layout.widgetAreas; trackBy: identifyGridArea;\"\n       class=\"grid--area -widgeted\"\n       [ngClass]=\"{'-dragged': drag.isDragged(area),\n                   '-passive': drag.isPassive(area) || resize.isPassive(area),\n                   '-resizing' : resize.isResized(area) }\"\n       [style.grid-row-start]=\"area.gridStartRow\"\n       [style.grid-row-end]=\"area.gridEndRow\"\n       [style.grid-column-start]=\"area.gridStartColumn\"\n       [style.grid-column-end]=\"area.gridEndColumn\"\n       cdkDropList\n       [id]=\"area.guid\"\n       [cdkDropListData]=\"area\"\n       [cdkDropListConnectedTo]=\"layout.gridAreaIds\">\n    <div class=\"grid--area-content widget-box\"\n         cdkDrag\n         (cdkDragStarted)=\"drag.start(area)\"\n         (cdkDragDropped)=\"drag.drop()\"\n         [cdkDragDisabled]=\"isMobileDevice || !drag.isDraggable\">\n\n      <span *ngIf=\"drag.isDraggable\"\n            class=\"grid--area-drag-handle\n                   icon\n                   icon-drag-handle\n                   hidden-for-mobile\"\n            [hidden]=\"isMobileDevice\"\n            cdkDragHandle></span>\n\n      <ndc-dynamic [ndcDynamicComponent]=\"widgetComponent(area)\"\n                   [ndcDynamicInputs]=\"widgetComponentInput(area)\"\n                   [ndcDynamicOutputs]=\"widgetComponentOutput(area)\">\n      </ndc-dynamic>\n    </div>\n    <resizer *ngIf=\"resize.isResizable\"\n             [customHandler]=\"true\"\n             (end)=\"resize.end(area)\"\n             (start)=\"resize.start(area)\"\n             (move)=\"resize.moving($event)\">\n      <div class=\"grid--resizer\">\n        <i class=\"icon-resizer-bottom-right hidden-for-mobile\"\n           aria-hidden=\"true\">\n        </i>\n      </div>\n    </resizer>\n  </div>\n\n  <!-- One grid area per cell (row x columns) -->\n  <div *ngFor=\"let area of layout.gridAreas; trackBy: identifyGridArea;\"\n       class=\"grid--area hidden-for-mobile\"\n       [ngClass] = \"{'-drop-target': drag.currentlyDragging,\n                     '-drop-only': drag.isDropOnlyArea(area),\n                     '-resize-target': resize.isTarget(area),\n                     '-addable': add.isAddable(area),\n                     '-help-mode': layout.inHelpMode}\"\n       [style.grid-row-start]=\"area.gridStartRow\"\n       [style.grid-row-end]=\"area.gridEndRow\"\n       [style.grid-column-start]=\"area.gridStartColumn\"\n       [style.grid-column-end]=\"area.gridEndColumn\"\n       cdkDropList\n       [id]=\"area.guid\"\n       (mouseover)=\"layout.setMousedOverArea(area)\"\n       [cdkDropListData]=\"area\"\n       [cdkDropListConnectedTo]=\"layout.gridAreaIds\">\n    <div class=\"grid--widget-add\"\n         *ngIf=\"add.isAllowed\"\n         [title]=\"add.addText\"\n         (click)=\"add.widget(area)\">\n    </div>\n  </div>\n\n  <div *ngFor=\"let gap of layout.gridGaps; trackBy: identifyGridArea;\"\n       class=\"grid--area -gap hidden-for-mobile\"\n       [ngClass] = \"{'-addable': add.isAddable(gap),\n                     '-help-mode': layout.inHelpMode,\n                     '-row': gap.isRow,\n                     '-column': gap.isColumn}\"\n       [style.grid-row-start]=\"gap.gridStartRow\"\n       [style.grid-row-end]=\"gap.gridEndRow\"\n       [style.grid-column-start]=\"gap.gridStartColumn\"\n       [style.grid-column-end]=\"gap.gridEndColumn\"\n       [id]=\"gap.guid\"\n       (mouseover)=\"layout.setMousedOverArea(gap)\">\n    <div class=\"grid--widget-add -gap\"\n         *ngIf=\"add.isAllowed\"\n         [title]=\"add.addText\"\n         (click)=\"add.widget(gap)\">\n    </div>\n  </div>\n\n  <!-- Grid area used as a placeholder while dragging -->\n  <div *ngIf=\"drag.placeholderArea\"\n       class=\"grid--area -widgeted -placeholder\"\n       [style.grid-row-start]=\"drag.placeholderArea.gridStartRow\"\n       [style.grid-row-end]=\"drag.placeholderArea.gridEndRow\"\n       [style.grid-column-start]=\"drag.placeholderArea.gridStartColumn\"\n       [style.grid-column-end]=\"drag.placeholderArea.gridEndColumn\"\n       [style.min-height.px]=\"drag.draggedHeight\">\n    <div class=\"widget-box\">\n    </div>\n  </div>\n</div>\n","import {Component,\n  ComponentRef,\n  OnDestroy,\n  OnInit,\n  Input,\n  HostListener} from \"@angular/core\";\nimport {GridResource} from \"app/modules/hal/resources/grid-resource\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {GridWidgetsService} from \"app/modules/grids/widgets/widgets.service\";\nimport {AbstractWidgetComponent} from \"app/modules/grids/widgets/abstract-widget.component\";\nimport {GridArea} from \"app/modules/grids/areas/grid-area\";\nimport {GridMoveService} from \"app/modules/grids/grid/move.service\";\nimport {GridDragAndDropService} from \"core-app/modules/grids/grid/drag-and-drop.service\";\nimport {GridResizeService} from \"core-app/modules/grids/grid/resize.service\";\nimport {GridAreaService} from \"core-app/modules/grids/grid/area.service\";\nimport {GridAddWidgetService} from \"core-app/modules/grids/grid/add-widget.service\";\nimport {GridRemoveWidgetService} from \"core-app/modules/grids/grid/remove-widget.service\";\nimport {WidgetWpGraphComponent} from \"core-app/modules/grids/widgets/wp-graph/wp-graph.component\";\nimport {GridWidgetArea} from \"core-app/modules/grids/areas/grid-widget-area\";\nimport {BrowserDetector} from \"core-app/modules/common/browser/browser-detector.service\";\n\nexport interface WidgetRegistration {\n  identifier:string;\n  title:string;\n  component:{ new (...args:any[]):AbstractWidgetComponent };\n  properties?:any;\n}\n\nexport const GRID_PROVIDERS = [\n  GridAreaService,\n  GridMoveService,\n  GridDragAndDropService,\n  GridResizeService,\n  GridAddWidgetService,\n  GridRemoveWidgetService\n];\n\n@Component({\n  templateUrl: './grid.component.html',\n  selector: 'grid'\n})\nexport class GridComponent implements OnDestroy, OnInit {\n  public uiWidgets:ComponentRef<any>[] = [];\n  public GRID_AREA_HEIGHT = 'auto';\n  public GRID_GAP_DIMENSION = '20px';\n\n  public component = WidgetWpGraphComponent;\n\n  @Input() grid:GridResource;\n\n  constructor(private sanitization:DomSanitizer,\n              private widgetsService:GridWidgetsService,\n              public drag:GridDragAndDropService,\n              public resize:GridResizeService,\n              public layout:GridAreaService,\n              public add:GridAddWidgetService,\n              public remove:GridRemoveWidgetService,\n              readonly browserDetector:BrowserDetector) {\n  }\n\n  ngOnInit() {\n    this.layout.gridResource = this.grid;\n  }\n\n  ngOnDestroy() {\n    this.uiWidgets.forEach((widget) => widget.destroy());\n  }\n\n  @HostListener('window:keyup', ['$event'])\n  handleKeyboardEvent(event:KeyboardEvent) {\n    if (event.key !== 'Escape') {\n      return;\n    } else if (this.drag.currentlyDragging) {\n      this.drag.abort();\n    } else if (this.resize.currentlyResizing) {\n      this.resize.abort();\n    }\n  }\n\n  public widgetComponent(area:GridWidgetArea) {\n    let widget = area.widget;\n\n    if (!widget) {\n      return null;\n    }\n\n    let registration = this.widgetsService.registered.find((reg) => reg.identifier === widget.identifier);\n\n    if (!registration) {\n      // debugLog(`No widget registered with identifier ${widget.identifier}`);\n\n      return null;\n    } else {\n      return registration.component;\n    }\n  }\n\n  public widgetComponentInput(area:GridWidgetArea) {\n    return { resource: area.widget };\n  }\n\n  public widgetComponentOutput(area:GridWidgetArea) {\n    return { resourceChanged: this.layout.saveWidgetChangeset.bind(this.layout) };\n  }\n\n  public get gridColumnStyle() {\n    return this.gridStyle(this.layout.numColumns,\n                          `calc((100% - ${this.GRID_GAP_DIMENSION} * ${this.layout.numColumns + 1}) / ${this.layout.numColumns})`);\n  }\n\n  public get gridRowStyle() {\n    return this.gridStyle(this.layout.numRows,\n                         this.GRID_AREA_HEIGHT);\n  }\n\n  public identifyGridArea(index:number, area:GridArea) {\n    return area.guid;\n  }\n\n  public get isHeadersDisplayed() {\n    return this.layout.isEditable;\n  }\n\n  public get isMobileDevice() {\n    return this.browserDetector.isMobile;\n  }\n\n  private gridStyle(amount:number, itemStyle:string) {\n    let style = '';\n    for (let i = 0; i < amount; i++) {\n      style += `${this.GRID_GAP_DIMENSION} ${itemStyle} `;\n    }\n\n    style += `${this.GRID_GAP_DIMENSION}`;\n\n    return this.sanitization.bypassSecurityTrustStyle(style);\n  }\n}\n","<div class=\"toolbar-container\">\n  <div class=\"toolbar\">\n    <div class=\"title-container\">\n      <h2 [textContent]=\"text.title\"></h2>\n    </div>\n\n    <ul class=\"toolbar-items hidden-for-mobile\">\n      <li class=\"toolbar-item hidden-for-mobile\">\n        <zen-mode-toggle-button></zen-mode-toggle-button>\n      </li>\n      <li class=\"toolbar-item\">\n        <button class=\"button\"\n                *ngIf=\"addWidget.isAllowed\"\n                [title]=\"addWidget.addText\"\n                (click)=\"areas.toggleHelpMode()\"\n                [ngClass]=\"{'-active': areas.inHelpMode}\">\n          <op-icon icon-classes=\"button--icon icon-add\">\n          </op-icon>\n        </button>\n      </li>\n    </ul>\n  </div>\n</div>\n\n<grid *ngIf=\"grid\" [grid]=\"grid\"></grid>\n","import {Component} from '@angular/core';\nimport {GridPageComponent} from \"core-app/modules/grids/grid/page/grid-page.component\";\nimport {GRID_PROVIDERS} from \"core-app/modules/grids/grid/grid.component\";\n\n@Component({\n  selector: 'dashboard',\n  templateUrl: '../../grids/grid/page/grid-page.component.html',\n  styleUrls: ['../../grids/grid/page/grid-page.component.sass'],\n  providers: GRID_PROVIDERS\n})\nexport class DashboardComponent extends GridPageComponent {\n  protected i18nNamespace():string {\n    return 'dashboards';\n  }\n\n  protected gridScopePath():string {\n    return this.pathHelper.projectDashboardsPath(this.currentProject.identifier!);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {Ng2StateDeclaration, UIRouter, UIRouterModule} from \"@uirouter/angular\";\nimport {DashboardComponent} from \"core-app/modules/dashboards/dashboard/dashboard.component\";\nimport {OpenprojectGridsModule} from \"core-app/modules/grids/openproject-grids.module\";\n\nconst menuItemClass = 'dashboards-menu-item';\n\nexport const DASHBOARDS_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'dashboards',\n    parent: 'root',\n    // The trailing slash is important\n    // cf., https://community.openproject.com/wp/29754\n    url: '/dashboards/',\n    data: {\n      bodyClasses: ['router--dashboards-view-base', 'widget-grid-layout'],\n      menuItem: menuItemClass\n    },\n    component: DashboardComponent\n  }\n];\n\nexport function uiRouterDashboardsConfiguration(uiRouter:UIRouter) {\n  // Ensure boards/ are being redirected correctly\n  // cf., https://community.openproject.com/wp/29754\n  uiRouter.urlService.rules\n    .when(\n      new RegExp(\"^/projects/(.*)/dashboards$\"),\n      match => `/projects/${match[1]}/dashboards/`\n    );\n}\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n\n    OpenprojectGridsModule,\n\n    // Routes for /dashboards\n    UIRouterModule.forChild({\n      states: DASHBOARDS_ROUTES,\n      config: uiRouterDashboardsConfiguration\n    }),\n  ],\n  providers: [\n  ],\n  declarations: [\n    DashboardComponent\n  ]\n})\nexport class OpenprojectDashboardsModule {\n}\n\n","<div class=\"preview-modal--container\" wp-isolated-query-space *ngIf=\"workPackage\">\n <wp-single-card [workPackage]=\"workPackage\"\n                 orientation=\"horizontal\">\n </wp-single-card>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, Inject, OnInit} from \"@angular/core\";\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken, OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {WorkPackageCacheService} from \"core-components/work-packages/work-package-cache.service\";\n\n@Component({\n  templateUrl: './wp-preview.modal.html',\n  styleUrls: ['./wp-preview.modal.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WpPreviewModal extends OpModalComponent implements OnInit {\n  public workPackage:WorkPackageResource;\n\n  public text = {\n    created_by: this.i18n.t('js.label_created_by'),\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) readonly locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly i18n:I18nService,\n              readonly wpCacheService:WorkPackageCacheService,\n              readonly opModalService:OpModalService) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n    const workPackageLink = this.locals.workPackageLink;\n    const workPackageId = HalResource.idFromLink(workPackageLink);\n\n    this.wpCacheService.require(workPackageId)\n      .then((workPackage:WorkPackageResource) => {\n        this.workPackage = workPackage;\n        this.cdRef.detectChanges();\n\n        const modal = jQuery(this.elementRef.nativeElement).find('.preview-modal--container');\n        this.reposition(modal, this.locals.event.target);\n      });\n  }\n\n  public reposition(element:JQuery<HTMLElement>, target:JQuery<HTMLElement>) {\n    element.position({\n      my: 'right top',\n      at: 'right bottom',\n      of: target,\n      collision: 'flipfit'\n    });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {Injectable, Injector} from \"@angular/core\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {WpPreviewModal} from \"core-components/modals/preview-modal/wp-preview-modal/wp-preview.modal\";\n\n@Injectable({ providedIn: 'root' })\nexport class PreviewTriggerService {\n  private previewModal:WpPreviewModal;\n  private modalElement:HTMLElement;\n\n  constructor(readonly opModalService:OpModalService,\n              readonly injector:Injector) {\n  }\n\n  setupListener() {\n    jQuery(document.body).on('mouseenter', '.preview-trigger', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      const el = jQuery(e.target);\n      const href = el.attr('href');\n\n      if (!href) {\n        return;\n      }\n\n      this.previewModal = this.opModalService.show(WpPreviewModal, this.injector, { workPackageLink: href, event: e });\n      this.modalElement = this.previewModal.elementRef.nativeElement;\n      this.previewModal.reposition(jQuery(this.modalElement), el);\n\n      jQuery(this.modalElement).addClass('-no-width -no-height');\n    });\n\n    jQuery(document.body).on('mouseleave', '.preview-trigger', (e:JQuery.MouseLeaveEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (this.isMouseOverPreview(e)) {\n        jQuery(this.modalElement).on('mouseleave',  () => {\n          this.opModalService.close();\n        });\n      } else {\n        this.opModalService.close();\n      }\n    });\n  }\n\n  private isMouseOverPreview(e:JQuery.MouseLeaveEvent) {\n    if (!this.modalElement) {\n      return false;\n    }\n\n    const previewElement = jQuery(this.modalElement.children[0]);\n    if (previewElement && previewElement.offset()) {\n      let horizontalHover = e.pageX >= Math.floor(previewElement.offset()!.left) &&\n                            e.pageX < previewElement.offset()!.left + previewElement.width()!;\n      let verticalHover = e.pageY >= Math.floor(previewElement.offset()!.top) &&\n                          e.pageY < previewElement.offset()!.top + previewElement.height()!;\n      return horizontalHover && verticalHover;\n    }\n    return false;\n  }\n\n}\n","import {Component} from '@angular/core';\nimport {GridPageComponent} from \"core-app/modules/grids/grid/page/grid-page.component\";\nimport {GRID_PROVIDERS} from \"core-app/modules/grids/grid/grid.component\";\n\n@Component({\n  selector: 'overview',\n  templateUrl: '../grids/grid/page/grid-page.component.html',\n  styleUrls: ['../grids/grid/page/grid-page.component.sass'],\n  providers: GRID_PROVIDERS\n})\nexport class OverviewComponent extends GridPageComponent {\n  protected i18nNamespace():string {\n    return 'overviews';\n  }\n\n  protected gridScopePath():string {\n    return this.pathHelper.projectPath(this.currentProject.identifier!);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {Ng2StateDeclaration, UIRouter, UIRouterModule} from \"@uirouter/angular\";\nimport {OpenprojectGridsModule} from \"core-app/modules/grids/openproject-grids.module\";\nimport {OverviewComponent} from \"core-app/modules/overview/overview.component\";\n\nconst menuItemClass = 'overview-menu-item';\n\nexport const OVERVIEW_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'overview',\n    parent: 'root',\n    // The trailing slash is important\n    // cf., https://community.openproject.com/wp/29754\n    url: '/',\n    data: {\n      menuItem: menuItemClass\n    },\n    component: OverviewComponent\n  }\n];\n\nexport function uiRouterOverviewConfiguration(uiRouter:UIRouter) {\n  // Ensure projects/:project_id/ are being redirected correctly\n  // cf., https://community.openproject.com/wp/29754\n  uiRouter.urlService.rules\n    .when(\n      new RegExp(\"^/projects(?!/new$)/([^/]+)$\"),\n      match => `/projects/${match[1]}/`\n    );\n}\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n\n    OpenprojectGridsModule,\n\n    UIRouterModule.forChild({\n      states: OVERVIEW_ROUTES,\n      config: uiRouterOverviewConfiguration\n    }),\n  ],\n  providers: [\n  ],\n  declarations: [\n    OverviewComponent\n  ]\n})\nexport class OpenprojectOverviewModule {\n}\n\n","import {Component} from \"@angular/core\";\nimport {GRID_PROVIDERS} from \"core-app/modules/grids/grid/grid.component\";\nimport {GridPageComponent} from \"core-app/modules/grids/grid/page/grid-page.component\";\n\n@Component({\n  templateUrl: '../grids/grid/page/grid-page.component.html',\n  styleUrls: ['../grids/grid/page/grid-page.component.sass'],\n  providers: GRID_PROVIDERS\n})\nexport class MyPageComponent extends GridPageComponent {\n  protected i18nNamespace():string {\n    return 'my_page';\n  }\n\n  protected gridScopePath():string {\n    return this.pathHelper.myPagePath();\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {Ng2StateDeclaration, UIRouterModule} from \"@uirouter/angular\";\nimport {OpenprojectGridsModule} from \"core-app/modules/grids/openproject-grids.module\";\nimport {MyPageComponent} from \"core-app/modules/my-page/my-page.component\";\n\nexport const MY_PAGE_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'my_page',\n    url: '/my/page',\n    component: MyPageComponent,\n    data: {\n      bodyClasses: ['router--work-packages-my-page', 'widget-grid-layout'],\n      parent: 'work-packages'\n    }\n  },\n];\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n\n    OpenprojectGridsModule,\n\n    // Routes for my_page\n    UIRouterModule.forChild({ states: MY_PAGE_ROUTES }),\n  ],\n  declarations: [\n    MyPageComponent\n  ]\n})\nexport class OpenprojectMyPageModule {\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Injectable} from \"@angular/core\";\nimport {PathHelperService} from \"../common/path-helper/path-helper.service\";\nimport {CurrentProjectService} from \"../../components/projects/current-project.service\";\nimport {FocusHelperService} from \"../common/focus/focus-helper\";\n\nconst accessKeys = {\n  preview: 1,\n  newWorkPackage: 2,\n  edit: 3,\n  quickSearch: 4,\n  projectSearch: 5,\n  help: 6,\n  moreMenu: 7,\n  details: 8\n};\n\n// this could be extracted into a separate component if it grows\nconst accessibleListSelector = 'table.keyboard-accessible-list';\nconst accessibleRowSelector = 'table.keyboard-accessible-list tbody tr';\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class KeyboardShortcutService {\n\n  // maybe move it to a .constant\n  private shortcuts:any = {\n    '?': () => this.showHelpModal(),\n    'g m': this.globalAction('myPagePath'),\n    'g o': this.projectScoped('projectPath'),\n    'g w p': this.projectScoped('projectWorkPackagesPath'),\n    'g w i': this.projectScoped('projectWikiPath'),\n    'g a': this.projectScoped('projectActivityPath'),\n    'g c': this.projectScoped('projectCalendarPath'),\n    'g n': this.projectScoped('projectNewsPath'),\n    'g t': this.projectScoped('projectTimelinesPath'),\n    'n w p': this.projectScoped('projectWorkPackageNewPath'),\n\n    'g e': this.accessKey('edit'),\n    'g p': this.accessKey('preview'),\n    'd w p': this.accessKey('details'),\n    'm': this.accessKey('moreMenu'),\n    'p': this.accessKey('projectSearch'),\n    's': this.accessKey('quickSearch'),\n    'k': () => this.focusPrevItem(),\n    'j': () => this.focusNextItem()\n  };\n\n\n  constructor(private readonly PathHelper:PathHelperService,\n              private readonly FocusHelper:FocusHelperService,\n              private readonly currentProject:CurrentProjectService) {\n    this.register();\n  }\n\n  /**\n   * Register the keyboard shortcuts.\n   */\n  public register() {\n    _.each(this.shortcuts, (action:() => void, key:string) => Mousetrap.bind(key, action));\n  }\n\n  public accessKey(keyName:'preview'|'newWorkPackage'|'edit'|'quickSearch'|'projectSearch'|'help'|'moreMenu'|'details') {\n    var key = accessKeys[keyName];\n    return () => {\n      var elem = jQuery('[accesskey=' + key + ']:first');\n      if (elem.is('input') || elem.attr('id') === 'global-search-input') {\n        // timeout with delay so that the key is not\n        // triggered on the input\n        setTimeout(() => this.FocusHelper.focus(elem), 200);\n      } else if (elem.is('[href]')) {\n        this.clickLink(elem[0]);\n      } else {\n        elem[0].click();\n      }\n    };\n  }\n\n  public globalAction(action:keyof PathHelperService) {\n    return () => {\n      var url = (this.PathHelper[action] as any)();\n      window.location.href = url;\n    };\n  }\n\n  public projectScoped(action:keyof PathHelperService) {\n    return () => {\n      var projectIdentifier = this.currentProject.identifier;\n      if (projectIdentifier) {\n        var url = (this.PathHelper[action] as any)(projectIdentifier);\n        window.location.href = url;\n      }\n    };\n  }\n\n  clickLink(link:any) {\n    var cancelled = false;\n\n    if (!!document.createEvent) {\n      var event = new MouseEvent('click', {\n        view: window,\n        bubbles: true,\n        cancelable: true\n      });\n      cancelled = !link.dispatchEvent(event);\n    } else if (link.fireEvent) {\n      cancelled = !link.fireEvent('onclick');\n    }\n\n    if (!cancelled) {\n      window.location.href = link.href;\n    }\n  }\n\n  showHelpModal() {\n    window.open(this.PathHelper.keyboardShortcutsHelpPath());\n  }\n\n  findListInPage() {\n    const domLists = jQuery(accessibleListSelector);\n    const focusElements:any = [];\n    domLists.find('tbody tr').each(function (index, tr) {\n      var firstLink = jQuery(tr).find(':visible:tabbable')[0];\n      if (firstLink !== undefined) {\n        focusElements.push(firstLink);\n      }\n    });\n    return focusElements;\n  }\n\n  focusItemOffset(offset:number) {\n    const list = this.findListInPage();\n    let index;\n\n    if (list === null) {\n      return;\n    }\n\n    index = list.indexOf(\n      jQuery(document.activeElement!)\n        .closest(accessibleRowSelector)\n        .find(':visible:tabbable')[0]\n    );\n\n    const target = jQuery(list[(index + offset + list.length) % list.length]);\n    target.focus();\n\n  }\n\n  focusNextItem() {\n    this.focusItemOffset(1);\n  }\n\n  focusPrevItem() {\n    this.focusItemOffset(-1);\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit} from '@angular/core';\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport const colorsAutocompleterSelector = 'colors-autocompleter';\n\n@Component({\n  template: `\n    <ng-select [items]=\"options\"\n               [virtualScroll]=\"true\"\n               bindLabel=\"name\"\n               bindValue=\"value\"\n               [(ngModel)]=\"selectedOption\"\n               (change)=\"onModelChange($event)\"\n               [clearable]=\"false\"\n               appendTo=\"body\">\n      <ng-template ng-label-tmp let-item=\"item\">\n        <span [ngClass]=\"highlightColor(item)\">{{item.name}}</span>\n      </ng-template>\n      <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\">\n        <span [ngClass]=\"highlightColor(item)\">{{item.name}}</span>\n      </ng-template>\n    </ng-select>\n  `,\n  selector: colorsAutocompleterSelector\n})\nexport class ColorsAutocompleter implements OnInit {\n  public options:any[];\n  public selectedOption:any;\n  private highlightTextInline:boolean = false;\n  private updateInputField:HTMLInputElement|undefined;\n  private selectedColorId:string;\n\n  constructor(protected elementRef:ElementRef,\n              protected readonly I18n:I18nService) {\n  }\n\n  ngOnInit() {\n    this.setColorOptions();\n\n    this.updateInputField = document.getElementsByName(this.elementRef.nativeElement.dataset.updateInput)[0] as HTMLInputElement|undefined;\n    this.highlightTextInline =  JSON.parse(this.elementRef.nativeElement.dataset.highlightTextInline);\n  }\n\n  public onModelChange(color:any) {\n    if (color && this.updateInputField) {\n      this.updateInputField.value = color.value;\n    }\n  }\n\n  private setColorOptions() {\n    this.options = JSON.parse(this.elementRef.nativeElement.dataset.colors);\n    this.options.unshift({name: this.I18n.t('js.label_no_color'), value: ''});\n\n    this.selectedOption = this.options.find((item) => item.selected === true);\n\n    if (this.selectedOption) {\n      this.selectedOption = this.selectedOption.value;\n    } else {\n      // Differentiate between \"No color\" and a color that is now not selectable any more\n      this.selectedColorId = this.elementRef.nativeElement.dataset.selectedColor;\n      this.selectedOption = this.selectedColorId ? this.selectedColorId : '';\n    }\n  }\n\n  private highlightColor(item:any) {\n    if (item.value === '') { return; }\n\n    let highlightingClass;\n    if (this.highlightTextInline) {\n      highlightingClass = '__hl_inline_type_ ';\n    } else {\n      highlightingClass = '__hl_inline_ ';\n    }\n    return highlightingClass + Highlighting.colorClass(this.highlightTextInline, item.value);\n  }\n\n}\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, ChangeDetectorRef, Component, ElementRef, OnDestroy, OnInit, Renderer2} from '@angular/core';\nimport {FocusHelperService} from 'app/modules/common/focus/focus-helper';\nimport {I18nService} from 'app/modules/common/i18n/i18n.service';\nimport {HalResourceService} from \"app/modules/hal/services/hal-resource.service\";\nimport {GlobalSearchService} from \"core-app/modules/global_search/services/global-search.service\";\nimport {WorkPackageFiltersService} from \"app/components/filters/wp-filters/wp-filters.service\";\nimport {UrlParamsHelperService} from \"app/components/wp-query/url-params-helper\";\nimport {WorkPackageTableConfigurationObject} from \"core-components/wp-table/wp-table-configuration\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {debounceTime, distinctUntilChanged, skip} from \"rxjs/operators\";\nimport {combineLatest} from \"rxjs\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const globalSearchWorkPackagesSelector = 'global-search-work-packages';\n\n@Component({\n  selector: globalSearchWorkPackagesSelector,\n  template: `\n    <wp-embedded-table *ngIf=\"!resultsHidden\"\n                       [queryProps]=\"queryProps\"\n                       [configuration]=\"tableConfiguration\">\n    </wp-embedded-table>\n  `\n})\n\nexport class GlobalSearchWorkPackagesComponent extends UntilDestroyedMixin implements OnInit, OnDestroy, AfterViewInit {\n  public queryProps:{ [key:string]:any };\n  public resultsHidden = false;\n\n  public tableConfiguration:WorkPackageTableConfigurationObject = {\n    actionsColumnEnabled: false,\n    columnMenuEnabled: true,\n    contextMenuEnabled: false,\n    inlineCreateEnabled: false,\n    withFilters: true,\n    showFilterButton: true,\n    filterButtonText: this.I18n.t('js.button_advanced_filter')\n  };\n\n  constructor(readonly FocusHelper:FocusHelperService,\n              readonly elementRef:ElementRef,\n              readonly renderer:Renderer2,\n              readonly I18n:I18nService,\n              readonly halResourceService:HalResourceService,\n              readonly globalSearchService:GlobalSearchService,\n              readonly wpTableFilters:WorkPackageViewFiltersService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly wpFilters:WorkPackageFiltersService,\n              readonly cdRef:ChangeDetectorRef,\n              private UrlParamsHelper:UrlParamsHelperService) {\n    super();\n  }\n\n  ngAfterViewInit() {\n    combineLatest([\n      this.globalSearchService.searchTerm$,\n      this.globalSearchService.projectScope$\n    ])\n      .pipe(\n        skip(1),\n        distinctUntilChanged(),\n        debounceTime(10),\n        this.untilDestroyed()\n      )\n      .subscribe(([newSearchTerm, newProjectScope]) => {\n        this.wpFilters.visible = false;\n        this.setQueryProps();\n      });\n\n    this.globalSearchService\n      .resultsHidden$\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((resultsHidden:boolean) => this.resultsHidden = resultsHidden);\n  }\n\n  ngOnInit():void {\n    this.setQueryProps();\n  }\n\n  private setQueryProps():void {\n    let filters:any[] = [];\n    let columns = ['id', 'project', 'subject', 'type', 'status', 'updatedAt'];\n\n    if (this.globalSearchService.searchTerm.length > 0) {\n      filters.push({\n        search: {\n          operator: '**',\n          values: [this.globalSearchService.searchTerm]\n        }\n      });\n    }\n\n    if (this.globalSearchService.projectScope === 'current_project') {\n      filters.push({\n        subprojectId: {\n          operator: '!*',\n          values: []\n        }\n      });\n      columns = ['id', 'subject', 'type', 'status', 'updatedAt'];\n    }\n\n    if (this.globalSearchService.projectScope === '') {\n      filters.push({\n        subprojectId: {\n          operator: '*',\n          values: []\n        }\n      });\n    }\n\n    this.queryProps = {\n      'columns[]': columns,\n      filters: JSON.stringify(filters),\n      sortBy: JSON.stringify([['updatedAt', 'desc']]),\n      showHierarchies: false\n    };\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from '@angular/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {BcfRestApi} from \"core-app/modules/bim/bcf/bcf-constants.const\";\n\nexport const homescreenNewFeaturesBlockSelector = 'homescreen-new-features-block';\n\n@Component({\n  template: `\n    <p class=\"widget-box--additional-info\">\n      {{ text.descriptionNewFeatures }}\n    </p>\n\n    <div class=\"widget-box--description\">\n      <p [innerHtml]=\"currentNewFeatureHtml\"></p>\n\n      <a class=\"widget-box--teaser-image\"></a>\n    </div>\n\n    <a [href]=\"teaserWebsiteUrl\" target=\"_blank\">{{ text.learnAbout }}</a>\n  `,\n  selector: homescreenNewFeaturesBlockSelector,\n  styleUrls: ['./new-features.component.sass'],\n})\n\n/**\n * Component for the homescreen block to promote new features.\n * When updating this for the next release, be sure to cleanup stuff is not needed any more:\n * Locals (js-en.yml), Styles (new-features.component.sass), HTML (above), TS (below)\n */\nexport class HomescreenNewFeaturesBlockComponent {\n  public isStandardEdition:boolean;\n\n  public text = {\n    newFeatures: this.i18n.t('js.label_new_features'),\n    descriptionNewFeatures: this.i18n.t('js.homescreen.blocks.new_features.text_new_features'),\n    learnAbout: this.i18n.t('js.homescreen.blocks.new_features.learn_about'),\n  };\n\n  constructor(\n    readonly i18n:I18nService,\n    readonly domSanitizer:DomSanitizer\n  ) {\n    this.isStandardEdition = window.OpenProject.isStandardEdition;\n  }\n\n  public get teaserWebsiteUrl() {\n    let url = this.translated('learn_about_link');\n    return this.domSanitizer.bypassSecurityTrustResourceUrl(url);\n  }\n\n  public get currentNewFeatureHtml():string {\n    return this.translated('current_new_feature_html');\n  }\n\n  private translated(key:string):string {\n    return this.i18n.t(this.i18nBase + this.i18nPrefix + '.' + key, { list_styling_class: 'widget-box--arrow-links', bcf_api_link: BcfRestApi});\n  }\n\n  private i18nBase:string = 'js.homescreen.blocks.new_features.';\n\n  private get i18nPrefix():string {\n    return this.isStandardEdition ? \"standard\" : \"bim\";\n  }\n}\n","export const BcfRestApi = \"https://github.com/opf/openproject/blob/dev/docs/api/bcf/bcf-rest-api.md\";\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component} from '@angular/core';\n\nexport const globalSearchWorkPackagesSelectorEntry = 'global-search-work-packages-entry';\n\n/**\n * An entry component to be rendered by Rails which opens an isolated query space\n * for the work package search embedded table.\n */\n@Component({\n  selector: globalSearchWorkPackagesSelectorEntry,\n  template: `\n    <ng-container wp-isolated-query-space>\n      <global-search-work-packages></global-search-work-packages>\n    </ng-container>\n  `\n})\nexport class GlobalSearchWorkPackagesEntryComponent {\n}\n\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, ElementRef, OnInit} from \"@angular/core\";\n\nexport const persistentToggleSelector = 'persistent-toggle';\n\n@Component({\n  selector: persistentToggleSelector,\n  template: ''\n})\nexport class PersistentToggleComponent implements OnInit {\n\n  /** Unique identifier of the toggle */\n  private identifier:string;\n\n  /** Is hidden */\n  private isHidden:boolean = false;\n\n  /** Element reference */\n  private $element:JQuery;\n  private $targetNotification:JQuery;\n\n  constructor(private elementRef:ElementRef) {\n  }\n\n  ngOnInit():void {\n    this.$element = jQuery(this.elementRef.nativeElement);\n    this.$targetNotification = this.getTargetNotification();\n\n    this.identifier =  this.$element.data('identifier');\n    this.isHidden = window.OpenProject.guardedLocalStorage(this.identifier) === 'true';\n\n    // Set initial state\n    this.$targetNotification.prop('hidden', !!this.isHidden);\n\n    // Register click handler\n    this.$element\n      .parent()\n      .find('.persistent-toggle--click-handler')\n      .on('click', () => this.toggle(!this.isHidden));\n\n    // Register target notification close icon\n    this.$targetNotification\n      .find('.notification-box--close')\n      .on('click', () => this.toggle(true));\n\n  }\n\n  private getTargetNotification() {\n    return this.$element\n      .parent()\n      .find('.persistent-toggle--notification');\n  }\n\n  private toggle(isNowHidden:boolean) {\n    this.isHidden = isNowHidden;\n    window.OpenProject.guardedLocalStorage(this.identifier, (!!isNowHidden).toString());\n\n    if (isNowHidden) {\n      this.$targetNotification.slideUp(400, () => {\n        // Set hidden only after animation completed\n        this.$targetNotification.prop('hidden', true);\n      });\n    } else {\n      this.$targetNotification.slideDown(400);\n      this.$targetNotification.prop('hidden', false);\n    }\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\nimport {Injectable} from \"@angular/core\";\nimport {input} from \"reactivestates\";\n\nexport interface HideSectionDefinition {\n  key:string;\n  label:string;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class HideSectionService {\n  public displayed = input<string[]>();\n  public all:HideSectionDefinition[] = [];\n\n  constructor(Gon:GonService) {\n    const sections:any = Gon.get('hideSections');\n    this.all = sections.all;\n    this.displayed.putValue(sections.active.map((el:HideSectionDefinition) => {\n      this.toggleVisibility(el.key, true);\n      return el.key;\n    }));\n\n    this.removeHiddenOnSubmit();\n  }\n\n  section(key:string):HTMLElement|null {\n    return document.querySelector(`section.hide-section[data-section-name=\"${key}\"]`);\n  }\n\n  hide(key:string) {\n    this.displayed.doModify(displayed => displayed.filter(el => el !== key));\n    this.toggleVisibility(key, false);\n  }\n\n  show(key:string) {\n    this.displayed.doModify(displayed => [...displayed, key]);\n    this.toggleVisibility(key, true);\n  }\n\n  private toggleVisibility(key:string, visible:boolean) {\n    const section = this.section(key);\n\n    if (section) {\n      section.hidden = !visible;\n    }\n  }\n\n  private removeHiddenOnSubmit() {\n    jQuery(document.body)\n      .on('submit', 'form', function(evt:any) {\n        const form = jQuery(this);\n        const sections = form.find('section.hide-section:hidden');\n\n        if (form.data('hideSectionRemoved') || sections.length === 0) {\n          return true;\n        }\n\n        form.data('hideSectionRemoved', true);\n        sections.remove();\n        form.trigger('submit');\n        evt.preventDefault();\n        return false;\n      });\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit} from \"@angular/core\";\nimport {HideSectionService} from \"core-app/modules/common/hide-section/hide-section.service\";\n\nexport const hideSectionLinkSelector = 'hide-section-link';\n\n@Component({\n  selector: hideSectionLinkSelector,\n  templateUrl: './hide-section-link.component.html',\n})\nexport class HideSectionLinkComponent implements OnInit {\n  displayed:boolean = true;\n\n  public sectionName:string;\n\n  constructor(protected elementRef:ElementRef,\n              protected hideSectionService:HideSectionService) {}\n\n  ngOnInit():void {\n    this.sectionName = this.elementRef.nativeElement.dataset.sectionName;\n  }\n\n  hideSection() {\n    this.hideSectionService.hide(this.sectionName);\n    return false;\n  }\n}\n","<accessible-by-keyboard\n    (execute)=\"hideSection()\"\n    linkTitle=\"Remove\"\n    linkAriaLabel=\"Remove\">\n  <op-icon icon-classes=\"icon-close icon-small\" icon-title=\"Remove\"></op-icon>\n</accessible-by-keyboard>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {HideSectionService} from \"./hide-section.service\";\nimport {Component, ElementRef, OnInit} from \"@angular/core\";\n\nexport const showSectionDropdownSelector = 'show-section-dropdown';\n\n@Component({\n  selector: showSectionDropdownSelector,\n  template: ''\n})\nexport class ShowSectionDropdownComponent implements OnInit {\n  public optValue:string;           // value of option for which hide-section should be visible\n  public hideSecWithName:string;    // section-name of hide-section\n\n  constructor(private HideSectionService:HideSectionService,\n              private elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    const element = jQuery(this.elementRef.nativeElement);\n    this.optValue = element.data('optValue');\n    this.hideSecWithName = element.data('hideSecWithName');\n\n    const target = jQuery(this.elementRef.nativeElement).prev();\n    target.on('change', event => {\n      let selectedOption = jQuery(\"option:selected\", event.target);\n\n      if (selectedOption.val() !== this.optValue) {\n        this.HideSectionService.hide(this.hideSecWithName);\n      } else {\n        this.HideSectionService.show(this.hideSecWithName);\n      }\n    });\n  }\n}\n\n\n","<select [id]=\"htmlId\"\n        class=\"form--select\"\n        (change)=\"show($event.target.value)\">\n  <option #fallbackOption value='' [textContent]=\"placeholder\" selected disabled></option>\n  <option *ngFor=\"let entry of selectable; trackByKey\" [value]=\"entry.key\" [textContent]=\"entry.label\"></option>\n</select>\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Component, ElementRef, OnInit, ViewChild} from \"@angular/core\";\nimport {HideSectionDefinition, HideSectionService} from \"core-app/modules/common/hide-section/hide-section.service\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const addSectionDropdownSelector = 'add-section-dropdown';\n\n@Component({\n  selector: addSectionDropdownSelector,\n  templateUrl: './add-section-dropdown.component.html'\n})\nexport class AddSectionDropdownComponent extends UntilDestroyedMixin implements OnInit {\n  @ViewChild('fallbackOption', { static: true }) private option:ElementRef;\n\n  trackByKey = AngularTrackingHelpers.trackByProperty('key');\n\n  selectable:HideSectionDefinition[] = [];\n  active:string[] = [];\n\n  public htmlId:string;\n  public placeholder = this.I18n.t('js.placeholders.selection');\n\n  constructor(protected hideSectionService:HideSectionService,\n              protected elementRef:ElementRef,\n              protected I18n:I18nService) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.htmlId = this.elementRef.nativeElement.dataset.htmlId;\n\n    this.hideSectionService\n      .displayed\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      ).subscribe(displayed => {\n      this.selectable = this.hideSectionService.all\n        .filter(el => displayed.indexOf(el.key) === -1)\n        .sort((a, b) => a.label.localeCompare(b.label));\n\n      (this.option.nativeElement as HTMLOptionElement).selected = true;\n    });\n  }\n\n  show(value:string) {\n    this.hideSectionService.show(value);\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit, ViewChild} from '@angular/core';\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\n\ntype SelectItem = { label:string, value:string, selected?:boolean };\n\nexport const autocompleteSelectDecorationSelector = 'autocomplete-select-decoration';\n\n@Component({\n  template: `\n    <ng-select [items]=\"options\"\n               [labelForId]=\"labelForId\"\n               bindLabel=\"label\"\n               [multiple]=\"multiselect\"\n               [virtualScroll]=\"true\"\n               [ngModel]=\"selected\"\n               appendTo=\"body\"\n               placeholder=\"Please select\"\n               (ngModelChange)=\"updateSelection($event)\">\n      <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\">\n        {{ item.label }}\n      </ng-template>\n    </ng-select>\n  `,\n  selector: autocompleteSelectDecorationSelector\n})\nexport class AutocompleteSelectDecorationComponent implements OnInit {\n  @ViewChild(NgSelectComponent) public ngSelectComponent:NgSelectComponent;\n\n  public options:SelectItem[];\n\n  /** Whether we're a multiselect */\n  public multiselect:boolean = false;\n\n  /** Get the selected options */\n  public selected:SelectItem|SelectItem[];\n\n  /** The input name we're syncing selections to */\n  private syncInputFieldName:string;\n\n  /** The input id used for label */\n  public labelForId:string;\n\n  constructor(protected elementRef:ElementRef) {\n  }\n\n  ngOnInit() {\n    const element = this.elementRef.nativeElement;\n\n    // Set options\n    this.multiselect = element.dataset.multiselect === 'true';\n    this.labelForId = element.dataset.inputId!;\n\n    // Get the sync target\n    this.syncInputFieldName = element.dataset.inputName;\n    // Add Rails multiple identifier if multiselect\n    if (this.multiselect) {\n      this.syncInputFieldName += '[]';\n    }\n\n    // Prepare and build the options\n    // Expected array of objects with id, name, select\n    const data:SelectItem[] = JSON.parse(element.dataset.options);\n\n    // Set initial selection\n    this.setInitialSelection(data);\n\n    if (!this.multiselect) {\n      this.selected = (this.selected as SelectItem[])[0];\n    }\n\n    this.options = data;\n\n    // Unhide the parent\n    element.parentElement.hidden = false;\n  }\n\n  setInitialSelection(data:SelectItem[]) {\n    this.updateSelection(data.filter(element => element.selected));\n  }\n\n  updateSelection(items:SelectItem|SelectItem[]) {\n    this.selected = items;\n    items = _.castArray(items) as SelectItem[];\n\n    this.removeCurrentSyncedFields();\n    items.forEach((el:SelectItem) => {\n      this.createSyncedField(el.value);\n    });\n  }\n\n  createSyncedField(value:string) {\n    const element = jQuery(this.elementRef.nativeElement);\n    element\n      .parent()\n      .append(`<input type=\"hidden\" name=\"${this.syncInputFieldName || ''}\" value=\"${value}\" />`);\n  }\n\n  removeCurrentSyncedFields() {\n    const element = jQuery(this.elementRef.nativeElement);\n    element\n      .parent()\n      .find(`input[name=\"${this.syncInputFieldName}\"]`)\n      .remove();\n  }\n}\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  Component,\n  ElementRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\nimport {StateService} from '@uirouter/core';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {ScrollableTabsComponent} from \"core-app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component\";\n\n\nexport const contentTabsSelector = 'content-tabs';\n\ninterface GonTab {\n  name:string;\n  partial:string;\n  path:string;\n  label:string;\n}\n\n@Component({\n  selector: 'content-tabs',\n  templateUrl: '/app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class ContentTabsComponent extends ScrollableTabsComponent {\n  public gonTabs:GonTab[];\n  public currentTab:GonTab;\n\n  public classes:string[] = ['content--tabs', 'scrollable-tabs'];\n\n  constructor(readonly elementRef:ElementRef,\n              readonly $state:StateService,\n              readonly gon:GonService,\n              readonly I18n:I18nService) {\n    super();\n\n    this.gonTabs = JSON.parse((this.gon.get('contentTabs') as any).tabs);\n    this.currentTab = JSON.parse((this.gon.get('contentTabs') as any).selected);\n\n    // parse tabs from backend and map them to scrollable tabs structure\n    this.tabs = this.gonTabs.map((tab:GonTab) => {\n      return {\n        id: tab.name,\n        name: this.I18n.t('js.' + tab.label),\n        path: tab.path\n      };\n    });\n\n    // highlight current tab\n    this.currentTabId = this.currentTab.name;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\n\nimport {Component, ElementRef, OnInit} from \"@angular/core\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {ConfigurationService} from \"core-app/modules/common/config/configuration.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport const copyToClipboardSelector = 'copy-to-clipboard';\n\n@Component({\n  template: '',\n  selector: copyToClipboardSelector\n})\nexport class CopyToClipboardDirective implements OnInit {\n  public clickTarget:string;\n  public clipboardTarget:string;\n  private target:JQuery;\n\n  constructor(readonly NotificationsService:NotificationsService,\n              readonly elementRef:ElementRef,\n              readonly I18n:I18nService,\n              readonly ConfigurationService:ConfigurationService) {\n  }\n\n  ngOnInit() {\n    const element = this.elementRef.nativeElement;\n    // Get inputs as attributes since this is a bootstrapped directive\n    this.clickTarget = element.getAttribute('click-target');\n    this.clipboardTarget = element.getAttribute('clipboard-target');\n\n    jQuery(this.clickTarget).on('click', (evt:JQuery.TriggeredEvent) => this.onClick(evt));\n\n    element.classList.add('copy-to-clipboard');\n    this.target = jQuery(this.clipboardTarget ? this.clipboardTarget : element);\n  }\n\n  addNotification(type:'addSuccess'|'addError', message:string) {\n    let notification = this.NotificationsService[type](message);\n\n    // Remove the notification some time later\n    setTimeout(() => this.NotificationsService.remove(notification), 5000);\n  }\n\n  onClick($event:JQuery.TriggeredEvent) {\n    var supported = (document.queryCommandSupported && document.queryCommandSupported('copy'));\n    $event.preventDefault();\n\n    // At least select the input for the user\n    // even when clipboard API not supported\n    this.target.select().focus();\n\n    if (supported) {\n      try {\n        // Copy it to the clipboard\n        if (document.execCommand('copy')) {\n          this.addNotification('addSuccess', this.I18n.t('js.clipboard.copied_successful'));\n          return;\n        }\n      } catch (e) {\n        console.log(\n          'Your browser seems to support the clipboard API, but copying failed: ' + e\n        );\n      }\n    }\n\n    this.addNotification('addError', this.I18n.t('js.clipboard.browser_error'));\n  }\n}\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ConfirmDialogService} from './../confirm-dialog/confirm-dialog.service';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Component, ElementRef, OnInit} from \"@angular/core\";\n\nexport const confirmFormSubmitSelector = 'confirm-form-submit';\n\n@Component({\n  template: '',\n  selector: confirmFormSubmitSelector\n})\nexport class ConfirmFormSubmitController implements OnInit {\n\n  // Allow original form submission after dialog was closed\n  public confirmed = false;\n  public text = {\n    title: this.I18n.t('js.modals.form_submit.title'),\n    text: this.I18n.t('js.modals.form_submit.text')\n  };\n\n  private $element:JQuery<HTMLElement>;\n  private $form:JQuery<HTMLElement>;\n\n  constructor(readonly element:ElementRef,\n              readonly confirmDialog:ConfirmDialogService,\n              readonly I18n:I18nService) {\n  }\n\n  ngOnInit() {\n    this.$element = jQuery<HTMLElement>(this.element.nativeElement);\n\n    if (this.$element.is('form')) {\n      this.$form = this.$element;\n    } else {\n      this.$form = this.$element.closest('form');\n    }\n\n    this.$form.on('submit', (evt) => {\n      if (!this.confirmed) {\n        evt.preventDefault();\n        this.openConfirmationDialog();\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  public openConfirmationDialog() {\n    this.confirmDialog.confirm({\n      text: this.text,\n      closeByEscape: true,\n      showClose: true,\n      closeByDocument: true,\n    }).then(() => {\n        this.confirmed = true;\n        this.$form.trigger('submit');\n      })\n      .catch(() => this.confirmed = false);\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectorRef, Component, ElementRef, OnInit} from '@angular/core';\nimport {distinctUntilChanged} from 'rxjs/operators';\nimport {ResizeDelta} from \"core-app/modules/common/resizer/resizer.component\";\nimport {MainMenuToggleService} from \"core-components/main-menu/main-menu-toggle.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const mainMenuResizerSelector = 'main-menu-resizer';\n\n@Component({\n  selector: mainMenuResizerSelector,\n  template: `\n    <resizer class=\"main-menu--resizer\"\n             [customHandler]=\"true\"\n             [cursorClass]=\"'col-resize'\"\n             (end)=\"resizeEnd()\"\n             (start)=\"resizeStart()\"\n             (move)=\"resizeMove($event)\">\n      <div class=\"resizer-toggle-container\">\n        <i [attr.title]=\"toggleTitle\"\n            class=\"main-menu--navigation-toggler\"\n            [ngClass]=\"{'open': toggleService.showNavigation}\"\n            (accessibleClick)=\"toggleService.toggleNavigation($event)\"></i>\n\n        <i class=\"icon-resizer-vertical-lines\"\n           aria-hidden=\"true\"></i>\n      </div>\n    </resizer>\n  `\n})\n\nexport class MainMenuResizerComponent extends UntilDestroyedMixin implements OnInit {\n  public toggleTitle:string;\n  private resizeEvent:string;\n  private localStorageKey:string;\n\n  private elementWidth:number;\n  private mainMenu = jQuery('#main-menu')[0];\n\n  public moving:boolean = false;\n\n  constructor(readonly toggleService:MainMenuToggleService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly elementRef:ElementRef) {\n    super();\n  }\n\n  ngOnInit() {\n    this.toggleService.titleData$\n      .pipe(\n        distinctUntilChanged(),\n        this.untilDestroyed()\n      )\n      .subscribe(setToggleTitle => {\n        this.toggleTitle = setToggleTitle;\n        this.cdRef.detectChanges();\n      });\n\n    this.resizeEvent = \"main-menu-resize\";\n    this.localStorageKey = \"openProject-mainMenuWidth\";\n  }\n\n  public resizeStart() {\n    this.elementWidth = this.mainMenu.clientWidth;\n  }\n\n  public resizeMove(deltas:ResizeDelta) {\n    this.toggleService.saveWidth(this.elementWidth + deltas.absolute.x);\n  }\n\n  public resizeEnd() {\n    const event = new Event(this.resizeEvent);\n    window.dispatchEvent(event);\n  }\n}\n","<div class=\"top-menu-search\">\n    <a *ngIf=\"expanded\"\n       (click)=\"toggleMobileSearch()\"\n       class=\"top-menu-search--back-button\"\n       href=\"#\"\n       title=\"{{text.close_search}}\">\n      <i class=\"icon-arrow-left1\" aria-hidden=\"true\"></i>\n    </a>\n    <ng-select #select\n              [items]=\"requests.output$ | async\"\n              name=\"global-search-input\"\n              id=\"global-search-input\"\n              placeholder=\"{{text.search_dots}}\"\n              accesskey=\"4\"\n              [ngClass]=\"{'top-menu-search--input': true, '-markable': markable }\"\n              [(ngModel)]=\"selectedItem\"\n              [class.-expanded]=\"expanded\"\n              [openOnEnter]=\"false\"\n              [searchFn]=\"customSearchFn\"\n              [typeahead]=\"requests.input$\"\n              [loading]=\"requests.loading$ | async\"\n              (focus)=\"onFocus()\"\n              (blur)=\"onFocusOut()\"\n              (search)=\"search($event)\"\n              (open)=\"openCloseMenu(currentValue)\"\n              (close)=\"select.searchTerm = currentValue\"\n              (change)=\"followSelectedItem()\"\n              (keydown.enter)=\"onEnterBeforeResultsLoaded()\"\n              (keydown.escape)=\"blur()\"\n              (clear)=\"clearSearch()\">\n        <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\" let-search=\"searchTerm\">\n          <div *ngIf=\"!item.id; else workPackageItemTemplate\">\n            <div tabindex=\"-1\" class=\"global-search--option\"(click)=\"followItem(item)\">\n              <div class=\"global-search--option-wrapper\">\n                <span class=\"global-search--search-term\"> {{currentValue}} </span>\n                <span class=\"global-search--project-scope\" title=\"{{item.projectScope}}\"> {{item.text}} ↵ </span>\n              </div>\n            </div>\n          </div>\n          <ng-template #workPackageItemTemplate>\n            <div tabindex=\"-1\" class=\"global-search--option\" (click)=\"redirectToWp(item.id, $event)\">\n              <a class=\"global-search--option-wrapper\"\n                 [href]=\"wpPath(item.id)\">\n                <span class=\"global-search--wp-id\"\n                      title=\"{{item.status}}\"\n                      [ngOptionHighlight]=\"currentValue\"\n                      [ngClass]=\"statusHighlighting(item.statusId)\"> #{{item.id}} </span>\n                <span class=\"global-search--wp-subject\" [ngOptionHighlight]=\"currentValue\"> {{item.subject}} </span>\n              </a>\n            </div>\n        </ng-template>\n      </ng-template>\n    </ng-select>\n    <a #btn\n       id=\"top-menu-search-button\"\n       class=\"top-menu-search--button search-form-normal\"\n       title=\"{{text.search}}\"\n       tabindex=\"0\"\n       role=\"button\"\n       [class.-input-focused]=\"expanded\"\n       (accessibleClick)=\"handleClick($event)\">\n       <op-icon icon-classes=\"icon5 icon-search ellipsis\"></op-icon>\n    </a>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {ContainHelpers} from 'core-app/modules/common/focus/contain-helpers';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {CollectionResource} from \"core-app/modules/hal/resources/collection-resource\";\nimport {GlobalSearchService} from \"core-app/modules/global_search/services/global-search.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {DeviceService} from \"core-app/modules/common/browser/device.service\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {Observable, of} from \"rxjs\";\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {map, tap, take, filter} from \"rxjs/internal/operators\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {DebouncedRequestSwitchmap, errorNotificationHandler} from \"core-app/helpers/rxjs/debounced-input-switchmap\";\nimport {LinkHandling} from \"core-app/modules/common/link-handling/link-handling\";\n\nexport const globalSearchSelector = 'global-search-input';\n\ninterface SearchResultItem {\n  id:string;\n  subject:string;\n  status:string;\n  statusId:string;\n  $href:string;\n}\n\ninterface SearchOptionItem {\n  projectScope:string;\n  text:string;\n}\n\n@Component({\n  selector: globalSearchSelector,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './global-search-input.component.html',\n  styleUrls: ['./global-search-input.component.sass', \"./global-search-input-mobile.component.sass\"],\n  // Necessary because of ng-select\n  encapsulation: ViewEncapsulation.None\n})\nexport class GlobalSearchInputComponent implements OnInit, OnDestroy {\n  @ViewChild('btn', { static: true }) btn:ElementRef;\n  @ViewChild(NgSelectComponent, { static: true }) public ngSelectComponent:NgSelectComponent;\n\n  public expanded:boolean = false;\n  public markable = false;\n\n  /** Keep a switchmap for search term and loading state */\n  public requests = new DebouncedRequestSwitchmap<string, SearchResultItem|SearchOptionItem>(\n    (searchTerm:string) => this.autocompleteWorkPackages(searchTerm).pipe(\n      tap(() => {\n        setTimeout(() => this.setMarkedOption(), 50);\n      })\n    ),\n    errorNotificationHandler(this.halNotification)\n  );\n\n  /** Remember the current value */\n  public currentValue:string = '';\n\n  /** Remember the item that best matches the query.\n   * That way, it will be highlighted (as we manually mark the selected item) and we can handle enter.\n   * */\n  public selectedItem:SearchResultItem|SearchOptionItem|null;\n\n  private unregisterGlobalListener:Function|undefined;\n\n  public text:{ [key:string]:string } = {\n    all_projects: this.I18n.t('js.global_search.all_projects'),\n    current_project: this.I18n.t('js.global_search.current_project'),\n    current_project_and_all_descendants: this.I18n.t('js.global_search.current_project_and_all_descendants'),\n    search: this.I18n.t('js.global_search.search'),\n    search_dots: this.I18n.t('js.global_search.search') + ' ...',\n    close_search: this.I18n.t('js.global_search.close_search')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              readonly I18n:I18nService,\n              readonly PathHelperService:PathHelperService,\n              readonly halResourceService:HalResourceService,\n              readonly globalSearchService:GlobalSearchService,\n              readonly currentProjectService:CurrentProjectService,\n              readonly deviceService:DeviceService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly halNotification:HalResourceNotificationService) {\n  }\n\n  ngOnInit() {\n    // check searchterm on init, expand / collapse search bar and set correct classes\n    this.ngSelectComponent.searchTerm = this.currentValue = this.globalSearchService.searchTerm;\n    this.expanded = (this.ngSelectComponent.searchTerm.length > 0);\n    this.toggleTopMenuClass();\n  }\n\n  ngOnDestroy() {\n    this.unregister();\n  }\n\n  // detect if click is outside or inside the element\n  @HostListener('click', ['$event'])\n  public handleClick(event:JQuery.TriggeredEvent):void {\n    event.stopPropagation();\n    event.preventDefault();\n\n    // handle click on search button\n    if (ContainHelpers.insideOrSelf(this.btn.nativeElement, event.target)) {\n      if (this.deviceService.isMobile) {\n        this.toggleMobileSearch();\n        // open ng-select menu on default\n        jQuery('.ng-input input').focus();\n      } else if (this.ngSelectComponent.searchTerm.length === 0) {\n        this.ngSelectComponent.focus();\n      } else {\n        this.submitNonEmptySearch();\n      }\n    }\n  }\n\n  // open or close mobile search\n  public toggleMobileSearch() {\n    this.expanded = !this.expanded;\n    this.toggleTopMenuClass();\n  }\n\n  public redirectToWp(id:string, event:JQuery.TriggeredEvent) {\n    event.stopImmediatePropagation();\n    if (LinkHandling.isClickedWithModifier(event)) {\n      return true;\n    }\n\n    window.location.href = this.wpPath(id);\n    event.preventDefault();\n    return false;\n  }\n\n  public wpPath(id:string) {\n    return this.PathHelperService.workPackagePath(id);\n  }\n\n  public search($event:any) {\n    this.currentValue = this.ngSelectComponent.searchTerm;\n    this.openCloseMenu($event.term);\n  }\n\n  // close menu when input field is empty\n  public openCloseMenu(searchedTerm:string) {\n    this.ngSelectComponent.isOpen = (searchedTerm.trim().length > 0);\n  }\n\n  public onFocus() {\n    this.expanded = true;\n    this.toggleTopMenuClass();\n    this.openCloseMenu(this.currentValue);\n  }\n\n  public onFocusOut() {\n    if (!this.deviceService.isMobile) {\n      this.expanded = (this.ngSelectComponent.searchTerm.length > 0);\n      this.ngSelectComponent.isOpen = false;\n      this.toggleTopMenuClass();\n    }\n  }\n\n  public clearSearch() {\n    this.currentValue = this.ngSelectComponent.searchTerm = '';\n    this.openCloseMenu(this.currentValue);\n  }\n\n  // If Enter key is pressed before result list is loaded, wait for the results to come\n  // in and then decide what to do. If a direct hit is present, follow that. Otherwise,\n  // go to the search in the current scope.\n  public onEnterBeforeResultsLoaded() {\n    this.requests.loading$.pipe(\n        filter(value => value === false),\n        take(1)\n      )\n      .subscribe(() => {\n        if (this.selectedItem) {\n          this.followSelectedItem();\n        } else {\n          this.searchInScope(this.currentScope);\n        }\n      });\n  }\n\n  public statusHighlighting(statusId:string) {\n    return Highlighting.inlineClass('status', statusId);\n  }\n\n  private get isDirectHit() {\n    return this.selectedItem && this.selectedItem.hasOwnProperty('id');\n  }\n\n  public followItem(item:SearchResultItem|SearchOptionItem) {\n    if (item.hasOwnProperty('id')) {\n      window.location.href = this.wpPath((item as SearchResultItem).id);\n    } else {\n      // update embedded table and title when new search is submitted\n      this.globalSearchService.searchTerm = this.currentValue;\n      this.searchInScope((item as SearchOptionItem).projectScope);\n    }\n  }\n\n  public followSelectedItem() {\n    if (this.selectedItem) {\n      this.followItem(this.selectedItem);\n    }\n  }\n\n  // return all project scope items and all items which contain the search term\n  public customSearchFn(term:string, item:any):boolean {\n    return item.id === undefined || item.subject.toLowerCase().indexOf(term.toLowerCase()) !== -1;\n  }\n\n  private autocompleteWorkPackages(query:string):Observable<(SearchResultItem|SearchOptionItem)[]> {\n    if (!query) {\n      return of([]);\n    }\n\n    // Reset the currently selected item.\n    // We do not follow the typical goal of an autocompleter of \"setting a value\" here.\n    this.selectedItem = null;\n    // Hide highlighting of ng-option\n    this.markable = false;\n\n\n    let hashFreeQuery = this.queryWithoutHash(query);\n\n    return this.fetchSearchResults(hashFreeQuery, hashFreeQuery !== query)\n      .pipe(\n        map((collection) => {\n          return this.searchResultsToOptions(collection.elements, hashFreeQuery);\n        })\n      );\n  }\n\n  // Remove ID marker # when searching for #<number>\n  private queryWithoutHash(query:string) {\n    if (query.match(/^#(\\d+)/)) {\n      return query.substr(1);\n    } else {\n      return query;\n    }\n  }\n\n  private fetchSearchResults(query:string, idOnly:boolean) {\n    let href:string = this.PathHelperService.api.v3.wpBySubjectOrId(query, idOnly);\n\n    return this.halResourceService\n      .get<CollectionResource<WorkPackageResource>>(href);\n\n  }\n\n  private searchResultsToOptions(results:WorkPackageResource[], query:string) {\n    let searchItems = results.map((wp) => {\n      let item =  {\n        id: wp.id!,\n        subject: wp.subject,\n        status: wp.status.name,\n        statusId: wp.status.idFromLink,\n        $href: wp.$href\n      } as SearchResultItem;\n\n      // If we have a direct hit, we choose it to be the selected element.\n      if (query === wp.id!.toString()) {\n        this.selectedItem = item;\n      }\n\n      return item;\n    });\n\n    let searchOptions = this.detailedSearchOptions();\n\n    if (!this.selectedItem) {\n      this.selectedItem = searchOptions[0];\n    }\n\n    return (searchOptions as (SearchResultItem|SearchOptionItem)[]).concat(searchItems);\n  }\n\n  // set the possible 'search in scope' options for the current project path\n  private detailedSearchOptions() {\n    let searchOptions = [];\n    // add all options when searching within a project\n    // otherwise search in 'all projects'\n    if (this.currentProjectService.path) {\n      searchOptions.push('current_project_and_all_descendants');\n      searchOptions.push('current_project');\n    }\n    if (this.globalSearchService.projectScope === 'current_project') {\n      searchOptions.reverse();\n    }\n    searchOptions.push('all_projects');\n\n    return searchOptions.map((suggestion:string) => {\n      return { projectScope: suggestion, text: this.text[suggestion] };\n    });\n  }\n\n  /*\n   * Set the marked ng-option within ng-select and apply the class to highlight marked options.\n   *\n   * ng-select differentiates between the selected and the marked option. The selected optinon is the option\n   * that is binded via ng-model. The marked option is the one that the user is currently selecting (via mouse or keyboard up/down).\n   * When hitting enter, the marked option is taken to be the new selected option. Ng-select will retain the index of the marked\n   * option between individual searches. The selected option has no influence on the marked option. This is problematic\n   * in our use case as the user might have:\n   *   * the mouse hovering (deliberately or not) over the search options which will mark that option.\n   *   * marked an option for a previous search but might then have decided to add/remove additional characters to the search.\n   *\n   * In both cases, whenever the user presses enter then, ng-select assigns the marked option to the ng-model.\n   *\n   * Our goal however is to either:\n   *  * mark the direct hit (id matches) if it available\n   *  * mark the first item if there is no direct hit\n   *\n   * And we need to update the marked option after every search.\n   *\n   * There is no way of doing this via the interface provided in the template. There is only [markFirst] and it neither allows us\n   * to mark a direct hit, nor does it reset after a search. We handle this then by selecting the desired element once the\n   * search results are back. We then set the marked option to be the selected option.\n   *\n   * In order to avoid flickering, a -markable modifyer class is unset/set before/after searching. This will unset the background until we\n   * have marked the element we wish to.\n   */\n  private setMarkedOption() {\n    this.markable = true;\n    this.ngSelectComponent.itemsList.markItem(this.ngSelectComponent.itemsList.selectedItems[0]);\n\n    this.cdRef.detectChanges();\n  }\n\n  private searchInScope(scope:string) {\n    switch (scope) {\n      case 'all_projects': {\n        let forcePageLoad = false;\n        if (this.globalSearchService.projectScope !== 'all') {\n          forcePageLoad = true;\n          this.globalSearchService.resultsHidden = true;\n        }\n        this.globalSearchService.projectScope = 'all';\n        this.submitNonEmptySearch(forcePageLoad);\n        break;\n      }\n      case 'current_project': {\n        this.globalSearchService.projectScope = 'current_project';\n        this.submitNonEmptySearch();\n        break;\n      }\n      case 'current_project_and_all_descendants': {\n        this.globalSearchService.projectScope = '';\n        this.submitNonEmptySearch();\n        break;\n      }\n    }\n  }\n\n  public submitNonEmptySearch(forcePageLoad:boolean = false) {\n    this.globalSearchService.searchTerm = this.currentValue;\n    if (this.currentValue.length > 0) {\n      this.ngSelectComponent.close();\n      // Work package results can update without page reload.\n      if (!forcePageLoad &&\n        this.globalSearchService.isAfterSearch() &&\n        this.globalSearchService.currentTab === 'work_packages') {\n        window.history\n          .replaceState({},\n            `${I18n.t('global_search.search')}: ${this.ngSelectComponent.searchTerm}`,\n            this.globalSearchService.searchPath());\n\n        return;\n      }\n      this.globalSearchService.submitSearch();\n    }\n  }\n\n  public blur() {\n    this.ngSelectComponent.searchTerm = '';\n    (<HTMLInputElement>document.activeElement).blur();\n  }\n\n  private get currentScope():string {\n    let serviceScope = this.globalSearchService.projectScope;\n    return (serviceScope === '') ? 'current_project_and_all_descendants' : serviceScope;\n  }\n\n  private unregister() {\n    if (this.unregisterGlobalListener) {\n      this.unregisterGlobalListener();\n      this.unregisterGlobalListener = undefined;\n    }\n  }\n\n  private toggleTopMenuClass() {\n    jQuery('#top-menu').toggleClass('-global-search-expanded', this.expanded);\n  }\n}\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\n\nimport {Component, ElementRef, OnInit, ViewChild} from \"@angular/core\";\n\nexport const collapsibleSectionAugmentSelector = 'collapsible-section-augment';\n\n@Component({\n  selector: collapsibleSectionAugmentSelector,\n  templateUrl: './collapsible-section.html'\n})\nexport class CollapsibleSectionComponent implements OnInit {\n  public expanded:boolean = false;\n  public sectionTitle:string;\n\n  @ViewChild('sectionBody', { static: true }) public sectionBody:ElementRef;\n\n  constructor(public elementRef:ElementRef) {\n  }\n\n  ngOnInit():void {\n    const element:HTMLElement = this.elementRef.nativeElement;\n\n    this.sectionTitle = element.getAttribute('section-title')!;\n    if (element.getAttribute('initially-expanded') === 'true') {\n      this.expanded = true;\n    }\n\n    const target:HTMLElement = element.nextElementSibling as HTMLElement;\n    this.sectionBody.nativeElement.appendChild(target);\n    target.removeAttribute('hidden');\n  }\n\n  public toggle() {\n    this.expanded = !this.expanded;\n  }\n}\n","<section class=\"collapsible-section\"\n         [ngClass]=\"{ '-expanded': expanded }\">\n\n  <accessible-by-keyboard (execute)=\"toggle()\"\n                          [linkAriaLabel]=\"sectionTitle\"\n                          linkClass=\"collapsible-section--toggle-link\"\n                          spanClass=\"collapsible-section--legend\">\n    <span [textContent]=\"sectionTitle\"></span>\n  </accessible-by-keyboard>\n  <div class=\"collapsible-section--body toggle-slide-animation\"\n       #sectionBody\n       [hidden]=\"!expanded\">\n    <!-- Wrapped by component -->\n  </div>\n</section>\n","import {Component, ElementRef, OnInit} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\nexport const enterpriseBannerSelector = 'enterprise-banner-bootstrap';\n\n@Component({\n  selector: enterpriseBannerSelector,\n  template: `\n    <enterprise-banner\n      [textMessage]=\"textMessage\"\n      [linkMessage]=\"linkMessage\"\n      [opReferrer]=\"referrer\">\n    </enterprise-banner>\n  `\n})\nexport class EnterpriseBannerBootstrapComponent implements OnInit {\n  public textMessage:string;\n  public linkMessage:string;\n  public referrer:string;\n\n  constructor(protected elementRef:ElementRef,\n              protected i18n:I18nService) {\n  }\n\n  ngOnInit() {\n    let $element = jQuery(this.elementRef.nativeElement);\n\n    this.textMessage = $element.attr('text-message')!;\n    this.linkMessage = $element.attr('link-message') || this.i18n.t('js.work_packages.table_configuration.upsale.check_out_link');\n    this.referrer = $element.attr('referrer')!;\n  }\n}\n","import * as Fuse from 'fuse.js';\n\nexport interface IAutocompleteItem<T> {\n  label:string;\n  render:'match' | 'disabled';\n  object:T;\n}\n\nexport abstract class ILazyAutocompleterBridge<T> {\n  // Current page the autocompleter is on\n  public currentPage:number;\n\n  // Input autocomplete element\n  public input:any;\n\n  // Fuzzy instance for the results\n  public fuseInstance:any;\n\n  public constructor(public widgetName:string) {\n    LazyLoadedAutocompleter.register(widgetName, this);\n  }\n\n  /**\n   * Return the maximum number of items to render in this page.\n   * Note that for this value, the container must be setup that a scrollbar exists.\n   * @returns {number}\n   */\n  public abstract get maxItemsPerPage():number;\n\n  /**\n   * Handler function for when an active item was selected through the autocompleter\n   * @param {T} item\n   */\n  public abstract onItemSelected(item:T):void;\n\n  /**\n   *  Handler function for when no results were matched through the search term.\n   * @param {JQueryUI.AutocompleteEvent} event\n   * @param {JQueryUI.AutocompleteUIParams} ui\n   */\n  public abstract onNoResultsFound(event:JQueryUI.AutocompleteEvent, ui:any):void;\n\n  /**\n   * Customize the rendering of an inner item element.\n   *\n   * @param {IAutocompleteItem} item\n   * @param {JQuery} div\n   */\n  public renderItem(item:IAutocompleteItem<T>, div:JQuery):void {\n    div.text(item.label);\n  }\n\n  /**\n   * Returns the elements matched by the fuzzy search\n   */\n  private fuzzySearch(items:IAutocompleteItem<T>[], term:string) {\n    if (term === '') {\n      return items;\n    } else if (term.length >= 3) {\n      const literalMatches = this.literalSearch(items, term);\n\n      if (literalMatches.length > 0) {\n        return literalMatches as any;\n      }\n    }\n\n    return this.fuseInstance.search(term);\n  }\n\n  /**\n   * Filters the given list of items so that only items whose label contains\n   * the exact search term (case insensitive).\n   *\n   * @param items Items to be searched\n   * @param term Search term\n   * @return The subset of the given items matching the search term.\n   */\n  private literalSearch(items:IAutocompleteItem<T>[], term:string) {\n    const results:IAutocompleteItem<T>[] = [];\n    const str:string = term.toLowerCase();\n\n    items.forEach(e => {\n      if (e.label.toLowerCase().indexOf(str) !== -1) {\n        results.push(e);\n      }\n    });\n\n    return results;\n  }\n\n  /**\n   * Allows to augment the set of matched items (e.g., to add hierarchy).\n   * @param {IAutocompleteItem<T>[]} items\n   * @param {IAutocompleteItem<T>[]} matched\n   * @returns {IAutocompleteItem<T>[]}\n   */\n  protected augmentedResultSet(items:IAutocompleteItem<T>[], matched:IAutocompleteItem<T>[]) {\n    // By default, set all to match\n    const results:IAutocompleteItem<T>[] = [];\n\n    matched.forEach(el => {\n      results.push({\n        label: el.label,\n        object: el.object,\n        render: 'match'\n      } as IAutocompleteItem<T>);\n    });\n\n    return results;\n  }\n\n  public setup(input:JQuery, items:IAutocompleteItem<T>[]) {\n    this.currentPage = 0;\n    this.input = input;\n    this.input[this.widgetName].call(this.input, this.setupParams(items));\n    const options = {\n      shouldSort: true,\n      tokenize: false,\n      threshold: 0.2,\n      location: 0,\n      distance: 10000, // allow the term to appear anywhere\n      maxPatternLength: 16,\n      minMatchCharLength: 2,\n      keys: ['label'] as any\n    };\n\n    this.fuseInstance = new Fuse(items, options);\n  }\n\n  protected setupParams(autocompleteValues:IAutocompleteItem<T>[]) {\n    const ctrl = this;\n\n    return {\n      delay: 50,\n      source: function (request:any, response:any) {\n        const fuzzyResults = ctrl.fuzzySearch(autocompleteValues, request.term);\n        response(ctrl.augmentedResultSet(autocompleteValues, fuzzyResults));\n      },\n      select: (ul:any, selected:{ item:IAutocompleteItem<T> }) => {\n        if (selected.item.render === 'match') {\n          ctrl.onItemSelected(selected.item.object);\n        }\n      },\n      create: () => ctrl.input.focus(),\n      response: (event:JQueryUI.AutocompleteEvent, ui:JQueryUI.AutocompleteUIParams) => {\n        ctrl.onNoResultsFound(event, ui);\n      },\n      autoFocus: true,\n      minLength: 0\n    };\n  }\n}\n\nexport namespace LazyLoadedAutocompleter {\n\n  /**\n   * Returns whether the scrollbar is at a place where we should display additional elements\n   * @param ul\n   */\n  function isScrollbarBottom(container:JQuery) {\n    var height = container.outerHeight()!;\n    var scrollHeight = container[0].scrollHeight;\n    var scrollTop = container.scrollTop()!;\n    return scrollTop >= (scrollHeight - height);\n  }\n\n  export function register<T>(name:string, ctrl:ILazyAutocompleterBridge<T>) {\n    jQuery.widget(`custom.${name}`, jQuery.ui.autocomplete, {\n      _create: function (this:any) {\n        ctrl.currentPage = 0;\n        this._super();\n        this.widget().menu('option', 'items', '> .ui-matched-item');\n        this._search('');\n      },\n\n      _renderMenu: function (this:any, ul:HTMLElement, items:IAutocompleteItem<T>[]) {\n        //remove scroll event to prevent attaching multiple scroll events to one container element\n        jQuery(ul).unbind('scroll');\n\n        this._renderLazyMenu(ul, items);\n      },\n\n      // Rener the menu for the current page\n      _renderMenuPage(this:any, ul:JQuery, items:IAutocompleteItem<T>[], page:number|null = null) {\n        let widget = this;\n        let rendered:number = items.length;\n        let pageElements = items;\n        let max = ctrl.maxItemsPerPage;\n        if (page !== null) {\n          pageElements = items.slice(page * max, (page * max) + max);\n          rendered = Math.min(items.length, (page * max) + max);\n        }\n\n        // Insert elements of this page\n        jQuery.each(pageElements, function (index, item) {\n          widget._renderItemData(ul, item);\n        });\n\n        // Ensure scrollbar is shown when more results exist\n        ul.css('height', 'auto');\n        if (rendered < items.length) {\n          const maxHeight = document.body.offsetHeight * 0.55;\n          const shownHeight = rendered * 32;\n\n          if (shownHeight < maxHeight) {\n            ul.css('height', shownHeight - 50);\n          }\n        }\n      },\n\n      /**\n       * Return the number of (lazy) pages for the curent set of results\n       * @param {IAutocompleteItem[]} items\n       * @returns {number}\n       */\n      _pages(items:IAutocompleteItem<T>[]):number {\n        return Math.ceil(items.length / ctrl.maxItemsPerPage);\n      },\n\n      _repositionMenu: function (this:any, container:JQuery) {\n        const widget = this;\n        const menu = widget.menu;\n\n        menu.refresh();\n\n        // Call ui's own resize\n        widget._resizeMenu();\n\n        container.position(jQuery.extend({of: widget.element}, widget.options.position));\n        if (widget.options.autoFocus) {\n          menu.next(new jQuery.Event('mouseover'));\n        }\n      },\n\n      _resizeMenu: function (this:any) {\n        var ul = this.menu.element;\n        ul.outerWidth(this.element.outerWidth());\n      },\n\n      _renderItem: function (this:any, ul:JQuery, item:IAutocompleteItem<T>) {\n        const term = this.element.val();\n        const disabled = item.render === 'disabled';\n        const div = jQuery('<div>').addClass('ui-menu-item-wrapper');\n\n        ctrl.renderItem(item, div);\n\n        const element = jQuery('<li>')\n          .toggleClass('ui-state-disabled', disabled)\n          .toggleClass('ui-matched-item', !disabled)\n          .append(div)\n          .appendTo(ul);\n\n        if (term !== '') {\n          (element as any).mark(term, {className: 'ui-autocomplete-match'});\n        }\n\n        return element;\n      },\n\n      _renderLazyMenu: function (this:any, ul:Element, items:IAutocompleteItem<T>[]) {\n        const widget = this;\n        const container = jQuery(ul) as JQuery;\n        const pages = this._pages(items);\n\n        if (pages <= 1) {\n          return widget._renderMenuPage(ul, items);\n        }\n\n        widget._renderMenuPage(ul, items, 0);\n\n        container.scroll(function () {\n          if (isScrollbarBottom(container)) {\n            if (++ctrl.currentPage >= pages) {\n              return;\n            }\n\n            // Render the current menu page\n            widget._renderMenuPage(ul, items, ctrl.currentPage);\n\n            // Refresh the menu\n            widget._repositionMenu(ul);\n          }\n        });\n      }\n    });\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {PathHelperService} from 'core-app/modules/common/path-helper/path-helper.service';\nimport {\n  IAutocompleteItem,\n  ILazyAutocompleterBridge\n} from 'core-app/modules/common/autocomplete/lazyloaded/lazyloaded-autocompleter';\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {LinkHandling} from 'core-app/modules/common/link-handling/link-handling';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HttpClient} from \"@angular/common/http\";\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, OnInit} from \"@angular/core\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\n\nexport interface IProjectMenuEntry {\n  id:number;\n  name:string;\n  identifier:string;\n  parents:IProjectMenuEntry[];\n  level:number;\n}\n\nexport type ProjectAutocompleteItem = IAutocompleteItem<IProjectMenuEntry>;\n\nexport const projectMenuAutocompleteSelector = 'project-menu-autocomplete';\n\n@Component({\n  templateUrl: './project-menu-autocomplete.template.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: projectMenuAutocompleteSelector\n})\nexport class ProjectMenuAutocompleteComponent extends ILazyAutocompleterBridge<IProjectMenuEntry> implements OnInit {\n  public text:any;\n\n  // The project dropdown menu\n  public dropdownMenu:JQuery;\n  // The project filter input\n  public input:JQuery;\n  // No results element\n  public noResults:JQuery;\n\n  // The result set for the instance, loaded only once\n  public results:null|IProjectMenuEntry[] = null;\n\n  private loaded = false;\n  private $element:JQuery;\n\n\n  constructor(protected PathHelper:PathHelperService,\n              protected elementRef:ElementRef,\n              protected http:HttpClient,\n              protected cdRef:ChangeDetectorRef,\n              protected I18n:I18nService,\n              protected currentProject:CurrentProjectService) {\n    super('projectMenuAutocomplete');\n\n    this.text = {\n      label: I18n.t('js.projects.autocompleter.label'),\n      no_results: I18n.t('js.notice_no_principals_found'),\n      loading: I18n.t('js.ajax.loading')\n    };\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n    this.dropdownMenu = this.$element.parents('li.drop-down');\n    this.input = this.$element.find('.project-menu-autocomplete--input');\n    this.noResults = this.$element.find('.project-menu-autocomplete--no-results');\n\n    this.dropdownMenu.on('opened', () => this.open());\n    this.dropdownMenu.on('closed', () => this.close());\n  }\n\n  public close() {\n    try {\n      (this.input as any).projectMenuAutocomplete('destroy');\n    } catch (e) {\n      console.warn(\"Failed to destroy autocomplete: %O\", e);\n    }\n    this.$element.find('.project-search-results').css('visibility', 'hidden');\n  }\n\n  public open() {\n    this.$element.find('.project-search-results').css('visibility', 'visible');\n    this.loadProjects().then((results:IProjectMenuEntry[]) => {\n      let autocompleteValues = _.map(results, project => {\n        return { label: project.name, render: 'match', object: project } as ProjectAutocompleteItem;\n      });\n\n      this.setup(this.input, autocompleteValues);\n      this.addInputHandlers();\n      this.addClickHandler();\n      this.loaded = true;\n      this.cdRef.detectChanges();\n\n      this.scrollCurrentProjectIntoView();\n    });\n  }\n\n  // Items per page to show before using lazy load\n  // Please note that the max-height of the container is relevant here.\n  public get maxItemsPerPage() {\n    return 250;\n  }\n\n  onItemSelected(project:IProjectMenuEntry):void {\n    window.location.href = this.projectLink(project.identifier);\n  }\n\n  onNoResultsFound(event:JQueryUI.AutocompleteEvent, ui:any):void {\n    // Show the noResults span if we don't have any matches\n    this.noResults.toggle(ui.content.length === 0);\n  }\n\n  public renderItem(item:ProjectAutocompleteItem, div:JQuery):void {\n    const link = jQuery('<a>')\n      .attr('href', this.projectLink(item.object.identifier))\n      .text(item.label)\n      .appendTo(div);\n\n    // When in hierarchy, indent\n    if (item.object.level > 0) {\n      link\n        .text(`» ${item.label}`)\n        .css('padding-left', (4 + item.object.level * 16) + 'px');\n    }\n\n    // Highlight selected project\n    if (item.object.identifier === this.currentProject.identifier) {\n      div.addClass('selected');\n    }\n  }\n\n  public projectLink(identifier:string) {\n    const currentMenuItem = jQuery('meta[name=\"current_menu_item\"]').attr('content');\n    let url = this.PathHelper.projectPath(identifier);\n\n    if (currentMenuItem) {\n      url += '?jump=' + encodeURIComponent(currentMenuItem);\n    }\n\n    return url;\n  }\n\n  public get loadingText():string {\n    if (this.loaded) {\n      return '';\n    } else {\n      return this.text.loading;\n    }\n  }\n\n  private loadProjects() {\n    if (this.results !== null) {\n      return Promise.resolve(this.results);\n    }\n\n    const url = this.PathHelper.projectLevelListPath();\n    return this.http\n      .get(url)\n      .toPromise()\n      .then((result:{ projects:any }) => {\n        return this.results = this.augmentWithParents(result.projects);\n      });\n  }\n\n  /**\n   * Augment the level_list with the set of parents that belong to this project\n   */\n  public augmentWithParents(projects:IProjectMenuEntry[]) {\n    const parents:IProjectMenuEntry[] = [];\n    let currentLevel = -1;\n\n    return projects.map((project) => {\n      while (currentLevel >= project.level) {\n        parents.pop();\n        currentLevel--;\n      }\n\n      parents.push(project);\n      currentLevel = project.level;\n      project.parents = parents.slice(0, -1); // make sure to pass a clone\n\n      return project;\n    });\n  }\n\n  /**\n   * Determines from the set of matched results, the elements we should render\n   * (ie. including the parents of the elements)\n   */\n  protected augmentedResultSet(items:ProjectAutocompleteItem[], matched:ProjectAutocompleteItem[]) {\n    const matches = matched.map(el => el.object.identifier);\n    const matchedParents = _.flatten(matched.map(el => el.object.parents));\n\n    const results:ProjectAutocompleteItem[] = [];\n\n    items.forEach(el => {\n      const identifier = el.object.identifier;\n      let renderType:'disabled'|'match';\n\n      if (matches.indexOf(identifier) >= 0) {\n        renderType = 'match';\n      } else if (_.find(matchedParents, e => e.identifier === identifier)) {\n        renderType = 'disabled';\n      } else {\n        return;\n      }\n\n      results.push({\n        label: el.label,\n        object: el.object,\n        render: renderType\n      });\n    });\n\n    return results;\n  }\n\n  /**\n   * Avoid closing the results when the input has lost focus.\n   */\n  protected addInputHandlers() {\n    this.input.off('blur');\n\n    this.input.keydown((evt:JQuery.TriggeredEvent) => {\n      if (evt.which === keyCodes.ESCAPE) {\n        this.input.val('');\n        (this.input as any)[this.widgetName].call(this.input, 'search', '');\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  /**\n   * When clicking an item with meta keys,\n   * avoid its propagation.\n   *\n   */\n  protected addClickHandler() {\n    var touchMoved:boolean = false;\n    this.$element\n      .find('.project-menu-autocomplete--results')\n      .on('click', '.ui-menu-item a', (evt:JQuery.TriggeredEvent) => {\n        if (LinkHandling.isClickedWithModifier(evt)) {\n          evt.stopImmediatePropagation();\n        }\n\n        return true;\n      })\n\n      // On iOS the click event doesn't get fired. So we need to listen to touch events and discard them if they they\n      // are the beginning of some scrolling.\n      .on('touchend', '.ui-menu-item a', function (evt:JQuery.TriggeredEvent) {\n        if (!touchMoved) {\n          window.location.href = (evt.target as HTMLAnchorElement).href;\n        }\n      }).on('touchmove', '.ui-menu-item a', function () {\n      touchMoved = true;\n    }).on('touchstart', '.ui-menu-item a', function () {\n      touchMoved = false;\n    });\n  }\n\n  protected setupParams(autocompleteValues:ProjectAutocompleteItem[]) {\n    const params:any = super.setupParams(autocompleteValues);\n\n    // Append to top-menu\n    params.appendTo = '.project-menu-autocomplete--wrapper';\n    params.classes = {\n      'ui-autocomplete': '-inplace project-menu-autocomplete--results'\n    };\n    params.position = {\n      of: '.project-menu-autocomplete--input-container'\n    }\n\n    return params;\n  }\n\n  private scrollCurrentProjectIntoView() {\n    let currentProject:HTMLElement|null = document.querySelector('.ui-menu-item-wrapper.selected');\n\n    // It can happen that no project is selected yet initially.\n    if (!currentProject) {\n      return;\n    }\n\n    let currentProjectHeight = currentProject.offsetHeight;\n    let scrollableContainer = document.getElementsByClassName('project-menu-autocomplete--results')[0];\n\n    // Scroll current project to top of the list and\n    // substract half the container width again to center it vertically\n    let scrollValue = currentProject.offsetTop -\n      (scrollableContainer as HTMLElement).offsetHeight / 2 +\n      currentProjectHeight / 2;\n\n    // The top visible project shall be seen completely.\n    // Otherwise there will be a scrolling effect when the user hovers over the project.\n    scrollableContainer.scrollTop = (scrollValue % currentProjectHeight === 0) ?\n      scrollValue :\n      scrollValue - (scrollValue % currentProjectHeight);\n  }\n}\n\n","<div class=\"dropdown dropdown-relative project-search-results\" id=\"project_autocompletion_wrapper\">\n  <div class=\"project-menu-autocomplete--wrapper\">\n    <div class=\"project-menu-autocomplete--input-container\">\n      <label for=\"project_autocompletion_input\" class=\"hidden-for-sighted\" [textContent]=\"text.label\"></label>\n      <input type=\"text\"\n             id=\"project_autocompletion_input\"\n             name=\"project_autocompletion_input\"\n             class=\"ui-autocomplete--input project-menu-autocomplete--input\"\n             [attr.placeholder]=\"loadingText\">\n      <i class=\"project-menu-autocomplete--search-icon icon-search\"></i>\n    </div>\n    <p class=\"project-menu-autocomplete--no-results\" hidden [textContent]=\"text.no_results\"></p>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit} from '@angular/core';\nimport {keyCodes} from 'core-app/modules/common/keyCodes.enum';\nimport {HttpClient} from '@angular/common/http';\n\nexport const remoteFieldUpdaterSelector = 'remote-field-updater';\n\n@Component({\n  selector: remoteFieldUpdaterSelector,\n  template: ''\n})\nexport class RemoteFieldUpdaterComponent implements OnInit {\n\n  constructor(private elementRef:ElementRef,\n              private http:HttpClient) {\n  }\n\n  private url:string;\n  private htmlMode:boolean;\n\n  private inputs:JQuery;\n  private target:JQuery;\n\n  ngOnInit():void {\n    const $element = jQuery(this.elementRef.nativeElement);\n    const $form = $element.parent();\n    this.inputs = $form.find('.remote-field--input');\n    this.target = $form.find('.remote-field--target');\n\n    this.url = $element.data('url');\n    this.htmlMode = $element.data('mode') === 'html';\n\n    this.inputs.on('keyup change', _.debounce((event:JQuery.TriggeredEvent) => {\n      // This prevents an update of the result list when\n      // tabbing to the result list (9),\n      // pressing enter (13)\n      // tabbing back with shift (16) and\n      // special cases where the tab code is not correctly recognized (undefined).\n      // Thus the focus is kept on the first element of the result list.\n      let keyCodesArray = [keyCodes.TAB, keyCodes.ENTER, keyCodes.SHIFT];\n      if (event.type === 'change' || (event.which && keyCodesArray.indexOf(event.which) === -1)) {\n        this.updater();\n      }\n    }, 500));\n  }\n\n  private request(params:any) {\n    const headers:any = {};\n\n    // In HTML mode, expect html response\n    if (this.htmlMode) {\n      headers['Accept'] = 'text/html';\n    } else {\n      headers['Accept'] = 'application/json';\n    }\n\n    return this.http\n      .get(\n        this.url,\n        {\n          params: params,\n          headers: headers,\n          responseType: (this.htmlMode ? 'text' : 'json') as any,\n          withCredentials: true\n        }\n      );\n  }\n\n  private updater() {\n    let params:any = {};\n\n    // Gather request keys\n    this.inputs.each((i, el:HTMLInputElement) => {\n      params[el.dataset.remoteFieldKey!] = el.value;\n    });\n\n    this\n      .request(params)\n      .subscribe((response:any) => {\n      if (this.htmlMode) {\n        // Replace the given target\n        this.target.html(response);\n      } else {\n        _.each(response, (val:string, selector:string) => {\n          jQuery('#' + selector).html(val);\n        });\n      }\n    });\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {ChangeDetectorRef, Component, ElementRef, Injector, Input, OnDestroy} from '@angular/core';\nimport {distinctUntilChanged} from 'rxjs/operators';\nimport {combineLatest} from 'rxjs';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {GlobalSearchService} from \"core-app/modules/global_search/services/global-search.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const globalSearchTitleSelector = 'global-search-title';\n\n@Component({\n  selector: 'global-search-title',\n  templateUrl: './global-search-title.component.html'\n})\nexport class GlobalSearchTitleComponent extends UntilDestroyedMixin implements OnDestroy {\n  @Input() public searchTerm:string;\n  @Input() public project:string;\n  @Input() public projectScope:string;\n  @Input() public searchTitle:string;\n\n  @InjectField() private currentProjectService:CurrentProjectService;\n\n  public text:{ [key:string]:string } = {\n    all_projects: this.I18n.t('js.global_search.title.all_projects'),\n    project_and_subprojects: this.I18n.t('js.global_search.title.project_and_subprojects'),\n    search_for: this.I18n.t('js.global_search.title.search_for'),\n    in: this.I18n.t('js.label_in')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              readonly cdRef:ChangeDetectorRef,\n              readonly globalSearchService:GlobalSearchService,\n              readonly I18n:I18nService,\n              readonly injector:Injector) {\n    super();\n  }\n\n  ngOnInit() {\n    // Listen on changes of search input value and project scope\n    combineLatest([\n      this.globalSearchService.searchTerm$,\n      this.globalSearchService.projectScope$\n    ])\n      .pipe(\n        distinctUntilChanged(),\n        this.untilDestroyed()\n      )\n      .subscribe(([newSearchTerm, newProjectScope]) => {\n        this.searchTerm = newSearchTerm;\n        this.project = this.projectText(newProjectScope);\n        this.searchTitle = `${this.text.search_for} ${this.searchTerm} ${this.project === '' ? '' : this.text.in} ${this.project}`;\n\n        this.cdRef.detectChanges();\n      });\n  }\n\n  private projectText(scope:string):string {\n    let currentProjectName = this.currentProjectService.name ? this.currentProjectService.name : '';\n\n    switch (scope) {\n      case 'all':\n        return this.text.all_projects;\n        break;\n      case 'current_project':\n        return currentProjectName;\n        break;\n      case '':\n        return currentProjectName + ' ' + this.text.project_and_subprojects;\n        break;\n      default:\n        return '';\n    }\n  }\n}\n","<div class=\"toolbar-container\">\n  <div class=\"toolbar\">\n    <div class=\"title-container\">\n      <h2 [attr.title]=\"searchTitle\">\n        {{ text.search_for }}\n        <i>\"{{ searchTerm }}\"</i>\n        {{ project === '' ? '' : text.in }}\n        <i>{{ project }}</i>\n      </h2>\n      <ul class=\"toolbar-items\"></ul>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, OnDestroy} from '@angular/core';\nimport {GlobalSearchService} from \"core-app/modules/global_search/services/global-search.service\";\nimport {Subscription} from \"rxjs\";\nimport {ScrollableTabsComponent} from \"core-app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component\";\n\nexport const globalSearchTabsSelector = 'global-search-tabs';\n\n@Component({\n  selector: globalSearchTabsSelector,\n  templateUrl: '/app/modules/common/tabs/scrollable-tabs/scrollable-tabs.component.html'\n})\n\nexport class GlobalSearchTabsComponent extends ScrollableTabsComponent implements OnDestroy {\n  private currentTabSub:Subscription;\n  private tabsSub:Subscription;\n\n  public classes:string[] = ['global-search--tabs', 'scrollable-tabs'];\n\n  constructor(readonly globalSearchService:GlobalSearchService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.currentTabSub = this.globalSearchService\n      .currentTab$\n      .subscribe((currentTab) => {\n        this.currentTabId = currentTab;\n      });\n\n    this.tabsSub = this.globalSearchService\n      .tabs$\n      .subscribe((tabs) => {\n        this.tabs = tabs;\n        this.tabs.map((tab) => tab.path = '#');\n      });\n  }\n\n  public clickTab(tab:string) {\n    super.clickTab(tab);\n\n    this.globalSearchService.currentTab = tab;\n    this.globalSearchService.submitSearch();\n  }\n\n  ngOnDestroy():void {\n    this.currentTabSub.unsubscribe();\n    this.tabsSub.unsubscribe();\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectionStrategy, ChangeDetectorRef, Component, Injector, OnInit} from '@angular/core';\nimport {MainMenuToggleService} from './main-menu-toggle.service';\nimport {distinctUntilChanged} from 'rxjs/operators';\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {DeviceService} from \"app/modules/common/browser/device.service\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\n\nexport const mainMenuToggleSelector = 'main-menu-toggle';\n\n@Component({\n  selector: mainMenuToggleSelector,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  template: `\n    <div *ngIf=\"this.currentProject.id !== null || this.deviceService.isMobile\" id=\"main-menu-toggle\"\n         aria-haspopup=\"true\"\n         [attr.title]=\"toggleTitle\"\n         (accessibleClick)=\"toggleService.toggleNavigation($event)\"\n         tabindex=\"0\">\n      <a icon=\"icon-hamburger\">\n        <i class=\"icon-hamburger\" aria-hidden=\"true\"></i>\n      </a>\n    </div>\n  `\n})\n\nexport class MainMenuToggleComponent extends UntilDestroyedMixin implements OnInit {\n  toggleTitle:string = \"\";\n  @InjectField() currentProject:CurrentProjectService;\n\n  constructor(readonly toggleService:MainMenuToggleService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly deviceService:DeviceService,\n              readonly injector:Injector) {\n    super();\n  }\n\n  ngOnInit() {\n    this.toggleService.initializeMenu();\n\n    this.toggleService.titleData$\n      .pipe(\n        distinctUntilChanged(),\n        this.untilDestroyed()\n      )\n      .subscribe(setToggleTitle => {\n        this.toggleTitle = setToggleTitle;\n        this.cdRef.detectChanges();\n      });\n  }\n}\n\n","import {UserAutocompleterComponent} from \"core-app/modules/common/autocomplete/user-autocompleter.component\";\nimport {Observable} from \"rxjs\";\nimport {map} from \"rxjs/operators\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {HttpClient, HttpParams} from \"@angular/common/http\";\nimport {Component} from \"@angular/core\";\nimport {URLParamsEncoder} from \"core-app/modules/hal/services/url-params-encoder\";\n\nexport const membersAutocompleterSelector = 'members-autocompleter';\n\n@Component({\n  templateUrl: '/app/modules/common/autocomplete/user-autocompleter.component.html',\n  selector: membersAutocompleterSelector\n})\nexport class MembersAutocompleterComponent extends UserAutocompleterComponent {\n  @InjectField() http:HttpClient;\n\n  protected getAvailableUsers(url:string, searchTerm:any):Observable<{ [key:string]:string|null }[]> {\n    return this.http\n      .get(url,\n        {\n          params: new HttpParams({ encoder: new URLParamsEncoder(), fromObject: { q: searchTerm } }),\n          responseType: 'json',\n          headers: { 'Content-Type': 'application/json; charset=utf-8' }\n        },\n      )\n      .pipe(\n        map((res:any) => {\n          return res.results.items.map((el:any) => {\n            return { name: el.name, id: el.id, href: el.id };\n          });\n        })\n      );\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HttpClient, HttpErrorResponse, HttpHeaders} from \"@angular/common/http\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {FormGroup} from \"@angular/forms\";\nimport {input} from \"reactivestates\";\n\nexport interface EnterpriseTrialData {\n  id?:string;\n  company:string;\n  first_name:string;\n  last_name:string;\n  email:string;\n  domain:string;\n  general_consent?:boolean;\n  newsletter_consent?:boolean;\n}\n\n@Injectable()\nexport class EnterpriseTrialService {\n  // user data needs to be sync in ee-active-trial.component.ts\n  userData$ = input<EnterpriseTrialData>();\n\n  public readonly baseUrlAugur:string;\n  public readonly tokenVersion:string;\n\n  public trialLink:string;\n  public resendLink:string;\n\n  public modalOpen = false;\n  public confirmed:boolean;\n  public cancelled = false;\n  public status:'mailSubmitted'|'startTrial'|undefined;\n  public error:HttpErrorResponse|undefined;\n  public emailInvalid:boolean = false;\n  public text = {\n    invalid_email: this.I18n.t('js.admin.enterprise.trial.form.invalid_email'),\n    taken_email: this.I18n.t('js.admin.enterprise.trial.form.taken_email'),\n    taken_domain: this.I18n.t('js.admin.enterprise.trial.form.taken_domain'),\n  };\n\n  constructor(readonly I18n:I18nService,\n              protected http:HttpClient,\n              readonly pathHelper:PathHelperService,\n              protected notificationsService:NotificationsService) {\n    let gon = (window as any).gon;\n    this.baseUrlAugur = gon.augur_url;\n    this.tokenVersion = gon.token_version;\n\n    if ((window as any).gon.ee_trial_key) {\n      this.setMailSubmittedStatus();\n    }\n  }\n\n  // send POST request with form object\n  // receive an enterprise trial link to access a token\n  public sendForm(form:FormGroup) {\n    const request = { ...form.value, token_version: this.tokenVersion};\n    this.http.post(this.baseUrlAugur + '/public/v1/trials', request)\n      .toPromise()\n      .then((enterpriseTrial:any) => {\n        this.userData$.putValue(form.value);\n        this.cancelled = false;\n\n        this.trialLink = enterpriseTrial._links.self.href;\n        this.saveTrialKey(this.trialLink);\n\n        this.retryConfirmation();\n      })\n      .catch((error:HttpErrorResponse) => {\n        // mail is invalid or user already created a trial\n        if (error.status === 422 || error.status === 400) {\n          this.error = error;\n        } else {\n          this.notificationsService.addWarning(error.error.description || I18n.t('js.error.internal'));\n        }\n      });\n  }\n\n  // get a token from the trial link if user confirmed mail\n  public getToken() {\n    // 2) GET /public/v1/trials/:id\n    this.http\n      .get<any>(this.trialLink)\n      .toPromise()\n      .then(async (res:any) => {\n        // show confirmed status and enable continue btn\n        this.confirmed = true;\n\n        // returns token if mail was confirmed\n        // -> if token is new (token_retrieved: false) save token in backend\n        if (!res.token_retrieved) {\n          await this.saveToken(res.token);\n        }\n      })\n      .catch((error:HttpErrorResponse) => {\n        // returns error 422 while waiting of confirmation\n        if (error.status === 422 && error.error.identifier === 'waiting_for_email_verification') {\n          // get resend button link\n          this.resendLink = error.error._links.resend.href;\n          // save a key for the requested trial\n          if (!this.status || this.cancelled) { // only do it once\n            this.saveTrialKey(this.resendLink);\n          }\n          // open next modal window -> status waiting\n          this.setMailSubmittedStatus();\n          this.confirmed = false;\n        } else if (_.get(error, 'error._type') === 'Error') {\n          this.notificationsService.addError(error.error.message);\n        } else {\n          this.notificationsService.addError(error.error || I18n.t('js.error.internal'));\n        }\n      });\n  }\n\n  // save a part of the resend link in db\n  // which allows to remember if a user has already requested a trial token\n  // and to ask for the corresponding user data saved in Augur\n  private saveTrialKey(resendlink:string) {\n    // extract token from resend link\n    let trialKey = resendlink.split('/')[6];\n    return this.http.post(\n      this.pathHelper.api.v3.appBasePath + '/admin/enterprise/save_trial_key',\n      { trial_key: trialKey },\n      { withCredentials: true }\n    )\n      .toPromise()\n      .catch((e:any) => {\n        this.notificationsService.addError(e.error.message || e.message || e);\n      });\n  }\n\n  // save received token in controller\n  private saveToken(token:string) {\n    return this.http.post(\n      this.pathHelper.api.v3.appBasePath + '/admin/enterprise',\n      { enterprise_token: { encoded_token: token } },\n      { withCredentials: true }\n    )\n      .toPromise()\n      .then(() => {\n        // load page if mail was confirmed and modal window is not open\n        if (!this.modalOpen) {\n          setTimeout(() => { // display confirmed status before reloading\n            window.location.reload();\n          }, 500);\n        }\n      })\n      .catch((error:HttpErrorResponse) => {\n        // Delete the trial key as the token could not be saved and thus something is wrong with the token.\n        // Without this deletion, we run into an endless loop of an confirmed mail, but no saved token.\n        this.http\n          .delete(\n          this.pathHelper.api.v3.appBasePath + '/admin/enterprise/delete_trial_key',\n        { withCredentials: true }\n          )\n          .toPromise();\n\n        this.notificationsService.addError(error.error.description || I18n.t('js.error.internal'));\n      });\n  }\n\n  // retry request while waiting for mail confirmation\n  public retryConfirmation(delay:number = 5000, retries:number = 60) {\n    if (this.cancelled || this.confirmed) {\n      return;\n    } else if (retries === 0) {\n      this.cancelled = true;\n    } else {\n      this.getToken();\n      setTimeout(() => {\n        this.retryConfirmation(delay, retries - 1);\n      }, delay);\n    }\n  }\n\n  public setStartTrialStatus() {\n    this.status = 'startTrial';\n  }\n\n  public setMailSubmittedStatus() {\n    this.status = 'mailSubmitted';\n  }\n\n  public get trialStarted():boolean {\n    return this.status === 'startTrial';\n  }\n\n  public get mailSubmitted():boolean {\n    return this.status === 'mailSubmitted';\n  }\n\n  public get domainTaken():boolean {\n    return this.error ? this.error.error.identifier === 'domain_taken' : false;\n  }\n\n  public get emailTaken():boolean {\n    return this.error ? this.error.error.identifier === 'user_already_created_trial' : false;\n  }\n\n  public get emailError():boolean {\n    if (this.emailInvalid) {\n      return true;\n    } else if (this.error) {\n      return this.emailTaken;\n    } else {\n      return false;\n    }\n  }\n\n  public get errorMsg() {\n    let error:string = '';\n    if (this.emailInvalid) {\n      error = this.text.invalid_email;\n    } else if (this.domainTaken) {\n      error = this.text.taken_domain;\n    } else if (this.emailTaken) {\n      error = this.text.taken_email;\n    }\n\n    return error;\n  }\n}\n","export namespace I18nHelpers {\n\n  export interface LocalizedLinkMap {\n    [key:string]:string;\n\n    en:string;\n  }\n\n  /**\n   * Return the matching link for the current locale\n   *\n   * @param map A hash of locale => URL to use\n   */\n  export function localizeLink(map:LocalizedLinkMap) {\n    const locale = I18n.locale;\n\n    return map[locale] || map.en;\n  }\n}\n","<form id=\"enterprise-trial-form\" class=\"form\" [formGroup]=\"trialForm\">\n  <div class=\"form--field -wide-label -required\">\n    <label class=\"form--label\" for=\"trial-company-name\">{{ text.label_company }}</label>\n    <div class=\"form--field-container\">\n      <div class=\"form--text-field-container\">\n        <input type=\"text\"\n               id=\"trial-company-name\"\n               class=\"form--text-field\"\n               formControlName=\"company\">\n      </div>\n    </div>\n  </div>\n  <div class=\"form--field -wide-label -required\">\n    <label class=\"form--label\" for=\"trial-first-name\">{{ text.label_first_name }}</label>\n    <div class=\"form--field-container\">\n      <div class=\"form--text-field-container\">\n        <input type=\"text\"\n               id=\"trial-first-name\"\n               class=\"form--text-field\"\n               formControlName=\"first_name\">\n      </div>\n    </div>\n  </div>\n  <div class=\"form--field -wide-label -required\">\n    <label class=\"form--label\" for=\"trial-last-name\">{{ text.label_last_name }}</label>\n    <div class=\"form--field-container\">\n      <div class=\"form--text-field-container\">\n        <input type=\"text\"\n               id=\"trial-last-name\"\n               class=\"form--text-field\"\n               formControlName=\"last_name\">\n      </div>\n    </div>\n  </div>\n  <div class=\"form--field -wide-label -required\">\n    <label class=\"form--label\" for=\"trial-email\">{{ text.label_email }}</label>\n    <div class=\"form--field-container\">\n      <div class=\"form--text-field-container\"\n           [ngClass]=\"{ '-required-highlighting' : eeTrialService.emailError }\">\n        <input type=\"email\"\n               class=\"form--text-field\"\n               id=\"trial-email\"\n               formControlName=\"email\" (blur)=\"checkMailField()\">\n      </div>\n    </div>\n    <div *ngIf=\"eeTrialService.emailError\" class=\"form--field-instructions\">{{ eeTrialService.errorMsg }}</div>\n  </div>\n  <div class=\"form--field -wide-label -required\">\n    <label class=\"form--label\" for=\"trial-domain-name\">{{ text.label_domain }}</label>\n    <div class=\"form--field-container\">\n      <div class=\"form--text-field-container\"\n           [ngClass]=\"{ '-required-highlighting' : eeTrialService.domainTaken }\">\n        <input type=\"text\"\n               id=\"trial-domain-name\"\n               class=\"form--text-field\"\n               formControlName=\"domain\"\n               disabled>\n      </div>\n    </div>\n    <div *ngIf=\"eeTrialService.domainTaken\" class=\"form--field-instructions\">{{ eeTrialService.errorMsg }}</div>\n  </div>\n  <div class=\"form--field -required\">\n    <div class=\"form--field-container\">\n      <label class=\"form--label-with-check-box -no-ellipsis\" for=\"trial-general-consent\">\n        <div class=\"form--check-box-container\">\n          <input type=\"checkbox\"\n                 id=\"trial-general-consent\"\n                 class=\"form--check-box\"\n                 formControlName=\"general_consent\"\n                 required>\n        </div>\n        <span [innerHTML]=\"text.general_consent\"></span>\n      </label>\n    </div>\n  </div>\n  <div class=\"form--field\">\n    <div class=\"form--field-container\">\n      <label class=\"form--label-with-check-box -no-ellipsis\" for=\"trial-newsletter-consent\">\n        <div class=\"form--check-box-container\">\n          <input type=\"checkbox\"\n                 id=\"trial-newsletter-consent\"\n                 class=\"form--check-box\"\n                 formControlName=\"newsletter_consent\">\n        </div>\n        <span [innerHtml]=\"text.receive_newsletter\"></span>\n      </label>\n    </div>\n  </div>\n</form>","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef} from \"@angular/core\";\nimport {FormBuilder, Validators} from \"@angular/forms\";\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\nimport {EnterpriseTrialData, EnterpriseTrialService} from \"core-components/enterprise/enterprise-trial.service\";\nimport {CurrentUserService} from \"core-components/user/current-user.service\";\nimport {I18nHelpers} from \"core-app/helpers/i18n/localized-link\";\n\nconst newsletterURL = 'https://www.openproject.com/newsletter/';\n\n@Component({\n  selector: 'enterprise-trial-form',\n  templateUrl: './ee-trial-form.component.html'\n})\nexport class EETrialFormComponent {\n  // Retain used values\n  userData:Partial<EnterpriseTrialData> = this.eeTrialService.userData$.getValueOr({});\n\n  trialForm = this.formBuilder.group({\n    company: [this.userData.company, Validators.required],\n    first_name: [this.userData.first_name, Validators.required],\n    last_name: [this.userData.last_name, Validators.required],\n    email: ['', [Validators.required, Validators.email]],\n    domain: [this.userData.domain || window.location.host, Validators.required],\n    general_consent: [null, Validators.required],\n    newsletter_consent: null,\n    language: this.currentUserService.language\n  });\n\n  public text = {\n    general_consent: this.I18n.t('js.admin.enterprise.trial.form.general_consent', {\n      link_terms: I18nHelpers.localizeLink({\n        en: 'https://www.openproject.com/terms-of-service/',\n        de: 'https://www.openproject.org/de/nutzungsbedingungen/',\n      }),\n      link_privacy: I18nHelpers.localizeLink({\n        en: 'https://www.openproject.org/data-privacy-and-security/',\n        de: 'https://www.openproject.org/de/datenschutz/'\n      })\n    }),\n    label_test_ee: this.I18n.t('js.admin.enterprise.trial.form.test_ee'),\n    label_company: this.I18n.t('js.admin.enterprise.trial.form.label_company'),\n    label_first_name: this.I18n.t('js.admin.enterprise.trial.form.label_first_name'),\n    label_last_name: this.I18n.t('js.admin.enterprise.trial.form.label_last_name'),\n    label_email: this.I18n.t('js.admin.enterprise.trial.form.label_email'),\n    label_domain: this.I18n.t('js.admin.enterprise.trial.form.label_domain'),\n    privacy_policy: this.I18n.t('js.admin.enterprise.trial.form.privacy_policy'),\n    receive_newsletter: this.I18n.t('js.admin.enterprise.trial.form.receive_newsletter', { link: newsletterURL }),\n    terms_of_service: this.I18n.t('js.admin.enterprise.trial.form.terms_of_service')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              readonly I18n:I18nService,\n              private formBuilder:FormBuilder,\n              readonly currentUserService:CurrentUserService,\n              public eeTrialService:EnterpriseTrialService) {\n\n  }\n\n  // checks if mail is valid after input field was edited by the user\n  // displays message for user\n  public checkMailField() {\n    if (this.trialForm.value.email !== '' && this.trialForm.controls.email.errors) {\n      this.eeTrialService.emailInvalid = true;\n    } else {\n      this.eeTrialService.emailInvalid = false;\n      this.eeTrialService.error = undefined;\n    }\n  }\n}\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\n\nexport class EEActiveTrialBase extends UntilDestroyedMixin {\n  public text = {\n    label_email: this.I18n.t('js.admin.enterprise.trial.form.label_email'),\n    label_expires_at: this.I18n.t('js.admin.enterprise.trial.form.label_expires_at'),\n    label_maximum_users: this.I18n.t('js.admin.enterprise.trial.form.label_maximum_users'),\n    label_company: this.I18n.t('js.admin.enterprise.trial.form.label_company'),\n    label_domain: this.I18n.t('js.admin.enterprise.trial.form.label_domain'),\n    label_starts_at: this.I18n.t('js.admin.enterprise.trial.form.label_starts_at'),\n    label_subscriber: this.I18n.t('js.admin.enterprise.trial.form.label_subscriber')\n  };\n\n  constructor(readonly I18n:I18nService) {\n    super();\n  }\n}\n","<div class=\"enterprise--active-token\">\n  <div class=\"attributes-group\">\n    <div class=\"attributes-key-value\">\n      <div class=\"attributes-key-value--key\" [textContent]=\"text.label_subscriber\"></div>\n      <div class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"subscriber\"></span>\n        </div>\n      </div>\n      <div class=\"attributes-key-value--key\" [textContent]=\"text.label_email\"> </div>\n      <div class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"email\"></span>\n        </div>\n      </div>\n      <div *ngIf=\"company\" class=\"attributes-key-value--key\" [textContent]=\"text.label_company\"></div>\n      <div *ngIf=\"company\" class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"company\"></span>\n        </div>\n      </div>\n      <div *ngIf=\"domain\" class=\"attributes-key-value--key\" [textContent]=\"text.label_domain\"></div>\n      <div *ngIf=\"domain\" class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"domain\"></span>\n        </div>\n      </div>\n      <div *ngIf=\"userCount\" class=\"attributes-key-value--key\" [textContent]=\"text.label_maximum_users\"> </div>\n      <div *ngIf=\"userCount\" class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"userCount\"></span>\n        </div>\n      </div>\n      <div *ngIf=\"startsAt\" class=\"attributes-key-value--key\" [textContent]=\"text.label_starts_at\"> </div>\n      <div *ngIf=\"startsAt\" class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"startsAt\"></span>\n        </div>\n      </div>\n      <!-- only show if token expires -->\n      <div *ngIf=\"expiresAt\" class=\"attributes-key-value--key\" [textContent]=\"text.label_expires_at\"></div>\n      <div *ngIf=\"expiresAt\" class=\"attributes-key-value--value-container\">\n        <div class=\"attributes-key-value--value -text\">\n          <span [textContent]=\"expiresAt\"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {ChangeDetectorRef, Component, ElementRef, OnInit} from \"@angular/core\";\nimport {distinctUntilChanged} from \"rxjs/operators\";\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\nimport {EnterpriseTrialService} from \"app/components/enterprise/enterprise-trial.service\";\nimport {HttpClient, HttpErrorResponse} from \"@angular/common/http\";\nimport {EEActiveTrialBase} from \"core-components/enterprise/enterprise-active-trial/ee-active-trial.base\";\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\n\n@Component({\n  selector: 'enterprise-active-trial',\n  templateUrl: './ee-active-trial.component.html',\n  styleUrls: ['./ee-active-trial.component.sass']\n})\nexport class EEActiveTrialComponent extends EEActiveTrialBase implements OnInit {\n  public subscriber:string;\n  public email:string;\n  public company:string;\n  public domain:string;\n  public userCount:string;\n  public startsAt:string;\n  public expiresAt:string;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService,\n              readonly http:HttpClient,\n              readonly Gon:GonService,\n              public eeTrialService:EnterpriseTrialService) {\n    super(I18n);\n  }\n\n  ngOnInit() {\n    if (!this.subscriber) {\n      this.eeTrialService.userData$\n        .values$()\n        .pipe(\n          distinctUntilChanged(),\n          this.untilDestroyed()\n        )\n        .subscribe(userForm => {\n          this.formatUserData(userForm);\n          this.cdRef.detectChanges();\n        });\n\n      this.initialize();\n    }\n  }\n\n  private initialize():void {\n    let eeTrialKey = this.Gon.get('ee_trial_key') as any;\n\n    if (eeTrialKey && !this.eeTrialService.userData$.hasValue()) {\n      // after reload: get data from Augur using the trial key saved in gon\n      this.eeTrialService.trialLink = this.eeTrialService.baseUrlAugur + '/public/v1/trials/' + eeTrialKey.value;\n      this.getUserDataFromAugur();\n    }\n  }\n\n  // use the trial key saved in the db\n  // to get the user data from Augur\n  private getUserDataFromAugur() {\n    this.http\n      .get<any>(this.eeTrialService.trialLink + '/details')\n      .toPromise()\n      .then((userForm:any) => {\n        this.eeTrialService.userData$.putValue(userForm);\n        this.eeTrialService.retryConfirmation();\n      })\n      .catch((error:HttpErrorResponse) => {\n        // Check whether the mail has been confirmed by now\n        this.eeTrialService.getToken();\n      });\n  }\n\n  private formatUserData(userForm:any) {\n    this.subscriber = userForm.first_name + ' ' + userForm.last_name;\n    this.email = userForm.email;\n    this.company = userForm.company;\n    this.domain = userForm.domain;\n  }\n\n}\n","<enterprise-active-trial></enterprise-active-trial>\n\n<p>{{ text.confirmation_info(created, email) }}</p>\n<p>\n  <span>{{ text.status_label }} </span>\n  <span *ngIf=\"!eeTrialService.confirmed; else confirmedStatus\" class=\"status--waiting\">\n    {{ text.status_waiting }}\n\n    <a id=\"resend-link\" (click)=\"resendMail()\">{{ text.resend }}</a>\n    <p *ngIf=\"eeTrialService.cancelled\">{{ text.session_timeout }}</p>\n  </span>\n\n  <ng-template #confirmedStatus>\n    <span class=\"status--confirmed icon-yes\"> {{ text.status_confirmed }}</span>\n  </ng-template>\n</p>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef, OnInit} from \"@angular/core\";\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\nimport {EnterpriseTrialService} from \"app/components/enterprise/enterprise-trial.service\";\nimport {HttpClient} from \"@angular/common/http\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {distinctUntilChanged} from \"rxjs/operators\";\nimport {TimezoneService} from \"core-components/datetime/timezone.service\";\n\n@Component({\n  selector: 'enterprise-trial-waiting',\n  templateUrl: './ee-trial-waiting.component.html',\n  styleUrls: ['./ee-trial-waiting.component.sass']\n})\nexport class EETrialWaitingComponent implements OnInit {\n  created = this.timezoneService.formattedDate(new Date().toString());\n  email:string = '';\n\n  public text = {\n    confirmation_info: (date:string, email:string) => this.I18n.t('js.admin.enterprise.trial.confirmation_info',{\n      date: date,\n      email: email\n    }),\n    resend: this.I18n.t('js.admin.enterprise.trial.resend_link'),\n    resend_success: this.I18n.t('js.admin.enterprise.trial.resend_success'),\n    resend_warning: this.I18n.t('js.admin.enterprise.trial.resend_warning'),\n    session_timeout: this.I18n.t('js.admin.enterprise.trial.session_timeout'),\n    status_confirmed: this.I18n.t('js.admin.enterprise.trial.status_confirmed'),\n    status_label: this.I18n.t('js.admin.enterprise.trial.status_label'),\n    status_waiting: this.I18n.t('js.admin.enterprise.trial.status_waiting')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              readonly I18n:I18nService,\n              protected http:HttpClient,\n              protected notificationsService:NotificationsService,\n              public eeTrialService:EnterpriseTrialService,\n              readonly timezoneService:TimezoneService) {\n  }\n\n  ngOnInit() {\n    let eeTrialKey = (window as any).gon.ee_trial_key;\n    if (eeTrialKey) {\n      let savedDateStr = eeTrialKey.created.split(' ')[0];\n      this.created = this.timezoneService.formattedDate(savedDateStr);\n    }\n\n    this.eeTrialService.userData$\n      .values$()\n      .pipe(\n        distinctUntilChanged(),\n      )\n      .subscribe(userForm => {\n        this.email = userForm.email;\n      });\n  }\n\n  // resend mail if resend link has been clicked\n  public resendMail() {\n    this.eeTrialService.cancelled = false;\n    this.http.post(this.eeTrialService.resendLink, {})\n      .toPromise()\n      .then(() => {\n        this.notificationsService.addSuccess(this.text.resend_success);\n        this.eeTrialService.retryConfirmation();\n      })\n      .catch(() => {\n        if (this.eeTrialService.trialLink) {\n          // Check whether the mail has been confirmed by now\n          this.eeTrialService.getToken();\n        } else {\n          this.notificationsService.addError(this.text.resend_warning);\n        }\n      });\n  }\n}\n\n","<div class=\"op-modal--portal\">\n  <div class=\"op-modal--modal-container\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 [textContent]=\"headerText()\"></h3>\n      <a *ngIf=\"showClose\" class=\"op-modal--modal-close-button\">\n        <i class=\"icon-close\" (click)=\"closeModal($event)\" [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n    </div>\n\n    <div [ngSwitch]=\"openWindow()\" class=\"op-modal--modal-body\">\n      <!-- first modal window -->\n      <div *ngSwitchCase=\"1\">\n        <enterprise-trial-form></enterprise-trial-form>\n      </div>\n      <!-- second modal window -->\n      <div *ngSwitchCase=\"2\">\n        <enterprise-trial-waiting></enterprise-trial-waiting>\n      </div>\n      <!-- third modal window -->\n      <div *ngSwitchCase=\"3\">\n        <div class=\"onboarding--video-block\">\n          <div class=\"onboarding--video-text\">\n            <span>{{ text.quick_overview }}</span>\n          </div>\n          <div class=\"onboarding--video iframe-target-wrapper\">\n            <iframe frameborder=\"0\"\n                    height=\"400\"\n                    width=\"100%\"\n                    [src]=\"trustedEEVideoURL\"\n                    allowfullscreen>\n            </iframe>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"op-modal--modal-footer\">\n      <div *ngIf=\"!eeTrialService.status || eeTrialService.cancelled; else mailSubmitted\">\n        <button class=\"confirm-form-submit--continue button -highlight\"\n                (click)=\"onSubmit()\"\n                [disabled]=\"!trialForm || trialForm.invalid\"\n                [textContent]=\"text.button_submit\"\n                [attr.title]=\"text.button_submit\"\n                [hidden]=\"eeTrialService.mailSubmitted && !eeTrialService.cancelled\">\n        </button>\n        <button class=\"confirm-form-submit--cancel button\"\n                (click)=\"closeModal($event)\"\n                [textContent]=\"text.button_cancel\"\n                [attr.title]=\"text.button_cancel\">\n        </button>\n      </div>\n      <ng-template #mailSubmitted>\n        <button class=\"confirm-form-submit--continue button -highlight\"\n                (click)=\"startEnterpriseTrial()\"\n                [textContent]=\"text.button_continue\"\n                [attr.title]=\"text.button_continue\"\n                [disabled]=\"!eeTrialService.confirmed\"\n                [hidden]=\"eeTrialService.trialStarted\">\n        </button>\n        <button *ngIf=\"eeTrialService.trialStarted\"\n                class=\"confirm-form-submit--continue button -highlight\"\n                (click)=\"closeModal($event)\"\n                [textContent]=\"text.button_continue\"\n                [attr.title]=\"text.button_continue\">\n        </button>\n      </ng-template>\n    </div>\n\n  </div>\n</div>","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {AfterViewInit, ChangeDetectorRef, Component, ElementRef, Inject, Input, ViewChild} from \"@angular/core\";\nimport {DomSanitizer, SafeResourceUrl} from \"@angular/platform-browser\";\nimport {FormControl, FormGroup} from \"@angular/forms\";\nimport {OpModalComponent} from \"app/components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"app/components/op-modals/op-modal.service\";\nimport {OpModalLocalsMap} from \"app/components/op-modals/op-modal.types\";\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\nimport {EETrialFormComponent} from \"core-components/enterprise/enterprise-modal/enterprise-trial-form/ee-trial-form.component\";\nimport {EnterpriseTrialService} from \"core-components/enterprise/enterprise-trial.service\";\n\nexport const eeOnboardingVideoURL = 'https://www.youtube.com/embed/zLMSydhFSkw?autoplay=1';\n\n@Component({\n  selector: 'enterprise-trial-modal',\n  templateUrl: './enterprise-trial.modal.html',\n  styleUrls: ['./enterprise-trial.modal.sass']\n})\nexport class EnterpriseTrialModal extends OpModalComponent implements AfterViewInit {\n  @ViewChild(EETrialFormComponent, { static: false }) formComponent:EETrialFormComponent;\n  @Input() public opReferrer:string;\n\n  public trialForm:FormGroup;\n\n  // modal configuration\n  public showClose = true;\n  public closeOnEscape = false;\n  public closeOnOutsideClick = false;\n\n  public trustedEEVideoURL:SafeResourceUrl;\n  public text = {\n    button_submit: this.I18n.t('js.modals.button_submit'),\n    button_cancel: this.I18n.t('js.modals.button_cancel'),\n    button_continue: this.I18n.t('js.button_continue'),\n    close_popup: this.I18n.t('js.close_popup_title'),\n    heading_confirmation: this.I18n.t('js.admin.enterprise.trial.confirmation'),\n    heading_next_steps: this.I18n.t('js.admin.enterprise.trial.next_steps'),\n    heading_test_ee: this.I18n.t('js.admin.enterprise.trial.test_ee'),\n    quick_overview: this.I18n.t('js.admin.enterprise.trial.quick_overview')\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService,\n              readonly domSanitizer:DomSanitizer,\n              public eeTrialService:EnterpriseTrialService) {\n    super(locals, cdRef, elementRef);\n    this.trustedEEVideoURL = this.trustedURL(eeOnboardingVideoURL);\n  }\n\n  ngAfterViewInit() {\n    this.trialForm = this.formComponent.trialForm;\n  }\n\n  // checks if form is valid and submits it\n  public onSubmit() {\n    if (this.trialForm.valid) {\n      this.trialForm.addControl('_type', new FormControl('enterprise-trial'));\n      this.eeTrialService.sendForm(this.trialForm);\n    }\n  }\n\n  public startEnterpriseTrial() {\n    // open onboarding modal screen\n    this.eeTrialService.setStartTrialStatus();\n  }\n\n  public headerText() {\n    if (this.eeTrialService.mailSubmitted) {\n      return this.text.heading_confirmation;\n    } else if (this.eeTrialService.trialStarted) {\n      return this.text.heading_next_steps;\n    } else {\n      return this.text.heading_test_ee;\n    }\n  }\n\n  public closeModal(event:any) {\n    this.closeMe(event);\n    // refresh page to show enterprise trial\n    if (this.eeTrialService.trialStarted || this.eeTrialService.confirmed) {\n      window.location.reload();\n    }\n    this.eeTrialService.modalOpen = false;\n  }\n\n  public trustedURL(url:string) {\n    return this.domSanitizer.bypassSecurityTrustResourceUrl(url);\n  }\n\n  public openWindow():number {\n    if (!this.eeTrialService.status || this.eeTrialService.cancelled) {\n      return 1;\n    } else if (this.eeTrialService.mailSubmitted && !this.eeTrialService.cancelled) {\n      return 2;\n    } else {\n      return 3;\n    }\n  }\n}\n\n","<div *ngIf=\"noTrialRequested; else alreadyRequested\">\n  <p>{{ text.enterprise_edition }}</p>\n  <p class=\"-bold\">{{ text.confidence }}</p>\n  <p>\n    <span class=\"-bold\">{{ text.become_hero }}</span><br>\n    <span>{{ text.you_contribute }}</span>\n  </p>\n  <button class=\"button -alt-highlight\" (click)=\"openTrialModal()\">\n    {{ text.button_trial }}\n  </button>\n</div>\n\n<ng-template #alreadyRequested>\n  <enterprise-trial-waiting></enterprise-trial-waiting>\n  <p class=\"confirmation-hint\">{{ text.email_not_received }}\n    <a (click)=\"openTrialModal()\">{{ text.try_another_email }}</a>\n  </p>\n</ng-template>\n\n\n\n","// -- copyright\n// OpenProject is a project management system.\n// Copyright (C) 2012-2015 the OpenProject Foundation (OPF)\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See doc/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, Injector} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {EnterpriseTrialModal} from \"core-components/enterprise/enterprise-modal/enterprise-trial.modal\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {EnterpriseTrialService} from \"core-components/enterprise/enterprise-trial.service\";\n\nexport const enterpriseBaseSelector = 'enterprise-base';\n\n@Component({\n  selector: enterpriseBaseSelector,\n  templateUrl: './enterprise-base.component.html',\n  styleUrls: ['./enterprise-base.component.sass']\n})\nexport class EnterpriseBaseComponent {\n  public text = {\n    button_trial: this.I18n.t('js.admin.enterprise.upsale.button_start_trial'),\n    button_book: this.I18n.t('js.admin.enterprise.upsale.button_book_now'),\n    link_quote: this.I18n.t('js.admin.enterprise.upsale.link_quote'),\n    become_hero: this.I18n.t('js.admin.enterprise.upsale.become_hero'),\n    you_contribute: this.I18n.t('js.admin.enterprise.upsale.you_contribute'),\n    email_not_received: this.I18n.t('js.admin.enterprise.trial.email_not_received'),\n    enterprise_edition: this.I18n.t('js.admin.enterprise.upsale.text'),\n    confidence: this.I18n.t('js.admin.enterprise.upsale.confidence'),\n    try_another_email: this.I18n.t('js.admin.enterprise.trial.try_another_email')\n  };\n\n  constructor(protected I18n:I18nService,\n              protected opModalService:OpModalService,\n              readonly injector:Injector,\n              public eeTrialService:EnterpriseTrialService) {\n  }\n\n  public openTrialModal() {\n    // cancel request and open first modal window\n    this.eeTrialService.cancelled = true;\n    this.eeTrialService.modalOpen = true;\n    this.opModalService.show(EnterpriseTrialModal, this.injector);\n  }\n\n  public get noTrialRequested() {\n    return this.eeTrialService.status === undefined;\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Component, ElementRef} from \"@angular/core\";\nimport {I18nService} from \"app/modules/common/i18n/i18n.service\";\nimport {EEActiveTrialBase} from \"core-components/enterprise/enterprise-active-trial/ee-active-trial.base\";\n\nexport const enterpriseActiveSavedTrialSelector = 'enterprise-active-saved-trial';\n\n@Component({\n  selector: enterpriseActiveSavedTrialSelector,\n  templateUrl: './ee-active-trial.component.html',\n  styleUrls: ['./ee-active-trial.component.sass']\n})\nexport class EEActiveSavedTrialComponent extends EEActiveTrialBase {\n  public subscriber = this.elementRef.nativeElement.dataset['subscriber'];\n  public email = this.elementRef.nativeElement.dataset['email'];\n  public company = this.elementRef.nativeElement.dataset['company'];\n  public domain = this.elementRef.nativeElement.dataset['domain'];\n  public userCount = this.elementRef.nativeElement.dataset['userCount'];\n  public startsAt = this.elementRef.nativeElement.dataset['startsAt'];\n  public expiresAt = this.elementRef.nativeElement.dataset['expiresAt'];\n\n  constructor(readonly elementRef:ElementRef,\n              readonly I18n:I18nService) {\n    super(I18n);\n  }\n}\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, Injector, OnInit} from \"@angular/core\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {TimeEntryEditService} from \"core-app/modules/time_entries/edit/edit.service\";\nimport {TimeEntryCacheService} from \"core-components/time-entries/time-entry-cache.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {TimeEntryDmService} from \"core-app/modules/hal/dm-services/time-entry-dm.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\n\nexport const triggerActionsEntryComponentSelector = 'time-entry--trigger-actions-entry';\n\n@Component({\n  selector: triggerActionsEntryComponentSelector,\n  template: `\n    <a (click)=\"editTimeEntry()\"\n       [title]=\"text.edit\"\n       class=\"no-decoration-on-hover\">\n      <op-icon icon-classes=\"icon-context icon-edit\"></op-icon>\n    </a>\n    <a (click)=\"deleteTimeEntry()\"\n       [title]=\"text.delete\"\n       class=\"no-decoration-on-hover\">\n      <op-icon icon-classes=\"icon-context icon-delete\"></op-icon>\n    </a>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TriggerActionsEntryComponent {\n  @InjectField() readonly timeEntryEditService:TimeEntryEditService;\n  @InjectField() readonly timeEntryCache:TimeEntryCacheService;\n  @InjectField() readonly timeEntryDmService:TimeEntryDmService;\n  @InjectField() readonly notificationsService:NotificationsService;\n  @InjectField() readonly elementRef:ElementRef;\n  @InjectField() readonly i18n:I18nService;\n  @InjectField() readonly cdRef:ChangeDetectorRef;\n\n  public text = {\n    edit: this.i18n.t('js.button_edit'),\n    delete: this.i18n.t('js.button_delete'),\n    error: this.i18n.t('js.error.internal'),\n    areYouSure: this.i18n.t('js.text_are_you_sure')\n  };\n\n  constructor(readonly injector:Injector) {\n  }\n\n  editTimeEntry() {\n    this.loadEntry()\n      .then(entry => {\n        this.timeEntryEditService\n          .edit(entry)\n          .then(() => {\n            window.location.reload();\n          })\n          .catch(() => {\n            // User canceled the modal\n          });\n      });\n  }\n\n  deleteTimeEntry() {\n    if (!window.confirm(this.text.areYouSure)) {\n      return;\n    }\n\n    this.loadEntry()\n      .then(entry => {\n        this.timeEntryDmService\n          .delete(entry)\n          .then(() => {\n            window.location.reload();\n          })\n          .catch((error) => {\n            this.notificationsService.addError(error || this.text.error);\n          });\n      });\n  }\n\n  protected loadEntry() {\n    let timeEntryId = this.elementRef.nativeElement.dataset['entry'];\n\n    return this.timeEntryCache\n      .require(timeEntryId);\n  }\n}\n","import {OptionalBootstrapDefinition} from \"core-app/globals/dynamic-bootstrapper\";\nimport {appBaseSelector, ApplicationBaseComponent} from \"core-app/modules/router/base/application-base.component\";\nimport {\n  EmbeddedTablesMacroComponent,\n  wpEmbeddedTableMacroSelector\n} from \"core-components/wp-table/embedded/embedded-tables-macro.component\";\nimport {\n  ColorsAutocompleter,\n  colorsAutocompleterSelector\n} from \"core-app/modules/common/colors/colors-autocompleter.component\";\nimport {\n  ZenModeButtonComponent,\n  zenModeComponentSelector\n} from \"core-components/wp-buttons/zen-mode-toggle-button/zen-mode-toggle-button.component\";\nimport {AttachmentsComponent, attachmentsSelector} from \"core-app/modules/attachments/attachments.component\";\nimport {\n  UserAutocompleterComponent,\n  usersAutocompleterSelector\n} from \"core-app/modules/common/autocomplete/user-autocompleter.component\";\nimport {\n  GlobalSearchWorkPackagesComponent,\n  globalSearchWorkPackagesSelector\n} from \"core-app/modules/global_search/global-search-work-packages.component\";\nimport {\n  HomescreenNewFeaturesBlockComponent,\n  homescreenNewFeaturesBlockSelector\n} from \"core-components/homescreen/blocks/new-features.component\";\nimport {\n  CustomDateActionAdminComponent,\n  customDateActionAdminSelector\n} from \"core-components/wp-custom-actions/date-action/custom-date-action-admin.component\";\nimport {BoardsMenuComponent, boardsMenuSelector} from \"core-app/modules/boards/boards-sidebar/boards-menu.component\";\nimport {\n  GlobalSearchWorkPackagesEntryComponent,\n  globalSearchWorkPackagesSelectorEntry\n} from \"core-app/modules/global_search/global-search-work-packages-entry.component\";\nimport {\n  NotificationsContainerComponent,\n  notificationsContainerSelector\n} from \"core-app/modules/common/notifications/notifications-container.component\";\nimport {\n  adminTypeFormConfigurationSelector,\n  TypeFormConfigurationComponent\n} from \"core-app/modules/admin/types/type-form-configuration.component\";\nimport {\n  CkeditorAugmentedTextareaComponent,\n  ckeditorAugmentedTextareaSelector\n} from \"core-app/ckeditor/ckeditor-augmented-textarea.component\";\nimport {\n  PersistentToggleComponent,\n  persistentToggleSelector\n} from \"core-app/modules/common/persistent-toggle/persistent-toggle.component\";\nimport {UserAvatarComponent, userAvatarSelector} from \"core-components/user/user-avatar/user-avatar.component\";\nimport {\n  HideSectionLinkComponent,\n  hideSectionLinkSelector\n} from \"core-app/modules/common/hide-section/hide-section-link/hide-section-link.component\";\nimport {\n  ShowSectionDropdownComponent,\n  showSectionDropdownSelector\n} from \"core-app/modules/common/hide-section/show-section-dropdown.component\";\nimport {\n  AddSectionDropdownComponent,\n  addSectionDropdownSelector\n} from \"core-app/modules/common/hide-section/add-section-dropdown/add-section-dropdown.component\";\nimport {\n  AutocompleteSelectDecorationComponent,\n  autocompleteSelectDecorationSelector\n} from \"core-app/modules/common/autocomplete/autocomplete-select-decoration.component\";\nimport {\n  ContentTabsComponent,\n  contentTabsSelector\n} from \"core-app/modules/common/tabs/content-tabs/content-tabs.component\";\nimport {\n  CopyToClipboardDirective,\n  copyToClipboardSelector\n} from \"core-app/modules/common/copy-to-clipboard/copy-to-clipboard.directive\";\nimport {\n  ConfirmFormSubmitController,\n  confirmFormSubmitSelector\n} from \"core-components/modals/confirm-form-submit/confirm-form-submit.directive\";\nimport {MainMenuResizerComponent, mainMenuResizerSelector} from \"core-components/resizer/main-menu-resizer.component\";\nimport {\n  GlobalSearchInputComponent,\n  globalSearchSelector\n} from \"core-app/modules/global_search/input/global-search-input.component\";\nimport {\n  collapsibleSectionAugmentSelector,\n  CollapsibleSectionComponent\n} from \"core-app/modules/common/collapsible-section/collapsible-section.component\";\nimport {\n  EnterpriseBannerBootstrapComponent,\n  enterpriseBannerSelector\n} from \"core-components/enterprise-banner/enterprise-banner-bootstrap.component\";\nimport {\n  ProjectMenuAutocompleteComponent,\n  projectMenuAutocompleteSelector\n} from \"core-components/projects/project-menu-autocomplete/project-menu-autocomplete.component\";\nimport {\n  RemoteFieldUpdaterComponent,\n  remoteFieldUpdaterSelector\n} from \"core-app/modules/common/remote-field-updater/remote-field-updater.component\";\nimport {\n  WorkPackageOverviewGraphComponent,\n  wpOverviewGraphSelector\n} from \"core-app/modules/work-package-graphs/overview/wp-overview-graph.component\";\nimport {\n  WorkPackageQuerySelectDropdownComponent,\n  wpQuerySelectSelector\n} from \"core-components/wp-query-select/wp-query-select-dropdown.component\";\nimport {\n  GlobalSearchTitleComponent,\n  globalSearchTitleSelector\n} from \"core-app/modules/global_search/title/global-search-title.component\";\nimport {\n  GlobalSearchTabsComponent,\n  globalSearchTabsSelector\n} from \"core-app/modules/global_search/tabs/global-search-tabs.component\";\nimport {\n  AttributeHelpTextComponent,\n  attributeHelpTextSelector\n} from \"core-app/modules/common/help-texts/attribute-help-text.component\";\nimport {MainMenuToggleComponent, mainMenuToggleSelector} from \"core-components/main-menu/main-menu-toggle.component\";\nimport {\n  MembersAutocompleterComponent,\n  membersAutocompleterSelector\n} from \"core-app/modules/members/members-autocompleter.component\";\nimport {EnterpriseBaseComponent, enterpriseBaseSelector} from \"core-components/enterprise/enterprise-base.component\";\nimport {\n  EEActiveSavedTrialComponent,\n  enterpriseActiveSavedTrialSelector\n} from \"core-components/enterprise/enterprise-active-trial/ee-active-saved-trial.component\";\nimport {\n  TriggerActionsEntryComponent,\n  triggerActionsEntryComponentSelector\n} from \"core-app/modules/time_entries/edit/trigger-actions-entry.component\";\n\nexport const globalDynamicComponents:OptionalBootstrapDefinition[] = [\n  { selector: appBaseSelector, cls: ApplicationBaseComponent },\n  { selector: attributeHelpTextSelector, cls: AttributeHelpTextComponent },\n  { selector: wpEmbeddedTableMacroSelector, cls: EmbeddedTablesMacroComponent, embeddable: true },\n  { selector: colorsAutocompleterSelector, cls: ColorsAutocompleter },\n  { selector: zenModeComponentSelector, cls: ZenModeButtonComponent },\n  { selector: attachmentsSelector, cls: AttachmentsComponent, embeddable: true },\n  { selector: usersAutocompleterSelector, cls: UserAutocompleterComponent },\n  { selector: membersAutocompleterSelector, cls: MembersAutocompleterComponent },\n  { selector: globalSearchTabsSelector, cls: GlobalSearchTabsComponent },\n  { selector: globalSearchWorkPackagesSelector, cls: GlobalSearchWorkPackagesComponent },\n  { selector: homescreenNewFeaturesBlockSelector, cls: HomescreenNewFeaturesBlockComponent },\n  { selector: customDateActionAdminSelector, cls: CustomDateActionAdminComponent },\n  { selector: boardsMenuSelector, cls: BoardsMenuComponent },\n  { selector: globalSearchWorkPackagesSelectorEntry, cls: GlobalSearchWorkPackagesEntryComponent },\n  { selector: notificationsContainerSelector, cls: NotificationsContainerComponent },\n  { selector: adminTypeFormConfigurationSelector, cls: TypeFormConfigurationComponent, },\n  { selector: ckeditorAugmentedTextareaSelector, cls: CkeditorAugmentedTextareaComponent, embeddable: true },\n  { selector: persistentToggleSelector, cls: PersistentToggleComponent },\n  { selector: userAvatarSelector, cls: UserAvatarComponent },\n  { selector: hideSectionLinkSelector, cls: HideSectionLinkComponent },\n  { selector: showSectionDropdownSelector, cls: ShowSectionDropdownComponent },\n  { selector: addSectionDropdownSelector, cls: AddSectionDropdownComponent },\n  { selector: autocompleteSelectDecorationSelector, cls: AutocompleteSelectDecorationComponent },\n  { selector: contentTabsSelector, cls: ContentTabsComponent },\n  { selector: globalSearchTitleSelector, cls: GlobalSearchTitleComponent },\n  { selector: copyToClipboardSelector, cls: CopyToClipboardDirective },\n  { selector: confirmFormSubmitSelector, cls: ConfirmFormSubmitController },\n  { selector: mainMenuResizerSelector, cls: MainMenuResizerComponent },\n  { selector: mainMenuToggleSelector, cls: MainMenuToggleComponent },\n  { selector: globalSearchSelector, cls: GlobalSearchInputComponent },\n  { selector: collapsibleSectionAugmentSelector, cls: CollapsibleSectionComponent },\n  { selector: enterpriseBannerSelector, cls: EnterpriseBannerBootstrapComponent },\n  { selector: enterpriseBaseSelector, cls: EnterpriseBaseComponent },\n  { selector: enterpriseActiveSavedTrialSelector, cls: EEActiveSavedTrialComponent },\n  { selector: projectMenuAutocompleteSelector, cls: ProjectMenuAutocompleteComponent },\n  { selector: remoteFieldUpdaterSelector, cls: RemoteFieldUpdaterComponent },\n  { selector: wpOverviewGraphSelector, cls: WorkPackageOverviewGraphComponent },\n  { selector: wpQuerySelectSelector, cls: WorkPackageQuerySelectDropdownComponent },\n  { selector: triggerActionsEntryComponentSelector, cls: TriggerActionsEntryComponent, embeddable: true },\n];\n\n\n\n\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from \"@angular/core\";\nimport {MembersAutocompleterComponent} from \"core-app/modules/members/members-autocompleter.component\";\nimport {NgSelectModule} from \"@ng-select/ng-select\";\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    NgSelectModule\n  ],\n  exports: [  ],\n  declarations: [\n    MembersAutocompleterComponent\n  ]\n})\nexport class OpenprojectMembersModule { }\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {EnterpriseTrialService} from \"core-components/enterprise/enterprise-trial.service\";\nimport {EnterpriseBaseComponent} from \"core-components/enterprise/enterprise-base.component\";\nimport {EnterpriseTrialModal} from \"core-components/enterprise/enterprise-modal/enterprise-trial.modal\";\nimport {EETrialFormComponent} from \"core-components/enterprise/enterprise-modal/enterprise-trial-form/ee-trial-form.component\";\nimport {EETrialWaitingComponent} from \"core-components/enterprise/enterprise-trial-waiting/ee-trial-waiting.component\";\nimport {EEActiveTrialComponent} from \"core-components/enterprise/enterprise-active-trial/ee-active-trial.component\";\nimport {EEActiveSavedTrialComponent} from \"core-components/enterprise/enterprise-active-trial/ee-active-saved-trial.component\";\nimport {FormsModule, ReactiveFormsModule} from \"@angular/forms\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  providers: [\n    EnterpriseTrialService\n  ],\n  declarations: [\n    EnterpriseBaseComponent,\n    EnterpriseTrialModal,\n    EETrialFormComponent,\n    EETrialWaitingComponent,\n    EEActiveTrialComponent,\n    EEActiveSavedTrialComponent,\n  ]\n})\nexport class OpenprojectEnterpriseModule {\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {APP_INITIALIZER, ApplicationRef, Injector, NgModule} from '@angular/core';\nimport {ReactiveFormsModule} from '@angular/forms';\nimport {OpenprojectHalModule} from 'core-app/modules/hal/openproject-hal.module';\n\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {States} from 'core-components/states.service';\nimport {PaginationService} from 'core-components/table-pagination/pagination-service';\nimport {MainMenuResizerComponent} from 'core-components/resizer/main-menu-resizer.component';\nimport {ExternalQueryConfigurationService} from 'core-components/wp-table/external-configuration/external-query-configuration.service';\nimport {ExternalRelationQueryConfigurationService} from 'core-components/wp-table/external-configuration/external-relation-query-configuration.service';\nimport {ConfirmDialogModal} from \"core-components/modals/confirm-dialog/confirm-dialog.modal\";\nimport {ConfirmDialogService} from \"core-components/modals/confirm-dialog/confirm-dialog.service\";\nimport {DynamicContentModal} from \"core-components/modals/modal-wrapper/dynamic-content.modal\";\nimport {PasswordConfirmationModal} from \"core-components/modals/request-for-confirmation/password-confirmation.modal\";\nimport {OpenprojectFieldsModule} from \"core-app/modules/fields/openproject-fields.module\";\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {CommentService} from \"core-components/wp-activity/comment-service\";\nimport {OpDragScrollDirective} from \"core-app/modules/common/ui/op-drag-scroll.directive\";\nimport {OpenprojectPluginsModule} from \"core-app/modules/plugins/openproject-plugins.module\";\nimport {ConfirmFormSubmitController} from \"core-components/modals/confirm-form-submit/confirm-form-submit.directive\";\nimport {ProjectMenuAutocompleteComponent} from \"core-components/projects/project-menu-autocomplete/project-menu-autocomplete.component\";\nimport {OpenProjectFileUploadService} from \"core-components/api/op-file-upload/op-file-upload.service\";\nimport {LinkedPluginsModule} from \"core-app/modules/plugins/linked-plugins.module\";\nimport {HookService} from \"core-app/modules/plugins/hook-service\";\nimport {ModalWrapperAugmentService} from \"core-app/globals/augmenting/modal-wrapper.augment.service\";\nimport {DynamicBootstrapper} from \"core-app/globals/dynamic-bootstrapper\";\nimport {OpenprojectWorkPackagesModule} from 'core-app/modules/work_packages/openproject-work-packages.module';\nimport {OpenprojectAttachmentsModule} from 'core-app/modules/attachments/openproject-attachments.module';\nimport {OpenprojectEditorModule} from 'core-app/modules/editor/openproject-editor.module';\nimport {OpenprojectGridsModule} from \"core-app/modules/grids/openproject-grids.module\";\nimport {OpenprojectRouterModule} from \"core-app/modules/router/openproject-router.module\";\nimport {OpenprojectWorkPackageRoutesModule} from \"core-app/modules/work_packages/openproject-work-package-routes.module\";\nimport {BrowserModule} from \"@angular/platform-browser\";\nimport {OpenprojectCalendarModule} from \"core-app/modules/calendar/openproject-calendar.module\";\nimport {OpenprojectGlobalSearchModule} from \"core-app/modules/global_search/openproject-global-search.module\";\nimport {MainMenuToggleComponent} from \"core-components/main-menu/main-menu-toggle.component\";\nimport {MainMenuNavigationService} from \"core-components/main-menu/main-menu-navigation.service\";\nimport {OpenprojectAdminModule} from \"core-app/modules/admin/openproject-admin.module\";\nimport {OpenprojectDashboardsModule} from \"core-app/modules/dashboards/openproject-dashboards.module\";\nimport {OpenprojectWorkPackageGraphsModule} from \"core-app/modules/work-package-graphs/openproject-work-package-graphs.module\";\nimport {WpPreviewModal} from \"core-components/modals/preview-modal/wp-preview-modal/wp-preview.modal\";\nimport {PreviewTriggerService} from \"core-app/globals/global-listeners/preview-trigger.service\";\nimport {OpenprojectOverviewModule} from \"core-app/modules/overview/openproject-overview.module\";\nimport {OpenprojectMyPageModule} from \"core-app/modules/my-page/openproject-my-page.module\";\nimport {OpenprojectProjectsModule} from \"core-app/modules/projects/openproject-projects.module\";\nimport {KeyboardShortcutService} from \"core-app/modules/a11y/keyboard-shortcut-service\";\nimport {globalDynamicComponents} from \"core-app/global-dynamic-components.const\";\nimport {OpenprojectMembersModule} from \"core-app/modules/members/members.module\";\nimport {OpenprojectEnterpriseModule} from \"core-components/enterprise/openproject-enterprise.module\";\n\n@NgModule({\n  imports: [\n    // The BrowserModule must only be loaded here!\n    BrowserModule,\n    // Commons\n    OpenprojectCommonModule,\n    // Router module\n    OpenprojectRouterModule,\n    // Hal Module\n    OpenprojectHalModule,\n\n    // CKEditor\n    OpenprojectEditorModule,\n    // Display + Edit field functionality\n    OpenprojectFieldsModule,\n    OpenprojectGridsModule,\n    OpenprojectAttachmentsModule,\n\n    // Project module\n    OpenprojectProjectsModule,\n\n    // Work packages and their routes\n    OpenprojectWorkPackagesModule,\n    OpenprojectWorkPackageRoutesModule,\n\n    // Work packages in graph representation\n    OpenprojectWorkPackageGraphsModule,\n\n    // Calendar module\n    OpenprojectCalendarModule,\n\n    // Dashboards\n    OpenprojectDashboardsModule,\n\n    // Overview\n    OpenprojectOverviewModule,\n\n    // MyPage\n    OpenprojectMyPageModule,\n\n    // Global Search\n    OpenprojectGlobalSearchModule,\n\n    // Admin module\n    OpenprojectAdminModule,\n    OpenprojectEnterpriseModule,\n\n    // Plugin hooks and modules\n    OpenprojectPluginsModule,\n    // Linked plugins dynamically generated by bundler\n    LinkedPluginsModule,\n\n    // Members\n    OpenprojectMembersModule,\n\n    // Angular Forms\n    ReactiveFormsModule\n  ],\n  providers: [\n    { provide: States, useValue: new States() },\n    { provide: APP_INITIALIZER, useFactory: initializeServices, deps: [Injector], multi: true },\n    PaginationService,\n    OpenProjectFileUploadService,\n    // Split view\n    CommentService,\n    ConfirmDialogService,\n  ],\n  declarations: [\n    OpContextMenuTrigger,\n\n    // Modals\n    ConfirmDialogModal,\n    DynamicContentModal,\n    PasswordConfirmationModal,\n    WpPreviewModal,\n\n    // Main menu\n    MainMenuResizerComponent,\n    MainMenuToggleComponent,\n\n    // Project autocompleter\n    ProjectMenuAutocompleteComponent,\n\n    // Form configuration\n    OpDragScrollDirective,\n    ConfirmFormSubmitController,\n  ]\n})\nexport class OpenProjectModule {\n\n  // noinspection JSUnusedGlobalSymbols\n  ngDoBootstrap(appRef:ApplicationRef) {\n\n    // Register global dynamic components\n    // this is necessary to ensure they are not tree-shaken\n    // (if they are not used anywhere in Angular, they would be removed)\n    DynamicBootstrapper.register(...globalDynamicComponents);\n\n    // Perform global dynamic bootstrapping of our entry components\n    // that are in the current DOM response.\n    DynamicBootstrapper.bootstrapOptionalDocument(appRef, document);\n\n    // Call hook service to allow modules to bootstrap additional elements.\n    // We can't use ngDoBootstrap in nested modules since they are not called.\n    const hookService = (appRef as any)._injector.get(HookService);\n    hookService\n      .call('openProjectAngularBootstrap')\n      .forEach((results:{ selector:string, cls:any }[]) => {\n        DynamicBootstrapper.bootstrapOptionalDocument(appRef, document, results);\n      });\n  }\n}\n\nexport function initializeServices(injector:Injector) {\n  return () => {\n    const ExternalQueryConfiguration = injector.get(ExternalQueryConfigurationService);\n    const ExternalRelationQueryConfiguration = injector.get(ExternalRelationQueryConfigurationService);\n    const ModalWrapper = injector.get(ModalWrapperAugmentService);\n    const PreviewTrigger = injector.get(PreviewTriggerService);\n    const mainMenuNavigationService = injector.get(MainMenuNavigationService);\n    const keyboardShortcuts = injector.get(KeyboardShortcutService);\n\n    mainMenuNavigationService.register();\n\n    // Setup modal wrapping\n    ModalWrapper.setupListener();\n\n    PreviewTrigger.setupListener();\n\n    keyboardShortcuts.register();\n\n    // Setup query configuration listener\n    ExternalQueryConfiguration.setupListener();\n    ExternalRelationQueryConfiguration.setupListener();\n  };\n}\n","import {OpenProjectModule} from 'core-app/angular4-modules';\nimport {enableProdMode} from '@angular/core';\nimport * as jQuery from \"jquery\";\nimport {environment} from './environments/environment';\nimport {platformBrowserDynamic} from '@angular/platform-browser-dynamic';\nimport {SentryReporter} from \"core-app/sentry/sentry-reporter\";\nimport {whenDebugging} from \"core-app/helpers/debug_output\";\nimport {enableReactiveStatesLogging} from \"reactivestates\";\n\n(window as any).global = window;\n\n// Ensure we set the correct dynamic frontend path\n// based on the RAILS_RELATIVE_URL_ROOT setting\n// https://webpack.js.org/guides/public-path/\nconst ASSET_BASE_PATH = '/assets/frontend/';\n\n// Sets the relative base path\nwindow.appBasePath = jQuery('meta[name=app_base_path]').attr('content') || '';\n\n// Ensure to set the asset base for dynamic code loading\n// https://webpack.js.org/guides/public-path/\n__webpack_public_path__ = window.appBasePath + ASSET_BASE_PATH;\n\nwindow.ErrorReporter = new SentryReporter();\n\nrequire('core-app/init-vendors');\nrequire('./app/init-globals');\n\nconst meta = jQuery('meta[name=openproject_initializer]');\nI18n.locale = meta.data('defaultLocale');\nI18n.locale = meta.data('locale');\nI18n.firstDayOfWeek = parseInt(meta.data('firstDayOfWeek'), 10);\n\nif (environment.production) {\n  enableProdMode();\n}\n\n// Enable debug logging for reactive states\nwhenDebugging(() => {\n  (window as any).enableReactiveStatesLogging = () => enableReactiveStatesLogging(true);\n  (window as any).disableReactiveStatesLogging = () => enableReactiveStatesLogging(false);\n});\n\n\njQuery(function () {\n  // Due to the behaviour of the Edge browser we need to wait for 'DOM ready'\n  platformBrowserDynamic()\n    .bootstrapModule(OpenProjectModule)\n    .then(platformRef => {\n      jQuery('body').addClass('__ng2-bootstrap-has-run');\n    });\n});\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Scope} from \"@sentry/hub\";\nimport {Severity} from \"@sentry/types\";\nimport {Event as SentryEvent} from \"@sentry/types\";\nimport {environment} from \"../../environments/environment\";\n\nexport type ScopeCallback = (scope:Scope) => void;\n\n\nexport interface CaptureInterface {\n  /** Capture a message */\n  captureMessage(msg:string, level?:MessageSeverity):void;\n\n  /** Capture an exception(!) only */\n  captureException(err:Error):void;\n}\n\nexport interface SentryClient extends CaptureInterface {\n  configureScope(scope:ScopeCallback):void;\n  withScope(scope:ScopeCallback):void;\n}\n\nexport interface ErrorReporter extends CaptureInterface {\n  /** Register a context callback handler */\n  addContext(...callbacks:ScopeCallback[]):void;\n}\n\nexport type MessageSeverity = 'fatal'|'error'|'warning'|'log'|'info'|'debug';\n\ninterface QueuedMessage {\n  type:'captureMessage'|'captureException';\n  args:any[];\n}\n\nexport class SentryReporter implements ErrorReporter {\n\n  private contextCallbacks:ScopeCallback[] = [];\n\n  private messageStack:QueuedMessage[] = [];\n\n  private readonly sentryConfigured:boolean = true;\n\n  private client:any;\n\n  constructor() {\n    const sentryElement = document.querySelector('meta[name=openproject_sentry]') as HTMLElement|null;\n    if (sentryElement) {\n      import('@sentry/browser').then((Sentry) => {\n        Sentry.init({\n          dsn: sentryElement.dataset.dsn!,\n          debug: !environment.production,\n          ignoreErrors: [\n            // Transition movements,\n            'The transition has been superseded by a different transition',\n            // Uncaught promise rejections\n            'Uncaught (in promise)'\n          ],\n          beforeSend: (event) => this.filterEvent(event)\n        });\n\n        this.sentryLoaded(Sentry);\n      });\n    } else {\n      this.sentryConfigured = false;\n      this.messageStack = [];\n    }\n  }\n\n  public sentryLoaded(client:any) {\n    this.client = client;\n    client.configureScope(this.setupContext.bind(this));\n\n    // Send all messages from before sentry got loaded\n    this.messageStack.forEach((item) => {\n      this[item.type].bind(this).apply(item.args);\n    });\n  }\n\n  public captureMessage(msg:string, severity:MessageSeverity = 'info') {\n    if (!this.client) {\n      return this.handleOfflineMessage('captureMessage', Array.from(arguments));\n    }\n\n    this.client.withScope((scope:Scope) => {\n      this.setupContext(scope);\n      this.client.captureMessage(msg, Severity.fromString(severity));\n    });\n  }\n\n  public captureException(err:Error|string) {\n    if (!this.client || !err) {\n      this.handleOfflineMessage('captureException', Array.from(arguments));\n      throw err;\n    }\n\n    if (typeof err === 'string') {\n      return this.captureMessage(err, 'error');\n    }\n\n    this.client.withScope((scope:Scope) => {\n      this.setupContext(scope);\n      this.client.captureException(err);\n    });\n  }\n\n  public addContext(...callbacks:ScopeCallback[]):void {\n    this.contextCallbacks.push(...callbacks);\n\n    if (this.client) {\n      /** Add to global context as well */\n      callbacks.forEach(cb => this.client.configureScope(cb));\n    }\n  }\n\n  /**\n   * Remember a message or error for later handling\n   * @param type\n   * @param args\n   */\n  private handleOfflineMessage(type:'captureMessage'|'captureException', args:any[]) {\n    if (this.sentryConfigured) {\n      this.messageStack.push({ type, args });\n    } else {\n      console.log(\"[ErrorReporter] Would queue sentry message %O %O, but is not configured.\", type, args);\n    }\n  }\n\n  /**\n   * Set up the current scope for the event to be sent.\n   * @param scope\n   */\n  private setupContext(scope:Scope) {\n    scope.setTag('locale', I18n.locale);\n    scope.setTag('domain', window.location.hostname);\n    scope.setTag('url_path', window.location.pathname);\n    scope.setExtra('url_query', window.location.search);\n\n    /** Execute callbacks */\n    this.contextCallbacks.forEach(cb => cb(scope));\n  }\n\n  /**\n   * Filters the event content's or removes\n   * it from being sent.\n   *\n   * @param event\n   */\n  private filterEvent(event:SentryEvent):SentryEvent|null {\n    const unsupportedBrowser = document.body.classList.contains('-unsupported-browser');\n    if (unsupportedBrowser) {\n      console.warn(\"Browser is not supported, skipping sentry reporting completely.\")\n      return null;\n    }\n\n    return event;\n  }\n}","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {combine, deriveRaw, input, State} from 'reactivestates';\nimport {map, mapTo, take} from 'rxjs/operators';\nimport {merge, Observable} from 'rxjs';\nimport {QueryResource} from 'core-app/modules/hal/resources/query-resource';\nimport {QuerySchemaResource} from 'core-app/modules/hal/resources/query-schema-resource';\nimport {WorkPackageCollectionResource} from 'core-app/modules/hal/resources/wp-collection-resource';\nimport {Injectable} from \"@angular/core\";\n\n@Injectable()\nexport abstract class WorkPackageViewBaseService<T> {\n\n  /** Internal state to push non-persisted updates */\n  protected updatesState = input<T>();\n\n  /** Internal pristine state filled during +initialize+ only */\n  protected pristineState = input<T>();\n\n  constructor(protected readonly querySpace:IsolatedQuerySpace) {\n  }\n\n  /**\n   * Get the state value from the current query.\n   *\n   * @param {QueryResource} query\n   * @returns {T} Instance of the state value for this type.\n   */\n  public abstract valueFromQuery(query:QueryResource, results:WorkPackageCollectionResource):T|undefined;\n\n  /**\n   * Initialize this table state from the given query resource,\n   * and possibly the associated schema.\n   *\n   * @param {QueryResource} query\n   * @param {QuerySchemaResource} schema\n   */\n  public initialize(query:QueryResource, results:WorkPackageCollectionResource, schema?:QuerySchemaResource) {\n    const initial = this.valueFromQuery(query, results)!;\n    this.pristineState.putValue(initial);\n  }\n\n  public update(value:T) {\n    this.updatesState.putValue(value);\n  }\n\n  public clear(reason:string) {\n    this.pristineState.clear(reason);\n    this.updatesState.clear(reason);\n  }\n\n  /**\n   * Get the combined pristine and update value changes\n   * @param unsubscribe\n   */\n  public live$():Observable<T> {\n    return merge(\n      this.pristineState.values$(),\n      this.updatesState.values$(),\n    );\n  }\n\n  /**\n   * Get pristine upstream changes\n   *\n   * @param unsubscribe\n   */\n  public pristine$():Observable<T> {\n    return this\n      .pristineState\n      .values$();\n  }\n\n  /**\n   * Get only the local update changes\n   *\n   * @param unsubscribe\n   */\n  public updates$():Observable<T> {\n    return this\n      .updatesState\n      .values$();\n  }\n\n  /**\n   * Get only the local update changes\n   *\n   * @param unsubscribe\n   */\n  public changes$():Observable<unknown> {\n    return this\n      .updatesState\n      .changes$();\n  }\n\n  public onReady() {\n    return this\n      .pristineState\n      .values$()\n      .pipe(\n        take(1),\n        mapTo(null)\n      )\n      .toPromise();\n  }\n\n  /** Get the last updated value from either pristine or update state */\n  protected get lastUpdatedState():State<T> {\n    const combinedRaw = combine(this.pristineState, this.updatesState);\n\n    return deriveRaw(combinedRaw,\n      ($) => $\n        .pipe(\n          map(([pristine, current]) => {\n            if (current === undefined) {\n              return pristine;\n            }\n            return current;\n          })\n        )\n    );\n  }\n\n  /**\n   * Helper to set the value of the current state\n   * @param val\n   */\n  protected set current(val:T|undefined) {\n    if (val) {\n      this.updatesState.putValue(val);\n    } else {\n      this.updatesState.clear();\n    }\n  }\n\n  /**\n   * Get the value of the current state, if any.\n   */\n  protected get current():T|undefined {\n    return this.lastUpdatedState.value;\n  }\n}\n\n@Injectable()\nexport abstract class WorkPackageQueryStateService<T> extends WorkPackageViewBaseService<T> {\n  /**\n   * Check whether the state value does not match the query resource's value.\n   * @param query The current query resource\n   */\n  abstract hasChanged(query:QueryResource):boolean;\n\n  /**\n   * Apply the current state value to query\n   *\n   * @return Whether the query should be visibly updated.\n   */\n  abstract applyToQuery(query:QueryResource):boolean;\n}\n"],"sourceRoot":"webpack:///"}